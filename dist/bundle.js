import*as e from"react";import t,{useReducer as n,useRef as r,useDebugValue as i,useEffect as s,useLayoutEffect as a,useState as o,useMemo as l,forwardRef as c,useCallback as u,useContext as h,Fragment as d,useImperativeHandle as f,cloneElement as p,createContext as m,Suspense as g}from"react";import{jsx as A,Fragment as v}from"react/jsx-runtime";import y from"react-dom";const E="158",_={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},x={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},b=0,S=1,w=2,C=100,T=101,M=102,I=200,R=201,B=202,P=203,D=204,L=205,k=206,F=207,O=208,U=209,N=210,z=211,G=212,Q=213,H=214,V="attached",j="detached",W=300,Y=301,K=302,q=303,X=304,$=306,J=1e3,Z=1001,ee=1002,te=1003,ne=1004,re=1005,ie=1006,se=1007,ae=1008,oe=1008,le=1009,ce=1010,ue=1011,he=1012,de=1013,fe=1014,pe=1015,me=1016,ge=1017,Ae=1018,ve=1020,ye=1023,Ee=1026,_e=1027,xe=1028,be=1029,Se=1030,we=1031,Ce=1033,Te=33776,Me=33777,Ie=33778,Re=33779,Be=35840,Pe=35841,De=35842,Le=35843,ke=36196,Fe=37492,Oe=37496,Ue=37808,Ne=37809,ze=37810,Ge=37811,Qe=37812,He=37813,Ve=37814,je=37815,We=37816,Ye=37817,Ke=37818,qe=37819,Xe=37820,$e=37821,Je=36492,Ze=36494,et=36495,tt=36284,nt=36285,rt=36286,it=2300,st=2301,at=2302,ot=2400,lt=2401,ct=2402,ut=2500,ht=2501,dt=3e3,ft=3001,pt=3201,mt="",gt="srgb",At="srgb-linear",vt="display-p3",yt="display-p3-linear",Et="linear",_t="srgb",xt="rec709",bt="p3",St=7680,wt=7681,Ct=519,Tt=512,Mt=513,It=514,Rt=515,Bt=516,Pt=517,Dt=518,Lt=519,kt=35044,Ft=35048,Ot="300 es",Ut=1035,Nt=2e3,zt=2001;class Gt{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const Qt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Ht=1234567;const Vt=Math.PI/180,jt=180/Math.PI;function Wt(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Qt[255&e]+Qt[e>>8&255]+Qt[e>>16&255]+Qt[e>>24&255]+"-"+Qt[255&t]+Qt[t>>8&255]+"-"+Qt[t>>16&15|64]+Qt[t>>24&255]+"-"+Qt[63&n|128]+Qt[n>>8&255]+"-"+Qt[n>>16&255]+Qt[n>>24&255]+Qt[255&r]+Qt[r>>8&255]+Qt[r>>16&255]+Qt[r>>24&255]).toLowerCase()}function Yt(e,t,n){return Math.max(t,Math.min(n,e))}function Kt(e,t){return(e%t+t)%t}function qt(e,t,n){return(1-n)*e+n*t}function Xt(e){return!(e&e-1)&&0!==e}function $t(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Jt(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Zt(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function en(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const tn={DEG2RAD:Vt,RAD2DEG:jt,generateUUID:Wt,clamp:Yt,euclideanModulo:Kt,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:qt,damp:function(e,t,n,r){return qt(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Kt(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Ht=e);let t=Ht+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*Vt},radToDeg:function(e){return e*jt},isPowerOfTwo:Xt,ceilPowerOfTwo:$t,floorPowerOfTwo:Jt,setQuaternionFromProperEuler:function(e,t,n,r,i){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),f=s((r-t)/2),p=a((r-t)/2);switch(i){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*p,l*f,o*c);break;case"YXY":e.set(l*f,o*u,l*p,o*c);break;case"ZYZ":e.set(l*p,l*f,o*u,o*c)}},normalize:en,denormalize:Zt};class nn{constructor(e=0,t=0){nn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Yt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,s=this.y-e.y;return this.x=i*n-s*r+e.x,this.y=i*r+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class rn{constructor(e,t,n,r,i,s,a,o,l){rn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,s,a,o,l)}set(e,t,n,r,i,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=i,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],f=n[8],p=r[0],m=r[3],g=r[6],A=r[1],v=r[4],y=r[7],E=r[2],_=r[5],x=r[8];return i[0]=s*p+a*A+o*E,i[3]=s*m+a*v+o*_,i[6]=s*g+a*y+o*x,i[1]=l*p+c*A+u*E,i[4]=l*m+c*v+u*_,i[7]=l*g+c*y+u*x,i[2]=h*p+d*A+f*E,i[5]=h*m+d*v+f*_,i[8]=h*g+d*y+f*x,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-n*i*c+n*a*o+r*i*l-r*s*o}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*i,d=l*i-s*o,f=t*u+n*h+r*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=u*p,e[1]=(r*l-c*n)*p,e[2]=(a*n-r*s)*p,e[3]=h*p,e[4]=(c*t-r*o)*p,e[5]=(r*i-a*t)*p,e[6]=d*p,e[7]=(n*o-l*t)*p,e[8]=(s*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,s,a){const o=Math.cos(i),l=Math.sin(i);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(sn.makeScale(e,t)),this}rotate(e){return this.premultiply(sn.makeRotation(-e)),this}translate(e,t){return this.premultiply(sn.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const sn=new rn;function an(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const on={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ln(e,t){return new on[e](t)}function cn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function un(){const e=cn("canvas");return e.style.display="block",e}const hn={};function dn(e){e in hn||(hn[e]=!0)}const fn=(new rn).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),pn=(new rn).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),mn={[At]:{transfer:Et,primaries:xt,toReference:e=>e,fromReference:e=>e},[gt]:{transfer:_t,primaries:xt,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[yt]:{transfer:Et,primaries:bt,toReference:e=>e.applyMatrix3(pn),fromReference:e=>e.applyMatrix3(fn)},[vt]:{transfer:_t,primaries:bt,toReference:e=>e.convertSRGBToLinear().applyMatrix3(pn),fromReference:e=>e.applyMatrix3(fn).convertLinearToSRGB()}},gn=new Set([At,yt]),An={enabled:!0,_workingColorSpace:At,get legacyMode(){return!this.enabled},set legacyMode(e){this.enabled=!e},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!gn.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const r=mn[t].toReference;return(0,mn[n].fromReference)(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return mn[e].primaries},getTransfer:function(e){return e===mt?Et:mn[e].transfer}};function vn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function yn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let En;class _n{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===En&&(En=cn("canvas")),En.width=e.width,En.height=e.height;const n=En.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=En}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=cn("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*vn(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*vn(t[e]/255)):t[e]=vn(t[e]);return{data:t,width:e.width,height:e.height}}return e}}let xn=0;class bn{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:xn++}),this.uuid=Wt(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Sn(r[t].image)):e.push(Sn(r[t]))}else e=Sn(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function Sn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?_n.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:{}}let wn=0;class Cn extends Gt{constructor(e=Cn.DEFAULT_IMAGE,t=Cn.DEFAULT_MAPPING,n=1001,r=1001,i=1006,s=1008,a=1023,o=1009,l=Cn.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:wn++}),this.uuid=Wt(),this.name="",this.source=new bn(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new nn(0,0),this.repeat=new nn(1,1),this.center=new nn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(dn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===ft?gt:mt),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==W)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case J:e.x=e.x-Math.floor(e.x);break;case Z:e.x=e.x<0?0:1;break;case ee:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case J:e.y=e.y-Math.floor(e.y);break;case Z:e.y=e.y<0?0:1;break;case ee:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return dn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===gt?ft:dt}set encoding(e){dn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===ft?gt:mt}}Cn.DEFAULT_IMAGE=null,Cn.DEFAULT_MAPPING=W,Cn.DEFAULT_ANISOTROPY=1;class Tn{constructor(e=0,t=0,n=0,r=1){Tn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const s=.01,a=.1,o=e.elements,l=o[0],c=o[4],u=o[8],h=o[1],d=o[5],f=o[9],p=o[2],m=o[6],g=o[10];if(Math.abs(c-h)<s&&Math.abs(u-p)<s&&Math.abs(f-m)<s){if(Math.abs(c+h)<a&&Math.abs(u+p)<a&&Math.abs(f+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,A=(g+1)/2,v=(c+h)/4,y=(u+p)/4,E=(f+m)/4;return e>o&&e>A?e<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=v/n,i=y/n):o>A?o<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=v/r,i=E/r):A<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(A),n=y/i,r=E/i),this.set(n,r,i,t),this}let A=Math.sqrt((m-f)*(m-f)+(u-p)*(u-p)+(h-c)*(h-c));return Math.abs(A)<.001&&(A=1),this.x=(m-f)/A,this.y=(u-p)/A,this.z=(h-c)/A,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Mn extends Gt{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Tn(0,0,e,t),this.scissorTest=!1,this.viewport=new Tn(0,0,e,t);const r={width:e,height:t,depth:1};void 0!==n.encoding&&(dn("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===ft?gt:mt),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ie,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Cn(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new bn(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class In extends Mn{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Rn extends Cn{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=te,this.minFilter=te,this.wrapR=Z,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Bn extends Cn{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=te,this.minFilter=te,this.wrapR=Z,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Pn{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,s,a){let o=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[s+0],d=i[s+1],f=i[s+2],p=i[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(u!==p||o!==h||l!==d||c!==f){let e=1-a;const t=o*h+l*d+c*f+u*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,t*n);e=Math.sin(e*s)/i,a=Math.sin(a*s)/i}const i=a*n;if(o=o*e+h*i,l=l*e+d*i,c=c*e+f*i,u=u*e+p*i,e===1-a){const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,s){const a=n[r],o=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],d=i[s+2],f=i[s+3];return e[t]=a*f+c*u+o*d-l*h,e[t+1]=o*f+c*h+l*u-a*d,e[t+2]=l*f+c*d+a*h-o*u,e[t+3]=c*f-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,r=e._y,i=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(r/2),u=a(i/2),h=o(n/2),d=o(r/2),f=o(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"YXZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"ZXY":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"ZYX":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"YZX":this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f;break;case"XZY":this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(i-l)*e,this._z=(s-r)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(c-o)/e,this._x=.25*e,this._y=(r+s)/e,this._z=(i+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(i-l)/e,this._x=(r+s)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(s-r)/e,this._x=(i+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Yt(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+s*a+r*l-i*o,this._y=r*c+s*o+i*a-n*l,this._z=i*c+s*l+n*o-r*a,this._w=s*c-n*a-r*o-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,s=this._w;let a=s*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Dn{constructor(e=0,t=0,n=0){Dn.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(kn.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(kn.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,a=e.z,o=e.w,l=2*(s*r-a*n),c=2*(a*t-i*r),u=2*(i*n-s*t);return this.x=t+o*l+s*u-a*c,this.y=n+o*c+a*l-i*u,this.z=r+o*u+i*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,s=t.x,a=t.y,o=t.z;return this.x=r*o-i*a,this.y=i*s-n*o,this.z=n*a-r*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ln.copy(this).projectOnVector(e),this.sub(Ln)}reflect(e){return this.sub(Ln.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Yt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ln=new Dn,kn=new Pn;class Fn{constructor(e=new Dn(1/0,1/0,1/0),t=new Dn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Un.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Un.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Un.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Un):Un.fromBufferAttribute(r,t),Un.applyMatrix4(e.matrixWorld),this.expandByPoint(Un);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Nn.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Nn.copy(n.boundingBox)),Nn.applyMatrix4(e.matrixWorld),this.union(Nn)}const r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Un),Un.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Wn),Yn.subVectors(this.max,Wn),zn.subVectors(e.a,Wn),Gn.subVectors(e.b,Wn),Qn.subVectors(e.c,Wn),Hn.subVectors(Gn,zn),Vn.subVectors(Qn,Gn),jn.subVectors(zn,Qn);let t=[0,-Hn.z,Hn.y,0,-Vn.z,Vn.y,0,-jn.z,jn.y,Hn.z,0,-Hn.x,Vn.z,0,-Vn.x,jn.z,0,-jn.x,-Hn.y,Hn.x,0,-Vn.y,Vn.x,0,-jn.y,jn.x,0];return!!Xn(t,zn,Gn,Qn,Yn)&&(t=[1,0,0,0,1,0,0,0,1],!!Xn(t,zn,Gn,Qn,Yn)&&(Kn.crossVectors(Hn,Vn),t=[Kn.x,Kn.y,Kn.z],Xn(t,zn,Gn,Qn,Yn)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Un).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Un).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(On[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),On[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),On[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),On[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),On[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),On[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),On[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),On[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(On)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const On=[new Dn,new Dn,new Dn,new Dn,new Dn,new Dn,new Dn,new Dn],Un=new Dn,Nn=new Fn,zn=new Dn,Gn=new Dn,Qn=new Dn,Hn=new Dn,Vn=new Dn,jn=new Dn,Wn=new Dn,Yn=new Dn,Kn=new Dn,qn=new Dn;function Xn(e,t,n,r,i){for(let s=0,a=e.length-3;s<=a;s+=3){qn.fromArray(e,s);const a=i.x*Math.abs(qn.x)+i.y*Math.abs(qn.y)+i.z*Math.abs(qn.z),o=t.dot(qn),l=n.dot(qn),c=r.dot(qn);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const $n=new Fn,Jn=new Dn,Zn=new Dn;class er{constructor(e=new Dn,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):$n.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Jn.subVectors(e,this.center);const t=Jn.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Jn,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Zn.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Jn.copy(e.center).add(Zn)),this.expandByPoint(Jn.copy(e.center).sub(Zn))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const tr=new Dn,nr=new Dn,rr=new Dn,ir=new Dn,sr=new Dn,ar=new Dn,or=new Dn;class lr{constructor(e=new Dn,t=new Dn(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,tr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=tr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(tr.copy(this.origin).addScaledVector(this.direction,t),tr.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){nr.copy(e).add(t).multiplyScalar(.5),rr.copy(t).sub(e).normalize(),ir.copy(this.origin).sub(nr);const i=.5*e.distanceTo(t),s=-this.direction.dot(rr),a=ir.dot(this.direction),o=-ir.dot(rr),l=ir.lengthSq(),c=Math.abs(1-s*s);let u,h,d,f;if(c>0)if(u=s*o-a,h=s*a-o,f=i*c,u>=0)if(h>=-f)if(h<=f){const e=1/c;u*=e,h*=e,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=i,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-i,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-f?(u=Math.max(0,-(-s*i+a)),h=u>0?-i:Math.min(Math.max(-i,-o),i),d=-u*u+h*(h+2*o)+l):h<=f?(u=0,h=Math.min(Math.max(-i,-o),i),d=h*(h+2*o)+l):(u=Math.max(0,-(s*i+a)),h=u>0?i:Math.min(Math.max(-i,-o),i),d=-u*u+h*(h+2*o)+l);else h=s>0?-i:i,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(nr).addScaledVector(rr,h),d}intersectSphere(e,t){tr.subVectors(e.center,this.origin);const n=tr.dot(this.direction),r=tr.dot(tr)-n*n,i=e.radius*e.radius;if(r>i)return null;const s=Math.sqrt(i-r),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),n>s||i>r?null:((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),n>o||a>r?null:((a>n||n!=n)&&(n=a),(o<r||r!=r)&&(r=o),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,tr)}intersectTriangle(e,t,n,r,i){sr.subVectors(t,e),ar.subVectors(n,e),or.crossVectors(sr,ar);let s,a=this.direction.dot(or);if(a>0){if(r)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}ir.subVectors(this.origin,e);const o=s*this.direction.dot(ar.crossVectors(ir,ar));if(o<0)return null;const l=s*this.direction.dot(sr.cross(ir));if(l<0)return null;if(o+l>a)return null;const c=-s*ir.dot(or);return c<0?null:this.at(c/a,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class cr{constructor(e,t,n,r,i,s,a,o,l,c,u,h,d,f,p,m){cr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,s,a,o,l,c,u,h,d,f,p,m)}set(e,t,n,r,i,s,a,o,l,c,u,h,d,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new cr).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/ur.setFromMatrixColumn(e,0).length(),i=1/ur.setFromMatrixColumn(e,1).length(),s=1/ur.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=s*c,n=s*u,r=a*c,i=a*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-a*o,t[2]=i-e*l,t[6]=r+n*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e+i*a,t[4]=r*a-n,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=n*a-r,t[6]=i+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e-i*a,t[4]=-s*u,t[8]=r+n*a,t[1]=n+r*a,t[5]=s*c,t[9]=i-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*c,n=s*u,r=a*c,i=a*u;t[0]=o*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=o*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,n=s*l,r=a*o,i=a*l;t[0]=o*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=s*o,n=s*l,r=a*o,i=a*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=s*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=a*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(dr,e,fr)}lookAt(e,t,n){const r=this.elements;return gr.subVectors(e,t),0===gr.lengthSq()&&(gr.z=1),gr.normalize(),pr.crossVectors(n,gr),0===pr.lengthSq()&&(1===Math.abs(n.z)?gr.x+=1e-4:gr.z+=1e-4,gr.normalize(),pr.crossVectors(n,gr)),pr.normalize(),mr.crossVectors(gr,pr),r[0]=pr.x,r[4]=mr.x,r[8]=gr.x,r[1]=pr.y,r[5]=mr.y,r[9]=gr.y,r[2]=pr.z,r[6]=mr.z,r[10]=gr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],A=n[3],v=n[7],y=n[11],E=n[15],_=r[0],x=r[4],b=r[8],S=r[12],w=r[1],C=r[5],T=r[9],M=r[13],I=r[2],R=r[6],B=r[10],P=r[14],D=r[3],L=r[7],k=r[11],F=r[15];return i[0]=s*_+a*w+o*I+l*D,i[4]=s*x+a*C+o*R+l*L,i[8]=s*b+a*T+o*B+l*k,i[12]=s*S+a*M+o*P+l*F,i[1]=c*_+u*w+h*I+d*D,i[5]=c*x+u*C+h*R+d*L,i[9]=c*b+u*T+h*B+d*k,i[13]=c*S+u*M+h*P+d*F,i[2]=f*_+p*w+m*I+g*D,i[6]=f*x+p*C+m*R+g*L,i[10]=f*b+p*T+m*B+g*k,i[14]=f*S+p*M+m*P+g*F,i[3]=A*_+v*w+y*I+E*D,i[7]=A*x+v*C+y*R+E*L,i[11]=A*b+v*T+y*B+E*k,i[15]=A*S+v*M+y*P+E*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*o*u-r*l*u-i*a*h+n*l*h+r*a*d-n*o*d)+e[7]*(+t*o*d-t*l*h+i*s*h-r*s*d+r*l*c-i*o*c)+e[11]*(+t*l*u-t*a*d-i*s*u+n*s*d+i*a*c-n*l*c)+e[15]*(-r*a*c-t*o*u+t*a*h+r*s*u-n*s*h+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],A=u*m*l-p*h*l+p*o*d-a*m*d-u*o*g+a*h*g,v=f*h*l-c*m*l-f*o*d+s*m*d+c*o*g-s*h*g,y=c*p*l-f*u*l+f*a*d-s*p*d-c*a*g+s*u*g,E=f*u*o-c*p*o-f*a*h+s*p*h+c*a*m-s*u*m,_=t*A+n*v+r*y+i*E;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const x=1/_;return e[0]=A*x,e[1]=(p*h*i-u*m*i-p*r*d+n*m*d+u*r*g-n*h*g)*x,e[2]=(a*m*i-p*o*i+p*r*l-n*m*l-a*r*g+n*o*g)*x,e[3]=(u*o*i-a*h*i-u*r*l+n*h*l+a*r*d-n*o*d)*x,e[4]=v*x,e[5]=(c*m*i-f*h*i+f*r*d-t*m*d-c*r*g+t*h*g)*x,e[6]=(f*o*i-s*m*i-f*r*l+t*m*l+s*r*g-t*o*g)*x,e[7]=(s*h*i-c*o*i+c*r*l-t*h*l-s*r*d+t*o*d)*x,e[8]=y*x,e[9]=(f*u*i-c*p*i-f*n*d+t*p*d+c*n*g-t*u*g)*x,e[10]=(s*p*i-f*a*i+f*n*l-t*p*l-s*n*g+t*a*g)*x,e[11]=(c*a*i-s*u*i-c*n*l+t*u*l+s*n*d-t*a*d)*x,e[12]=E*x,e[13]=(c*p*r-f*u*r+f*n*h-t*p*h-c*n*m+t*u*m)*x,e[14]=(f*a*r-s*p*r-f*n*o+t*p*o+s*n*m-t*a*m)*x,e[15]=(s*u*r-c*a*r+c*n*o-t*u*o-s*n*h+t*a*h)*x,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,a=e.y,o=e.z,l=i*s,c=i*a;return this.set(l*s+n,l*a-r*o,l*o+r*a,0,l*a+r*o,c*a+n,c*o-r*s,0,l*o-r*a,c*o+r*s,i*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,s){return this.set(1,n,i,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,s=t._y,a=t._z,o=t._w,l=i+i,c=s+s,u=a+a,h=i*l,d=i*c,f=i*u,p=s*c,m=s*u,g=a*u,A=o*l,v=o*c,y=o*u,E=n.x,_=n.y,x=n.z;return r[0]=(1-(p+g))*E,r[1]=(d+y)*E,r[2]=(f-v)*E,r[3]=0,r[4]=(d-y)*_,r[5]=(1-(h+g))*_,r[6]=(m+A)*_,r[7]=0,r[8]=(f+v)*x,r[9]=(m-A)*x,r[10]=(1-(h+p))*x,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=ur.set(r[0],r[1],r[2]).length();const s=ur.set(r[4],r[5],r[6]).length(),a=ur.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],hr.copy(this);const o=1/i,l=1/s,c=1/a;return hr.elements[0]*=o,hr.elements[1]*=o,hr.elements[2]*=o,hr.elements[4]*=l,hr.elements[5]*=l,hr.elements[6]*=l,hr.elements[8]*=c,hr.elements[9]*=c,hr.elements[10]*=c,t.setFromRotationMatrix(hr),n.x=i,n.y=s,n.z=a,this}makePerspective(e,t,n,r,i,s,a=2e3){const o=this.elements,l=2*i/(t-e),c=2*i/(n-r),u=(t+e)/(t-e),h=(n+r)/(n-r);let d,f;if(a===Nt)d=-(s+i)/(s-i),f=-2*s*i/(s-i);else{if(a!==zt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-i),f=-s*i/(s-i)}return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,r,i,s,a=2e3){const o=this.elements,l=1/(t-e),c=1/(n-r),u=1/(s-i),h=(t+e)*l,d=(n+r)*c;let f,p;if(a===Nt)f=(s+i)*u,p=-2*u;else{if(a!==zt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);f=i*u,p=-1*u}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=p,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const ur=new Dn,hr=new cr,dr=new Dn(0,0,0),fr=new Dn(1,1,1),pr=new Dn,mr=new Dn,gr=new Dn,Ar=new cr,vr=new Pn;class yr{constructor(e=0,t=0,n=0,r=yr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(Yt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Yt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(Yt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-Yt(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Yt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Yt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,d),this._y=0)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Ar.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ar,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return vr.setFromEuler(this),this.setFromQuaternion(vr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}yr.DEFAULT_ORDER="XYZ";class Er{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let _r=0;const xr=new Dn,br=new Pn,Sr=new cr,wr=new Dn,Cr=new Dn,Tr=new Dn,Mr=new Pn,Ir=new Dn(1,0,0),Rr=new Dn(0,1,0),Br=new Dn(0,0,1),Pr={type:"added"},Dr={type:"removed"};class Lr extends Gt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_r++}),this.uuid=Wt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Lr.DEFAULT_UP.clone();const e=new Dn,t=new yr,n=new Pn,r=new Dn(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new cr},normalMatrix:{value:new rn}}),this.matrix=new cr,this.matrixWorld=new cr,this.matrixAutoUpdate=Lr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Lr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Er,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return br.setFromAxisAngle(e,t),this.quaternion.multiply(br),this}rotateOnWorldAxis(e,t){return br.setFromAxisAngle(e,t),this.quaternion.premultiply(br),this}rotateX(e){return this.rotateOnAxis(Ir,e)}rotateY(e){return this.rotateOnAxis(Rr,e)}rotateZ(e){return this.rotateOnAxis(Br,e)}translateOnAxis(e,t){return xr.copy(e).applyQuaternion(this.quaternion),this.position.add(xr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ir,e)}translateY(e){return this.translateOnAxis(Rr,e)}translateZ(e){return this.translateOnAxis(Br,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Sr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?wr.copy(e):wr.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Cr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Sr.lookAt(Cr,wr,this.up):Sr.lookAt(wr,Cr,this.up),this.quaternion.setFromRotationMatrix(Sr),r&&(Sr.extractRotation(r.matrixWorld),br.setFromRotationMatrix(Sr),this.quaternion.premultiply(br.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this||e&&e.isObject3D&&(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Pr)),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Dr)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Sr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Sr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Sr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let r=0,i=this.children.length;r<i;r++){const i=this.children[r].getObjectsByProperty(e,t);i.length>0&&(n=n.concat(i))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Cr,e,Tr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Cr,Mr,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const r=t[n];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=s(e.geometries),r=s(e.materials),i=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),u=s(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function s(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Lr.DEFAULT_UP=new Dn(0,1,0),Lr.DEFAULT_MATRIX_AUTO_UPDATE=!0,Lr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const kr=new Dn,Fr=new Dn,Or=new Dn,Ur=new Dn,Nr=new Dn,zr=new Dn,Gr=new Dn,Qr=new Dn,Hr=new Dn,Vr=new Dn;let jr=!1;class Wr{constructor(e=new Dn,t=new Dn,n=new Dn){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),kr.subVectors(e,t),r.cross(kr);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){kr.subVectors(r,t),Fr.subVectors(n,t),Or.subVectors(e,t);const s=kr.dot(kr),a=kr.dot(Fr),o=kr.dot(Or),l=Fr.dot(Fr),c=Fr.dot(Or),u=s*l-a*a;if(0===u)return i.set(-2,-1,-1);const h=1/u,d=(l*o-a*c)*h,f=(s*c-a*o)*h;return i.set(1-d-f,f,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Ur),Ur.x>=0&&Ur.y>=0&&Ur.x+Ur.y<=1}static getUV(e,t,n,r,i,s,a,o){return!1===jr&&(jr=!0),this.getInterpolation(e,t,n,r,i,s,a,o)}static getInterpolation(e,t,n,r,i,s,a,o){return this.getBarycoord(e,t,n,r,Ur),o.setScalar(0),o.addScaledVector(i,Ur.x),o.addScaledVector(s,Ur.y),o.addScaledVector(a,Ur.z),o}static isFrontFacing(e,t,n,r){return kr.subVectors(n,t),Fr.subVectors(e,t),kr.cross(Fr).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return kr.subVectors(this.c,this.b),Fr.subVectors(this.a,this.b),.5*kr.cross(Fr).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Wr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Wr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return!1===jr&&(jr=!0),Wr.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}getInterpolation(e,t,n,r,i){return Wr.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Wr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Wr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let s,a;Nr.subVectors(r,n),zr.subVectors(i,n),Qr.subVectors(e,n);const o=Nr.dot(Qr),l=zr.dot(Qr);if(o<=0&&l<=0)return t.copy(n);Hr.subVectors(e,r);const c=Nr.dot(Hr),u=zr.dot(Hr);if(c>=0&&u<=c)return t.copy(r);const h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(n).addScaledVector(Nr,s);Vr.subVectors(e,i);const d=Nr.dot(Vr),f=zr.dot(Vr);if(f>=0&&d<=f)return t.copy(i);const p=d*l-o*f;if(p<=0&&l>=0&&f<=0)return a=l/(l-f),t.copy(n).addScaledVector(zr,a);const m=c*f-d*u;if(m<=0&&u-c>=0&&d-f>=0)return Gr.subVectors(i,r),a=(u-c)/(u-c+(d-f)),t.copy(r).addScaledVector(Gr,a);const g=1/(m+p+h);return s=p*g,a=h*g,t.copy(n).addScaledVector(Nr,s).addScaledVector(zr,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Yr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Kr={h:0,s:0,l:0},qr={h:0,s:0,l:0};function Xr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class $r{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=gt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,An.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=An.workingColorSpace){return this.r=e,this.g=t,this.b=n,An.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=An.workingColorSpace){if(e=Kt(e,1),t=Yt(t,0,1),n=Yt(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Xr(i,r,e+1/3),this.g=Xr(i,r,e),this.b=Xr(i,r,e-1/3)}return An.toWorkingColorSpace(this,r),this}setStyle(e,t=gt){function n(e){void 0!==e&&parseFloat(e)}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let e;const i=r[1],s=r[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,t);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,t);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=r[1],n=e.length;if(3===n)return this.setRGB(parseInt(e.charAt(0),16)/15,parseInt(e.charAt(1),16)/15,parseInt(e.charAt(2),16)/15,t);if(6===n)return this.setHex(parseInt(e,16),t)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=gt){const n=Yr[e.toLowerCase()];return void 0!==n&&this.setHex(n,t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=vn(e.r),this.g=vn(e.g),this.b=vn(e.b),this}copyLinearToSRGB(e){return this.r=yn(e.r),this.g=yn(e.g),this.b=yn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=gt){return An.fromWorkingColorSpace(Jr.copy(this),e),65536*Math.round(Yt(255*Jr.r,0,255))+256*Math.round(Yt(255*Jr.g,0,255))+Math.round(Yt(255*Jr.b,0,255))}getHexString(e=gt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=An.workingColorSpace){An.fromWorkingColorSpace(Jr.copy(this),t);const n=Jr.r,r=Jr.g,i=Jr.b,s=Math.max(n,r,i),a=Math.min(n,r,i);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=c<=.5?e/(s+a):e/(2-s-a),s){case n:o=(r-i)/e+(r<i?6:0);break;case r:o=(i-n)/e+2;break;case i:o=(n-r)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=An.workingColorSpace){return An.fromWorkingColorSpace(Jr.copy(this),t),e.r=Jr.r,e.g=Jr.g,e.b=Jr.b,e}getStyle(e=gt){An.fromWorkingColorSpace(Jr.copy(this),e);const t=Jr.r,n=Jr.g,r=Jr.b;return e!==gt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(Kr),this.setHSL(Kr.h+e,Kr.s+t,Kr.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Kr),e.getHSL(qr);const n=qt(Kr.h,qr.h,t),r=qt(Kr.s,qr.s,t),i=qt(Kr.l,qr.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Jr=new $r;$r.NAMES=Yr;let Zr=0;class ei extends Gt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Zr++}),this.uuid=Wt(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=D,this.blendDst=L,this.blendEquation=C,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new $r(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ct,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=St,this.stencilZFail=St,this.stencilZPass=St,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n)continue;const r=this[t];void 0!==r&&(r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==D&&(n.blendSrc=this.blendSrc),this.blendDst!==L&&(n.blendDst=this.blendDst),this.blendEquation!==C&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Ct&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==St&&(n.stencilFail=this.stencilFail),this.stencilZFail!==St&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==St&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class ti extends ei{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new $r(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ni=ri();function ri(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(r[e]=0,r[256|e]=32768,i[e]=24,i[256|e]=24):t<-14?(r[e]=1024>>-t-14,r[256|e]=1024>>-t-14|32768,i[e]=-t-1,i[256|e]=-t-1):t<=15?(r[e]=t+15<<10,r[256|e]=t+15<<10|32768,i[e]=13,i[256|e]=13):t<128?(r[e]=31744,r[256|e]=64512,i[e]=24,i[256|e]=24):(r[e]=31744,r[256|e]=64512,i[e]=13,i[256|e]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,s[e]=t|n}for(let e=1024;e<2048;++e)s[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)a[e]=e<<23;a[31]=1199570944,a[32]=2147483648;for(let e=33;e<63;++e)a[e]=2147483648+(e-32<<23);a[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:a,offsetTable:o}}function ii(e){Math.abs(e),e=Yt(e,-65504,65504),ni.floatView[0]=e;const t=ni.uint32View[0],n=t>>23&511;return ni.baseTable[n]+((8388607&t)>>ni.shiftTable[n])}function si(e){const t=e>>10;return ni.uint32View[0]=ni.mantissaTable[ni.offsetTable[t]+(1023&e)]+ni.exponentTable[t],ni.floatView[0]}const ai={toHalfFloat:ii,fromHalfFloat:si},oi=new Dn,li=new nn;class ci{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=kt,this.updateRange={offset:0,count:-1},this.gpuType=pe,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)li.fromBufferAttribute(this,t),li.applyMatrix3(e),this.setXY(t,li.x,li.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)oi.fromBufferAttribute(this,t),oi.applyMatrix3(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)oi.fromBufferAttribute(this,t),oi.applyMatrix4(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)oi.fromBufferAttribute(this,t),oi.applyNormalMatrix(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)oi.fromBufferAttribute(this,t),oi.transformDirection(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Zt(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=en(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Zt(t,this.array)),t}setX(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Zt(t,this.array)),t}setY(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Zt(t,this.array)),t}setZ(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Zt(t,this.array)),t}setW(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=en(t,this.array),n=en(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=en(t,this.array),n=en(n,this.array),r=en(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=en(t,this.array),n=en(n,this.array),r=en(r,this.array),i=en(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==kt&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}class ui extends ci{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class hi extends ci{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class di extends ci{constructor(e,t,n){super(new Float32Array(e),t,n)}}let fi=0;const pi=new cr,mi=new Lr,gi=new Dn,Ai=new Fn,vi=new Fn,yi=new Dn;class Ei extends Gt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:fi++}),this.uuid=Wt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(an(e)?hi:ui)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new rn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return pi.makeRotationFromQuaternion(e),this.applyMatrix4(pi),this}rotateX(e){return pi.makeRotationX(e),this.applyMatrix4(pi),this}rotateY(e){return pi.makeRotationY(e),this.applyMatrix4(pi),this}rotateZ(e){return pi.makeRotationZ(e),this.applyMatrix4(pi),this}translate(e,t,n){return pi.makeTranslation(e,t,n),this.applyMatrix4(pi),this}scale(e,t,n){return pi.makeScale(e,t,n),this.applyMatrix4(pi),this}lookAt(e){return mi.lookAt(e),mi.updateMatrix(),this.applyMatrix4(mi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(gi).negate(),this.translate(gi.x,gi.y,gi.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new di(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Fn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingBox.set(new Dn(-1/0,-1/0,-1/0),new Dn(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Ai.setFromBufferAttribute(n),this.morphTargetsRelative?(yi.addVectors(this.boundingBox.min,Ai.min),this.boundingBox.expandByPoint(yi),yi.addVectors(this.boundingBox.max,Ai.max),this.boundingBox.expandByPoint(yi)):(this.boundingBox.expandByPoint(Ai.min),this.boundingBox.expandByPoint(Ai.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new er);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingSphere.set(new Dn,1/0);else if(e){const n=this.boundingSphere.center;if(Ai.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];vi.setFromBufferAttribute(n),this.morphTargetsRelative?(yi.addVectors(Ai.min,vi.min),Ai.expandByPoint(yi),yi.addVectors(Ai.max,vi.max),Ai.expandByPoint(yi)):(Ai.expandByPoint(vi.min),Ai.expandByPoint(vi.max))}Ai.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)yi.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(yi));if(t)for(let i=0,s=t.length;i<s;i++){const s=t[i],a=this.morphTargetsRelative;for(let t=0,i=s.count;t<i;t++)yi.fromBufferAttribute(s,t),a&&(gi.fromBufferAttribute(e,t),yi.add(gi)),r=Math.max(r,n.distanceToSquared(yi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return;const n=e.array,r=t.position.array,i=t.normal.array,s=t.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ci(new Float32Array(4*a),4));const o=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<a;e++)l[e]=new Dn,c[e]=new Dn;const u=new Dn,h=new Dn,d=new Dn,f=new nn,p=new nn,m=new nn,g=new Dn,A=new Dn;function v(e,t,n){u.fromArray(r,3*e),h.fromArray(r,3*t),d.fromArray(r,3*n),f.fromArray(s,2*e),p.fromArray(s,2*t),m.fromArray(s,2*n),h.sub(u),d.sub(u),p.sub(f),m.sub(f);const i=1/(p.x*m.y-m.x*p.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-p.y).multiplyScalar(i),A.copy(d).multiplyScalar(p.x).addScaledVector(h,-m.x).multiplyScalar(i),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(A),c[t].add(A),c[n].add(A))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)v(n[e+0],n[e+1],n[e+2])}const E=new Dn,_=new Dn,x=new Dn,b=new Dn;function S(e){x.fromArray(i,3*e),b.copy(x);const t=l[e];E.copy(t),E.sub(x.multiplyScalar(x.dot(t))).normalize(),_.crossVectors(b,t);const n=_.dot(c[e])<0?-1:1;o[4*e]=E.x,o[4*e+1]=E.y,o[4*e+2]=E.z,o[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)S(n[e+0]),S(n[e+1]),S(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new ci(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new Dn,i=new Dn,s=new Dn,a=new Dn,o=new Dn,l=new Dn,c=new Dn,u=new Dn;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),f=e.getX(h+1),p=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,f),s.fromBufferAttribute(t,p),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,f),l.fromBufferAttribute(n,p),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,o.x,o.y,o.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)yi.fromBufferAttribute(e,t),yi.normalize(),e.setXYZ(t,yi.x,yi.y,yi.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,s=new n.constructor(t.length*r);let a=0,o=0;for(let i=0,l=t.length;i<l;i++){a=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)s[o++]=n[a++]}return new ci(s,r,i)}if(null===this.index)return this;const t=new Ei,n=this.index.array,r=this.attributes;for(const i in r){const s=e(r[i],n);t.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],a=i[r];for(let t=0,r=a.length;t<r;t++){const r=e(a[t],n);s.push(r)}t.morphAttributes[r]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];s.push(r.toJSON(e.data))}s.length>0&&(r[t]=s,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _i=new cr,xi=new lr,bi=new er,Si=new Dn,wi=new Dn,Ci=new Dn,Ti=new Dn,Mi=new Dn,Ii=new Dn,Ri=new nn,Bi=new nn,Pi=new nn,Di=new Dn,Li=new Dn,ki=new Dn,Fi=new Dn,Oi=new Dn;class Ui extends Lr{constructor(e=new Ei,t=new ti){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(i&&a){Ii.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=a[n],o=i[n];0!==r&&(Mi.fromBufferAttribute(o,e),s?Ii.addScaledVector(Mi,r):Ii.addScaledVector(Mi.sub(t),r))}t.add(Ii)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),bi.copy(n.boundingSphere),bi.applyMatrix4(i),xi.copy(e.ray).recast(e.near),!1===bi.containsPoint(xi.origin)){if(null===xi.intersectSphere(bi,Si))return;if(xi.origin.distanceToSquared(Si)>(e.far-e.near)**2)return}_i.copy(i).invert(),xi.copy(e.ray).applyMatrix4(_i),null!==n.boundingBox&&!1===xi.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,xi)}}_computeIntersections(e,t,n){let r;const i=this.geometry,s=this.material,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,h=i.groups,d=i.drawRange;if(null!==a)if(Array.isArray(s))for(let i=0,o=h.length;i<o;i++){const o=h[i],f=s[o.materialIndex];for(let i=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));i<s;i+=3){r=Ni(this,f,e,n,l,c,u,a.getX(i),a.getX(i+1),a.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,t.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);i<o;i+=3){r=Ni(this,s,e,n,l,c,u,a.getX(i),a.getX(i+1),a.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}else if(void 0!==o)if(Array.isArray(s))for(let i=0,a=h.length;i<a;i++){const a=h[i],f=s[a.materialIndex];for(let i=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));i<s;i+=3){r=Ni(this,f,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,t.push(r))}}else{for(let i=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);i<a;i+=3){r=Ni(this,s,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}}}function Ni(e,t,n,r,i,s,a,o,l,c){e.getVertexPosition(o,wi),e.getVertexPosition(l,Ci),e.getVertexPosition(c,Ti);const u=function(e,t,n,r,i,s,a,o){let l;if(l=1===t.side?r.intersectTriangle(a,s,i,!0,o):r.intersectTriangle(i,s,a,0===t.side,o),null===l)return null;Oi.copy(o),Oi.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Oi);return c<n.near||c>n.far?null:{distance:c,point:Oi.clone(),object:e}}(e,t,n,r,wi,Ci,Ti,Fi);if(u){i&&(Ri.fromBufferAttribute(i,o),Bi.fromBufferAttribute(i,l),Pi.fromBufferAttribute(i,c),u.uv=Wr.getInterpolation(Fi,wi,Ci,Ti,Ri,Bi,Pi,new nn)),s&&(Ri.fromBufferAttribute(s,o),Bi.fromBufferAttribute(s,l),Pi.fromBufferAttribute(s,c),u.uv1=Wr.getInterpolation(Fi,wi,Ci,Ti,Ri,Bi,Pi,new nn),u.uv2=u.uv1),a&&(Di.fromBufferAttribute(a,o),Li.fromBufferAttribute(a,l),ki.fromBufferAttribute(a,c),u.normal=Wr.getInterpolation(Fi,wi,Ci,Ti,Di,Li,ki,new Dn),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const e={a:o,b:l,c:c,normal:new Dn,materialIndex:0};Wr.getNormal(wi,Ci,Ti,e.normal),u.face=e}return u}class zi extends Ei{constructor(e=1,t=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const a=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const o=[],l=[],c=[],u=[];let h=0,d=0;function f(e,t,n,r,i,s,f,p,m,g,A){const v=s/m,y=f/g,E=s/2,_=f/2,x=p/2,b=m+1,S=g+1;let w=0,C=0;const T=new Dn;for(let s=0;s<S;s++){const a=s*y-_;for(let o=0;o<b;o++){const h=o*v-E;T[e]=h*r,T[t]=a*i,T[n]=x,l.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=p>0?1:-1,c.push(T.x,T.y,T.z),u.push(o/m),u.push(1-s/g),w+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+b*e,r=h+t+b*(e+1),i=h+(t+1)+b*(e+1),s=h+(t+1)+b*e;o.push(n,r,s),o.push(r,i,s),C+=6}a.addGroup(d,C,A),d+=C,h+=w}f("z","y","x",-1,-1,n,t,e,s,i,0),f("z","y","x",1,-1,n,t,-e,s,i,1),f("x","z","y",1,1,e,n,t,r,s,2),f("x","z","y",1,-1,e,n,-t,r,s,3),f("x","y","z",1,-1,e,t,n,r,i,4),f("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(o),this.setAttribute("position",new di(l,3)),this.setAttribute("normal",new di(c,3)),this.setAttribute("uv",new di(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zi(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Gi(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?t[n][r]=null:t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Qi(e){const t={};for(let n=0;n<e.length;n++){const r=Gi(e[n]);for(const e in r)t[e]=r[e]}return t}function Hi(e){return null===e.getRenderTarget()?e.outputColorSpace:An.workingColorSpace}const Vi={clone:Gi,merge:Qi};class ji extends ei{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Gi(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Wi extends Lr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new cr,this.projectionMatrix=new cr,this.projectionMatrixInverse=new cr,this.coordinateSystem=Nt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Yi extends Wi{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*jt*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Vt*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*jt*Math.atan(Math.tan(.5*Vt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Vt*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;i+=s.offsetX*r/e,t-=s.offsetY*n/a,r*=s.width/e,n*=s.height/a}const a=this.filmOffset;0!==a&&(i+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ki=-90;class qi extends Lr{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Yi(Ki,1,e,t);r.layers=this.layers,this.add(r);const i=new Yi(Ki,1,e,t);i.layers=this.layers,this.add(i);const s=new Yi(Ki,1,e,t);s.layers=this.layers,this.add(s);const a=new Yi(Ki,1,e,t);a.layers=this.layers,this.add(a);const o=new Yi(Ki,1,e,t);o.layers=this.layers,this.add(o);const l=new Yi(Ki,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,s,a,o]=t;for(const e of t)this.remove(e);if(e===Nt)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==zt)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,s,a,o,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,s),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,o),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=p,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}class Xi extends Cn{constructor(e,t,n,r,i,s,a,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:Y,n,r,i,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class $i extends In{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];void 0!==t.encoding&&(dn("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===ft?gt:mt),this.texture=new Xi(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ie}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new zi(5,5,5),i=new ji({name:"CubemapFromEquirect",uniforms:Gi(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;const s=new Ui(r,i),a=t.minFilter;t.minFilter===ae&&(t.minFilter=ie);return new qi(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}const Ji=new Dn,Zi=new Dn,es=new rn;class ts{constructor(e=new Dn(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Ji.subVectors(n,t).cross(Zi.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Ji),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||es.getNormalMatrix(e),r=this.coplanarPoint(Ji).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const ns=new er,rs=new Dn;class is{constructor(e=new ts,t=new ts,n=new ts,r=new ts,i=new ts,s=new ts){this.planes=[e,t,n,r,i,s]}set(e,t,n,r,i,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,r=e.elements,i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],f=r[9],p=r[10],m=r[11],g=r[12],A=r[13],v=r[14],y=r[15];if(n[0].setComponents(o-i,h-l,m-d,y-g).normalize(),n[1].setComponents(o+i,h+l,m+d,y+g).normalize(),n[2].setComponents(o+s,h+c,m+f,y+A).normalize(),n[3].setComponents(o-s,h-c,m-f,y-A).normalize(),n[4].setComponents(o-a,h-u,m-p,y-v).normalize(),t===Nt)n[5].setComponents(o+a,h+u,m+p,y+v).normalize();else{if(t!==zt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(a,u,p,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),ns.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),ns.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ns)}intersectsSprite(e){return ns.center.set(0,0,0),ns.radius=.7071067811865476,ns.applyMatrix4(e.matrixWorld),this.intersectsSphere(ns)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(rs.x=r.normal.x>0?e.max.x:e.min.x,rs.y=r.normal.y>0?e.max.y:e.min.y,rs.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(rs)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function ss(){let e=null,t=!1,n=null,r=null;function i(t,s){n(t,s),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function as(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=r.get(t);void 0===s?r.set(t,function(t,r){const i=t.array,s=t.usage,a=e.createBuffer();let o;if(e.bindBuffer(r,a),e.bufferData(r,i,s),t.onUploadCallback(),i instanceof Float32Array)o=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=e.HALF_FLOAT}else o=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)o=e.SHORT;else if(i instanceof Uint32Array)o=e.UNSIGNED_INT;else if(i instanceof Int32Array)o=e.INT;else if(i instanceof Int8Array)o=e.BYTE;else if(i instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):s.version<t.version&&(!function(t,r,i){const s=r.array,a=r.updateRange;e.bindBuffer(i,t),-1===a.count?e.bufferSubData(i,0,s):(n?e.bufferSubData(i,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):e.bufferSubData(i,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1),r.onUploadCallback()}(s.buffer,t,i),s.version=t.version)}}}class os extends Ei{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,s=t/2,a=Math.floor(n),o=Math.floor(r),l=a+1,c=o+1,u=e/a,h=t/o,d=[],f=[],p=[],m=[];for(let e=0;e<c;e++){const t=e*h-s;for(let n=0;n<l;n++){const r=n*u-i;f.push(r,-t,0),p.push(0,0,1),m.push(n/a),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<a;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),s=t+1+l*e;d.push(n,r,s),d.push(r,i,s)}this.setIndex(d),this.setAttribute("position",new di(f,3)),this.setAttribute("normal",new di(p,3)),this.setAttribute("uv",new di(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new os(e.width,e.height,e.widthSegments,e.heightSegments)}}const ls={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},cs={common:{diffuse:{value:new $r(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new rn},alphaMap:{value:null},alphaMapTransform:{value:new rn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new rn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new rn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new rn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new rn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new rn},normalScale:{value:new nn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new rn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new rn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new rn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new rn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $r(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $r(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new rn},alphaTest:{value:0},uvTransform:{value:new rn}},sprite:{diffuse:{value:new $r(16777215)},opacity:{value:1},center:{value:new nn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new rn},alphaMap:{value:null},alphaMapTransform:{value:new rn},alphaTest:{value:0}}},us={basic:{uniforms:Qi([cs.common,cs.specularmap,cs.envmap,cs.aomap,cs.lightmap,cs.fog]),vertexShader:ls.meshbasic_vert,fragmentShader:ls.meshbasic_frag},lambert:{uniforms:Qi([cs.common,cs.specularmap,cs.envmap,cs.aomap,cs.lightmap,cs.emissivemap,cs.bumpmap,cs.normalmap,cs.displacementmap,cs.fog,cs.lights,{emissive:{value:new $r(0)}}]),vertexShader:ls.meshlambert_vert,fragmentShader:ls.meshlambert_frag},phong:{uniforms:Qi([cs.common,cs.specularmap,cs.envmap,cs.aomap,cs.lightmap,cs.emissivemap,cs.bumpmap,cs.normalmap,cs.displacementmap,cs.fog,cs.lights,{emissive:{value:new $r(0)},specular:{value:new $r(1118481)},shininess:{value:30}}]),vertexShader:ls.meshphong_vert,fragmentShader:ls.meshphong_frag},standard:{uniforms:Qi([cs.common,cs.envmap,cs.aomap,cs.lightmap,cs.emissivemap,cs.bumpmap,cs.normalmap,cs.displacementmap,cs.roughnessmap,cs.metalnessmap,cs.fog,cs.lights,{emissive:{value:new $r(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ls.meshphysical_vert,fragmentShader:ls.meshphysical_frag},toon:{uniforms:Qi([cs.common,cs.aomap,cs.lightmap,cs.emissivemap,cs.bumpmap,cs.normalmap,cs.displacementmap,cs.gradientmap,cs.fog,cs.lights,{emissive:{value:new $r(0)}}]),vertexShader:ls.meshtoon_vert,fragmentShader:ls.meshtoon_frag},matcap:{uniforms:Qi([cs.common,cs.bumpmap,cs.normalmap,cs.displacementmap,cs.fog,{matcap:{value:null}}]),vertexShader:ls.meshmatcap_vert,fragmentShader:ls.meshmatcap_frag},points:{uniforms:Qi([cs.points,cs.fog]),vertexShader:ls.points_vert,fragmentShader:ls.points_frag},dashed:{uniforms:Qi([cs.common,cs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ls.linedashed_vert,fragmentShader:ls.linedashed_frag},depth:{uniforms:Qi([cs.common,cs.displacementmap]),vertexShader:ls.depth_vert,fragmentShader:ls.depth_frag},normal:{uniforms:Qi([cs.common,cs.bumpmap,cs.normalmap,cs.displacementmap,{opacity:{value:1}}]),vertexShader:ls.meshnormal_vert,fragmentShader:ls.meshnormal_frag},sprite:{uniforms:Qi([cs.sprite,cs.fog]),vertexShader:ls.sprite_vert,fragmentShader:ls.sprite_frag},background:{uniforms:{uvTransform:{value:new rn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ls.background_vert,fragmentShader:ls.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ls.backgroundCube_vert,fragmentShader:ls.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ls.cube_vert,fragmentShader:ls.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ls.equirect_vert,fragmentShader:ls.equirect_frag},distanceRGBA:{uniforms:Qi([cs.common,cs.displacementmap,{referencePosition:{value:new Dn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ls.distanceRGBA_vert,fragmentShader:ls.distanceRGBA_frag},shadow:{uniforms:Qi([cs.lights,cs.fog,{color:{value:new $r(0)},opacity:{value:1}}]),vertexShader:ls.shadow_vert,fragmentShader:ls.shadow_frag}};us.physical={uniforms:Qi([us.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new rn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new rn},clearcoatNormalScale:{value:new nn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new rn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new rn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new rn},sheen:{value:0},sheenColor:{value:new $r(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new rn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new rn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new rn},transmissionSamplerSize:{value:new nn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new rn},attenuationDistance:{value:0},attenuationColor:{value:new $r(0)},specularColor:{value:new $r(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new rn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new rn},anisotropyVector:{value:new nn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new rn}}]),vertexShader:ls.meshphysical_vert,fragmentShader:ls.meshphysical_frag};const hs={r:0,b:0,g:0};function ds(e,t,n,r,i,s,a){const o=new $r(0);let l,c,u=!0===s?0:1,h=null,d=0,f=null;function p(t,n){t.getRGB(hs,Hi(e)),r.buffers.color.setClear(hs.r,hs.g,hs.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),u=t,p(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,p(o,u)},render:function(s,m){let g=!1,A=!0===m.isScene?m.background:null;if(A&&A.isTexture){A=(m.backgroundBlurriness>0?n:t).get(A)}null===A?p(o,u):A&&A.isColor&&(p(A,1),g=!0);const v=e.xr.getEnvironmentBlendMode();"additive"===v?r.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===v&&r.buffers.color.setClear(0,0,0,0,a),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),A&&(A.isCubeTexture||A.mapping===$)?(void 0===c&&(c=new Ui(new zi(1,1,1),new ji({name:"BackgroundCubeMaterial",uniforms:Gi(us.backgroundCube.uniforms),vertexShader:us.backgroundCube.vertexShader,fragmentShader:us.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),c.material.uniforms.envMap.value=A,c.material.uniforms.flipEnvMap.value=A.isCubeTexture&&!1===A.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=An.getTransfer(A.colorSpace)!==_t,h===A&&d===A.version&&f===e.toneMapping||(c.material.needsUpdate=!0,h=A,d=A.version,f=e.toneMapping),c.layers.enableAll(),s.unshift(c,c.geometry,c.material,0,0,null)):A&&A.isTexture&&(void 0===l&&(l=new Ui(new os(2,2),new ji({name:"BackgroundMaterial",uniforms:Gi(us.background.uniforms),vertexShader:us.background.vertexShader,fragmentShader:us.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=A,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=An.getTransfer(A.colorSpace)!==_t,!0===A.matrixAutoUpdate&&A.updateMatrix(),l.material.uniforms.uvTransform.value.copy(A.matrix),h===A&&d===A.version&&f===e.toneMapping||(l.material.needsUpdate=!0,h=A,d=A.version,f=e.toneMapping),l.layers.enableAll(),s.unshift(l,l.geometry,l.material,0,0,null))}}}function fs(e,t,n,r){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||null!==s,o={},l=f(null);let c=l,u=!1;function h(t){return r.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function d(t){return r.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function f(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,i){const s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;if(s[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),o[n]!==i){(r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),o[n]=i}}function A(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function v(t,n,r,i,s,a,o){!0===o?e.vertexAttribIPointer(t,n,r,s,a):e.vertexAttribPointer(t,n,r,i,s,a)}function y(){E(),u=!0,c!==l&&(c=l,h(c.object))}function E(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,d,y,E){let _=!1;if(a){const t=function(t,n,i){const a=!0===i.wireframe;let l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[a];void 0===u&&(u=f(r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[a]=u);return u}(y,d,l);c!==t&&(c=t,h(c.object)),_=function(e,t,n,r){const i=c.attributes,s=t.attributes;let a=0;const o=n.getAttributes();for(const t in o){if(o[t].location>=0){const n=i[t];let r=s[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0;if(r&&n.data!==r.data)return!0;a++}}return c.attributesNum!==a||c.index!==r}(i,y,d,E),_&&function(e,t,n,r){const i={},s=t.attributes;let a=0;const o=n.getAttributes();for(const t in o){if(o[t].location>=0){let n=s[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[t]=r,a++}}c.attributes=i,c.attributesNum=a,c.index=r}(i,y,d,E)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===e||(c.geometry=y.id,c.program=d.id,c.wireframe=e,_=!0)}null!==E&&n.update(E,e.ELEMENT_ARRAY_BUFFER),(_||u)&&(u=!1,function(i,s,a,o){if(!1===r.isWebGL2&&(i.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=o.attributes,c=a.getAttributes(),u=s.defaultAttributeValues;for(const t in c){const s=c[t];if(s.location>=0){let a=l[t];if(void 0===a&&("instanceMatrix"===t&&i.instanceMatrix&&(a=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(a=i.instanceColor)),void 0!==a){const t=a.normalized,l=a.itemSize,c=n.get(a);if(void 0===c)continue;const u=c.buffer,h=c.type,d=c.bytesPerElement,f=!0===r.isWebGL2&&(h===e.INT||h===e.UNSIGNED_INT||a.gpuType===de);if(a.isInterleavedBufferAttribute){const n=a.data,r=n.stride,c=a.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<s.locationSize;e++)g(s.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)v(s.location+e,l/s.locationSize,h,t,r*d,(c+l/s.locationSize*e)*d,f)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<s.locationSize;e++)g(s.location+e,a.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<s.locationSize;e++)v(s.location+e,l/s.locationSize,h,t,l*d,l/s.locationSize*e*d,f)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(s.location,n);break;case 3:e.vertexAttrib3fv(s.location,n);break;case 4:e.vertexAttrib4fv(s.location,n);break;default:e.vertexAttrib1fv(s.location,n)}}}}A()}(i,l,d,y),null!==E&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(E).buffer))},reset:y,resetDefaultState:E,dispose:function(){y();for(const e in o){const t=o[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;const t=o[e.id];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(const t in o){const n=o[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)d(r[e].object),delete r[e];delete n[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:A}}function ps(e,t,n,r){const i=r.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,r){e.drawArrays(s,t,r),n.update(r,s,1)},this.renderInstances=function(r,a,o){if(0===o)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return;l[c](s,r,a,o),n.update(a,s,o)}}function ms(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let a=void 0!==n.precision?n.precision:"highp";const o=i(a);o!==a&&(a=o);const l=s||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),A=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=h>0,y=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:A,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:s?e.getParameter(e.MAX_SAMPLES):0}}function gs(e){const t=this;let n=null,r=0,i=!1,s=!1;const a=new ts,o=new rn,l={value:null,needsUpdate:!1};function c(e,n,r,i){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==i||null===c){const t=r+4*s,i=n.matrixWorldInverse;o.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==s;++t,n+=4)a.copy(e[t]).applyMatrix4(i,o),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(a,o,u){const h=a.clippingPlanes,d=a.clipIntersection,f=a.clipShadows,p=e.get(a);if(!i||null===h||0===h.length||s&&!f)s?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{const e=s?0:r,t=4*e;let i=p.clippingState||null;l.value=i,i=c(h,o,t,u);for(let e=0;e!==t;++e)i[e]=n[e];p.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function As(e){let t=new WeakMap;function n(e,t){return t===q?e.mapping=Y:t===X&&(e.mapping=K),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const s=i.mapping;if(s===q||s===X){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const s=i.image;if(s&&s.height>0){const a=new $i(s.height/2);return a.fromEquirectangularTexture(e,i),t.set(i,a),i.addEventListener("dispose",r),n(a.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class vs extends Wi{constructor(e=-1,t=1,n=1,r=-1,i=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,s=n+e,a=r+t,o=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,s=i+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(i,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const ys=[.125,.215,.35,.446,.526,.582],Es=20,_s=new vs,xs=new $r;let bs=null,Ss=0,ws=0;const Cs=(1+Math.sqrt(5))/2,Ts=1/Cs,Ms=[new Dn(1,1,1),new Dn(-1,1,1),new Dn(1,1,-1),new Dn(-1,1,-1),new Dn(0,Cs,Ts),new Dn(0,Cs,-Ts),new Dn(Ts,0,Cs),new Dn(-Ts,0,Cs),new Dn(Cs,Ts,0),new Dn(-Cs,Ts,0)];class Is{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){bs=this._renderer.getRenderTarget(),Ss=this._renderer.getActiveCubeFace(),ws=this._renderer.getActiveMipmapLevel(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Ds(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Ps(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(bs,Ss,ws),e.scissorTest=!1,Bs(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Y||e.mapping===K?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),bs=this._renderer.getRenderTarget(),Ss=this._renderer.getActiveCubeFace(),ws=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ie,minFilter:ie,generateMipmaps:!1,type:me,format:ye,colorSpace:At,depthBuffer:!1},r=Rs(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Rs(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const s=e-4+1+ys.length;for(let a=0;a<s;a++){const s=Math.pow(2,i);n.push(s);let o=1/s;a>e-4?o=ys[a-e+4-1]:0===a&&(o=0),r.push(o);const l=1/(s-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,f=6,p=3,m=2,g=1,A=new Float32Array(p*f*d),v=new Float32Array(m*f*d),y=new Float32Array(g*f*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];A.set(r,p*f*e),v.set(h,m*f*e);const i=[e,e,e,e,e,e];y.set(i,g*f*e)}const E=new Ei;E.setAttribute("position",new ci(A,p)),E.setAttribute("uv",new ci(v,m)),E.setAttribute("faceIndex",new ci(y,g)),t.push(E),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(Es),i=new Dn(0,1,0),s=new ji({name:"SphericalGaussianBlur",defines:{n:Es,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Ls(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(r,e,t)}return r}_compileMaterial(e){const t=new Ui(this._lodPlanes[0],e);this._renderer.compile(t,_s)}_sceneToCubeUV(e,t,n,r){const i=new Yi(90,1,t,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(xs),o.toneMapping=0,o.autoClear=!1;const u=new ti({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new Ui(new zi,u);let d=!1;const f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,d=!0):(u.color.copy(xs),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(i.up.set(0,s[t],0),i.lookAt(a[t],0,0)):1===n?(i.up.set(0,0,s[t]),i.lookAt(0,a[t],0)):(i.up.set(0,s[t],0),i.lookAt(0,0,a[t]));const l=this._cubeSize;Bs(r,n*l,t>2?l:0,l,l),o.setRenderTarget(r),d&&o.render(h,i),o.render(e,i)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=f}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===Y||e.mapping===K;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Ds()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ps());const i=r?this._cubemapMaterial:this._equirectMaterial,s=new Ui(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const a=this._cubeSize;Bs(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(s,_s)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=Ms[(t-1)%Ms.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,r,"latitudinal",i),this._halfBlur(s,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,s,a){const o=this._renderer,l=this._blurMaterial,c=new Ui(this._lodPlanes[r],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,f=i/d,p=isFinite(i)?1+Math.floor(3*f):Es,m=[];let g=0;for(let e=0;e<Es;++e){const t=e/f,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<p&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=p,u.weights.value=m,u.latitudinal.value="latitudinal"===s,a&&(u.poleAxis.value=a);const{_lodMax:A}=this;u.dTheta.value=d,u.mipInt.value=A-n;const v=this._sizeLods[r];Bs(t,3*v*(r>A-4?r-A+4:0),4*(this._cubeSize-v),3*v,2*v),o.setRenderTarget(t),o.render(c,_s)}}function Rs(e,t,n){const r=new In(e,t,n);return r.texture.mapping=$,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Bs(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Ps(){return new ji({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Ls(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Ds(){return new ji({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Ls(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Ls(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function ks(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping,a=s===q||s===X,o=s===Y||s===K;if(a||o){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=t.get(i);return null===n&&(n=new Is(e)),r=a?n.fromEquirectangular(i,r):n.fromCubemap(i,r),t.set(i,r),r.texture}if(t.has(i))return t.get(i).texture;{const s=i.image;if(a&&s&&s.height>0||o&&s&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(s)){null===n&&(n=new Is(e));const s=a?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,s),i.addEventListener("dispose",r),s.texture}return null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Fs(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return t}}}function Os(e,t,n,r){const i={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);for(const e in o.morphAttributes){const n=o.morphAttributes[e];for(let e=0,r=n.length;e<r;e++)t.remove(n[e])}o.removeEventListener("dispose",a),delete i[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),r.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],r=e.index,i=e.attributes.position;let a=0;if(null!==r){const e=r.array;a=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],s=e[t+2];n.push(r,i,i,s,s,r)}}else{if(void 0===i)return;{const e=i.array;a=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const o=new(an(n)?hi:ui)(n,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",a),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const n in r)t.update(r[n],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return s.get(e)}}}function Us(e,t,n,r){const i=r.isWebGL2;let s,a,o;this.setMode=function(e){s=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(s,r,a,t*o),n.update(r,s,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return;u[h](s,l,a,r*o,c),n.update(l,s,c)}}function Ns(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n}}}}function zs(e,t){return e[0]-t[0]}function Gs(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Qs(e,t,n){const r={},i=new Float32Array(8),s=new WeakMap,a=new Tn,o=[];for(let e=0;e<8;e++)o[e]=[e,0];return{update:function(l,c,u){const h=l.morphTargetInfluences;if(!0===t.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,f=void 0!==d?d.length:0;let p=s.get(c);if(void 0===p||p.count!==f){void 0!==p&&p.texture.dispose();const A=void 0!==c.morphAttributes.position,v=void 0!==c.morphAttributes.normal,y=void 0!==c.morphAttributes.color,E=c.morphAttributes.position||[],_=c.morphAttributes.normal||[],x=c.morphAttributes.color||[];let b=0;!0===A&&(b=1),!0===v&&(b=2),!0===y&&(b=3);let S=c.attributes.position.count*b,w=1;S>t.maxTextureSize&&(w=Math.ceil(S/t.maxTextureSize),S=t.maxTextureSize);const C=new Float32Array(S*w*4*f),T=new Rn(C,S,w,f);T.type=pe,T.needsUpdate=!0;const M=4*b;for(let R=0;R<f;R++){const B=E[R],P=_[R],D=x[R],L=S*w*4*R;for(let k=0;k<B.count;k++){const F=k*M;!0===A&&(a.fromBufferAttribute(B,k),C[L+F+0]=a.x,C[L+F+1]=a.y,C[L+F+2]=a.z,C[L+F+3]=0),!0===v&&(a.fromBufferAttribute(P,k),C[L+F+4]=a.x,C[L+F+5]=a.y,C[L+F+6]=a.z,C[L+F+7]=0),!0===y&&(a.fromBufferAttribute(D,k),C[L+F+8]=a.x,C[L+F+9]=a.y,C[L+F+10]=a.z,C[L+F+11]=4===D.itemSize?a.w:1)}}function I(){T.dispose(),s.delete(c),c.removeEventListener("dispose",I)}p={count:f,texture:T,size:new nn(S,w)},s.set(c,p),c.addEventListener("dispose",I)}let m=0;for(let O=0;O<h.length;O++)m+=h[O];const g=c.morphTargetsRelative?1:1-m;u.getUniforms().setValue(e,"morphTargetBaseInfluence",g),u.getUniforms().setValue(e,"morphTargetInfluences",h),u.getUniforms().setValue(e,"morphTargetsTexture",p.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",p.size)}else{const U=void 0===h?0:h.length;let N=r[c.id];if(void 0===N||N.length!==U){N=[];for(let V=0;V<U;V++)N[V]=[V,0];r[c.id]=N}for(let j=0;j<U;j++){const W=N[j];W[0]=j,W[1]=h[j]}N.sort(Gs);for(let Y=0;Y<8;Y++)Y<U&&N[Y][1]?(o[Y][0]=N[Y][0],o[Y][1]=N[Y][1]):(o[Y][0]=Number.MAX_SAFE_INTEGER,o[Y][1]=0);o.sort(zs);const z=c.morphAttributes.position,G=c.morphAttributes.normal;let Q=0;for(let K=0;K<8;K++){const q=o[K],X=q[0],$=q[1];X!==Number.MAX_SAFE_INTEGER&&$?(z&&c.getAttribute("morphTarget"+K)!==z[X]&&c.setAttribute("morphTarget"+K,z[X]),G&&c.getAttribute("morphNormal"+K)!==G[X]&&c.setAttribute("morphNormal"+K,G[X]),i[K]=$,Q+=$):(z&&!0===c.hasAttribute("morphTarget"+K)&&c.deleteAttribute("morphTarget"+K),G&&!0===c.hasAttribute("morphNormal"+K)&&c.deleteAttribute("morphNormal"+K),i[K]=0)}const H=c.morphTargetsRelative?1:1-Q;u.getUniforms().setValue(e,"morphTargetBaseInfluence",H),u.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function Hs(e,t,n,r){let i=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const o=r.render.frame,l=a.geometry,c=t.get(a,l);if(i.get(c)!==o&&(t.update(c),i.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),i.get(a)!==o&&(n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER),i.set(a,o))),a.isSkinnedMesh){const e=a.skeleton;i.get(e)!==o&&(e.update(),i.set(e,o))}return c},dispose:function(){i=new WeakMap}}}const Vs=new Cn,js=new Rn,Ws=new Bn,Ys=new Xi,Ks=[],qs=[],Xs=new Float32Array(16),$s=new Float32Array(9),Js=new Float32Array(4);function Zs(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let s=Ks[i];if(void 0===s&&(s=new Float32Array(i),Ks[i]=s),0!==t){r.toArray(s,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(s,i)}return s}function ea(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function ta(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function na(e,t){let n=qs[t];void 0===n&&(n=new Int32Array(t),qs[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function ra(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function ia(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ea(n,t))return;e.uniform2fv(this.addr,t),ta(n,t)}}function sa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ea(n,t))return;e.uniform3fv(this.addr,t),ta(n,t)}}function aa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ea(n,t))return;e.uniform4fv(this.addr,t),ta(n,t)}}function oa(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ea(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ta(n,t)}else{if(ea(n,r))return;Js.set(r),e.uniformMatrix2fv(this.addr,!1,Js),ta(n,r)}}function la(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ea(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ta(n,t)}else{if(ea(n,r))return;$s.set(r),e.uniformMatrix3fv(this.addr,!1,$s),ta(n,r)}}function ca(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ea(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ta(n,t)}else{if(ea(n,r))return;Xs.set(r),e.uniformMatrix4fv(this.addr,!1,Xs),ta(n,r)}}function ua(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ha(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ea(n,t))return;e.uniform2iv(this.addr,t),ta(n,t)}}function da(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ea(n,t))return;e.uniform3iv(this.addr,t),ta(n,t)}}function fa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ea(n,t))return;e.uniform4iv(this.addr,t),ta(n,t)}}function pa(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function ma(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ea(n,t))return;e.uniform2uiv(this.addr,t),ta(n,t)}}function ga(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ea(n,t))return;e.uniform3uiv(this.addr,t),ta(n,t)}}function Aa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ea(n,t))return;e.uniform4uiv(this.addr,t),ta(n,t)}}function va(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||Vs,i)}function ya(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Ws,i)}function Ea(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Ys,i)}function _a(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||js,i)}function xa(e,t){e.uniform1fv(this.addr,t)}function ba(e,t){const n=Zs(t,this.size,2);e.uniform2fv(this.addr,n)}function Sa(e,t){const n=Zs(t,this.size,3);e.uniform3fv(this.addr,n)}function wa(e,t){const n=Zs(t,this.size,4);e.uniform4fv(this.addr,n)}function Ca(e,t){const n=Zs(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ta(e,t){const n=Zs(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Ma(e,t){const n=Zs(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ia(e,t){e.uniform1iv(this.addr,t)}function Ra(e,t){e.uniform2iv(this.addr,t)}function Ba(e,t){e.uniform3iv(this.addr,t)}function Pa(e,t){e.uniform4iv(this.addr,t)}function Da(e,t){e.uniform1uiv(this.addr,t)}function La(e,t){e.uniform2uiv(this.addr,t)}function ka(e,t){e.uniform3uiv(this.addr,t)}function Fa(e,t){e.uniform4uiv(this.addr,t)}function Oa(e,t,n){const r=this.cache,i=t.length,s=na(n,i);ea(r,s)||(e.uniform1iv(this.addr,s),ta(r,s));for(let e=0;e!==i;++e)n.setTexture2D(t[e]||Vs,s[e])}function Ua(e,t,n){const r=this.cache,i=t.length,s=na(n,i);ea(r,s)||(e.uniform1iv(this.addr,s),ta(r,s));for(let e=0;e!==i;++e)n.setTexture3D(t[e]||Ws,s[e])}function Na(e,t,n){const r=this.cache,i=t.length,s=na(n,i);ea(r,s)||(e.uniform1iv(this.addr,s),ta(r,s));for(let e=0;e!==i;++e)n.setTextureCube(t[e]||Ys,s[e])}function za(e,t,n){const r=this.cache,i=t.length,s=na(n,i);ea(r,s)||(e.uniform1iv(this.addr,s),ta(r,s));for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||js,s[e])}class Ga{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ra;case 35664:return ia;case 35665:return sa;case 35666:return aa;case 35674:return oa;case 35675:return la;case 35676:return ca;case 5124:case 35670:return ua;case 35667:case 35671:return ha;case 35668:case 35672:return da;case 35669:case 35673:return fa;case 5125:return pa;case 36294:return ma;case 36295:return ga;case 36296:return Aa;case 35678:case 36198:case 36298:case 36306:case 35682:return va;case 35679:case 36299:case 36307:return ya;case 35680:case 36300:case 36308:case 36293:return Ea;case 36289:case 36303:case 36311:case 36292:return _a}}(t.type)}}class Qa{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return xa;case 35664:return ba;case 35665:return Sa;case 35666:return wa;case 35674:return Ca;case 35675:return Ta;case 35676:return Ma;case 5124:case 35670:return Ia;case 35667:case 35671:return Ra;case 35668:case 35672:return Ba;case 35669:case 35673:return Pa;case 5125:return Da;case 36294:return La;case 36295:return ka;case 36296:return Fa;case 35678:case 36198:case 36298:case 36306:case 35682:return Oa;case 35679:case 36299:case 36307:return Ua;case 35680:case 36300:case 36308:case 36293:return Na;case 36289:case 36303:case 36311:case 36292:return za}}(t.type)}}class Ha{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(e,t[s.id],n)}}}const Va=/(\w+)(\])?(\[|\.)?/g;function ja(e,t){e.seq.push(t),e.map[t.id]=t}function Wa(e,t,n){const r=e.name,i=r.length;for(Va.lastIndex=0;;){const s=Va.exec(r),a=Va.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===i){ja(n,void 0===c?new Ga(o,e,t):new Qa(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new Ha(o),ja(n,e)),n=e}}}class Ya{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);Wa(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,s=t.length;i!==s;++i){const s=t[i],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function Ka(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let qa=0;function Xa(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let e=i;e<s;e++){const i=e+1;r.push(`${i===t?">":" "} ${i}: ${n[e]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function $a(e,t){const n=function(e){const t=An.getPrimaries(An.workingColorSpace),n=An.getPrimaries(e);let r;switch(t===n?r="":t===bt&&n===xt?r="LinearDisplayP3ToLinearSRGB":t===xt&&n===bt&&(r="LinearSRGBToLinearDisplayP3"),e){case At:case yt:return[r,"LinearTransferOETF"];case gt:case vt:return[r,"sRGBTransferOETF"];default:return[r,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function Ja(e,t){let n;switch(t){case 1:default:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Za(e){return""!==e}function eo(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function to(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const no=/^[ \t]*#include +<([\w\d./]+)>/gm;function ro(e){return e.replace(no,so)}const io=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function so(e,t){let n=ls[t];if(void 0===n){const e=io.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=ls[e]}return ro(n)}const ao=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function oo(e){return e.replace(ao,lo)}function lo(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function co(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function uo(e,t,n,r){const i=e.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Y:case K:t="ENVMAP_TYPE_CUBE";break;case $:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===K&&(t="ENVMAP_MODE_REFRACTION");return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),f=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Za).join("\n")}(n),p=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),m=i.createProgram();let g,A,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(Za).join("\n"),g.length>0&&(g+="\n"),A=[f,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(Za).join("\n"),A.length>0&&(A+="\n")):(g=[co(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Za).join("\n"),A=[f,co(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?ls.tonemapping_pars_fragment:"",0!==n.toneMapping?Ja("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",ls.colorspace_pars_fragment,$a("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Za).join("\n")),a=ro(a),a=eo(a,n),a=to(a,n),o=ro(o),o=eo(o,n),o=to(o,n),a=oo(a),o=oo(o),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,A=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===Ot?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Ot?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+A);const y=v+g+a,E=v+A+o,_=Ka(i,i.VERTEX_SHADER,y),x=Ka(i,i.FRAGMENT_SHADER,E);function b(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(m).trim(),r=i.getShaderInfoLog(_).trim(),s=i.getShaderInfoLog(x).trim();let a=!0,o=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(a=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,m,_,x);else{Xa(i,_,"vertex"),Xa(i,x,"fragment")}else""!==n||""!==r&&""!==s||(o=!1);o&&(t.diagnostics={runnable:a,programLog:n,vertexShader:{log:r,prefix:g},fragmentShader:{log:s,prefix:A}})}i.deleteShader(_),i.deleteShader(x),S=new Ya(i,m),w=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),s=r.name;let a=1;r.type===e.FLOAT_MAT2&&(a=2),r.type===e.FLOAT_MAT3&&(a=3),r.type===e.FLOAT_MAT4&&(a=4),n[s]={type:r.type,location:e.getAttribLocation(t,s),locationSize:a}}return n}(i,m)}let S,w;i.attachShader(m,_),i.attachShader(m,x),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===S&&b(this),S},this.getAttributes=function(){return void 0===w&&b(this),w};let C=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===C&&(C=i.getProgramParameter(m,37297)),C},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=qa++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=x,this}let ho=0;class fo{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(r)&&(s.add(r),r.usedTimes++),!1===s.has(i)&&(s.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new po(e),t.set(e,n)),n}}class po{constructor(e){this.id=ho++,this.code=e,this.usedTimes=0}}function mo(e,t,n,r,i,s,a){const o=new Er,l=new fo,c=[],u=i.isWebGL2,h=i.logarithmicDepthBuffer,d=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(s,o,c,g,A){const v=g.fog,y=A.geometry,E=s.isMeshStandardMaterial?g.environment:null,_=(s.isMeshStandardMaterial?n:t).get(s.envMap||E),x=_&&_.mapping===$?_.image.height:null,b=p[s.type];null!==s.precision&&(f=i.getMaxPrecision(s.precision),s.precision);const S=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,w=void 0!==S?S.length:0;let C,T,M,I,R=0;if(void 0!==y.morphAttributes.position&&(R=1),void 0!==y.morphAttributes.normal&&(R=2),void 0!==y.morphAttributes.color&&(R=3),b){const e=us[b];C=e.vertexShader,T=e.fragmentShader}else C=s.vertexShader,T=s.fragmentShader,l.update(s),M=l.getVertexShaderID(s),I=l.getFragmentShaderID(s);const B=e.getRenderTarget(),P=!0===A.isInstancedMesh,D=!!s.map,L=!!s.matcap,k=!!_,F=!!s.aoMap,O=!!s.lightMap,U=!!s.bumpMap,N=!!s.normalMap,z=!!s.displacementMap,G=!!s.emissiveMap,Q=!!s.metalnessMap,H=!!s.roughnessMap,V=s.anisotropy>0,j=s.clearcoat>0,W=s.iridescence>0,Y=s.sheen>0,K=s.transmission>0,q=V&&!!s.anisotropyMap,X=j&&!!s.clearcoatMap,J=j&&!!s.clearcoatNormalMap,Z=j&&!!s.clearcoatRoughnessMap,ee=W&&!!s.iridescenceMap,te=W&&!!s.iridescenceThicknessMap,ne=Y&&!!s.sheenColorMap,re=Y&&!!s.sheenRoughnessMap,ie=!!s.specularMap,se=!!s.specularColorMap,ae=!!s.specularIntensityMap,oe=K&&!!s.transmissionMap,le=K&&!!s.thicknessMap,ce=!!s.gradientMap,ue=!!s.alphaMap,he=s.alphaTest>0,de=!!s.alphaHash,fe=!!s.extensions,pe=!!y.attributes.uv1,me=!!y.attributes.uv2,ge=!!y.attributes.uv3;let Ae=0;return s.toneMapped&&(null!==B&&!0!==B.isXRRenderTarget||(Ae=e.toneMapping)),{isWebGL2:u,shaderID:b,shaderType:s.type,shaderName:s.name,vertexShader:C,fragmentShader:T,defines:s.defines,customVertexShaderID:M,customFragmentShaderID:I,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:f,instancing:P,instancingColor:P&&null!==A.instanceColor,supportsVertexTextures:d,outputColorSpace:null===B?e.outputColorSpace:!0===B.isXRRenderTarget?B.texture.colorSpace:At,map:D,matcap:L,envMap:k,envMapMode:k&&_.mapping,envMapCubeUVHeight:x,aoMap:F,lightMap:O,bumpMap:U,normalMap:N,displacementMap:d&&z,emissiveMap:G,normalMapObjectSpace:N&&1===s.normalMapType,normalMapTangentSpace:N&&0===s.normalMapType,metalnessMap:Q,roughnessMap:H,anisotropy:V,anisotropyMap:q,clearcoat:j,clearcoatMap:X,clearcoatNormalMap:J,clearcoatRoughnessMap:Z,iridescence:W,iridescenceMap:ee,iridescenceThicknessMap:te,sheen:Y,sheenColorMap:ne,sheenRoughnessMap:re,specularMap:ie,specularColorMap:se,specularIntensityMap:ae,transmission:K,transmissionMap:oe,thicknessMap:le,gradientMap:ce,opaque:!1===s.transparent&&1===s.blending,alphaMap:ue,alphaTest:he,alphaHash:de,combine:s.combine,mapUv:D&&m(s.map.channel),aoMapUv:F&&m(s.aoMap.channel),lightMapUv:O&&m(s.lightMap.channel),bumpMapUv:U&&m(s.bumpMap.channel),normalMapUv:N&&m(s.normalMap.channel),displacementMapUv:z&&m(s.displacementMap.channel),emissiveMapUv:G&&m(s.emissiveMap.channel),metalnessMapUv:Q&&m(s.metalnessMap.channel),roughnessMapUv:H&&m(s.roughnessMap.channel),anisotropyMapUv:q&&m(s.anisotropyMap.channel),clearcoatMapUv:X&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:J&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Z&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:ee&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:te&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:ne&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:re&&m(s.sheenRoughnessMap.channel),specularMapUv:ie&&m(s.specularMap.channel),specularColorMapUv:se&&m(s.specularColorMap.channel),specularIntensityMapUv:ae&&m(s.specularIntensityMap.channel),transmissionMapUv:oe&&m(s.transmissionMap.channel),thicknessMapUv:le&&m(s.thicknessMap.channel),alphaMapUv:ue&&m(s.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(N||V),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUv1s:pe,vertexUv2s:me,vertexUv3s:ge,pointsUvs:!0===A.isPoints&&!!y.attributes.uv&&(D||ue),fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===A.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:w,morphTextureStride:R,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:Ae,useLegacyLights:e._useLegacyLights,decodeVideoTexture:D&&!0===s.map.isVideoTexture&&An.getTransfer(s.map.colorSpace)===_t,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:fe&&!0===s.extensions.derivatives,extensionFragDepth:fe&&!0===s.extensions.fragDepth,extensionDrawBuffers:fe&&!0===s.extensions.drawBuffers,extensionShaderTextureLOD:fe&&!0===s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0);t.supportsVertexTextures&&o.enable(1);t.instancing&&o.enable(2);t.instancingColor&&o.enable(3);t.matcap&&o.enable(4);t.envMap&&o.enable(5);t.normalMapObjectSpace&&o.enable(6);t.normalMapTangentSpace&&o.enable(7);t.clearcoat&&o.enable(8);t.iridescence&&o.enable(9);t.alphaTest&&o.enable(10);t.vertexColors&&o.enable(11);t.vertexAlphas&&o.enable(12);t.vertexUv1s&&o.enable(13);t.vertexUv2s&&o.enable(14);t.vertexUv3s&&o.enable(15);t.vertexTangents&&o.enable(16);t.anisotropy&&o.enable(17);t.alphaHash&&o.enable(18);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.skinning&&o.enable(4);t.morphTargets&&o.enable(5);t.morphNormals&&o.enable(6);t.morphColors&&o.enable(7);t.premultipliedAlpha&&o.enable(8);t.shadowMapEnabled&&o.enable(9);t.useLegacyLights&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.transmission&&o.enable(15);t.sheen&&o.enable(16);t.opaque&&o.enable(17);t.pointsUvs&&o.enable(18);t.decodeVideoTexture&&o.enable(19);e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=us[t];n=Vi.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new uo(e,n,t,s),c.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function go(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Ao(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function vo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function yo(){const e=[];let t=0;const n=[],r=[],i=[];function s(n,r,i,s,a,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,a,o,l,c){const u=s(e,t,a,o,l,c);a.transmission>0?r.push(u):!0===a.transparent?i.push(u):n.push(u)},unshift:function(e,t,a,o,l,c){const u=s(e,t,a,o,l,c);a.transmission>0?r.unshift(u):!0===a.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Ao),r.length>1&&r.sort(t||vo),i.length>1&&i.sort(t||vo)}}}function Eo(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new yo,e.set(t,[i])):n>=r.length?(i=new yo,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function _o(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Dn,color:new $r};break;case"SpotLight":n={position:new Dn,direction:new Dn,color:new $r,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Dn,color:new $r,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Dn,skyColor:new $r,groundColor:new $r};break;case"RectAreaLight":n={color:new $r,position:new Dn,halfWidth:new Dn,halfHeight:new Dn}}return e[t.id]=n,n}}}let xo=0;function bo(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function So(e,t){const n=new _o,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)i.probe.push(new Dn);const s=new Dn,a=new cr,o=new cr;return{setup:function(s,a){let o=0,l=0,c=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let u=0,h=0,d=0,f=0,p=0,m=0,g=0,A=0,v=0,y=0,E=0;s.sort(bo);const _=!0===a?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],a=t.color,x=t.intensity,b=t.distance,S=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=a.r*x*_,l+=a.g*x*_,c+=a.b*x*_;else if(t.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],x);E++}else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*_),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[u]=n,i.directionalShadowMap[u]=S,i.directionalShadowMatrix[u]=t.shadow.matrix,m++}i.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(x*_),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,i.spot[d]=e;const s=t.shadow;if(t.map&&(i.spotLightMap[v]=t.map,v++,s.updateMatrices(t),t.castShadow&&y++),i.spotLightMatrix[d]=s.matrix,t.castShadow){const e=r.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,i.spotShadow[d]=e,i.spotShadowMap[d]=S,A++}d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(a).multiplyScalar(x),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[f]=e,f++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*_),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[h]=n,i.pointShadowMap[h]=S,i.pointShadowMatrix[h]=t.shadow.matrix,g++}i.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(x*_),e.groundColor.copy(t.groundColor).multiplyScalar(x*_),i.hemi[p]=e,p++}}f>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=cs.LTC_FLOAT_1,i.rectAreaLTC2=cs.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")&&(i.rectAreaLTC1=cs.LTC_HALF_1,i.rectAreaLTC2=cs.LTC_HALF_2)),i.ambient[0]=o,i.ambient[1]=l,i.ambient[2]=c;const x=i.hash;x.directionalLength===u&&x.pointLength===h&&x.spotLength===d&&x.rectAreaLength===f&&x.hemiLength===p&&x.numDirectionalShadows===m&&x.numPointShadows===g&&x.numSpotShadows===A&&x.numSpotMaps===v&&x.numLightProbes===E||(i.directional.length=u,i.spot.length=d,i.rectArea.length=f,i.point.length=h,i.hemi.length=p,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=A,i.spotShadowMap.length=A,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotLightMatrix.length=A+v-y,i.spotLightMap.length=v,i.numSpotLightShadowsWithMaps=y,i.numLightProbes=E,x.directionalLength=u,x.pointLength=h,x.spotLength=d,x.rectAreaLength=f,x.hemiLength=p,x.numDirectionalShadows=m,x.numPointShadows=g,x.numSpotShadows=A,x.numSpotMaps=v,x.numLightProbes=E,i.version=xo++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),o.identity(),a.copy(d.matrixWorld),a.premultiply(h),o.extractRotation(a),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),u++}}},state:i}}function wo(e,t){const n=new So(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Co(e,t){let n=new WeakMap;return{get:function(r,i=0){const s=n.get(r);let a;return void 0===s?(a=new wo(e,t),n.set(r,[a])):i>=s.length?(a=new wo(e,t),s.push(a)):a=s[i],a},dispose:function(){n=new WeakMap}}}class To extends ei{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Mo extends ei{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Io(e,t,n){let r=new is;const i=new nn,s=new nn,a=new Tn,o=new To({depthPacking:pt}),l=new Mo,c={},u=n.maxTextureSize,h={[b]:1,[S]:0,[w]:2},d=new ji({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new nn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new Ei;p.setAttribute("position",new ci(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Ui(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let A=this.type;function v(n,r){const s=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new In(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,s,d,m,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,s,f,m,null)}function y(t,n,r,i){let s=null;const a=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===r.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=s.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=s.clone(),r[t]=i),s=i}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===i?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===r.isPointLight&&!0===s.isMeshDistanceMaterial){e.properties.get(s).light=r}return s}function E(n,i,s,a,o){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=i[c.materialIndex];if(u&&u.visible){const t=y(n,u,a,o);e.renderBufferDirect(s,null,r,t,n,c)}}}else if(i.visible){const t=y(n,i,a,o);e.renderBufferDirect(s,null,r,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)E(l[e],i,s,a,o)}this.render=function(t,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const f=3!==A&&3===this.type,p=3===A&&3!==this.type;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h)continue;if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const m=h.getFrameExtents();if(i.multiply(m),s.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/m.x),i.x=s.x*m.x,h.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/m.y),i.y=s.y*m.y,h.mapSize.y=s.y)),null===h.map||!0===f||!0===p){const e=3!==this.type?{minFilter:te,magFilter:te}:{};null!==h.map&&h.map.dispose(),h.map=new In(i.x,i.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const g=h.getViewportCount();for(let e=0;e<g;e++){const t=h.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(a),h.updateMatrices(c,e),r=h.getFrustum(),E(n,o,h.camera,c,this.type)}!0!==h.isPointLightShadow&&3===this.type&&v(h,o),h.needsUpdate=!1}A=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function Ro(e,t,n){const r=n.isWebGL2;const i=new function(){let t=!1;const n=new Tn;let r=null;const i=new Tn(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,s,a,o){!0===o&&(t*=a,r*=a,s*=a),n.set(t,r,s,a),!1===i.equals(n)&&(e.clearColor(t,r,s,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?ae(e.DEPTH_TEST):oe(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},a=new function(){let t=!1,n=null,r=null,i=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?ae(e.STENCIL_TEST):oe(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&s===a||(e.stencilFunc(t,n,a),r=t,i=n,s=a)},setOp:function(t,n,r){a===t&&o===n&&l===r||(e.stencilOp(t,n,r),a=t,o=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,s=null,a=null,o=null,l=null,c=null}}},o=new WeakMap,l=new WeakMap;let c={},u={},h=new WeakMap,d=[],f=null,p=!1,m=null,g=null,A=null,v=null,y=null,E=null,_=null,x=new $r(0,0,0),b=0,S=!1,w=null,V=null,j=null,W=null,Y=null;const K=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let q=!1,X=0;const $=e.getParameter(e.VERSION);-1!==$.indexOf("WebGL")?(X=parseFloat(/^WebGL (\d)/.exec($)[1]),q=X>=1):-1!==$.indexOf("OpenGL ES")&&(X=parseFloat(/^OpenGL ES (\d)/.exec($)[1]),q=X>=2);let J=null,Z={};const ee=e.getParameter(e.SCISSOR_BOX),te=e.getParameter(e.VIEWPORT),ne=(new Tn).fromArray(ee),re=(new Tn).fromArray(te);function ie(t,n,i,s){const a=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<i;o++)!r||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage3D(n,0,e.RGBA,1,1,s,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}const se={};function ae(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function oe(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}se[e.TEXTURE_2D]=ie(e.TEXTURE_2D,e.TEXTURE_2D,1),se[e.TEXTURE_CUBE_MAP]=ie(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(se[e.TEXTURE_2D_ARRAY]=ie(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),se[e.TEXTURE_3D]=ie(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),i.setClear(0,0,0,1),s.setClear(1),a.setClear(0),ae(e.DEPTH_TEST),s.setFunc(3),he(!1),de(1),ae(e.CULL_FACE),ue(0);const le={[C]:e.FUNC_ADD,[T]:e.FUNC_SUBTRACT,[M]:e.FUNC_REVERSE_SUBTRACT};if(r)le[103]=e.MIN,le[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(le[103]=e.MIN_EXT,le[104]=e.MAX_EXT)}const ce={[I]:e.ZERO,[R]:e.ONE,[B]:e.SRC_COLOR,[D]:e.SRC_ALPHA,[N]:e.SRC_ALPHA_SATURATE,[O]:e.DST_COLOR,[k]:e.DST_ALPHA,[P]:e.ONE_MINUS_SRC_COLOR,[L]:e.ONE_MINUS_SRC_ALPHA,[U]:e.ONE_MINUS_DST_COLOR,[F]:e.ONE_MINUS_DST_ALPHA,[z]:e.CONSTANT_COLOR,[G]:e.ONE_MINUS_CONSTANT_COLOR,[Q]:e.CONSTANT_ALPHA,[H]:e.ONE_MINUS_CONSTANT_ALPHA};function ue(t,n,r,i,s,a,o,l,c,u){if(0!==t){if(!1===p&&(ae(e.BLEND),p=!0),5===t)s=s||n,a=a||r,o=o||i,n===g&&s===y||(e.blendEquationSeparate(le[n],le[s]),g=n,y=s),r===A&&i===v&&a===E&&o===_||(e.blendFuncSeparate(ce[r],ce[i],ce[a],ce[o]),A=r,v=i,E=a,_=o),!1!==l.equals(x)&&c===b||(e.blendColor(l.r,l.g,l.b,c),x.copy(l),b=c),m=t,S=!1;else if(t!==m||u!==S){if(g===C&&y===C||(e.blendEquation(e.FUNC_ADD),g=C,y=C),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR)}A=null,v=null,E=null,_=null,x.set(0,0,0),b=0,m=t,S=u}}else!0===p&&(oe(e.BLEND),p=!1)}function he(t){w!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),w=t)}function de(t){0!==t?(ae(e.CULL_FACE),t!==V&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):oe(e.CULL_FACE),V=t}function fe(t,n,r){t?(ae(e.POLYGON_OFFSET_FILL),W===n&&Y===r||(e.polygonOffset(n,r),W=n,Y=r)):oe(e.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:s,stencil:a},enable:ae,disable:oe,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,r&&(t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(r,i){let s=d,a=!1;if(r)if(s=h.get(i),void 0===s&&(s=[],h.set(i,s)),r.isWebGLMultipleRenderTargets){const t=r.texture;if(s.length!==t.length||s[0]!==e.COLOR_ATTACHMENT0){for(let n=0,r=t.length;n<r;n++)s[n]=e.COLOR_ATTACHMENT0+n;s.length=t.length,a=!0}}else s[0]!==e.COLOR_ATTACHMENT0&&(s[0]=e.COLOR_ATTACHMENT0,a=!0);else s[0]!==e.BACK&&(s[0]=e.BACK,a=!0);a&&(n.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:ue,setMaterial:function(t,n){2===t.side?oe(e.CULL_FACE):ae(e.CULL_FACE);let r=1===t.side;n&&(r=!r),he(r),1===t.blending&&!1===t.transparent?ue(0):ue(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),i.setMask(t.colorWrite);const o=t.stencilWrite;a.setTest(o),o&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),fe(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?ae(e.SAMPLE_ALPHA_TO_COVERAGE):oe(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:he,setCullFace:de,setLineWidth:function(t){t!==j&&(q&&e.lineWidth(t),j=t)},setPolygonOffset:fe,setScissorTest:function(t){t?ae(e.SCISSOR_TEST):oe(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+K-1),J!==t&&(e.activeTexture(t),J=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===J?e.TEXTURE0+K-1:J);let i=Z[r];void 0===i&&(i={type:void 0,texture:void 0},Z[r]=i),i.type===t&&i.texture===n||(J!==r&&(e.activeTexture(r),J=r),e.bindTexture(t,n||se[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=Z[J];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){}},updateUBOMapping:function(t,n){let r=l.get(n);void 0===r&&(r=new WeakMap,l.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=l.get(n).get(t);o.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),o.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){}},scissor:function(t){!1===ne.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ne.copy(t))},viewport:function(t){!1===re.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),re.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===r&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},J=null,Z={},u={},h=new WeakMap,d=[],f=null,p=!1,m=null,g=null,A=null,v=null,y=null,E=null,_=null,x=new $r(0,0,0),b=0,S=!1,w=null,V=null,j=null,W=null,Y=null,ne.set(0,0,e.canvas.width,e.canvas.height),re.set(0,0,e.canvas.width,e.canvas.height),i.reset(),s.reset(),a.reset()}}}function Bo(e,t,n,r,i,s,a){const o=i.isWebGL2,l=(i.maxTextures,i.maxCubemapSize),c=i.maxTextureSize,u=i.maxSamples,h=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,d="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let p;const m=new WeakMap;let g=!1;try{g="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function A(e,t){return g?new OffscreenCanvas(e,t):cn("canvas")}function v(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Jt:Math.floor,s=r(i*e.width),a=r(i*e.height);void 0===p&&(p=A(s,a));const o=n?A(s,a):p;o.width=s,o.height=a;return o.getContext("2d").drawImage(e,0,0,s,a),o}return e}return e}function y(e){return Xt(e.width)&&Xt(e.height)}function E(e,t){return e.generateMipmaps&&t&&e.minFilter!==te&&e.minFilter!==ie}function _(t){e.generateMipmap(t)}function x(n,r,i,s,a=!1){if(!1===o)return r;if(null!==n&&void 0!==e[n])return e[n];let l=r;if(r===e.RED&&(i===e.FLOAT&&(l=e.R32F),i===e.HALF_FLOAT&&(l=e.R16F),i===e.UNSIGNED_BYTE&&(l=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(l=e.R8UI),i===e.UNSIGNED_SHORT&&(l=e.R16UI),i===e.UNSIGNED_INT&&(l=e.R32UI),i===e.BYTE&&(l=e.R8I),i===e.SHORT&&(l=e.R16I),i===e.INT&&(l=e.R32I)),r===e.RG&&(i===e.FLOAT&&(l=e.RG32F),i===e.HALF_FLOAT&&(l=e.RG16F),i===e.UNSIGNED_BYTE&&(l=e.RG8)),r===e.RGBA){const t=a?Et:An.getTransfer(s);i===e.FLOAT&&(l=e.RGBA32F),i===e.HALF_FLOAT&&(l=e.RGBA16F),i===e.UNSIGNED_BYTE&&(l=t===_t?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function b(e,t,n){return!0===E(e,n)||e.isFramebufferTexture&&e.minFilter!==te&&e.minFilter!==ie?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(t){return t===te||t===ne||t===re?e.NEAREST:e.LINEAR}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=m.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&T(e),0===Object.keys(i).length&&m.delete(n)}r.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function C(t){const n=t.target;n.removeEventListener("dispose",C),function(t){const n=t.texture,i=r.get(t),s=r.get(n);void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),a.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(i.__webglFramebuffer[t]))for(let n=0;n<i.__webglFramebuffer[t].length;n++)e.deleteFramebuffer(i.__webglFramebuffer[t][n]);else e.deleteFramebuffer(i.__webglFramebuffer[t]);i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t])}else{if(Array.isArray(i.__webglFramebuffer))for(let t=0;t<i.__webglFramebuffer.length;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let t=0;t<i.__webglColorRenderbuffer.length;t++)i.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(i.__webglColorRenderbuffer[t]);i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),a.memory.textures--),r.remove(n[t])}r.remove(n),r.remove(t)}(n)}function T(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete m.get(i)[n.__cacheKey],a.memory.textures--}let M=0;function I(t,i){const s=r.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e);else if(!1!==e.complete)return void k(s,t,i)}n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+i)}const R={[J]:e.REPEAT,[Z]:e.CLAMP_TO_EDGE,[ee]:e.MIRRORED_REPEAT},B={[te]:e.NEAREST,[ne]:e.NEAREST_MIPMAP_NEAREST,[re]:e.NEAREST_MIPMAP_LINEAR,[ie]:e.LINEAR,[se]:e.LINEAR_MIPMAP_NEAREST,[ae]:e.LINEAR_MIPMAP_LINEAR},P={[Tt]:e.NEVER,[Lt]:e.ALWAYS,[Mt]:e.LESS,[Rt]:e.LEQUAL,[It]:e.EQUAL,[Dt]:e.GEQUAL,[Bt]:e.GREATER,[Pt]:e.NOTEQUAL};function D(n,s,a){if(a?(e.texParameteri(n,e.TEXTURE_WRAP_S,R[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,R[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,R[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,B[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,B[s.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),s.wrapS!==Z||s.wrapT,e.texParameteri(n,e.TEXTURE_MAG_FILTER,S(s.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,S(s.minFilter)),s.minFilter!==te&&s.minFilter),s.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,P[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(s.magFilter===te)return;if(s.minFilter!==re&&s.minFilter!==ae)return;if(s.type===pe&&!1===t.has("OES_texture_float_linear"))return;if(!1===o&&s.type===me&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function L(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const i=n.source;let s=m.get(i);void 0===s&&(s={},m.set(i,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,r=!0),s[o].usedTimes++;const i=s[t.__cacheKey];void 0!==i&&(s[t.__cacheKey].usedTimes--,0===i.usedTimes&&T(n)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return r}function k(t,i,a){let l=e.TEXTURE_2D;(i.isDataArrayTexture||i.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),i.isData3DTexture&&(l=e.TEXTURE_3D);const u=L(t,i),h=i.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+a);const d=r.get(h);if(h.version!==d.__version||!0===u){n.activeTexture(e.TEXTURE0+a);const t=An.getPrimaries(An.workingColorSpace),r=i.colorSpace===mt?null:An.getPrimaries(i.colorSpace),f=i.colorSpace===mt||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);const p=function(e){return!o&&(e.wrapS!==Z||e.wrapT!==Z||e.minFilter!==te&&e.minFilter!==ie)}(i)&&!1===y(i.image);let m=v(i.image,p,!1,c);m=G(i,m);const g=y(m)||o,A=s.convert(i.format,i.colorSpace);let S,w=s.convert(i.type),C=x(i.internalFormat,A,w,i.colorSpace,i.isVideoTexture);D(l,i,g);const T=i.mipmaps,M=o&&!0!==i.isVideoTexture,I=void 0===d.__version||!0===u,R=b(i,m,g);if(i.isDepthTexture)C=e.DEPTH_COMPONENT,o?C=i.type===pe?e.DEPTH_COMPONENT32F:i.type===fe?e.DEPTH_COMPONENT24:i.type===ve?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:i.type,i.format===Ee&&C===e.DEPTH_COMPONENT&&i.type!==he&&i.type!==fe&&(i.type=fe,w=s.convert(i.type)),i.format===_e&&C===e.DEPTH_COMPONENT&&(C=e.DEPTH_STENCIL,i.type!==ve&&(i.type=ve,w=s.convert(i.type))),I&&(M?n.texStorage2D(e.TEXTURE_2D,1,C,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,C,m.width,m.height,0,A,w,null));else if(i.isDataTexture)if(T.length>0&&g){M&&I&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,r=T.length;t<r;t++)S=T[t],M?n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,A,w,S.data):n.texImage2D(e.TEXTURE_2D,t,C,S.width,S.height,0,A,w,S.data);i.generateMipmaps=!1}else M?(I&&n.texStorage2D(e.TEXTURE_2D,R,C,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,A,w,m.data)):n.texImage2D(e.TEXTURE_2D,0,C,m.width,m.height,0,A,w,m.data);else if(i.isCompressedTexture)if(i.isCompressedArrayTexture){M&&I&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,C,T[0].width,T[0].height,m.depth);for(let t=0,r=T.length;t<r;t++)S=T[t],i.format!==ye?null!==A&&(M?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,m.depth,A,S.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,C,S.width,S.height,m.depth,0,S.data,0,0)):M?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,m.depth,A,w,S.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,C,S.width,S.height,m.depth,0,A,w,S.data)}else{M&&I&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,r=T.length;t<r;t++)S=T[t],i.format!==ye?null!==A&&(M?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,A,S.data):n.compressedTexImage2D(e.TEXTURE_2D,t,C,S.width,S.height,0,S.data)):M?n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,A,w,S.data):n.texImage2D(e.TEXTURE_2D,t,C,S.width,S.height,0,A,w,S.data)}else if(i.isDataArrayTexture)M?(I&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,C,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,A,w,m.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,C,m.width,m.height,m.depth,0,A,w,m.data);else if(i.isData3DTexture)M?(I&&n.texStorage3D(e.TEXTURE_3D,R,C,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,A,w,m.data)):n.texImage3D(e.TEXTURE_3D,0,C,m.width,m.height,m.depth,0,A,w,m.data);else if(i.isFramebufferTexture){if(I)if(M)n.texStorage2D(e.TEXTURE_2D,R,C,m.width,m.height);else{let t=m.width,r=m.height;for(let i=0;i<R;i++)n.texImage2D(e.TEXTURE_2D,i,C,t,r,0,A,w,null),t>>=1,r>>=1}}else if(T.length>0&&g){M&&I&&n.texStorage2D(e.TEXTURE_2D,R,C,T[0].width,T[0].height);for(let t=0,r=T.length;t<r;t++)S=T[t],M?n.texSubImage2D(e.TEXTURE_2D,t,0,0,A,w,S):n.texImage2D(e.TEXTURE_2D,t,C,A,w,S);i.generateMipmaps=!1}else M?(I&&n.texStorage2D(e.TEXTURE_2D,R,C,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,A,w,m)):n.texImage2D(e.TEXTURE_2D,0,C,A,w,m);E(i,g)&&_(l),d.__version=h.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function F(t,i,a,o,l,c){const u=s.convert(a.format,a.colorSpace),d=s.convert(a.type),f=x(a.internalFormat,u,d,a.colorSpace);if(!r.get(i).__hasExternalTextures){const t=Math.max(1,i.width>>c),r=Math.max(1,i.height>>c);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,c,f,t,r,i.depth,0,u,d,null):n.texImage2D(l,c,f,t,r,0,u,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),z(i)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,l,r.get(a).__webglTexture,0,N(i)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,l,r.get(a).__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function O(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let i=!0===o?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(r||z(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===pe?i=e.DEPTH_COMPONENT32F:t.type===fe&&(i=e.DEPTH_COMPONENT24));const r=N(n);z(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,i,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,r,i,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const i=N(n);r&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):z(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let i=0;i<t.length;i++){const a=t[i],o=s.convert(a.format,a.colorSpace),l=s.convert(a.type),c=x(a.internalFormat,o,l,a.colorSpace),u=N(n);r&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,c,n.width,n.height):z(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function U(t){const i=r.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),I(i.depthTexture,0);const s=r.get(i.depthTexture).__webglTexture,a=N(i);if(i.depthTexture.format===Ee)z(i)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(i.depthTexture.format!==_e)throw new Error("Unknown depthTexture format");z(i)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(i.__webglFramebuffer,t)}else if(s){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),O(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),O(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function N(e){return Math.min(u,e.samples)}function z(e){const n=r.get(e);return o&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function G(e,n){const r=e.colorSpace,i=e.format;e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Ut||r!==At&&r!==mt&&An.getTransfer(r)===_t&&!1===o&&(!0===t.has("EXT_sRGB")&&i===ye?(e.format=Ut,e.minFilter=ie,e.generateMipmaps=!1):n=_n.sRGBToLinear(n)),n}this.allocateTextureUnit=function(){const e=M;return M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=I,this.setTexture2DArray=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?k(s,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?k(s,t,i):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?function(t,i,a){if(6!==i.image.length)return;const c=L(t,i),u=i.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+a);const h=r.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+a);const t=An.getPrimaries(An.workingColorSpace),r=i.colorSpace===mt?null:An.getPrimaries(i.colorSpace),d=i.colorSpace===mt||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const f=i.isCompressedTexture||i.image[0].isCompressedTexture,p=i.image[0]&&i.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=f||p?p?i.image[e].image:i.image[e]:v(i.image[e],!1,!0,l),m[e]=G(i,m[e]);const g=m[0],A=y(g)||o,S=s.convert(i.format,i.colorSpace),w=s.convert(i.type),C=x(i.internalFormat,S,w,i.colorSpace),T=o&&!0!==i.isVideoTexture,M=void 0===h.__version||!0===c;let I,R=b(i,g,A);if(D(e.TEXTURE_CUBE_MAP,i,A),f){T&&M&&n.texStorage2D(e.TEXTURE_CUBE_MAP,R,C,g.width,g.height);for(let t=0;t<6;t++){I=m[t].mipmaps;for(let r=0;r<I.length;r++){const s=I[r];i.format!==ye?null!==S&&(T?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,s.width,s.height,S,s.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,C,s.width,s.height,0,s.data)):T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,s.width,s.height,S,w,s.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,C,s.width,s.height,0,S,w,s.data)}}}else{I=i.mipmaps,T&&M&&(I.length>0&&R++,n.texStorage2D(e.TEXTURE_CUBE_MAP,R,C,m[0].width,m[0].height));for(let t=0;t<6;t++)if(p){T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,S,w,m[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,m[t].width,m[t].height,0,S,w,m[t].data);for(let r=0;r<I.length;r++){const i=I[r].image[t].image;T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,S,w,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,C,i.width,i.height,0,S,w,i.data)}}else{T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,S,w,m[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,S,w,m[t]);for(let r=0;r<I.length;r++){const i=I[r];T?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,S,w,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,C,S,w,i.image[t])}}}E(i,A)&&_(e.TEXTURE_CUBE_MAP),h.__version=u.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(a,t,i):n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture,e.TEXTURE0+i)},this.rebindTextures=function(t,n,i){const s=r.get(t);void 0!==n&&F(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&U(t)},this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener("dispose",C),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,a.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,f=y(t)||o;if(h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(d&&i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),a.memory.textures++)}}if(o&&t.samples>0&&!1===z(t)){const r=d?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<r.length;n++){const i=r[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const a=s.convert(i.format,i.colorSpace),o=s.convert(i.type),l=x(i.internalFormat,a,o,i.colorSpace,!0===t.isXRRenderTarget),u=N(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),O(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(h){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),D(e.TEXTURE_CUBE_MAP,l,f);for(let n=0;n<6;n++)if(o&&l.mipmaps&&l.mipmaps.length>0)for(let r=0;r<l.mipmaps.length;r++)F(c.__webglFramebuffer[n][r],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else F(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);E(l,f)&&_(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){const i=t.texture;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r.get(a);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),D(e.TEXTURE_2D,a,f),F(c.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,0),E(a,f)&&_(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&o&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,u.__webglTexture),D(r,l,f),o&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)F(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,r,n);else F(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,r,0);E(l,f)&&_(r),n.unbindTexture()}t.depthBuffer&&U(t)},this.updateRenderTargetMipmap=function(t){const i=y(t)||o,s=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let a=0,o=s.length;a<o;a++){const o=s[a];if(E(o,i)){const i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=r.get(o).__webglTexture;n.bindTexture(i,s),_(i),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(o&&t.samples>0&&!1===z(t)){const i=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<i.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(c);const f=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===f&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),h&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===f&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),h){const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,e.NEAREST),d&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const s=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=U,this.setupFrameBufferTexture=F,this.useMultisampledRTT=z}function Po(e,t,n){const r=n.isWebGL2;return{convert:function(n,i=""){let s;const a=An.getTransfer(i);if(n===le)return e.UNSIGNED_BYTE;if(n===ge)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Ae)return e.UNSIGNED_SHORT_5_5_5_1;if(n===ce)return e.BYTE;if(n===ue)return e.SHORT;if(n===he)return e.UNSIGNED_SHORT;if(n===de)return e.INT;if(n===fe)return e.UNSIGNED_INT;if(n===pe)return e.FLOAT;if(n===me)return r?e.HALF_FLOAT:(s=t.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(n===ye)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===Ee)return e.DEPTH_COMPONENT;if(n===_e)return e.DEPTH_STENCIL;if(n===Ut)return s=t.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(n===xe)return e.RED;if(n===be)return e.RED_INTEGER;if(n===Se)return e.RG;if(n===we)return e.RG_INTEGER;if(n===Ce)return e.RGBA_INTEGER;if(n===Te||n===Me||n===Ie||n===Re)if(a===_t){if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===Te)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Me)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Ie)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Re)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=t.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===Te)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Me)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Ie)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Re)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Be||n===Pe||n===De||n===Le){if(s=t.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(n===Be)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Pe)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===De)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Le)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===ke)return s=t.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===Fe||n===Oe){if(s=t.get("WEBGL_compressed_texture_etc"),null===s)return null;if(n===Fe)return a===_t?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===Oe)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(n===Ue||n===Ne||n===ze||n===Ge||n===Qe||n===He||n===Ve||n===je||n===We||n===Ye||n===Ke||n===qe||n===Xe||n===$e){if(s=t.get("WEBGL_compressed_texture_astc"),null===s)return null;if(n===Ue)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Ne)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===ze)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ge)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Qe)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===He)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Ve)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===je)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===We)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Ye)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Ke)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===qe)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Xe)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===$e)return a===_t?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Je||n===Ze||n===et){if(s=t.get("EXT_texture_compression_bptc"),null===s)return null;if(n===Je)return a===_t?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Ze)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===et)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===tt||n===nt||n===rt){if(s=t.get("EXT_texture_compression_rgtc"),null===s)return null;if(n===Je)return s.COMPRESSED_RED_RGTC1_EXT;if(n===tt)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===nt)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===rt)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===ve?r?e.UNSIGNED_INT_24_8:(s=t.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class Do extends Yi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Lo extends Lr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ko={type:"move"};class Fo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Lo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Lo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Dn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Dn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Lo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Dn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Dn),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n),i=this._getHandJoint(l,r);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],a=r.position.distanceTo(i.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ko)))}return null!==a&&(a.visible=null!==r),null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Lo;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Oo extends Cn{constructor(e,t,n,r,i,s,a,o,l,c){if((c=void 0!==c?c:Ee)!==Ee&&c!==_e)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Ee&&(n=fe),void 0===n&&c===_e&&(n=ve),super(null,r,i,s,a,o,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:te,this.minFilter=void 0!==o?o:te,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class Uo extends Gt{constructor(e,t){super();const n=this;let r=null,i=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,f=null;const p=t.getContextAttributes();let m=null,g=null;const A=[],v=[],y=new Yi;y.layers.enable(1),y.viewport=new Tn;const E=new Yi;E.layers.enable(2),E.viewport=new Tn;const _=[y,E],x=new Do;x.layers.enable(1),x.layers.enable(2);let b=null,S=null;function w(e){const t=v.indexOf(e.inputSource);if(-1===t)return;const n=A[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function C(){r.removeEventListener("select",w),r.removeEventListener("selectstart",w),r.removeEventListener("selectend",w),r.removeEventListener("squeeze",w),r.removeEventListener("squeezestart",w),r.removeEventListener("squeezeend",w),r.removeEventListener("end",C),r.removeEventListener("inputsourceschange",T);for(let e=0;e<A.length;e++){const t=v[e];null!==t&&(v[e]=null,A[e].disconnect(t))}b=null,S=null,e.setRenderTarget(m),d=null,h=null,u=null,r=null,g=null,P.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function T(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=v.indexOf(n);r>=0&&(v[r]=null,A[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=v.indexOf(n);if(-1===r){for(let e=0;e<A.length;e++){if(e>=v.length){v.push(n),r=e;break}if(null===v[e]){v[e]=n,r=e;break}}if(-1===r)break}const i=A[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=A[e];return void 0===t&&(t=new Fo,A[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=A[e];return void 0===t&&(t=new Fo,A[e]=t),t.getGripSpace()},this.getHand=function(e){let t=A[e];return void 0===t&&(t=new Fo,A[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,n.isPresenting},this.setReferenceSpaceType=function(e){a=e,n.isPresenting},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(m=e.getRenderTarget(),r.addEventListener("select",w),r.addEventListener("selectstart",w),r.addEventListener("selectend",w),r.addEventListener("squeeze",w),r.addEventListener("squeezestart",w),r.addEventListener("squeezeend",w),r.addEventListener("end",C),r.addEventListener("inputsourceschange",T),!0!==p.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||p.antialias,alpha:!0,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:i};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),g=new In(d.framebufferWidth,d.framebufferHeight,{format:ye,type:le,colorSpace:e.outputColorSpace,stencilBuffer:p.stencil})}else{let n=null,s=null,a=null;p.depth&&(a=p.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=p.stencil?_e:Ee,s=p.stencil?ve:fe);const o={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:i};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(o),r.updateRenderState({layers:[h]}),g=new In(h.textureWidth,h.textureHeight,{format:ye,type:le,depthTexture:new Oo(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:p.stencil,colorSpace:e.outputColorSpace,samples:p.antialias?4:0});e.properties.get(g).__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),P.setContext(r),P.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const M=new Dn,I=new Dn;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;x.near=E.near=y.near=e.near,x.far=E.far=y.far=e.far,b===x.near&&S===x.far||(r.updateRenderState({depthNear:x.near,depthFar:x.far}),b=x.near,S=x.far);const t=e.parent,n=x.cameras;R(x,t);for(let e=0;e<n.length;e++)R(n[e],t);2===n.length?function(e,t,n){M.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(n.matrixWorld);const r=M.distanceTo(I),i=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(s[8]+1)/s[0],d=a*u,f=a*h,p=r/(-u+h),m=p*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=a+p,A=o+p,v=d-m,y=f+(r-m),E=l*o/A*g,_=c*o/A*g;e.projectionMatrix.makePerspective(v,y,E,_,g,A),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(x,y,E):x.projectionMatrix.copy(y.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*jt*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,x,t)},this.getCamera=function(){return x},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let B=null;const P=new ss;P.setAnimationLoop(function(t,r){if(c=r.getViewerPose(l||s),f=r,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==x.cameras.length&&(x.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let s=null;if(null!==d)s=d.getViewport(i);else{const t=u.getViewSubImage(h,i);s=t.viewport,0===r&&(e.setRenderTargetTextures(g,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let a=_[r];void 0===a&&(a=new Yi,a.layers.enable(r),a.viewport=new Tn,_[r]=a),a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(i.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===r&&(x.matrix.copy(a.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale)),!0===n&&x.cameras.push(a)}}for(let e=0;e<A.length;e++){const t=v[e],n=A[e];null!==t&&void 0!==n&&n.update(t,r,l||s)}B&&B(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),f=null}),this.setAnimationLoop=function(e){B=e},this.dispose=function(){}}}function No(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(r,i){r.opacity.value=i.opacity,i.color&&r.diffuse.value.copy(i.color),i.emissive&&r.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(r.map.value=i.map,n(i.map,r.mapTransform)),i.alphaMap&&(r.alphaMap.value=i.alphaMap,n(i.alphaMap,r.alphaMapTransform)),i.bumpMap&&(r.bumpMap.value=i.bumpMap,n(i.bumpMap,r.bumpMapTransform),r.bumpScale.value=i.bumpScale,1===i.side&&(r.bumpScale.value*=-1)),i.normalMap&&(r.normalMap.value=i.normalMap,n(i.normalMap,r.normalMapTransform),r.normalScale.value.copy(i.normalScale),1===i.side&&r.normalScale.value.negate()),i.displacementMap&&(r.displacementMap.value=i.displacementMap,n(i.displacementMap,r.displacementMapTransform),r.displacementScale.value=i.displacementScale,r.displacementBias.value=i.displacementBias),i.emissiveMap&&(r.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,r.emissiveMapTransform)),i.specularMap&&(r.specularMap.value=i.specularMap,n(i.specularMap,r.specularMapTransform)),i.alphaTest>0&&(r.alphaTest.value=i.alphaTest);const s=t.get(i).envMap;if(s&&(r.envMap.value=s,r.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,r.reflectivity.value=i.reflectivity,r.ior.value=i.ior,r.refractionRatio.value=i.refractionRatio),i.lightMap){r.lightMap.value=i.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;r.lightMapIntensity.value=i.lightMapIntensity*t,n(i.lightMap,r.lightMapTransform)}i.aoMap&&(r.aoMap.value=i.aoMap,r.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Hi(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,s,a,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,r){e.metalness.value=r.metalness,r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap,n(r.metalnessMap,e.metalnessMapTransform));e.roughness.value=r.roughness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap,n(r.roughnessMap,e.roughnessMapTransform));const i=t.get(r).envMap;i&&(e.envMapIntensity.value=r.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,o)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,s,a):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function zo(e,t,n,r){let i={},s={},a=[];const o=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){const r=e.value;if(void 0===n[t]){if("number"==typeof r)n[t]=r;else{const e=Array.isArray(r)?r:[r],i=[];for(let t=0;t<e.length;t++)i.push(e[t].clone());n[t]=i}return!0}if("number"==typeof r){if(n[t]!==r)return n[t]=r,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],i=Array.isArray(r)?r:[r];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(i[t]))return n.copy(i[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture,t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=a.indexOf(n.__bindingPointIndex);a.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){let d=i[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const r=16;let i=0;for(let e=0,s=t.length;e<s;e++){const s=t[e],a={boundary:0,storage:0},o=Array.isArray(s.value)?s.value:[s.value];for(let e=0,t=o.length;e<t;e++){const t=c(o[e]);a.boundary+=t.boundary,a.storage+=t.storage}if(s.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=n,e>0){i=n%r;0!==i&&r-i-a.boundary<0&&(n+=r-i,s.__offset=n)}n+=a.storage}i=n%r,i>0&&(n+=r-i);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return 0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",u));const f=h.program;r.updateUBOMapping(n,f);const p=t.render.frame;s[n.id]!==p&&(!function(t){const n=i[t.id],r=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=r.length;t<n;t++){const n=r[t];if(!0===l(n,t,s)){const t=n.__offset,r=Array.isArray(n.value)?n.value:[n.value];let i=0;for(let s=0;s<r.length;s++){const a=r[s],o=c(a);"number"==typeof a?(n.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+i,n.__data)):a.isMatrix3?(n.__data[0]=a.elements[0],n.__data[1]=a.elements[1],n.__data[2]=a.elements[2],n.__data[3]=a.elements[0],n.__data[4]=a.elements[3],n.__data[5]=a.elements[4],n.__data[6]=a.elements[5],n.__data[7]=a.elements[0],n.__data[8]=a.elements[6],n.__data[9]=a.elements[7],n.__data[10]=a.elements[8],n.__data[11]=a.elements[0]):(a.toArray(n.__data,i),i+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=p)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);a=[],i={},s={}}}}class Go{constructor(e={}){const{canvas:t=un(),context:n=null,depth:r=!0,stencil:i=!0,alpha:s=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let h;this.isWebGLRenderer=!0,h=null!==n?n.getContextAttributes().alpha:s;const d=new Uint32Array(4),f=new Int32Array(4);let p=null,m=null;const g=[],A=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=gt,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const v=this;let y=!1,_=0,x=0,b=null,S=-1,w=null;const C=new Tn,T=new Tn;let M=null;const I=new $r(0);let R=0,B=t.width,P=t.height,D=1,L=null,k=null;const F=new Tn(0,0,B,P),O=new Tn(0,0,B,P);let U=!1;const N=new is;let z=!1,G=!1,Q=null;const H=new cr,V=new nn,j=new Dn,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Y(){return null===b?D:1}let K,q,X,$,J,Z,ee,te,ne,re,ie,se,oe,ce,ue,de,Ee,_e,xe,Se,Te,Me,Ie,Re,Be=n;function Pe(e,n){for(let r=0;r<e.length;r++){const i=e[r],s=t.getContext(i,n);if(null!==s)return s}return null}try{const e={alpha:!0,depth:r,stencil:i,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${E}`),t.addEventListener("webglcontextlost",ke,!1),t.addEventListener("webglcontextrestored",Fe,!1),t.addEventListener("webglcontextcreationerror",Oe,!1),null===Be){const t=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&t.shift(),Be=Pe(t,e),null===Be)throw Pe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&WebGLRenderingContext,void 0===Be.getShaderPrecisionFormat&&(Be.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw e}function De(){K=new Fs(Be),q=new ms(Be,K,e),K.init(q),Me=new Po(Be,K,q),X=new Ro(Be,K,q),$=new Ns(Be),J=new go,Z=new Bo(Be,K,X,J,q,Me,$),ee=new As(v),te=new ks(v),ne=new as(Be,q),Ie=new fs(Be,K,ne,q),re=new Os(Be,ne,$,Ie),ie=new Hs(Be,re,ne,$),xe=new Qs(Be,q,Z),de=new gs(J),se=new mo(v,ee,te,K,q,Ie,de),oe=new No(v,J),ce=new Eo,ue=new Co(K,q),_e=new ds(v,ee,te,X,ie,h,o),Ee=new Io(v,ie,q),Re=new zo(Be,$,q,X),Se=new ps(Be,K,$,q),Te=new Us(Be,K,$,q),$.programs=se.programs,v.capabilities=q,v.extensions=K,v.properties=J,v.renderLists=ce,v.shadowMap=Ee,v.state=X,v.info=$}De();const Le=new Uo(v,Be);function ke(e){e.preventDefault(),y=!0}function Fe(){y=!1;const e=$.autoReset,t=Ee.enabled,n=Ee.autoUpdate,r=Ee.needsUpdate,i=Ee.type;De(),$.autoReset=e,Ee.enabled=t,Ee.autoUpdate=n,Ee.needsUpdate=r,Ee.type=i}function Oe(e){}function Ue(e){const t=e.target;t.removeEventListener("dispose",Ue),function(e){(function(e){const t=J.get(e).programs;void 0!==t&&(t.forEach(function(e){se.releaseProgram(e)}),e.isShaderMaterial&&se.releaseShaderCache(e))})(e),J.remove(e)}(t)}function Ne(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Ke(e,t,n),e.side=0,e.needsUpdate=!0,Ke(e,t,n),e.side=2):Ke(e,t,n)}this.xr=Le,this.getContext=function(){return Be},this.getContextAttributes=function(){return Be.getContextAttributes()},this.forceContextLoss=function(){const e=K.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=K.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(e){void 0!==e&&(D=e,this.setSize(B,P,!1))},this.getSize=function(e){return e.set(B,P)},this.setSize=function(e,n,r=!0){Le.isPresenting||(B=e,P=n,t.width=Math.floor(e*D),t.height=Math.floor(n*D),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(B*D,P*D).floor()},this.setDrawingBufferSize=function(e,n,r){B=e,P=n,D=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(C)},this.getViewport=function(e){return e.copy(F)},this.setViewport=function(e,t,n,r){e.isVector4?F.set(e.x,e.y,e.z,e.w):F.set(e,t,n,r),X.viewport(C.copy(F).multiplyScalar(D).floor())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,r){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,r),X.scissor(T.copy(O).multiplyScalar(D).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(e){X.setScissorTest(U=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){k=e},this.getClearColor=function(e){return e.copy(_e.getClearColor())},this.setClearColor=function(){_e.setClearColor.apply(_e,arguments)},this.getClearAlpha=function(){return _e.getClearAlpha()},this.setClearAlpha=function(){_e.setClearAlpha.apply(_e,arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;if(e){let e=!1;if(null!==b){const t=b.texture.format;e=t===Ce||t===we||t===be}if(e){const e=b.texture.type,t=e===le||e===fe||e===he||e===ve||e===ge||e===Ae,n=_e.getClearColor(),r=_e.getClearAlpha(),i=n.r,s=n.g,a=n.b;t?(d[0]=i,d[1]=s,d[2]=a,d[3]=r,Be.clearBufferuiv(Be.COLOR,0,d)):(f[0]=i,f[1]=s,f[2]=a,f[3]=r,Be.clearBufferiv(Be.COLOR,0,f))}else r|=Be.COLOR_BUFFER_BIT}t&&(r|=Be.DEPTH_BUFFER_BIT),n&&(r|=Be.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Be.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ke,!1),t.removeEventListener("webglcontextrestored",Fe,!1),t.removeEventListener("webglcontextcreationerror",Oe,!1),ce.dispose(),ue.dispose(),J.dispose(),ee.dispose(),te.dispose(),ie.dispose(),Ie.dispose(),Re.dispose(),se.dispose(),Le.dispose(),Le.removeEventListener("sessionstart",Ge),Le.removeEventListener("sessionend",Qe),Q&&(Q.dispose(),Q=null),He.stop()},this.renderBufferDirect=function(e,t,n,r,i,s){null===t&&(t=W);const a=i.isMesh&&i.matrixWorld.determinant()<0,o=function(e,t,n,r,i){!0!==t.isScene&&(t=W);Z.resetTextureUnits();const s=t.fog,a=r.isMeshStandardMaterial?t.environment:null,o=null===b?v.outputColorSpace:!0===b.isXRRenderTarget?b.texture.colorSpace:At,l=(r.isMeshStandardMaterial?te:ee).get(r.envMap||a),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,f=!!n.morphAttributes.color;let p=0;r.toneMapped&&(null!==b&&!0!==b.isXRRenderTarget||(p=v.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,A=void 0!==g?g.length:0,y=J.get(r),E=m.state.lights;if(!0===z&&(!0===G||e!==w)){const t=e===w&&r.id===S;de.setState(r,e,t)}let _=!1;r.version===y.__version?y.needsLights&&y.lightsStateVersion!==E.state.version||y.outputColorSpace!==o||i.isInstancedMesh&&!1===y.instancing?_=!0:i.isInstancedMesh||!0!==y.instancing?i.isSkinnedMesh&&!1===y.skinning?_=!0:i.isSkinnedMesh||!0!==y.skinning?i.isInstancedMesh&&!0===y.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===y.instancingColor&&null!==i.instanceColor||y.envMap!==l||!0===r.fog&&y.fog!==s?_=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===de.numPlanes&&y.numIntersection===de.numIntersection?(y.vertexAlphas!==c||y.vertexTangents!==u||y.morphTargets!==h||y.morphNormals!==d||y.morphColors!==f||y.toneMapping!==p||!0===q.isWebGL2&&y.morphTargetsCount!==A)&&(_=!0):_=!0:_=!0:_=!0:(_=!0,y.__version=r.version);let x=y.currentProgram;!0===_&&(x=Ke(r,t,i));let C=!1,T=!1,M=!1;const I=x.getUniforms(),R=y.uniforms;X.useProgram(x.program)&&(C=!0,T=!0,M=!0);r.id!==S&&(S=r.id,T=!0);if(C||w!==e){I.setValue(Be,"projectionMatrix",e.projectionMatrix),I.setValue(Be,"viewMatrix",e.matrixWorldInverse);const t=I.map.cameraPosition;void 0!==t&&t.setValue(Be,j.setFromMatrixPosition(e.matrixWorld)),q.logarithmicDepthBuffer&&I.setValue(Be,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&I.setValue(Be,"isOrthographic",!0===e.isOrthographicCamera),w!==e&&(w=e,T=!0,M=!0)}if(i.isSkinnedMesh){I.setOptional(Be,i,"bindMatrix"),I.setOptional(Be,i,"bindMatrixInverse");const e=i.skeleton;e&&q.floatVertexTextures&&(null===e.boneTexture&&e.computeBoneTexture(),I.setValue(Be,"boneTexture",e.boneTexture,Z),I.setValue(Be,"boneTextureSize",e.boneTextureSize))}const B=n.morphAttributes;(void 0!==B.position||void 0!==B.normal||void 0!==B.color&&!0===q.isWebGL2)&&xe.update(i,n,x);(T||y.receiveShadow!==i.receiveShadow)&&(y.receiveShadow=i.receiveShadow,I.setValue(Be,"receiveShadow",i.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);T&&(I.setValue(Be,"toneMappingExposure",v.toneMappingExposure),y.needsLights&&(k=M,(L=R).ambientLightColor.needsUpdate=k,L.lightProbe.needsUpdate=k,L.directionalLights.needsUpdate=k,L.directionalLightShadows.needsUpdate=k,L.pointLights.needsUpdate=k,L.pointLightShadows.needsUpdate=k,L.spotLights.needsUpdate=k,L.spotLightShadows.needsUpdate=k,L.rectAreaLights.needsUpdate=k,L.hemisphereLights.needsUpdate=k),s&&!0===r.fog&&oe.refreshFogUniforms(R,s),oe.refreshMaterialUniforms(R,r,D,P,Q),Ya.upload(Be,qe(y),R,Z));var L,k;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ya.upload(Be,qe(y),R,Z),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&I.setValue(Be,"center",i.center);if(I.setValue(Be,"modelViewMatrix",i.modelViewMatrix),I.setValue(Be,"normalMatrix",i.normalMatrix),I.setValue(Be,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(q.isWebGL2){const n=e[t];Re.update(n,x),Re.bind(n,x)}}return x}(e,t,n,r,i);X.setMaterial(r,a);let l=n.index,c=1;if(!0===r.wireframe){if(l=re.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,f=(u.start+u.count)*c;null!==s&&(d=Math.max(d,s.start*c),f=Math.min(f,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),f=Math.min(f,l.count)):null!=h&&(d=Math.max(d,0),f=Math.min(f,h.count));const p=f-d;if(p<0||p===1/0)return;let g;Ie.setup(i,r,o,n,l);let A=Se;if(null!==l&&(g=ne.get(l),A=Te,A.setIndex(g)),i.isMesh)!0===r.wireframe?(X.setLineWidth(r.wireframeLinewidth*Y()),A.setMode(Be.LINES)):A.setMode(Be.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),X.setLineWidth(e*Y()),i.isLineSegments?A.setMode(Be.LINES):i.isLineLoop?A.setMode(Be.LINE_LOOP):A.setMode(Be.LINE_STRIP)}else i.isPoints?A.setMode(Be.POINTS):i.isSprite&&A.setMode(Be.TRIANGLES);if(i.isInstancedMesh)A.renderInstances(d,p,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);A.renderInstances(d,p,t)}else A.render(d,p)},this.compile=function(e,t,n=null){null===n&&(n=e),m=ue.get(n),m.init(),A.push(m),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),m.setupLights(v._useLegacyLights);const r=new Set;return e.traverse(function(e){const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const s=t[i];Ne(s,n,e),r.add(s)}else Ne(t,n,e),r.add(t)}),A.pop(),m=null,r},this.compileAsync=function(e,t,n=null){const r=this.compile(e,t,n);return new Promise(t=>{function n(){r.forEach(function(e){J.get(e).currentProgram.isReady()&&r.delete(e)}),0!==r.size?setTimeout(n,10):t(e)}null!==K.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let ze=null;function Ge(){He.stop()}function Qe(){He.start()}const He=new ss;function Ve(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||N.intersectsSprite(e)){r&&j.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ie.update(e),i=e.material;i.visible&&p.push(e,t,i,n,j.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||N.intersectsObject(e))){const t=ie.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),j.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),j.copy(t.boundingSphere.center)),j.applyMatrix4(e.matrixWorld).applyMatrix4(H)),Array.isArray(i)){const r=t.groups;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=i[a.materialIndex];o&&o.visible&&p.push(e,t,o,n,j.z,a)}}else i.visible&&p.push(e,t,i,n,j.z,null)}const i=e.children;for(let e=0,s=i.length;e<s;e++)Ve(i[e],t,n,r)}function je(e,t,n,r){const i=e.opaque,s=e.transmissive,a=e.transparent;m.setupLightsView(n),!0===z&&de.setGlobalState(v.clippingPlanes,n),s.length>0&&function(e,t,n,r){const i=!0===n.isScene?n.overrideMaterial:null;if(null!==i)return;const s=q.isWebGL2;null===Q&&(Q=new In(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")?me:le,minFilter:ae,samples:s?4:0}));v.getDrawingBufferSize(V),s?Q.setSize(V.x,V.y):Q.setSize(Jt(V.x),Jt(V.y));const a=v.getRenderTarget();v.setRenderTarget(Q),v.getClearColor(I),R=v.getClearAlpha(),R<1&&v.setClearColor(16777215,.5);v.clear();const o=v.toneMapping;v.toneMapping=0,We(e,n,r),Z.updateMultisampleRenderTarget(Q),Z.updateRenderTargetMipmap(Q);let l=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.object,a=i.geometry,o=i.material,c=i.group;if(2===o.side&&s.layers.test(r.layers)){const e=o.side;o.side=1,o.needsUpdate=!0,Ye(s,n,r,a,o,c),o.side=e,o.needsUpdate=!0,l=!0}}!0===l&&(Z.updateMultisampleRenderTarget(Q),Z.updateRenderTargetMipmap(Q));v.setRenderTarget(a),v.setClearColor(I,R),v.toneMapping=o}(i,s,t,n),r&&X.viewport(C.copy(r)),i.length>0&&We(i,t,n),s.length>0&&We(s,t,n),a.length>0&&We(a,t,n),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1)}function We(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,s=e.length;i<s;i++){const s=e[i],a=s.object,o=s.geometry,l=null===r?s.material:r,c=s.group;a.layers.test(n.layers)&&Ye(a,t,n,o,l,c)}}function Ye(e,t,n,r,i,s){e.onBeforeRender(v,t,n,r,i,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(v,t,n,r,e,s),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,s),i.side=0,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,s),i.side=2):v.renderBufferDirect(n,t,r,i,e,s),e.onAfterRender(v,t,n,r,i,s)}function Ke(e,t,n){!0!==t.isScene&&(t=W);const r=J.get(e),i=m.state.lights,s=m.state.shadowsArray,a=i.state.version,o=se.getParameters(e,i.state,s,t,n),l=se.getProgramCacheKey(o);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",Ue),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===a)return Xe(e,o),u}else o.uniforms=se.getUniforms(e),e.onBuild(n,o,v),e.onBeforeCompile(o,v),u=se.acquireProgram(o,l),c.set(l,u),r.uniforms=o.uniforms;const h=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=de.uniform),Xe(e,o),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function qe(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Ya.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Xe(e,t){const n=J.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}He.setAnimationLoop(function(e){ze&&ze(e)}),"undefined"!=typeof self&&He.setContext(self),this.setAnimationLoop=function(e){ze=e,Le.setAnimationLoop(e),null===e?He.stop():He.start()},Le.addEventListener("sessionstart",Ge),Le.addEventListener("sessionend",Qe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return;if(!0===y)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Le.enabled&&!0===Le.isPresenting&&(!0===Le.cameraAutoUpdate&&Le.updateCamera(t),t=Le.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,b),m=ue.get(e,A.length),m.init(),A.push(m),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromProjectionMatrix(H),G=this.localClippingEnabled,z=de.init(this.clippingPlanes,G),p=ce.get(e,g.length),p.init(),g.push(p),Ve(e,t,0,v.sortObjects),p.finish(),!0===v.sortObjects&&p.sort(L,k),this.info.render.frame++,!0===z&&de.beginShadows();const n=m.state.shadowsArray;if(Ee.render(n,e,t),!0===z&&de.endShadows(),!0===this.info.autoReset&&this.info.reset(),_e.render(p,e),m.setupLights(v._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];je(p,e,r,r.viewport)}}else je(p,e,t);null!==b&&(Z.updateMultisampleRenderTarget(b),Z.updateRenderTargetMipmap(b)),!0===e.isScene&&e.onAfterRender(v,e,t),Ie.resetDefaultState(),S=-1,w=null,A.pop(),m=A.length>0?A[A.length-1]:null,g.pop(),p=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(e,t,n){J.get(e.texture).__webglTexture=t,J.get(e.depthTexture).__webglTexture=n;const r=J.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===K.has("WEBGL_multisampled_render_to_texture")&&(r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=J.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){b=e,_=t,x=n;let r=!0,i=null,s=!1,a=!1;if(e){const o=J.get(e);void 0!==o.__useDefaultFramebuffer?(X.bindFramebuffer(Be.FRAMEBUFFER,null),r=!1):void 0===o.__webglFramebuffer?Z.setupRenderTarget(e):o.__hasExternalTextures&&Z.rebindTextures(e,J.get(e.texture).__webglTexture,J.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(c[t])?c[t][n]:c[t],s=!0):i=q.isWebGL2&&e.samples>0&&!1===Z.useMultisampledRTT(e)?J.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,C.copy(e.viewport),T.copy(e.scissor),M=e.scissorTest}else C.copy(F).multiplyScalar(D).floor(),T.copy(O).multiplyScalar(D).floor(),M=U;if(X.bindFramebuffer(Be.FRAMEBUFFER,i)&&q.drawBuffers&&r&&X.drawBuffers(e,i),X.viewport(C),X.scissor(T),X.setScissorTest(M),s){const r=J.get(e.texture);Be.framebufferTexture2D(Be.FRAMEBUFFER,Be.COLOR_ATTACHMENT0,Be.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(a){const r=J.get(e.texture),i=t||0;Be.framebufferTextureLayer(Be.FRAMEBUFFER,Be.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}S=-1},this.readRenderTargetPixels=function(e,t,n,r,i,s,a){if(!e||!e.isWebGLRenderTarget)return;let o=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){X.bindFramebuffer(Be.FRAMEBUFFER,o);try{const a=e.texture,o=a.format,l=a.type;if(o!==ye&&Me.convert(o)!==Be.getParameter(Be.IMPLEMENTATION_COLOR_READ_FORMAT))return;const c=l===me&&(K.has("EXT_color_buffer_half_float")||q.isWebGL2&&K.has("EXT_color_buffer_float"));if(!(l===le||Me.convert(l)===Be.getParameter(Be.IMPLEMENTATION_COLOR_READ_TYPE)||l===pe&&(q.isWebGL2||K.has("OES_texture_float")||K.has("WEBGL_color_buffer_float"))||c))return;t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&Be.readPixels(t,n,r,i,Me.convert(o),Me.convert(l),s)}finally{const e=null!==b?J.get(b).__webglFramebuffer:null;X.bindFramebuffer(Be.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),s=Math.floor(t.image.height*r);Z.setTexture2D(t,0),Be.copyTexSubImage2D(Be.TEXTURE_2D,n,0,0,e.x,e.y,i,s),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,s=t.image.height,a=Me.convert(n.format),o=Me.convert(n.type);Z.setTexture2D(n,0),Be.pixelStorei(Be.UNPACK_FLIP_Y_WEBGL,n.flipY),Be.pixelStorei(Be.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Be.pixelStorei(Be.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?Be.texSubImage2D(Be.TEXTURE_2D,r,e.x,e.y,i,s,a,o,t.image.data):t.isCompressedTexture?Be.compressedTexSubImage2D(Be.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):Be.texSubImage2D(Be.TEXTURE_2D,r,e.x,e.y,a,o,t.image),0===r&&n.generateMipmaps&&Be.generateMipmap(Be.TEXTURE_2D),X.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){if(v.isWebGL1Renderer)return;const s=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,o=e.max.z-e.min.z+1,l=Me.convert(r.format),c=Me.convert(r.type);let u;if(r.isData3DTexture)Z.setTexture3D(r,0),u=Be.TEXTURE_3D;else{if(!r.isDataArrayTexture)return;Z.setTexture2DArray(r,0),u=Be.TEXTURE_2D_ARRAY}Be.pixelStorei(Be.UNPACK_FLIP_Y_WEBGL,r.flipY),Be.pixelStorei(Be.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),Be.pixelStorei(Be.UNPACK_ALIGNMENT,r.unpackAlignment);const h=Be.getParameter(Be.UNPACK_ROW_LENGTH),d=Be.getParameter(Be.UNPACK_IMAGE_HEIGHT),f=Be.getParameter(Be.UNPACK_SKIP_PIXELS),p=Be.getParameter(Be.UNPACK_SKIP_ROWS),m=Be.getParameter(Be.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[0]:n.image;Be.pixelStorei(Be.UNPACK_ROW_LENGTH,g.width),Be.pixelStorei(Be.UNPACK_IMAGE_HEIGHT,g.height),Be.pixelStorei(Be.UNPACK_SKIP_PIXELS,e.min.x),Be.pixelStorei(Be.UNPACK_SKIP_ROWS,e.min.y),Be.pixelStorei(Be.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?Be.texSubImage3D(u,i,t.x,t.y,t.z,s,a,o,l,c,g.data):n.isCompressedArrayTexture?Be.compressedTexSubImage3D(u,i,t.x,t.y,t.z,s,a,o,l,g.data):Be.texSubImage3D(u,i,t.x,t.y,t.z,s,a,o,l,c,g),Be.pixelStorei(Be.UNPACK_ROW_LENGTH,h),Be.pixelStorei(Be.UNPACK_IMAGE_HEIGHT,d),Be.pixelStorei(Be.UNPACK_SKIP_PIXELS,f),Be.pixelStorei(Be.UNPACK_SKIP_ROWS,p),Be.pixelStorei(Be.UNPACK_SKIP_IMAGES,m),0===i&&r.generateMipmaps&&Be.generateMipmap(u),X.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?Z.setTextureCube(e,0):e.isData3DTexture?Z.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Z.setTexture2DArray(e,0):Z.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){_=0,x=0,b=null,X.reset(),Ie.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Nt}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===vt?"display-p3":"srgb",t.unpackColorSpace=An.workingColorSpace===yt?"display-p3":"srgb"}get physicallyCorrectLights(){return!this.useLegacyLights}set physicallyCorrectLights(e){this.useLegacyLights=!e}get outputEncoding(){return this.outputColorSpace===gt?ft:dt}set outputEncoding(e){this.outputColorSpace=e===ft?gt:At}get useLegacyLights(){return this._useLegacyLights}set useLegacyLights(e){this._useLegacyLights=e}}class Qo extends Go{}Qo.prototype.isWebGL1Renderer=!0;class Ho{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new $r(e),this.density=t}clone(){return new Ho(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Vo{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new $r(e),this.near=t,this.far=n}clone(){return new Vo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class jo extends Lr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class Wo{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=kt,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Wt()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Wt()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Wt()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Yo=new Dn;class Ko{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Yo.fromBufferAttribute(this,t),Yo.applyMatrix4(e),this.setXYZ(t,Yo.x,Yo.y,Yo.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Yo.fromBufferAttribute(this,t),Yo.applyNormalMatrix(e),this.setXYZ(t,Yo.x,Yo.y,Yo.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Yo.fromBufferAttribute(this,t),Yo.transformDirection(e),this.setXYZ(t,Yo.x,Yo.y,Yo.z);return this}setX(e,t){return this.normalized&&(t=en(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=en(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=en(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=en(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Zt(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Zt(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Zt(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Zt(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=en(t,this.array),n=en(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=en(t,this.array),n=en(n,this.array),r=en(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=en(t,this.array),n=en(n,this.array),r=en(r,this.array),i=en(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new ci(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ko(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class qo extends ei{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new $r(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Xo;const $o=new Dn,Jo=new Dn,Zo=new Dn,el=new nn,tl=new nn,nl=new cr,rl=new Dn,il=new Dn,sl=new Dn,al=new nn,ol=new nn,ll=new nn;class cl extends Lr{constructor(e=new qo){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Xo){Xo=new Ei;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Wo(e,5);Xo.setIndex([0,1,2,0,2,3]),Xo.setAttribute("position",new Ko(t,3,0,!1)),Xo.setAttribute("uv",new Ko(t,2,3,!1))}this.geometry=Xo,this.material=e,this.center=new nn(.5,.5)}raycast(e,t){e.camera,Jo.setFromMatrixScale(this.matrixWorld),nl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Zo.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Jo.multiplyScalar(-Zo.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const s=this.center;ul(rl.set(-.5,-.5,0),Zo,s,Jo,r,i),ul(il.set(.5,-.5,0),Zo,s,Jo,r,i),ul(sl.set(.5,.5,0),Zo,s,Jo,r,i),al.set(0,0),ol.set(1,0),ll.set(1,1);let a=e.ray.intersectTriangle(rl,il,sl,!1,$o);if(null===a&&(ul(il.set(-.5,.5,0),Zo,s,Jo,r,i),ol.set(0,1),a=e.ray.intersectTriangle(rl,sl,il,!1,$o),null===a))return;const o=e.ray.origin.distanceTo($o);o<e.near||o>e.far||t.push({distance:o,point:$o.clone(),uv:Wr.getInterpolation($o,rl,il,sl,al,ol,ll,new nn),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function ul(e,t,n,r,i,s){el.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(tl.x=s*el.x-i*el.y,tl.y=i*el.x+s*el.y):tl.copy(el),e.copy(t),e.x+=tl.x,e.y+=tl.y,e.applyMatrix4(nl)}const hl=new Dn,dl=new Dn;class fl extends Lr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let i;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){hl.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(hl);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){hl.setFromMatrixPosition(e.matrixWorld),dl.setFromMatrixPosition(this.matrixWorld);const n=hl.distanceTo(dl)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i;r++){let e=t[r].distance;if(t[r].object.visible&&(e-=e*t[r].hysteresis),!(n>=e))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return t}}const pl=new Dn,ml=new Tn,gl=new Tn,Al=new Dn,vl=new cr,yl=new Dn,El=new er,_l=new cr,xl=new lr;class bl extends Ui{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=V,this.bindMatrix=new cr,this.bindMatrixInverse=new cr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Fn),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,yl),this.boundingBox.expandByPoint(yl)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new er),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,yl),this.boundingSphere.expandByPoint(yl)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),El.copy(this.boundingSphere),El.applyMatrix4(r),!1!==e.ray.intersectsSphere(El)&&(_l.copy(r).invert(),xl.copy(e.ray).applyMatrix4(_l),null!==this.boundingBox&&!1===xl.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,xl)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Tn,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===V?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===j&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;ml.fromBufferAttribute(r.attributes.skinIndex,e),gl.fromBufferAttribute(r.attributes.skinWeight,e),pl.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=gl.getComponent(e);if(0!==r){const i=ml.getComponent(e);vl.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Al.copy(pl).applyMatrix4(vl),r)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return this.applyBoneTransform(e,t)}}class Sl extends Lr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class wl extends Cn{constructor(e=null,t=1,n=1,r,i,s,a,o,l=1003,c=1003,u,h){super(null,s,a,o,l,c,r,i,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Cl=new cr,Tl=new cr;class Ml{constructor(e=[],t=[]){this.uuid=Wt(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new cr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new cr;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:Tl;Cl.multiplyMatrices(i,t[r]),Cl.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new Ml(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=$t(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new wl(t,e,e,ye,pe);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){let r=t[e.bones[n]];void 0===r&&(r=new Sl),this.bones.push(r),this.boneInverses.push((new cr).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const s=n[r];e.boneInverses.push(s.toArray())}return e}}class Il extends ci{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Rl=new cr,Bl=new cr,Pl=[],Dl=new Fn,Ll=new cr,kl=new Ui,Fl=new er;class Ol extends Ui{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Il(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,Ll)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Fn),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Rl),Dl.copy(e.boundingBox).applyMatrix4(Rl),this.boundingBox.union(Dl)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new er),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Rl),Fl.copy(e.boundingSphere).applyMatrix4(Rl),this.boundingSphere.union(Fl)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(kl.geometry=this.geometry,kl.material=this.material,void 0!==kl.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Fl.copy(this.boundingSphere),Fl.applyMatrix4(n),!1!==e.ray.intersectsSphere(Fl)))for(let i=0;i<r;i++){this.getMatrixAt(i,Rl),Bl.multiplyMatrices(n,Rl),kl.matrixWorld=Bl,kl.raycast(e,Pl);for(let e=0,n=Pl.length;e<n;e++){const n=Pl[e];n.instanceId=i,n.object=this,t.push(n)}Pl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Il(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Ul extends ei{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new $r(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Nl=new Dn,zl=new Dn,Gl=new cr,Ql=new lr,Hl=new er;class Vl extends Lr{constructor(e=new Ei,t=new Ul){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Nl.fromBufferAttribute(t,e-1),zl.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Nl.distanceTo(zl);e.setAttribute("lineDistance",new di(n,1))}return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Hl.copy(n.boundingSphere),Hl.applyMatrix4(r),Hl.radius+=i,!1===e.ray.intersectsSphere(Hl))return;Gl.copy(r).invert(),Ql.copy(e.ray).applyMatrix4(Gl);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new Dn,c=new Dn,u=new Dn,h=new Dn,d=this.isLineSegments?2:1,f=n.index,p=n.attributes.position;if(null!==f){for(let n=Math.max(0,s.start),r=Math.min(f.count,s.start+s.count)-1;n<r;n+=d){const r=f.getX(n),i=f.getX(n+1);l.fromBufferAttribute(p,r),c.fromBufferAttribute(p,i);if(Ql.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);const s=e.ray.origin.distanceTo(h);s<e.near||s>e.far||t.push({distance:s,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),r=Math.min(p.count,s.start+s.count)-1;n<r;n+=d){l.fromBufferAttribute(p,n),c.fromBufferAttribute(p,n+1);if(Ql.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const jl=new Dn,Wl=new Dn;class Yl extends Vl{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)jl.fromBufferAttribute(t,e),Wl.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+jl.distanceTo(Wl);e.setAttribute("lineDistance",new di(n,1))}return this}}class Kl extends Vl{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class ql extends ei{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new $r(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Xl=new cr,$l=new lr,Jl=new er,Zl=new Dn;class ec extends Lr{constructor(e=new Ei,t=new ql){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Jl.copy(n.boundingSphere),Jl.applyMatrix4(r),Jl.radius+=i,!1===e.ray.intersectsSphere(Jl))return;Xl.copy(r).invert(),$l.copy(e.ray).applyMatrix4(Xl);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,s.start),i=Math.min(l.count,s.start+s.count);n<i;n++){const i=l.getX(n);Zl.fromBufferAttribute(c,i),tc(Zl,i,o,r,e,t,this)}}else{for(let n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);n<i;n++)Zl.fromBufferAttribute(c,n),tc(Zl,n,o,r,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function tc(e,t,n,r,i,s,a){const o=$l.distanceSqToPoint(e);if(o<n){const n=new Dn;$l.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,object:a})}}class nc extends Cn{constructor(e,t,n,r,i,s,a,o,l){super(e,t,n,r,i,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:ie,this.magFilter=void 0!==i?i:ie,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class rc extends Cn{constructor(e,t,n,r,i,s,a,o,l,c,u,h){super(null,s,a,o,l,c,r,i,u,h),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class ic extends Cn{constructor(e,t,n,r,i,s,a,o,l){super(e,t,n,r,i,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class sc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let s;s=t||e*n[i-1];let a,o=0,l=i-1;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),a=n[r]-s,a<0)o=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const c=n[r];return(r+(s-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),a=this.getPoint(i),o=t||(s.isVector2?new nn:new Dn);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Dn,r=[],i=[],s=[],a=new Dn,o=new cr;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new Dn)}i[0]=new Dn,s[0]=new Dn;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),s[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),s[t]=s[t-1].clone(),a.crossVectors(r[t-1],r[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(Yt(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(o.makeRotationAxis(a,e))}s[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(Yt(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(a.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(o.makeRotationAxis(r[n],t*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class ac extends sc{constructor(e=0,t=0,n=1,r=1,i=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){const n=t||new nn,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const a=this.aStartAngle+e*i;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,r=l-this.aY;o=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class oc extends ac{constructor(e,t,n,r,i,s){super(e,t,n,n,r,i,s),this.isArcCurve=!0,this.type="ArcCurve"}}function lc(){let e=0,t=0,n=0,r=0;function i(i,s,a,o){e=i,t=a,n=-3*i+3*s-2*a-o,r=2*i-2*s+a+o}return{initCatmullRom:function(e,t,n,r,s){i(t,n,s*(n-e),s*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,s,a,o){let l=(t-e)/s-(n-e)/(s+a)+(n-t)/a,c=(n-t)/a-(r-t)/(a+o)+(r-n)/o;l*=a,c*=a,i(t,n,l,c)},calc:function(i){const s=i*i;return e+t*i+n*s+r*(s*i)}}}const cc=new Dn,uc=new lc,hc=new lc,dc=new lc;class fc extends sc{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new Dn){const n=t,r=this.points,i=r.length,s=(i-(this.closed?0:1))*e;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?a=r[(l-1)%i]:(cc.subVectors(r[0],r[1]).add(r[0]),a=cc);const u=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?o=r[(l+2)%i]:(cc.subVectors(r[i-1],r[i-2]).add(r[i-1]),o=cc),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(o),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),uc.initNonuniformCatmullRom(a.x,u.x,h.x,o.x,t,n,r),hc.initNonuniformCatmullRom(a.y,u.y,h.y,o.y,t,n,r),dc.initNonuniformCatmullRom(a.z,u.z,h.z,o.z,t,n,r)}else"catmullrom"===this.curveType&&(uc.initCatmullRom(a.x,u.x,h.x,o.x,this.tension),hc.initCatmullRom(a.y,u.y,h.y,o.y,this.tension),dc.initCatmullRom(a.z,u.z,h.z,o.z,this.tension));return n.set(uc.calc(c),hc.calc(c),dc.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Dn).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function pc(e,t,n,r,i){const s=.5*(r-t),a=.5*(i-n),o=e*e;return(2*n-2*r+s+a)*(e*o)+(-3*n+3*r-2*s-a)*o+s*e+n}function mc(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function gc(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}class Ac extends sc{constructor(e=new nn,t=new nn,n=new nn,r=new nn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new nn){const n=t,r=this.v0,i=this.v1,s=this.v2,a=this.v3;return n.set(gc(e,r.x,i.x,s.x,a.x),gc(e,r.y,i.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class vc extends sc{constructor(e=new Dn,t=new Dn,n=new Dn,r=new Dn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Dn){const n=t,r=this.v0,i=this.v1,s=this.v2,a=this.v3;return n.set(gc(e,r.x,i.x,s.x,a.x),gc(e,r.y,i.y,s.y,a.y),gc(e,r.z,i.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class yc extends sc{constructor(e=new nn,t=new nn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new nn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new nn){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ec extends sc{constructor(e=new Dn,t=new Dn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Dn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Dn){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class _c extends sc{constructor(e=new nn,t=new nn,n=new nn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new nn){const n=t,r=this.v0,i=this.v1,s=this.v2;return n.set(mc(e,r.x,i.x,s.x),mc(e,r.y,i.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class xc extends sc{constructor(e=new Dn,t=new Dn,n=new Dn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Dn){const n=t,r=this.v0,i=this.v1,s=this.v2;return n.set(mc(e,r.x,i.x,s.x),mc(e,r.y,i.y,s.y),mc(e,r.z,i.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class bc extends sc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new nn){const n=t,r=this.points,i=(r.length-1)*e,s=Math.floor(i),a=i-s,o=r[0===s?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return n.set(pc(a,o.x,l.x,c.x,u.x),pc(a,o.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new nn).fromArray(n))}return this}}var Sc=Object.freeze({__proto__:null,ArcCurve:oc,CatmullRomCurve3:fc,CubicBezierCurve:Ac,CubicBezierCurve3:vc,EllipseCurve:ac,LineCurve:yc,LineCurve3:Ec,QuadraticBezierCurve:_c,QuadraticBezierCurve3:xc,SplineCurve:bc});class wc extends sc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Sc[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,s=this.curves[i],a=s.getLength(),o=0===a?0:1-e/a;return s.getPointAt(o,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const s=i[r],a=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){const r=o[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Sc[n.type]).fromJSON(n))}return this}}class Cc extends wc{constructor(e){super(),this.type="Path",this.currentPoint=new nn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new yc(this.currentPoint.clone(),new nn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new _c(this.currentPoint.clone(),new nn(e,t),new nn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,s){const a=new Ac(this.currentPoint.clone(),new nn(e,t),new nn(n,r),new nn(i,s));return this.curves.push(a),this.currentPoint.set(i,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new bc(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,r,i,s),this}absarc(e,t,n,r,i,s){return this.absellipse(e,t,n,n,r,i,s),this}ellipse(e,t,n,r,i,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,s,a,o),this}absellipse(e,t,n,r,i,s,a,o){const l=new ac(e,t,n,r,i,s,a,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Tc extends Ei{constructor(e=[new nn(0,-.5),new nn(.5,0),new nn(0,.5)],t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Yt(r,0,2*Math.PI);const i=[],s=[],a=[],o=[],l=[],c=1/t,u=new Dn,h=new nn,d=new Dn,f=new Dn,p=new Dn;let m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(p.x,p.y,p.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),o.push(d.x,d.y,d.z),p.copy(f)}for(let i=0;i<=t;i++){const d=n+i*c*r,f=Math.sin(d),p=Math.cos(d);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*f,u.y=e[n].y,u.z=e[n].x*p,s.push(u.x,u.y,u.z),h.x=i/t,h.y=n/(e.length-1),a.push(h.x,h.y);const r=o[3*n+0]*f,c=o[3*n+1],d=o[3*n+0]*p;l.push(r,c,d)}}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,s=r,a=r+e.length,o=r+e.length+1,l=r+1;i.push(s,a,l),i.push(o,l,a)}this.setIndex(i),this.setAttribute("position",new di(s,3)),this.setAttribute("uv",new di(a,2)),this.setAttribute("normal",new di(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Tc(e.points,e.segments,e.phiStart,e.phiLength)}}class Mc extends Tc{constructor(e=1,t=1,n=4,r=8){const i=new Cc;i.absarc(0,-t/2,e,1.5*Math.PI,0),i.absarc(0,t/2,e,0,.5*Math.PI),super(i.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:r}}static fromJSON(e){return new Mc(e.radius,e.length,e.capSegments,e.radialSegments)}}class Ic extends Ei{constructor(e=1,t=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],s=[],a=[],o=[],l=new Dn,c=new nn;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){const h=n+i/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[u]/e+1)/2,c.y=(s[u+1]/e+1)/2,o.push(c.x,c.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new di(s,3)),this.setAttribute("normal",new di(a,3)),this.setAttribute("uv",new di(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ic(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Rc extends Ei{constructor(e=1,t=1,n=1,r=32,i=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:o};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],d=[];let f=0;const p=[],m=n/2;let g=0;function A(n){const i=f,s=new nn,p=new Dn;let A=0;const v=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*y,0),h.push(0,y,0),d.push(.5,.5),f++;const E=f;for(let e=0;e<=r;e++){const t=e/r*o+a,n=Math.cos(t),i=Math.sin(t);p.x=v*i,p.y=m*y,p.z=v*n,u.push(p.x,p.y,p.z),h.push(0,y,0),s.x=.5*n+.5,s.y=.5*i*y+.5,d.push(s.x,s.y),f++}for(let e=0;e<r;e++){const t=i+e,r=E+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),A+=3}l.addGroup(g,A,!0===n?1:2),g+=A}!function(){const s=new Dn,A=new Dn;let v=0;const y=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,v=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*o+a,l=Math.sin(i),p=Math.cos(i);A.x=v*l,A.y=-g*n+m,A.z=v*p,u.push(A.x,A.y,A.z),s.set(l,y,p).normalize(),h.push(s.x,s.y,s.z),d.push(t,1-g),c.push(f++)}p.push(c)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=p[t][e],r=p[t+1][e],i=p[t+1][e+1],s=p[t][e+1];c.push(n,r,s),c.push(r,i,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(e>0&&A(!0),t>0&&A(!1)),this.setIndex(c),this.setAttribute("position",new di(u,3)),this.setAttribute("normal",new di(h,3)),this.setAttribute("uv",new di(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rc(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Bc extends Rc{constructor(e=1,t=1,n=32,r=1,i=!1,s=0,a=2*Math.PI){super(0,e,t,n,r,i,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:a}}static fromJSON(e){return new Bc(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Pc extends Ei{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],s=[];function a(e,t,n,r){const i=r+1,s=[];for(let r=0;r<=i;r++){s[r]=[];const a=e.clone().lerp(n,r/i),o=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)s[r][e]=0===e&&r===i?a:a.clone().lerp(o,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(o(s[e][n+1]),o(s[e+1][n]),o(s[e][n])):(o(s[e][n+1]),o(s[e+1][n+1]),o(s[e+1][n]))}}function o(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const n=new Dn,r=new Dn,i=new Dn;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],r),l(t[s+2],i),a(n,r,i,e)}(r),function(e){const t=new Dn;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new Dn;for(let t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];const n=u(e)/2/Math.PI+.5,r=h(e)/Math.PI+.5;s.push(n,1-r)}(function(){const e=new Dn,t=new Dn,n=new Dn,r=new Dn,a=new nn,o=new nn,l=new nn;for(let h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),r.copy(e).add(t).add(n).divideScalar(3);const f=u(r);c(a,d+0,e,f),c(o,d+2,t,f),c(l,d+4,n,f)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],r=s[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),r<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new di(i,3)),this.setAttribute("normal",new di(i.slice(),3)),this.setAttribute("uv",new di(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pc(e.vertices,e.indices,e.radius,e.details)}}class Dc extends Pc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Dc(e.radius,e.detail)}}const Lc=new Dn,kc=new Dn,Fc=new Dn,Oc=new Wr;class Uc extends Ei{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),i=Math.cos(Vt*t),s=e.getIndex(),a=e.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let e=0;e<o;e+=3){s?(l[0]=s.getX(e),l[1]=s.getX(e+1),l[2]=s.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:o}=Oc;if(t.fromBufferAttribute(a,l[0]),n.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),Oc.getNormal(Fc),u[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,u[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,u[2]=`${Math.round(o.x*r)},${Math.round(o.y*r)},${Math.round(o.z*r)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],r=u[t],s=Oc[c[e]],a=Oc[c[t]],o=`${n}_${r}`,f=`${r}_${n}`;f in h&&h[f]?(Fc.dot(h[f].normal)<=i&&(d.push(s.x,s.y,s.z),d.push(a.x,a.y,a.z)),h[f]=null):o in h||(h[o]={index0:l[e],index1:l[t],normal:Fc.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];Lc.fromBufferAttribute(a,t),kc.fromBufferAttribute(a,n),d.push(Lc.x,Lc.y,Lc.z),d.push(kc.x,kc.y,kc.z)}this.setAttribute("position",new di(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Nc extends Cc{constructor(e){super(e),this.uuid=Wt(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Cc).fromJSON(n))}return this}}const zc=function(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let s=Gc(e,0,i,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,f;if(r&&(s=function(e,t,n,r){const i=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=Gc(e,o,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Jc(c));for(i.sort(Kc),s=0;s<i.length;s++)n=qc(i[s],n);return n}(e,t,s,n)),e.length>80*n){o=c=e[0],l=u=e[1];for(let t=n;t<i;t+=n)h=e[t],d=e[t+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-o,u-l),f=0!==f?32767/f:0}return Hc(s,a,n,o,l,f,0),a};function Gc(e,t,n,r,i){let s,a;if(i===function(e,t,n,r){let i=0;for(let s=t,a=n-r;s<n;s+=r)i+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return i}(e,t,n,r)>0)for(s=t;s<n;s+=r)a=lu(s,e[s],e[s+1],a);else for(s=n-r;s>=t;s-=r)a=lu(s,e[s],e[s+1],a);return a&&nu(a,a.next)&&(cu(a),a=a.next),a}function Qc(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!nu(r,r.next)&&0!==tu(r.prev,r,r.next))r=r.next;else{if(cu(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Hc(e,t,n,r,i,s,a){if(!e)return;!a&&s&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=$c(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,s,a,o,l,c=1;do{for(n=e,e=null,s=null,a=0;n;){for(a++,r=n,o=0,t=0;t<c&&(o++,r=r.nextZ,r);t++);for(l=c;o>0||l>0&&r;)0!==o&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,o--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,s);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,s?jc(e,r,i,s):Vc(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),cu(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?Hc(e=Wc(Qc(e),t,n),t,n,r,i,s,2):2===a&&Yc(e,t,n,r,i,s):Hc(Qc(e),t,n,r,i,s,1);break}}function Vc(e){const t=e.prev,n=e,r=e.next;if(tu(t,n,r)>=0)return!1;const i=t.x,s=n.x,a=r.x,o=t.y,l=n.y,c=r.y,u=i<s?i<a?i:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=i>s?i>a?i:a:s>a?s:a,f=o>l?o>c?o:c:l>c?l:c;let p=r.next;for(;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&Zc(i,o,s,l,a,c,p.x,p.y)&&tu(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function jc(e,t,n,r){const i=e.prev,s=e,a=e.next;if(tu(i,s,a)>=0)return!1;const o=i.x,l=s.x,c=a.x,u=i.y,h=s.y,d=a.y,f=o<l?o<c?o:c:l<c?l:c,p=u<h?u<d?u:d:h<d?h:d,m=o>l?o>c?o:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,A=$c(f,p,t,n,r),v=$c(m,g,t,n,r);let y=e.prevZ,E=e.nextZ;for(;y&&y.z>=A&&E&&E.z<=v;){if(y.x>=f&&y.x<=m&&y.y>=p&&y.y<=g&&y!==i&&y!==a&&Zc(o,u,l,h,c,d,y.x,y.y)&&tu(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,E.x>=f&&E.x<=m&&E.y>=p&&E.y<=g&&E!==i&&E!==a&&Zc(o,u,l,h,c,d,E.x,E.y)&&tu(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;y&&y.z>=A;){if(y.x>=f&&y.x<=m&&y.y>=p&&y.y<=g&&y!==i&&y!==a&&Zc(o,u,l,h,c,d,y.x,y.y)&&tu(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;E&&E.z<=v;){if(E.x>=f&&E.x<=m&&E.y>=p&&E.y<=g&&E!==i&&E!==a&&Zc(o,u,l,h,c,d,E.x,E.y)&&tu(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function Wc(e,t,n){let r=e;do{const i=r.prev,s=r.next.next;!nu(i,s)&&ru(i,r,r.next,s)&&au(i,s)&&au(s,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(s.i/n|0),cu(r),cu(r.next),r=e=s),r=r.next}while(r!==e);return Qc(r)}function Yc(e,t,n,r,i,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&eu(a,e)){let o=ou(a,e);return a=Qc(a,a.next),o=Qc(o,o.next),Hc(a,t,n,r,i,s,0),void Hc(o,t,n,r,i,s,0)}e=e.next}a=a.next}while(a!==e)}function Kc(e,t){return e.x-t.x}function qc(e,t){const n=function(e,t){let n,r=t,i=-1/0;const s=e.x,a=e.y;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){const e=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=s&&e>i&&(i=e,n=r.x<r.next.x?r:r.next,e===s))return n}r=r.next}while(r!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let u,h=1/0;r=n;do{s>=r.x&&r.x>=l&&s!==r.x&&Zc(a<c?s:i,a,l,c,a<c?i:s,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(s-r.x),au(r,e)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&Xc(n,r)))&&(n=r,h=u)),r=r.next}while(r!==o);return n}(e,t);if(!n)return t;const r=ou(n,e);return Qc(r,r.next),Qc(n,n.next)}function Xc(e,t){return tu(e.prev,e,t.prev)<0&&tu(t.next,e,e.next)<0}function $c(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Jc(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Zc(e,t,n,r,i,s,a,o){return(i-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(i-a)*(r-o)}function eu(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ru(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(au(e,t)&&au(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(tu(e.prev,e,t.prev)||tu(e,t.prev,t))||nu(e,t)&&tu(e.prev,e,e.next)>0&&tu(t.prev,t,t.next)>0)}function tu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function nu(e,t){return e.x===t.x&&e.y===t.y}function ru(e,t,n,r){const i=su(tu(e,t,n)),s=su(tu(e,t,r)),a=su(tu(n,r,e)),o=su(tu(n,r,t));return i!==s&&a!==o||(!(0!==i||!iu(e,n,t))||(!(0!==s||!iu(e,r,t))||(!(0!==a||!iu(n,e,r))||!(0!==o||!iu(n,t,r)))))}function iu(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function su(e){return e>0?1:e<0?-1:0}function au(e,t){return tu(e.prev,e,e.next)<0?tu(e,t,e.next)>=0&&tu(e,e.prev,t)>=0:tu(e,t,e.prev)<0||tu(e,e.next,t)<0}function ou(e,t){const n=new uu(e.i,e.x,e.y),r=new uu(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function lu(e,t,n,r){const i=new uu(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function cu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function uu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class hu{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return hu.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];du(e),fu(n,e);let s=e.length;t.forEach(du);for(let e=0;e<t.length;e++)r.push(s),s+=t[e].length,fu(n,t[e]);const a=zc(n,r);for(let e=0;e<a.length;e+=3)i.push(a.slice(e,e+3));return i}}function du(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function fu(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class pu extends Ei{constructor(e=new Nc([new nn(.5,.5),new nn(-.5,.5),new nn(-.5,-.5),new nn(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++){s(e[t])}function s(e){const s=[],a=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:mu;let g,A,v,y,E,_=!1;p&&(g=p.getSpacedPoints(o),_=!0,c=!1,A=p.computeFrenetFrames(o,!1),v=new Dn,y=new Dn,E=new Dn),c||(f=0,u=0,h=0,d=0);const x=e.extractPoints(a);let b=x.shape;const S=x.holes;if(!hu.isClockWise(b)){b=b.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];hu.isClockWise(t)&&(S[e]=t.reverse())}}const w=hu.triangulateShape(b,S),C=b;for(let e=0,t=S.length;e<t;e++){const t=S[e];b=b.concat(t)}function T(e,t,n){return e.clone().addScaledVector(t,n)}const M=b.length,I=w.length;function R(e,t,n){let r,i,s;const a=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=a*a+o*o,h=a*c-o*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),f=t.x-o/h,p=t.y+a/h,m=((n.x-c/d-f)*c-(n.y+l/d-p)*l)/(a*c-o*l);r=f+a*m-e.x,i=p+o*m-e.y;const g=r*r+i*i;if(g<=2)return new nn(r,i);s=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(r=-o,i=a,s=Math.sqrt(u)):(r=a,i=o,s=Math.sqrt(u/2))}return new nn(r/s,i/s)}const B=[];for(let e=0,t=C.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),B[e]=R(C[e],C[n],C[r]);const P=[];let D,L=B.concat();for(let e=0,t=S.length;e<t;e++){const t=S[e];D=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),D[e]=R(t[e],t[r],t[i]);P.push(D),L=L.concat(D)}for(let e=0;e<f;e++){const t=e/f,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=C.length;e<t;e++){const t=T(C[e],B[e],r);O(t.x,t.y,-n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];D=P[e];for(let e=0,i=t.length;e<i;e++){const i=T(t[e],D[e],r);O(i.x,i.y,-n)}}}const k=h+d;for(let e=0;e<M;e++){const t=c?T(b[e],L[e],k):b[e];_?(y.copy(A.normals[0]).multiplyScalar(t.x),v.copy(A.binormals[0]).multiplyScalar(t.y),E.copy(g[0]).add(y).add(v),O(E.x,E.y,E.z)):O(t.x,t.y,0)}for(let e=1;e<=o;e++)for(let t=0;t<M;t++){const n=c?T(b[t],L[t],k):b[t];_?(y.copy(A.normals[e]).multiplyScalar(n.x),v.copy(A.binormals[e]).multiplyScalar(n.y),E.copy(g[e]).add(y).add(v),O(E.x,E.y,E.z)):O(n.x,n.y,l/o*e)}for(let e=f-1;e>=0;e--){const t=e/f,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=C.length;e<t;e++){const t=T(C[e],B[e],r);O(t.x,t.y,l+n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];D=P[e];for(let e=0,i=t.length;e<i;e++){const i=T(t[e],D[e],r);_?O(i.x,i.y+g[o-1].y,g[o-1].x+n):O(i.x,i.y,l+n)}}}function F(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=o+2*f;e<n;e++){const n=M*e,s=M*(e+1);N(t+r+n,t+i+n,t+i+s,t+r+s)}}}function O(e,t,n){s.push(e),s.push(t),s.push(n)}function U(e,t,i){z(e),z(t),z(i);const s=r.length/3,a=m.generateTopUV(n,r,s-3,s-2,s-1);G(a[0]),G(a[1]),G(a[2])}function N(e,t,i,s){z(e),z(t),z(s),z(t),z(i),z(s);const a=r.length/3,o=m.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);G(o[0]),G(o[1]),G(o[3]),G(o[1]),G(o[2]),G(o[3])}function z(e){r.push(s[3*e+0]),r.push(s[3*e+1]),r.push(s[3*e+2])}function G(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=M*e;for(let e=0;e<I;e++){const n=w[e];U(n[2]+t,n[1]+t,n[0]+t)}e=o+2*f,t=M*e;for(let e=0;e<I;e++){const n=w[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<I;e++){const t=w[e];U(t[2],t[1],t[0])}for(let e=0;e<I;e++){const t=w[e];U(t[0]+M*o,t[1]+M*o,t[2]+M*o)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;F(C,t),t+=C.length;for(let e=0,n=S.length;e<n;e++){const n=S[e];F(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new di(r,3)),this.setAttribute("uv",new di(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new Sc[r.type]).fromJSON(r)),new pu(n,e.options)}}const mu={generateTopUV:function(e,t,n,r,i){const s=t[3*n],a=t[3*n+1],o=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new nn(s,a),new nn(o,l),new nn(c,u)]},generateSideWallUV:function(e,t,n,r,i,s){const a=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*s],g=t[3*s+1],A=t[3*s+2];return Math.abs(o-u)<Math.abs(a-c)?[new nn(a,1-l),new nn(c,1-h),new nn(d,1-p),new nn(m,1-A)]:[new nn(o,1-l),new nn(u,1-h),new nn(f,1-p),new nn(g,1-A)]}};class gu extends Pc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new gu(e.radius,e.detail)}}class Au extends Pc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Au(e.radius,e.detail)}}class vu extends Ei{constructor(e=.5,t=1,n=32,r=1,i=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},n=Math.max(3,n);const a=[],o=[],l=[],c=[];let u=e;const h=(t-e)/(r=Math.max(1,r)),d=new Dn,f=new nn;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*s;d.x=u*Math.cos(r),d.y=u*Math.sin(r),o.push(d.x,d.y,d.z),l.push(0,0,1),f.x=(d.x/t+1)/2,f.y=(d.y/t+1)/2,c.push(f.x,f.y)}u+=h}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,s=r+n+1,o=r+n+2,l=r+1;a.push(i,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new di(o,3)),this.setAttribute("normal",new di(l,3)),this.setAttribute("uv",new di(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vu(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class yu extends Ei{constructor(e=new Nc([new nn(0,.5),new nn(-.5,-.5),new nn(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],s=[];let a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,o,t),a+=o,o=0;function l(e){const a=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===hu.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===hu.isClockWise(t)&&(u[e]=t.reverse())}const h=hu.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];r.push(t.x,t.y,0),i.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+a,i=t[1]+a,s=t[2]+a;n.push(r,i,s),o+=3}}this.setIndex(n),this.setAttribute("position",new di(r,3)),this.setAttribute("normal",new di(i,3)),this.setAttribute("uv",new di(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new yu(n,e.curveSegments)}}class Eu extends Ei{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const c=[],u=new Dn,h=new Dn,d=[],f=[],p=[],m=[];for(let d=0;d<=n;d++){const g=[],A=d/n;let v=0;0===d&&0===s?v=.5/t:d===n&&o===Math.PI&&(v=-.5/t);for(let n=0;n<=t;n++){const o=n/t;u.x=-e*Math.cos(r+o*i)*Math.sin(s+A*a),u.y=e*Math.cos(s+A*a),u.z=e*Math.sin(r+o*i)*Math.sin(s+A*a),f.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),m.push(o+v,1-A),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=c[e][r+1],i=c[e][r],a=c[e+1][r],l=c[e+1][r+1];(0!==e||s>0)&&d.push(t,i,l),(e!==n-1||o<Math.PI)&&d.push(i,a,l)}this.setIndex(d),this.setAttribute("position",new di(f,3)),this.setAttribute("normal",new di(p,3)),this.setAttribute("uv",new di(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Eu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class _u extends Pc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _u(e.radius,e.detail)}}class xu extends Ei{constructor(e=1,t=.4,n=12,r=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],o=[],l=[],c=new Dn,u=new Dn,h=new Dn;for(let s=0;s<=n;s++)for(let d=0;d<=r;d++){const f=d/r*i,p=s/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(f),u.y=(e+t*Math.cos(p))*Math.sin(f),u.z=t*Math.sin(p),a.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(d/r),l.push(s/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,a=(r+1)*(e-1)+t,o=(r+1)*e+t;s.push(n,i,o),s.push(i,a,o)}this.setIndex(s),this.setAttribute("position",new di(a,3)),this.setAttribute("normal",new di(o,3)),this.setAttribute("uv",new di(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xu(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class bu extends Ei{constructor(e=1,t=.4,n=64,r=8,i=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:s},n=Math.floor(n),r=Math.floor(r);const a=[],o=[],l=[],c=[],u=new Dn,h=new Dn,d=new Dn,f=new Dn,p=new Dn,m=new Dn,g=new Dn;for(let a=0;a<=n;++a){const v=a/n*i*Math.PI*2;A(v,i,s,e,d),A(v+.01,i,s,e,f),m.subVectors(f,d),g.addVectors(f,d),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,s=-t*Math.cos(i),f=t*Math.sin(i);u.x=d.x+(s*g.x+f*p.x),u.y=d.y+(s*g.y+f*p.y),u.z=d.z+(s*g.z+f*p.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(a/n),c.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),s=(r+1)*e+t,o=(r+1)*(e-1)+t;a.push(n,i,o),a.push(i,s,o)}function A(e,t,n,r,i){const s=Math.cos(e),a=Math.sin(e),o=n/t*e,l=Math.cos(o);i.x=r*(2+l)*.5*s,i.y=r*(2+l)*a*.5,i.z=r*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new di(o,3)),this.setAttribute("normal",new di(l,3)),this.setAttribute("uv",new di(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bu(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Su extends Ei{constructor(e=new xc(new Dn(-1,-1,0),new Dn(-1,1,0),new Dn(1,1,0)),t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const s=e.computeFrenetFrames(t,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new Dn,o=new Dn,l=new nn;let c=new Dn;const u=[],h=[],d=[],f=[];function p(i){c=e.getPointAt(i/t,c);const l=s.normals[i],d=s.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),s=-Math.cos(t);o.x=s*l.x+i*d.x,o.y=s*l.y+i*d.y,o.z=s*l.z+i*d.z,o.normalize(),h.push(o.x,o.y,o.z),a.x=c.x+n*o.x,a.y=c.y+n*o.y,a.z=c.z+n*o.z,u.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),s=(r+1)*e+t,a=(r+1)*(e-1)+t;f.push(n,i,a),f.push(i,s,a)}}()}(),this.setIndex(f),this.setAttribute("position",new di(u,3)),this.setAttribute("normal",new di(h,3)),this.setAttribute("uv",new di(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Su((new Sc[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class wu extends Ei{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new Dn,i=new Dn;if(null!==e.index){const s=e.attributes.position,a=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){const l=o[e],c=l.start;for(let e=c,o=c+l.count;e<o;e+=3)for(let o=0;o<3;o++){const l=a.getX(e+o),c=a.getX(e+(o+1)%3);r.fromBufferAttribute(s,l),i.fromBufferAttribute(s,c),!0===Cu(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const s=e.attributes.position;for(let e=0,a=s.count/3;e<a;e++)for(let a=0;a<3;a++){const o=3*e+a,l=3*e+(a+1)%3;r.fromBufferAttribute(s,o),i.fromBufferAttribute(s,l),!0===Cu(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new di(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Cu(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var Tu=Object.freeze({__proto__:null,BoxGeometry:zi,CapsuleGeometry:Mc,CircleGeometry:Ic,ConeGeometry:Bc,CylinderGeometry:Rc,DodecahedronGeometry:Dc,EdgesGeometry:Uc,ExtrudeGeometry:pu,IcosahedronGeometry:gu,LatheGeometry:Tc,OctahedronGeometry:Au,PlaneGeometry:os,PolyhedronGeometry:Pc,RingGeometry:vu,ShapeGeometry:yu,SphereGeometry:Eu,TetrahedronGeometry:_u,TorusGeometry:xu,TorusKnotGeometry:bu,TubeGeometry:Su,WireframeGeometry:wu});class Mu extends ei{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new $r(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Iu extends ji{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Ru extends ei{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new $r(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Bu extends Ru{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new nn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Yt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new $r(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new $r(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new $r(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Pu extends ei{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new $r(16777215),this.specular=new $r(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Du extends ei{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new $r(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Lu extends ei{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class ku extends ei{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new $r(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Fu extends ei{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new $r(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ou extends Ul{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Uu(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Nu(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function zu(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort(function(t,n){return e[t]-e[n]}),n}function Gu(e,t,n){const r=e.length,i=new e.constructor(r);for(let s=0,a=0;a!==r;++s){const r=n[s]*t;for(let n=0;n!==t;++n)i[a++]=e[r+n]}return i}function Qu(e,t,n,r){let i=1,s=e[0];for(;void 0!==s&&void 0===s[r];)s=e[i++];if(void 0===s)return;let a=s[r];if(void 0!==a)if(Array.isArray(a))do{a=s[r],void 0!==a&&(t.push(s.time),n.push.apply(n,a)),s=e[i++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[r],void 0!==a&&(t.push(s.time),a.toArray(n,n.length)),s=e[i++]}while(void 0!==s);else do{a=s[r],void 0!==a&&(t.push(s.time),n.push(a)),s=e[i++]}while(void 0!==s)}const Hu={convertArray:Uu,isTypedArray:Nu,getKeyframeOrder:zu,sortedArray:Gu,flattenJSON:Qu,subclip:function(e,t,n,r,i=30){const s=e.clone();s.name=t;const a=[];for(let e=0;e<s.tracks.length;++e){const t=s.tracks[e],o=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const s=t.times[e]*i;if(!(s<n||s>=r)){l.push(t.times[e]);for(let n=0;n<o;++n)c.push(t.values[e*o+n])}}0!==l.length&&(t.times=Uu(l,t.times.constructor),t.values=Uu(c,t.values.constructor),a.push(t))}s.tracks=a;let o=1/0;for(let e=0;e<s.tracks.length;++e)o>s.tracks[e].times[0]&&(o=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,s=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const a=e.tracks.find(function(e){return e.name===r.name&&e.ValueTypeName===i});if(void 0===a)continue;let o=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let d;if(s<=r.times[0]){const e=o,t=l-o;d=r.values.slice(e,t)}else if(s>=r.times[h]){const e=h*l+o,t=e+l-o;d=r.values.slice(e,t)}else{const e=r.createInterpolant(),t=o,n=l-o;e.evaluate(s),d=e.resultBuffer.slice(t,n)}if("quaternion"===i){(new Pn).fromArray(d).normalize().conjugate().toArray(d)}const f=a.times.length;for(let e=0;e<f;++e){const t=e*u+c;if("quaternion"===i)Pn.multiplyQuaternionsFlat(a.values,t,d,0,a.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)a.values[t+n]-=d[n]}}}return e.blendMode=ht,e}};class Vu{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let s;n:{r:if(!(e<r)){for(let s=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(i=r,r=t[++n],e<r)break t}s=t.length;break n}if(!(e>=i)){const a=t[1];e<a&&(n=2,i=a);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(r=i,i=t[--n-1],e>=i)break t}s=n,n=0;break n}break e}for(;n<s;){const r=n+s>>>1;e<t[r]?s=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ju extends Vu{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ot,endingEnd:ot}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,s=e+1,a=r[i],o=r[s];if(void 0===a)switch(this.getSettings_().endingStart){case lt:i=e,a=2*t-n;break;case ct:i=r.length-2,a=t+r[i]-r[i+1];break;default:i=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case lt:s=e,o=2*n-t;break;case ct:s=1,o=n+r[1]-r[0];break;default:s=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=i*c,this._offsetNext=s*c}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,A=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,v=(-1-d)*m+(1.5+d)*p+.5*f,y=d*m-d*p;for(let e=0;e!==a;++e)i[e]=g*s[c+e]+A*s[l+e]+v*s[o+e]+y*s[u+e];return i}}class Wu extends Vu{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==a;++e)i[e]=s[l+e]*u+s[o+e]*c;return i}}class Yu extends Vu{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ku{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Uu(t,this.TimeBufferType),this.values=Uu(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Uu(e.times,Array),values:Uu(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Yu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Wu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new ju(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case it:t=this.InterpolantFactoryMethodDiscrete;break;case st:t=this.InterpolantFactoryMethodLinear;break;case at:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return it;case this.InterpolantFactoryMethodLinear:return st;case this.InterpolantFactoryMethodSmooth:return at}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const e=this.getValueSize();this.times=n.slice(i,s),this.values=this.values.slice(i*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(e=!1);let s=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){e=!1;break}if(null!==s&&s>r){e=!1;break}s=r}if(void 0!==r&&Nu(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===at,i=e.length-1;let s=1;for(let a=1;a<i;++a){let i=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(r)i=!0;else{const e=a*n,r=e-n,s=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[r+a]||n!==t[s+a]){i=!0;break}}}if(i){if(a!==s){e[s]=e[a];const r=a*n,i=s*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++s}}if(i>0){e[s]=e[i];for(let e=i*n,r=s*n,a=0;a!==n;++a)t[r+a]=t[e+a];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Ku.prototype.TimeBufferType=Float32Array,Ku.prototype.ValueBufferType=Float32Array,Ku.prototype.DefaultInterpolation=st;class qu extends Ku{}qu.prototype.ValueTypeName="bool",qu.prototype.ValueBufferType=Array,qu.prototype.DefaultInterpolation=it,qu.prototype.InterpolantFactoryMethodLinear=void 0,qu.prototype.InterpolantFactoryMethodSmooth=void 0;class Xu extends Ku{}Xu.prototype.ValueTypeName="color";class $u extends Ku{}$u.prototype.ValueTypeName="number";class Ju extends Vu{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(r-t);let l=e*a;for(let e=l+a;l!==e;l+=4)Pn.slerpFlat(i,0,s,l-a,s,l,o);return i}}class Zu extends Ku{InterpolantFactoryMethodLinear(e){return new Ju(this.times,this.values,this.getValueSize(),e)}}Zu.prototype.ValueTypeName="quaternion",Zu.prototype.DefaultInterpolation=st,Zu.prototype.InterpolantFactoryMethodSmooth=void 0;class eh extends Ku{}eh.prototype.ValueTypeName="string",eh.prototype.ValueBufferType=Array,eh.prototype.DefaultInterpolation=it,eh.prototype.InterpolantFactoryMethodLinear=void 0,eh.prototype.InterpolantFactoryMethodSmooth=void 0;class th extends Ku{}th.prototype.ValueTypeName="vector";class nh{constructor(e,t=-1,n,r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Wt(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(rh(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Ku.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,s=[];for(let e=0;e<i;e++){let a=[],o=[];a.push((e+i-1)%i,e,(e+1)%i),o.push(0,1,0);const l=zu(a);a=Gu(a,1,l),o=Gu(o,1,l),r||0!==a[0]||(a.push(i),o.push(o[0])),s.push(new $u(".morphTargetInfluences["+t[e].name+"]",a,o).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.name.match(i);if(s&&s.length>1){const e=s[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const s=[];for(const e in r)s.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return s}static parseAnimation(e,t){if(!e)return null;const n=function(e,t,n,r,i){if(0!==n.length){const s=[],a=[];Qu(n,s,a,r),0!==s.length&&i.push(new e(t,s,a))}},r=[],i=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],s=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),s.push(r.morphTarget===n?1:0)}r.push(new $u(".morphTargetInfluence["+n+"]",e,s))}o=e.length*s}else{const s=".bones["+t[e].name+"]";n(th,s+".position",i,"pos",r),n(Zu,s+".quaternion",i,"rot",r),n(th,s+".scale",i,"scl",r)}}if(0===r.length)return null;return new this(i,o,r,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function rh(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return $u;case"vector":case"vector2":case"vector3":case"vector4":return th;case"color":return Xu;case"quaternion":return Zu;case"bool":case"boolean":return qu;case"string":return eh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Qu(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const ih={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class sh{constructor(e,t,n){const r=this;let i,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===s&&void 0!==r.onStart&&r.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const ah=new sh;class oh{constructor(e){this.manager=void 0!==e?e:ah,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,i){n.load(e,r,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}oh.DEFAULT_MATERIAL_NAME="__DEFAULT";const lh={};class ch extends Error{constructor(e,t){super(e),this.response=t}}class uh extends oh{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=ih.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;if(void 0!==lh[e])return void lh[e].push({onLoad:t,onProgress:n,onError:r});lh[e]=[],lh[e].push({onLoad:t,onProgress:n,onError:r});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(t=>{if(200===t.status||0===t.status){if(t.status,"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=lh[e],r=t.body.getReader(),i=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),s=i?parseInt(i):0,a=0!==s;let o=0;const l=new ReadableStream({start(e){!function t(){r.read().then(({done:r,value:i})=>{if(r)e.close();else{o+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(i),t()}})}()}});return new Response(l)}throw new ch(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,a));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then(e=>r.decode(e))}}}).then(t=>{ih.add(e,t);const n=lh[e];delete lh[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}}).catch(t=>{const n=lh[e];if(void 0===n)throw this.manager.itemError(e),t;delete lh[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class hh extends oh{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,s=ih.get(e);if(void 0!==s)return i.manager.itemStart(e),setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s;const a=cn("img");function o(){c(),ih.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){c(),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}class dh extends oh{constructor(e){super(e)}load(e,t,n,r){const i=new Xi;i.colorSpace=gt;const s=new hh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(n){s.load(e[n],function(e){i.images[n]=e,a++,6===a&&(i.needsUpdate=!0,t&&t(i))},void 0,r)}for(let t=0;t<e.length;++t)o(t);return i}}class fh extends oh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new wl,a=new uh(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(e,function(e){let n;try{n=i.parse(e)}catch(e){if(void 0===r)return;r(e)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:Z,s.wrapT=void 0!==n.wrapT?n.wrapT:Z,s.magFilter=void 0!==n.magFilter?n.magFilter:ie,s.minFilter=void 0!==n.minFilter?n.minFilter:ie,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?s.colorSpace=n.colorSpace:void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=ae),1===n.mipmapCount&&(s.minFilter=ie),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,t&&t(s,n)},n,r),s}}class ph extends oh{constructor(e){super(e)}load(e,t,n,r){const i=new Cn,s=new hh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}}class mh extends Lr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new $r(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class gh extends mh{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Lr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new $r(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Ah=new cr,vh=new Dn,yh=new Dn;class Eh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new nn(512,512),this.map=null,this.mapPass=null,this.matrix=new cr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new is,this._frameExtents=new nn(1,1),this._viewportCount=1,this._viewports=[new Tn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;vh.setFromMatrixPosition(e.matrixWorld),t.position.copy(vh),yh.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(yh),t.updateMatrixWorld(),Ah.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ah),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Ah)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class _h extends Eh{constructor(){super(new Yi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*jt*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class xh extends mh{constructor(e,t,n=0,r=Math.PI/3,i=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Lr.DEFAULT_UP),this.updateMatrix(),this.target=new Lr,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.map=null,this.shadow=new _h}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const bh=new cr,Sh=new Dn,wh=new Dn;class Ch extends Eh{constructor(){super(new Yi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new nn(4,2),this._viewportCount=6,this._viewports=[new Tn(2,1,1,1),new Tn(0,1,1,1),new Tn(3,1,1,1),new Tn(1,1,1,1),new Tn(3,0,1,1),new Tn(1,0,1,1)],this._cubeDirections=[new Dn(1,0,0),new Dn(-1,0,0),new Dn(0,0,1),new Dn(0,0,-1),new Dn(0,1,0),new Dn(0,-1,0)],this._cubeUps=[new Dn(0,1,0),new Dn(0,1,0),new Dn(0,1,0),new Dn(0,1,0),new Dn(0,0,1),new Dn(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Sh.setFromMatrixPosition(e.matrixWorld),n.position.copy(Sh),wh.copy(n.position),wh.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(wh),n.updateMatrixWorld(),r.makeTranslation(-Sh.x,-Sh.y,-Sh.z),bh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(bh)}}class Th extends mh{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Ch}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Mh extends Eh{constructor(){super(new vs(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Ih extends mh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Lr.DEFAULT_UP),this.updateMatrix(),this.target=new Lr,this.shadow=new Mh}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Rh extends mh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Bh extends mh{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Ph{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Dn)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*r),t.addScaledVector(s[2],.488603*i),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],n*r*1.092548),t.addScaledVector(s[5],r*i*1.092548),t.addScaledVector(s[6],.315392*(3*i*i-1)),t.addScaledVector(s[7],n*i*1.092548),t.addScaledVector(s[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*r),t.addScaledVector(s[2],1.023328*i),t.addScaledVector(s[3],1.023328*n),t.addScaledVector(s[4],.858086*n*r),t.addScaledVector(s[5],.858086*r*i),t.addScaledVector(s[6],.743125*i*i-.247708),t.addScaledVector(s[7],.858086*n*i),t.addScaledVector(s[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}class Dh extends mh{constructor(e=new Ph,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Lh extends oh{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,s=new uh(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r&&r(t),i.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(e){return t[e],t[e]}const r=Lh.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new $r).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(r.depthFunc=e.depthFunc),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(r.blendSrc=e.blendSrc),void 0!==e.blendDst&&(r.blendDst=e.blendDst),void 0!==e.blendEquation&&(r.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(r.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(r.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(r.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(r.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),void 0!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new $r).setHex(i.value);break;case"v2":r.uniforms[t].value=(new nn).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new Dn).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new Tn).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new rn).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new cr).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new nn).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new nn).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:Mu,SpriteMaterial:qo,RawShaderMaterial:Iu,ShaderMaterial:ji,PointsMaterial:ql,MeshPhysicalMaterial:Bu,MeshStandardMaterial:Ru,MeshPhongMaterial:Pu,MeshToonMaterial:Du,MeshNormalMaterial:Lu,MeshLambertMaterial:ku,MeshDepthMaterial:To,MeshDistanceMaterial:Mo,MeshBasicMaterial:ti,MeshMatcapMaterial:Fu,LineDashedMaterial:Ou,LineBasicMaterial:Ul,Material:ei}[e]}}class kh{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Fh extends Ei{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Oh extends oh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new uh(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r&&r(t),i.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],s=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers,i=r[t],s=new Uint32Array(i).buffer;return n[t]=s,s}(e,i.buffer),a=ln(i.type,s),o=new Wo(a,i.stride);return o.uuid=i.uuid,t[r]=o,o}const i=e.isInstancedBufferGeometry?new Fh:new Ei,s=e.data.index;if(void 0!==s){const e=ln(s.type,s.array);i.setIndex(new ci(e,1))}const a=e.data.attributes;for(const t in a){const n=a[t];let s;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);s=new Ko(t,n.itemSize,n.offset,n.normalized)}else{const e=ln(n.type,n.array);s=new(n.isInstancedBufferAttribute?Il:ci)(e,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),void 0!==n.updateRange&&(s.updateRange.offset=n.updateRange.offset,s.updateRange.count=n.updateRange.count),i.setAttribute(t,s)}const o=e.data.morphAttributes;if(o)for(const t in o){const n=o[t],s=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let a;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);a=new Ko(t,i.itemSize,i.offset,i.normalized)}else{const e=ln(i.type,i.array);a=new ci(e,i.itemSize,i.normalized)}void 0!==i.name&&(a.name=i.name),s.push(a)}i.morphAttributes[t]=s}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];i.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Dn;void 0!==c.center&&e.fromArray(c.center),i.boundingSphere=new er(e,c.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}const Uh={UVMapping:W,CubeReflectionMapping:Y,CubeRefractionMapping:K,EquirectangularReflectionMapping:q,EquirectangularRefractionMapping:X,CubeUVReflectionMapping:$},Nh={RepeatWrapping:J,ClampToEdgeWrapping:Z,MirroredRepeatWrapping:ee},zh={NearestFilter:te,NearestMipmapNearestFilter:ne,NearestMipmapLinearFilter:re,LinearFilter:ie,LinearMipmapNearestFilter:se,LinearMipmapLinearFilter:ae};class Gh extends oh{constructor(e){super(e),this.isImageBitmapLoader=!0,this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,s=ih.get(e);if(void 0!==s)return i.manager.itemStart(e),setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(n){ih.add(e,n),t&&t(n),i.manager.itemEnd(e)}).catch(function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),i.manager.itemStart(e)}}let Qh;class Hh{static getContext(){return void 0===Qh&&(Qh=new(window.AudioContext||window.webkitAudioContext)),Qh}static setContext(e){Qh=e}}class Vh extends oh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new uh(this.manager);function a(t){r&&r(t),i.manager.itemError(e)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(e){try{const n=e.slice(0);Hh.getContext().decodeAudioData(n,function(e){t(e)},a)}catch(e){a(e)}},n,r)}}const jh=new cr,Wh=new cr,Yh=new cr;class Kh{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=qh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=qh();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function qh(){return("undefined"==typeof performance?Date:performance).now()}const Xh=new Dn,$h=new Pn,Jh=new Dn,Zh=new Dn;class ed extends Lr{constructor(){super(),this.type="AudioListener",this.context=Hh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Kh}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Xh,$h,Jh),Zh.set(0,0,-1).applyQuaternion($h),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Xh.x,e),t.positionY.linearRampToValueAtTime(Xh.y,e),t.positionZ.linearRampToValueAtTime(Xh.z,e),t.forwardX.linearRampToValueAtTime(Zh.x,e),t.forwardY.linearRampToValueAtTime(Zh.y,e),t.forwardZ.linearRampToValueAtTime(Zh.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(Xh.x,Xh.y,Xh.z),t.setOrientation(Zh.x,Zh.y,Zh.z,n.x,n.y,n.z)}}class td extends Lr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return;if(!1===this.hasPlaybackControl)return;this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1!==this.hasPlaybackControl&&this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const nd=new Dn,rd=new Pn,id=new Dn,sd=new Dn;class ad{constructor(e,t,n){let r,i,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==r;++e)n[i+e]=n[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){Pn.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const s=this._workIndex*i;Pn.multiplyQuaternionsFlat(e,s,e,t,e,n),Pn.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,n,r,i){const s=1-r;for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]*s+e[n+a]*r}}_lerpAdditive(e,t,n,r,i){for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]+e[n+s]*r}}}const od="\\[\\]\\.:\\/",ld=new RegExp("["+od+"]","g"),cd="[^"+od+"]",ud="[^"+od.replace("\\.","")+"]",hd=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",cd)+/(WCOD+)?/.source.replace("WCOD",ud)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",cd)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",cd)+"$"),dd=["material","materials","bones","map"];class fd{constructor(e,t,n){this.path=t,this.parsedPath=n||fd.parseTrackName(t),this.node=fd.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new fd.Composite(e,t,n):new fd(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ld,"")}static parseTrackName(e){const t=hd.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==dd.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const s=n(i.children);if(s)return s}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=fd.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return;if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return;if(!e.material.materials)return;e=e.material.materials;break;case"bones":if(!e.skeleton)return;e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return;if(!e.material.map)return;e=e.material.map;break;default:if(void 0===e[n])return;e=e[n]}if(void 0!==r){if(void 0===e[r])return;e=e[r]}}const s=e[r];if(void 0===s){t.nodeName;return}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return;if(!e.geometry.morphAttributes)return;void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}fd.Composite=class{constructor(e,t,n){const r=n||fd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},fd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},fd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},fd.prototype.GetterByBindingType=[fd.prototype._getValue_direct,fd.prototype._getValue_array,fd.prototype._getValue_arrayElement,fd.prototype._getValue_toArray],fd.prototype.SetterByBindingTypeAndVersioning=[[fd.prototype._setValue_direct,fd.prototype._setValue_direct_setNeedsUpdate,fd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[fd.prototype._setValue_array,fd.prototype._setValue_array_setNeedsUpdate,fd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[fd.prototype._setValue_arrayElement,fd.prototype._setValue_arrayElement_setNeedsUpdate,fd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[fd.prototype._setValue_fromArray,fd.prototype._setValue_fromArray_setNeedsUpdate,fd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class pd{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,s=i.length,a=new Array(s),o={endingStart:ot,endingEnd:ot};for(let e=0;e!==s;++e){const t=i[e].createInterpolant(null);a[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,s=n/r;e.warp(1,i,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=i,o[1]=i+n,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;r<0||0===n?t=0:(this._startTime=null,t=n*r)}t*=this._updateTimeScale(e);const s=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===ht)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulateAdditive(a);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulate(r,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const s=2202===n;if(0===e)return-1===i||!s||1&~i?r:t-r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&!(1&~i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=lt,r.endingEnd=lt):(r.endingStart=e?this.zeroSlopeAtStart?lt:ot:ct,r.endingEnd=t?this.zeroSlopeAtEnd?lt:ot:ct)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=i,o[0]=t,a[1]=i+e,o[1]=n,this}}const md=new Float32Array(1);class gd extends Gt{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,s=e._propertyBindings,a=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let e=0;e!==i;++e){const i=r[e],l=i.name;let u=c[l];if(void 0!==u)++u.referenceCount,s[e]=u;else{if(u=s[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,o,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;u=new ad(fd.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,o,l),s[e]=u}a[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let s=i[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,s=this._actionsByClip,a=s[i],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let s=r[t];void 0===s&&(s={},r[t]=s),s[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,a=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[i],0===Object.keys(a).length&&delete s[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Wu(new Float32Array(2),new Float32Array(2),1,md),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let s="string"==typeof e?nh.findByName(r,e):e;const a=null!==s?s.uuid:e,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:ut),void 0!==o){const e=o.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new pd(this,s,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,i),c}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?nh.findByName(n,e):e,s=i?i.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),s=this._accuIndex^=1;for(let a=0;a!==n;++a){t[a]._update(r,e,i,s)}const a=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)a[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,s=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=i,t[i]=s,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Ad{constructor(e){this.value=e}clone(){return new Ad(void 0===this.value.clone?this.value:this.value.clone())}}let vd=0;class yd extends Wo{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Ed{constructor(e,t,n=0,r=1/0){this.ray=new lr(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Er,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera&&(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t)}intersectObject(e,t=!0,n=[]){return xd(e,this,n,t),n.sort(_d),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)xd(e[r],this,n,t);return n.sort(_d),n}}function _d(e,t){return e.distance-t.distance}function xd(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)xd(r[e],t,n,!0)}}class bd{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Yt(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const Sd=new nn;class wd{constructor(e=new nn(1/0,1/0),t=new nn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Sd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Sd).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Cd=new Dn,Td=new Dn;class Md{constructor(e=new Dn,t=new Dn){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Cd.subVectors(e,this.start),Td.subVectors(this.end,this.start);const n=Td.dot(Td);let r=Td.dot(Cd)/n;return t&&(r=Yt(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Id=new Dn;const Rd=new Dn,Bd=new cr,Pd=new cr;class Dd extends Yl{constructor(e){const t=Ld(e),n=new Ei,r=[],i=[],s=new $r(0,0,1),a=new $r(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new di(r,3)),n.setAttribute("color",new di(i,3));super(n,new Ul({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Pd.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(Bd.multiplyMatrices(Pd,i.matrixWorld),Rd.setFromMatrixPosition(Bd),r.setXYZ(n,Rd.x,Rd.y,Rd.z),Bd.multiplyMatrices(Pd,i.parent.matrixWorld),Rd.setFromMatrixPosition(Bd),r.setXYZ(n+1,Rd.x,Rd.y,Rd.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ld(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Ld(e.children[n]));return t}const kd=new Dn,Fd=new $r,Od=new $r;class Ud extends Yl{constructor(e=10,t=10,n=4473924,r=8947848){n=new $r(n),r=new $r(r);const i=t/2,s=e/t,a=e/2,o=[],l=[];for(let e=0,c=0,u=-a;e<=t;e++,u+=s){o.push(-a,0,u,a,0,u),o.push(u,0,-a,u,0,a);const t=e===i?n:r;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new Ei;c.setAttribute("position",new di(o,3)),c.setAttribute("color",new di(l,3));super(c,new Ul({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Nd=new Dn,zd=new Dn,Gd=new Dn;const Qd=new Dn,Hd=new Wi;class Vd extends Yl{constructor(e){const t=new Ei,n=new Ul({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],s={};function a(e,t){o(e),o(t)}function o(e){r.push(0,0,0),i.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(r.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new di(r,3)),t.setAttribute("color",new di(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new $r(16755200),c=new $r(16711680),u=new $r(43775),h=new $r(16777215),d=new $r(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,n,r,i){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,i.r,i.g,i.b),s.setXYZ(41,i.r,i.g,i.b),s.setXYZ(42,i.r,i.g,i.b),s.setXYZ(43,i.r,i.g,i.b),s.setXYZ(44,i.r,i.g,i.b),s.setXYZ(45,i.r,i.g,i.b),s.setXYZ(46,i.r,i.g,i.b),s.setXYZ(47,i.r,i.g,i.b),s.setXYZ(48,i.r,i.g,i.b),s.setXYZ(49,i.r,i.g,i.b),s.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;Hd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),jd("c",t,e,Hd,0,0,-1),jd("t",t,e,Hd,0,0,1),jd("n1",t,e,Hd,-1,-1,-1),jd("n2",t,e,Hd,1,-1,-1),jd("n3",t,e,Hd,-1,1,-1),jd("n4",t,e,Hd,1,1,-1),jd("f1",t,e,Hd,-1,-1,1),jd("f2",t,e,Hd,1,-1,1),jd("f3",t,e,Hd,-1,1,1),jd("f4",t,e,Hd,1,1,1),jd("u1",t,e,Hd,.7,1.1,-1),jd("u2",t,e,Hd,-.7,1.1,-1),jd("u3",t,e,Hd,0,2,-1),jd("cf1",t,e,Hd,-1,0,1),jd("cf2",t,e,Hd,1,0,1),jd("cf3",t,e,Hd,0,-1,1),jd("cf4",t,e,Hd,0,1,1),jd("cn1",t,e,Hd,-1,0,-1),jd("cn2",t,e,Hd,1,0,-1),jd("cn3",t,e,Hd,0,-1,-1),jd("cn4",t,e,Hd,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function jd(e,t,n,r,i,s,a){Qd.set(i,s,a).unproject(r);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],Qd.x,Qd.y,Qd.z)}}const Wd=new Fn;const Yd=new Dn;let Kd,qd;class Xd{constructor(){this.type="ShapePath",this.color=new $r,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Cc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,s){return this.currentPath.bezierCurveTo(e,t,n,r,i,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let r=!1;for(let i=n-1,s=0;s<n;i=s++){let n=t[i],a=t[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[s],o=-o,a=t[i],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return r}const n=hu.isClockWise,r=this.subPaths;if(0===r.length)return[];let i,s,a;const o=[];if(1===r.length)return s=r[0],a=new Nc,a.curves=s.curves,o.push(a),o;let l=!n(r[0].getPoints());l=e?!l:l;const c=[],u=[];let h,d,f=[],p=0;u[p]=void 0,f[p]=[];for(let t=0,a=r.length;t<a;t++)s=r[t],h=s.getPoints(),i=n(h),i=e?!i:i,i?(!l&&u[p]&&p++,u[p]={s:new Nc,p:h},u[p].s.curves=s.curves,l&&p++,f[p]=[]):f[p].push({h:s,p:h[0]});if(!u[0])return function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new Nc;i.curves=r.curves,t.push(i)}return t}(r);if(u.length>1){let e=!1,n=0;for(let e=0,t=u.length;e<t;e++)c[e]=[];for(let r=0,i=u.length;r<i;r++){const i=f[r];for(let s=0;s<i.length;s++){const a=i[s];let o=!0;for(let i=0;i<u.length;i++)t(a.p,u[i].p)&&(r!==i&&n++,o?(o=!1,c[i].push(a)):e=!0);o&&c[r].push(a)}}n>0&&!1===e&&(f=c)}for(let e=0,t=u.length;e<t;e++){a=u[e].s,o.push(a),d=f[e];for(let e=0,t=d.length;e<t;e++)a.holes.push(d[e].h)}return o}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:E}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=E));var $d=Object.freeze({__proto__:null,ACESFilmicToneMapping:4,AddEquation:C,AddOperation:2,AdditiveAnimationBlendMode:ht,AdditiveBlending:2,AlphaFormat:1021,AlwaysCompare:519,AlwaysDepth:1,AlwaysStencilFunc:Ct,AmbientLight:Rh,AnimationAction:pd,AnimationClip:nh,AnimationLoader:class extends oh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new uh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r&&r(t),i.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=nh.parse(e[n]);t.push(r)}return t}},AnimationMixer:gd,AnimationObjectGroup:class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Wt(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,s=i.length;let a,o=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=o++,t[h]=d,e.push(u);for(let e=0,t=s;e!==t;++e)i[e].push(new fd(u,n[e],r[e]))}else if(d<l){a=e[d];const o=--l,c=e[o];t[c.uuid]=d,e[d]=c,t[h]=o,e[o]=u;for(let e=0,t=s;e!==t;++e){const t=i[e],s=t[o];let a=t[d];t[d]=s,void 0===a&&(a=new fd(u,n[e],r[e])),t[o]=a}}else e[d]}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=t[o];if(void 0!==l&&l>=i){const s=i++,c=e[s];t[c.uuid]=l,e[l]=c,t[o]=s,e[s]=a;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[l];t[l]=r,t[s]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,s=e.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<i){const a=--i,o=e[a],c=--s,u=e[c];t[o.uuid]=l,e[l]=o,t[u.uuid]=a,e[a]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[a],i=t[c];t[l]=r,t[a]=i,t.pop()}}else{const i=--s,a=e[i];i>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,s.push(e),a.push(t),i.push(u);for(let n=c,r=o.length;n!==r;++n){const r=o[n];u[n]=new fd(r,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];t[e[a]]=n,s[n]=o,s.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}},AnimationUtils:Hu,ArcCurve:oc,ArrayCamera:Do,ArrowHelper:class extends Lr{constructor(e=new Dn(0,0,1),t=new Dn(0,0,0),n=1,r=16776960,i=.2*n,s=.2*i){super(),this.type="ArrowHelper",void 0===Kd&&(Kd=new Ei,Kd.setAttribute("position",new di([0,0,0,0,1,0],3)),qd=new Rc(0,.5,1,5,1),qd.translate(0,-.5,0)),this.position.copy(t),this.line=new Vl(Kd,new Ul({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ui(qd,new ti({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Yd.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Yd,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},AttachedBindMode:V,Audio:td,AudioAnalyser:class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},AudioContext:Hh,AudioListener:ed,AudioLoader:Vh,AxesHelper:class extends Yl{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Ei;n.setAttribute("position",new di(t,3)),n.setAttribute("color",new di([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Ul({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new $r,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BackSide:1,BasicDepthPacking:3200,BasicShadowMap:0,Bone:Sl,BooleanKeyframeTrack:qu,Box2:wd,Box3:Fn,Box3Helper:class extends Yl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Ei;r.setIndex(new ci(n,1)),r.setAttribute("position",new di([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Ul({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},BoxGeometry:zi,BoxHelper:class extends Yl{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Ei;i.setIndex(new ci(n,1)),i.setAttribute("position",new ci(r,3)),super(i,new Ul({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==this.object&&Wd.setFromObject(this.object),Wd.isEmpty())return;const t=Wd.min,n=Wd.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BufferAttribute:ci,BufferGeometry:Ei,BufferGeometryLoader:Oh,ByteType:ce,Cache:ih,Camera:Wi,CameraHelper:Vd,CanvasTexture:ic,CapsuleGeometry:Mc,CatmullRomCurve3:fc,CineonToneMapping:3,CircleGeometry:Ic,ClampToEdgeWrapping:Z,Clock:Kh,Color:$r,ColorKeyframeTrack:Xu,ColorManagement:An,CompressedArrayTexture:class extends rc{constructor(e,t,n,r,i,s){super(e,t,n,i,s),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Z}},CompressedCubeTexture:class extends rc{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,Y),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}},CompressedTexture:rc,CompressedTextureLoader:class extends oh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=[],a=new rc,o=new uh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials);let l=0;function c(c){o.load(e[c],function(e){const n=i.parse(e,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=ie),a.image=s,a.format=n.format,a.needsUpdate=!0,t&&t(a))},n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else o.load(e,function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)s[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),s[t].format=n.format,s[t].width=n.width,s[t].height=n.height}a.image=s}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=ie),a.format=n.format,a.needsUpdate=!0,t&&t(a)},n,r);return a}},ConeGeometry:Bc,ConstantAlphaFactor:213,ConstantColorFactor:211,CubeCamera:qi,CubeReflectionMapping:Y,CubeRefractionMapping:K,CubeTexture:Xi,CubeTextureLoader:dh,CubeUVReflectionMapping:$,CubicBezierCurve:Ac,CubicBezierCurve3:vc,CubicInterpolant:ju,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:sc,CurvePath:wc,CustomBlending:5,CustomToneMapping:5,CylinderGeometry:Rc,Cylindrical:class{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},Data3DTexture:Bn,DataArrayTexture:Rn,DataTexture:wl,DataTextureLoader:fh,DataUtils:ai,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:ah,DepthFormat:Ee,DepthStencilFormat:_e,DepthTexture:Oo,DetachedBindMode:j,DirectionalLight:Ih,DirectionalLightHelper:class extends Lr{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let r=new Ei;r.setAttribute("position",new di([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new Ul({fog:!1,toneMapped:!1});this.lightPlane=new Vl(r,i),this.add(this.lightPlane),r=new Ei,r.setAttribute("position",new di([0,0,0,0,0,1],3)),this.targetLine=new Vl(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Nd.setFromMatrixPosition(this.light.matrixWorld),zd.setFromMatrixPosition(this.light.target.matrixWorld),Gd.subVectors(zd,Nd),this.lightPlane.lookAt(zd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(zd),this.targetLine.scale.z=Gd.length()}},DiscreteInterpolant:Yu,DisplayP3ColorSpace:vt,DodecahedronGeometry:Dc,DoubleSide:2,DstAlphaFactor:206,DstColorFactor:208,DynamicCopyUsage:35050,DynamicDrawUsage:Ft,DynamicReadUsage:35049,EdgesGeometry:Uc,EllipseCurve:ac,EqualCompare:514,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:q,EquirectangularRefractionMapping:X,Euler:yr,EventDispatcher:Gt,ExtrudeGeometry:pu,FileLoader:uh,Float16BufferAttribute:class extends ci{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=si(this.array[e*this.itemSize]);return this.normalized&&(t=Zt(t,this.array)),t}setX(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize]=ii(t),this}getY(e){let t=si(this.array[e*this.itemSize+1]);return this.normalized&&(t=Zt(t,this.array)),t}setY(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize+1]=ii(t),this}getZ(e){let t=si(this.array[e*this.itemSize+2]);return this.normalized&&(t=Zt(t,this.array)),t}setZ(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize+2]=ii(t),this}getW(e){let t=si(this.array[e*this.itemSize+3]);return this.normalized&&(t=Zt(t,this.array)),t}setW(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize+3]=ii(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=en(t,this.array),n=en(n,this.array)),this.array[e+0]=ii(t),this.array[e+1]=ii(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=en(t,this.array),n=en(n,this.array),r=en(r,this.array)),this.array[e+0]=ii(t),this.array[e+1]=ii(n),this.array[e+2]=ii(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=en(t,this.array),n=en(n,this.array),r=en(r,this.array),i=en(i,this.array)),this.array[e+0]=ii(t),this.array[e+1]=ii(n),this.array[e+2]=ii(r),this.array[e+3]=ii(i),this}},Float32BufferAttribute:di,Float64BufferAttribute:class extends ci{constructor(e,t,n){super(new Float64Array(e),t,n)}},FloatType:pe,Fog:Vo,FogExp2:Ho,FramebufferTexture:class extends Cn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=te,this.minFilter=te,this.generateMipmaps=!1,this.needsUpdate=!0}},FrontSide:0,Frustum:is,GLBufferAttribute:class{constructor(e,t,n,r,i){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}},GLSL1:"100",GLSL3:Ot,GreaterCompare:516,GreaterDepth:6,GreaterEqualCompare:518,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:Ud,Group:Lo,HalfFloatType:me,HemisphereLight:gh,HemisphereLightHelper:class extends Lr{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new Au(t);r.rotateY(.5*Math.PI),this.material=new ti({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),s=new Float32Array(3*i.count);r.setAttribute("color",new ci(s,3)),this.add(new Ui(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Fd.copy(this.light.color),Od.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Fd:Od;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(kd.setFromMatrixPosition(this.light.matrixWorld).negate())}},IcosahedronGeometry:gu,ImageBitmapLoader:Gh,ImageLoader:hh,ImageUtils:_n,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:Il,InstancedBufferGeometry:Fh,InstancedInterleavedBuffer:yd,InstancedMesh:Ol,Int16BufferAttribute:class extends ci{constructor(e,t,n){super(new Int16Array(e),t,n)}},Int32BufferAttribute:class extends ci{constructor(e,t,n){super(new Int32Array(e),t,n)}},Int8BufferAttribute:class extends ci{constructor(e,t,n){super(new Int8Array(e),t,n)}},IntType:de,InterleavedBuffer:Wo,InterleavedBufferAttribute:Ko,Interpolant:Vu,InterpolateDiscrete:it,InterpolateLinear:st,InterpolateSmooth:at,InvertStencilOp:5386,KeepStencilOp:St,KeyframeTrack:Ku,LOD:fl,LatheGeometry:Tc,Layers:Er,LessCompare:513,LessDepth:2,LessEqualCompare:515,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:mh,LightProbe:Dh,Line:Vl,Line3:Md,LineBasicMaterial:Ul,LineCurve:yc,LineCurve3:Ec,LineDashedMaterial:Ou,LineLoop:Kl,LineSegments:Yl,LinearDisplayP3ColorSpace:yt,LinearEncoding:dt,LinearFilter:ie,LinearInterpolant:Wu,LinearMipMapLinearFilter:oe,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:ae,LinearMipmapNearestFilter:se,LinearSRGBColorSpace:At,LinearToneMapping:1,LinearTransfer:Et,Loader:oh,LoaderUtils:kh,LoadingManager:sh,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:_,Material:ei,MaterialLoader:Lh,MathUtils:tn,Matrix3:rn,Matrix4:cr,MaxEquation:104,Mesh:Ui,MeshBasicMaterial:ti,MeshDepthMaterial:To,MeshDistanceMaterial:Mo,MeshLambertMaterial:ku,MeshMatcapMaterial:Fu,MeshNormalMaterial:Lu,MeshPhongMaterial:Pu,MeshPhysicalMaterial:Bu,MeshStandardMaterial:Ru,MeshToonMaterial:Du,MinEquation:103,MirroredRepeatWrapping:ee,MixOperation:1,MultiplyBlending:4,MultiplyOperation:0,NearestFilter:te,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:re,NearestMipmapNearestFilter:ne,NeverCompare:512,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColorSpace:mt,NoToneMapping:0,NormalAnimationBlendMode:ut,NormalBlending:1,NotEqualCompare:517,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:$u,Object3D:Lr,ObjectLoader:class extends oh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=""===this.path?kh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new uh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){let s=null;try{s=JSON.parse(n)}catch(e){return void(void 0!==r&&r(e))}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(s,t):void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e))},n,r)}async loadAsync(e,t){const n=""===this.path?kh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new uh(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t),s=JSON.parse(i),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),s=this.parseImages(e.images,function(){void 0!==t&&t(l)}),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,i,o,a,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,s),o=this.parseObject(e.object,r,a,s,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new Nc).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(e){e.isBone&&(r[e.uuid]=e)}),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new Ml).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new Oh;for(let i=0,s=e.length;i<s;i++){let s;const a=e[i];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(a);break;default:a.type in Tu&&(s=Tu[a.type].fromJSON(a,t))}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new Lh;i.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=nh.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function s(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:ln(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new sh(t);i=new hh(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){const e=[];for(let t=0,n=i.length;t<n;t++){const n=s(i[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new wl(n.data,n.width,n.height)))}r[n.uuid]=new bn(e)}else{const e=s(n.url);r[n.uuid]=new bn(e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function i(e){if("string"==typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:ln(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new hh(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],s=r.url;if(Array.isArray(s)){const e=[];for(let t=0,n=s.length;t<n;t++){const n=s[t],r=await i(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new wl(r.data,r.width,r.height)))}n[r.uuid]=new bn(e)}else{const e=await i(r.url);n[r.uuid]=new bn(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:t[e]}const r={};if(void 0!==e)for(let i=0,s=e.length;i<s;i++){const s=e[i];s.image,t[s.image];const a=t[s.image],o=a.data;let l;Array.isArray(o)?(l=new Xi,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new wl:new Cn,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,Uh)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Nh),l.wrapT=n(s.wrap[1],Nh)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace&&(l.colorSpace=s.colorSpace),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,zh)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,zh)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(l.compareFunction=s.compareFunction),void 0!==s.userData&&(l.userData=s.userData),r[s.uuid]=l}return r}parseObject(e,t,n,r,i){let s,a,o;function l(e){return t[e],t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];n[i],t.push(n[i])}return t}return n[e],n[e]}}function u(e){return r[e],r[e]}switch(e.type){case"Scene":s=new jo,void 0!==e.background&&(Number.isInteger(e.background)?s.background=new $r(e.background):s.background=u(e.background)),void 0!==e.environment&&(s.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new Vo(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new Ho(e.fog.color,e.fog.density)),""!==e.fog.name&&(s.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(s.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(s.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":s=new Yi(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new vs(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new Rh(e.color,e.intensity);break;case"DirectionalLight":s=new Ih(e.color,e.intensity);break;case"PointLight":s=new Th(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new Bh(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new xh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new gh(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new Dh).fromJSON(e);break;case"SkinnedMesh":a=l(e.geometry),o=c(e.material),s=new bl(a,o),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":a=l(e.geometry),o=c(e.material),s=new Ui(a,o);break;case"InstancedMesh":a=l(e.geometry),o=c(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;s=new Ol(a,o,t),s.instanceMatrix=new Il(new Float32Array(n.array),16),void 0!==r&&(s.instanceColor=new Il(new Float32Array(r.array),r.itemSize));break;case"LOD":s=new fl;break;case"Line":s=new Vl(l(e.geometry),c(e.material));break;case"LineLoop":s=new Kl(l(e.geometry),c(e.material));break;case"LineSegments":s=new Yl(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":s=new ec(l(e.geometry),c(e.material));break;case"Sprite":s=new cl(c(e.material));break;case"Group":s=new Lo;break;case"Bone":s=new Sl;break;default:s=new Lr}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.up&&s.up.fromArray(e.up),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)s.add(this.parseObject(a[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];s.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=s.getObjectByProperty("uuid",n.object);void 0!==r&&s.addLevel(r,n.distance,n.hysteresis)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n||e.bind(n,e.bindMatrix)}})}},ObjectSpaceNormalMap:1,OctahedronGeometry:Au,OneFactor:R,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:L,OneMinusSrcColorFactor:203,OrthographicCamera:vs,P3Primaries:bt,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:Is,Path:Cc,PerspectiveCamera:Yi,Plane:ts,PlaneGeometry:os,PlaneHelper:class extends Vl{constructor(e,t=1,n=16776960){const r=n,i=new Ei;i.setAttribute("position",new di([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new Ul({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new Ei;s.setAttribute("position",new di([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Ui(s,new ti({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},PointLight:Th,PointLightHelper:class extends Ui{constructor(e,t,n){super(new Eu(t,4,2),new ti({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:ec,PointsMaterial:ql,PolarGridHelper:class extends Yl{constructor(e=10,t=16,n=8,r=64,i=4473924,s=8947848){i=new $r(i),s=new $r(s);const a=[],o=[];if(t>1)for(let n=0;n<t;n++){const r=n/t*(2*Math.PI),l=Math.sin(r)*e,c=Math.cos(r)*e;a.push(0,0,0),a.push(l,0,c);const u=1&n?i:s;o.push(u.r,u.g,u.b),o.push(u.r,u.g,u.b)}for(let t=0;t<n;t++){const l=1&t?i:s,c=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c;a.push(n,0,i),o.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c,a.push(n,0,i),o.push(l.r,l.g,l.b)}}const l=new Ei;l.setAttribute("position",new di(a,3)),l.setAttribute("color",new di(o,3));super(l,new Ul({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},PolyhedronGeometry:Pc,PositionalAudio:class extends td{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(nd,rd,id),sd.set(0,0,1).applyQuaternion(rd);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(nd.x,e),t.positionY.linearRampToValueAtTime(nd.y,e),t.positionZ.linearRampToValueAtTime(nd.z,e),t.orientationX.linearRampToValueAtTime(sd.x,e),t.orientationY.linearRampToValueAtTime(sd.y,e),t.orientationZ.linearRampToValueAtTime(sd.z,e)}else t.setPosition(nd.x,nd.y,nd.z),t.setOrientation(sd.x,sd.y,sd.z)}},PropertyBinding:fd,PropertyMixer:ad,QuadraticBezierCurve:_c,QuadraticBezierCurve3:xc,Quaternion:Pn,QuaternionKeyframeTrack:Zu,QuaternionLinearInterpolant:Ju,RED_GREEN_RGTC2_Format:nt,RED_RGTC1_Format:36283,REVISION:E,RGBADepthPacking:pt,RGBAFormat:ye,RGBAIntegerFormat:Ce,RGBA_ASTC_10x10_Format:qe,RGBA_ASTC_10x5_Format:We,RGBA_ASTC_10x6_Format:Ye,RGBA_ASTC_10x8_Format:Ke,RGBA_ASTC_12x10_Format:Xe,RGBA_ASTC_12x12_Format:$e,RGBA_ASTC_4x4_Format:Ue,RGBA_ASTC_5x4_Format:Ne,RGBA_ASTC_5x5_Format:ze,RGBA_ASTC_6x5_Format:Ge,RGBA_ASTC_6x6_Format:Qe,RGBA_ASTC_8x5_Format:He,RGBA_ASTC_8x6_Format:Ve,RGBA_ASTC_8x8_Format:je,RGBA_BPTC_Format:Je,RGBA_ETC2_EAC_Format:Oe,RGBA_PVRTC_2BPPV1_Format:Le,RGBA_PVRTC_4BPPV1_Format:De,RGBA_S3TC_DXT1_Format:Me,RGBA_S3TC_DXT3_Format:Ie,RGBA_S3TC_DXT5_Format:Re,RGB_BPTC_SIGNED_Format:Ze,RGB_BPTC_UNSIGNED_Format:et,RGB_ETC1_Format:ke,RGB_ETC2_Format:Fe,RGB_PVRTC_2BPPV1_Format:Pe,RGB_PVRTC_4BPPV1_Format:Be,RGB_S3TC_DXT1_Format:Te,RGFormat:Se,RGIntegerFormat:we,RawShaderMaterial:Iu,Ray:lr,Raycaster:Ed,Rec709Primaries:xt,RectAreaLight:Bh,RedFormat:xe,RedIntegerFormat:be,ReinhardToneMapping:2,RenderTarget:Mn,RepeatWrapping:J,ReplaceStencilOp:wt,ReverseSubtractEquation:102,RingGeometry:vu,SIGNED_RED_GREEN_RGTC2_Format:rt,SIGNED_RED_RGTC1_Format:tt,SRGBColorSpace:gt,SRGBTransfer:_t,Scene:jo,ShaderChunk:ls,ShaderLib:us,ShaderMaterial:ji,ShadowMaterial:Mu,Shape:Nc,ShapeGeometry:yu,ShapePath:Xd,ShapeUtils:hu,ShortType:ue,Skeleton:Ml,SkeletonHelper:Dd,SkinnedMesh:bl,Source:bn,Sphere:er,SphereGeometry:Eu,Spherical:bd,SphericalHarmonics3:Ph,SplineCurve:bc,SpotLight:xh,SpotLightHelper:class extends Lr{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Ei,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,s=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new di(r,3));const i=new Ul({fog:!1,toneMapped:!1});this.cone=new Yl(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Id.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Id),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:cl,SpriteMaterial:qo,SrcAlphaFactor:D,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:kt,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Yi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Yi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Yh.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,i=t.near*Math.tan(Vt*t.fov*.5)/t.zoom;let s,a;Wh.elements[12]=-n,jh.elements[12]=n,s=-i*t.aspect+r,a=i*t.aspect+r,Yh.elements[0]=2*t.near/(a-s),Yh.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(Yh),s=-i*t.aspect-r,a=i*t.aspect-r,Yh.elements[0]=2*t.near/(a-s),Yh.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(Yh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Wh),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(jh)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:eh,SubtractEquation:101,SubtractiveBlending:3,TOUCH:x,TangentSpaceNormalMap:0,TetrahedronGeometry:_u,Texture:Cn,TextureLoader:ph,TorusGeometry:xu,TorusKnotGeometry:bu,Triangle:Wr,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeGeometry:Su,TwoPassDoubleSide:2,UVMapping:W,Uint16BufferAttribute:ui,Uint32BufferAttribute:hi,Uint8BufferAttribute:class extends ci{constructor(e,t,n){super(new Uint8Array(e),t,n)}},Uint8ClampedBufferAttribute:class extends ci{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}},Uniform:Ad,UniformsGroup:class extends Gt{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:vd++}),this.name="",this.usage=kt,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let e=0,n=t.length;e<n;e++)this.uniforms.push(t[e].clone());return this}clone(){return(new this.constructor).copy(this)}},UniformsLib:cs,UniformsUtils:Vi,UnsignedByteType:le,UnsignedInt248Type:ve,UnsignedIntType:fe,UnsignedShort4444Type:ge,UnsignedShort5551Type:Ae,UnsignedShortType:he,VSMShadowMap:3,Vector2:nn,Vector3:Dn,Vector4:Tn,VectorKeyframeTrack:th,VideoTexture:nc,WebGL1Renderer:Qo,WebGL3DRenderTarget:class extends In{constructor(e=1,t=1,n=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Bn(null,e,t,n),this.texture.isRenderTargetTexture=!0}},WebGLArrayRenderTarget:class extends In{constructor(e=1,t=1,n=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Rn(null,e,t,n),this.texture.isRenderTargetTexture=!0}},WebGLCoordinateSystem:Nt,WebGLCubeRenderTarget:$i,WebGLMultipleRenderTargets:class extends In{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const i=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=i.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},WebGLRenderTarget:In,WebGLRenderer:Go,WebGLUtils:Po,WebGPUCoordinateSystem:zt,WireframeGeometry:wu,WrapAroundEnding:ct,ZeroCurvatureEnding:ot,ZeroFactor:200,ZeroSlopeEnding:lt,ZeroStencilOp:0,_SRGBAFormat:Ut,createCanvasElement:un,sRGBEncoding:ft});function Jd(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Zd,ef={exports:{}},tf={};var nf,rf,sf={};var af=(rf||(rf=1,"production"===process.env.NODE_ENV?ef.exports=(Zd||(Zd=1,tf.ConcurrentRoot=1,tf.ContinuousEventPriority=4,tf.DefaultEventPriority=16,tf.DiscreteEventPriority=1,tf.IdleEventPriority=536870912,tf.LegacyRoot=0),tf):ef.exports=(nf||(nf=1,"production"!==process.env.NODE_ENV&&(sf.ConcurrentRoot=1,sf.ContinuousEventPriority=4,sf.DefaultEventPriority=16,sf.DiscreteEventPriority=1,sf.IdleEventPriority=536870912,sf.LegacyRoot=0)),sf)),ef.exports);function of(e){let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(i!==t){const e=t;t=r?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,s={setState:r,getState:i,subscribe:(e,r,s)=>r||s?((e,r=i,s=Object.is)=>{let a=r(t);function o(){const n=r(t);if(!s(a,n)){const t=a;e(a=n,t)}}return n.add(o),()=>n.delete(o)})(e,r,s):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(r,i,s),s}const lf="undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?s:a;function cf(e){const t="function"==typeof e?of(e):e,s=(e=t.getState,s=Object.is)=>{const[,a]=n(e=>e+1,0),o=t.getState(),l=r(o),c=r(e),u=r(s),h=r(!1),d=r();let f;void 0===d.current&&(d.current=e(o));let p=!1;(l.current!==o||c.current!==e||u.current!==s||h.current)&&(f=e(o),p=!s(d.current,f)),lf(()=>{p&&(d.current=f),l.current=o,c.current=e,u.current=s,h.current=!1});const m=r(o);lf(()=>{const e=()=>{try{const e=t.getState(),n=c.current(e);u.current(d.current,n)||(l.current=e,d.current=n,a())}catch(e){h.current=!0,a()}},n=t.subscribe(e);return t.getState()!==m.current&&e(),n},[]);const g=p?f:d.current;return i(g),g};return Object.assign(s,t),s[Symbol.iterator]=function(){const e=[s,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},s}const uf=[];function hf(e,t,n=(e,t)=>e===t){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let i=0;i<r;i++)if(!n(e[i],t[i]))return!1;return!0}function df(e,t=null,n=!1,r={}){null===t&&(t=[e]);for(const e of uf)if(hf(t,e.keys,e.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(e,"error"))throw e.error;if(Object.prototype.hasOwnProperty.call(e,"response"))return r.lifespan&&r.lifespan>0&&(e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(e.remove,r.lifespan)),e.response;if(!n)throw e.promise}const i={keys:t,equal:r.equal,remove:()=>{const e=uf.indexOf(i);-1!==e&&uf.splice(e,1)},promise:(s=e,"object"==typeof s&&"function"==typeof s.then?e:e(...t)).then(e=>{i.response=e,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(e=>i.error=e)};var s;if(uf.push(i),!n)throw i.promise}const ff=(e,t,n)=>df(e,t,!1,n),pf=(e,t,n)=>{df(e,t,!0,n)},mf=e=>{if(void 0===e||0===e.length)uf.splice(0,uf.length);else{const t=uf.find(t=>hf(e,t.keys,t.equal));t&&t.remove()}};var gf,Af={exports:{}},vf={exports:{}},yf={};var Ef,_f,xf,bf,Sf={};function wf(){return Ef||(Ef=1,e=Sf,"production"!==process.env.NODE_ENV&&function(){function t(e,t){var n=e.length;e.push(t),function(e,t,n){for(var r=n;r>0;){var s=r-1>>>1,a=e[s];if(!(i(a,t)>0))return;e[s]=t,e[r]=a,r=s}}(e,t,n)}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();return n!==t&&(e[0]=n,function(e,t,n){for(var r=n,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(i(l,t)<0)c<s&&i(u,l)<0?(e[r]=u,e[c]=t,r=c):(e[r]=l,e[o]=t,r=o);else{if(!(c<s&&i(u,t)<0))return;e[r]=u,e[c]=t,r=c}}}(e,n,0)),t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error),"object"==typeof performance&&"function"==typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,A="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))return;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function E(e){if(m=!1,y(e),!p)if(null!==n(l))p=!0,P(_);else{var t=n(c);null!==t&&D(E,t.startTime-e)}}function _(t,i){p=!1,m&&(m=!1,L()),f=!0;var s=d;try{return function(t,i){var s=i;for(y(s),h=n(l);null!==h&&(!(h.expirationTime>s)||t&&!T());){var a=h.callback;if("function"==typeof a){h.callback=null,d=h.priorityLevel;var o=a(h.expirationTime<=s);s=e.unstable_now(),"function"==typeof o?h.callback=o:h===n(l)&&r(l),y(s)}else r(l);h=n(l)}if(null!==h)return!0;var u=n(c);return null!==u&&D(E,u.startTime-s),!1}(t,i)}finally{h=null,d=s,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var x=!1,b=null,S=-1,w=5,C=-1;function T(){return!(e.unstable_now()-C<w)}var M,I=function(){if(null!==b){var t=e.unstable_now();C=t;var n=!0;try{n=b(!0,t)}finally{n?M():(x=!1,b=null)}}else x=!1};if("function"==typeof v)M=function(){v(I)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,B=R.port2;R.port1.onmessage=I,M=function(){B.postMessage(null)}}else M=function(){g(I,0)};function P(e){b=e,x||(x=!0,M())}function D(t,n){S=g(function(){t(e.unstable_now())},n)}function L(){A(S),S=-1}var k=function(){};e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,P(_))},e.unstable_forceFrameRate=function(e){e<0||e>125||(w=e>0?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){var t;switch(d){case 1:case 2:case 3:t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=k,e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},e.unstable_scheduleCallback=function(r,i,s){var a,o,h=e.unstable_now();if("object"==typeof s&&null!==s){var d=s.delay;a="number"==typeof d&&d>0?h+d:h}else a=h;switch(r){case 1:o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}var g=a+o,A={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:g,sortIndex:-1};return a>h?(A.sortIndex=a,t(c,A),null===n(l)&&A===n(c)&&(m?L():m=!0,D(E,a-h))):(A.sortIndex=g,t(l,A),p||f||(p=!0,P(_))),A},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()),Sf;var e}function Cf(){return _f||(_f=1,"production"===process.env.NODE_ENV?vf.exports=(gf||(gf=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,s=e[r];if(!(0<i(s,t)))break e;e[r]=t,e[n]=s,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>i(l,n))c<s&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<s&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,A="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function E(e){if(m=!1,y(e),!p)if(null!==n(l))p=!0,P(_);else{var t=n(c);null!==t&&D(E,t.startTime-e)}}function _(t,i){p=!1,m&&(m=!1,A(w),w=-1),f=!0;var s=d;try{for(y(i),h=n(l);null!==h&&(!(h.expirationTime>i)||t&&!M());){var a=h.callback;if("function"==typeof a){h.callback=null,d=h.priorityLevel;var o=a(h.expirationTime<=i);i=e.unstable_now(),"function"==typeof o?h.callback=o:h===n(l)&&r(l),y(i)}else r(l);h=n(l)}if(null!==h)var u=!0;else{var g=n(c);null!==g&&D(E,g.startTime-i),u=!1}return u}finally{h=null,d=s,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var x,b=!1,S=null,w=-1,C=5,T=-1;function M(){return!(e.unstable_now()-T<C)}function I(){if(null!==S){var t=e.unstable_now();T=t;var n=!0;try{n=S(!0,t)}finally{n?x():(b=!1,S=null)}}else b=!1}if("function"==typeof v)x=function(){v(I)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,B=R.port2;R.port1.onmessage=I,x=function(){B.postMessage(null)}}else x=function(){g(I,0)};function P(e){S=e,b||(b=!0,x())}function D(t,n){w=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,P(_))},e.unstable_forceFrameRate=function(e){0>e||125<e||(C=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},e.unstable_scheduleCallback=function(r,i,s){var a=e.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,r){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(r.sortIndex=s,t(c,r),null===n(l)&&r===n(c)&&(m?(A(w),w=-1):m=!0,D(E,s-a))):(r.sortIndex=o,t(l,r),p||f||(p=!0,P(_))),r},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}}(yf)),yf):vf.exports=wf()),vf.exports}function Tf(){return bf||(bf=1,xf=function(e){var n={},r=t,i=Cf(),s=Object.assign;function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),p=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),v=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),E=Symbol.for("react.offscreen"),_=Symbol.iterator;function x(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=_&&e[_]||e["@@iterator"])?e:null}function b(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case A:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case p:return(e.displayName||"Context")+".Consumer";case f:return(e._context.displayName||"Context")+".Provider";case m:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case v:return null!==(t=e.displayName||null)?t:b(e.type)||"Memo";case y:t=e._payload,e=e._init;try{return b(e(t))}catch(e){}}return null}function S(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return b(t);case 8:return t===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function w(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function C(e){if(w(e)!==e)throw Error(a(188))}function T(e){var t=e.alternate;if(!t){if(null===(t=w(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return C(i),e;if(s===r)return C(i),t;s=s.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}function M(e){return null!==(e=T(e))?I(e):null}function I(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=I(e);if(null!==t)return t;e=e.sibling}return null}function R(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=R(e);if(null!==t)return t}e=e.sibling}return null}var B,P=Array.isArray,D=e.getPublicInstance,L=e.getRootHostContext,k=e.getChildHostContext,F=e.prepareForCommit,O=e.resetAfterCommit,U=e.createInstance,N=e.appendInitialChild,z=e.finalizeInitialChildren,G=e.prepareUpdate,Q=e.shouldSetTextContent,H=e.createTextInstance,V=e.scheduleTimeout,j=e.cancelTimeout,W=e.noTimeout,Y=e.isPrimaryRenderer,K=e.supportsMutation,q=e.supportsPersistence,X=e.supportsHydration,$=e.getInstanceFromNode,J=e.preparePortalMount,Z=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,re=e.supportsTestSelectors,ie=e.findFiberRoot,se=e.getBoundingRect,ae=e.getTextContent,oe=e.isHiddenSubtree,le=e.matchAccessibilityRole,ce=e.setFocusIfFocusable,ue=e.setupIntersectionObserver,he=e.appendChild,de=e.appendChildToContainer,fe=e.commitTextUpdate,pe=e.commitMount,me=e.commitUpdate,ge=e.insertBefore,Ae=e.insertInContainerBefore,ve=e.removeChild,ye=e.removeChildFromContainer,Ee=e.resetTextContent,_e=e.hideInstance,xe=e.hideTextInstance,be=e.unhideInstance,Se=e.unhideTextInstance,we=e.clearContainer,Ce=e.cloneInstance,Te=e.createContainerChildSet,Me=e.appendChildToContainerChildSet,Ie=e.finalizeContainerChildren,Re=e.replaceContainerChildren,Be=e.cloneHiddenInstance,Pe=e.cloneHiddenTextInstance,De=e.canHydrateInstance,Le=e.canHydrateTextInstance,ke=e.canHydrateSuspenseInstance,Fe=e.isSuspenseInstancePending,Oe=e.isSuspenseInstanceFallback,Ue=e.registerSuspenseInstanceRetry,Ne=e.getNextHydratableSibling,ze=e.getFirstHydratableChild,Ge=e.getFirstHydratableChildWithinContainer,Qe=e.getFirstHydratableChildWithinSuspenseInstance,He=e.hydrateInstance,Ve=e.hydrateTextInstance,je=e.hydrateSuspenseInstance,We=e.getNextHydratableInstanceAfterSuspenseInstance,Ye=e.commitHydratedContainer,Ke=e.commitHydratedSuspenseInstance,qe=e.clearSuspenseBoundary,Xe=e.clearSuspenseBoundaryFromContainer,$e=e.shouldDeleteUnhydratedTailInstances,Je=e.didNotMatchHydratedContainerTextInstance,Ze=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===B)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);B=t&&t[1]||""}return"\n"+B+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),s=r.stack.split("\n"),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||i[a]!==s[o]){var l="\n"+i[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var rt=Object.prototype.hasOwnProperty,it=[],st=-1;function at(e){return{current:e}}function ot(e){0>st||(e.current=it[st],it[st]=null,st--)}function lt(e,t){st++,it[st]=e.current,e.current=t}var ct={},ut=at(ct),ht=at(!1),dt=ct;function ft(e,t){var n=e.type.contextTypes;if(!n)return ct;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in n)s[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function pt(e){return null!=(e=e.childContextTypes)}function mt(){ot(ht),ot(ut)}function gt(e,t,n){if(ut.current!==ct)throw Error(a(168));lt(ut,t),lt(ht,n)}function At(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,S(e)||"Unknown",i));return s({},n,r)}function vt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ct,dt=ut.current,lt(ut,e),lt(ht,ht.current),!0}function yt(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=At(e,t,dt),r.__reactInternalMemoizedMergedChildContext=e,ot(ht),ot(ut),lt(ut,e)):ot(ht),lt(ht,n)}var Et=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(_t(e)/xt|0)|0},_t=Math.log,xt=Math.LN2;var bt=64,St=4194304;function wt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ct(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~i;0!==o?r=wt(o):0!==(s&=a)&&(r=wt(s))}else 0!==(a=n&~i)?r=wt(a):0!==s&&(r=wt(s));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(s=t&-t)||16===i&&4194240&s))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-Et(t)),r|=e[n],t&=~i;return r}function Tt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function It(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Rt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-Et(t)]=n}function Bt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Et(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var Pt=0;function Dt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var Lt=i.unstable_scheduleCallback,kt=i.unstable_cancelCallback,Ft=i.unstable_shouldYield,Ot=i.unstable_requestPaint,Ut=i.unstable_now,Nt=i.unstable_ImmediatePriority,zt=i.unstable_UserBlockingPriority,Gt=i.unstable_NormalPriority,Qt=i.unstable_IdlePriority,Ht=null,Vt=null;var jt="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Wt=null,Yt=!1,Kt=!1;function qt(e){null===Wt?Wt=[e]:Wt.push(e)}function Xt(){if(!Kt&&null!==Wt){Kt=!0;var e=0,t=Pt;try{var n=Wt;for(Pt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Wt=null,Yt=!1}catch(t){throw null!==Wt&&(Wt=Wt.slice(e+1)),Lt(Nt,Xt),t}finally{Pt=t,Kt=!1}}return null}var $t=o.ReactCurrentBatchConfig;function Jt(e,t){if(jt(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!rt.call(t,i)||!jt(e[i],t[i]))return!1}return!0}function Zt(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=s({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=at(null),nn=null,rn=null,sn=null;function an(){sn=rn=nn=null}function on(e,t,n){Y?(lt(tn,t._currentValue),t._currentValue=n):(lt(tn,t._currentValue2),t._currentValue2=n)}function ln(e){var t=tn.current;ot(tn),Y?e._currentValue=t:e._currentValue2=t}function cn(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function un(e,t){nn=e,sn=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ki=!0),e.firstContext=null)}function hn(e){var t=Y?e._currentValue:e._currentValue2;if(sn!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(a(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var dn=null,fn=!1;function pn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function gn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function An(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==Ys&&1&e.mode&&!(2&Ws)?(null===(e=n.interleaved)?(t.next=t,null===dn?dn=[n]:dn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function vn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Bt(e,n)}}function yn(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?i=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?i=s=t:s=s.next=t}else i=s=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function En(e,t,n,r){var i=e.updateQueue;fn=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(null!==l){i.shared.pending=null;var c=l,u=c.next;c.next=null,null===o?a=u:o.next=u,o=c;var h=e.alternate;null!==h&&((l=(h=h.updateQueue).lastBaseUpdate)!==o&&(null===l?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(null!==a){var d=i.baseState;for(o=0,h=u=c=null,l=a;;){var f=l.lane,p=l.eventTime;if((r&f)===f){null!==h&&(h=h.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=e,g=l;switch(f=t,p=n,g.tag){case 1:if("function"==typeof(m=g.payload)){d=m.call(p,d,f);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(f="function"==typeof(m=g.payload)?m.call(p,d,f):m))break e;d=s({},d,f);break e;case 2:fn=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(f=i.effects)?i.effects=[l]:f.push(l))}else p={eventTime:p,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===h?(u=h=p,c=d):h=h.next=p,o|=f;if(null===(l=l.next)){if(null===(l=i.shared.pending))break;l=(f=l).next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}if(null===h&&(c=d),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=h,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);ea|=o,e.lanes=o,e.memoizedState=d}}function _n(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(a(191,i));i.call(r)}}}var xn=(new r.Component).refs;function bn(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:s({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Sn={isMounted:function(e){return!!(e=e._reactInternals)&&w(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ya(),i=Ea(e),s=gn(r,i);s.payload=t,null!=n&&(s.callback=n),An(e,s),null!==(t=_a(e,i,r))&&vn(t,e,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ya(),i=Ea(e),s=gn(r,i);s.tag=1,s.payload=t,null!=n&&(s.callback=n),An(e,s),null!==(t=_a(e,i,r))&&vn(t,e,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ya(),r=Ea(e),i=gn(n,r);i.tag=2,null!=t&&(i.callback=t),An(e,i),null!==(t=_a(e,r,n))&&vn(t,e,r)}};function wn(e,t,n,r,i,s,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!Jt(n,r)||!Jt(i,s))}function Cn(e,t,n){var r=!1,i=ct,s=t.contextType;return"object"==typeof s&&null!==s?s=hn(s):(i=pt(t)?dt:ut.current,s=(r=null!=(r=t.contextTypes))?ft(e,i):ct),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Sn,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function Tn(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Sn.enqueueReplaceState(t,t.state,null)}function Mn(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=xn,pn(e);var s=t.contextType;"object"==typeof s&&null!==s?i.context=hn(s):(s=pt(t)?dt:ut.current,i.context=ft(e,s)),i.state=e.memoizedState,"function"==typeof(s=t.getDerivedStateFromProps)&&(bn(e,t,s,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Sn.enqueueReplaceState(i,i.state,null),En(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}var In=[],Rn=0,Bn=null,Pn=0,Dn=[],Ln=0,kn=null,Fn=1,On="";function Un(e,t){In[Rn++]=Pn,In[Rn++]=Bn,Bn=e,Pn=t}function Nn(e,t,n){Dn[Ln++]=Fn,Dn[Ln++]=On,Dn[Ln++]=kn,kn=e;var r=Fn;e=On;var i=32-Et(r)-1;r&=~(1<<i),n+=1;var s=32-Et(t)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Fn=1<<32-Et(t)+i|n<<i|r,On=s+e}else Fn=1<<s|n<<i|r,On=e}function zn(e){null!==e.return&&(Un(e,1),Nn(e,1,0))}function Gn(e){for(;e===Bn;)Bn=In[--Rn],In[Rn]=null,Pn=In[--Rn],In[Rn]=null;for(;e===kn;)kn=Dn[--Ln],Dn[Ln]=null,On=Dn[--Ln],Dn[Ln]=null,Fn=Dn[--Ln],Dn[Ln]=null}var Qn=null,Hn=null,Vn=!1,jn=!1,Wn=null;function Yn(e,t){var n=Xa(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Kn(e,t){switch(e.tag){case 5:return null!==(t=De(t,e.type,e.pendingProps))&&(e.stateNode=t,Qn=e,Hn=ze(t),!0);case 6:return null!==(t=Le(t,e.pendingProps))&&(e.stateNode=t,Qn=e,Hn=null,!0);case 13:if(null!==(t=ke(t))){var n=null!==kn?{id:Fn,overflow:On}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Xa(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Qn=e,Hn=null,!0}return!1;default:return!1}}function qn(e){return!(!(1&e.mode)||128&e.flags)}function Xn(e){if(Vn){var t=Hn;if(t){var n=t;if(!Kn(e,t)){if(qn(e))throw Error(a(418));t=Ne(n);var r=Qn;t&&Kn(e,t)?Yn(r,n):(e.flags=-4097&e.flags|2,Vn=!1,Qn=e)}}else{if(qn(e))throw Error(a(418));e.flags=-4097&e.flags|2,Vn=!1,Qn=e}}}function $n(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Qn=e}function Jn(e){if(!X||e!==Qn)return!1;if(!Vn)return $n(e),Vn=!0,!1;if(3!==e.tag&&(5!==e.tag||$e(e.type)&&!Q(e.type,e.memoizedProps))){var t=Hn;if(t){if(qn(e)){for(e=Hn;e;)e=Ne(e);throw Error(a(418))}for(;t;)Yn(e,t),t=Ne(t)}}if($n(e),13===e.tag){if(!X)throw Error(a(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));Hn=We(e)}else Hn=Qn?Ne(e.stateNode):null;return!0}function Zn(){X&&(Hn=Qn=null,jn=Vn=!1)}function er(e){null===Wn?Wn=[e]:Wn.push(e)}function tr(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;t===xn&&(t=i.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!=typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function nr(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function rr(e){return(0,e._init)(e._payload)}function ir(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Ja(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function h(e,t,n,r){return null===t||6!==t.tag?((t=no(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n,r){var s=n.type;return s===u?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===y&&rr(s)===t.type)?((r=i(t,n.props)).ref=tr(e,t,n),r.return=e,r):((r=Za(n.type,n.key,n.props,null,e.mode,r)).ref=tr(e,t,n),r.return=e,r)}function f(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=ro(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function p(e,t,n,r,s){return null===t||7!==t.tag?((t=eo(n,e.mode,r,s)).return=e,t):((t=i(t,n)).return=e,t)}function m(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=no(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case l:return(n=Za(t.type,t.key,t.props,null,e.mode,n)).ref=tr(e,null,t),n.return=e,n;case c:return(t=ro(t,e.mode,n)).return=e,t;case y:return m(e,(0,t._init)(t._payload),n)}if(P(t)||x(t))return(t=eo(t,e.mode,n,null)).return=e,t;nr(e,t)}return null}function g(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:h(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===i?d(e,t,n,r):null;case c:return n.key===i?f(e,t,n,r):null;case y:return g(e,t,(i=n._init)(n._payload),r)}if(P(n)||x(n))return null!==i?null:p(e,t,n,r,null);nr(e,n)}return null}function A(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return h(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case l:return d(t,e=e.get(null===r.key?n:r.key)||null,r,i);case c:return f(t,e=e.get(null===r.key?n:r.key)||null,r,i);case y:return A(e,t,n,(0,r._init)(r._payload),i)}if(P(r)||x(r))return p(t,e=e.get(n)||null,r,i,null);nr(t,r)}return null}function v(i,a,o,l){for(var c=null,u=null,h=a,d=a=0,f=null;null!==h&&d<o.length;d++){h.index>d?(f=h,h=null):f=h.sibling;var p=g(i,h,o[d],l);if(null===p){null===h&&(h=f);break}e&&h&&null===p.alternate&&t(i,h),a=s(p,a,d),null===u?c=p:u.sibling=p,u=p,h=f}if(d===o.length)return n(i,h),Vn&&Un(i,d),c;if(null===h){for(;d<o.length;d++)null!==(h=m(i,o[d],l))&&(a=s(h,a,d),null===u?c=h:u.sibling=h,u=h);return Vn&&Un(i,d),c}for(h=r(i,h);d<o.length;d++)null!==(f=A(h,i,d,o[d],l))&&(e&&null!==f.alternate&&h.delete(null===f.key?d:f.key),a=s(f,a,d),null===u?c=f:u.sibling=f,u=f);return e&&h.forEach(function(e){return t(i,e)}),Vn&&Un(i,d),c}function E(i,o,l,c){var u=x(l);if("function"!=typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var h=u=null,d=o,f=o=0,p=null,v=l.next();null!==d&&!v.done;f++,v=l.next()){d.index>f?(p=d,d=null):p=d.sibling;var y=g(i,d,v.value,c);if(null===y){null===d&&(d=p);break}e&&d&&null===y.alternate&&t(i,d),o=s(y,o,f),null===h?u=y:h.sibling=y,h=y,d=p}if(v.done)return n(i,d),Vn&&Un(i,f),u;if(null===d){for(;!v.done;f++,v=l.next())null!==(v=m(i,v.value,c))&&(o=s(v,o,f),null===h?u=v:h.sibling=v,h=v);return Vn&&Un(i,f),u}for(d=r(i,d);!v.done;f++,v=l.next())null!==(v=A(d,i,f,v.value,c))&&(e&&null!==v.alternate&&d.delete(null===v.key?f:v.key),o=s(v,o,f),null===h?u=v:h.sibling=v,h=v);return e&&d.forEach(function(e){return t(i,e)}),Vn&&Un(i,f),u}return function e(r,s,a,h){if("object"==typeof a&&null!==a&&a.type===u&&null===a.key&&(a=a.props.children),"object"==typeof a&&null!==a){switch(a.$$typeof){case l:e:{for(var d=a.key,f=s;null!==f;){if(f.key===d){if((d=a.type)===u){if(7===f.tag){n(r,f.sibling),(s=i(f,a.props.children)).return=r,r=s;break e}}else if(f.elementType===d||"object"==typeof d&&null!==d&&d.$$typeof===y&&rr(d)===f.type){n(r,f.sibling),(s=i(f,a.props)).ref=tr(r,f,a),s.return=r,r=s;break e}n(r,f);break}t(r,f),f=f.sibling}a.type===u?((s=eo(a.props.children,r.mode,h,a.key)).return=r,r=s):((h=Za(a.type,a.key,a.props,null,r.mode,h)).ref=tr(r,s,a),h.return=r,r=h)}return o(r);case c:e:{for(f=a.key;null!==s;){if(s.key===f){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(r,s.sibling),(s=i(s,a.children||[])).return=r,r=s;break e}n(r,s);break}t(r,s),s=s.sibling}(s=ro(a,r.mode,h)).return=r,r=s}return o(r);case y:return e(r,s,(f=a._init)(a._payload),h)}if(P(a))return v(r,s,a,h);if(x(a))return E(r,s,a,h);nr(r,a)}return"string"==typeof a&&""!==a||"number"==typeof a?(a=""+a,null!==s&&6===s.tag?(n(r,s.sibling),(s=i(s,a)).return=r,r=s):(n(r,s),(s=no(a,r.mode,h)).return=r,r=s),o(r)):n(r,s)}}var sr=ir(!0),ar=ir(!1),or={},lr=at(or),cr=at(or),ur=at(or);function hr(e){if(e===or)throw Error(a(174));return e}function dr(e,t){lt(ur,t),lt(cr,e),lt(lr,or),e=L(t),ot(lr),lt(lr,e)}function fr(){ot(lr),ot(cr),ot(ur)}function pr(e){var t=hr(ur.current),n=hr(lr.current);n!==(t=k(n,e.type,t))&&(lt(cr,e),lt(lr,t))}function mr(e){cr.current===e&&(ot(lr),ot(cr))}var gr=at(0);function Ar(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Fe(n)||Oe(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var vr=[];function yr(){for(var e=0;e<vr.length;e++){var t=vr[e];Y?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}vr.length=0}var Er=o.ReactCurrentDispatcher,_r=o.ReactCurrentBatchConfig,xr=0,br=null,Sr=null,wr=null,Cr=!1,Tr=!1,Mr=0,Ir=0;function Rr(){throw Error(a(321))}function Br(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!jt(e[n],t[n]))return!1;return!0}function Pr(e,t,n,r,i,s){if(xr=s,br=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Er.current=null===e||null===e.memoizedState?pi:mi,e=n(r,i),Tr){s=0;do{if(Tr=!1,Mr=0,25<=s)throw Error(a(301));s+=1,wr=Sr=null,t.updateQueue=null,Er.current=gi,e=n(r,i)}while(Tr)}if(Er.current=fi,t=null!==Sr&&null!==Sr.next,xr=0,wr=Sr=br=null,Cr=!1,t)throw Error(a(300));return e}function Dr(){var e=0!==Mr;return Mr=0,e}function Lr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===wr?br.memoizedState=wr=e:wr=wr.next=e,wr}function kr(){if(null===Sr){var e=br.alternate;e=null!==e?e.memoizedState:null}else e=Sr.next;var t=null===wr?br.memoizedState:wr.next;if(null!==t)wr=t,Sr=e;else{if(null===e)throw Error(a(310));e={memoizedState:(Sr=e).memoizedState,baseState:Sr.baseState,baseQueue:Sr.baseQueue,queue:Sr.queue,next:null},null===wr?br.memoizedState=wr=e:wr=wr.next=e}return wr}function Fr(e,t){return"function"==typeof t?t(e):t}function Or(e){var t=kr(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=Sr,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var l=o=null,c=null,u=s;do{var h=u.lane;if((xr&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=r):c=c.next=d,br.lanes|=h,ea|=h}u=u.next}while(null!==u&&u!==s);null===c?o=r:c.next=l,jt(r,t.memoizedState)||(ki=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,br.lanes|=s,ea|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ur(e){var t=kr(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{s=e(s,o.action),o=o.next}while(o!==i);jt(s,t.memoizedState)||(ki=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Nr(){}function zr(e,t){var n=br,r=kr(),i=t(),s=!jt(r.memoizedState,i);if(s&&(r.memoizedState=i,ki=!0),r=r.queue,$r(Hr.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==wr&&1&wr.memoizedState.tag){if(n.flags|=2048,Wr(9,Qr.bind(null,n,r,i,t),void 0,null),null===Ys)throw Error(a(349));30&xr||Gr(n,t,i)}return i}function Gr(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=br.updateQueue)?(t={lastEffect:null,stores:null},br.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Qr(e,t,n,r){t.value=n,t.getSnapshot=r,Vr(t)&&_a(e,1,-1)}function Hr(e,t,n){return n(function(){Vr(t)&&_a(e,1,-1)})}function Vr(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!jt(e,n)}catch(e){return!0}}function jr(e){var t=Lr();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fr,lastRenderedState:e},t.queue=e,e=e.dispatch=li.bind(null,br,e),[t.memoizedState,e]}function Wr(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=br.updateQueue)?(t={lastEffect:null,stores:null},br.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Yr(){return kr().memoizedState}function Kr(e,t,n,r){var i=Lr();br.flags|=e,i.memoizedState=Wr(1|t,n,void 0,void 0===r?null:r)}function qr(e,t,n,r){var i=kr();r=void 0===r?null:r;var s=void 0;if(null!==Sr){var a=Sr.memoizedState;if(s=a.destroy,null!==r&&Br(r,a.deps))return void(i.memoizedState=Wr(t,n,s,r))}br.flags|=e,i.memoizedState=Wr(1|t,n,s,r)}function Xr(e,t){return Kr(8390656,8,e,t)}function $r(e,t){return qr(2048,8,e,t)}function Jr(e,t){return qr(4,2,e,t)}function Zr(e,t){return qr(4,4,e,t)}function ei(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ti(e,t,n){return n=null!=n?n.concat([e]):null,qr(4,4,ei.bind(null,t,e),n)}function ni(){}function ri(e,t){var n=kr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Br(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function ii(e,t){var n=kr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Br(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function si(e,t){var n=Pt;Pt=0!==n&&4>n?n:4,e(!0);var r=_r.transition;_r.transition={};try{e(!1),t()}finally{Pt=n,_r.transition=r}}function ai(){return kr().memoizedState}function oi(e,t,n){var r=Ea(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ci(e)?ui(t,n):(hi(e,t,n),null!==(e=_a(e,r,n=ya()))&&di(e,t,r))}function li(e,t,n){var r=Ea(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ci(e))ui(t,i);else{hi(e,t,i);var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(i.hasEagerState=!0,i.eagerState=o,jt(o,a))return}catch(e){}null!==(e=_a(e,r,n=ya()))&&di(e,t,r)}}function ci(e){var t=e.alternate;return e===br||null!==t&&t===br}function ui(e,t){Tr=Cr=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function hi(e,t,n){null!==Ys&&1&e.mode&&!(2&Ws)?(null===(e=t.interleaved)?(n.next=n,null===dn?dn=[t]:dn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function di(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Bt(e,n)}}var fi={readContext:hn,useCallback:Rr,useContext:Rr,useEffect:Rr,useImperativeHandle:Rr,useInsertionEffect:Rr,useLayoutEffect:Rr,useMemo:Rr,useReducer:Rr,useRef:Rr,useState:Rr,useDebugValue:Rr,useDeferredValue:Rr,useTransition:Rr,useMutableSource:Rr,useSyncExternalStore:Rr,useId:Rr,unstable_isNewReconciler:!1},pi={readContext:hn,useCallback:function(e,t){return Lr().memoizedState=[e,void 0===t?null:t],e},useContext:hn,useEffect:Xr,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Kr(4194308,4,ei.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Kr(4194308,4,e,t)},useInsertionEffect:function(e,t){return Kr(4,2,e,t)},useMemo:function(e,t){var n=Lr();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Lr();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=oi.bind(null,br,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Lr().memoizedState=e},useState:jr,useDebugValue:ni,useDeferredValue:function(e){var t=jr(e),n=t[0],r=t[1];return Xr(function(){var t=_r.transition;_r.transition={};try{r(e)}finally{_r.transition=t}},[e]),n},useTransition:function(){var e=jr(!1),t=e[0];return e=si.bind(null,e[1]),Lr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=br,i=Lr();if(Vn){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Ys)throw Error(a(349));30&xr||Gr(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Xr(Hr.bind(null,r,s,e),[e]),r.flags|=2048,Wr(9,Qr.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=Lr(),t=Ys.identifierPrefix;if(Vn){var n=On;t=":"+t+"R"+(n=(Fn&~(1<<32-Et(Fn)-1)).toString(32)+n),0<(n=Mr++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Ir++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},mi={readContext:hn,useCallback:ri,useContext:hn,useEffect:$r,useImperativeHandle:ti,useInsertionEffect:Jr,useLayoutEffect:Zr,useMemo:ii,useReducer:Or,useRef:Yr,useState:function(){return Or(Fr)},useDebugValue:ni,useDeferredValue:function(e){var t=Or(Fr),n=t[0],r=t[1];return $r(function(){var t=_r.transition;_r.transition={};try{r(e)}finally{_r.transition=t}},[e]),n},useTransition:function(){return[Or(Fr)[0],kr().memoizedState]},useMutableSource:Nr,useSyncExternalStore:zr,useId:ai,unstable_isNewReconciler:!1},gi={readContext:hn,useCallback:ri,useContext:hn,useEffect:$r,useImperativeHandle:ti,useInsertionEffect:Jr,useLayoutEffect:Zr,useMemo:ii,useReducer:Ur,useRef:Yr,useState:function(){return Ur(Fr)},useDebugValue:ni,useDeferredValue:function(e){var t=Ur(Fr),n=t[0],r=t[1];return $r(function(){var t=_r.transition;_r.transition={};try{r(e)}finally{_r.transition=t}},[e]),n},useTransition:function(){return[Ur(Fr)[0],kr().memoizedState]},useMutableSource:Nr,useSyncExternalStore:zr,useId:ai,unstable_isNewReconciler:!1};function Ai(e,t){try{var n="",r=t;do{n+=Zt(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i}}var vi,yi,Ei,_i,xi="function"==typeof WeakMap?WeakMap:Map;function bi(e,t,n){(n=gn(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ca||(ca=!0,ua=r)},n}function Si(e,t,n){(n=gn(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===ha?ha=new Set([this]):ha.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function wi(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new xi;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Va.bind(null,e,t,n),t.then(e,e))}function Ci(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Ti(e,t,n,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=gn(-1,1)).tag=2,An(n,t))),n.lanes|=1),e)}function Mi(e){e.flags|=4}function Ii(e,t){if(null!==e&&e.child===t.child)return!0;if(16&t.flags)return!1;for(e=t.child;null!==e;){if(12854&e.flags||12854&e.subtreeFlags)return!1;e=e.sibling}return!0}if(K)vi=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)N(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},yi=function(){},Ei=function(e,t,n,r,i){if((e=e.memoizedProps)!==r){var s=t.stateNode,a=hr(lr.current);n=G(s,n,e,r,i,a),(t.updateQueue=n)&&Mi(t)}},_i=function(e,t,n,r){n!==r&&Mi(t)};else if(q){vi=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var s=i.stateNode;n&&r&&(s=Be(s,i.type,i.memoizedProps,i)),N(e,s)}else if(6===i.tag)s=i.stateNode,n&&r&&(s=Pe(s,i.memoizedProps,i)),N(e,s);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(s=i.child)&&(s.return=i),vi(e,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};var Ri=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var s=i.stateNode;n&&r&&(s=Be(s,i.type,i.memoizedProps,i)),Me(e,s)}else if(6===i.tag)s=i.stateNode,n&&r&&(s=Pe(s,i.memoizedProps,i)),Me(e,s);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(s=i.child)&&(s.return=i),Ri(e,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};yi=function(e,t){var n=t.stateNode;if(!Ii(e,t)){e=n.containerInfo;var r=Te(e);Ri(r,t,!1,!1),n.pendingChildren=r,Mi(t),Ie(e,r)}},Ei=function(e,t,n,r,i){var s=e.stateNode,a=e.memoizedProps;if((e=Ii(e,t))&&a===r)t.stateNode=s;else{var o=t.stateNode,l=hr(lr.current),c=null;a!==r&&(c=G(o,n,a,r,i,l)),e&&null===c?t.stateNode=s:(s=Ce(s,c,n,a,r,t,e,o),z(s,n,r,i,l)&&Mi(t),t.stateNode=s,e?Mi(t):vi(s,t,!1,!1))}},_i=function(e,t,n,r){n!==r?(e=hr(ur.current),n=hr(lr.current),t.stateNode=H(r,e,n,t),Mi(t)):t.stateNode=e.stateNode}}else yi=function(){},Ei=function(){},_i=function(){};function Bi(e,t){if(!Vn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Pi(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Di(e,t,n){var r=t.pendingProps;switch(Gn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pi(t),null;case 1:case 17:return pt(t.type)&&mt(),Pi(t),null;case 3:return r=t.stateNode,fr(),ot(ht),ot(ut),yr(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Jn(t)?Mi(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==Wn&&(Ca(Wn),Wn=null))),yi(e,t),Pi(t),null;case 5:mr(t),n=hr(ur.current);var i=t.type;if(null!==e&&null!=t.stateNode)Ei(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Pi(t),null}if(e=hr(lr.current),Jn(t)){if(!X)throw Error(a(175));e=He(t.stateNode,t.type,t.memoizedProps,n,e,t,!jn),t.updateQueue=e,null!==e&&Mi(t)}else{var s=U(i,r,n,e,t);vi(s,t,!1,!1),t.stateNode=s,z(s,i,r,n,e)&&Mi(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Pi(t),null;case 6:if(e&&null!=t.stateNode)_i(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166));if(e=hr(ur.current),n=hr(lr.current),Jn(t)){if(!X)throw Error(a(176));if(e=t.stateNode,r=t.memoizedProps,(n=Ve(e,r,t,!jn))&&null!==(i=Qn))switch(s=!!(1&i.mode),i.tag){case 3:Je(i.stateNode.containerInfo,e,r,s);break;case 5:Ze(i.type,i.memoizedProps,i.stateNode,e,r,s)}n&&Mi(t)}else t.stateNode=H(r,e,n,t)}return Pi(t),null;case 13:if(ot(gr),r=t.memoizedState,Vn&&null!==Hn&&1&t.mode&&!(128&t.flags)){for(e=Hn;e;)e=Ne(e);return Zn(),t.flags|=98560,t}if(null!==r&&null!==r.dehydrated){if(r=Jn(t),null===e){if(!r)throw Error(a(318));if(!X)throw Error(a(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(a(317));je(e,t)}else Zn(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return Pi(t),null}return null!==Wn&&(Ca(Wn),Wn=null),128&t.flags?(t.lanes=n,t):(r=null!==r,n=!1,null===e?Jn(t):n=null!==e.memoizedState,r&&!n&&(t.child.flags|=8192,1&t.mode&&(null===e||1&gr.current?0===Js&&(Js=3):La())),null!==t.updateQueue&&(t.flags|=4),Pi(t),null);case 4:return fr(),yi(e,t),null===e&&J(t.stateNode.containerInfo),Pi(t),null;case 10:return ln(t.type._context),Pi(t),null;case 19:if(ot(gr),null===(i=t.memoizedState))return Pi(t),null;if(r=!!(128&t.flags),null===(s=i.rendering))if(r)Bi(i,!1);else{if(0!==Js||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(s=Ar(e))){for(t.flags|=128,Bi(i,!1),null!==(e=s.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,r=t.child;null!==r;)i=e,(n=r).flags&=14680066,null===(s=n.alternate)?(n.childLanes=0,n.lanes=i,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=s.childLanes,n.lanes=s.lanes,n.child=s.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=s.memoizedProps,n.memoizedState=s.memoizedState,n.updateQueue=s.updateQueue,n.type=s.type,i=s.dependencies,n.dependencies=null===i?null:{lanes:i.lanes,firstContext:i.firstContext}),r=r.sibling;return lt(gr,1&gr.current|2),t.child}e=e.sibling}null!==i.tail&&Ut()>aa&&(t.flags|=128,r=!0,Bi(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=Ar(s))){if(t.flags|=128,r=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Bi(i,!0),null===i.tail&&"hidden"===i.tailMode&&!s.alternate&&!Vn)return Pi(t),null}else 2*Ut()-i.renderingStartTime>aa&&1073741824!==n&&(t.flags|=128,r=!0,Bi(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=i.last)?e.sibling=s:t.child=s,i.last=s)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Ut(),t.sibling=null,e=gr.current,lt(gr,r?1&e|2:1&e),t):(Pi(t),null);case 22:case 23:return Ra(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Xs)&&(Pi(t),K&&6&t.subtreeFlags&&(t.flags|=8192)):Pi(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}var Li=o.ReactCurrentOwner,ki=!1;function Fi(e,t,n,r){t.child=null===e?ar(t,null,n,r):sr(t,e.child,n,r)}function Oi(e,t,n,r,i){n=n.render;var s=t.ref;return un(t,i),r=Pr(e,t,n,r,s,i),n=Dr(),null===e||ki?(Vn&&n&&zn(t),t.flags|=1,Fi(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,rs(e,t,i))}function Ui(e,t,n,r,i){if(null===e){var s=n.type;return"function"!=typeof s||$a(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Za(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ni(e,t,s,r,i))}if(s=e.child,0===(e.lanes&i)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:Jt)(a,r)&&e.ref===t.ref)return rs(e,t,i)}return t.flags|=1,(e=Ja(s,r)).ref=t.ref,e.return=t,t.child=e}function Ni(e,t,n,r,i){if(null!==e&&Jt(e.memoizedProps,r)&&e.ref===t.ref){if(ki=!1,0===(e.lanes&i))return t.lanes=e.lanes,rs(e,t,i);131072&e.flags&&(ki=!0)}return Qi(e,t,n,r,i)}function zi(e,t,n){var r=t.pendingProps,i=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,lt($s,Xs),Xs|=e,null;t.memoizedState={baseLanes:0,cachePool:null},r=null!==s?s.baseLanes:n,lt($s,Xs),Xs|=r}else t.memoizedState={baseLanes:0,cachePool:null},lt($s,Xs),Xs|=n;else null!==s?(r=s.baseLanes|n,t.memoizedState=null):r=n,lt($s,Xs),Xs|=r;return Fi(e,t,i,n),t.child}function Gi(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Qi(e,t,n,r,i){var s=pt(n)?dt:ut.current;return s=ft(t,s),un(t,i),n=Pr(e,t,n,r,s,i),r=Dr(),null===e||ki?(Vn&&r&&zn(t),t.flags|=1,Fi(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,rs(e,t,i))}function Hi(e,t,n,r,i){if(pt(n)){var s=!0;vt(t)}else s=!1;if(un(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Cn(t,n,r),Mn(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"==typeof c&&null!==c?c=hn(c):c=ft(t,c=pt(n)?dt:ut.current);var u=n.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof a.getSnapshotBeforeUpdate;h||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==r||l!==c)&&Tn(t,a,r,c),fn=!1;var d=t.memoizedState;a.state=d,En(t,r,a,i),l=t.memoizedState,o!==r||d!==l||ht.current||fn?("function"==typeof u&&(bn(t,n,u,r),l=t.memoizedState),(o=fn||wn(t,n,o,r,d,l,c))?(h||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,mn(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:en(t.type,o),a.props=c,h=t.pendingProps,d=a.context,"object"==typeof(l=n.contextType)&&null!==l?l=hn(l):l=ft(t,l=pt(n)?dt:ut.current);var f=n.getDerivedStateFromProps;(u="function"==typeof f||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==h||d!==l)&&Tn(t,a,r,l),fn=!1,d=t.memoizedState,a.state=d,En(t,r,a,i);var p=t.memoizedState;o!==h||d!==p||ht.current||fn?("function"==typeof f&&(bn(t,n,f,r),p=t.memoizedState),(c=fn||wn(t,n,c,r,d,p,l)||!1)?(u||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=l,r=c):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Vi(e,t,n,r,s,i)}function Vi(e,t,n,r,i,s){Gi(e,t);var a=!!(128&t.flags);if(!r&&!a)return i&&yt(t,n,!1),rs(e,t,s);r=t.stateNode,Li.current=t;var o=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=sr(t,e.child,null,s),t.child=sr(t,null,o,s)):Fi(e,t,o,s),t.memoizedState=r.state,i&&yt(t,n,!0),t.child}function ji(e){var t=e.stateNode;t.pendingContext?gt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gt(0,t.context,!1),dr(e,t.containerInfo)}function Wi(e,t,n,r,i){return Zn(),er(i),t.flags|=256,Fi(e,t,n,r),t.child}var Yi={dehydrated:null,treeContext:null,retryLane:0};function Ki(e){return{baseLanes:e,cachePool:null}}function qi(e,t,n){var r,i=t.pendingProps,s=gr.current,o=!1,l=!!(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&s)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),lt(gr,1&s),null===e)return Xn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?Oe(e)?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=i.children,e=i.fallback,o?(i=t.mode,o=t.child,s={mode:"hidden",children:s},1&i||null===o?o=to(s,i,0,null):(o.childLanes=0,o.pendingProps=s),e=eo(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Ki(n),t.memoizedState=Yi,e):Xi(t,s));if(null!==(s=e.memoizedState)){if(null!==(r=s.dehydrated)){if(l)return 256&t.flags?(t.flags&=-257,Zi(e,t,n,Error(a(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,s=t.mode,i=to({mode:"visible",children:i.children},s,0,null),(o=eo(o,s,n,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,1&t.mode&&sr(t,e.child,null,n),t.child.memoizedState=Ki(n),t.memoizedState=Yi,o);if(1&t.mode)if(Oe(r))t=Zi(e,t,n,Error(a(419)));else if(i=0!==(n&e.childLanes),ki||i){if(null!==(i=Ys)){switch(n&-n){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(i=0!==(o&(i.suspendedLanes|n))?0:o)&&i!==s.retryLane&&(s.retryLane=i,_a(e,i,-1))}La(),t=Zi(e,t,n,Error(a(421)))}else Fe(r)?(t.flags|=128,t.child=e.child,t=Wa.bind(null,e),Ue(r,t),t=null):(n=s.treeContext,X&&(Hn=Qe(r),Qn=t,Vn=!0,Wn=null,jn=!1,null!==n&&(Dn[Ln++]=Fn,Dn[Ln++]=On,Dn[Ln++]=kn,Fn=n.id,On=n.overflow,kn=t)),(t=Xi(t,t.pendingProps.children)).flags|=4096);else t=Zi(e,t,n,null);return t}return o?(i=Ji(e,t,i.children,i.fallback,n),o=t.child,s=e.child.memoizedState,o.memoizedState=null===s?Ki(n):{baseLanes:s.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=Yi,i):(n=$i(e,t,i.children,n),t.memoizedState=null,n)}return o?(i=Ji(e,t,i.children,i.fallback,n),o=t.child,s=e.child.memoizedState,o.memoizedState=null===s?Ki(n):{baseLanes:s.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=Yi,i):(n=$i(e,t,i.children,n),t.memoizedState=null,n)}function Xi(e,t){return(t=to({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function $i(e,t,n,r){var i=e.child;return e=i.sibling,n=Ja(i,{mode:"visible",children:n}),!(1&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n}function Ji(e,t,n,r,i){var s=t.mode,a=(e=e.child).sibling,o={mode:"hidden",children:n};return 1&s||t.child===e?(n=Ja(e,o)).subtreeFlags=14680064&e.subtreeFlags:((n=t.child).childLanes=0,n.pendingProps=o,t.deletions=null),null!==a?r=Ja(a,r):(r=eo(r,s,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function Zi(e,t,n,r){return null!==r&&er(r),sr(t,e.child,null,n),(e=Xi(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function es(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),cn(e.return,t,n)}function ts(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function ns(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail;if(Fi(e,t,r.children,n),2&(r=gr.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&es(e,n,t);else if(19===e.tag)es(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(lt(gr,r),1&t.mode)switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Ar(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),ts(t,!1,i,n,s);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Ar(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}ts(t,!0,n,null,s);break;case"together":ts(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function rs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ea|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Ja(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ja(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function is(e,t){switch(Gn(t),t.tag){case 1:return pt(t.type)&&mt(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return fr(),ot(ht),ot(ut),yr(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return mr(t),null;case 13:if(ot(gr),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));Zn()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ot(gr),null;case 4:return fr(),null;case 10:return ln(t.type._context),null;case 22:case 23:return Ra(),null;default:return null}}var ss=!1,as=!1,os="function"==typeof WeakSet?WeakSet:Set,ls=null;function cs(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Ha(e,t,n)}else n.current=null}function us(e,t,n){try{n()}catch(n){Ha(e,t,n)}}var hs=!1;function ds(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,void 0!==s&&us(t,n,s)}i=i.next}while(i!==r)}}function fs(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ps(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=D(n);else e=n;"function"==typeof t?t(e):t.current=e}}function ms(e,t,n){if(Vt&&"function"==typeof Vt.onCommitFiberUnmount)try{Vt.onCommitFiberUnmount(Ht,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var i=r,s=i.destroy;i=i.tag,void 0!==s&&(2&i||4&i)&&us(t,n,s),r=r.next}while(r!==e)}break;case 1:if(cs(t,n),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){Ha(t,n,e)}break;case 5:cs(t,n);break;case 4:K?bs(e,t,n):q&&q&&(t=t.stateNode.containerInfo,n=Te(t),Re(t,n))}}function gs(e,t,n){for(var r=t;;)if(ms(e,r,n),null===r.child||K&&4===r.tag){if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function As(e){var t=e.alternate;null!==t&&(e.alternate=null,As(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function vs(e){return 5===e.tag||3===e.tag||4===e.tag}function ys(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||vs(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Es(e){if(K){e:{for(var t=e.return;null!==t;){if(vs(t))break e;t=t.return}throw Error(a(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(Ee(t),n.flags&=-33),xs(e,n=ys(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,_s(e,n=ys(e),t);break;default:throw Error(a(161))}}}function _s(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?Ae(n,e,t):de(n,e);else if(4!==r&&null!==(e=e.child))for(_s(e,t,n),e=e.sibling;null!==e;)_s(e,t,n),e=e.sibling}function xs(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ge(n,e,t):he(n,e);else if(4!==r&&null!==(e=e.child))for(xs(e,t,n),e=e.sibling;null!==e;)xs(e,t,n),e=e.sibling}function bs(e,t,n){for(var r,i,s=t,o=!1;;){if(!o){o=s.return;e:for(;;){if(null===o)throw Error(a(160));switch(r=o.stateNode,o.tag){case 5:i=!1;break e;case 3:case 4:r=r.containerInfo,i=!0;break e}o=o.return}o=!0}if(5===s.tag||6===s.tag)gs(e,s,n),i?ye(r,s.stateNode):ve(r,s.stateNode);else if(18===s.tag)i?Xe(r,s.stateNode):qe(r,s.stateNode);else if(4===s.tag){if(null!==s.child){r=s.stateNode.containerInfo,i=!0,s.child.return=s,s=s.child;continue}}else if(ms(e,s,n),null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;4===(s=s.return).tag&&(o=!1)}s.sibling.return=s.return,s=s.sibling}}function Ss(e,t){if(K){switch(t.tag){case 0:case 11:case 14:case 15:return ds(3,t,t.return),fs(3,t),void ds(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var i=t.type,s=t.updateQueue;t.updateQueue=null,null!==s&&me(n,s,i,e,r,t)}return;case 6:if(null===t.stateNode)throw Error(a(162));return n=t.memoizedProps,void fe(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(X&&null!==e&&e.memoizedState.isDehydrated&&Ye(t.stateNode.containerInfo));case 13:case 19:return void ws(t)}throw Error(a(163))}switch(t.tag){case 0:case 11:case 14:case 15:return ds(3,t,t.return),fs(3,t),void ds(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void ws(t);case 3:X&&null!==e&&e.memoizedState.isDehydrated&&Ye(t.stateNode.containerInfo)}e:if(q){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Re(t.containerInfo,t.pendingChildren);break e}throw Error(a(163))}}function ws(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new os),t.forEach(function(t){var r=Ya.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function Cs(e,t,n){ls=e,Ts(e)}function Ts(e,t,n){for(var r=!!(1&e.mode);null!==ls;){var i=ls,s=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||ss;if(!a){var o=i.alternate,l=null!==o&&null!==o.memoizedState||as;o=ss;var c=as;if(ss=a,(as=l)&&!c)for(ls=i;null!==ls;)l=(a=ls).child,22===a.tag&&null!==a.memoizedState?Rs(i):null!==l?(l.return=a,ls=l):Rs(i);for(;null!==s;)ls=s,Ts(s),s=s.sibling;ls=i,ss=o,as=c}Ms(e)}else 8772&i.subtreeFlags&&null!==s?(s.return=i,ls=s):Ms(e)}}function Ms(e){for(;null!==ls;){var t=ls;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:as||fs(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!as)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&_n(t,s,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=D(t.child.stateNode);break;case 1:n=t.child.stateNode}_n(t,o,n)}break;case 5:var l=t.stateNode;null===n&&4&t.flags&&pe(l,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(X&&null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Ke(h)}}}break;default:throw Error(a(163))}as||512&t.flags&&ps(t)}catch(e){Ha(t,t.return,e)}}if(t===e){ls=null;break}if(null!==(n=t.sibling)){n.return=t.return,ls=n;break}ls=t.return}}function Is(e){for(;null!==ls;){var t=ls;if(t===e){ls=null;break}var n=t.sibling;if(null!==n){n.return=t.return,ls=n;break}ls=t.return}}function Rs(e){for(;null!==ls;){var t=ls;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{fs(4,t)}catch(e){Ha(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(e){Ha(t,i,e)}}var s=t.return;try{ps(t)}catch(e){Ha(t,s,e)}break;case 5:var a=t.return;try{ps(t)}catch(e){Ha(t,a,e)}}}catch(e){Ha(t,t.return,e)}if(t===e){ls=null;break}var o=t.sibling;if(null!==o){o.return=t.return,ls=o;break}ls=t.return}}var Bs=0,Ps=1,Ds=2,Ls=3,ks=4;if("function"==typeof Symbol&&Symbol.for){var Fs=Symbol.for;Bs=Fs("selector.component"),Ps=Fs("selector.has_pseudo_class"),Ds=Fs("selector.role"),Ls=Fs("selector.test_id"),ks=Fs("selector.text")}function Os(e){var t=$(e);if(null!=t){if("string"!=typeof t.memoizedProps["data-testname"])throw Error(a(364));return t}if(null===(e=ie(e)))throw Error(a(362));return e.stateNode.current}function Us(e,t){switch(t.$$typeof){case Bs:if(e.type===t.value)return!0;break;case Ps:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var r=e[n++],i=e[n++],s=t[i];if(5!==r.tag||!oe(r)){for(;null!=s&&Us(r,s);)s=t[++i];if(i===t.length){t=!0;break e}for(r=r.child;null!==r;)e.push(r,i),r=r.sibling}}t=!1}return t;case Ds:if(5===e.tag&&le(e.stateNode,t.value))return!0;break;case ks:if((5===e.tag||6===e.tag)&&(null!==(e=ae(e))&&0<=e.indexOf(t.value)))return!0;break;case Ls:if(5===e.tag&&("string"==typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function Ns(e){switch(e.$$typeof){case Bs:return"<"+(b(e.value)||"Unknown")+">";case Ps:return":has("+(Ns(e)||"")+")";case Ds:return'[role="'+e.value+'"]';case ks:return'"'+e.value+'"';case Ls:return'[data-testname="'+e.value+'"]';default:throw Error(a(365))}}function zs(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var i=e[r++],s=e[r++],a=t[s];if(5!==i.tag||!oe(i)){for(;null!=a&&Us(i,a);)a=t[++s];if(s===t.length)n.push(i);else for(i=i.child;null!==i;)e.push(i,s),i=i.sibling}}return n}function Gs(e,t){if(!re)throw Error(a(363));e=zs(e=Os(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var r=e[n++];if(5===r.tag)oe(r)||t.push(r.stateNode);else for(r=r.child;null!==r;)e.push(r),r=r.sibling}return t}var Qs=Math.ceil,Hs=o.ReactCurrentDispatcher,Vs=o.ReactCurrentOwner,js=o.ReactCurrentBatchConfig,Ws=0,Ys=null,Ks=null,qs=0,Xs=0,$s=at(0),Js=0,Zs=null,ea=0,ta=0,na=0,ra=null,ia=null,sa=0,aa=1/0;function oa(){aa=Ut()+500}var la,ca=!1,ua=null,ha=null,da=!1,fa=null,pa=0,ma=0,ga=null,Aa=-1,va=0;function ya(){return 6&Ws?Ut():-1!==Aa?Aa:Aa=Ut()}function Ea(e){return 1&e.mode?2&Ws&&0!==qs?qs&-qs:null!==$t.transition?(0===va&&(e=bt,!(4194240&(bt<<=1))&&(bt=64),va=e),va):0!==(e=Pt)?e:Z():1}function _a(e,t,n){if(50<ma)throw ma=0,ga=null,Error(a(185));var r=xa(e,t);return null===r?null:(Rt(r,t,n),2&Ws&&r===Ys||(r===Ys&&(!(2&Ws)&&(ta|=t),4===Js&&Ta(r,qs)),ba(r,n),1===t&&0===Ws&&!(1&e.mode)&&(oa(),Yt&&Xt())),r)}function xa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function ba(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-Et(s),o=1<<a,l=i[a];-1===l?0!==(o&n)&&0===(o&r)||(i[a]=Tt(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var r=Ct(e,e===Ys?qs:0);if(0===r)null!==n&&kt(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&kt(n),1===t)0===e.tag?function(e){Yt=!0,qt(e)}(Ma.bind(null,e)):qt(Ma.bind(null,e)),te?ne(function(){0===Ws&&Xt()}):Lt(Nt,Xt),n=null;else{switch(Dt(r)){case 1:n=Nt;break;case 4:n=zt;break;case 16:default:n=Gt;break;case 536870912:n=Qt}n=Ka(n,Sa.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Sa(e,t){if(Aa=-1,va=0,6&Ws)throw Error(a(327));var n=e.callbackNode;if(Ga()&&e.callbackNode!==n)return null;var r=Ct(e,e===Ys?qs:0);if(0===r)return null;if(30&r||0!==(r&e.expiredLanes)||t)t=ka(e,r);else{t=r;var i=Ws;Ws|=2;var s=Da();for(Ys===e&&qs===t||(oa(),Ba(e,t));;)try{Oa();break}catch(t){Pa(e,t)}an(),Hs.current=s,Ws=i,null!==Ks?t=0:(Ys=null,qs=0,t=Js)}if(0!==t){if(2===t&&(0!==(i=Mt(e))&&(r=i,t=wa(e,i))),1===t)throw n=Zs,Ba(e,0),Ta(e,r),ba(e,Ut()),n;if(6===t)Ta(e,r);else{if(i=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!jt(s(),i))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)||(t=ka(e,r),2===t&&(s=Mt(e),0!==s&&(r=s,t=wa(e,s))),1!==t)))throw n=Zs,Ba(e,0),Ta(e,r),ba(e,Ut()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:za(e,ia);break;case 3:if(Ta(e,r),(130023424&r)===r&&10<(t=sa+500-Ut())){if(0!==Ct(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ya(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=V(za.bind(null,e,ia),t);break}za(e,ia);break;case 4:if(Ta(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-Et(r);s=1<<o,(o=t[o])>i&&(i=o),r&=~s}if(r=i,10<(r=(120>(r=Ut()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Qs(r/1960))-r)){e.timeoutHandle=V(za.bind(null,e,ia),r);break}za(e,ia);break;default:throw Error(a(329))}}}return ba(e,Ut()),e.callbackNode===n?Sa.bind(null,e):null}function wa(e,t){var n=ra;return e.current.memoizedState.isDehydrated&&(Ba(e,t).flags|=256),2!==(e=ka(e,t))&&(t=ia,ia=n,null!==t&&Ca(t)),e}function Ca(e){null===ia?ia=e:ia.push.apply(ia,e)}function Ta(e,t){for(t&=~na,t&=~ta,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Et(t),r=1<<n;e[n]=-1,t&=~r}}function Ma(e){if(6&Ws)throw Error(a(327));Ga();var t=Ct(e,0);if(!(1&t))return ba(e,Ut()),null;var n=ka(e,t);if(0!==e.tag&&2===n){var r=Mt(e);0!==r&&(t=r,n=wa(e,r))}if(1===n)throw n=Zs,Ba(e,0),Ta(e,t),ba(e,Ut()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,za(e,ia),ba(e,Ut()),null}function Ia(e){null!==fa&&0===fa.tag&&!(6&Ws)&&Ga();var t=Ws;Ws|=1;var n=js.transition,r=Pt;try{if(js.transition=null,Pt=1,e)return e()}finally{Pt=r,js.transition=n,!(6&(Ws=t))&&Xt()}}function Ra(){Xs=$s.current,ot($s)}function Ba(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==W&&(e.timeoutHandle=W,j(n)),null!==Ks)for(n=Ks.return;null!==n;){var r=n;switch(Gn(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&mt();break;case 3:fr(),ot(ht),ot(ut),yr();break;case 5:mr(r);break;case 4:fr();break;case 13:case 19:ot(gr);break;case 10:ln(r.type._context);break;case 22:case 23:Ra()}n=n.return}if(Ys=e,Ks=e=Ja(e.current,null),qs=Xs=t,Js=0,Zs=null,na=ta=ea=0,ia=ra=null,null!==dn){for(t=0;t<dn.length;t++)if(null!==(r=(n=dn[t]).interleaved)){n.interleaved=null;var i=r.next,s=n.pending;if(null!==s){var a=s.next;s.next=i,r.next=a}n.pending=r}dn=null}return e}function Pa(e,t){for(;;){var n=Ks;try{if(an(),Er.current=fi,Cr){for(var r=br.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}Cr=!1}if(xr=0,wr=Sr=br=null,Tr=!1,Mr=0,Vs.current=null,null===n||null===n.return){Js=1,Zs=t,Ks=null;break}e:{var s=e,o=n.return,l=n,c=t;if(t=qs,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,h=l,d=h.tag;if(!(1&h.mode||0!==d&&11!==d&&15!==d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=Ci(o);if(null!==p){p.flags&=-257,Ti(p,o,l,0,t),1&p.mode&&wi(s,u,t),c=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(!(1&t)){wi(s,u,t),La();break e}c=Error(a(426))}else if(Vn&&1&l.mode){var A=Ci(o);if(null!==A){!(65536&A.flags)&&(A.flags|=256),Ti(A,o,l,0,t),er(c);break e}}s=c,4!==Js&&(Js=2),null===ra?ra=[s]:ra.push(s),c=Ai(c,l),l=o;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,yn(l,bi(0,c,t));break e;case 1:s=c;var v=l.type,y=l.stateNode;if(!(128&l.flags||"function"!=typeof v.getDerivedStateFromError&&(null===y||"function"!=typeof y.componentDidCatch||null!==ha&&ha.has(y)))){l.flags|=65536,t&=-t,l.lanes|=t,yn(l,Si(l,s,t));break e}}l=l.return}while(null!==l)}Na(n)}catch(e){t=e,Ks===n&&null!==n&&(Ks=n=n.return);continue}break}}function Da(){var e=Hs.current;return Hs.current=fi,null===e?fi:e}function La(){0!==Js&&3!==Js&&2!==Js||(Js=4),null===Ys||!(268435455&ea)&&!(268435455&ta)||Ta(Ys,qs)}function ka(e,t){var n=Ws;Ws|=2;var r=Da();for(Ys===e&&qs===t||Ba(e,t);;)try{Fa();break}catch(t){Pa(e,t)}if(an(),Ws=n,Hs.current=r,null!==Ks)throw Error(a(261));return Ys=null,qs=0,Js}function Fa(){for(;null!==Ks;)Ua(Ks)}function Oa(){for(;null!==Ks&&!Ft();)Ua(Ks)}function Ua(e){var t=la(e.alternate,e,Xs);e.memoizedProps=e.pendingProps,null===t?Na(e):Ks=t,Vs.current=null}function Na(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=is(n,t)))return n.flags&=32767,void(Ks=n);if(null===e)return Js=6,void(Ks=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Di(n,t,Xs)))return void(Ks=n);if(null!==(t=t.sibling))return void(Ks=t);Ks=t=e}while(null!==t);0===Js&&(Js=5)}function za(e,t){var n=Pt,r=js.transition;try{js.transition=null,Pt=1,function(e,t,n){do{Ga()}while(null!==fa);if(6&Ws)throw Error(a(327));var r=e.finishedWork,i=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var s=r.lanes|r.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-Et(n),s=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~s}}(e,s),e===Ys&&(Ks=Ys=null,qs=0),!(2064&r.subtreeFlags)&&!(2064&r.flags)||da||(da=!0,Ka(Gt,function(){return Ga(),null})),s=!!(15990&r.flags),!!(15990&r.subtreeFlags)||s){s=js.transition,js.transition=null;var o=Pt;Pt=1;var l=Ws;Ws|=4,Vs.current=null,function(e,t){for(F(e.containerInfo),ls=t;null!==ls;)if(t=(e=ls).child,1028&e.subtreeFlags&&null!==t)t.return=e,ls=t;else for(;null!==ls;){e=ls;try{var n=e.alternate;if(1024&e.flags)switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var r=n.memoizedProps,i=n.memoizedState,s=e.stateNode,o=s.getSnapshotBeforeUpdate(e.elementType===e.type?r:en(e.type,r),i);s.__reactInternalSnapshotBeforeUpdate=o}break;case 3:K&&we(e.stateNode.containerInfo);break;default:throw Error(a(163))}}catch(t){Ha(e,e.return,t)}if(null!==(t=e.sibling)){t.return=e.return,ls=t;break}ls=e.return}n=hs,hs=!1}(e,r),function(e,t){for(ls=t;null!==ls;){var n=(t=ls).deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e;K?bs(s,i,t):gs(s,i,t);var a=i.alternate;null!==a&&(a.return=null),i.return=null}catch(e){Ha(i,t,e)}}if(n=t.child,12854&t.subtreeFlags&&null!==n)n.return=t,ls=n;else for(;null!==ls;){t=ls;try{var o=t.flags;if(32&o&&K&&Ee(t.stateNode),512&o){var l=t.alternate;if(null!==l){var c=l.ref;null!==c&&("function"==typeof c?c(null):c.current=null)}}if(8192&o)switch(t.tag){case 13:if(null!==t.memoizedState){var u=t.alternate;null!==u&&null!==u.memoizedState||(sa=Ut())}break;case 22:var h=null!==t.memoizedState,d=t.alternate,f=null!==d&&null!==d.memoizedState;if(n=t,K)e:if(r=n,i=h,s=null,K)for(var p=r;;){if(5===p.tag){if(null===s){s=p;var m=p.stateNode;i?_e(m):be(p.stateNode,p.memoizedProps)}}else if(6===p.tag){if(null===s){var g=p.stateNode;i?xe(g):Se(g,p.memoizedProps)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===r)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===r)break;for(;null===p.sibling;){if(null===p.return||p.return===r)break e;s===p&&(s=null),p=p.return}s===p&&(s=null),p.sibling.return=p.return,p=p.sibling}if(h&&!f&&1&n.mode){ls=n;for(var A=n.child;null!==A;){for(n=ls=A;null!==ls;){var v=(r=ls).child;switch(r.tag){case 0:case 11:case 14:case 15:ds(4,r,r.return);break;case 1:cs(r,r.return);var y=r.stateNode;if("function"==typeof y.componentWillUnmount){var E=r.return;try{y.props=r.memoizedProps,y.state=r.memoizedState,y.componentWillUnmount()}catch(e){Ha(r,E,e)}}break;case 5:cs(r,r.return);break;case 22:if(null!==r.memoizedState){Is(n);continue}}null!==v?(v.return=r,ls=v):Is(n)}A=A.sibling}}}switch(4102&o){case 2:Es(t),t.flags&=-3;break;case 6:Es(t),t.flags&=-3,Ss(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,Ss(t.alternate,t);break;case 4:Ss(t.alternate,t)}}catch(e){Ha(t,t.return,e)}if(null!==(n=t.sibling)){n.return=t.return,ls=n;break}ls=t.return}}}(e,r),O(e.containerInfo),e.current=r,Cs(r),Ot(),Ws=l,Pt=o,js.transition=s}else e.current=r;if(da&&(da=!1,fa=e,pa=i),s=e.pendingLanes,0===s&&(ha=null),function(e){if(Vt&&"function"==typeof Vt.onCommitFiberRoot)try{Vt.onCommitFiberRoot(Ht,e,void 0,!(128&~e.current.flags))}catch(e){}}(r.stateNode),ba(e,Ut()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)n(t[r]);if(ca)throw ca=!1,e=ua,ua=null,e;!!(1&pa)&&0!==e.tag&&Ga(),s=e.pendingLanes,1&s?e===ga?ma++:(ma=0,ga=e):ma=0,Xt()}(e,t,n)}finally{js.transition=r,Pt=n}return null}function Ga(){if(null!==fa){var e=Dt(pa),t=js.transition,n=Pt;try{if(js.transition=null,Pt=16>e?16:e,null===fa)var r=!1;else{if(e=fa,fa=null,pa=0,6&Ws)throw Error(a(331));var i=Ws;for(Ws|=4,ls=e.current;null!==ls;){var s=ls,o=s.child;if(16&ls.flags){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(ls=u;null!==ls;){var h=ls;switch(h.tag){case 0:case 11:case 15:ds(8,h,s)}var d=h.child;if(null!==d)d.return=h,ls=d;else for(;null!==ls;){var f=(h=ls).sibling,p=h.return;if(As(h),h===u){ls=null;break}if(null!==f){f.return=p,ls=f;break}ls=p}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var A=g.sibling;g.sibling=null,g=A}while(null!==g)}}ls=s}}if(2064&s.subtreeFlags&&null!==o)o.return=s,ls=o;else e:for(;null!==ls;){if(2048&(s=ls).flags)switch(s.tag){case 0:case 11:case 15:ds(9,s,s.return)}var v=s.sibling;if(null!==v){v.return=s.return,ls=v;break e}ls=s.return}}var y=e.current;for(ls=y;null!==ls;){var E=(o=ls).child;if(2064&o.subtreeFlags&&null!==E)E.return=o,ls=E;else e:for(o=y;null!==ls;){if(2048&(l=ls).flags)try{switch(l.tag){case 0:case 11:case 15:fs(9,l)}}catch(e){Ha(l,l.return,e)}if(l===o){ls=null;break e}var _=l.sibling;if(null!==_){_.return=l.return,ls=_;break e}ls=l.return}}if(Ws=i,Xt(),Vt&&"function"==typeof Vt.onPostCommitFiberRoot)try{Vt.onPostCommitFiberRoot(Ht,e)}catch(e){}r=!0}return r}finally{Pt=n,js.transition=t}}return!1}function Qa(e,t,n){An(e,t=bi(0,t=Ai(n,t),1)),t=ya(),null!==(e=xa(e,1))&&(Rt(e,1,t),ba(e,t))}function Ha(e,t,n){if(3===e.tag)Qa(e,e,n);else for(;null!==t;){if(3===t.tag){Qa(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===ha||!ha.has(r))){An(t,e=Si(t,e=Ai(n,e),1)),e=ya(),null!==(t=xa(t,1))&&(Rt(t,1,e),ba(t,e));break}}t=t.return}}function Va(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ya(),e.pingedLanes|=e.suspendedLanes&n,Ys===e&&(qs&n)===n&&(4===Js||3===Js&&(130023424&qs)===qs&&500>Ut()-sa?Ba(e,0):na|=n),ba(e,t)}function ja(e,t){0===t&&(1&e.mode?(t=St,!(130023424&(St<<=1))&&(St=4194304)):t=1);var n=ya();null!==(e=xa(e,t))&&(Rt(e,t,n),ba(e,n))}function Wa(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),ja(e,n)}function Ya(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),ja(e,n)}function Ka(e,t){return Lt(e,t)}function qa(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xa(e,t,n,r){return new qa(e,t,n,r)}function $a(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ja(e,t){var n=e.alternate;return null===n?((n=Xa(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Za(e,t,n,r,i,s){var o=2;if(r=e,"function"==typeof e)$a(e)&&(o=1);else if("string"==typeof e)o=5;else e:switch(e){case u:return eo(n.children,i,s,t);case h:o=8,i|=8;break;case d:return(e=Xa(12,n,t,2|i)).elementType=d,e.lanes=s,e;case g:return(e=Xa(13,n,t,i)).elementType=g,e.lanes=s,e;case A:return(e=Xa(19,n,t,i)).elementType=A,e.lanes=s,e;case E:return to(n,i,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case f:o=10;break e;case p:o=9;break e;case m:o=11;break e;case v:o=14;break e;case y:o=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Xa(o,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function eo(e,t,n,r){return(e=Xa(7,e,r,t)).lanes=n,e}function to(e,t,n,r){return(e=Xa(22,e,r,t)).elementType=E,e.lanes=n,e.stateNode={},e}function no(e,t,n){return(e=Xa(6,e,null,t)).lanes=n,e}function ro(e,t,n){return(t=Xa(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function io(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=W,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=It(0),this.expirationTimes=It(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=It(0),this.identifierPrefix=r,this.onRecoverableError=i,X&&(this.mutableSourceEagerHydrationData=null)}function so(e,t,n,r,i,s,a,o,l){return e=new io(e,t,n,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Xa(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null},pn(s),e}function ao(e){if(!e)return ct;e:{if(w(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(pt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(pt(n))return At(e,n,t)}return t}function oo(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return null===(e=M(t))?null:e.stateNode}function lo(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function co(e,t){lo(e,t),(e=e.alternate)&&lo(e,t)}function uo(e){return null===(e=M(e))?null:e.stateNode}function ho(){return null}return la=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ht.current)ki=!0;else{if(0===(e.lanes&n)&&!(128&t.flags))return ki=!1,function(e,t,n){switch(t.tag){case 3:ji(t),Zn();break;case 5:pr(t);break;case 1:pt(t.type)&&vt(t);break;case 4:dr(t,t.stateNode.containerInfo);break;case 10:on(0,t.type._context,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(lt(gr,1&gr.current),t.flags|=128,null):0!==(n&t.child.childLanes)?qi(e,t,n):(lt(gr,1&gr.current),null!==(e=rs(e,t,n))?e.sibling:null);lt(gr,1&gr.current);break;case 19:if(r=0!==(n&t.childLanes),128&e.flags){if(r)return ns(e,t,n);t.flags|=128}var i=t.memoizedState;if(null!==i&&(i.rendering=null,i.tail=null,i.lastEffect=null),lt(gr,gr.current),r)break;return null;case 22:case 23:return t.lanes=0,zi(e,t,n)}return rs(e,t,n)}(e,t,n);ki=!!(131072&e.flags)}else ki=!1,Vn&&1048576&t.flags&&Nn(t,Pn,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var i=ft(t,ut.current);un(t,n),i=Pr(null,t,r,e,i,n);var s=Dr();return t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,pt(r)?(s=!0,vt(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,pn(t),i.updater=Sn,t.stateNode=i,i._reactInternals=t,Mn(t,r,e,n),t=Vi(null,t,r,!0,s,n)):(t.tag=0,Vn&&s&&zn(t),Fi(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"==typeof e)return $a(e)?1:0;if(null!=e){if((e=e.$$typeof)===m)return 11;if(e===v)return 14}return 2}(r),e=en(r,e),i){case 0:t=Qi(null,t,r,e,n);break e;case 1:t=Hi(null,t,r,e,n);break e;case 11:t=Oi(null,t,r,e,n);break e;case 14:t=Ui(null,t,r,en(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Qi(e,t,r,i=t.elementType===r?i:en(r,i),n);case 1:return r=t.type,i=t.pendingProps,Hi(e,t,r,i=t.elementType===r?i:en(r,i),n);case 3:e:{if(ji(t),null===e)throw Error(a(387));r=t.pendingProps,i=(s=t.memoizedState).element,mn(e,t),En(t,r,null,n);var o=t.memoizedState;if(r=o.element,X&&s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:o.cache,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Wi(e,t,r,n,i=Error(a(423)));break e}if(r!==i){t=Wi(e,t,r,n,i=Error(a(424)));break e}for(X&&(Hn=Ge(t.stateNode.containerInfo),Qn=t,Vn=!0,Wn=null,jn=!1),n=ar(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Zn(),r===i){t=rs(e,t,n);break e}Fi(e,t,r,n)}t=t.child}return t;case 5:return pr(t),null===e&&Xn(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,o=i.children,Q(r,i)?o=null:null!==s&&Q(r,s)&&(t.flags|=32),Gi(e,t),Fi(e,t,o,n),t.child;case 6:return null===e&&Xn(t),null;case 13:return qi(e,t,n);case 4:return dr(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=sr(t,null,r,n):Fi(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Oi(e,t,r,i=t.elementType===r?i:en(r,i),n);case 7:return Fi(e,t,t.pendingProps,n),t.child;case 8:case 12:return Fi(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,on(0,r,o=i.value),null!==s)if(jt(s.value,o)){if(s.children===i.children&&!ht.current){t=rs(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){o=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=gn(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),cn(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)o=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(o=s.return))throw Error(a(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),cn(o,n,t),o=s.sibling}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===t){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break}o=o.return}s=o}Fi(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,un(t,n),r=r(i=hn(i)),t.flags|=1,Fi(e,t,r,n),t.child;case 14:return i=en(r=t.type,t.pendingProps),Ui(e,t,r,i=en(r.type,i),n);case 15:return Ni(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:en(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pt(r)?(e=!0,vt(t)):e=!1,un(t,n),Cn(t,r,i),Mn(t,r,i,n),Vi(null,t,r,!0,e,n);case 19:return ns(e,t,n);case 22:return zi(e,t,n)}throw Error(a(156,t.tag))},n.attemptContinuousHydration=function(e){13===e.tag&&(_a(e,134217728,ya()),co(e,134217728))},n.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=ya(),n=Ea(e);_a(e,n,t),co(e,n)}},n.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=wt(t.pendingLanes);0!==n&&(Bt(t,1|n),ba(t,Ut()),!(6&Ws)&&(oa(),Xt()))}break;case 13:var r=ya();Ia(function(){return _a(e,1,r)}),co(e,1)}},n.batchedUpdates=function(e,t){var n=Ws;Ws|=1;try{return e(t)}finally{0===(Ws=n)&&(oa(),Yt&&Xt())}},n.createComponentSelector=function(e){return{$$typeof:Bs,value:e}},n.createContainer=function(e,t,n,r,i,s,a){return so(e,t,!1,null,0,r,0,s,a)},n.createHasPseudoClassSelector=function(e){return{$$typeof:Ps,value:e}},n.createHydrationContainer=function(e,t,n,r,i,s,a,o,l){return(e=so(n,r,!0,e,0,s,0,o,l)).context=ao(null),n=e.current,(s=gn(r=ya(),i=Ea(n))).callback=null!=t?t:null,An(n,s),e.current.lanes=i,Rt(e,i,r),ba(e,r),e},n.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},n.createRoleSelector=function(e){return{$$typeof:Ds,value:e}},n.createTestNameSelector=function(e){return{$$typeof:Ls,value:e}},n.createTextSelector=function(e){return{$$typeof:ks,value:e}},n.deferredUpdates=function(e){var t=Pt,n=js.transition;try{return js.transition=null,Pt=16,e()}finally{Pt=t,js.transition=n}},n.discreteUpdates=function(e,t,n,r,i){var s=Pt,a=js.transition;try{return js.transition=null,Pt=1,e(t,n,r,i)}finally{Pt=s,js.transition=a,0===Ws&&oa()}},n.findAllNodes=Gs,n.findBoundingRects=function(e,t){if(!re)throw Error(a(363));t=Gs(e,t),e=[];for(var n=0;n<t.length;n++)e.push(se(t[n]));for(t=e.length-1;0<t;t--)for(var r=(n=e[t]).x,i=r+n.width,s=n.y,o=s+n.height,l=t-1;0<=l;l--)if(t!==l){var c=e[l],u=c.x,h=u+c.width,d=c.y,f=d+c.height;if(r>=u&&s>=d&&i<=h&&o<=f){e.splice(t,1);break}if(!(r!==u||n.width!==c.width||f<s||d>o)){d>s&&(c.height+=d-s,c.y=s),f<o&&(c.height=o-d),e.splice(t,1);break}if(!(s!==d||n.height!==c.height||h<r||u>i)){u>r&&(c.width+=u-r,c.x=r),h<i&&(c.width=i-u),e.splice(t,1);break}}return e},n.findHostInstance=oo,n.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=T(e))?R(e):null)?null:e.stateNode},n.findHostInstanceWithWarning=function(e){return oo(e)},n.flushControlled=function(e){var t=Ws;Ws|=1;var n=js.transition,r=Pt;try{js.transition=null,Pt=1,e()}finally{Pt=r,js.transition=n,0===(Ws=t)&&(oa(),Xt())}},n.flushPassiveEffects=Ga,n.flushSync=Ia,n.focusWithin=function(e,t){if(!re)throw Error(a(363));for(t=zs(e=Os(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!oe(n)){if(5===n.tag&&ce(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},n.getCurrentUpdatePriority=function(){return Pt},n.getFindAllNodesFailureDescription=function(e,t){if(!re)throw Error(a(363));var n=0,r=[];e=[Os(e),0];for(var i=0;i<e.length;){var s=e[i++],o=e[i++],l=t[o];if((5!==s.tag||!oe(s))&&(Us(s,l)&&(r.push(Ns(l)),++o>n&&(n=o)),o<t.length))for(s=s.child;null!==s;)e.push(s,o),s=s.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(Ns(t[n]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},n.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?D(e.child.stateNode):e.child.stateNode:null},n.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:uo,findFiberByHostInstance:e.findFiberByHostInstance||ho,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Ht=t.inject(e),Vt=t}catch(e){}e=!!t.checkDCE}}return e},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(e,t,n,r){if(!re)throw Error(a(363));e=Gs(e,t);var i=ue(e,n,r).disconnect;return{disconnect:function(){i()}}},n.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},n.runWithPriority=function(e,t){var n=Pt;try{return Pt=e,t()}finally{Pt=n}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(e,t,n,r){var i=t.current,s=ya(),a=Ea(i);return n=ao(n),null===t.context?t.context=n:t.pendingContext=n,(t=gn(s,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),An(i,t),null!==(e=_a(i,a,s))&&vn(e,i,a),a},n}),xf}var Mf,If,Rf={exports:{}};function Bf(){return Mf||(Mf=1,"production"!==process.env.NODE_ENV&&(Rf.exports=function(e){var n={},r=t,i=Cf(),s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,a=!1;function o(e){if(!a){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];c("warn",e,n)}}function l(e){if(!a){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];c("error",e,n)}}function c(e,t,n){var r=s.ReactDebugCurrentFrame.getStackAddendum();""!==r&&(t+="%s",n=n.concat([r]));var i=n.map(function(e){return String(e)});i.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,i)}var u=Object.assign;function h(e){return e._reactInternals}var d=!1,f=!1,p=10,m=11,g=12,A=13,v=14,y=15,E=17,_=18,x=19,b=22,S=23,w=Symbol.for("react.element"),C=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),B=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),O=(Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode"),Symbol.for("react.offscreen")),U=(Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker"),Symbol.iterator);function N(e){if(null===e||"object"!=typeof e)return null;var t=U&&e[U]||e["@@iterator"];return"function"==typeof t?t:null}function z(e){return e.displayName||"Context"}function G(e){if(null==e)return null;if("number"==typeof e.tag&&l("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case T:return"Fragment";case C:return"Portal";case I:return"Profiler";case M:return"StrictMode";case D:return"Suspense";case L:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case B:return z(e)+".Consumer";case R:return z(e._context)+".Provider";case P:return function(e,t,n){var r=e.displayName;if(r)return r;var i=t.displayName||t.name||"";return""!==i?n+"("+i+")":n}(e,e.render,"ForwardRef");case k:var t=e.displayName||null;return null!==t?t:G(e.type)||"Memo";case F:var n=e,r=n._payload,i=n._init;try{return G(i(r))}catch(e){return null}}return null}function Q(e){return e.displayName||"Context"}function H(e){var t,n,r,i,s=e.tag,a=e.type;switch(s){case 24:return"Cache";case 9:return Q(a)+".Consumer";case p:return Q(a._context)+".Provider";case _:return"DehydratedFragment";case m:return t=a,n=a.render,r="ForwardRef",i=n.displayName||n.name||"",t.displayName||(""!==i?r+"("+i+")":r);case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(a);case 8:return a===M?"StrictMode":"Mode";case b:return"Offscreen";case g:return"Profiler";case 21:return"Scope";case A:return"Suspense";case x:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case E:case 2:case v:case y:if("function"==typeof a)return a.displayName||a.name||null;if("string"==typeof a)return a}return null}var V=16,j=128,W=256,Y=512,K=1024,q=2048,X=4096,$=8192,J=16384,Z=32768,ee=65536,te=131072,ne=1048576,re=2097152,ie=4194304,se=16777216,ae=33554432,oe=1028,le=12854,ce=8772,ue=2064,he=14680064,de=s.ReactCurrentOwner;function fe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{var r=t;do{4098&(t=r).flags&&(n=t.return),r=t.return}while(r)}return 3===t.tag?n:null}function pe(e){if(fe(e)!==e)throw new Error("Unable to find node on an unmounted component.")}function me(e){var t=e.alternate;if(!t){var n=fe(e);if(null===n)throw new Error("Unable to find node on an unmounted component.");return n!==e?null:e}for(var r=e,i=t;;){var s=r.return;if(null===s)break;var a=s.alternate;if(null===a){var o=s.return;if(null!==o){r=i=o;continue}break}if(s.child===a.child){for(var l=s.child;l;){if(l===r)return pe(s),e;if(l===i)return pe(s),t;l=l.sibling}throw new Error("Unable to find node on an unmounted component.")}if(r.return!==i.return)r=s,i=a;else{for(var c=!1,u=s.child;u;){if(u===r){c=!0,r=s,i=a;break}if(u===i){c=!0,i=s,r=a;break}u=u.sibling}if(!c){for(u=a.child;u;){if(u===r){c=!0,r=a,i=s;break}if(u===i){c=!0,i=a,r=s;break}u=u.sibling}if(!c)throw new Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(r.alternate!==i)throw new Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(3!==r.tag)throw new Error("Unable to find node on an unmounted component.");return r.stateNode.current===r?e:t}function ge(e){var t=me(e);return null!==t?Ae(t):null}function Ae(e){if(5===e.tag||6===e.tag)return e;for(var t=e.child;null!==t;){var n=Ae(t);if(null!==n)return n;t=t.sibling}return null}function ve(e){var t=me(e);return null!==t?ye(t):null}function ye(e){if(5===e.tag||6===e.tag)return e;for(var t=e.child;null!==t;){if(4!==t.tag){var n=ye(t);if(null!==n)return n}t=t.sibling}return null}var Ee=Array.isArray;function _e(e){return Ee(e)}var xe=e.getPublicInstance,be=e.getRootHostContext,Se=e.getChildHostContext,we=e.prepareForCommit,Ce=e.resetAfterCommit,Te=e.createInstance,Me=e.appendInitialChild,Ie=e.finalizeInitialChildren,Re=e.prepareUpdate,Be=e.shouldSetTextContent,Pe=e.createTextInstance,De=e.scheduleTimeout,Le=e.cancelTimeout,ke=e.noTimeout;e.now;var Fe=e.isPrimaryRenderer,Oe=e.warnsIfNotActing,Ue=e.supportsMutation,Ne=e.supportsPersistence,ze=e.supportsHydration,Ge=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var Qe=e.preparePortalMount;e.preparePortalMount,e.getInstanceFromScope;var He=e.getCurrentEventPriority,Ve=e.detachDeletedInstance,je=e.supportsMicrotasks,We=e.scheduleMicrotask,Ye=e.supportsTestSelectors,Ke=e.findFiberRoot,qe=e.getBoundingRect,Xe=e.getTextContent,$e=e.isHiddenSubtree,Je=e.matchAccessibilityRole,Ze=e.setFocusIfFocusable,et=e.setupIntersectionObserver,tt=e.appendChild,nt=e.appendChildToContainer,rt=e.commitTextUpdate,it=e.commitMount,st=e.commitUpdate,at=e.insertBefore,ot=e.insertInContainerBefore,lt=e.removeChild,ct=e.removeChildFromContainer,ut=e.resetTextContent,ht=e.hideInstance,dt=e.hideTextInstance,ft=e.unhideInstance,pt=e.unhideTextInstance,mt=e.clearContainer,gt=e.cloneInstance,At=e.createContainerChildSet,vt=e.appendChildToContainerChildSet,yt=e.finalizeContainerChildren,Et=e.replaceContainerChildren;e.getOffscreenContainerType;e.getOffscreenContainerProps;var _t,xt,bt,St,wt,Ct,Tt,Mt=e.cloneHiddenInstance,It=e.cloneHiddenTextInstance,Rt=e.canHydrateInstance,Bt=e.canHydrateTextInstance,Pt=e.canHydrateSuspenseInstance,Dt=e.isSuspenseInstancePending,Lt=e.isSuspenseInstanceFallback,kt=e.registerSuspenseInstanceRetry,Ft=e.getNextHydratableSibling,Ot=e.getFirstHydratableChild,Ut=e.getFirstHydratableChildWithinContainer,Nt=e.getFirstHydratableChildWithinSuspenseInstance,zt=e.hydrateInstance,Gt=e.hydrateTextInstance,Qt=e.hydrateSuspenseInstance,Ht=e.getNextHydratableInstanceAfterSuspenseInstance,Vt=e.commitHydratedContainer,jt=e.commitHydratedSuspenseInstance,Wt=e.clearSuspenseBoundary,Yt=e.clearSuspenseBoundaryFromContainer,Kt=e.shouldDeleteUnhydratedTailInstances,qt=e.didNotMatchHydratedContainerTextInstance,Xt=e.didNotMatchHydratedTextInstance,$t=e.didNotHydrateInstanceWithinContainer,Jt=e.didNotHydrateInstanceWithinSuspenseInstance,Zt=e.didNotHydrateInstance,en=e.didNotFindHydratableInstanceWithinContainer,tn=e.didNotFindHydratableTextInstanceWithinContainer,nn=e.didNotFindHydratableSuspenseInstanceWithinContainer,rn=e.didNotFindHydratableInstanceWithinSuspenseInstance,sn=e.didNotFindHydratableTextInstanceWithinSuspenseInstance,an=e.didNotFindHydratableSuspenseInstanceWithinSuspenseInstance,on=e.didNotFindHydratableInstance,ln=e.didNotFindHydratableTextInstance,cn=e.didNotFindHydratableSuspenseInstance,un=e.errorHydratingContainer,hn=0;function dn(){}dn.__reactDisabledLog=!0;var fn,pn=s.ReactCurrentDispatcher;function mn(e,t,n){if(void 0===fn)try{throw Error()}catch(e){var r=e.stack.trim().match(/\n( *(at )?)/);fn=r&&r[1]||""}return"\n"+fn+e}var gn,An=!1,vn="function"==typeof WeakMap?WeakMap:Map;function yn(e,t){if(!e||An)return"";var n,r=gn.get(e);if(void 0!==r)return r;An=!0;var i,s=Error.prepareStackTrace;Error.prepareStackTrace=void 0,i=pn.current,pn.current=null,function(){if(0===hn){_t=console.log,xt=console.info,bt=console.warn,St=console.error,wt=console.group,Ct=console.groupCollapsed,Tt=console.groupEnd;var e={configurable:!0,enumerable:!0,value:dn,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}hn++}();try{if(t){var a=function(){throw Error()};if(Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(a,[])}catch(e){n=e}Reflect.construct(e,[],a)}else{try{a.call()}catch(e){n=e}e.call(a.prototype)}}else{try{throw Error()}catch(e){n=e}e()}}catch(t){if(t&&n&&"string"==typeof t.stack){for(var o=t.stack.split("\n"),c=n.stack.split("\n"),h=o.length-1,d=c.length-1;h>=1&&d>=0&&o[h]!==c[d];)d--;for(;h>=1&&d>=0;h--,d--)if(o[h]!==c[d]){if(1!==h||1!==d)do{if(h--,--d<0||o[h]!==c[d]){var f="\n"+o[h].replace(" at new "," at ");return e.displayName&&f.includes("<anonymous>")&&(f=f.replace("<anonymous>",e.displayName)),"function"==typeof e&&gn.set(e,f),f}}while(h>=1&&d>=0);break}}}finally{An=!1,pn.current=i,function(){if(0===--hn){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:u({},e,{value:_t}),info:u({},e,{value:xt}),warn:u({},e,{value:bt}),error:u({},e,{value:St}),group:u({},e,{value:wt}),groupCollapsed:u({},e,{value:Ct}),groupEnd:u({},e,{value:Tt})})}hn<0&&l("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=s}var p=e?e.displayName||e.name:"",m=p?mn(p):"";return"function"==typeof e&&gn.set(e,m),m}function En(e,t,n){return yn(e,!1)}function _n(e,t,n){if(null==e)return"";if("function"==typeof e)return yn(e,!(!(r=e.prototype)||!r.isReactComponent));var r;if("string"==typeof e)return mn(e);switch(e){case D:return mn("Suspense");case L:return mn("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case P:return En(e.render);case k:return _n(e.type,t,n);case F:var i=e,s=i._payload,a=i._init;try{return _n(a(s),t,n)}catch(e){}}return""}gn=new vn;var xn=Object.prototype.hasOwnProperty,bn={},Sn=s.ReactDebugCurrentFrame;function wn(e){if(e){var t=e._owner,n=_n(e.type,e._source,t?t.type:null);Sn.setExtraStackFrame(n)}else Sn.setExtraStackFrame(null)}function Cn(e,t,n,r,i){var s=Function.call.bind(xn);for(var a in e)if(s(e,a)){var o=void 0;try{if("function"!=typeof e[a]){var c=Error((r||"React class")+": "+n+" type `"+a+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[a]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw c.name="Invariant Violation",c}o=e[a](t,a,r,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(e){o=e}!o||o instanceof Error||(wn(i),l("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",n,a,typeof o),wn(null)),o instanceof Error&&!(o.message in bn)&&(bn[o.message]=!0,wn(i),l("Failed %s type: %s",n,o.message),wn(null))}}var Tn,Mn=[];Tn=[];var In,Rn=-1;function Bn(e){return{current:e}}function Pn(e,t){Rn<0?l("Unexpected pop."):(t!==Tn[Rn]&&l("Unexpected Fiber popped."),e.current=Mn[Rn],Mn[Rn]=null,Tn[Rn]=null,Rn--)}function Dn(e,t,n){Rn++,Mn[Rn]=e.current,Tn[Rn]=n,e.current=t}In={};var Ln={};Object.freeze(Ln);var kn=Bn(Ln),Fn=Bn(!1),On=Ln;function Un(e,t,n){return n&&Qn(t)?On:kn.current}function Nn(e,t,n){var r=e.stateNode;r.__reactInternalMemoizedUnmaskedChildContext=t,r.__reactInternalMemoizedMaskedChildContext=n}function zn(e,t){var n=e.type.contextTypes;if(!n)return Ln;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={};for(var s in n)i[s]=t[s];return Cn(n,i,"context",H(e)||"Unknown"),r&&Nn(e,t,i),i}function Gn(){return Fn.current}function Qn(e){var t=e.childContextTypes;return null!=t}function Hn(e){Pn(Fn,e),Pn(kn,e)}function Vn(e){Pn(Fn,e),Pn(kn,e)}function jn(e,t,n){if(kn.current!==Ln)throw new Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");Dn(kn,t,e),Dn(Fn,n,e)}function Wn(e,t,n){var r=e.stateNode,i=t.childContextTypes;if("function"!=typeof r.getChildContext){var s=H(e)||"Unknown";return In[s]||(In[s]=!0,l("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",s,s)),n}var a=r.getChildContext();for(var o in a)if(!(o in i))throw new Error((H(e)||"Unknown")+'.getChildContext(): key "'+o+'" is not defined in childContextTypes.');return Cn(i,a,"child context",H(e)||"Unknown"),u({},n,a)}function Yn(e){var t=e.stateNode,n=t&&t.__reactInternalMemoizedMergedChildContext||Ln;return On=kn.current,Dn(kn,n,e),Dn(Fn,Fn.current,e),!0}function Kn(e,t,n){var r=e.stateNode;if(!r)throw new Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(n){var i=Wn(e,t,On);r.__reactInternalMemoizedMergedChildContext=i,Pn(Fn,e),Pn(kn,e),Dn(kn,i,e),Dn(Fn,n,e)}else Pn(Fn,e),Dn(Fn,n,e)}function qn(e){if(!function(e){return fe(e)===e}(e)||1!==e.tag)throw new Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var t=e;do{switch(t.tag){case 3:return t.stateNode.context;case 1:if(Qn(t.type))return t.stateNode.__reactInternalMemoizedMergedChildContext}t=t.return}while(null!==t);throw new Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}var Xn=16,$n=Math.clz32?Math.clz32:function(e){var t=e>>>0;if(0===t)return 32;return 31-(Jn(t)/Zn|0)|0},Jn=Math.log,Zn=Math.LN2;var er=16,tr=4194240,nr=1024,rr=2048,ir=4096,sr=8192,ar=16384,or=32768,lr=65536,cr=131072,ur=262144,hr=524288,dr=1048576,fr=2097152,pr=130023424,mr=4194304,gr=8388608,Ar=16777216,vr=33554432,yr=67108864,Er=mr,_r=134217728,xr=268435455,br=268435456,Sr=536870912,wr=1073741824;function Cr(e){return 1&e?"Sync":2&e?"InputContinuousHydration":4&e?"InputContinuous":8&e?"DefaultHydration":e&er?"Default":32&e?"TransitionHydration":e&tr?"Transition":e&pr?"Retry":e&_r?"SelectiveHydration":e&br?"IdleHydration":e&Sr?"Idle":e&wr?"Offscreen":void 0}var Tr=-1,Mr=64,Ir=mr;function Rr(e){switch(Ur(e)){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case er:return er;case 32:return 32;case 64:case 128:case 256:case 512:case nr:case rr:case ir:case sr:case ar:case or:case lr:case cr:case ur:case hr:case dr:case fr:return e&tr;case mr:case gr:case Ar:case vr:case yr:return e&pr;case _r:return _r;case br:return br;case Sr:return Sr;case wr:return wr;default:return l("Should have found matching lanes. This is a bug in React."),e}}function Br(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,a=n&xr;if(0!==a){var o=a&~i;if(0!==o)r=Rr(o);else{var l=a&s;0!==l&&(r=Rr(l))}}else{var c=n&~i;0!==c?r=Rr(c):0!==s&&(r=Rr(s))}if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)){var u=Ur(r),h=Ur(t);if(u>=h||u===er&&0!==(h&tr))return t}4&r&&(r|=n&er);var d=e.entangledLanes;if(0!==d)for(var f=e.entanglements,p=r&d;p>0;){var m=zr(p),g=1<<m;r|=f[m],p&=~g}return r}function Pr(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case er:case 32:case 64:case 128:case 256:case 512:case nr:case rr:case ir:case sr:case ar:case or:case lr:case cr:case ur:case hr:case dr:case fr:return t+5e3;case mr:case gr:case Ar:case vr:case yr:case _r:case br:case Sr:case wr:return Tr;default:return l("Should have found matching lanes. This is a bug in React."),Tr}}function Dr(e){var t=-1073741825&e.pendingLanes;return 0!==t?t:t&wr?wr:0}function Lr(e){return 0!==(e&xr)}function kr(e){return(e&pr)===e}function Fr(e,t){return!!(30&t)}function Or(e){return 0!==(e&tr)}function Ur(e){return e&-e}function Nr(e){return Ur(e)}function zr(e){return 31-$n(e)}function Gr(e){return zr(e)}function Qr(e,t){return 0!==(e&t)}function Hr(e,t){return(e&t)===t}function Vr(e,t){return e|t}function jr(e,t){return e&~t}function Wr(e,t){return e&t}function Yr(e){for(var t=[],n=0;n<31;n++)t.push(e);return t}function Kr(e,t,n){e.pendingLanes|=t,t!==Sr&&(e.suspendedLanes=0,e.pingedLanes=0),e.eventTimes[Gr(t)]=n}function qr(e,t,n){e.pingedLanes|=e.suspendedLanes&t}function Xr(e,t){for(var n=e.entangledLanes|=t,r=e.entanglements,i=n;i;){var s=zr(i),a=1<<s;a&t|r[s]&t&&(r[s]|=t),i&=~a}}function $r(e,t,n){if(_i)for(var r=e.pendingUpdatersLaneMap;n>0;){var i=Gr(n),s=1<<i;r[i].add(t),n&=~s}}function Jr(e,t){if(_i)for(var n=e.pendingUpdatersLaneMap,r=e.memoizedUpdaters;t>0;){var i=Gr(t),s=1<<i,a=n[i];a.size>0&&(a.forEach(function(e){var t=e.alternate;null!==t&&r.has(t)||r.add(e)}),a.clear()),t&=~s}}var Zr=er,ei=Sr,ti=0;function ni(){return ti}function ri(e){ti=e}function ii(e,t){return 0!==e&&e<t}function si(e){var t=Ur(e);return ii(1,t)?ii(4,t)?Lr(t)?Zr:ei:4:1}var ai=i.unstable_scheduleCallback,oi=i.unstable_cancelCallback,li=i.unstable_shouldYield,ci=i.unstable_requestPaint,ui=i.unstable_now,hi=i.unstable_ImmediatePriority,di=i.unstable_UserBlockingPriority,fi=i.unstable_NormalPriority,pi=i.unstable_IdlePriority,mi=i.unstable_yieldValue,gi=i.unstable_setDisableYieldValue,Ai=null,vi=null,yi=null,Ei=!1,_i="undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__;function xi(e){if("function"==typeof mi&&(gi(e),a=e),vi&&"function"==typeof vi.setStrictMode)try{vi.setStrictMode(Ai,e)}catch(e){Ei||(Ei=!0,l("React instrumentation encountered an error: %s",e))}}function bi(e){yi=e}function Si(){for(var e=new Map,t=1,n=0;n<31;n++){var r=Cr(t);e.set(t,r),t*=2}return e}function wi(){null!==yi&&"function"==typeof yi.markCommitStopped&&yi.markCommitStopped()}function Ci(e){null!==yi&&"function"==typeof yi.markComponentRenderStarted&&yi.markComponentRenderStarted(e)}function Ti(){null!==yi&&"function"==typeof yi.markComponentRenderStopped&&yi.markComponentRenderStopped()}function Mi(e){null!==yi&&"function"==typeof yi.markComponentPassiveEffectMountStarted&&yi.markComponentPassiveEffectMountStarted(e)}function Ii(){null!==yi&&"function"==typeof yi.markComponentPassiveEffectMountStopped&&yi.markComponentPassiveEffectMountStopped()}function Ri(e){null!==yi&&"function"==typeof yi.markComponentPassiveEffectUnmountStarted&&yi.markComponentPassiveEffectUnmountStarted(e)}function Bi(){null!==yi&&"function"==typeof yi.markComponentPassiveEffectUnmountStopped&&yi.markComponentPassiveEffectUnmountStopped()}function Pi(e){null!==yi&&"function"==typeof yi.markComponentLayoutEffectMountStarted&&yi.markComponentLayoutEffectMountStarted(e)}function Di(){null!==yi&&"function"==typeof yi.markComponentLayoutEffectMountStopped&&yi.markComponentLayoutEffectMountStopped()}function Li(e){null!==yi&&"function"==typeof yi.markComponentLayoutEffectUnmountStarted&&yi.markComponentLayoutEffectUnmountStarted(e)}function ki(){null!==yi&&"function"==typeof yi.markComponentLayoutEffectUnmountStopped&&yi.markComponentLayoutEffectUnmountStopped()}function Fi(e,t,n){null!==yi&&"function"==typeof yi.markComponentErrored&&yi.markComponentErrored(e,t,n)}function Oi(e,t,n){null!==yi&&"function"==typeof yi.markComponentSuspended&&yi.markComponentSuspended(e,t,n)}function Ui(e){null!==yi&&"function"==typeof yi.markRenderStarted&&yi.markRenderStarted(e)}function Ni(){null!==yi&&"function"==typeof yi.markRenderStopped&&yi.markRenderStopped()}function zi(e,t){null!==yi&&"function"==typeof yi.markStateUpdateScheduled&&yi.markStateUpdateScheduled(e,t)}var Gi="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Qi=null,Hi=!1,Vi=!1;function ji(e){null===Qi?Qi=[e]:Qi.push(e)}function Wi(){Hi&&Yi()}function Yi(){if(!Vi&&null!==Qi){Vi=!0;var e=0,t=ni();try{var n=Qi;for(ri(1);e<n.length;e++){var r=n[e];do{r=r(true)}while(null!==r)}Qi=null,Hi=!1}catch(t){throw null!==Qi&&(Qi=Qi.slice(e+1)),ai(hi,Yi),t}finally{ri(t),Vi=!1}}return null}function Ki(e){return e.current.memoizedState.isDehydrated}var qi=s.ReactCurrentBatchConfig;function Xi(e,t){if(Gi(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++){var s=n[i];if(!xn.call(t,s)||!Gi(e[s],t[s]))return!1}return!0}function $i(e){switch(e._debugOwner&&e._debugOwner.type,e._debugSource,e.tag){case 5:return mn(e.type);case 16:return mn("Lazy");case A:return mn("Suspense");case x:return mn("SuspenseList");case 0:case 2:case y:return En(e.type);case m:return En(e.type.render);case 1:return yn(e.type,!0);default:return""}}function Ji(e){try{var t="",n=e;do{t+=$i(n),n=n.return}while(n);return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}var Zi=s.ReactDebugCurrentFrame,es=null,ts=!1;function ns(){return null===es?"":Ji(es)}function rs(){Zi.getCurrentStack=null,es=null,ts=!1}function is(e){Zi.getCurrentStack=ns,es=e,ts=!1}function ss(e){ts=e}var as={recordUnsafeLifecycleWarnings:function(e,t){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(e,t){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}},os=function(e){var t=[];return e.forEach(function(e){t.push(e)}),t.sort().join(", ")},ls=[],cs=[],us=[],hs=[],ds=[],fs=[],ps=new Set;as.recordUnsafeLifecycleWarnings=function(e,t){ps.has(e.type)||("function"==typeof t.componentWillMount&&!0!==t.componentWillMount.__suppressDeprecationWarning&&ls.push(e),8&e.mode&&"function"==typeof t.UNSAFE_componentWillMount&&cs.push(e),"function"==typeof t.componentWillReceiveProps&&!0!==t.componentWillReceiveProps.__suppressDeprecationWarning&&us.push(e),8&e.mode&&"function"==typeof t.UNSAFE_componentWillReceiveProps&&hs.push(e),"function"==typeof t.componentWillUpdate&&!0!==t.componentWillUpdate.__suppressDeprecationWarning&&ds.push(e),8&e.mode&&"function"==typeof t.UNSAFE_componentWillUpdate&&fs.push(e))},as.flushPendingUnsafeLifecycleWarnings=function(){var e=new Set;ls.length>0&&(ls.forEach(function(t){e.add(H(t)||"Component"),ps.add(t.type)}),ls=[]);var t=new Set;cs.length>0&&(cs.forEach(function(e){t.add(H(e)||"Component"),ps.add(e.type)}),cs=[]);var n=new Set;us.length>0&&(us.forEach(function(e){n.add(H(e)||"Component"),ps.add(e.type)}),us=[]);var r=new Set;hs.length>0&&(hs.forEach(function(e){r.add(H(e)||"Component"),ps.add(e.type)}),hs=[]);var i=new Set;ds.length>0&&(ds.forEach(function(e){i.add(H(e)||"Component"),ps.add(e.type)}),ds=[]);var s=new Set;(fs.length>0&&(fs.forEach(function(e){s.add(H(e)||"Component"),ps.add(e.type)}),fs=[]),t.size>0)&&l("Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n\nPlease update the following components: %s",os(t));r.size>0&&l("Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state\n\nPlease update the following components: %s",os(r));s.size>0&&l("Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n\nPlease update the following components: %s",os(s));e.size>0&&o("componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",os(e));n.size>0&&o("componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state\n* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",os(n));i.size>0&&o("componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",os(i))};var ms=new Map,gs=new Set;function As(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}function vs(e){try{return ys(e),!1}catch(e){return!0}}function ys(e){return""+e}function Es(e,t){if(e&&e.defaultProps){var n=u({},t),r=e.defaultProps;for(var i in r)void 0===n[i]&&(n[i]=r[i]);return n}return t}as.recordLegacyContextWarning=function(e,t){var n=function(e){for(var t=null,n=e;null!==n;)8&n.mode&&(t=n),n=n.return;return t}(e);if(null!==n){if(!gs.has(e.type)){var r=ms.get(n);(null!=e.type.contextTypes||null!=e.type.childContextTypes||null!==t&&"function"==typeof t.getChildContext)&&(void 0===r&&(r=[],ms.set(n,r)),r.push(e))}}else l("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.")},as.flushLegacyContextWarning=function(){ms.forEach(function(e,t){if(0!==e.length){var n=e[0],r=new Set;e.forEach(function(e){r.add(H(e)||"Component"),gs.add(e.type)});var i=os(r);try{is(n),l("Legacy context API has been detected within a strict-mode tree.\n\nThe old API will be supported in all 16.x releases, but applications using it should migrate to the new version.\n\nPlease update the following components: %s\n\nLearn more about this warning here: https://reactjs.org/link/legacy-context",i)}finally{rs()}}})},as.discardPendingWarnings=function(){ls=[],cs=[],us=[],hs=[],ds=[],fs=[],ms=new Map};var _s,xs=Bn(null);_s={};var bs=null,Ss=null,ws=null,Cs=!1;function Ts(){bs=null,Ss=null,ws=null,Cs=!1}function Ms(){Cs=!0}function Is(){Cs=!1}function Rs(e,t,n){Fe?(Dn(xs,t._currentValue,e),t._currentValue=n,void 0!==t._currentRenderer&&null!==t._currentRenderer&&t._currentRenderer!==_s&&l("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),t._currentRenderer=_s):(Dn(xs,t._currentValue2,e),t._currentValue2=n,void 0!==t._currentRenderer2&&null!==t._currentRenderer2&&t._currentRenderer2!==_s&&l("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),t._currentRenderer2=_s)}function Bs(e,t){var n=xs.current;Pn(xs,t),Fe?e._currentValue=n:e._currentValue2=n}function Ps(e,t,n){for(var r=e;null!==r;){var i=r.alternate;if(Hr(r.childLanes,t)?null===i||Hr(i.childLanes,t)||(i.childLanes=Vr(i.childLanes,t)):(r.childLanes=Vr(r.childLanes,t),null!==i&&(i.childLanes=Vr(i.childLanes,t))),r===n)break;r=r.return}r!==n&&l("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function Ds(e,t,n){!function(e,t,n){var r=e.child;null!==r&&(r.return=e);for(;null!==r;){var i=void 0,s=r.dependencies;if(null!==s){i=r.child;for(var a=s.firstContext;null!==a;){if(a.context===t){if(1===r.tag){var o=Nr(n),l=js(Tr,o);l.tag=Gs;var c=r.updateQueue;if(null===c);else{var u=c.shared,h=u.pending;null===h?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}r.lanes=Vr(r.lanes,n);var d=r.alternate;null!==d&&(d.lanes=Vr(d.lanes,n)),Ps(r.return,n,e),s.lanes=Vr(s.lanes,n);break}a=a.next}}else if(r.tag===p)i=r.type===e.type?null:r.child;else if(r.tag===_){var f=r.return;if(null===f)throw new Error("We just came from a parent so we must have had a parent. This is a bug in React.");f.lanes=Vr(f.lanes,n);var m=f.alternate;null!==m&&(m.lanes=Vr(m.lanes,n)),Ps(f,n,e),i=r.sibling}else i=r.child;if(null!==i)i.return=r;else for(i=r;null!==i;){if(i===e){i=null;break}var g=i.sibling;if(null!==g){g.return=i.return,i=g;break}i=i.return}r=i}}(e,t,n)}function Ls(e,t){bs=e,Ss=null,ws=null;var n=e.dependencies;null!==n&&(null!==n.firstContext&&(Qr(n.lanes,t)&&Zu(),n.firstContext=null))}function ks(e){Cs&&l("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");var t=Fe?e._currentValue:e._currentValue2;if(ws===e);else{var n={context:e,memoizedValue:t,next:null};if(null===Ss){if(null===bs)throw new Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");Ss=n,bs.dependencies={lanes:0,firstContext:n}}else Ss=Ss.next=n}return t}var Fs=null;function Os(e){null===Fs?Fs=[e]:Fs.push(e)}var Us,Ns,zs=0,Gs=2,Qs=!1;function Hs(e){var t={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null};e.updateQueue=t}function Vs(e,t){var n=t.updateQueue,r=e.updateQueue;if(n===r){var i={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects};t.updateQueue=i}}function js(e,t){return{eventTime:e,lane:t,tag:zs,payload:null,callback:null,next:null}}function Ws(e,t,n){var r=e.updateQueue;if(null!==r){var i=r.shared;if(Uf(e)){var s=i.interleaved;null===s?(t.next=t,Os(i)):(t.next=s.next,s.next=t),i.interleaved=t}else{var a=i.pending;null===a?t.next=t:(t.next=a.next,a.next=t),i.pending=t}Ns!==i||Us||(l("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),Us=!0)}}function Ys(e,t,n){var r=t.updateQueue;if(null!==r){var i=r.shared;if(Or(n)){var s=i.lanes,a=Vr(s=Wr(s,e.pendingLanes),n);i.lanes=a,Xr(e,a)}}}function Ks(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r){var i=r.updateQueue;if(n===i){var s=null,a=null,o=n.firstBaseUpdate;if(null!==o){var l=o;do{var c={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};null===a?s=a=c:(a.next=c,a=c),l=l.next}while(null!==l);null===a?s=a=t:(a.next=t,a=t)}else s=a=t;return n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}}var u=n.lastBaseUpdate;null===u?n.firstBaseUpdate=t:u.next=t,n.lastBaseUpdate=t}function qs(e,t,n,r,i,s){switch(n.tag){case 1:var a=n.payload;if("function"==typeof a){Ms();var o=a.call(s,r,i);if(8&e.mode){xi(!0);try{a.call(s,r,i)}finally{xi(!1)}}return Is(),o}return a;case 3:e.flags=-65537&e.flags|j;case zs:var l,c=n.payload;if("function"==typeof c){if(Ms(),l=c.call(s,r,i),8&e.mode){xi(!0);try{c.call(s,r,i)}finally{xi(!1)}}Is()}else l=c;return null==l?r:u({},r,l);case Gs:return Qs=!0,r}return r}function Xs(e,t,n,r){var i=e.updateQueue;Qs=!1,Ns=i.shared;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var u=e.alternate;if(null!==u){var h=u.updateQueue,d=h.lastBaseUpdate;d!==a&&(null===d?h.firstBaseUpdate=c:d.next=c,h.lastBaseUpdate=l)}}if(null!==s){for(var f=i.baseState,p=0,m=null,g=null,A=null,v=s;;){var y=v.lane,E=v.eventTime;if(Hr(r,y)){if(null!==A){var _={eventTime:E,lane:0,tag:v.tag,payload:v.payload,callback:v.callback,next:null};A=A.next=_}if(f=qs(e,0,v,f,t,n),null!==v.callback&&0!==v.lane){e.flags|=64;var x=i.effects;null===x?i.effects=[v]:x.push(v)}}else{var b={eventTime:E,lane:y,tag:v.tag,payload:v.payload,callback:v.callback,next:null};null===A?(g=A=b,m=f):A=A.next=b,p=Vr(p,y)}if(null===(v=v.next)){if(null===(o=i.shared.pending))break;var S=o,w=S.next;S.next=null,v=w,i.lastBaseUpdate=S,i.shared.pending=null}}null===A&&(m=f),i.baseState=m,i.firstBaseUpdate=g,i.lastBaseUpdate=A;var C=i.shared.interleaved;if(null!==C){var T=C;do{p=Vr(p,T.lane),T=T.next}while(T!==C)}else null===s&&(i.shared.lanes=0);Jf(p),e.lanes=p,e.memoizedState=f}Ns=null}function $s(e,t){if("function"!=typeof e)throw new Error("Invalid argument passed as callback. Expected a function. Instead received: "+e);e.call(t)}function Js(){Qs=!1}function Zs(){return Qs}function ea(e,t,n){var r=t.effects;if(t.effects=null,null!==r)for(var i=0;i<r.length;i++){var s=r[i],a=s.callback;null!==a&&(s.callback=null,$s(a,n))}}Us=!1,Ns=null;var ta,na,ra,ia,sa,aa,oa,la,ca,ua,ha={},da=(new r.Component).refs;ta=new Set,na=new Set,ra=new Set,ia=new Set,la=new Set,sa=new Set,ca=new Set,ua=new Set;var fa=new Set;function pa(e,t,n,r){var i=e.memoizedState,s=n(r,i);if(8&e.mode){xi(!0);try{s=n(r,i)}finally{xi(!1)}}aa(t,s);var a=null==s?i:u({},i,s);(e.memoizedState=a,0===e.lanes)&&(e.updateQueue.baseState=a)}oa=function(e,t){if(null!==e&&"function"!=typeof e){var n=t+"_"+e;fa.has(n)||(fa.add(n),l("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",t,e))}},aa=function(e,t){if(void 0===t){var n=G(e)||"Component";sa.has(n)||(sa.add(n),l("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",n))}},Object.defineProperty(ha,"_processChildContext",{enumerable:!1,value:function(){throw new Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(ha);var ma={isMounted:function(e){var t=de.current;if(null!==t&&1===t.tag){var n=t,r=n.stateNode;r._warnedAboutRefsInRender||l("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",H(n)||"A component"),r._warnedAboutRefsInRender=!0}var i=h(e);return!!i&&fe(i)===i},enqueueSetState:function(e,t,n){var r=h(e),i=Df(),s=Lf(r),a=js(i,s);a.payload=t,null!=n&&(oa(n,"setState"),a.callback=n),Ws(r,a);var o=Ff(r,s,i);null!==o&&Ys(o,r,s),zi(r,s)},enqueueReplaceState:function(e,t,n){var r=h(e),i=Df(),s=Lf(r),a=js(i,s);a.tag=1,a.payload=t,null!=n&&(oa(n,"replaceState"),a.callback=n),Ws(r,a);var o=Ff(r,s,i);null!==o&&Ys(o,r,s),zi(r,s)},enqueueForceUpdate:function(e,t){var n=h(e),r=Df(),i=Lf(n),s=js(r,i);s.tag=Gs,null!=t&&(oa(t,"forceUpdate"),s.callback=t),Ws(n,s);var a=Ff(n,i,r);null!==a&&Ys(a,n,i),function(e,t){null!==yi&&"function"==typeof yi.markForceUpdateScheduled&&yi.markForceUpdateScheduled(e,t)}(n,i)}};function ga(e,t,n,r,i,s,a){var o=e.stateNode;if("function"==typeof o.shouldComponentUpdate){var c=o.shouldComponentUpdate(r,s,a);if(8&e.mode){xi(!0);try{c=o.shouldComponentUpdate(r,s,a)}finally{xi(!1)}}return void 0===c&&l("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",G(t)||"Component"),c}return!t.prototype||!t.prototype.isPureReactComponent||(!Xi(n,r)||!Xi(i,s))}function Aa(e,t){var n;t.updater=ma,e.stateNode=t,n=e,t._reactInternals=n,t._reactInternalInstance=ha}function va(e,t,n){var r=!1,i=Ln,s=Ln,a=t.contextType;if("contextType"in t&&(!(null===a||void 0!==a&&a.$$typeof===B&&void 0===a._context)&&!ua.has(t))){ua.add(t);var o="";o=void 0===a?" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":"object"!=typeof a?" However, it is set to a "+typeof a+".":a.$$typeof===R?" Did you accidentally pass the Context.Provider instead?":void 0!==a._context?" Did you accidentally pass the Context.Consumer instead?":" However, it is set to an object with keys {"+Object.keys(a).join(", ")+"}.",l("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",G(t)||"Component",o)}if("object"==typeof a&&null!==a)s=ks(a);else{i=Un(0,t,!0);var c=t.contextTypes;s=(r=null!=c)?zn(e,i):Ln}var u=new t(n,s);if(8&e.mode){xi(!0);try{u=new t(n,s)}finally{xi(!1)}}var h=e.memoizedState=null!==u.state&&void 0!==u.state?u.state:null;if(Aa(e,u),"function"==typeof t.getDerivedStateFromProps&&null===h){var d=G(t)||"Component";na.has(d)||(na.add(d),l("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",d,null===u.state?"null":"undefined",d))}if("function"==typeof t.getDerivedStateFromProps||"function"==typeof u.getSnapshotBeforeUpdate){var f=null,p=null,m=null;if("function"==typeof u.componentWillMount&&!0!==u.componentWillMount.__suppressDeprecationWarning?f="componentWillMount":"function"==typeof u.UNSAFE_componentWillMount&&(f="UNSAFE_componentWillMount"),"function"==typeof u.componentWillReceiveProps&&!0!==u.componentWillReceiveProps.__suppressDeprecationWarning?p="componentWillReceiveProps":"function"==typeof u.UNSAFE_componentWillReceiveProps&&(p="UNSAFE_componentWillReceiveProps"),"function"==typeof u.componentWillUpdate&&!0!==u.componentWillUpdate.__suppressDeprecationWarning?m="componentWillUpdate":"function"==typeof u.UNSAFE_componentWillUpdate&&(m="UNSAFE_componentWillUpdate"),null!==f||null!==p||null!==m){var g=G(t)||"Component",A="function"==typeof t.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";ia.has(g)||(ia.add(g),l("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n%s uses %s but also contains the following legacy lifecycles:%s%s%s\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://reactjs.org/link/unsafe-component-lifecycles",g,A,null!==f?"\n  "+f:"",null!==p?"\n  "+p:"",null!==m?"\n  "+m:""))}}return r&&Nn(e,i,s),u}function ya(e,t,n,r){var i=t.state;if("function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==i){var s=H(e)||"Component";ta.has(s)||(ta.add(s),l("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",s)),ma.enqueueReplaceState(t,t.state,null)}}function Ea(e,t,n,r){!function(e,t,n){var r=e.stateNode,i=G(t)||"Component";r.render||(t.prototype&&"function"==typeof t.prototype.render?l("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",i):l("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",i)),!r.getInitialState||r.getInitialState.isReactClassApproved||r.state||l("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",i),r.getDefaultProps&&!r.getDefaultProps.isReactClassApproved&&l("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",i),r.propTypes&&l("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",i),r.contextType&&l("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",i),r.contextTypes&&l("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",i),t.contextType&&t.contextTypes&&!ca.has(t)&&(ca.add(t),l("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",i)),"function"==typeof r.componentShouldUpdate&&l("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",i),t.prototype&&t.prototype.isPureReactComponent&&void 0!==r.shouldComponentUpdate&&l("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",G(t)||"A pure component"),"function"==typeof r.componentDidUnmount&&l("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",i),"function"==typeof r.componentDidReceiveProps&&l("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",i),"function"==typeof r.componentWillRecieveProps&&l("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",i),"function"==typeof r.UNSAFE_componentWillRecieveProps&&l("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",i);var s=r.props!==n;void 0!==r.props&&s&&l("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",i,i),r.defaultProps&&l("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",i,i),"function"!=typeof r.getSnapshotBeforeUpdate||"function"==typeof r.componentDidUpdate||ra.has(t)||(ra.add(t),l("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",G(t))),"function"==typeof r.getDerivedStateFromProps&&l("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",i),"function"==typeof r.getDerivedStateFromError&&l("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",i),"function"==typeof t.getSnapshotBeforeUpdate&&l("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",i);var a=r.state;a&&("object"!=typeof a||_e(a))&&l("%s.state: must be set to an object or null",i),"function"==typeof r.getChildContext&&"object"!=typeof t.childContextTypes&&l("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",i)}(e,t,n);var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=da,Hs(e);var s=t.contextType;if("object"==typeof s&&null!==s)i.context=ks(s);else{var a=Un(0,t,!0);i.context=zn(e,a)}if(i.state===n){var o=G(t)||"Component";la.has(o)||(la.add(o),l("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",o))}8&e.mode&&as.recordLegacyContextWarning(e,i),as.recordUnsafeLifecycleWarnings(e,i),i.state=e.memoizedState;var c=t.getDerivedStateFromProps;if("function"==typeof c&&(pa(e,t,c,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(!function(e,t){var n=t.state;"function"==typeof t.componentWillMount&&t.componentWillMount(),"function"==typeof t.UNSAFE_componentWillMount&&t.UNSAFE_componentWillMount(),n!==t.state&&(l("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",H(e)||"Component"),ma.enqueueReplaceState(t,t.state,null))}(e,i),Xs(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount){var u=4;u|=ie,0!==(e.mode&Xn)&&(u|=se),e.flags|=u}}var _a=[],xa=0,ba=null,Sa=0,wa=[],Ca=0,Ta=null,Ma=1,Ia="";function Ra(){var e=Ia;return(Ma&~function(e){return 1<<La(e)-1}(Ma)).toString(32)+e}function Ba(e,t){Fa(),_a[xa++]=Sa,_a[xa++]=ba,ba=e,Sa=t}function Pa(e,t,n){Fa(),wa[Ca++]=Ma,wa[Ca++]=Ia,wa[Ca++]=Ta,Ta=e;var r=Ma,i=Ia,s=La(r)-1,a=r&~(1<<s),o=n+1,l=La(t)+s;if(l>30){var c=s-s%5,u=(a&(1<<c)-1).toString(32),h=a>>c,d=s-c,f=La(t)+d;Ma=1<<f|(o<<d|h),Ia=u+i}else{Ma=1<<l|(o<<s|a),Ia=i}}function Da(e){if(Fa(),null!==e.return){Ba(e,1),Pa(e,1,0)}}function La(e){return 32-$n(e)}function ka(e){for(;e===ba;)ba=_a[--xa],_a[xa]=null,Sa=_a[--xa],_a[xa]=null;for(;e===Ta;)Ta=wa[--Ca],wa[Ca]=null,Ia=wa[--Ca],wa[Ca]=null,Ma=wa[--Ca],wa[Ca]=null}function Fa(){oo()||l("Expected to be hydrating. This is a bug in React. Please file an issue.")}var Oa,Ua,Na,za,Ga,Qa=null,Ha=null,Va=!1,ja=!1,Wa=null;function Ya(e,t,n){return!!ze&&(Ha=Nt(t),Qa=e,Va=!0,Wa=null,ja=!1,null!==n&&function(e,t){Fa(),wa[Ca++]=Ma,wa[Ca++]=Ia,wa[Ca++]=Ta,Ma=t.id,Ia=t.overflow,Ta=e}(e,n),!0)}function Ka(e,t){switch(e.tag){case 3:$t(e.stateNode.containerInfo,t);break;case 5:Zt(e.type,e.memoizedProps,e.stateNode,t);break;case A:var n=e.memoizedState;null!==n.dehydrated&&Jt(n.dehydrated,t)}}function qa(e,t){Ka(e,t);var n,r=((n=Hp(5,null,null,0)).elementType="DELETED",n);r.stateNode=t,r.return=e;var i=e.deletions;null===i?(e.deletions=[r],e.flags|=V):i.push(r)}function Xa(e,t){if(!ja)switch(e.tag){case 3:var n=e.stateNode.containerInfo;switch(t.tag){case 5:var r=t.type,i=t.pendingProps;en(n,r,i);break;case 6:var s=t.pendingProps;tn(n,s);break;case A:nn(n)}break;case 5:var a=e.type,o=e.memoizedProps,l=e.stateNode;switch(t.tag){case 5:var c=t.type,u=t.pendingProps;on(a,o,l,c,u);break;case 6:var h=t.pendingProps;ln(a,o,l,h);break;case A:cn(a,o,l)}break;case A:var d=e.memoizedState.dehydrated;if(null!==d)switch(t.tag){case 5:var f=t.type,p=t.pendingProps;rn(d,f,p);break;case 6:var m=t.pendingProps;sn(d,m);break;case A:an(d)}break;default:return}}function $a(e,t){t.flags=-4097&t.flags|2,Xa(e,t)}function Ja(e,t){switch(e.tag){case 5:var n=e.type,r=e.pendingProps,i=Rt(t,n,r);return null!==i&&(e.stateNode=i,Qa=e,Ha=Ot(i),!0);case 6:var s=e.pendingProps,a=Bt(t,s);return null!==a&&(e.stateNode=a,Qa=e,Ha=null,!0);case A:var o=Pt(t);if(null!==o){var l={dehydrated:o,treeContext:(Fa(),null!==Ta?{id:Ma,overflow:Ia}:null),retryLane:wr};e.memoizedState=l;var c=function(e){var t=Hp(_,null,null,0);return t.stateNode=e,t}(o);return c.return=e,e.child=c,Qa=e,Ha=null,!0}return!1;default:return!1}}function Za(e){return!!(1&e.mode)&&0===(e.flags&j)}function eo(e){throw new Error("Hydration failed because the initial UI does not match what was rendered on the server.")}function to(e){if(Va){var t=Ha;if(!t)return Za(e)&&(Xa(Qa,e),eo()),$a(Qa,e),Va=!1,void(Qa=e);var n=t;if(!Ja(e,t)){Za(e)&&(Xa(Qa,e),eo()),t=Ft(n);var r=Qa;if(!t||!Ja(e,t))return $a(Qa,e),Va=!1,void(Qa=e);qa(r,n)}}}function no(e){for(var t=e.return;null!==t&&5!==t.tag&&3!==t.tag&&t.tag!==A;)t=t.return;Qa=t}function ro(e){if(!ze)return!1;if(e!==Qa)return!1;if(!Va)return no(e),Va=!0,!1;if(3!==e.tag&&(5!==e.tag||Kt(e.type)&&!Be(e.type,e.memoizedProps))){var t=Ha;if(t)if(Za(e))io(e),eo();else for(;t;)qa(e,t),t=Ft(t)}return no(e),Ha=e.tag===A?function(e){if(!ze)throw new Error("Expected skipPastDehydratedSuspenseInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var t=e.memoizedState,n=null!==t?t.dehydrated:null;if(!n)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return Ht(n)}(e):Qa?Ft(e.stateNode):null,!0}function io(e){for(var t=Ha;t;)Ka(e,t),t=Ft(t)}function so(){ze&&(Qa=null,Ha=null,Va=!1,ja=!1)}function ao(){null!==Wa&&(Qf(Wa),Wa=null)}function oo(){return Va}function lo(e){null===Wa?Wa=[e]:Wa.push(e)}var co;function uo(e,t,n){var r=n.ref;if(null!==r&&"function"!=typeof r&&"object"!=typeof r){if(8&e.mode&&(!n._owner||!n._self||n._owner.stateNode===n._self)){var i=H(e)||"Component";Na[i]||(l('A string ref, "%s", has been found within a strict mode tree. String refs are a source of potential bugs and should be avoided. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',r),Na[i]=!0)}if(n._owner){var s,a=n._owner;if(a){var o=a;if(1!==o.tag)throw new Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");s=o.stateNode}if(!s)throw new Error("Missing owner for string ref "+r+". This error is likely caused by a bug in React. Please file an issue.");var c=s;!function(e,t){if(vs(e))l("The provided `%s` prop is an unsupported type %s. This value must be coerced to a string before before using it here.",t,As(e)),ys(e)}(r,"ref");var u=""+r;if(null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===u)return t.ref;var h=function(e){var t=c.refs;t===da&&(t=c.refs={}),null===e?delete t[u]:t[u]=e};return h._stringRef=u,h}if("string"!=typeof r)throw new Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!n._owner)throw new Error("Element ref was specified as a string ("+r+") but no owner was set. This could happen for one of the following reasons:\n1. You may be adding a ref to a function component\n2. You may be adding a ref to a component that was not created inside a component's render method\n3. You have multiple copies of React loaded\nSee https://reactjs.org/link/refs-must-have-owner for more information.")}return r}function ho(e,t){var n=Object.prototype.toString.call(t);throw new Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(t).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.")}function fo(e){var t=H(e)||"Component";Ga[t]||(Ga[t]=!0,l("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it."))}function po(e){var t=e._payload;return(0,e._init)(t)}function mo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=V):r.push(n)}}function n(n,r){if(!e)return null;for(var i=r;null!==i;)t(n,i),i=i.sibling;return null}function r(e,t){for(var n=new Map,r=t;null!==r;)null!==r.key?n.set(r.key,r):n.set(r.index,r),r=r.sibling;return n}function i(e,t){var n=jp(e,t);return n.index=0,n.sibling=null,n}function s(t,n,r){if(t.index=r,!e)return t.flags|=ne,n;var i=t.alternate;if(null!==i){var s=i.index;return s<n?(t.flags|=2,n):s}return t.flags|=2,n}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function o(e,t,n,r){if(null===t||6!==t.tag){var s=$p(n,e.mode,r);return s.return=e,s}var a=i(t,n);return a.return=e,a}function c(e,t,n,r){var s=n.type;if(s===T)return h(e,t,n.props.children,r,n.key);if(null!==t&&(t.elementType===s||Dp(t,n)||"object"==typeof s&&null!==s&&s.$$typeof===F&&po(s)===t.type)){var a=i(t,n.props);return a.ref=uo(e,t,n),a.return=e,a._debugSource=n._source,a._debugOwner=n._owner,a}var o=Kp(n,e.mode,r);return o.ref=uo(e,t,n),o.return=e,o}function u(e,t,n,r){if(null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation){var s=Jp(n,e.mode,r);return s.return=e,s}var a=i(t,n.children||[]);return a.return=e,a}function h(e,t,n,r,s){if(null===t||7!==t.tag){var a=qp(n,e.mode,r,s);return a.return=e,a}var o=i(t,n);return o.return=e,o}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t){var r=$p(""+t,e.mode,n);return r.return=e,r}if("object"==typeof t&&null!==t){switch(t.$$typeof){case w:var i=Kp(t,e.mode,n);return i.ref=uo(e,null,t),i.return=e,i;case C:var s=Jp(t,e.mode,n);return s.return=e,s;case F:var a=t._payload;return d(e,(0,t._init)(a),n)}if(_e(t)||N(t)){var o=qp(t,e.mode,n,null);return o.return=e,o}ho(0,t)}return"function"==typeof t&&fo(e),null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:o(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?c(e,t,n,r):null;case C:return n.key===i?u(e,t,n,r):null;case F:var s=n._payload;return f(e,t,(0,n._init)(s),r)}if(_e(n)||N(n))return null!==i?null:h(e,t,n,r,null);ho(0,n)}return"function"==typeof n&&fo(e),null}function p(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return o(t,e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e.get(null===r.key?n:r.key)||null,r,i);case C:return u(t,e.get(null===r.key?n:r.key)||null,r,i);case F:var s=r._payload;return p(e,t,n,(0,r._init)(s),i)}if(_e(r)||N(r))return h(t,e.get(n)||null,r,i,null);ho(0,r)}return"function"==typeof r&&fo(t),null}function m(e,t,n){if("object"!=typeof e||null===e)return t;switch(e.$$typeof){case w:case C:co(e,n);var r=e.key;if("string"!=typeof r)break;if(null===t){(t=new Set).add(r);break}if(!t.has(r)){t.add(r);break}l("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.",r);break;case F:var i=e._payload;m((0,e._init)(i),t,n)}return t}return function o(c,u,h,g){if("object"==typeof h&&null!==h&&h.type===T&&null===h.key&&(h=h.props.children),"object"==typeof h&&null!==h){switch(h.$$typeof){case w:return a(function(e,r,s,a){for(var o=s.key,l=r;null!==l;){if(l.key===o){var c=s.type;if(c===T){if(7===l.tag){n(e,l.sibling);var u=i(l,s.props.children);return u.return=e,u._debugSource=s._source,u._debugOwner=s._owner,u}}else if(l.elementType===c||Dp(l,s)||"object"==typeof c&&null!==c&&c.$$typeof===F&&po(c)===l.type){n(e,l.sibling);var h=i(l,s.props);return h.ref=uo(e,l,s),h.return=e,h._debugSource=s._source,h._debugOwner=s._owner,h}n(e,l);break}t(e,l),l=l.sibling}if(s.type===T){var d=qp(s.props.children,e.mode,a,s.key);return d.return=e,d}var f=Kp(s,e.mode,a);return f.ref=uo(e,r,s),f.return=e,f}(c,u,h,g));case C:return a(function(e,r,s,a){for(var o=s.key,l=r;null!==l;){if(l.key===o){if(4===l.tag&&l.stateNode.containerInfo===s.containerInfo&&l.stateNode.implementation===s.implementation){n(e,l.sibling);var c=i(l,s.children||[]);return c.return=e,c}n(e,l);break}t(e,l),l=l.sibling}var u=Jp(s,e.mode,a);return u.return=e,u}(c,u,h,g));case F:var A=h._payload;return o(c,u,(0,h._init)(A),g)}if(_e(h))return function(i,a,o,l){for(var c=null,u=0;u<o.length;u++)c=m(o[u],c,i);for(var h=null,g=null,A=a,v=0,y=0,E=null;null!==A&&y<o.length;y++){A.index>y?(E=A,A=null):E=A.sibling;var _=f(i,A,o[y],l);if(null===_){null===A&&(A=E);break}e&&A&&null===_.alternate&&t(i,A),v=s(_,v,y),null===g?h=_:g.sibling=_,g=_,A=E}if(y===o.length)return n(i,A),oo()&&Ba(i,y),h;if(null===A){for(;y<o.length;y++){var x=d(i,o[y],l);null!==x&&(v=s(x,v,y),null===g?h=x:g.sibling=x,g=x)}return oo()&&Ba(i,y),h}for(var b=r(0,A);y<o.length;y++){var S=p(b,i,y,o[y],l);null!==S&&(e&&null!==S.alternate&&b.delete(null===S.key?y:S.key),v=s(S,v,y),null===g?h=S:g.sibling=S,g=S)}return e&&b.forEach(function(e){return t(i,e)}),oo()&&Ba(i,y),h}(c,u,h,g);if(N(h))return function(i,a,o,c){var u=N(o);if("function"!=typeof u)throw new Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");"function"==typeof Symbol&&"Generator"===o[Symbol.toStringTag]&&(Ua||l("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),Ua=!0),o.entries===u&&(Oa||l("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Oa=!0);var h=u.call(o);if(h)for(var g=null,A=h.next();!A.done;A=h.next())g=m(A.value,g,i);var v=u.call(o);if(null==v)throw new Error("An iterable object provided no iterator.");for(var y=null,E=null,_=a,x=0,b=0,S=null,w=v.next();null!==_&&!w.done;b++,w=v.next()){_.index>b?(S=_,_=null):S=_.sibling;var C=f(i,_,w.value,c);if(null===C){null===_&&(_=S);break}e&&_&&null===C.alternate&&t(i,_),x=s(C,x,b),null===E?y=C:E.sibling=C,E=C,_=S}if(w.done)return n(i,_),oo()&&Ba(i,b),y;if(null===_){for(;!w.done;b++,w=v.next()){var T=d(i,w.value,c);null!==T&&(x=s(T,x,b),null===E?y=T:E.sibling=T,E=T)}return oo()&&Ba(i,b),y}for(var M=r(0,_);!w.done;b++,w=v.next()){var I=p(M,i,b,w.value,c);null!==I&&(e&&null!==I.alternate&&M.delete(null===I.key?b:I.key),x=s(I,x,b),null===E?y=I:E.sibling=I,E=I)}return e&&M.forEach(function(e){return t(i,e)}),oo()&&Ba(i,b),y}(c,u,h,g);ho(0,h)}return"string"==typeof h&&""!==h||"number"==typeof h?a(function(e,t,r,s){if(null!==t&&6===t.tag){n(e,t.sibling);var a=i(t,r);return a.return=e,a}n(e,t);var o=$p(r,e.mode,s);return o.return=e,o}(c,u,""+h,g)):("function"==typeof h&&fo(c),n(c,u))}}Oa=!1,Ua=!1,Na={},za={},Ga={},co=function(e,t){if(null!==e&&"object"==typeof e&&e._store&&!e._store.validated&&null==e.key){if("object"!=typeof e._store)throw new Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");e._store.validated=!0;var n=H(t)||"Component";za[n]||(za[n]=!0,l('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};var go=mo(!0),Ao=mo(!1);function vo(e,t){for(var n=e.child;null!==n;)Wp(n,t),n=n.sibling}var yo={},Eo=Bn(yo),_o=Bn(yo),xo=Bn(yo);function bo(e){if(e===yo)throw new Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return e}function So(){return bo(xo.current)}function wo(e,t){Dn(xo,t,e),Dn(_o,e,e),Dn(Eo,yo,e);var n=be(t);Pn(Eo,e),Dn(Eo,n,e)}function Co(e){Pn(Eo,e),Pn(_o,e),Pn(xo,e)}function To(){return bo(Eo.current)}function Mo(e){var t=bo(xo.current),n=bo(Eo.current),r=Se(n,e.type,t);n!==r&&(Dn(_o,e,e),Dn(Eo,r,e))}function Io(e){_o.current===e&&(Pn(Eo,e),Pn(_o,e))}var Ro=1,Bo=1,Po=2,Do=Bn(0);function Lo(e,t){return 0!==(e&t)}function ko(e){return e&Ro}function Fo(e,t){return e&Ro|t}function Oo(e,t){Dn(Do,t,e)}function Uo(e){Pn(Do,e)}function No(e,t){var n=e.memoizedState;return null!==n?null!==n.dehydrated:(e.memoizedProps,!0)}function zo(e){for(var t=e;null!==t;){if(t.tag===A){var n=t.memoizedState;if(null!==n){var r=n.dehydrated;if(null===r||Dt(r)||Lt(r))return t}}else if(t.tag===x&&void 0!==t.memoizedProps.revealOrder){if(0!==(t.flags&j))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)return null;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Go=0,Qo=1,Ho=2,Vo=4,jo=8,Wo=[];function Yo(){for(var e=0;e<Wo.length;e++){var t=Wo[e];Fe?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}Wo.length=0}var Ko,qo,Xo=s.ReactCurrentDispatcher,$o=s.ReactCurrentBatchConfig;Ko=new Set;var Jo=0,Zo=null,el=null,tl=null,nl=!1,rl=!1,il=0,sl=0,al=null,ol=null,ll=-1,cl=!1;function ul(){var e=al;null===ol?ol=[e]:ol.push(e)}function hl(){var e=al;null!==ol&&(ll++,ol[ll]!==e&&function(e){var t=H(Zo);if(!Ko.has(t)&&(Ko.add(t),null!==ol)){for(var n="",r=30,i=0;i<=ll;i++){for(var s=ol[i],a=i===ll?e:s,o=i+1+". "+s;o.length<r;)o+=" ";n+=o+=a+"\n"}l("React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks\n\n   Previous render            Next render\n   ------------------------------------------------------\n%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",t,n)}}(e))}function dl(e){null==e||_e(e)||l("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",al,typeof e)}function fl(){throw new Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.")}function pl(e,t){if(cl)return!1;if(null===t)return l("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",al),!1;e.length!==t.length&&l("The final argument passed to %s changed size between renders. The order and size of this array must remain constant.\n\nPrevious: %s\nIncoming: %s",al,"["+t.join(", ")+"]","["+e.join(", ")+"]");for(var n=0;n<t.length&&n<e.length;n++)if(!Gi(e[n],t[n]))return!1;return!0}function ml(e,t,n,r,i,s){Jo=s,Zo=t,ol=null!==e?e._debugHookTypes:null,ll=-1,cl=null!==e&&e.type!==t.type,t.memoizedState=null,t.updateQueue=null,t.lanes=0,null!==e&&null!==e.memoizedState?Xo.current=_c:Xo.current=null!==ol?Ec:yc;var a=n(r,i);if(rl){var o=0;do{if(rl=!1,il=0,o>=25)throw new Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");o+=1,cl=!1,el=null,tl=null,t.updateQueue=null,ll=-1,Xo.current=xc,a=n(r,i)}while(rl)}Xo.current=vc,t._debugHookTypes=ol;var c=null!==el&&null!==el.next;if(Jo=0,Zo=null,el=null,tl=null,al=null,ol=null,ll=-1,null!==e&&(e.flags&he)!==(t.flags&he)&&1&e.mode&&l("Internal React error: Expected static flag was missing. Please notify the React team."),nl=!1,c)throw new Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return a}function gl(){var e=0!==il;return il=0,e}function Al(e,t,n){t.updateQueue=e.updateQueue,0!==(t.mode&Xn)?t.flags&=-50333701:t.flags&=-2053,e.lanes=jr(e.lanes,n)}function vl(){if(Xo.current=vc,nl){for(var e=Zo.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}nl=!1}Jo=0,Zo=null,el=null,tl=null,ol=null,ll=-1,al=null,lc=!1,rl=!1,il=0}function yl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===tl?Zo.memoizedState=tl=e:tl=tl.next=e,tl}function El(){var e,t;if(null===el){var n=Zo.alternate;e=null!==n?n.memoizedState:null}else e=el.next;if(null!==(t=null===tl?Zo.memoizedState:tl.next))t=(tl=t).next,el=e;else{if(null===e)throw new Error("Rendered more hooks than during the previous render.");var r={memoizedState:(el=e).memoizedState,baseState:el.baseState,baseQueue:el.baseQueue,queue:el.queue,next:null};null===tl?Zo.memoizedState=tl=r:tl=tl.next=r}return tl}function _l(e,t){return"function"==typeof t?t(e):t}function xl(e,t,n){var r,i=yl();r=void 0!==n?n(t):t,i.memoizedState=i.baseState=r;var s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r};i.queue=s;var a=s.dispatch=hc.bind(null,Zo,s);return[i.memoizedState,a]}function bl(e,t,n){var r=El(),i=r.queue;if(null===i)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");i.lastRenderedReducer=e;var s=el,a=s.baseQueue,o=i.pending;if(null!==o){if(null!==a){var c=a.next,u=o.next;a.next=u,o.next=c}s.baseQueue!==a&&l("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),s.baseQueue=a=o,i.pending=null}if(null!==a){var h=a.next,d=s.baseState,f=null,p=null,m=null,g=h;do{var A=g.lane;if(Hr(Jo,A)){if(null!==m){var v={lane:0,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};m=m.next=v}if(g.hasEagerState)d=g.eagerState;else d=e(d,g.action)}else{var y={lane:A,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};null===m?(p=m=y,f=d):m=m.next=y,Zo.lanes=Vr(Zo.lanes,A),Jf(A)}g=g.next}while(null!==g&&g!==h);null===m?f=d:m.next=p,Gi(d,r.memoizedState)||Zu(),r.memoizedState=d,r.baseState=f,r.baseQueue=m,i.lastRenderedState=d}var E=i.interleaved;if(null!==E){var _=E;do{var x=_.lane;Zo.lanes=Vr(Zo.lanes,x),Jf(x),_=_.next}while(_!==E)}else null===a&&(i.lanes=0);var b=i.dispatch;return[r.memoizedState,b]}function Sl(e,t,n){var r=El(),i=r.queue;if(null===i)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");i.lastRenderedReducer=e;var s=i.dispatch,a=i.pending,o=r.memoizedState;if(null!==a){i.pending=null;var l=a.next,c=l;do{o=e(o,c.action),c=c.next}while(c!==l);Gi(o,r.memoizedState)||Zu(),r.memoizedState=o,null===r.baseQueue&&(r.baseState=o),i.lastRenderedState=o}return[o,s]}function wl(e,t,n){var r,i=Zo,s=yl();if(oo()){if(void 0===n)throw new Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");r=n(),qo||r!==n()&&(l("The result of getServerSnapshot should be cached to avoid an infinite loop"),qo=!0)}else{if(r=t(),!qo){var a=t();Gi(r,a)||(l("The result of getSnapshot should be cached to avoid an infinite loop"),qo=!0)}var o=Pf();if(null===o)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Fr(0,Jo)||Tl(i,t,r)}s.memoizedState=r;var c={value:r,getSnapshot:t};return s.queue=c,zl(Il.bind(null,i,c,e),[e]),i.flags|=q,kl(Qo|jo,Ml.bind(null,i,c,r,t),void 0,null),r}function Cl(e,t,n){var r=Zo,i=El(),s=t();if(!qo){var a=t();Gi(s,a)||(l("The result of getSnapshot should be cached to avoid an infinite loop"),qo=!0)}var o=i.memoizedState,c=!Gi(o,s);c&&(i.memoizedState=s,Zu());var u=i.queue;if(Gl(Il.bind(null,r,u,e),[e]),u.getSnapshot!==t||c||null!==tl&&tl.memoizedState.tag&Qo){r.flags|=q,kl(Qo|jo,Ml.bind(null,r,u,s,t),void 0,null);var h=Pf();if(null===h)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Fr(0,Jo)||Tl(r,t,s)}return s}function Tl(e,t,n){e.flags|=J;var r={getSnapshot:t,value:n},i=Zo.updateQueue;if(null===i)i={lastEffect:null,stores:null},Zo.updateQueue=i,i.stores=[r];else{var s=i.stores;null===s?i.stores=[r]:s.push(r)}}function Ml(e,t,n,r){t.value=n,t.getSnapshot=r,Rl(t)&&Bl(e)}function Il(e,t,n){return n(function(){Rl(t)&&Bl(e)})}function Rl(e){var t=e.getSnapshot,n=e.value;try{var r=t();return!Gi(n,r)}catch(e){return!0}}function Bl(e){Ff(e,1,Tr)}function Pl(e){var t=yl();"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e;var n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_l,lastRenderedState:e};t.queue=n;var r=n.dispatch=dc.bind(null,Zo,n);return[t.memoizedState,r]}function Dl(e){return bl(_l)}function Ll(e){return Sl(_l)}function kl(e,t,n,r){var i={tag:e,create:t,destroy:n,deps:r,next:null},s=Zo.updateQueue;if(null===s)s={lastEffect:null,stores:null},Zo.updateQueue=s,s.lastEffect=i.next=i;else{var a=s.lastEffect;if(null===a)s.lastEffect=i.next=i;else{var o=a.next;a.next=i,i.next=o,s.lastEffect=i}}return i}function Fl(e){var t={current:e};return yl().memoizedState=t,t}function Ol(e){return El().memoizedState}function Ul(e,t,n,r){var i=yl(),s=void 0===r?null:r;Zo.flags|=e,i.memoizedState=kl(Qo|t,n,void 0,s)}function Nl(e,t,n,r){var i=El(),s=void 0===r?null:r,a=void 0;if(null!==el){var o=el.memoizedState;if(a=o.destroy,null!==s)if(pl(s,o.deps))return void(i.memoizedState=kl(t,n,a,s))}Zo.flags|=e,i.memoizedState=kl(Qo|t,n,a,s)}function zl(e,t){return 0!==(Zo.mode&Xn)?Ul(41945088,jo,e,t):Ul(8390656,jo,e,t)}function Gl(e,t){return Nl(q,jo,e,t)}function Ql(e,t){return Ul(4,Ho,e,t)}function Hl(e,t){return Nl(4,Ho,e,t)}function Vl(e,t){var n=4;return n|=ie,0!==(Zo.mode&Xn)&&(n|=se),Ul(n,Vo,e,t)}function jl(e,t){return Nl(4,Vo,e,t)}function Wl(e,t){if("function"==typeof t){var n=t,r=e();return n(r),function(){n(null)}}if(null!=t){var i=t;i.hasOwnProperty("current")||l("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(i).join(", ")+"}");var s=e();return i.current=s,function(){i.current=null}}}function Yl(e,t,n){"function"!=typeof t&&l("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==t?typeof t:"null");var r=null!=n?n.concat([e]):null,i=4;return i|=ie,0!==(Zo.mode&Xn)&&(i|=se),Ul(i,Vo,Wl.bind(null,t,e),r)}function Kl(e,t,n){"function"!=typeof t&&l("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==t?typeof t:"null");var r=null!=n?n.concat([e]):null;return Nl(4,Vo,Wl.bind(null,t,e),r)}function ql(e,t){}var Xl=ql;function $l(e,t){var n=void 0===t?null:t;return yl().memoizedState=[e,n],e}function Jl(e,t){var n=El(),r=void 0===t?null:t,i=n.memoizedState;if(null!==i&&(null!==r&&pl(r,i[1])))return i[0];return n.memoizedState=[e,r],e}function Zl(e,t){var n=yl(),r=void 0===t?null:t,i=e();return n.memoizedState=[i,r],i}function ec(e,t){var n=El(),r=void 0===t?null:t,i=n.memoizedState;if(null!==i&&(null!==r&&pl(r,i[1])))return i[0];var s=e();return n.memoizedState=[s,r],s}function tc(e){var t=Pl(e),n=t[0],r=t[1];return zl(function(){var t=$o.transition;$o.transition={};try{r(e)}finally{$o.transition=t}},[e]),n}function nc(e){var t=Dl(),n=t[0],r=t[1];return Gl(function(){var t=$o.transition;$o.transition={};try{r(e)}finally{$o.transition=t}},[e]),n}function rc(e){var t=Ll(),n=t[0],r=t[1];return Gl(function(){var t=$o.transition;$o.transition={};try{r(e)}finally{$o.transition=t}},[e]),n}function ic(e,t,n){var r=ni();ri(function(e,t){return 0!==e&&e<t?e:t}(r,4)),e(!0);var i=$o.transition;$o.transition={};var s=$o.transition;$o.transition._updatedFibers=new Set;try{e(!1),t()}finally{if(ri(r),$o.transition=i,null===i&&s._updatedFibers)s._updatedFibers.size>10&&o("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),s._updatedFibers.clear()}}function sc(){var e=Pl(!1),t=e[0],n=e[1],r=ic.bind(null,n);return yl().memoizedState=r,[t,r]}function ac(){return[Dl()[0],El().memoizedState]}function oc(){return[Ll()[0],El().memoizedState]}var lc=!1;function cc(){var e,t=yl(),n=Pf().identifierPrefix;if(oo()){e=":"+n+"R"+Ra();var r=il++;r>0&&(e+="H"+r.toString(32)),e+=":"}else{e=":"+n+"r"+(sl++).toString(32)+":"}return t.memoizedState=e,e}function uc(){return El().memoizedState}function hc(e,t,n){"function"==typeof arguments[3]&&l("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var r=Lf(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(fc(e))pc(t,i);else{mc(e,t,i);var s=Ff(e,r,Df());null!==s&&gc(s,t,r)}Ac(e,r)}function dc(e,t,n){"function"==typeof arguments[3]&&l("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var r=Lf(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(fc(e))pc(t,i);else{mc(e,t,i);var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)){var a=t.lastRenderedReducer;if(null!==a){var o;o=Xo.current,Xo.current=Sc;try{var c=t.lastRenderedState,u=a(c,n);if(i.hasEagerState=!0,i.eagerState=u,Gi(u,c))return}catch(e){}finally{Xo.current=o}}}var h=Ff(e,r,Df());null!==h&&gc(h,t,r)}Ac(e,r)}function fc(e){var t=e.alternate;return e===Zo||null!==t&&t===Zo}function pc(e,t){rl=nl=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function mc(e,t,n,r){if(Uf(e)){var i=t.interleaved;null===i?(n.next=n,Os(t)):(n.next=i.next,i.next=n),t.interleaved=n}else{var s=t.pending;null===s?n.next=n:(n.next=s.next,s.next=n),t.pending=n}}function gc(e,t,n){if(Or(n)){var r=t.lanes,i=Vr(r=Wr(r,e.pendingLanes),n);t.lanes=i,Xr(e,i)}}function Ac(e,t,n){zi(e,t)}var vc={readContext:ks,useCallback:fl,useContext:fl,useEffect:fl,useImperativeHandle:fl,useInsertionEffect:fl,useLayoutEffect:fl,useMemo:fl,useReducer:fl,useRef:fl,useState:fl,useDebugValue:fl,useDeferredValue:fl,useTransition:fl,useMutableSource:fl,useSyncExternalStore:fl,useId:fl,unstable_isNewReconciler:d},yc=null,Ec=null,_c=null,xc=null,bc=null,Sc=null,wc=null,Cc=function(){l("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},Tc=function(){l("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};yc={readContext:function(e){return ks(e)},useCallback:function(e,t){return al="useCallback",ul(),dl(t),$l(e,t)},useContext:function(e){return al="useContext",ul(),ks(e)},useEffect:function(e,t){return al="useEffect",ul(),dl(t),zl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",ul(),dl(n),Yl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",ul(),dl(t),Ql(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",ul(),dl(t),Vl(e,t)},useMemo:function(e,t){al="useMemo",ul(),dl(t);var n=Xo.current;Xo.current=bc;try{return Zl(e,t)}finally{Xo.current=n}},useReducer:function(e,t,n){al="useReducer",ul();var r=Xo.current;Xo.current=bc;try{return xl(e,t,n)}finally{Xo.current=r}},useRef:function(e){return al="useRef",ul(),Fl(e)},useState:function(e){al="useState",ul();var t=Xo.current;Xo.current=bc;try{return Pl(e)}finally{Xo.current=t}},useDebugValue:function(e,t){al="useDebugValue",ul()},useDeferredValue:function(e){return al="useDeferredValue",ul(),tc(e)},useTransition:function(){return al="useTransition",ul(),sc()},useMutableSource:function(e,t,n){al="useMutableSource",ul()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",ul(),wl(e,t,n)},useId:function(){return al="useId",ul(),cc()},unstable_isNewReconciler:d},Ec={readContext:function(e){return ks(e)},useCallback:function(e,t){return al="useCallback",hl(),$l(e,t)},useContext:function(e){return al="useContext",hl(),ks(e)},useEffect:function(e,t){return al="useEffect",hl(),zl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",hl(),Yl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",hl(),Ql(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",hl(),Vl(e,t)},useMemo:function(e,t){al="useMemo",hl();var n=Xo.current;Xo.current=bc;try{return Zl(e,t)}finally{Xo.current=n}},useReducer:function(e,t,n){al="useReducer",hl();var r=Xo.current;Xo.current=bc;try{return xl(e,t,n)}finally{Xo.current=r}},useRef:function(e){return al="useRef",hl(),Fl(e)},useState:function(e){al="useState",hl();var t=Xo.current;Xo.current=bc;try{return Pl(e)}finally{Xo.current=t}},useDebugValue:function(e,t){al="useDebugValue",hl()},useDeferredValue:function(e){return al="useDeferredValue",hl(),tc(e)},useTransition:function(){return al="useTransition",hl(),sc()},useMutableSource:function(e,t,n){al="useMutableSource",hl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",hl(),wl(e,t,n)},useId:function(){return al="useId",hl(),cc()},unstable_isNewReconciler:d},_c={readContext:function(e){return ks(e)},useCallback:function(e,t){return al="useCallback",hl(),Jl(e,t)},useContext:function(e){return al="useContext",hl(),ks(e)},useEffect:function(e,t){return al="useEffect",hl(),Gl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",hl(),Kl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",hl(),Hl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",hl(),jl(e,t)},useMemo:function(e,t){al="useMemo",hl();var n=Xo.current;Xo.current=Sc;try{return ec(e,t)}finally{Xo.current=n}},useReducer:function(e,t,n){al="useReducer",hl();var r=Xo.current;Xo.current=Sc;try{return bl(e)}finally{Xo.current=r}},useRef:function(e){return al="useRef",hl(),Ol()},useState:function(e){al="useState",hl();var t=Xo.current;Xo.current=Sc;try{return Dl()}finally{Xo.current=t}},useDebugValue:function(e,t){return al="useDebugValue",hl(),Xl()},useDeferredValue:function(e){return al="useDeferredValue",hl(),nc(e)},useTransition:function(){return al="useTransition",hl(),ac()},useMutableSource:function(e,t,n){al="useMutableSource",hl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",hl(),Cl(e,t)},useId:function(){return al="useId",hl(),uc()},unstable_isNewReconciler:d},xc={readContext:function(e){return ks(e)},useCallback:function(e,t){return al="useCallback",hl(),Jl(e,t)},useContext:function(e){return al="useContext",hl(),ks(e)},useEffect:function(e,t){return al="useEffect",hl(),Gl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",hl(),Kl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",hl(),Hl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",hl(),jl(e,t)},useMemo:function(e,t){al="useMemo",hl();var n=Xo.current;Xo.current=wc;try{return ec(e,t)}finally{Xo.current=n}},useReducer:function(e,t,n){al="useReducer",hl();var r=Xo.current;Xo.current=wc;try{return Sl(e)}finally{Xo.current=r}},useRef:function(e){return al="useRef",hl(),Ol()},useState:function(e){al="useState",hl();var t=Xo.current;Xo.current=wc;try{return Ll()}finally{Xo.current=t}},useDebugValue:function(e,t){return al="useDebugValue",hl(),Xl()},useDeferredValue:function(e){return al="useDeferredValue",hl(),rc(e)},useTransition:function(){return al="useTransition",hl(),oc()},useMutableSource:function(e,t,n){al="useMutableSource",hl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",hl(),Cl(e,t)},useId:function(){return al="useId",hl(),uc()},unstable_isNewReconciler:d},bc={readContext:function(e){return Cc(),ks(e)},useCallback:function(e,t){return al="useCallback",Tc(),ul(),$l(e,t)},useContext:function(e){return al="useContext",Tc(),ul(),ks(e)},useEffect:function(e,t){return al="useEffect",Tc(),ul(),zl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",Tc(),ul(),Yl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",Tc(),ul(),Ql(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",Tc(),ul(),Vl(e,t)},useMemo:function(e,t){al="useMemo",Tc(),ul();var n=Xo.current;Xo.current=bc;try{return Zl(e,t)}finally{Xo.current=n}},useReducer:function(e,t,n){al="useReducer",Tc(),ul();var r=Xo.current;Xo.current=bc;try{return xl(e,t,n)}finally{Xo.current=r}},useRef:function(e){return al="useRef",Tc(),ul(),Fl(e)},useState:function(e){al="useState",Tc(),ul();var t=Xo.current;Xo.current=bc;try{return Pl(e)}finally{Xo.current=t}},useDebugValue:function(e,t){al="useDebugValue",Tc(),ul()},useDeferredValue:function(e){return al="useDeferredValue",Tc(),ul(),tc(e)},useTransition:function(){return al="useTransition",Tc(),ul(),sc()},useMutableSource:function(e,t,n){al="useMutableSource",Tc(),ul()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",Tc(),ul(),wl(e,t,n)},useId:function(){return al="useId",Tc(),ul(),cc()},unstable_isNewReconciler:d},Sc={readContext:function(e){return Cc(),ks(e)},useCallback:function(e,t){return al="useCallback",Tc(),hl(),Jl(e,t)},useContext:function(e){return al="useContext",Tc(),hl(),ks(e)},useEffect:function(e,t){return al="useEffect",Tc(),hl(),Gl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",Tc(),hl(),Kl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",Tc(),hl(),Hl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",Tc(),hl(),jl(e,t)},useMemo:function(e,t){al="useMemo",Tc(),hl();var n=Xo.current;Xo.current=Sc;try{return ec(e,t)}finally{Xo.current=n}},useReducer:function(e,t,n){al="useReducer",Tc(),hl();var r=Xo.current;Xo.current=Sc;try{return bl(e)}finally{Xo.current=r}},useRef:function(e){return al="useRef",Tc(),hl(),Ol()},useState:function(e){al="useState",Tc(),hl();var t=Xo.current;Xo.current=Sc;try{return Dl()}finally{Xo.current=t}},useDebugValue:function(e,t){return al="useDebugValue",Tc(),hl(),Xl()},useDeferredValue:function(e){return al="useDeferredValue",Tc(),hl(),nc(e)},useTransition:function(){return al="useTransition",Tc(),hl(),ac()},useMutableSource:function(e,t,n){al="useMutableSource",Tc(),hl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",Tc(),hl(),Cl(e,t)},useId:function(){return al="useId",Tc(),hl(),uc()},unstable_isNewReconciler:d},wc={readContext:function(e){return Cc(),ks(e)},useCallback:function(e,t){return al="useCallback",Tc(),hl(),Jl(e,t)},useContext:function(e){return al="useContext",Tc(),hl(),ks(e)},useEffect:function(e,t){return al="useEffect",Tc(),hl(),Gl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",Tc(),hl(),Kl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",Tc(),hl(),Hl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",Tc(),hl(),jl(e,t)},useMemo:function(e,t){al="useMemo",Tc(),hl();var n=Xo.current;Xo.current=Sc;try{return ec(e,t)}finally{Xo.current=n}},useReducer:function(e,t,n){al="useReducer",Tc(),hl();var r=Xo.current;Xo.current=Sc;try{return Sl(e)}finally{Xo.current=r}},useRef:function(e){return al="useRef",Tc(),hl(),Ol()},useState:function(e){al="useState",Tc(),hl();var t=Xo.current;Xo.current=Sc;try{return Ll()}finally{Xo.current=t}},useDebugValue:function(e,t){return al="useDebugValue",Tc(),hl(),Xl()},useDeferredValue:function(e){return al="useDeferredValue",Tc(),hl(),rc(e)},useTransition:function(){return al="useTransition",Tc(),hl(),oc()},useMutableSource:function(e,t,n){al="useMutableSource",Tc(),hl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",Tc(),hl(),Cl(e,t)},useId:function(){return al="useId",Tc(),hl(),uc()},unstable_isNewReconciler:d};var Mc=i.unstable_now,Ic=0,Rc=-1,Bc=-1,Pc=-1,Dc=!1,Lc=!1;function kc(){return Dc}function Fc(){return Ic}function Oc(){Ic=Mc()}function Uc(e){Bc=Mc(),e.actualStartTime<0&&(e.actualStartTime=Mc())}function Nc(e){Bc=-1}function zc(e,t){if(Bc>=0){var n=Mc()-Bc;e.actualDuration+=n,t&&(e.selfBaseDuration=n),Bc=-1}}function Gc(e){if(Rc>=0){var t=Mc()-Rc;Rc=-1;for(var n=e.return;null!==n;){switch(n.tag){case 3:return void(n.stateNode.effectDuration+=t);case g:return void(n.stateNode.effectDuration+=t)}n=n.return}}}function Qc(e){if(Pc>=0){var t=Mc()-Pc;Pc=-1;for(var n=e.return;null!==n;){switch(n.tag){case 3:var r=n.stateNode;return void(null!==r&&(r.passiveEffectDuration+=t));case g:var i=n.stateNode;return void(null!==i&&(i.passiveEffectDuration+=t))}n=n.return}}}function Hc(){Rc=Mc()}function Vc(){Pc=Mc()}function jc(e){for(var t=e.child;t;)e.actualDuration+=t.actualDuration,t=t.sibling}function Wc(e,t){return{value:e,source:t,stack:Ji(t)}}function Yc(e,t){try{0;var n=t.value,r=t.source,i=t.stack,s=null!==i?i:"";if(null!=n&&n._suppressLogging&&1===e.tag)return;var a=r?H(r):null;3===e.tag||H(e)}catch(e){setTimeout(function(){throw e})}}var Kc,qc,Xc,$c,Jc="function"==typeof WeakMap?WeakMap:Map;function Zc(e,t,n){var r=js(Tr,n);r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){lp(i),Yc(e,t)},r}function eu(e,t,n){var r=js(Tr,n);r.tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var s=t.value;r.payload=function(){return i(s)},r.callback=function(){Lp(e),Yc(e,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(r.callback=function(){Lp(e),Yc(e,t),"function"!=typeof i&&function(e){null===yf?yf=new Set([e]):yf.add(e)}(this);var n=t.value,r=t.stack;this.componentDidCatch(n,{componentStack:null!==r?r:""}),"function"!=typeof i&&(Qr(e.lanes,1)||l("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",H(e)||"Unknown"))}),r}function tu(e,t,n){var r,i=e.pingCache;if(null===i?(i=e.pingCache=new Jc,r=new Set,i.set(t,r)):void 0===(r=i.get(t))&&(r=new Set,i.set(t,r)),!r.has(n)){r.add(n);var s=hp.bind(null,e,t,n);_i&&xp(e,n),t.then(s,s)}}function nu(e){var t=e;do{if(t.tag===A&&No(t))return t;t=t.return}while(null!==t);return null}function ru(e,t,n,r,i){if(!(1&e.mode)){if(e===t)e.flags|=ee;else{if(e.flags|=j,n.flags|=te,n.flags&=-52805,1===n.tag)if(null===n.alternate)n.tag=E;else{var s=js(Tr,1);s.tag=Gs,Ws(n,s)}n.lanes=Vr(n.lanes,1)}return e}return e.flags|=ee,e.lanes=i,e}function iu(e,t,n,r,i){if(n.flags|=Z,_i&&xp(e,i),null!==r&&"object"==typeof r&&"function"==typeof r.then){var s=r;!function(e){var t=e.tag;if(!(1&e.mode||0!==t&&t!==m&&t!==y)){var n=e.alternate;n?(e.updateQueue=n.updateQueue,e.memoizedState=n.memoizedState,e.lanes=n.lanes):(e.updateQueue=null,e.memoizedState=null)}}(n);var a=nu(t);if(null!==a)return a.flags&=-257,ru(a,t,n,0,i),1&a.mode&&tu(e,s,i),void function(e,t,n){var r=e.updateQueue;if(null===r){var i=new Set;i.add(n),e.updateQueue=i}else r.add(n)}(a,0,s);if(!(1&i))return tu(e,s,i),void Zf();r=new Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.")}else if(oo()&&1&n.mode){ja=!0;var o=nu(t);if(null!==o)return 0===(o.flags&ee)&&(o.flags|=W),ru(o,t,n,0,i),void lo(r)}!function(e){rf!==Kd&&(rf=Wd);null===cf?cf=[e]:cf.push(e)}(r),r=Wc(r,n);var l=t;do{switch(l.tag){case 3:var c=r;l.flags|=ee;var u=Nr(i);return l.lanes=Vr(l.lanes,u),void Ks(l,Zc(l,c,u));case 1:var h=r,d=l.type,f=l.stateNode;if(0===(l.flags&j)&&("function"==typeof d.getDerivedStateFromError||null!==f&&"function"==typeof f.componentDidCatch&&!op(f))){l.flags|=ee;var p=Nr(i);return l.lanes=Vr(l.lanes,p),void Ks(l,eu(l,h,p))}}l=l.return}while(null!==l)}function su(e){e.flags|=4}function au(e){e.flags|=Y,e.flags|=re}function ou(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(t.flags&V))return!1;for(var n=t.child;null!==n;){if(0!==(n.flags&le)||0!==(n.subtreeFlags&le))return!1;n=n.sibling}return!0}if(Ue)Kc=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)Me(e,i.stateNode);else if(4===i.tag);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)return;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},qc=function(e,t){},Xc=function(e,t,n,r,i){var s=e.memoizedProps;if(s!==r){var a=t.stateNode,o=To(),l=Re(a,n,s,r,i,o);t.updateQueue=l,l&&su(t)}},$c=function(e,t,n,r){n!==r&&su(t)};else if(Ne){Kc=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var s=i.stateNode;if(n&&r){var a=i.memoizedProps,o=i.type;s=Mt(s,o,a,i)}Me(e,s)}else if(6===i.tag){var l=i.stateNode;if(n&&r){var c=i.memoizedProps;l=It(l,c,i)}Me(e,l)}else if(4===i.tag);else if(i.tag===b&&null!==i.memoizedState){var u=i.child;null!==u&&(u.return=i),Kc(e,i,!0,!0)}else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)return;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};var lu=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var s=i.stateNode;if(n&&r){var a=i.memoizedProps,o=i.type;s=Mt(s,o,a,i)}vt(e,s)}else if(6===i.tag){var l=i.stateNode;if(n&&r){var c=i.memoizedProps;l=It(l,c,i)}vt(e,l)}else if(4===i.tag);else if(i.tag===b&&null!==i.memoizedState){var u=i.child;null!==u&&(u.return=i),lu(e,i,!0,!0)}else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)return;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};qc=function(e,t){var n=t.stateNode;if(ou(e,t));else{var r=n.containerInfo,i=At(r);lu(i,t,!1,!1),n.pendingChildren=i,su(t),yt(r,i)}},Xc=function(e,t,n,r,i){var s=e.stateNode,a=e.memoizedProps,o=ou(e,t);if(o&&a===r)t.stateNode=s;else{var l=t.stateNode,c=To(),u=null;if(a!==r&&(u=Re(l,n,a,r,i,c)),o&&null===u)t.stateNode=s;else{var h=gt(s,u,n,a,r,t,o,l);Ie(h,n,r,i,c)&&su(t),t.stateNode=h,o?su(t):Kc(h,t,!1,!1)}}},$c=function(e,t,n,r){if(n!==r){var i=So(),s=To();t.stateNode=Pe(r,i,s,t),su(t)}else t.stateNode=e.stateNode}}else qc=function(e,t){},Xc=function(e,t,n,r,i){},$c=function(e,t,n,r){};function cu(e,t){if(!oo())switch(e.tailMode){case"hidden":for(var n=e.tail,r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":for(var i=e.tail,s=null;null!==i;)null!==i.alternate&&(s=i),i=i.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function uu(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t){if(2&e.mode){for(var i=e.selfBaseDuration,s=e.child;null!==s;)n=Vr(n,Vr(s.lanes,s.childLanes)),r|=s.subtreeFlags&he,r|=s.flags&he,i+=s.treeBaseDuration,s=s.sibling;e.treeBaseDuration=i}else for(var a=e.child;null!==a;)n=Vr(n,Vr(a.lanes,a.childLanes)),r|=a.subtreeFlags&he,r|=a.flags&he,a.return=e,a=a.sibling;e.subtreeFlags|=r}else{if(2&e.mode){for(var o=e.actualDuration,l=e.selfBaseDuration,c=e.child;null!==c;)n=Vr(n,Vr(c.lanes,c.childLanes)),r|=c.subtreeFlags,r|=c.flags,o+=c.actualDuration,l+=c.treeBaseDuration,c=c.sibling;e.actualDuration=o,e.treeBaseDuration=l}else for(var u=e.child;null!==u;)n=Vr(n,Vr(u.lanes,u.childLanes)),r|=u.subtreeFlags,r|=u.flags,u.return=e,u=u.sibling;e.subtreeFlags|=r}return e.childLanes=n,t}function hu(e,t,n){var r=t.pendingProps;switch(ka(t),t.tag){case 2:case 16:case y:case 0:case m:case 7:case 8:case g:case 9:case v:return uu(t),null;case 1:return Qn(t.type)&&Hn(t),uu(t),null;case 3:var i=t.stateNode;if(Co(t),Vn(t),Yo(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null===e||null===e.child)if(ro(t))su(t);else if(null!==e)e.memoizedState.isDehydrated&&0===(t.flags&W)||(t.flags|=K,ao());return qc(e,t),uu(t),null;case 5:Io(t);var s=So(),a=t.type;if(null!==e&&null!=t.stateNode)Xc(e,t,a,r,s),e.ref!==t.ref&&au(t);else{if(!r){if(null===t.stateNode)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return uu(t),null}var o=To();if(ro(t))(function(e,t,n){if(!ze)throw new Error("Expected prepareToHydrateHostInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var r=e.stateNode,i=!ja,s=zt(r,e.type,e.memoizedProps,t,n,e,i);return e.updateQueue=s,null!==s})(t,s,o)&&su(t);else{var l=Te(a,r,s,o,t);Kc(l,t,!1,!1),t.stateNode=l,Ie(l,a,r,s,o)&&su(t)}null!==t.ref&&au(t)}return uu(t),null;case 6:var c=r;if(e&&null!=t.stateNode){var u=e.memoizedProps;$c(e,t,u,c)}else{if("string"!=typeof c&&null===t.stateNode)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var h=So(),d=To();ro(t)?function(e){if(!ze)throw new Error("Expected prepareToHydrateHostTextInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var t=e.stateNode,n=e.memoizedProps,r=Gt(t,n,e,!ja);if(r){var i=Qa;if(null!==i){var s=!!(1&i.mode);switch(i.tag){case 3:var a=i.stateNode.containerInfo;qt(a,t,n,s);break;case 5:var o=i.type,l=i.memoizedProps,c=i.stateNode;Xt(o,l,c,t,n,s)}}}return r}(t)&&su(t):t.stateNode=Pe(c,h,d,t)}return uu(t),null;case A:Uo(t);var f=t.memoizedState;if(Va&&null!==Ha&&1&t.mode&&0===(t.flags&j))return io(t),so(),t.flags|=98560,t;if(null!==f&&null!==f.dehydrated){var _=ro(t);if(null===e){if(!_)throw new Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(function(e){if(!ze)throw new Error("Expected prepareToHydrateHostSuspenseInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var t=e.memoizedState,n=null!==t?t.dehydrated:null;if(!n)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");Qt(n,e)}(t),uu(t),2&t.mode)if(null!==f){var w=t.child;null!==w&&(t.treeBaseDuration-=w.treeBaseDuration)}return null}if(so(),0===(t.flags&j)&&(t.memoizedState=null),t.flags|=4,uu(t),2&t.mode&&null!==f){var C=t.child;null!==C&&(t.treeBaseDuration-=C.treeBaseDuration)}return null}if(ao(),0!==(t.flags&j))return t.lanes=n,2&t.mode&&jc(t),t;var T=null!==f,M=!1;if(null===e)ro(t);else M=null!==e.memoizedState;if(T&&!M)if(t.child.flags|=$,1&t.mode)null===e&&(!0!==t.memoizedProps.unstable_avoidThisFallback||!0)||Lo(Do.current,Bo)?rf===Vd&&(rf=Yd):Zf();if(null!==t.updateQueue&&(t.flags|=4),uu(t),2&t.mode&&T){var I=t.child;null!==I&&(t.treeBaseDuration-=I.treeBaseDuration)}return null;case 4:return Co(t),qc(e,t),null===e&&Qe(t.stateNode.containerInfo),uu(t),null;case p:return Bs(t.type._context,t),uu(t),null;case E:return Qn(t.type)&&Hn(t),uu(t),null;case x:Uo(t);var R=t.memoizedState;if(null===R)return uu(t),null;var B=0!==(t.flags&j),P=R.rendering;if(null===P)if(B)cu(R,!1);else{if(!(rf===Vd&&(null===e||0===(e.flags&j))))for(var D=t.child;null!==D;){var L=zo(D);if(null!==L){B=!0,t.flags|=j,cu(R,!1);var k=L.updateQueue;return null!==k&&(t.updateQueue=k,t.flags|=4),t.subtreeFlags=0,vo(t,n),Oo(t,Fo(Do.current,Po)),t.child}D=D.sibling}null!==R.tail&&ui()>gf()&&(t.flags|=j,B=!0,cu(R,!1),t.lanes=Er)}else{if(!B){var F=zo(P);if(null!==F){t.flags|=j,B=!0;var O=F.updateQueue;if(null!==O&&(t.updateQueue=O,t.flags|=4),cu(R,!0),null===R.tail&&"hidden"===R.tailMode&&!P.alternate&&!oo())return uu(t),null}else 2*ui()-R.renderingStartTime>gf()&&n!==wr&&(t.flags|=j,B=!0,cu(R,!1),t.lanes=Er)}if(R.isBackwards)P.sibling=t.child,t.child=P;else{var U=R.last;null!==U?U.sibling=P:t.child=P,R.last=P}}if(null!==R.tail){var N=R.tail;R.rendering=N,R.tail=N.sibling,R.renderingStartTime=ui(),N.sibling=null;var z=Do.current;return Oo(t,z=B?Fo(z,Po):ko(z)),N}return uu(t),null;case 21:break;case b:case S:Yf(t);var G=null!==t.memoizedState;if(null!==e)null!==e.memoizedState!==G&&(t.flags|=$);return G&&1&t.mode?Qr(tf,wr)&&(uu(t),Ue&&6&t.subtreeFlags&&(t.flags|=$)):uu(t),null;case 24:case 25:return null}throw new Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}var du,fu,pu,mu,gu,Au,vu,yu,Eu=s.ReactCurrentOwner,_u=!1;function xu(e,t,n,r){t.child=null===e?Ao(t,null,n,r):go(t,e.child,n,r)}function bu(e,t,n,r,i){if(t.type!==t.elementType){var s=n.propTypes;s&&Cn(s,r,"prop",G(n))}var a,o,l=n.render,c=t.ref;if(Ls(t,i),Ci(t),Eu.current=t,ss(!0),a=ml(e,t,l,r,c,i),o=gl(),8&t.mode){xi(!0);try{a=ml(e,t,l,r,c,i),o=gl()}finally{xi(!1)}}return ss(!1),Ti(),null===e||_u?(oo()&&o&&Da(t),t.flags|=1,xu(e,t,a,i),t.child):(Al(e,t,i),eh(e,t,i))}function Su(e,t,n,r,i){if(null===e){var s=n.type;if(function(e){return"function"==typeof e&&!Vp(e)&&void 0===e.defaultProps}(s)&&null===n.compare&&void 0===n.defaultProps){var a;return a=Rp(s),t.tag=y,t.type=a,ku(t,s),wu(e,t,a,r,i)}var o=s.propTypes;o&&Cn(o,r,"prop",G(s));var l=Yp(n.type,null,r,t,t.mode,i);return l.ref=t.ref,l.return=t,t.child=l,l}var c=n.type,u=c.propTypes;u&&Cn(u,r,"prop",G(c));var h=e.child;if(!th(e,i)){var d=h.memoizedProps,f=n.compare;if((f=null!==f?f:Xi)(d,r)&&e.ref===t.ref)return eh(e,t,i)}t.flags|=1;var p=jp(h,r);return p.ref=t.ref,p.return=t,t.child=p,p}function wu(e,t,n,r,i){if(t.type!==t.elementType){var s=t.elementType;if(s.$$typeof===F){var a=s,o=a._payload,l=a._init;try{s=l(o)}catch(e){s=null}var c=s&&s.propTypes;c&&Cn(c,r,"prop",G(s))}}if(null!==e&&(Xi(e.memoizedProps,r)&&e.ref===t.ref&&t.type===e.type)){if(_u=!1,!th(e,i))return t.lanes=e.lanes,eh(e,t,i);0!==(e.flags&te)&&(_u=!0)}return Mu(e,t,n,r,i)}function Cu(e,t,n){var r,i=t.pendingProps,s=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(1&t.mode){if(!Qr(n,wr)){var o;if(null!==a)o=Vr(a.baseLanes,n);else o=n;t.lanes=t.childLanes=wr;var l={baseLanes:o,cachePool:null};return t.memoizedState=l,t.updateQueue=null,Wf(t,o),null}var c={baseLanes:0,cachePool:null};t.memoizedState=c,Wf(t,null!==a?a.baseLanes:n)}else{var u={baseLanes:0,cachePool:null};t.memoizedState=u,Wf(t,n)}else null!==a?(r=Vr(a.baseLanes,n),t.memoizedState=null):r=n,Wf(t,r);return xu(e,t,s,n),t.child}function Tu(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=Y,t.flags|=re)}function Mu(e,t,n,r,i){if(t.type!==t.elementType){var s=n.propTypes;s&&Cn(s,r,"prop",G(n))}var a,o,l;if(a=zn(t,Un(0,n,!0)),Ls(t,i),Ci(t),Eu.current=t,ss(!0),o=ml(e,t,n,r,a,i),l=gl(),8&t.mode){xi(!0);try{o=ml(e,t,n,r,a,i),l=gl()}finally{xi(!1)}}return ss(!1),Ti(),null===e||_u?(oo()&&l&&Da(t),t.flags|=1,xu(e,t,o,i),t.child):(Al(e,t,i),eh(e,t,i))}function Iu(e,t,n,r,i){switch(cm(t)){case!1:var s=t.stateNode,a=new(0,t.type)(t.memoizedProps,s.context).state;s.updater.enqueueSetState(s,a,null);break;case!0:t.flags|=j,t.flags|=ee;var o=new Error("Simulated error coming from DevTools"),c=Nr(i);t.lanes=Vr(t.lanes,c),Ks(t,eu(t,Wc(o,t),c))}if(t.type!==t.elementType){var u=n.propTypes;u&&Cn(u,r,"prop",G(n))}var h,d;Qn(n)?(h=!0,Yn(t)):h=!1,Ls(t,i),null===t.stateNode?(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),va(t,n,r),Ea(t,n,r,i),d=!0):d=null===e?function(e,t,n,r){var i=e.stateNode,s=e.memoizedProps;i.props=s;var a=i.context,o=t.contextType,l=Ln;l="object"==typeof o&&null!==o?ks(o):zn(e,Un(0,t,!0));var c=t.getDerivedStateFromProps,u="function"==typeof c||"function"==typeof i.getSnapshotBeforeUpdate;u||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||s===n&&a===l||ya(e,i,n,l),Js();var h=e.memoizedState,d=i.state=h;if(Xs(e,n,i,r),d=e.memoizedState,s===n&&h===d&&!Gn()&&!Zs()){if("function"==typeof i.componentDidMount){var f=4;f|=ie,0!==(e.mode&Xn)&&(f|=se),e.flags|=f}return!1}"function"==typeof c&&(pa(e,t,c,n),d=e.memoizedState);var p=Zs()||ga(e,t,s,n,h,d,l);if(p){if(u||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount){var m=4;m|=ie,0!==(e.mode&Xn)&&(m|=se),e.flags|=m}}else{if("function"==typeof i.componentDidMount){var g=4;g|=ie,0!==(e.mode&Xn)&&(g|=se),e.flags|=g}e.memoizedProps=n,e.memoizedState=d}return i.props=n,i.state=d,i.context=l,p}(t,n,r,i):function(e,t,n,r,i){var s=t.stateNode;Vs(e,t);var a=t.memoizedProps,o=t.type===t.elementType?a:Es(t.type,a);s.props=o;var l=t.pendingProps,c=s.context,u=n.contextType,h=Ln;h="object"==typeof u&&null!==u?ks(u):zn(t,Un(0,n,!0));var d=n.getDerivedStateFromProps,p="function"==typeof d||"function"==typeof s.getSnapshotBeforeUpdate;p||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||a===l&&c===h||ya(t,s,r,h),Js();var m=t.memoizedState,g=s.state=m;if(Xs(t,r,s,i),g=t.memoizedState,a===l&&m===g&&!Gn()&&!Zs())return"function"==typeof s.componentDidUpdate&&(a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4)),"function"==typeof s.getSnapshotBeforeUpdate&&(a===e.memoizedProps&&m===e.memoizedState||(t.flags|=K)),!1;"function"==typeof d&&(pa(t,n,d,r),g=t.memoizedState);var A=Zs()||ga(t,n,o,r,m,g,h)||f;return A?(p||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,g,h),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,g,h)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=K)):("function"==typeof s.componentDidUpdate&&(a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4)),"function"==typeof s.getSnapshotBeforeUpdate&&(a===e.memoizedProps&&m===e.memoizedState||(t.flags|=K)),t.memoizedProps=r,t.memoizedState=g),s.props=r,s.state=g,s.context=h,A}(e,t,n,r,i);var p=Ru(e,t,n,d,h,i),m=t.stateNode;return d&&m.props!==r&&(Au||l("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",H(t)||"a component"),Au=!0),p}function Ru(e,t,n,r,i,s){Tu(e,t);var a=0!==(t.flags&j);if(!r&&!a)return i&&Kn(t,n,!1),eh(e,t,s);var o,l=t.stateNode;if(Eu.current=t,a&&"function"!=typeof n.getDerivedStateFromError)o=null,Nc();else{if(Ci(t),ss(!0),o=l.render(),8&t.mode){xi(!0);try{l.render()}finally{xi(!1)}}ss(!1),Ti()}return t.flags|=1,null!==e&&a?function(e,t,n,r){t.child=go(t,e.child,null,r),t.child=go(t,null,n,r)}(e,t,o,s):xu(e,t,o,s),t.memoizedState=l.state,i&&Kn(t,n,!0),t.child}function Bu(e){var t=e.stateNode;t.pendingContext?jn(e,t.pendingContext,t.pendingContext!==t.context):t.context&&jn(e,t.context,!1),wo(e,t.containerInfo)}function Pu(e,t,n){if(Bu(t),null===e)throw new Error("Should have a current fiber. This is a bug in React.");var r=t.pendingProps,i=t.memoizedState,s=i.element;Vs(e,t),Xs(t,r,null,n);var a=t.memoizedState;t.stateNode;var o=a.element;if(ze&&i.isDehydrated){var l={element:o,isDehydrated:!1,cache:a.cache,transitions:a.transitions};if(t.updateQueue.baseState=l,t.memoizedState=l,t.flags&W)return Du(e,t,o,n,new Error("There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering."));if(o!==s)return Du(e,t,o,n,new Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering."));!function(e){if(!ze)return!1;var t=e.stateNode.containerInfo;Ha=Ut(t),Qa=e,Va=!0,Wa=null,ja=!1}(t);var c=Ao(t,null,o,n);t.child=c;for(var u=c;u;)u.flags=-3&u.flags|X,u=u.sibling}else{if(so(),o===s)return eh(e,t,n);xu(e,t,o,n)}return t.child}function Du(e,t,n,r,i){return so(),lo(i),t.flags|=W,xu(e,t,n,r),t.child}function Lu(e,t,n,r){null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2);var i=t.pendingProps,s=n,a=s._payload,o=(0,s._init)(a);t.type=o;var l=t.tag=function(e){if("function"==typeof e)return Vp(e)?1:0;if(null!=e){var t=e.$$typeof;if(t===P)return m;if(t===k)return v}return 2}(o),c=Es(o,i);switch(l){case 0:return ku(t,o),t.type=o=Rp(o),Mu(null,t,o,c,r);case 1:return t.type=o=Bp(o),Iu(null,t,o,c,r);case m:return t.type=o=Pp(o),bu(null,t,o,c,r);case v:if(t.type!==t.elementType){var u=o.propTypes;u&&Cn(u,c,"prop",G(o))}return Su(null,t,o,Es(o.type,c),r)}var h="";throw null!==o&&"object"==typeof o&&o.$$typeof===F&&(h=" Did you wrap a component in React.lazy() more than once?"),new Error("Element type is invalid. Received a promise that resolves to: "+o+". Lazy element type must resolve to a class or function."+h)}function ku(e,t){if(t&&t.childContextTypes&&l("%s(...): childContextTypes cannot be defined on a function component.",t.displayName||t.name||"Component"),null!==e.ref){var n="",r=function(){if(null===es)return null;var e=es._debugOwner;return null!=e?H(e):null}();r&&(n+="\n\nCheck the render method of `"+r+"`.");var i=r||"",s=e._debugSource;s&&(i=s.fileName+":"+s.lineNumber),gu[i]||(gu[i]=!0,l("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",n))}if("function"==typeof t.getDerivedStateFromProps){var a=G(t)||"Unknown";mu[a]||(l("%s: Function components do not support getDerivedStateFromProps.",a),mu[a]=!0)}if("object"==typeof t.contextType&&null!==t.contextType){var o=G(t)||"Unknown";pu[o]||(l("%s: Function components do not support contextType.",o),pu[o]=!0)}}du={},fu={},pu={},mu={},gu={},Au=!1,vu={},yu={};var Fu={dehydrated:null,treeContext:null,retryLane:0};function Ou(e){return{baseLanes:e,cachePool:null}}function Uu(e,t){return{baseLanes:Vr(e.baseLanes,t),cachePool:null}}function Nu(e,t){return jr(e.childLanes,t)}function zu(e,t,n){var r=t.pendingProps;hm(t)&&(t.flags|=j);var i=Do.current,s=!1,a=0!==(t.flags&j);if(a||function(e,t){return(null===t||null!==t.memoizedState)&&Lo(e,Po)}(i,e)?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i=i|Bo),Oo(t,i=ko(i)),null===e){to(t);var o=t.memoizedState;if(null!==o){var c=o.dehydrated;if(null!==c)return function(e,t){1&e.mode?Lt(t)?e.lanes=8:e.lanes=wr:(l("Cannot hydrate Suspense in legacy mode. Switch from ReactDOM.hydrate(element, container) to ReactDOMClient.hydrateRoot(container, <App />).render(element) or remove the Suspense components from the server rendered components."),e.lanes=1);return null}(t,c)}var u=r.children,h=r.fallback;if(s){var d=function(e,t,n,r){var i,s,a=e.mode,o=e.child,l={mode:"hidden",children:t};1&a||null===o?(i=Qu(l,a),s=qp(n,a,r,null)):((i=o).childLanes=0,i.pendingProps=l,2&e.mode&&(i.actualDuration=0,i.actualStartTime=-1,i.selfBaseDuration=0,i.treeBaseDuration=0),s=qp(n,a,r,null));return i.return=e,s.return=e,i.sibling=s,e.child=i,s}(t,u,h,n);return t.child.memoizedState=Ou(n),t.memoizedState=Fu,d}return Gu(t,u)}var f=e.memoizedState;if(null!==f){var p=f.dehydrated;if(null!==p){if(a){if(t.flags&W)return t.flags&=-257,Wu(e,t,n,new Error("There was an error while hydrating this Suspense boundary. Switched to client rendering."));if(null!==t.memoizedState)return t.child=e.child,t.flags|=j,null;var m=function(e,t,n,r,i){var s=t.mode,a=Qu({mode:"visible",children:n},s),o=qp(r,s,i,null);o.flags|=2,a.return=t,o.return=t,a.sibling=o,t.child=a,!(1&t.mode)||go(t,e.child,null,i);return o}(e,t,r.children,r.fallback,n);return t.child.memoizedState=Ou(n),t.memoizedState=Fu,m}return function(e,t,n,r,i){if(function(){Va&&l("We should not be hydrating here. This is a bug in React. Please file a bug.")}(),!(1&t.mode))return Wu(e,t,i,null);if(Lt(n))return Wu(e,t,i,new Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering."));var s=Qr(i,e.childLanes);if(_u||s){var a=Pf();if(null!==a){var o=function(e,t){var n;switch(Ur(t)){case 4:n=2;break;case er:n=8;break;case 64:case 128:case 256:case 512:case nr:case rr:case ir:case sr:case ar:case or:case lr:case cr:case ur:case hr:case dr:case fr:case mr:case gr:case Ar:case vr:case yr:n=32;break;case Sr:n=br;break;default:n=0}return 0!==(n&(e.suspendedLanes|t))?0:n}(a,i);if(0!==o&&o!==r.retryLane)r.retryLane=o,Ff(e,o,Tr)}return Zf(),Wu(e,t,i,new Error("This Suspense boundary received an update before it finished hydrating. This caused the boundary to switch to client rendering. The usual way to fix this is to wrap the original update in startTransition."))}if(Dt(n)){t.flags|=j,t.child=e.child;var c=fp.bind(null,e);return kt(n,c),null}Ya(t,n,r.treeContext);var u=Gu(t,t.pendingProps.children);return u.flags|=X,u}(e,t,p,f,n)}if(s){var g=r.fallback,A=ju(e,t,r.children,g,n),v=t.child,y=e.child.memoizedState;return v.memoizedState=null===y?Ou(n):Uu(y,n),v.childLanes=Nu(e,n),t.memoizedState=Fu,A}var E=Vu(e,t,r.children,n);return t.memoizedState=null,E}if(s){var _=r.fallback,x=ju(e,t,r.children,_,n),b=t.child,S=e.child.memoizedState;return b.memoizedState=null===S?Ou(n):Uu(S,n),b.childLanes=Nu(e,n),t.memoizedState=Fu,x}var w=Vu(e,t,r.children,n);return t.memoizedState=null,w}function Gu(e,t,n){var r=Qu({mode:"visible",children:t},e.mode);return r.return=e,e.child=r,r}function Qu(e,t,n){return Xp(e,t,0,null)}function Hu(e,t){return jp(e,t)}function Vu(e,t,n,r){var i=e.child,s=i.sibling,a=Hu(i,{mode:"visible",children:n});if(1&t.mode||(a.lanes=r),a.return=t,a.sibling=null,null!==s){var o=t.deletions;null===o?(t.deletions=[s],t.flags|=V):o.push(s)}return t.child=a,a}function ju(e,t,n,r,i){var s,a,o=t.mode,l=e.child,c=l.sibling,u={mode:"hidden",children:n};1&o||t.child===l?(s=Hu(l,u)).subtreeFlags=l.subtreeFlags&he:((s=t.child).childLanes=0,s.pendingProps=u,2&t.mode&&(s.actualDuration=0,s.actualStartTime=-1,s.selfBaseDuration=l.selfBaseDuration,s.treeBaseDuration=l.treeBaseDuration),t.deletions=null);return null!==c?a=jp(c,r):(a=qp(r,o,i,null)).flags|=2,a.return=t,s.return=t,s.sibling=a,t.child=s,a}function Wu(e,t,n,r){null!==r&&lo(r),go(t,e.child,null,n);var i=Gu(t,t.pendingProps.children);return i.flags|=2,t.memoizedState=null,i}function Yu(e,t,n){e.lanes=Vr(e.lanes,t);var r=e.alternate;null!==r&&(r.lanes=Vr(r.lanes,t)),Ps(e.return,t,n)}function Ku(e,t){var n=_e(e),r=!n&&"function"==typeof N(e);if(n||r){var i=n?"array":"iterable";return l("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",i,t,i),!1}return!0}function qu(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Xu(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail,a=r.children;!function(e){if(void 0!==e&&"forwards"!==e&&"backwards"!==e&&"together"!==e&&!vu[e])if(vu[e]=!0,"string"==typeof e)switch(e.toLowerCase()){case"together":case"forwards":case"backwards":l('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',e,e.toLowerCase());break;case"forward":case"backward":l('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',e,e.toLowerCase());break;default:l('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',e)}else l('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',e)}(i),function(e,t){void 0===e||yu[e]||("collapsed"!==e&&"hidden"!==e?(yu[e]=!0,l('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',e)):"forwards"!==t&&"backwards"!==t&&(yu[e]=!0,l('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',e)))}(s,i),function(e,t){if(("forwards"===t||"backwards"===t)&&null!=e&&!1!==e)if(_e(e)){for(var n=0;n<e.length;n++)if(!Ku(e[n],n))return}else{var r=N(e);if("function"==typeof r){var i=r.call(e);if(i)for(var s=i.next(),a=0;!s.done;s=i.next()){if(!Ku(s.value,a))return;a++}}else l('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',t)}}(a,i),xu(e,t,a,n);var o=Do.current;Lo(o,Po)?(o=Fo(o,Po),t.flags|=j):(null!==e&&0!==(e.flags&j)&&function(e,t,n){for(var r=t;null!==r;){if(r.tag===A)null!==r.memoizedState&&Yu(r,n,e);else if(r.tag===x)Yu(r,n,e);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)return;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}(t,t.child,n),o=ko(o));if(Oo(t,o),1&t.mode)switch(i){case"forwards":var c,u=function(e){for(var t=e,n=null;null!==t;){var r=t.alternate;null!==r&&null===zo(r)&&(n=t),t=t.sibling}return n}(t.child);null===u?(c=t.child,t.child=null):(c=u.sibling,u.sibling=null),qu(t,!1,c,u,s);break;case"backwards":var h=null,d=t.child;for(t.child=null;null!==d;){var f=d.alternate;if(null!==f&&null===zo(f)){t.child=d;break}var p=d.sibling;d.sibling=h,h=d,d=p}qu(t,!0,h,null,s);break;case"together":qu(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}var $u=!1;var Ju=!1;function Zu(){_u=!0}function eh(e,t,n){return null!==e&&(t.dependencies=e.dependencies),Nc(),Jf(t.lanes),Qr(n,t.childLanes)?(function(e,t){if(null!==e&&t.child!==e.child)throw new Error("Resuming work not yet implemented.");if(null!==t.child){var n=t.child,r=jp(n,n.pendingProps);for(t.child=r,r.return=t;null!==n.sibling;)n=n.sibling,(r=r.sibling=jp(n,n.pendingProps)).return=t;r.sibling=null}}(e,t),t.child):null}function th(e,t){return!!Qr(e.lanes,t)}function nh(e,t,n){if(t._debugNeedsRemount&&null!==e)return function(e,t,n){var r=t.return;if(null===r)throw new Error("Cannot swap the root fiber.");if(e.alternate=null,t.alternate=null,n.index=t.index,n.sibling=t.sibling,n.return=t.return,n.ref=t.ref,t===r.child)r.child=n;else{var i=r.child;if(null===i)throw new Error("Expected parent to have a child.");for(;i.sibling!==t;)if(null===(i=i.sibling))throw new Error("Expected to find the previous sibling.");i.sibling=n}var s=r.deletions;return null===s?(r.deletions=[e],r.flags|=V):s.push(e),n.flags|=2,n}(e,t,Yp(t.type,t.key,t.pendingProps,t._debugOwner||null,t.mode,t.lanes));if(null!==e)if(e.memoizedProps!==t.pendingProps||Gn()||t.type!==e.type)_u=!0;else{if(!th(e,n)&&0===(t.flags&j))return _u=!1,function(e,t,n){switch(t.tag){case 3:Bu(t),t.stateNode,so();break;case 5:Mo(t);break;case 1:Qn(t.type)&&Yn(t);break;case 4:wo(t,t.stateNode.containerInfo);break;case p:var r=t.memoizedProps.value;Rs(t,t.type._context,r);break;case g:Qr(n,t.childLanes)&&(t.flags|=4);var i=t.stateNode;i.effectDuration=0,i.passiveEffectDuration=0;break;case A:var s=t.memoizedState;if(null!==s){if(null!==s.dehydrated)return Oo(t,ko(Do.current)),t.flags|=j,null;if(Qr(n,t.child.childLanes))return zu(e,t,n);Oo(t,ko(Do.current));var a=eh(e,t,n);return null!==a?a.sibling:null}Oo(t,ko(Do.current));break;case x:var o=0!==(e.flags&j),l=Qr(n,t.childLanes);if(o){if(l)return Xu(e,t,n);t.flags|=j}var c=t.memoizedState;if(null!==c&&(c.rendering=null,c.tail=null,c.lastEffect=null),Oo(t,Do.current),l)break;return null;case b:case S:return t.lanes=0,Cu(e,t,n)}return eh(e,t,n)}(e,t,n);_u=0!==(e.flags&te)}else if(_u=!1,oo()&&function(e){return Fa(),0!==(e.flags&ne)}(t)){var r=t.index;Pa(t,(Fa(),Sa),r)}switch(t.lanes=0,t.tag){case 2:return function(e,t,n,r){null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2);var i,s,a,o=t.pendingProps;if(i=zn(t,Un(0,n,!1)),Ls(t,r),Ci(t),n.prototype&&"function"==typeof n.prototype.render){var c=G(n)||"Unknown";du[c]||(l("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",c,c),du[c]=!0)}if(8&t.mode&&as.recordLegacyContextWarning(t,null),ss(!0),Eu.current=t,s=ml(null,t,n,o,i,r),a=gl(),ss(!1),Ti(),t.flags|=1,"object"==typeof s&&null!==s&&"function"==typeof s.render&&void 0===s.$$typeof){var u=G(n)||"Unknown";fu[u]||(l("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",u,u,u),fu[u]=!0)}if("object"==typeof s&&null!==s&&"function"==typeof s.render&&void 0===s.$$typeof){var h=G(n)||"Unknown";fu[h]||(l("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",h,h,h),fu[h]=!0),t.tag=1,t.memoizedState=null,t.updateQueue=null;var d=!1;return Qn(n)?(d=!0,Yn(t)):d=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Hs(t),Aa(t,s),Ea(t,n,o,r),Ru(null,t,n,!0,d,r)}if(t.tag=0,8&t.mode){xi(!0);try{s=ml(null,t,n,o,i,r),a=gl()}finally{xi(!1)}}return oo()&&a&&Da(t),xu(null,t,s,r),ku(t,n),t.child}(e,t,t.type,n);case 16:return Lu(e,t,t.elementType,n);case 0:var i=t.type,s=t.pendingProps;return Mu(e,t,i,t.elementType===i?s:Es(i,s),n);case 1:var a=t.type,o=t.pendingProps;return Iu(e,t,a,t.elementType===a?o:Es(a,o),n);case 3:return Pu(e,t,n);case 5:return function(e,t,n){Mo(t),null===e&&to(t);var r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,a=i.children;return Be(r,i)?a=null:null!==s&&Be(r,s)&&(t.flags|=32),Tu(e,t),xu(e,t,a,n),t.child}(e,t,n);case 6:return function(e,t){return null===e&&to(t),null}(e,t);case A:return zu(e,t,n);case 4:return function(e,t,n){wo(t,t.stateNode.containerInfo);var r=t.pendingProps;return null===e?t.child=go(t,null,r,n):xu(e,t,r,n),t.child}(e,t,n);case m:var c=t.type,u=t.pendingProps;return bu(e,t,c,t.elementType===c?u:Es(c,u),n);case 7:return function(e,t,n){return xu(e,t,t.pendingProps,n),t.child}(e,t,n);case 8:return function(e,t,n){return xu(e,t,t.pendingProps.children,n),t.child}(e,t,n);case g:return function(e,t,n){t.flags|=4;var r=t.stateNode;return r.effectDuration=0,r.passiveEffectDuration=0,xu(e,t,t.pendingProps.children,n),t.child}(e,t,n);case p:return function(e,t,n){var r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value;"value"in i||$u||($u=!0,l("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var o=t.type.propTypes;if(o&&Cn(o,i,"prop","Context.Provider"),Rs(t,r,a),null!==s){var c=s.value;if(Gi(c,a)){if(s.children===i.children&&!Gn())return eh(e,t,n)}else Ds(t,r,n)}return xu(e,t,i.children,n),t.child}(e,t,n);case 9:return function(e,t,n){var r=t.type;void 0===r._context?r!==r.Consumer&&(Ju||(Ju=!0,l("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):r=r._context;var i=t.pendingProps.children;"function"!=typeof i&&l("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),Ls(t,n);var s,a=ks(r);return Ci(t),Eu.current=t,ss(!0),s=i(a),ss(!1),Ti(),t.flags|=1,xu(e,t,s,n),t.child}(e,t,n);case v:var h=t.type,d=Es(h,t.pendingProps);if(t.type!==t.elementType){var f=h.propTypes;f&&Cn(f,d,"prop",G(h))}return Su(e,t,h,d=Es(h.type,d),n);case y:return wu(e,t,t.type,t.pendingProps,n);case E:var _=t.type,w=t.pendingProps;return function(e,t,n,r,i){var s;return null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,Qn(n)?(s=!0,Yn(t)):s=!1,Ls(t,i),va(t,n,r),Ea(t,n,r,i),Ru(null,t,n,!0,s,i)}(e,t,_,t.elementType===_?w:Es(_,w),n);case x:return Xu(e,t,n);case 21:break;case b:return Cu(e,t,n)}throw new Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function rh(e,t,n){switch(ka(t),t.tag){case 1:Qn(t.type)&&Hn(t);var r=t.flags;return r&ee?(t.flags=-65537&r|j,2&t.mode&&jc(t),t):null;case 3:Co(t),Vn(t),Yo();var i=t.flags;return 0!==(i&ee)&&0===(i&j)?(t.flags=-65537&i|j,t):null;case 5:return Io(t),null;case A:Uo(t);var s=t.memoizedState;if(null!==s&&null!==s.dehydrated){if(null===t.alternate)throw new Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");so()}var a=t.flags;return a&ee?(t.flags=-65537&a|j,2&t.mode&&jc(t),t):null;case x:return Uo(t),null;case 4:return Co(t),null;case p:return Bs(t.type._context,t),null;case b:case S:return Yf(t),null;default:return null}}function ih(e,t,n){switch(ka(t),t.tag){case 1:var r=t.type.childContextTypes;null!=r&&Hn(t);break;case 3:Co(t),Vn(t),Yo();break;case 5:Io(t);break;case 4:Co(t);break;case A:case x:Uo(t);break;case p:Bs(t.type._context,t);break;case b:case S:Yf(t)}}function sh(e,t,n,r,i,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var ah=sh;if("undefined"!=typeof window&&"function"==typeof window.dispatchEvent&&"undefined"!=typeof document&&"function"==typeof document.createEvent){var oh=document.createElement("react");ah=function(e,t,n,r,i,s,a,o,l){if("undefined"==typeof document||null===document)throw new Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var c=document.createEvent("Event"),u=!1,h=!0,d=window.event,f=Object.getOwnPropertyDescriptor(window,"event");function p(){oh.removeEventListener(_,A,!1),void 0!==window.event&&window.hasOwnProperty("event")&&(window.event=d)}var m,g=Array.prototype.slice.call(arguments,3);function A(){u=!0,p(),t.apply(n,g),h=!1}var v=!1,y=!1;function E(e){if(m=e.error,v=!0,null===m&&0===e.colno&&0===e.lineno&&(y=!0),e.defaultPrevented&&null!=m&&"object"==typeof m)try{m._suppressLogging=!0}catch(e){}}var _="react-"+(e||"invokeguardedcallback");if(window.addEventListener("error",E),oh.addEventListener(_,A,!1),c.initEvent(_,!1,!1),oh.dispatchEvent(c),f&&Object.defineProperty(window,"event",f),u&&h&&(v?y&&(m=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):m=new Error("An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the \"Pause on exceptions\" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue."),this.onError(m)),window.removeEventListener("error",E),!u)return p(),sh.apply(this,arguments)}}var lh=ah,ch=!1,uh=null,hh={onError:function(e){ch=!0,uh=e}};function dh(e,t,n,r,i,s,a,o,l){ch=!1,uh=null,lh.apply(hh,arguments)}function fh(){if(ch){var e=uh;return ch=!1,uh=null,e}throw new Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}var ph=null;ph=new Set;var mh=!1,gh=!1,Ah="function"==typeof WeakSet?WeakSet:Set,vh=null,yh=null,Eh=null;function _h(e){dh(null,function(){throw e}),fh()}var xh=function(e,t){if(t.props=e.memoizedProps,t.state=e.memoizedState,2&e.mode)try{Hc(),t.componentWillUnmount()}finally{Gc(e)}else t.componentWillUnmount()};function bh(e,t){try{Dh(Vo,e)}catch(n){_h(n),up(e,t,n)}}function Sh(e,t,n){try{xh(e,n)}catch(n){_h(n),up(e,t,n)}}function wh(e,t){try{Oh(e)}catch(n){_h(n),up(e,t,n)}}function Ch(e,t){var n=e.ref;if(null!==n)if("function"==typeof n){var r;try{if(2&e.mode)try{Hc(),r=n(null)}finally{Gc(e)}else r=n(null)}catch(n){_h(n),up(e,t,n)}"function"==typeof r&&l("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",H(e))}else n.current=null}function Th(e,t,n){try{n()}catch(n){_h(n),up(e,t,n)}}var Mh=!1;function Ih(e,t){we(e.containerInfo),vh=t,function(){for(;null!==vh;){var e=vh,t=e.child;0!==(e.subtreeFlags&oe)&&null!==t?(Ad(t,e),vh=t):Rh()}}();var n=Mh;return Mh=!1,n}function Rh(){for(;null!==vh;){var e=vh;is(e);try{Bh(e)}catch(t){_h(t),up(e,e.return,t)}rs();var t=e.sibling;if(null!==t)return Ad(t,e.return),void(vh=t);vh=e.return}}function Bh(e){var t=e.alternate;if(0!==(e.flags&K)){switch(is(e),e.tag){case 0:case m:case y:break;case 1:if(null!==t){var n=t.memoizedProps,r=t.memoizedState,i=e.stateNode;e.type!==e.elementType||Au||(i.props!==e.memoizedProps&&l("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",H(e)||"instance"),i.state!==e.memoizedState&&l("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",H(e)||"instance"));var s=i.getSnapshotBeforeUpdate(e.elementType===e.type?n:Es(e.type,n),r),a=ph;void 0!==s||a.has(e.type)||(a.add(e.type),l("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",H(e))),i.__reactInternalSnapshotBeforeUpdate=s}break;case 3:if(Ue){var o=e.stateNode;mt(o.containerInfo)}break;case 5:case 6:case 4:case E:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}rs()}}function Ph(e,t,n){var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var s=i.next,a=s;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,void 0!==o&&((e&jo)!==Go?Ri(t):(e&Vo)!==Go&&Li(t),Th(t,n,o),(e&jo)!==Go?Bi():(e&Vo)!==Go&&ki())}a=a.next}while(a!==s)}}function Dh(e,t){var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next,s=i;do{if((s.tag&e)===e){(e&jo)!==Go?Mi(t):(e&Vo)!==Go&&Pi(t);var a=s.create;s.destroy=a(),(e&jo)!==Go?Ii():(e&Vo)!==Go&&Di();var o=s.destroy;if(void 0!==o&&"function"!=typeof o){var c=void 0;l("%s must not return anything besides a function, which is used for clean-up.%s",c=0!==(s.tag&Vo)?"useLayoutEffect":0!==(s.tag&Ho)?"useInsertionEffect":"useEffect",null===o?" You returned null. If your effect does not require clean up, return undefined (or nothing).":"function"==typeof o.then?"\n\nIt looks like you wrote "+c+"(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:\n\n"+c+"(() => {\n  async function fetchData() {\n    // You can await here\n    const response = await MyAPI.getData(someId);\n    // ...\n  }\n  fetchData();\n}, [someId]); // Or [] if effect doesn't need props or state\n\nLearn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching":" You returned: "+o)}}s=s.next}while(s!==i)}}function Lh(e,t){if(4&t.flags&&t.tag===g){var n=t.stateNode.passiveEffectDuration,r=t.memoizedProps,i=r.id,s=r.onPostCommit,a=Fc(),o=null===t.alternate?"mount":"update";kc()&&(o="nested-update"),"function"==typeof s&&s(i,o,n,a);var l=t.return;e:for(;null!==l;){switch(l.tag){case 3:l.stateNode.passiveEffectDuration+=n;break e;case g:l.stateNode.passiveEffectDuration+=n;break e}l=l.return}}}function kh(e,t,n,r){if(0!==(n.flags&ce))switch(n.tag){case 0:case m:case y:if(!gh)if(2&n.mode)try{Hc(),Dh(Vo|Qo,n)}finally{Gc(n)}else Dh(Vo|Qo,n);break;case 1:var i=n.stateNode;if(4&n.flags&&!gh)if(null===t)if(n.type!==n.elementType||Au||(i.props!==n.memoizedProps&&l("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",H(n)||"instance"),i.state!==n.memoizedState&&l("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",H(n)||"instance")),2&n.mode)try{Hc(),i.componentDidMount()}finally{Gc(n)}else i.componentDidMount();else{var s=n.elementType===n.type?t.memoizedProps:Es(n.type,t.memoizedProps),a=t.memoizedState;if(n.type!==n.elementType||Au||(i.props!==n.memoizedProps&&l("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",H(n)||"instance"),i.state!==n.memoizedState&&l("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",H(n)||"instance")),2&n.mode)try{Hc(),i.componentDidUpdate(s,a,i.__reactInternalSnapshotBeforeUpdate)}finally{Gc(n)}else i.componentDidUpdate(s,a,i.__reactInternalSnapshotBeforeUpdate)}var o=n.updateQueue;null!==o&&(n.type!==n.elementType||Au||(i.props!==n.memoizedProps&&l("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",H(n)||"instance"),i.state!==n.memoizedState&&l("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",H(n)||"instance")),ea(0,o,i));break;case 3:var c=n.updateQueue;if(null!==c){var u=null;if(null!==n.child)switch(n.child.tag){case 5:u=xe(n.child.stateNode);break;case 1:u=n.child.stateNode}ea(0,c,u)}break;case 5:var h=n.stateNode;if(null===t&&4&n.flags){var d=n.type,f=n.memoizedProps;it(h,d,f,n)}break;case 6:case 4:break;case g:var p=n.memoizedProps,v=p.onCommit,_=p.onRender,w=n.stateNode.effectDuration,C=Fc(),T=null===t?"mount":"update";kc()&&(T="nested-update"),"function"==typeof _&&_(n.memoizedProps.id,T,n.actualDuration,n.treeBaseDuration,n.actualStartTime,C),"function"==typeof v&&v(n.memoizedProps.id,T,w,C),I=n,bf.push(I),Ef||(Ef=!0,Sp(fi,function(){return ap(),null}));var M=n.return;e:for(;null!==M;){switch(M.tag){case 3:M.stateNode.effectDuration+=w;break e;case g:M.stateNode.effectDuration+=w;break e}M=M.return}break;case A:!function(e,t){if(!ze)return;var n=t.memoizedState;if(null===n){var r=t.alternate;if(null!==r){var i=r.memoizedState;if(null!==i){var s=i.dehydrated;null!==s&&jt(s)}}}}(0,n);break;case x:case E:case 21:case b:case S:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}var I;gh||n.flags&Y&&Oh(n)}function Fh(e){switch(e.tag){case 0:case m:case y:if(2&e.mode)try{Hc(),bh(e,e.return)}finally{Gc(e)}else bh(e,e.return);break;case 1:var t=e.stateNode;"function"==typeof t.componentDidMount&&function(e,t,n){try{n.componentDidMount()}catch(n){_h(n),up(e,t,n)}}(e,e.return,t),wh(e,e.return);break;case 5:wh(e,e.return)}}function Oh(e){var t=e.ref;if(null!==t){var n,r=e.stateNode;if(5===e.tag)n=xe(r);else n=r;if("function"==typeof t){var i;if(2&e.mode)try{Hc(),i=t(n)}finally{Gc(e)}else i=t(n);"function"==typeof i&&l("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",H(e))}else t.hasOwnProperty("current")||l("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",H(e)),t.current=n}}function Uh(e,t,n){switch(function(e){if(vi&&"function"==typeof vi.onCommitFiberUnmount)try{vi.onCommitFiberUnmount(Ai,e)}catch(e){Ei||(Ei=!0,l("React instrumentation encountered an error: %s",e))}}(t),t.tag){case 0:case m:case v:case y:var r=t.updateQueue;if(null!==r){var i=r.lastEffect;if(null!==i){var s=i.next,a=s;do{var o=a,c=o.destroy,u=o.tag;void 0!==c&&((u&Ho)!==Go?Th(t,n,c):(u&Vo)!==Go&&(Li(t),2&t.mode?(Hc(),Th(t,n,c),Gc(t)):Th(t,n,c),ki())),a=a.next}while(a!==s)}}return;case 1:Ch(t,n);var h=t.stateNode;return void("function"==typeof h.componentWillUnmount&&Sh(t,n,h));case 5:return void Ch(t,n);case 4:return void(Ue?Wh(e,t,n):Ne&&function(e){if(!Ne)return;var t=e.stateNode,n=t.containerInfo,r=At(n);Et(n,r)}(t));case _:case 21:return}}function Nh(e,t,n){for(var r=t;;)if(Uh(e,r,n),null===r.child||Ue&&4===r.tag){if(r===t)return;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function zh(e){var t=e.alternate;if(null!==t&&(e.alternate=null,zh(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag){var n=e.stateNode;null!==n&&Ve(n)}e.stateNode=null,e._debugOwner=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Gh(e){return 5===e.tag||3===e.tag||4===e.tag}function Qh(e){var t=e;e:for(;;){for(;null===t.sibling;){if(null===t.return||Gh(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&t.tag!==_;){if(2&t.flags)continue e;if(null===t.child||4===t.tag)continue e;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function Hh(e){if(Ue){var t=function(e){for(var t=e.return;null!==t;){if(Gh(t))return t;t=t.return}throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}(e);switch(t.tag){case 5:var n=t.stateNode;32&t.flags&&(ut(n),t.flags&=-33),jh(e,Qh(e),n);break;case 3:case 4:var r=t.stateNode.containerInfo;Vh(e,Qh(e),r);break;default:throw new Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}}function Vh(e,t,n){var r=e.tag;if(5===r||6===r){var i=e.stateNode;t?ot(n,i,t):nt(n,i)}else if(4===r);else{var s=e.child;if(null!==s){Vh(s,t,n);for(var a=s.sibling;null!==a;)Vh(a,t,n),a=a.sibling}}}function jh(e,t,n){var r=e.tag;if(5===r||6===r){var i=e.stateNode;t?at(n,i,t):tt(n,i)}else if(4===r);else{var s=e.child;if(null!==s){jh(s,t,n);for(var a=s.sibling;null!==a;)jh(a,t,n),a=a.sibling}}}function Wh(e,t,n){for(var r,i,s=t,a=!1;;){if(!a){var o=s.return;e:for(;;){if(null===o)throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");var l=o.stateNode;switch(o.tag){case 5:r=l,i=!1;break e;case 3:case 4:r=l.containerInfo,i=!0;break e}o=o.return}a=!0}if(5===s.tag||6===s.tag)Nh(e,s,n),i?ct(r,s.stateNode):lt(r,s.stateNode);else if(s.tag===_)i?Yt(r,s.stateNode):Wt(r,s.stateNode);else if(4===s.tag){if(null!==s.child){r=s.stateNode.containerInfo,i=!0,s.child.return=s,s=s.child;continue}}else if(Uh(e,s,n),null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)return;for(;null===s.sibling;){if(null===s.return||s.return===t)return;4===(s=s.return).tag&&(a=!1)}s.sibling.return=s.return,s=s.sibling}}function Yh(e,t,n){var r,i;Ue?Wh(e,t,n):Nh(e,t,n),null!==(i=(r=t).alternate)&&(i.return=null),r.return=null}function Kh(e,t){if(Ue){switch(t.tag){case 0:case m:case v:case y:if(Ph(Ho|Qo,t,t.return),Dh(Ho|Qo,t),2&t.mode)try{Hc(),Ph(Vo|Qo,t,t.return)}finally{Gc(t)}else Ph(Vo|Qo,t,t.return);return;case 1:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,i=null!==e?e.memoizedProps:r,s=t.type,a=t.updateQueue;t.updateQueue=null,null!==a&&st(n,a,s,i,r,t)}return;case 6:if(null===t.stateNode)throw new Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var o=t.stateNode,l=t.memoizedProps,c=null!==e?e.memoizedProps:l;return void rt(o,c,l);case 3:if(ze)if(null!==e)if(e.memoizedState.isDehydrated){var u=t.stateNode;Vt(u.containerInfo)}return;case g:return;case A:return qh(t),void Xh(t);case x:return void Xh(t);case E:return}throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}switch(t.tag){case 0:case m:case v:case y:if(Ph(Ho|Qo,t,t.return),Dh(Ho|Qo,t),2&t.mode)try{Hc(),Ph(Vo|Qo,t,t.return)}finally{Gc(t)}else Ph(Vo|Qo,t,t.return);return;case g:return;case A:return qh(t),void Xh(t);case x:return void Xh(t);case 3:if(ze)if(null!==e)if(e.memoizedState.isDehydrated){var h=t.stateNode;Vt(h.containerInfo)}break;case b:case S:return}!function(e){if(Ne){switch(e.tag){case 1:case 5:case 6:return;case 3:case 4:var t=e.stateNode,n=t.containerInfo,r=t.pendingChildren;return void Et(n,r)}throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}}(t)}function qh(e){e.memoizedState}function Xh(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ah),t.forEach(function(t){var r=pp.bind(null,e,t);if(!n.has(t)){if(n.add(t),_i){if(null===yh||null===Eh)throw Error("Expected finished root and lanes to be set. This is a bug in React.");xp(Eh,yh)}t.then(r,r)}})}}function $h(e,t,n){yh=n,Eh=e,vh=t,function(e,t){for(;null!==vh;){var n=vh,r=n.deletions;if(null!==r)for(var i=0;i<r.length;i++){var s=r[i];try{Yh(e,s,n)}catch(e){_h(e),up(s,n,e)}}var a=n.child;0!==(n.subtreeFlags&le)&&null!==a?(Ad(a,n),vh=a):Jh(e,t)}}(e,n),yh=null,Eh=null}function Jh(e,t){for(;null!==vh;){var n=vh;is(n);try{Zh(n,e,t)}catch(e){_h(e),up(n,n.return,e)}rs();var r=n.sibling;if(null!==r)return Ad(r,n.return),void(vh=r);vh=n.return}}function Zh(e,t,n){var r=e.flags;if(32&r&&function(e){Ue&&ut(e.stateNode)}(e),r&Y){var i=e.alternate;null!==i&&function(e){var t=e.ref;if(null!==t)if("function"==typeof t)if(2&e.mode)try{Hc(),t(null)}finally{Gc(e)}else t(null);else t.current=null}(i)}if(r&$)switch(e.tag){case A:if(null!==e.memoizedState){var s=e.alternate;null!==s&&null!==s.memoizedState||(hf=ui())}break;case b:var a=null!==e.memoizedState,o=e.alternate,l=null!==o&&null!==o.memoizedState,c=e;if(Ue&&function(e,t){var n=null;if(Ue)for(var r=e;;){if(5===r.tag){if(null===n){n=r;var i=r.stateNode;t?ht(i):ft(r.stateNode,r.memoizedProps)}}else if(6===r.tag){if(null===n){var s=r.stateNode;t?dt(s):pt(s,r.memoizedProps)}}else if((r.tag!==b&&r.tag!==S||null===r.memoizedState||r===e)&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)return;for(;null===r.sibling;){if(null===r.return||r.return===e)return;n===r&&(n=null),r=r.return}n===r&&(n=null),r.sibling.return=r.return,r=r.sibling}}(c,a),a&&!l&&1&c.mode){vh=c;for(var u=c.child;null!==u;)vh=u,rd(u),u=u.sibling}}switch(4102&r){case 2:Hh(e),e.flags&=-3;break;case 6:Hh(e),e.flags&=-3,Kh(e.alternate,e);break;case X:e.flags&=-4097;break;case 4100:e.flags&=-4097,Kh(e.alternate,e);break;case 4:Kh(e.alternate,e)}}function ed(e,t,n){yh=n,Eh=t,vh=e,td(e,t,n),yh=null,Eh=null}function td(e,t,n){for(var r=!!(1&e.mode);null!==vh;){var i=vh,s=i.child;if(i.tag===b&&r){var a=null!==i.memoizedState||mh;if(a){nd(e,t,n);continue}var o=i.alternate,l=null!==o&&null!==o.memoizedState,c=mh,u=gh;mh=a,(gh=l||gh)&&!u&&(vh=i,sd(i));for(var h=s;null!==h;)vh=h,td(h,t,n),h=h.sibling;vh=i,mh=c,gh=u,nd(e,t,n)}else 0!==(i.subtreeFlags&ce)&&null!==s?(Ad(s,i),vh=s):nd(e,t,n)}}function nd(e,t,n){for(;null!==vh;){var r=vh;if(0!==(r.flags&ce)){var i=r.alternate;is(r);try{kh(0,i,r)}catch(e){_h(e),up(r,r.return,e)}rs()}if(r===e)return void(vh=null);var s=r.sibling;if(null!==s)return Ad(s,r.return),void(vh=s);vh=r.return}}function rd(e){for(;null!==vh;){var t=vh,n=t.child;switch(t.tag){case 0:case m:case v:case y:if(2&t.mode)try{Hc(),Ph(Vo,t,t.return)}finally{Gc(t)}else Ph(Vo,t,t.return);break;case 1:Ch(t,t.return);var r=t.stateNode;"function"==typeof r.componentWillUnmount&&Sh(t,t.return,r);break;case 5:Ch(t,t.return);break;case b:if(null!==t.memoizedState){id(e);continue}}null!==n?(n.return=t,vh=n):id(e)}}function id(e){for(;null!==vh;){var t=vh;if(t===e)return void(vh=null);var n=t.sibling;if(null!==n)return n.return=t.return,void(vh=n);vh=t.return}}function sd(e){for(;null!==vh;){var t=vh,n=t.child;if(t.tag===b)if(null!==t.memoizedState){ad(e);continue}null!==n?(n.return=t,vh=n):ad(e)}}function ad(e){for(;null!==vh;){var t=vh;is(t);try{Fh(t)}catch(e){_h(e),up(t,t.return,e)}if(rs(),t===e)return void(vh=null);var n=t.sibling;if(null!==n)return n.return=t.return,void(vh=n);vh=t.return}}function od(e,t){vh=t,function(e,t){for(;null!==vh;){var n=vh,r=n.child;0!==(n.subtreeFlags&ue)&&null!==r?(Ad(r,n),vh=r):ld(e,t)}}(t,e)}function ld(e,t){for(;null!==vh;){var n=vh;if(0!==(n.flags&q)){is(n);try{cd(t,n)}catch(e){_h(e),up(n,n.return,e)}rs()}if(n===e)return void(vh=null);var r=n.sibling;if(null!==r)return Ad(r,n.return),void(vh=r);vh=n.return}}function cd(e,t){switch(t.tag){case 0:case m:case y:if(2&t.mode){Vc();try{Dh(jo|Qo,t)}finally{Qc(t)}}else Dh(jo|Qo,t)}}function ud(e){vh=e,function(){for(;null!==vh;){var e=vh,t=e.child;if(0!==(vh.flags&V)){var n=e.deletions;if(null!==n){for(var r=0;r<n.length;r++){var i=n[r];vh=i,fd(i,e)}var s=e.alternate;if(null!==s){var a=s.child;if(null!==a){s.child=null;do{var o=a.sibling;a.sibling=null,a=o}while(null!==a)}}vh=e}}0!==(e.subtreeFlags&ue)&&null!==t?(Ad(t,e),vh=t):hd()}}()}function hd(){for(;null!==vh;){var e=vh;0!==(e.flags&q)&&(is(e),dd(e),rs());var t=e.sibling;if(null!==t)return Ad(t,e.return),void(vh=t);vh=e.return}}function dd(e){switch(e.tag){case 0:case m:case y:2&e.mode?(Vc(),Ph(jo|Qo,e,e.return),Qc(e)):Ph(jo|Qo,e,e.return)}}function fd(e,t){for(;null!==vh;){var n=vh;is(n),md(n,t),rs();var r=n.child;null!==r?(Ad(r,n),vh=r):pd(e)}}function pd(e){for(;null!==vh;){var t=vh,n=t.sibling,r=t.return;if(zh(t),t===e)return void(vh=null);if(null!==n)return Ad(n,r),void(vh=n);vh=r}}function md(e,t){switch(e.tag){case 0:case m:case y:2&e.mode?(Vc(),Ph(jo,e,t),Qc(e)):Ph(jo,e,t)}}var gd=!1;function Ad(e,t){gd||e.return===t||(gd=!0,l("Internal React error: Return pointer is inconsistent with parent.")),e.return=t}function vd(e){switch(e.tag){case 0:case m:case y:try{Dh(Vo|Qo,e)}catch(t){_h(t),up(e,e.return,t)}break;case 1:var t=e.stateNode;try{t.componentDidMount()}catch(t){_h(t),up(e,e.return,t)}}}function yd(e){switch(e.tag){case 0:case m:case y:try{Dh(jo|Qo,e)}catch(t){_h(t),up(e,e.return,t)}}}function Ed(e){switch(e.tag){case 0:case m:case y:try{Ph(Vo|Qo,e,e.return)}catch(t){_h(t),up(e,e.return,t)}break;case 1:var t=e.stateNode;"function"==typeof t.componentWillUnmount&&Sh(e,e.return,t)}}function _d(e){switch(e.tag){case 0:case m:case y:try{Ph(jo|Qo,e,e.return)}catch(t){_h(t),up(e,e.return,t)}}}var xd=0,bd=1,Sd=2,wd=3,Cd=4;if("function"==typeof Symbol&&Symbol.for){var Td=Symbol.for;xd=Td("selector.component"),bd=Td("selector.has_pseudo_class"),Sd=Td("selector.role"),wd=Td("selector.test_id"),Cd=Td("selector.text")}function Md(e){var t=Ge(e);if(null!=t){if("string"!=typeof t.memoizedProps["data-testname"])throw new Error("Invalid host root specified. Should be either a React container or a node with a testname attribute.");return t}var n=Ke(e);if(null===n)throw new Error("Could not find React container within specified host subtree.");return n.stateNode.current}function Id(e,t){switch(t.$$typeof){case xd:if(e.type===t.value)return!0;break;case bd:return function(e,t){var n=[e,0],r=0;for(;r<n.length;){var i=n[r++],s=n[r++],a=t[s];if(5!==i.tag||!$e(i)){for(;null!=a&&Id(i,a);)a=t[++s];if(s===t.length)return!0;for(var o=i.child;null!==o;)n.push(o,s),o=o.sibling}}return!1}(e,t.value);case Sd:if(5===e.tag){var n=e.stateNode;if(Je(n,t.value))return!0}break;case Cd:if(5===e.tag||6===e.tag){var r=Xe(e);if(null!==r&&r.indexOf(t.value)>=0)return!0}break;case wd:if(5===e.tag){var i=e.memoizedProps["data-testname"];if("string"==typeof i&&i.toLowerCase()===t.value.toLowerCase())return!0}break;default:throw new Error("Invalid selector type specified.")}return!1}function Rd(e){switch(e.$$typeof){case xd:return"<"+(G(e.value)||"Unknown")+">";case bd:return":has("+(Rd(e)||"")+")";case Sd:return'[role="'+e.value+'"]';case Cd:return'"'+e.value+'"';case wd:return'[data-testname="'+e.value+'"]';default:throw new Error("Invalid selector type specified.")}}function Bd(e,t){for(var n=[],r=[e,0],i=0;i<r.length;){var s=r[i++],a=r[i++],o=t[a];if(5!==s.tag||!$e(s)){for(;null!=o&&Id(s,o);)o=t[++a];if(a===t.length)n.push(s);else for(var l=s.child;null!==l;)r.push(l,a),l=l.sibling}}return n}function Pd(e,t){if(!Ye)throw new Error("Test selector API is not supported by this renderer.");for(var n=Bd(Md(e),t),r=[],i=Array.from(n),s=0;s<i.length;){var a=i[s++];if(5===a.tag){if($e(a))continue;r.push(a.stateNode)}else for(var o=a.child;null!==o;)i.push(o),o=o.sibling}return r}var Dd=[];var Ld=s.ReactCurrentActQueue;function kd(){var e="undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?IS_REACT_ACT_ENVIRONMENT:void 0;return e||null===Ld.current||l("The current testing environment is not configured to support act(...)"),e}var Fd=Math.ceil,Od=s.ReactCurrentDispatcher,Ud=s.ReactCurrentOwner,Nd=s.ReactCurrentBatchConfig,zd=s.ReactCurrentActQueue,Gd=0,Qd=2,Hd=4,Vd=0,jd=1,Wd=2,Yd=3,Kd=4,qd=5,Xd=6,$d=Gd,Jd=null,Zd=null,ef=0,tf=0,nf=Bn(0),rf=Vd,sf=null,af=0,of=0,lf=0,cf=null,uf=null,hf=0,df=500,ff=1/0,pf=500;function mf(){ff=ui()+pf}function gf(){return ff}var Af=!1,vf=null,yf=null,Ef=!1,_f=null,xf=0,bf=[],Sf=50,wf=0,Tf=null,Mf=50,If=0,Rf=Tr,Bf=0;function Pf(){return Jd}function Df(){return($d&(Qd|Hd))!==Gd?ui():Rf!==Tr?Rf:Rf=ui()}function Lf(e){var t;if(!(1&e.mode))return 1;if(($d&Qd)!==Gd&&0!==ef)return Nr(ef);if(null!==qi.transition){if(null!==Nd.transition){var n=Nd.transition;n._updatedFibers||(n._updatedFibers=new Set),n._updatedFibers.add(e)}return 0===Bf&&(t=Mr,!((Mr<<=1)&tr)&&(Mr=64),Bf=t),Bf}var r=ni();return 0!==r?r:He()}function kf(e){var t;return 1&e.mode?(t=Ir,!((Ir<<=1)&pr)&&(Ir=mr),t):1}function Ff(e,t,n){!function(){if(wf>Sf)throw wf=0,Tf=null,new Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");If>Mf&&(If=0,l("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}();var r=Of(e,t);return null===r?null:(Kr(r,t,n),0!==($d&Qd)&&r===Jd?function(e){if(ts&&!lc)switch(e.tag){case 0:case m:case y:var t=Zd&&H(Zd)||"Unknown",n=t;if(!Ep.has(n))Ep.add(n),l("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",H(e)||"Unknown",t,t);break;case 1:_p||(l("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),_p=!0)}}(e):(_i&&$r(r,e,t),function(e){if(1&e.mode){if(!kd())return}else{if(t="undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?IS_REACT_ACT_ENVIRONMENT:void 0,n="undefined"!=typeof jest,!Oe||!n||!1===t)return;if($d!==Gd)return;if(0!==e.tag&&e.tag!==m&&e.tag!==y)return}var t,n;if(null===zd.current){var r=es;try{is(e),l("An update to %s inside a test was not wrapped in act(...).\n\nWhen testing, code that causes React state updates should be wrapped into act(...):\n\nact(() => {\n  /* fire events that update state */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act",H(e))}finally{r?is(e):rs()}}}(e),r===Jd&&(($d&Qd)===Gd&&(of=Vr(of,t)),rf===Kd&&Hf(r,ef)),Nf(r,n),1!==t||$d!==Gd||1&e.mode||zd.isBatchingLegacy||(mf(),Wi())),r)}function Of(e,t){e.lanes=Vr(e.lanes,t);var n=e.alternate;null!==n&&(n.lanes=Vr(n.lanes,t)),null===n&&4098&e.flags&&yp(e);for(var r=e,i=e.return;null!==i;)i.childLanes=Vr(i.childLanes,t),null!==(n=i.alternate)?n.childLanes=Vr(n.childLanes,t):4098&i.flags&&yp(e),r=i,i=i.return;return 3===r.tag?r.stateNode:null}function Uf(e,t){return null!==Jd&&!!(1&e.mode)&&($d&Qd)===Gd}function Nf(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.pendingLanes,r=e.suspendedLanes,i=e.pingedLanes,s=e.expirationTimes,a=n;a>0;){var o=zr(a),l=1<<o,c=s[o];c===Tr?0!==(l&r)&&0===(l&i)||(s[o]=Pr(l,t)):c<=t&&(e.expiredLanes|=l),a&=~l}}(e,t);var r=Br(e,e===Jd?ef:0);if(0===r)return null!==n&&wp(n),e.callbackNode=null,void(e.callbackPriority=0);var i=Ur(r),s=e.callbackPriority;if(s!==i||null!==zd.current&&n!==bp){var a,o;if(null!=n&&wp(n),1===i)0===e.tag?(null!==zd.isBatchingLegacy&&(zd.didScheduleLegacyUpdate=!0),o=Vf.bind(null,e),Hi=!0,ji(o)):ji(Vf.bind(null,e)),je?null!==zd.current?zd.current.push(Yi):We(function(){$d===Gd&&Yi()}):Sp(hi,Yi),a=null;else{var c;switch(si(r)){case 1:c=hi;break;case 4:c=di;break;case Zr:c=fi;break;case ei:c=pi;break;default:c=fi}a=Sp(c,zf.bind(null,e))}e.callbackPriority=i,e.callbackNode=a}else null==n&&1!==s&&l("Expected scheduled callback to exist. This error is likely caused by a bug in React. Please file an issue.")}function zf(e,t){if(Dc=!1,Lc=!1,Rf=Tr,Bf=0,($d&(Qd|Hd))!==Gd)throw new Error("Should not already be working.");var n=e.callbackNode;if(ap()&&e.callbackNode!==n)return null;var r=Br(e,e===Jd?ef:0);if(0===r)return null;var i=!Fr(0,r)&&!function(e,t){return 0!==(t&e.expiredLanes)}(e,r)&&!t,s=i?function(e,t){var n=$d;$d|=Qd;var r=Xf();if(Jd!==e||ef!==t){if(_i){var i=e.memoizedUpdaters;i.size>0&&(xp(e,ef),i.clear()),Jr(e,t)}mf(),Kf(e,t)}Ui(t);for(;;)try{np();break}catch(t){qf(e,t)}return Ts(),$f(r),$d=n,null!==Zd?(null!==yi&&"function"==typeof yi.markRenderYielded&&yi.markRenderYielded(),Vd):(Ni(),Jd=null,ef=0,rf)}(e,r):ep(e,r);if(s!==Vd){if(s===Wd){var a=Dr(e);0!==a&&(r=a,s=Gf(e,a))}if(s===jd){var o=sf;throw Kf(e,0),Hf(e,r),Nf(e,ui()),o}if(s===Xd)Hf(e,r);else{var l=!Fr(0,r),c=e.current.alternate;if(l&&!function(e){var t=e;for(;;){if(t.flags&J){var n=t.updateQueue;if(null!==n){var r=n.stores;if(null!==r)for(var i=0;i<r.length;i++){var s=r[i],a=s.getSnapshot,o=s.value;try{if(!Gi(a(),o))return!1}catch(e){return!1}}}}var l=t.child;if(t.subtreeFlags&J&&null!==l)l.return=t,t=l;else{if(t===e)return!0;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(c)){if((s=ep(e,r))===Wd){var u=Dr(e);0!==u&&(r=u,s=Gf(e,u))}if(s===jd){var h=sf;throw Kf(e,0),Hf(e,r),Nf(e,ui()),h}}e.finishedWork=c,e.finishedLanes=r,function(e,t,n){switch(t){case Vd:case jd:throw new Error("Root did not complete. This is a bug in React.");case Wd:sp(e,uf);break;case Yd:if(Hf(e,n),kr(n)&&!Cp()){var r=hf+df-ui();if(r>10){if(0!==Br(e,0))break;var i=e.suspendedLanes;if(!Hr(i,n)){Df(),qr(e,i);break}e.timeoutHandle=De(sp.bind(null,e,uf),r);break}}sp(e,uf);break;case Kd:if(Hf(e,n),function(e){return(e&tr)===e}(n))break;if(!Cp()){var s=function(e,t){for(var n=e.eventTimes,r=Tr;t>0;){var i=zr(t),s=1<<i,a=n[i];a>r&&(r=a),t&=~s}return r}(e,n),a=s,o=ui()-a,l=((c=o)<120?120:c<480?480:c<1080?1080:c<1920?1920:c<3e3?3e3:c<4320?4320:1960*Fd(c/1960))-o;if(l>10){e.timeoutHandle=De(sp.bind(null,e,uf),l);break}}sp(e,uf);break;case qd:sp(e,uf);break;default:throw new Error("Unknown root exit status.")}var c}(e,s,r)}}return Nf(e,ui()),e.callbackNode===n?zf.bind(null,e):null}function Gf(e,t){var n=cf;Ki(e)&&(Kf(e,t).flags|=W,un(e.containerInfo));var r=ep(e,t);if(r!==Wd){var i=uf;uf=n,null!==i&&Qf(i)}return r}function Qf(e){null===uf?uf=e:uf.push.apply(uf,e)}function Hf(e,t){t=jr(t,lf),function(e,t){e.suspendedLanes|=t,e.pingedLanes&=~t;for(var n=e.expirationTimes,r=t;r>0;){var i=zr(r),s=1<<i;n[i]=Tr,r&=~s}}(e,t=jr(t,of))}function Vf(e){if(Dc=Lc,Lc=!1,($d&(Qd|Hd))!==Gd)throw new Error("Should not already be working.");ap();var t=Br(e,0);if(!Qr(t,1))return Nf(e,ui()),null;var n=ep(e,t);if(0!==e.tag&&n===Wd){var r=Dr(e);0!==r&&(t=r,n=Gf(e,r))}if(n===jd){var i=sf;throw Kf(e,0),Hf(e,t),Nf(e,ui()),i}if(n===Xd)throw new Error("Root did not complete. This is a bug in React.");var s=e.current.alternate;return e.finishedWork=s,e.finishedLanes=t,sp(e,uf),Nf(e,ui()),null}function jf(e){null!==_f&&0===_f.tag&&($d&(Qd|Hd))===Gd&&ap();var t=$d;$d|=1;var n=Nd.transition,r=ni();try{return Nd.transition=null,ri(1),e?e():void 0}finally{ri(r),Nd.transition=n,(($d=t)&(Qd|Hd))===Gd&&Yi()}}function Wf(e,t){Dn(nf,tf,e),tf=Vr(tf,t)}function Yf(e){tf=nf.current,Pn(nf,e)}function Kf(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==ke&&(e.timeoutHandle=ke,Le(n)),null!==Zd)for(var r=Zd.return;null!==r;){r.alternate;ih(0,r),r=r.return}Jd=e;var i=jp(e.current,null);return Zd=i,ef=tf=t,rf=Vd,sf=null,af=0,of=0,lf=0,cf=null,uf=null,function(){if(null!==Fs){for(var e=0;e<Fs.length;e++){var t=Fs[e],n=t.interleaved;if(null!==n){t.interleaved=null;var r=n.next,i=t.pending;if(null!==i){var s=i.next;i.next=r,n.next=s}t.pending=n}}Fs=null}}(),as.discardPendingWarnings(),i}function qf(e,t){for(;;){var n=Zd;try{if(Ts(),vl(),rs(),Ud.current=null,null===n||null===n.return)return rf=jd,sf=t,void(Zd=null);2&n.mode&&zc(n,!0),Ti(),null!==t&&"object"==typeof t&&"function"==typeof t.then?Oi(n,t,ef):Fi(n,t,ef),iu(e,n.return,n,t,ef),ip(n)}catch(e){t=e,Zd===n&&null!==n?(n=n.return,Zd=n):n=Zd;continue}return}}function Xf(){var e=Od.current;return Od.current=vc,null===e?vc:e}function $f(e){Od.current=e}function Jf(e){af=Vr(e,af)}function Zf(){rf!==Vd&&rf!==Yd&&rf!==Wd||(rf=Kd),null!==Jd&&(Lr(af)||Lr(of))&&Hf(Jd,ef)}function ep(e,t){var n=$d;$d|=Qd;var r=Xf();if(Jd!==e||ef!==t){if(_i){var i=e.memoizedUpdaters;i.size>0&&(xp(e,ef),i.clear()),Jr(e,t)}Kf(e,t)}for(Ui(t);;)try{tp();break}catch(t){qf(e,t)}if(Ts(),$d=n,$f(r),null!==Zd)throw new Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return Ni(),Jd=null,ef=0,rf}function tp(){for(;null!==Zd;)rp(Zd)}function np(){for(;null!==Zd&&!li();)rp(Zd)}function rp(e){var t,n=e.alternate;is(e),2&e.mode?(Uc(e),t=Ap(n,e,tf),zc(e,!0)):t=Ap(n,e,tf),rs(),e.memoizedProps=e.pendingProps,null===t?ip(e):Zd=t,Ud.current=null}function ip(e){var t=e;do{var n=t.alternate,r=t.return;if(0===(t.flags&Z)){is(t);var i=void 0;if(2&t.mode?(Uc(t),i=hu(n,t,tf),zc(t,!1)):i=hu(n,t,tf),rs(),null!==i)return void(Zd=i)}else{var s=rh(0,t);if(null!==s)return s.flags&=32767,void(Zd=s);if(2&t.mode){zc(t,!1);for(var a=t.actualDuration,o=t.child;null!==o;)a+=o.actualDuration,o=o.sibling;t.actualDuration=a}if(null===r)return rf=Xd,void(Zd=null);r.flags|=Z,r.subtreeFlags=0,r.deletions=null}var l=t.sibling;if(null!==l)return void(Zd=l);Zd=t=r}while(null!==t);rf===Vd&&(rf=qd)}function sp(e,t){var n=ni(),r=Nd.transition;try{Nd.transition=null,ri(1),function(e,t,n){do{ap()}while(null!==_f);if(function(){as.flushLegacyContextWarning(),as.flushPendingUnsafeLifecycleWarnings()}(),($d&(Qd|Hd))!==Gd)throw new Error("Should not already be working.");var r=e.finishedWork,i=e.finishedLanes;if(function(e){null!==yi&&"function"==typeof yi.markCommitStarted&&yi.markCommitStarted(e)}(i),null===r)return wi(),null;0===i&&l("root.finishedLanes should not be empty during a commit. This is a bug in React.");if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw new Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");e.callbackNode=null,e.callbackPriority=0;var s=Vr(r.lanes,r.childLanes);(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t;for(var r=e.entanglements,i=e.eventTimes,s=e.expirationTimes,a=n;a>0;){var o=zr(a),l=1<<o;r[o]=0,i[o]=Tr,s[o]=Tr,a&=~l}})(e,s),e===Jd&&(Jd=null,Zd=null,ef=0);0===(r.subtreeFlags&ue)&&0===(r.flags&ue)||Ef||(Ef=!0,Sp(fi,function(){return ap(),null}));var a=!!(15990&r.subtreeFlags),o=!!(15990&r.flags);if(a||o){var c=Nd.transition;Nd.transition=null;var u=ni();ri(1);var h=$d;$d|=Hd,Ud.current=null,Ih(e,r),Oc(),$h(e,r,i),Ce(e.containerInfo),e.current=r,function(e){null!==yi&&"function"==typeof yi.markLayoutEffectsStarted&&yi.markLayoutEffectsStarted(e)}(i),ed(r,e,i),null!==yi&&"function"==typeof yi.markLayoutEffectsStopped&&yi.markLayoutEffectsStopped(),ci(),$d=h,ri(u),Nd.transition=c}else e.current=r,Oc();var d=Ef;Ef&&(Ef=!1,_f=e,xf=i);s=e.pendingLanes,0===s&&(yf=null);d||mp(e.current,!1);(function(e,t){if(vi&&"function"==typeof vi.onCommitFiberRoot)try{var n,r=(e.current.flags&j)===j;switch(t){case 1:n=hi;break;case 4:n=di;break;case Zr:n=fi;break;case ei:n=pi;break;default:n=fi}vi.onCommitFiberRoot(Ai,e,n,r)}catch(e){Ei||(Ei=!0,l("React instrumentation encountered an error: %s",e))}})(r.stateNode,n),_i&&e.memoizedUpdaters.clear();if(function(){Ye&&Dd.forEach(function(e){return e()})}(),Nf(e,ui()),null!==t)for(var f=e.onRecoverableError,p=0;p<t.length;p++){f(t[p])}if(Af){Af=!1;var m=vf;throw vf=null,m}Qr(xf,1)&&0!==e.tag&&ap();s=e.pendingLanes,Qr(s,1)?(Lc=!0,e===Tf?wf++:(wf=0,Tf=e)):wf=0;Yi(),wi()}(e,t,n)}finally{Nd.transition=r,ri(n)}return null}function ap(){if(null!==_f){var e=si(xf),t=function(e,t){return 0===e||e>t?e:t}(Zr,e),n=Nd.transition,r=ni();try{return Nd.transition=null,ri(t),function(){if(null===_f)return!1;var e=_f,t=xf;if(_f=null,xf=0,($d&(Qd|Hd))!==Gd)throw new Error("Cannot flush passive effects while already rendering.");!function(e){null!==yi&&"function"==typeof yi.markPassiveEffectsStarted&&yi.markPassiveEffectsStarted(e)}(t);var n=$d;$d|=Hd,ud(e.current),od(e,e.current);var r=bf;bf=[];for(var i=0;i<r.length;i++){Lh(0,r[i])}null!==yi&&"function"==typeof yi.markPassiveEffectsStopped&&yi.markPassiveEffectsStopped(),mp(e.current,!0),$d=n,Yi(),If=null===_f?0:If+1,function(e){if(vi&&"function"==typeof vi.onPostCommitFiberRoot)try{vi.onPostCommitFiberRoot(Ai,e)}catch(e){Ei||(Ei=!0,l("React instrumentation encountered an error: %s",e))}}(e);var s=e.current.stateNode;return s.effectDuration=0,s.passiveEffectDuration=0,!0}()}finally{ri(r),Nd.transition=n}}return!1}function op(e){return null!==yf&&yf.has(e)}var lp=function(e){Af||(Af=!0,vf=e)};function cp(e,t,n){Ws(e,Zc(e,Wc(n,t),1));var r=Df(),i=Of(e,1);null!==i&&(Kr(i,1,r),Nf(i,r))}function up(e,t,n){if(3!==e.tag){var r=null;for(r=t;null!==r;){if(3===r.tag)return void cp(r,e,n);if(1===r.tag){var i=r.type,s=r.stateNode;if("function"==typeof i.getDerivedStateFromError||"function"==typeof s.componentDidCatch&&!op(s)){Ws(r,eu(r,Wc(n,e),1));var a=Df(),o=Of(r,1);return void(null!==o&&(Kr(o,1,a),Nf(o,a)))}}r=r.return}l("Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Likely causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.\n\nError message:\n\n%s",n)}else cp(e,e,n)}function hp(e,t,n){var r=e.pingCache;null!==r&&r.delete(t);var i=Df();qr(e,n),function(e){0!==e.tag&&kd()&&null===zd.current&&l("A suspended resource finished loading inside a test, but the event was not wrapped in act(...).\n\nWhen testing, code that resolves suspended data should be wrapped into act(...):\n\nact(() => {\n  /* finish loading suspended data */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act")}(e),Jd===e&&Hr(ef,n)&&(rf===Kd||rf===Yd&&kr(ef)&&ui()-hf<df?Kf(e,0):lf=Vr(lf,n)),Nf(e,i)}function dp(e,t){0===t&&(t=kf(e));var n=Df(),r=Of(e,t);null!==r&&(Kr(r,t,n),Nf(r,n))}function fp(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),dp(e,n)}function pp(e,t){var n,r=0;switch(e.tag){case A:n=e.stateNode;var i=e.memoizedState;null!==i&&(r=i.retryLane);break;case x:n=e.stateNode;break;default:throw new Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}null!==n&&n.delete(t),dp(e,r)}function mp(e,t){is(e),gp(e,se,Ed),t&&gp(e,ae,_d),gp(e,se,vd),t&&gp(e,ae,yd),rs()}function gp(e,t,n){for(var r=e,i=null;null!==r;){var s=r.subtreeFlags&t;r!==i&&null!==r.child&&0!==s?r=r.child:(0!==(r.flags&t)&&n(r),r=null!==r.sibling?r.sibling:i=r.return)}}var Ap,vp=null;function yp(e){if(($d&Qd)===Gd&&1&e.mode){var t=e.tag;if(2===t||3===t||1===t||0===t||t===m||t===v||t===y){var n=H(e)||"ReactComponent";if(null!==vp){if(vp.has(n))return;vp.add(n)}else vp=new Set([n]);var r=es;try{is(e),l("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{r?is(e):rs()}}}}Ap=function(e,t,n){var r=Zp(null,t);try{return nh(e,t,n)}catch(s){if(null!==s&&"object"==typeof s&&"function"==typeof s.then)throw s;if(Ts(),vl(),ih(0,t),Zp(t,r),2&t.mode&&Uc(t),dh(null,nh,null,e,t,n),ch){var i=fh();"object"==typeof i&&null!==i&&i._suppressLogging&&"object"==typeof s&&null!==s&&!s._suppressLogging&&(s._suppressLogging=!0)}throw s}};var Ep,_p=!1;function xp(e,t){_i&&e.memoizedUpdaters.forEach(function(n){$r(e,n,t)})}Ep=new Set;var bp={};function Sp(e,t){var n=zd.current;return null!==n?(n.push(t),bp):ai(e,t)}function wp(e){if(e!==bp)return oi(e)}function Cp(){return null!==zd.current}var Tp=null,Mp=null,Ip=function(e){Tp=e};function Rp(e){if(null===Tp)return e;var t=Tp(e);return void 0===t?e:t.current}function Bp(e){return Rp(e)}function Pp(e){if(null===Tp)return e;var t=Tp(e);if(void 0===t){if(null!=e&&"function"==typeof e.render){var n=Rp(e.render);if(e.render!==n){var r={$$typeof:P,render:n};return void 0!==e.displayName&&(r.displayName=e.displayName),r}}return e}return t.current}function Dp(e,t){if(null===Tp)return!1;var n=e.elementType,r=t.type,i=!1,s="object"==typeof r&&null!==r?r.$$typeof:null;switch(e.tag){case 1:"function"==typeof r&&(i=!0);break;case 0:("function"==typeof r||s===F)&&(i=!0);break;case m:(s===P||s===F)&&(i=!0);break;case v:case y:(s===k||s===F)&&(i=!0);break;default:return!1}if(i){var a=Tp(n);if(void 0!==a&&a===Tp(r))return!0}return!1}function Lp(e){null!==Tp&&"function"==typeof WeakSet&&(null===Mp&&(Mp=new WeakSet),Mp.add(e))}var kp=function(e,t){if(null!==Tp){var n=t.staleFamilies,r=t.updatedFamilies;ap(),jf(function(){Op(e.current,r,n)})}},Fp=function(e,t){e.context===Ln&&(ap(),jf(function(){sm(t,e,null,null)}))};function Op(e,t,n){var r=e.alternate,i=e.child,s=e.sibling,a=e.tag,o=e.type,l=null;switch(a){case 0:case y:case 1:l=o;break;case m:l=o.render}if(null===Tp)throw new Error("Expected resolveFamily to be set during hot reload.");var c=!1,u=!1;if(null!==l){var h=Tp(l);void 0!==h&&(n.has(h)?u=!0:t.has(h)&&(1===a?u=!0:c=!0))}null!==Mp&&(Mp.has(e)||null!==r&&Mp.has(r))&&(u=!0),u&&(e._debugNeedsRemount=!0),(u||c)&&Ff(e,1,Tr),null===i||u||Op(i,t,n),null!==s&&Op(s,t,n)}var Up,Np=function(e,t){var n=new Set,r=new Set(t.map(function(e){return e.current}));return zp(e.current,r,n),n};function zp(e,t,n){var r=e.child,i=e.sibling,s=e.tag,a=e.type,o=null;switch(s){case 0:case y:case 1:o=a;break;case m:o=a.render}var l=!1;null!==o&&t.has(o)&&(l=!0),l?function(e,t){var n=function(e,t){var n=e,r=!1;for(;;){if(5===n.tag)r=!0,t.add(n.stateNode);else if(null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)return r;for(;null===n.sibling;){if(null===n.return||n.return===e)return r;n=n.return}n.sibling.return=n.return,n=n.sibling}return!1}(e,t);if(n)return;var r=e;for(;;){switch(r.tag){case 5:return void t.add(r.stateNode);case 4:case 3:return void t.add(r.stateNode.containerInfo)}if(null===r.return)throw new Error("Expected to reach root first.");r=r.return}}(e,n):null!==r&&zp(r,t,n),null!==i&&zp(i,t,n)}Up=!1;try{var Gp=Object.preventExtensions({});new Map([[Gp,null]]),new Set([Gp])}catch(e){Up=!0}function Qp(e,t,n,r){this.tag=e,this.key=n,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=t,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=r,this.flags=0,this.subtreeFlags=0,this.deletions=null,this.lanes=0,this.childLanes=0,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,Up||"function"!=typeof Object.preventExtensions||Object.preventExtensions(this)}var Hp=function(e,t,n,r){return new Qp(e,t,n,r)};function Vp(e){var t=e.prototype;return!(!t||!t.isReactComponent)}function jp(e,t){var n=e.alternate;null===n?((n=Hp(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n._debugSource=e._debugSource,n._debugOwner=e._debugOwner,n._debugHookTypes=e._debugHookTypes,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null,n.actualDuration=0,n.actualStartTime=-1),n.flags=e.flags&he,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue;var r=e.dependencies;switch(n.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.selfBaseDuration=e.selfBaseDuration,n.treeBaseDuration=e.treeBaseDuration,n._debugNeedsRemount=e._debugNeedsRemount,n.tag){case 2:case 0:case y:n.type=Rp(e.type);break;case 1:n.type=Bp(e.type);break;case m:n.type=Pp(e.type)}return n}function Wp(e,t){e.flags&=14680066;var n=e.alternate;if(null===n)e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null,e.selfBaseDuration=0,e.treeBaseDuration=0;else{e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type;var r=n.dependencies;e.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext},e.selfBaseDuration=n.selfBaseDuration,e.treeBaseDuration=n.treeBaseDuration}return e}function Yp(e,t,n,r,i,s){var a=2,o=e;if("function"==typeof e)Vp(e)?(a=1,o=Bp(o)):o=Rp(o);else if("string"==typeof e)a=5;else e:switch(e){case T:return qp(n.children,i,s,t);case M:a=8,1&(i|=8)&&(i|=Xn);break;case I:return function(e,t,n,r){"string"!=typeof e.id&&l('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof e.id);var i=Hp(g,e,r,2|t);return i.elementType=I,i.lanes=n,i.stateNode={effectDuration:0,passiveEffectDuration:0},i}(n,i,s,t);case D:return function(e,t,n,r){var i=Hp(A,e,r,t);return i.elementType=D,i.lanes=n,i}(n,i,s,t);case L:return function(e,t,n,r){var i=Hp(x,e,r,t);return i.elementType=L,i.lanes=n,i}(n,i,s,t);case O:return Xp(n,i,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case R:a=p;break e;case B:a=9;break e;case P:a=m,o=Pp(o);break e;case k:a=v;break e;case F:a=16,o=null;break e}var c="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(c+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var u=r?H(r):null;throw u&&(c+="\n\nCheck the render method of `"+u+"`."),new Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: "+(null==e?e:typeof e)+"."+c)}var h=Hp(a,n,t,i);return h.elementType=e,h.type=o,h.lanes=s,h._debugOwner=r,h}function Kp(e,t,n){var r;r=e._owner;var i=Yp(e.type,e.key,e.props,r,t,n);return i._debugSource=e._source,i._debugOwner=e._owner,i}function qp(e,t,n,r){var i=Hp(7,e,r,t);return i.lanes=n,i}function Xp(e,t,n,r){var i=Hp(b,e,r,t);i.elementType=O,i.lanes=n;return i.stateNode={},i}function $p(e,t,n){var r=Hp(6,e,null,t);return r.lanes=n,r}function Jp(e,t,n){var r=null!==e.children?e.children:[],i=Hp(4,r,e.key,t);return i.lanes=n,i.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},i}function Zp(e,t){return null===e&&(e=Hp(2,null,null,0)),e.tag=t.tag,e.key=t.key,e.elementType=t.elementType,e.type=t.type,e.stateNode=t.stateNode,e.return=t.return,e.child=t.child,e.sibling=t.sibling,e.index=t.index,e.ref=t.ref,e.pendingProps=t.pendingProps,e.memoizedProps=t.memoizedProps,e.updateQueue=t.updateQueue,e.memoizedState=t.memoizedState,e.dependencies=t.dependencies,e.mode=t.mode,e.flags=t.flags,e.subtreeFlags=t.subtreeFlags,e.deletions=t.deletions,e.lanes=t.lanes,e.childLanes=t.childLanes,e.alternate=t.alternate,e.actualDuration=t.actualDuration,e.actualStartTime=t.actualStartTime,e.selfBaseDuration=t.selfBaseDuration,e.treeBaseDuration=t.treeBaseDuration,e._debugSource=t._debugSource,e._debugOwner=t._debugOwner,e._debugNeedsRemount=t._debugNeedsRemount,e._debugHookTypes=t._debugHookTypes,e}function em(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=ke,this.context=null,this.pendingContext=null,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Yr(0),this.expirationTimes=Yr(Tr),this.pendingLanes=0,this.suspendedLanes=0,this.pingedLanes=0,this.expiredLanes=0,this.mutableReadLanes=0,this.finishedLanes=0,this.entangledLanes=0,this.entanglements=Yr(0),this.identifierPrefix=r,this.onRecoverableError=i,ze&&(this.mutableSourceEagerHydrationData=null),this.effectDuration=0,this.passiveEffectDuration=0,this.memoizedUpdaters=new Set;for(var s=this.pendingUpdatersLaneMap=[],a=0;a<31;a++)s.push(new Set);switch(t){case 1:this._debugRootType=n?"hydrateRoot()":"createRoot()";break;case 0:this._debugRootType=n?"hydrate()":"render()"}}function tm(e,t,n,r,i,s,a,o,l,c){var u=new em(e,t,n,o,l),h=function(e,t){var n;return 1===e?(n=1,!0===t&&(n|=8,n|=Xn)):n=0,_i&&(n|=2),Hp(3,null,null,n)}(t,s);u.current=h,h.stateNode=u;var d={element:r,isDehydrated:n,cache:null,transitions:null};return h.memoizedState=d,Hs(h),u}var nm,rm;function im(e){if(!e)return Ln;var t=h(e),n=qn(t);if(1===t.tag){var r=t.type;if(Qn(r))return Wn(t,r,n)}return n}function sm(e,t,n,r){!function(e,t){if(vi&&"function"==typeof vi.onScheduleFiberRoot)try{vi.onScheduleFiberRoot(Ai,e,t)}catch(e){Ei||(Ei=!0,l("React instrumentation encountered an error: %s",e))}}(t,e);var i=t.current,s=Df(),a=Lf(i);!function(e){null!==yi&&"function"==typeof yi.markRenderScheduled&&yi.markRenderScheduled(e)}(a);var o=im(n);null===t.context?t.context=o:t.pendingContext=o,ts&&null!==es&&!nm&&(nm=!0,l("Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.\n\nCheck the render method of %s.",H(es)||"Unknown"));var c=js(s,a);c.payload={element:e},null!==(r=void 0===r?null:r)&&("function"!=typeof r&&l("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",r),c.callback=r),Ws(i,c);var u=Ff(i,a,s);return null!==u&&Ys(u,i,a),a}function am(e,t){var n=e.memoizedState;null!==n&&null!==n.dehydrated&&(n.retryLane=function(e,t){return 0!==e&&e<t?e:t}(n.retryLane,t))}function om(e,t){am(e,t);var n=e.alternate;n&&am(n,t)}nm=!1,rm={};var lm=function(e){return null};function cm(e){return lm(e)}var um=function(e){return!1};function hm(e){return um(e)}var dm,fm,pm,mm,gm,Am,vm,ym,Em,_m=function(e,t,n){var r=t[n],i=_e(e)?e.slice():u({},e);return n+1===t.length?(_e(i)?i.splice(r,1):delete i[r],i):(i[r]=_m(e[r],t,n+1),i)},xm=function(e,t){return _m(e,t,0)},bm=function(e,t,n,r){var i=t[r],s=_e(e)?e.slice():u({},e);r+1===t.length?(s[n[r]]=s[i],_e(s)?s.splice(i,1):delete s[i]):s[i]=bm(e[i],t,n,r+1);return s},Sm=function(e,t,n){if(t.length===n.length){for(var r=0;r<n.length-1;r++)if(t[r]!==n[r])return void o("copyWithRename() expects paths to be the same except for the deepest key");return bm(e,t,n,0)}o("copyWithRename() expects paths of the same length")},wm=function(e,t,n,r){if(n>=t.length)return r;var i=t[n],s=_e(e)?e.slice():u({},e);return s[i]=wm(e[i],t,n+1,r),s},Cm=function(e,t,n){return wm(e,t,0,n)},Tm=function(e,t){for(var n=e.memoizedState;null!==n&&t>0;)n=n.next,t--;return n};function Mm(e){var t=ge(e);return null===t?null:t.stateNode}function Im(e){return null}function Rm(){return es}return dm=function(e,t,n,r){var i=Tm(e,t);if(null!==i){var s=Cm(i.memoizedState,n,r);i.memoizedState=s,i.baseState=s,e.memoizedProps=u({},e.memoizedProps),Ff(e,1,Tr)}},fm=function(e,t,n){var r=Tm(e,t);if(null!==r){var i=xm(r.memoizedState,n);r.memoizedState=i,r.baseState=i,e.memoizedProps=u({},e.memoizedProps),Ff(e,1,Tr)}},pm=function(e,t,n,r){var i=Tm(e,t);if(null!==i){var s=Sm(i.memoizedState,n,r);i.memoizedState=s,i.baseState=s,e.memoizedProps=u({},e.memoizedProps),Ff(e,1,Tr)}},mm=function(e,t,n){e.pendingProps=Cm(e.memoizedProps,t,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps),Ff(e,1,Tr)},gm=function(e,t){e.pendingProps=xm(e.memoizedProps,t),e.alternate&&(e.alternate.pendingProps=e.pendingProps),Ff(e,1,Tr)},Am=function(e,t,n){e.pendingProps=Sm(e.memoizedProps,t,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps),Ff(e,1,Tr)},vm=function(e){Ff(e,1,Tr)},ym=function(e){lm=e},Em=function(e){um=e},n.attemptContinuousHydration=function(e){if(e.tag===A){var t=Df(),n=_r;Ff(e,n,t),om(e,n)}},n.attemptHydrationAtCurrentPriority=function(e){if(e.tag===A){var t=Df(),n=Lf(e);Ff(e,n,t),om(e,n)}},n.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(Ki(t)){var n=function(e){return Rr(e.pendingLanes)}(t);!function(e,t){0!==t&&(Xr(e,Vr(t,1)),Nf(e,ui()),($d&(Qd|Hd))===Gd&&(mf(),Yi()))}(t,n)}break;case A:var r=Df();jf(function(){return Ff(e,1,r)});om(e,1)}},n.batchedUpdates=function(e,t){var n=$d;$d|=1;try{return e(t)}finally{($d=n)!==Gd||zd.isBatchingLegacy||(mf(),Wi())}},n.createComponentSelector=function(e){return{$$typeof:xd,value:e}},n.createContainer=function(e,t,n,r,i,s,a,o){return tm(e,t,!1,null,0,r,0,s,a)},n.createHasPseudoClassSelector=function(e){return{$$typeof:bd,value:e}},n.createHydrationContainer=function(e,t,n,r,i,s,a,o,l,c){var u=tm(n,r,!0,e,0,s,0,o,l);u.context=im(null);var h=u.current,d=Df(),f=Lf(h),p=js(d,f);return p.callback=null!=t?t:null,Ws(h,p),function(e,t,n){e.current.lanes=t,Kr(e,t,n),Nf(e,n)}(u,f,d),u},n.createPortal=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return function(e){if(vs(e))l("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",As(e)),ys(e)}(r),{$$typeof:C,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},n.createRoleSelector=function(e){return{$$typeof:Sd,value:e}},n.createTestNameSelector=function(e){return{$$typeof:wd,value:e}},n.createTextSelector=function(e){return{$$typeof:Cd,value:e}},n.deferredUpdates=function(e){var t=ni(),n=Nd.transition;try{return Nd.transition=null,ri(Zr),e()}finally{ri(t),Nd.transition=n}},n.discreteUpdates=function(e,t,n,r,i){var s=ni(),a=Nd.transition;try{return Nd.transition=null,ri(1),e(t,n,r,i)}finally{ri(s),Nd.transition=a,$d===Gd&&mf()}},n.findAllNodes=Pd,n.findBoundingRects=function(e,t){if(!Ye)throw new Error("Test selector API is not supported by this renderer.");for(var n=Pd(e,t),r=[],i=0;i<n.length;i++)r.push(qe(n[i]));for(var s=r.length-1;s>0;s--)for(var a=r[s],o=a.x,l=o+a.width,c=a.y,u=c+a.height,h=s-1;h>=0;h--)if(s!==h){var d=r[h],f=d.x,p=f+d.width,m=d.y,g=m+d.height;if(o>=f&&c>=m&&l<=p&&u<=g){r.splice(s,1);break}if(!(o!==f||a.width!==d.width||g<c||m>u)){m>c&&(d.height+=m-c,d.y=c),g<u&&(d.height=u-m),r.splice(s,1);break}if(!(c!==m||a.height!==d.height||p<o||f>l)){f>o&&(d.width+=f-o,d.x=o),p<l&&(d.width=l-f),r.splice(s,1);break}}return r},n.findHostInstance=function(e){var t=h(e);if(void 0===t){if("function"==typeof e.render)throw new Error("Unable to find node on an unmounted component.");var n=Object.keys(e).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+n)}var r=ge(t);return null===r?null:r.stateNode},n.findHostInstanceWithNoPortals=function(e){var t=ve(e);return null===t?null:t.stateNode},n.findHostInstanceWithWarning=function(e,t){var n=h(e);if(void 0===n){if("function"==typeof e.render)throw new Error("Unable to find node on an unmounted component.");var r=Object.keys(e).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+r)}var i=ge(n);if(null===i)return null;if(8&i.mode){var s=H(n)||"Component";if(!rm[s]){rm[s]=!0;var a=es;try{is(i),8&n.mode?l("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",t,t,s):l("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",t,t,s)}finally{a?is(a):rs()}}}return i.stateNode},n.flushControlled=function(e){var t=$d;$d|=1;var n=Nd.transition,r=ni();try{Nd.transition=null,ri(1),e()}finally{ri(r),Nd.transition=n,($d=t)===Gd&&(mf(),Yi())}},n.flushPassiveEffects=ap,n.flushSync=jf,n.focusWithin=function(e,t){if(!Ye)throw new Error("Test selector API is not supported by this renderer.");for(var n=Bd(Md(e),t),r=Array.from(n),i=0;i<r.length;){var s=r[i++];if(!$e(s)){if(5===s.tag){var a=s.stateNode;if(Ze(a))return!0}for(var o=s.child;null!==o;)r.push(o),o=o.sibling}}return!1},n.getCurrentUpdatePriority=ni,n.getFindAllNodesFailureDescription=function(e,t){if(!Ye)throw new Error("Test selector API is not supported by this renderer.");for(var n=0,r=[],i=[Md(e),0],s=0;s<i.length;){var a=i[s++],o=i[s++],l=t[o];if((5!==a.tag||!$e(a))&&(Id(a,l)&&(r.push(Rd(l)),++o>n&&(n=o)),o<t.length))for(var c=a.child;null!==c;)i.push(c,o),c=c.sibling}if(n<t.length){for(var u=[],h=n;h<t.length;h++)u.push(Rd(t[h]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+u.join(" > ")}return null},n.getPublicRootInstance=function(e){var t=e.current;return t.child?5===t.child.tag?xe(t.child.stateNode):t.child.stateNode:null},n.injectIntoDevTools=function(e){var t=e.findFiberByHostInstance,n=s.ReactCurrentDispatcher;return function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled)return!0;if(!t.supportsFiber)return l("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{e=u({},e,{getLaneLabelMap:Si,injectProfilingHooks:bi}),Ai=t.inject(e),vi=t}catch(e){l("React instrumentation encountered an error: %s.",e)}return!!t.checkDCE}({bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:dm,overrideHookStateDeletePath:fm,overrideHookStateRenamePath:pm,overrideProps:mm,overridePropsDeletePath:gm,overridePropsRenamePath:Am,setErrorHandler:ym,setSuspenseHandler:Em,scheduleUpdate:vm,currentDispatcherRef:n,findHostInstanceByFiber:Mm,findFiberByHostInstance:t||Im,findHostInstancesForRefresh:Np,scheduleRefresh:kp,scheduleRoot:Fp,setRefreshHandler:Ip,getCurrentFiber:Rm,reconcilerVersion:"18.0.0-fc46dba67-20220329"})},n.isAlreadyRendering=function(){return($d&(Qd|Hd))!==Gd},n.observeVisibleRects=function(e,t,n,r){if(!Ye)throw new Error("Test selector API is not supported by this renderer.");var i=Pd(e,t),s=et(i,n,r),a=s.disconnect,o=s.observe,l=s.unobserve,c=function(){var n=Pd(e,t);i.forEach(function(e){n.indexOf(e)<0&&l(e)}),n.forEach(function(e){i.indexOf(e)<0&&o(e)})};return Dd.push(c),{disconnect:function(){var e=Dd.indexOf(c);e>=0&&Dd.splice(e,1),a()}}},n.registerMutableSourceForHydration=function(e,t){var n=(0,t._getVersion)(t._source);null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},n.runWithPriority=function(e,t){var n=ti;try{return ti=e,t()}finally{ti=n}},n.shouldError=cm,n.shouldSuspend=hm,n.updateContainer=sm,n})),Rf.exports}var Pf,Df=Jd((If||(If=1,"production"===process.env.NODE_ENV?Af.exports=Tf():Af.exports=Bf()),Af.exports)),Lf={exports:{}},kf={};var Ff,Of,Uf={};function Nf(){return Ff||(Ff=1,e=Uf,"production"!==process.env.NODE_ENV&&function(){function t(e,t){var n=e.length;e.push(t),function(e,t,n){for(var r=n;r>0;){var s=r-1>>>1,a=e[s];if(!(i(a,t)>0))return;e[s]=t,e[r]=a,r=s}}(e,t,n)}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();return n!==t&&(e[0]=n,function(e,t,n){for(var r=n,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(i(l,t)<0)c<s&&i(u,l)<0?(e[r]=u,e[c]=t,r=c):(e[r]=l,e[o]=t,r=o);else{if(!(c<s&&i(u,t)<0))return;e[r]=u,e[c]=t,r=c}}}(e,n,0)),t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error),"object"==typeof performance&&"function"==typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,A="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))return;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function E(e){if(m=!1,y(e),!p)if(null!==n(l))p=!0,P(_);else{var t=n(c);null!==t&&D(E,t.startTime-e)}}function _(t,i){p=!1,m&&(m=!1,L()),f=!0;var s=d;try{return function(t,i){var s=i;for(y(s),h=n(l);null!==h&&(!(h.expirationTime>s)||t&&!T());){var a=h.callback;if("function"==typeof a){h.callback=null,d=h.priorityLevel;var o=a(h.expirationTime<=s);s=e.unstable_now(),"function"==typeof o?h.callback=o:h===n(l)&&r(l),y(s)}else r(l);h=n(l)}if(null!==h)return!0;var u=n(c);return null!==u&&D(E,u.startTime-s),!1}(t,i)}finally{h=null,d=s,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var x=!1,b=null,S=-1,w=5,C=-1;function T(){return!(e.unstable_now()-C<w)}var M,I=function(){if(null!==b){var t=e.unstable_now();C=t;var n=!0;try{n=b(!0,t)}finally{n?M():(x=!1,b=null)}}else x=!1};if("function"==typeof v)M=function(){v(I)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,B=R.port2;R.port1.onmessage=I,M=function(){B.postMessage(null)}}else M=function(){g(I,0)};function P(e){b=e,x||(x=!0,M())}function D(t,n){S=g(function(){t(e.unstable_now())},n)}function L(){A(S),S=-1}var k=function(){};e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,P(_))},e.unstable_forceFrameRate=function(e){e<0||e>125||(w=e>0?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){var t;switch(d){case 1:case 2:case 3:t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=k,e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},e.unstable_scheduleCallback=function(r,i,s){var a,o,h=e.unstable_now();if("object"==typeof s&&null!==s){var d=s.delay;a="number"==typeof d&&d>0?h+d:h}else a=h;switch(r){case 1:o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}var g=a+o,A={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:g,sortIndex:-1};return a>h?(A.sortIndex=a,t(c,A),null===n(l)&&A===n(c)&&(m?L():m=!0,D(E,a-h))):(A.sortIndex=g,t(l,A),p||f||(p=!0,P(_))),A},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()),Uf;var e}var zf=(Of||(Of=1,"production"===process.env.NODE_ENV?Lf.exports=(Pf||(Pf=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,s=e[r];if(!(0<i(s,t)))break e;e[r]=t,e[n]=s,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>i(l,n))c<s&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<s&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,A="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function E(e){if(m=!1,y(e),!p)if(null!==n(l))p=!0,P(_);else{var t=n(c);null!==t&&D(E,t.startTime-e)}}function _(t,i){p=!1,m&&(m=!1,A(w),w=-1),f=!0;var s=d;try{for(y(i),h=n(l);null!==h&&(!(h.expirationTime>i)||t&&!M());){var a=h.callback;if("function"==typeof a){h.callback=null,d=h.priorityLevel;var o=a(h.expirationTime<=i);i=e.unstable_now(),"function"==typeof o?h.callback=o:h===n(l)&&r(l),y(i)}else r(l);h=n(l)}if(null!==h)var u=!0;else{var g=n(c);null!==g&&D(E,g.startTime-i),u=!1}return u}finally{h=null,d=s,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var x,b=!1,S=null,w=-1,C=5,T=-1;function M(){return!(e.unstable_now()-T<C)}function I(){if(null!==S){var t=e.unstable_now();T=t;var n=!0;try{n=S(!0,t)}finally{n?x():(b=!1,S=null)}}else b=!1}if("function"==typeof v)x=function(){v(I)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,B=R.port2;R.port1.onmessage=I,x=function(){B.postMessage(null)}}else x=function(){g(I,0)};function P(e){S=e,b||(b=!0,x())}function D(t,n){w=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,P(_))},e.unstable_forceFrameRate=function(e){0>e||125<e||(C=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},e.unstable_scheduleCallback=function(r,i,s){var a=e.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,r){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(r.sortIndex=s,t(c,r),null===n(l)&&r===n(c)&&(m?(A(w),w=-1):m=!0,D(E,s-a))):(r.sortIndex=o,t(l,r),p||f||(p=!0,P(_))),r},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}}(kf)),kf):Lf.exports=Nf()),Lf.exports),Gf=Object.freeze({__proto__:null});const Qf={},Hf=e=>{Object.assign(Qf,e)};var Vf,jf;const Wf=e=>"colorSpace"in e||"outputColorSpace"in e,Yf=()=>{var e;return null!=(e=Qf.ColorManagement)?e:null},Kf=e=>e&&e.isOrthographicCamera,qf="undefined"!=typeof window&&(null!=(Vf=window.document)&&Vf.createElement||"ReactNative"===(null==(jf=window.navigator)?void 0:jf.product))?e.useLayoutEffect:e.useEffect;function Xf(t){const n=e.useRef(t);return qf(()=>{n.current=t},[t]),n}function $f({set:e}){return qf(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Jf extends e.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}Jf.getDerivedStateFromError=()=>({error:!0});const Zf="__default",ep=new Map,tp=e=>e&&!!e.memoized&&!!e.changes;function np(e){var t;const n="undefined"!=typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const rp=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function ip(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const sp={obj:e=>e===Object(e)&&!sp.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:i=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(sp.str(e)||sp.num(e)||sp.boo(e))return e===t;const s=sp.obj(e);if(s&&"reference"===r)return e===t;const a=sp.arr(e);if(a&&"reference"===n)return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&"shallow"===n&&"shallow"===r){for(o in i?t:e)if(!sp.equ(e[o],t[o],{strict:i,objects:"reference"}))return!1}else for(o in i?t:e)if(e[o]!==t[o])return!1;if(sp.und(o)){if(a&&0===e.length&&0===t.length)return!0;if(s&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function ap(e){const t={nodes:{},materials:{}};return e&&e.traverse(e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)}),t}function op(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}function lp(e,t){return e.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function cp(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),i=r.pop();return n=r.reduce((e,t)=>e[t],e),{target:n,key:i}}return{target:n,key:t}}const up=/-\d+$/;function hp(e,t,n){if(sp.str(n)){if(up.test(n)){const t=n.replace(up,""),{target:r,key:i}=cp(e,t);Array.isArray(r[i])||(r[i]=[])}const{target:r,key:i}=cp(e,n);t.__r3f.previousAttach=r[i],r[i]=t}else t.__r3f.previousAttach=n(e,t)}function dp(e,t,n){var r,i;if(sp.str(n)){const{target:r,key:i}=cp(e,n),s=t.__r3f.previousAttach;void 0===s?delete r[i]:r[i]=s}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(i=t.__r3f)||delete i.previousAttach}function fp(e,{children:t,key:n,ref:r,...i},{children:s,key:a,ref:o,...l}={},c=!1){const u=e.__r3f,h=Object.entries(i),d=[];if(c){const e=Object.keys(l);for(let t=0;t<e.length;t++)i.hasOwnProperty(e[t])||h.unshift([e[t],Zf+"remove"])}h.forEach(([t,n])=>{var r;if(null!=(r=e.__r3f)&&r.primitive&&"object"===t)return;if(sp.equ(n,l[t]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(t))return d.push([t,n,!0,[]]);let s=[];t.includes("-")&&(s=t.split("-")),d.push([t,n,!1,s]);for(const e in i){const n=i[e];e.startsWith(`${t}-`)&&d.push([e,n,!1,e.split("-")])}});const f={...i};return null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.args&&(f.args=u.memoizedProps.args),null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.attach&&(f.attach=u.memoizedProps.attach),{memoized:f,changes:d}}const pp="undefined"!=typeof process&&"production"!==process.env.NODE_ENV;function mp(e,t){var n;const r=e.__r3f,i=null==r?void 0:r.root,s=null==i||null==i.getState?void 0:i.getState(),{memoized:a,changes:o}=tp(t)?t:fp(e,t),l=null==r?void 0:r.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let t=0;t<o.length;t++){let[n,i,a,l]=o[t];if(Wf(e)){const e=3001,t="srgb",r="srgb-linear";"encoding"===n?(n="colorSpace",i=i===e?t:r):"outputEncoding"===n&&(n="outputColorSpace",i=i===e?t:r)}let h=e,d=h[n];if(l.length&&(d=l.reduce((e,t)=>e[t],e),!d||!d.set)){const[t,...r]=l.reverse();h=r.reverse().reduce((e,t)=>e[t],e),n=t}if(i===Zf+"remove")if(h.constructor){let e=ep.get(h.constructor);e||(e=new h.constructor,ep.set(h.constructor,e)),i=e[n]}else i=0;if(a&&r)i?r.handlers[n]=i:delete r.handlers[n],r.eventCount=Object.keys(r.handlers).length;else if(d&&d.set&&(d.copy||d instanceof Er)){if(Array.isArray(i))d.fromArray?d.fromArray(i):d.set(...i);else if(d.copy&&i&&i.constructor&&(pp?d.constructor.name===i.constructor.name:d.constructor===i.constructor))d.copy(i);else if(void 0!==i){var c;const e=null==(c=d)?void 0:c.isColor;!e&&d.setScalar?d.setScalar(i):d instanceof Er&&i instanceof Er?d.mask=i.mask:d.set(i),!Yf()&&s&&!s.linear&&e&&d.convertSRGBToLinear()}}else{var u;if(h[n]=i,null!=(u=h[n])&&u.isTexture&&h[n].format===ye&&h[n].type===le&&s){const e=h[n];Wf(e)&&Wf(s.gl)?e.colorSpace=s.gl.outputColorSpace:e.encoding=s.gl.outputEncoding}}gp(e)}if(r&&r.parent&&e.raycast&&l!==r.eventCount){const t=ip(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),r.eventCount&&t.interaction.push(e)}return!(1===o.length&&"onUpdate"===o[0][0])&&o.length&&null!=(n=e.__r3f)&&n.parent&&Ap(e),e}function gp(e){var t,n;const r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function Ap(e){null==e.onUpdate||e.onUpdate(e)}function vp(e,t){e.manual||(Kf(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function yp(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Ep(e,t,n,r){const i=n.get(t);i&&(n.delete(t),0===n.size&&(e.delete(r),i.target.releasePointerCapture(r)))}function _p(e){function t(e){return e.filter(e=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){const r=e.eventObject.__r3f,i=null==r?void 0:r.handlers;if(n.hovered.delete(yp(e)),null!=r&&r.eventCount){const n={...e,intersections:t};null==i.onPointerOut||i.onPointerOut(n),null==i.onPointerLeave||i.onPointerLeave(n)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))})}}return function(s){const{onPointerMissed:a,internal:o}=e.getState();o.lastEvent.current=s;const l="onPointerMove"===i,c="onClick"===i||"onContextMenu"===i||"onDoubleClick"===i,u=function(t,n){const r=e.getState(),i=new Set,s=[],a=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<a.length;e++){const t=rp(a[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let o=a.flatMap(function(e){const n=rp(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r}).sort((e,t)=>{const n=rp(e.object),r=rp(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance}).filter(e=>{const t=yp(e);return!i.has(t)&&(i.add(t),!0)});r.events.filter&&(o=r.events.filter(o,r));for(const e of o){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&s.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())i.has(yp(e.intersection))||s.push(e.intersection);return s}(s,l?t:void 0),h=c?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],i=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+i*i))}(s):0;"onPointerDown"===i&&(o.initialClick=[s.offsetX,s.offsetY],o.initialHits=u.map(e=>e.eventObject)),c&&!u.length&&h<=2&&(r(s,o.interaction),a&&a(s)),l&&n(u),function(t,r,i,s){const a=e.getState();if(t.length){const e={stopped:!1};for(const o of t){const l=rp(o.object)||a,{raycaster:c,pointer:u,camera:h,internal:d}=l,f=new Dn(u.x,u.y,0).unproject(h),p=e=>{var t,n;return null!=(t=null==(n=d.capturedMap.get(e))?void 0:n.has(o.eventObject))&&t},m=e=>{const t={intersection:o,target:r.target};d.capturedMap.has(e)?d.capturedMap.get(e).set(o.eventObject,t):d.capturedMap.set(e,new Map([[o.eventObject,t]])),r.target.setPointerCapture(e)},g=e=>{const t=d.capturedMap.get(e);t&&Ep(d.capturedMap,o.eventObject,t,e)};let A={};for(let e in r){let t=r[e];"function"!=typeof t&&(A[e]=t)}let v={...o,...A,pointer:u,intersections:t,stopped:e.stopped,delta:i,unprojectedPoint:f,ray:c.ray,camera:h,stopPropagation(){const i="pointerId"in r&&d.capturedMap.get(r.pointerId);(!i||i.has(o.eventObject))&&(v.stopped=e.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(e=>e.eventObject===o.eventObject))&&n([...t.slice(0,t.indexOf(o)),o])},target:{hasPointerCapture:p,setPointerCapture:m,releasePointerCapture:g},currentTarget:{hasPointerCapture:p,setPointerCapture:m,releasePointerCapture:g},nativeEvent:r};if(s(v),!0===e.stopped)break}}}(u,s,h,function(e){const t=e.eventObject,n=t.__r3f,a=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(a.onPointerOver||a.onPointerEnter||a.onPointerOut||a.onPointerLeave){const t=yp(e),n=o.hovered.get(t);n?n.stopped&&e.stopPropagation():(o.hovered.set(t,e),null==a.onPointerOver||a.onPointerOver(e),null==a.onPointerEnter||a.onPointerEnter(e))}null==a.onPointerMove||a.onPointerMove(e)}else{const n=a[i];n?c&&!o.initialHits.includes(t)||(r(s,o.interaction.filter(e=>!o.initialHits.includes(e))),n(e)):c&&o.initialHits.includes(t)&&r(s,o.interaction.filter(e=>!o.initialHits.includes(e)))}})}}}}const xp=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],bp=e=>!(null==e||!e.render),Sp=e.createContext(null);function wp(e,t){const n={callback:e};return t.add(n),()=>{t.delete(n)}}let Cp,Tp=new Set,Mp=new Set,Ip=new Set;const Rp=e=>wp(e,Tp),Bp=e=>wp(e,Mp),Pp=e=>wp(e,Ip);function Dp(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function Lp(e,t){switch(e){case"before":return Dp(Tp,t);case"after":return Dp(Mp,t);case"tail":return Dp(Ip,t)}}let kp,Fp;function Op(e,t,n){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"==typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),kp=t.internal.subscribers,Cp=0;Cp<kp.length;Cp++)Fp=kp[Cp],Fp.ref.current(Fp.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function Up(t){const n=e.useRef(null);return qf(()=>{n.current=t.current.__r3f},[t]),n}function Np(){const t=e.useContext(Sp);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function zp(e=e=>e,t){return Np()(e,t)}function Gp(e,t=0){const n=Np(),r=n.getState().internal.subscribe,i=Xf(e);return qf(()=>r(i,t,n),[t,r,n]),null}function Qp(t){return e.useMemo(()=>ap(t),[t])}const Hp=new WeakMap;function Vp(e,t){return function(n,...r){let i=Hp.get(n);return i||(i=new n,Hp.set(n,i)),e&&e(i),Promise.all(r.map(e=>new Promise((n,r)=>i.load(e,e=>{e.scene&&Object.assign(e,ap(e.scene)),n(e)},t,t=>r(new Error(`Could not load ${e}: ${null==t?void 0:t.message}`))))))}}function jp(e,t,n,r){const i=Array.isArray(t)?t:[t],s=ff(Vp(n,r),[e,...i],{equal:sp.equ});return Array.isArray(t)?s:s[0]}jp.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return pf(Vp(n),[e,...r])},jp.clear=function(e,t){const n=Array.isArray(t)?t:[t];return mf([e,...n])};const Wp=new Map,{invalidate:Yp,advance:Kp}=function(e){let t,n,r,i=!1,s=!1;function a(o){n=requestAnimationFrame(a),i=!0,t=0,Lp("before",o),s=!0;for(const n of e.values()){var l;r=n.store.getState(),!r.internal.active||!("always"===r.frameloop||r.internal.frames>0)||null!=(l=r.gl.xr)&&l.isPresenting||(t+=Op(o,r))}if(s=!1,Lp("after",o),0===t)return Lp("tail",o),i=!1,cancelAnimationFrame(n)}return{loop:a,invalidate:function t(n,r=1){var o;if(!n)return e.forEach(e=>t(e.store.getState(),r));null!=(o=n.gl.xr)&&o.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=r>1?Math.min(60,n.internal.frames+r):s?2:1,i||(i=!0,requestAnimationFrame(a)))},advance:function(t,n=!0,r,i){if(n&&Lp("before",t),r)Op(t,r,i);else for(const n of e.values())Op(t,n.store.getState());n&&Lp("after",t)}}}(Wp),{reconciler:qp,applyProps:Xp}=function(e,t){function n(e,{args:t=[],attach:n,...r},i){let s,a=`${e[0].toUpperCase()}${e.slice(1)}`;if("primitive"===e){if(void 0===r.object)throw new Error("R3F: Primitives without 'object' are invalid!");s=lp(r.object,{type:e,root:i,attach:n,primitive:!0})}else{const r=Qf[a];if(!r)throw new Error(`R3F: ${a} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(t))throw new Error("R3F: The args prop must be an array!");s=lp(new r(...t),{type:e,root:i,attach:n,memoizedProps:{args:t}})}return void 0===s.__r3f.attach&&(s.isBufferGeometry?s.__r3f.attach="geometry":s.isMaterial&&(s.__r3f.attach="material")),"inject"!==a&&mp(s,r),s}function r(e,t){let n=!1;var r,i;t&&(null!=(r=t.__r3f)&&r.attach?hp(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||lp(t,{}),t.__r3f.parent=e,Ap(t),gp(t))}function i(e,t,n){let r=!1;if(t){var i,s;if(null!=(i=t.__r3f)&&i.attach)hp(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const i=e.children.filter(e=>e!==t),s=i.indexOf(n);e.children=[...i.slice(0,s),t,...i.slice(s)],r=!0}r||null==(s=e.__r3f)||s.objects.push(t),t.__r3f||lp(t,{}),t.__r3f.parent=e,Ap(t),gp(t)}}function s(e,t,n=!1){e&&[...e].forEach(e=>a(t,e,n))}function a(e,t,n){if(t){var r,i,a;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter(e=>e!==t)),null!=(i=t.__r3f)&&i.attach)dp(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var o;e.remove(t),null!=(o=t.__r3f)&&o.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(e=>e!==t),n.initialHits=n.initialHits.filter(e=>e!==t),n.hovered.forEach((e,r)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(r)}),n.capturedMap.forEach((e,r)=>{Ep(n.capturedMap,t,e,r)})}(ip(t),t)}const c=null==(a=t.__r3f)?void 0:a.primitive,u=!c&&(void 0===n?null!==t.dispose:n);var l;if(!c)s(null==(l=t.__r3f)?void 0:l.objects,t,u),s(t.children,t,u);if(delete t.__r3f,u&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch(e){}};"undefined"==typeof IS_REACT_ACT_ENVIRONMENT?zf.unstable_scheduleCallback(zf.unstable_IdlePriority,e):e()}gp(e)}}const o=()=>{},l=Df({createInstance:n,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:i,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))},removeChildFromContainer:(e,t)=>{t&&a(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const r=e.getState().scene;r.__r3f&&i(r,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate(e,t,n,r){var i;if((null!=(i=null==e?void 0:e.__r3f)?i:{}).primitive&&r.object&&r.object!==e)return[!0];{const{args:t=[],children:i,...s}=r,{args:a=[],children:o,...l}=n;if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some((e,t)=>e!==a[t]))return[!0];const c=fp(e,s,l,!0);return c.changes.length?[!1,c]:null}},commitUpdate(e,[t,i],s,o,l,c){t?function(e,t,i,s){var o;const l=null==(o=e.__r3f)?void 0:o.parent;if(!l)return;const c=n(t,i,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&r(c,t);e.children=e.children.filter(e=>!e.__r3f)}e.__r3f.objects.forEach(e=>r(c,e)),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||a(l,e),c.parent&&(c.__r3f.autoRemovedBeforeAppend=!0),r(l,c),c.raycast&&c.__r3f.eventCount&&ip(c).getState().internal.interaction.push(c);[s,s.alternate].forEach(e=>{null!==e&&(e.stateNode=c,e.ref&&("function"==typeof e.ref?e.ref(c):e.ref.current=c))})}(e,s,l,c):mp(e,i)},commitMount(e,t,n,r){var i;const s=null!=(i=e.__r3f)?i:{};e.raycast&&s.handlers&&s.eventCount&&ip(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>lp(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:r}=null!=(t=e.__r3f)?t:{};n&&r&&dp(r,e,n),e.isObject3D&&(e.visible=!1),gp(e)},unhideInstance(e,t){var n;const{attach:r,parent:i}=null!=(n=e.__r3f)?n:{};r&&i&&hp(i,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),gp(e)},createTextInstance:o,hideTextInstance:o,unhideTextInstance:o,getCurrentEventPriority:()=>t?t():af.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!=typeof performance&&sp.fun(performance.now)?performance.now:sp.fun(Date.now)?Date.now:()=>0,scheduleTimeout:sp.fun(setTimeout)?setTimeout:void 0,cancelTimeout:sp.fun(clearTimeout)?clearTimeout:void 0});return{reconciler:l,applyProps:mp}}(0,function(){var e;const t="undefined"!=typeof self&&self||"undefined"!=typeof window&&window;if(!t)return af.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return af.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return af.ContinuousEventPriority;default:return af.DefaultEventPriority}}),$p={objects:"shallow",strict:!1},Jp=(e,t)=>{const n="function"==typeof e?e(t):e;return bp(n)?n:new Go({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Zp(t){const n=Wp.get(t),r=null==n?void 0:n.fiber,i=null==n?void 0:n.store,s="function"==typeof reportError?reportError:console.error,a=i||((t,n)=>{const r=cf((r,i)=>{const s=new Dn,a=new Dn,o=new Dn;function l(e=i().camera,t=a,n=i().size){const{width:r,height:l,top:c,left:u}=n,h=r/l;t.isVector3?o.copy(t):o.set(...t);const d=e.getWorldPosition(s).distanceTo(o);if(Kf(e))return{width:r/e.zoom,height:l/e.zoom,top:c,left:u,factor:1,distance:d,aspect:h};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*d,i=n*(r/l);return{width:i,height:n,top:c,left:u,factor:r/i,distance:d,aspect:h}}}let c;const u=e=>r(t=>({performance:{...t.performance,current:e}})),h=new nn,d={set:r,get:i,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(e=1)=>t(i(),e),advance:(e,t)=>n(e,t,i()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Kh,pointer:h,mouse:h,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=i();c&&clearTimeout(c),e.performance.current!==e.performance.min&&u(e.performance.min),c=setTimeout(()=>u(i().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:e=>r(t=>({...t,events:{...t.events,...e}})),setSize:(e,t,n,s,o)=>{const c=i().camera,u={width:e,height:t,top:s||0,left:o||0,updateStyle:n};r(e=>({size:u,viewport:{...e.viewport,...l(c,a,u)}}))},setDpr:e=>r(t=>{const n=np(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}}),setFrameloop:(e="always")=>{const t=i().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),r(()=>({frameloop:e}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:e.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const r=i().internal;return r.priority=r.priority+(t>0?1:0),r.subscribers.push({ref:e,priority:t,store:n}),r.subscribers=r.subscribers.sort((e,t)=>e.priority-t.priority),()=>{const n=i().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter(t=>t.ref!==e))}}}};return d}),i=r.getState();let s=i.size,a=i.viewport.dpr,o=i.camera;return r.subscribe(()=>{const{camera:e,size:t,viewport:n,gl:i,set:l}=r.getState();if(t.width!==s.width||t.height!==s.height||n.dpr!==a){var c;s=t,a=n.dpr,vp(e,t),i.setPixelRatio(n.dpr);const r=null!=(c=t.updateStyle)?c:"undefined"!=typeof HTMLCanvasElement&&i.domElement instanceof HTMLCanvasElement;i.setSize(t.width,t.height,r)}e!==o&&(o=e,l(t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}})))}),r.subscribe(e=>t(e)),r})(Yp,Kp),o=r||qp.createContainer(a,af.ConcurrentRoot,null,!1,null,"",s,null);let l;n||Wp.set(t,{fiber:o,store:a});let c,u=!1;return{configure(e={}){let{gl:n,size:r,scene:i,events:s,onCreated:o,shadows:h=!1,linear:d=!1,flat:f=!1,legacy:p=!1,orthographic:m=!1,frameloop:g="always",dpr:A=[1,2],performance:v,raycaster:y,camera:E,onPointerMissed:_}=e,x=a.getState(),b=x.gl;x.gl||x.set({gl:b=Jp(n,t)});let S=x.raycaster;S||x.set({raycaster:S=new Ed});const{params:w,...C}=y||{};if(sp.equ(C,S,$p)||Xp(S,{...C}),sp.equ(w,S.params,$p)||Xp(S,{params:{...S.params,...w}}),!x.camera||x.camera===c&&!sp.equ(c,E,$p)){c=E;const e=E instanceof Wi,t=e?E:m?new vs(0,0,0,0,.1,1e3):new Yi(75,0,.1,1e3);e||(t.position.z=5,E&&(Xp(t,E),("aspect"in E||"left"in E||"right"in E||"bottom"in E||"top"in E)&&(t.manual=!0,t.updateProjectionMatrix())),x.camera||null!=E&&E.rotation||t.lookAt(0,0,0)),x.set({camera:t}),S.camera=t}if(!x.scene){let e;null!=i&&i.isScene?e=i:(e=new jo,i&&Xp(e,i)),x.set({scene:lp(e)})}if(!x.xr){var T;const e=(e,t)=>{const n=a.getState();"never"!==n.frameloop&&Kp(e,!0,n,t)},t=()=>{const t=a.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||Yp(t)},n={connect(){const e=a.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=a.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(T=b.xr)?void 0:T.addEventListener)&&n.connect(),x.set({xr:n})}if(b.shadowMap){const e=b.shadowMap.enabled,t=b.shadowMap.type;if(b.shadowMap.enabled=!!h,sp.boo(h))b.shadowMap.type=2;else if(sp.str(h)){var M;const e={basic:0,percentage:1,soft:2,variance:3};b.shadowMap.type=null!=(M=e[h])?M:2}else sp.obj(h)&&Object.assign(b.shadowMap,h);e===b.shadowMap.enabled&&t===b.shadowMap.type||(b.shadowMap.needsUpdate=!0)}const I=Yf();if(I&&("enabled"in I?I.enabled=!p:"legacyMode"in I&&(I.legacyMode=p)),!u){Xp(b,{outputEncoding:d?3e3:3001,toneMapping:f?0:4})}x.legacy!==p&&x.set(()=>({legacy:p})),x.linear!==d&&x.set(()=>({linear:d})),x.flat!==f&&x.set(()=>({flat:f})),!n||sp.fun(n)||bp(n)||sp.equ(n,b,$p)||Xp(b,n),s&&!x.events.handlers&&x.set({events:s(a)});const R=function(e,t){const n="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:r,top:i,left:s,updateStyle:a=n}=t;return{width:e,height:r,top:i,left:s,updateStyle:a}}if("undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:r,top:i,left:s}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:i,left:s,updateStyle:n}}return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(t,r);return sp.equ(R,x.size,$p)||x.setSize(R.width,R.height,R.updateStyle,R.top,R.left),A&&x.viewport.dpr!==np(A)&&x.setDpr(A),x.frameloop!==g&&x.setFrameloop(g),x.onPointerMissed||x.set({onPointerMissed:_}),v&&!sp.equ(v,x.performance,$p)&&x.set(e=>({performance:{...e.performance,...v}})),l=o,u=!0,this},render(e){return u||this.configure(),qp.updateContainer(A(tm,{store:a,children:e,onCreated:l,rootElement:t}),o,null,()=>{}),a},unmount(){nm(t)}}}function em(e,t,n){const r=Zp(t);return r.configure(n),r.render(e)}function tm({store:e,children:t,onCreated:n,rootElement:r}){return qf(()=>{const t=e.getState();t.set(e=>({internal:{...e.internal,active:!0}})),n&&n(t),e.getState().events.connected||null==t.events.connect||t.events.connect(r)},[]),A(Sp.Provider,{value:e,children:t})}function nm(e,t){const n=Wp.get(e),r=null==n?void 0:n.fiber;if(r){const i=null==n?void 0:n.store.getState();i&&(i.internal.active=!1),qp.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var n,r,s,a;null==i.events.disconnect||i.events.disconnect(),null==(n=i.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(s=i.gl)||null==s.forceContextLoss||s.forceContextLoss(),null!=(a=i.gl)&&a.xr&&i.xr.disconnect(),op(i),Wp.delete(e),t&&t(e)}catch(e){}},500)})}}function rm(e,t,n){return A(im,{children:e,container:t,state:n},t.uuid)}function im({state:t={},children:n,container:r}){const{events:i,size:s,...a}=t,o=Np(),[l]=e.useState(()=>new Ed),[c]=e.useState(()=>new nn),u=e.useCallback((e,t)=>{const n={...e};let u;if(Object.keys(e).forEach(r=>{(xp.includes(r)||e[r]!==t[r]&&t[r])&&delete n[r]}),t&&s){const n=t.camera;u=e.viewport.getCurrentViewport(n,new Dn,s),n!==e.camera&&vp(n,s)}return{...n,scene:r,raycaster:l,pointer:c,mouse:c,previousRoot:o,events:{...e.events,...null==t?void 0:t.events,...i},size:{...e.size,...s},viewport:{...e.viewport,...u},...a}},[t]),[h]=e.useState(()=>{const e=o.getState(),t=cf((t,n)=>({...e,scene:r,raycaster:l,pointer:c,mouse:c,previousRoot:o,events:{...e.events,...i},size:{...e.size,...s},...a,set:t,get:n,setEvents:e=>t(t=>({...t,events:{...t.events,...e}}))}));return t});return e.useEffect(()=>{const e=o.subscribe(e=>h.setState(t=>u(e,t)));return()=>{e()}},[u]),e.useEffect(()=>{h.setState(e=>u(o.getState(),e))},[u]),e.useEffect(()=>()=>{h.destroy()},[]),A(v,{children:qp.createPortal(A(Sp.Provider,{value:h,children:n}),h,null)})}function sm(e){return qp.flushSync(e,void 0)}qp.injectIntoDevTools({bundleType:"production"===process.env.NODE_ENV?0:1,rendererPackageName:"@react-three/fiber",version:e.version});const am=e.unstable_act,om={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function lm(e){const{handlePointer:t}=_p(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(om).reduce((e,n)=>({...e,[n]:t(n)}),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:i}=e.getState();null==i.disconnect||i.disconnect(),r(e=>({events:{...e.events,connected:t}})),Object.entries(null!=(n=i.handlers)?n:[]).forEach(([e,n])=>{const[r,i]=om[e];t.addEventListener(r,n,{passive:i})})},disconnect:()=>{const{set:t,events:n}=e.getState();var r;n.connected&&(Object.entries(null!=(r=n.handlers)?r:[]).forEach(([e,t])=>{if(n&&n.connected instanceof HTMLElement){const[r]=om[e];n.connected.removeEventListener(r,t)}}),t(e=>({events:{...e.events,connected:void 0}})))}}}function cm(e,t){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout(()=>e(...r),t)}}function um({debounce:e,scroll:t,polyfill:n,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const a=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[c,u]=o({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),h=r({element:null,scrollContainers:null,resizeObserver:null,lastBounds:c,orientationHandler:null}),d=e?"number"==typeof e?e:e.scroll:null,f=e?"number"==typeof e?e:e.resize:null,p=r(!1);s(()=>(p.current=!0,()=>{p.current=!1}));const[m,g,A]=l(()=>{const e=()=>{if(!h.current.element)return;const{left:e,top:t,width:n,height:r,bottom:s,right:a,x:o,y:l}=h.current.element.getBoundingClientRect(),c={left:e,top:t,width:n,height:r,bottom:s,right:a,x:o,y:l};h.current.element instanceof HTMLElement&&i&&(c.height=h.current.element.offsetHeight,c.width=h.current.element.offsetWidth),Object.freeze(c),p.current&&!fm(h.current.lastBounds,c)&&u(h.current.lastBounds=c)};return[e,f?cm(e,f):e,d?cm(e,d):e]},[u,i,d,f]);function v(){h.current.scrollContainers&&(h.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",A,!0)),h.current.scrollContainers=null),h.current.resizeObserver&&(h.current.resizeObserver.disconnect(),h.current.resizeObserver=null),h.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",h.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",h.current.orientationHandler))}function y(){h.current.element&&(h.current.resizeObserver=new a(A),h.current.resizeObserver.observe(h.current.element),t&&h.current.scrollContainers&&h.current.scrollContainers.forEach(e=>e.addEventListener("scroll",A,{capture:!0,passive:!0})),h.current.orientationHandler=()=>{A()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",h.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",h.current.orientationHandler))}return function(e,t){s(()=>{if(t){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[e,t])}(A,!!t),function(e){s(()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e])}(g),s(()=>{v(),y()},[t,A,g]),s(()=>v,[]),[e=>{!e||e===h.current.element||(v(),h.current.element=e,h.current.scrollContainers=hm(e),y())},c,m]}function hm(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(e);return[n,r,i].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...hm(e.parentElement)]}const dm=["x","y","top","bottom","left","right","width","height"],fm=(e,t)=>dm.every(n=>e[n]===t[n]);var pm,mm,gm=Object.defineProperty,Am=Object.defineProperties,vm=Object.getOwnPropertyDescriptors,ym=Object.getOwnPropertySymbols,Em=Object.prototype.hasOwnProperty,_m=Object.prototype.propertyIsEnumerable,xm=(e,t,n)=>t in e?gm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bm=(e,t)=>{for(var n in t||(t={}))Em.call(t,n)&&xm(e,n,t[n]);if(ym)for(var n of ym(t))_m.call(t,n)&&xm(e,n,t[n]);return e};function Sm(e,t,n){if(!e)return;if(!0===n(e))return e;let r=t?e.return:e.child;for(;r;){const e=Sm(r,t,n);if(e)return e;r=t?null:r.sibling}}function wm(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(t){return e}}"undefined"==typeof window||!(null==(pm=window.document)?void 0:pm.createElement)&&"ReactNative"!==(null==(mm=window.navigator)?void 0:mm.product)?e.useEffect:e.useLayoutEffect;const Cm=console.error;console.error=function(){const e=[...arguments].join("");if(!(null==e?void 0:e.startsWith("Warning:"))||!e.includes("useContext"))return Cm.apply(this,arguments);console.error=Cm};const Tm=wm(e.createContext(null));class Mm extends e.Component{render(){return e.createElement(Tm.Provider,{value:this._reactInternals},this.props.children)}}function Im(){const t=function(){const t=e.useContext(Tm);if(null===t)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const n=e.useId();return e.useMemo(()=>{for(const e of[t,null==t?void 0:t.alternate]){if(!e)continue;const t=Sm(e,!1,e=>{let t=e.memoizedState;for(;t;){if(t.memoizedState===n)return!0;t=t.next}});if(t)return t}},[t,n])}(),[n]=e.useState(()=>new Map);n.clear();let r=t;for(;r;){if(r.type&&"object"==typeof r.type){const t=void 0===r.type._context&&r.type.Provider===r.type?r.type:r.type._context;t&&t!==Tm&&!n.has(t)&&n.set(t,e.useContext(wm(t)))}r=r.return}return n}function Rm(){const t=Im();return e.useMemo(()=>Array.from(t.keys()).reduce((n,r)=>i=>e.createElement(n,null,e.createElement(r.Provider,((e,t)=>Am(e,vm(t)))(bm({},i),{value:t.get(r)}))),t=>e.createElement(Mm,bm({},t))),[t])}const Bm=e.forwardRef(function({children:t,fallback:n,resize:r,style:i,gl:s,events:a=lm,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:m,performance:g,raycaster:v,camera:y,scene:E,onPointerMissed:_,onCreated:x,...b},S){e.useMemo(()=>Hf($d),[]);const w=Rm(),[C,T]=um({scroll:!0,debounce:{scroll:50,resize:0},...r}),M=e.useRef(null),I=e.useRef(null);e.useImperativeHandle(S,()=>M.current);const R=Xf(_),[B,P]=e.useState(!1),[D,L]=e.useState(!1);if(B)throw B;if(D)throw D;const k=e.useRef(null);qf(()=>{const n=M.current;T.width>0&&T.height>0&&n&&(k.current||(k.current=Zp(n)),k.current.configure({gl:s,events:a,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:m,performance:g,raycaster:v,camera:y,scene:E,size:T,onPointerMissed:(...e)=>null==R.current?void 0:R.current(...e),onCreated:e=>{var t;null==e.events.connect||e.events.connect(o?(t=o)&&t.hasOwnProperty("current")?o.current:o:I.current),l&&e.setEvents({compute:(e,t)=>{const n=e[l+"X"],r=e[l+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==x||x(e)}}),k.current.render(A(w,{children:A(Jf,{set:L,children:A(e.Suspense,{fallback:A($f,{set:P}),children:null!=t?t:null})})})))}),e.useEffect(()=>{const e=M.current;if(e)return()=>nm(e)},[]);return A("div",{ref:I,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:o?"none":"auto",...i},...b,children:A("div",{ref:C,style:{width:"100%",height:"100%"},children:A("canvas",{ref:M,style:{display:"block"},children:n})})})}),Pm=e.forwardRef(function(e,t){return A(Mm,{children:A(Bm,{...e,ref:t})})});var Dm=Object.freeze({__proto__:null,Canvas:Pm,ReactThreeFiber:Gf,_roots:Wp,act:am,addAfterEffect:Bp,addEffect:Rp,addTail:Pp,advance:Kp,applyProps:Xp,buildGraph:ap,context:Sp,createEvents:_p,createPointerEvents:lm,createPortal:rm,createRoot:Zp,dispose:op,events:lm,extend:Hf,flushGlobalEffects:Lp,flushSync:sm,getRootState:rp,invalidate:Yp,reconciler:qp,render:em,unmountComponentAtNode:nm,useFrame:Gp,useGraph:Qp,useInstanceHandle:Up,useLoader:jp,useStore:Np,useThree:zp});function Lm(){return Lm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Lm.apply(null,arguments)}var km,Fm={};var Om=function(){if(km)return Fm;km=1;var e=y;if("production"===process.env.NODE_ENV)Fm.createRoot=e.createRoot,Fm.hydrateRoot=e.hydrateRoot;else{var t=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;Fm.createRoot=function(n,r){t.usingClientEntryPoint=!0;try{return e.createRoot(n,r)}finally{t.usingClientEntryPoint=!1}},Fm.hydrateRoot=function(n,r,i){t.usingClientEntryPoint=!0;try{return e.hydrateRoot(n,r,i)}finally{t.usingClientEntryPoint=!1}}}return Fm}();const Um=new Dn,Nm=new Dn,zm=new Dn,Gm=new nn;function Qm(e,t,n){const r=Um.setFromMatrixPosition(e.matrixWorld);r.project(t);const i=n.width/2,s=n.height/2;return[r.x*i+i,-r.y*s+s]}const Hm=e=>Math.abs(e)<1e-10?0:e;function Vm(e,t,n=""){let r="matrix3d(";for(let n=0;16!==n;n++)r+=Hm(t[n]*e.elements[n])+(15!==n?",":")");return n+r}const jm=(Wm=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>Vm(e,Wm));var Wm;const Ym=(e,t)=>Vm(e,(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1])(t),"translate(-50%,-50%)");const Km=e.forwardRef(({children:t,eps:n=.001,style:r,className:i,prepend:s,center:a,fullscreen:o,portal:l,distanceFactor:c,sprite:u=!1,transform:h=!1,occlude:d,onOcclude:f,castShadow:p,receiveShadow:m,material:g,geometry:A,zIndexRange:v=[16777271,0],calculatePosition:y=Qm,as:E="div",wrapperClass:_,pointerEvents:x="auto",...b},S)=>{const{gl:w,camera:C,scene:T,size:M,raycaster:I,events:R,viewport:B}=zp(),[P]=e.useState(()=>document.createElement(E)),D=e.useRef(),L=e.useRef(null),k=e.useRef(0),F=e.useRef([0,0]),O=e.useRef(null),U=e.useRef(null),N=(null==l?void 0:l.current)||R.connected||w.domElement.parentNode,z=e.useRef(null),G=e.useRef(!1),Q=e.useMemo(()=>d&&"blending"!==d||Array.isArray(d)&&d.length&&function(e){return e&&"object"==typeof e&&"current"in e}(d[0]),[d]);e.useLayoutEffect(()=>{const e=w.domElement;d&&"blending"===d?(e.style.zIndex=`${Math.floor(v[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)},[d]),e.useLayoutEffect(()=>{if(L.current){const e=D.current=Om.createRoot(P);if(T.updateMatrixWorld(),h)P.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=y(L.current,C,M);P.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return N&&(s?N.prepend(P):N.appendChild(P)),()=>{N&&N.removeChild(P),e.unmount()}}},[N,h]),e.useLayoutEffect(()=>{_&&(P.className=_)},[_]);const H=e.useMemo(()=>h?{position:"absolute",top:0,left:0,width:M.width,height:M.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...o&&{top:-M.height/2,left:-M.width/2,width:M.width,height:M.height},...r},[r,a,o,M,h]),V=e.useMemo(()=>({position:"absolute",pointerEvents:x}),[x]);e.useLayoutEffect(()=>{var n,s;(G.current=!1,h)?null==(n=D.current)||n.render(e.createElement("div",{ref:O,style:H},e.createElement("div",{ref:U,style:V},e.createElement("div",{ref:S,className:i,style:r,children:t})))):null==(s=D.current)||s.render(e.createElement("div",{ref:S,style:H,className:i,children:t}))});const j=e.useRef(!0);Gp(e=>{if(L.current){C.updateMatrixWorld(),L.current.updateWorldMatrix(!0,!1);const e=h?F.current:y(L.current,C,M);if(h||Math.abs(k.current-C.zoom)>n||Math.abs(F.current[0]-e[0])>n||Math.abs(F.current[1]-e[1])>n){const t=function(e,t){const n=Um.setFromMatrixPosition(e.matrixWorld),r=Nm.setFromMatrixPosition(t.matrixWorld),i=n.sub(r),s=t.getWorldDirection(zm);return i.angleTo(s)>Math.PI/2}(L.current,C);let n=!1;Q&&(Array.isArray(d)?n=d.map(e=>e.current):"blending"!==d&&(n=[T]));const r=j.current;if(n){const e=function(e,t,n,r){const i=Um.setFromMatrixPosition(e.matrixWorld),s=i.clone();s.project(t),Gm.set(s.x,s.y),n.setFromCamera(Gm,t);const a=n.intersectObjects(r,!0);if(a.length){const e=a[0].distance;return i.distanceTo(n.ray.origin)<e}return!0}(L.current,C,I,n);j.current=e&&!t}else j.current=!t;r!==j.current&&(f?f(!j.current):P.style.display=j.current?"block":"none");const i=Math.floor(v[0]/2),s=d?Q?[v[0],i]:[i-1,0]:v;if(P.style.zIndex=`${function(e,t,n){if(t instanceof Yi||t instanceof vs){const r=Um.setFromMatrixPosition(e.matrixWorld),i=Nm.setFromMatrixPosition(t.matrixWorld),s=r.distanceTo(i),a=(n[1]-n[0])/(t.far-t.near),o=n[1]-a*t.far;return Math.round(a*s+o)}}(L.current,C,s)}`,h){const[e,t]=[M.width/2,M.height/2],n=C.projectionMatrix.elements[5]*t,{isOrthographicCamera:r,top:i,left:s,bottom:a,right:o}=C,l=jm(C.matrixWorldInverse),h=r?`scale(${n})translate(${Hm(-(o+s)/2)}px,${Hm((i+a)/2)}px)`:`translateZ(${n}px)`;let d=L.current.matrixWorld;u&&(d=C.matrixWorldInverse.clone().transpose().copyPosition(d).scale(L.current.scale),d.elements[3]=d.elements[7]=d.elements[11]=0,d.elements[15]=1),P.style.width=M.width+"px",P.style.height=M.height+"px",P.style.perspective=r?"":`${n}px`,O.current&&U.current&&(O.current.style.transform=`${h}${l}translate(${e}px,${t}px)`,U.current.style.transform=Ym(d,1/((c||10)/400)))}else{const t=void 0===c?1:function(e,t){if(t instanceof vs)return t.zoom;if(t instanceof Yi){const n=Um.setFromMatrixPosition(e.matrixWorld),r=Nm.setFromMatrixPosition(t.matrixWorld),i=t.fov*Math.PI/180,s=n.distanceTo(r);return 1/(2*Math.tan(i/2)*s)}return 1}(L.current,C)*c;P.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}F.current=e,k.current=C.zoom}}if(!Q&&z.current&&!G.current)if(h){if(O.current){const e=O.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){const{isOrthographicCamera:t}=C;if(t||A)b.scale&&(Array.isArray(b.scale)?b.scale instanceof Dn?z.current.scale.copy(b.scale.clone().divideScalar(1)):z.current.scale.set(1/b.scale[0],1/b.scale[1],1/b.scale[2]):z.current.scale.setScalar(1/b.scale));else{const t=(c||10)/400,n=e.clientWidth*t,r=e.clientHeight*t;z.current.scale.set(n,r,1)}G.current=!0}}}else{const t=P.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){const e=1/B.factor,n=t.clientWidth*e,r=t.clientHeight*e;z.current.scale.set(n,r,1),G.current=!0}z.current.lookAt(e.camera.position)}});const W=e.useMemo(()=>({vertexShader:h?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n        void main() {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      "}),[h]);return e.createElement("group",Lm({},b,{ref:L}),d&&!Q&&e.createElement("mesh",{castShadow:p,receiveShadow:m,ref:z},A||e.createElement("planeGeometry",null),g||e.createElement("shaderMaterial",{side:2,vertexShader:W.vertexShader,fragmentShader:W.fragmentShader})))});function qm({onChanged:t,portal:n,preventDefault:r=!0,scroll:i=!0,keyCode:s=9}){const a=e.useRef(0),o=zp(e=>e.setEvents),l=zp(e=>e.get),c=zp(e=>e.gl);return e.useEffect(()=>{var e;let u,h=[];const d=l().events.filter,f=null!==(e=null==n?void 0:n.current)&&void 0!==e?e:c.domElement.parentNode,p=()=>f&&t&&t(h,Math.round(a.current)%h.length);o({filter:(e,t)=>{let n=[...e];n.length===h.length&&h.every(e=>n.map(e=>e.object.uuid).includes(e.object.uuid))||(a.current=0,h=n,p()),d&&(n=d(n,t));for(let e=0;e<Math.round(a.current)%n.length;e++){const e=n.shift();n=[...n,e]}return n}});const m=e=>{var t,n;a.current=e(a.current),null==(t=l().events.handlers)||t.onPointerCancel(void 0),null==(n=l().events.handlers)||n.onPointerMove(u),p()},g=e=>{(e.keyCode||e.which)===s&&(r&&e.preventDefault(),h.length>1&&m(e=>e+1))},A=e=>{r&&e.preventDefault();let t=0;e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),h.length>1&&m(e=>Math.abs(e-t))},v=e=>u=e;return document.addEventListener("pointermove",v,{passive:!0}),i&&document.addEventListener("wheel",A),void 0!==s&&document.addEventListener("keydown",g),()=>{o({filter:d}),void 0!==s&&document.removeEventListener("keydown",g),i&&document.removeEventListener("wheel",A),document.removeEventListener("pointermove",v)}},[c,l,o,r,i,s]),null}function Xm(t,n="pointer",r="auto",i=document.body){e.useEffect(()=>{if(t)return i.style.cursor=n,()=>{i.style.cursor=r}},[t])}const $m=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,s={setState:r,getState:i,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e))},a=t=e(r,i,s);return s},Jm=e=>e;const Zm=e=>{const n=(e=>e?$m(e):$m)(e),r=e=>function(e,n=Jm){const r=t.useSyncExternalStore(e.subscribe,t.useCallback(()=>n(e.getState()),[e,n]),t.useCallback(()=>n(e.getInitialState()),[e,n]));return t.useDebugValue(r),r}(n,e);return Object.assign(r,n),r},eg=e=>e?Zm(e):Zm;let tg=0;const ng=eg(e=>(ah.onStart=(t,n,r)=>{e({active:!0,item:t,loaded:n,total:r,progress:(n-tg)/(r-tg)*100})},ah.onLoad=()=>{e({active:!1})},ah.onError=t=>e(e=>({errors:[...e.errors,t]})),ah.onProgress=(t,n,r)=>{n===r&&(tg=r),e({active:!0,item:t,loaded:n,total:r,progress:(n-tg)/(r-tg)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function rg({children:t}){const n=ng();return e.createElement(e.Fragment,null,null==t?void 0:t(n))}const ig=e=>`Loading ${e.toFixed(2)}%`;function sg({containerStyles:t,innerStyles:n,barStyles:r,dataStyles:i,dataInterpolation:s=ig,initialState:a=e=>e}){const{active:o,progress:l}=ng(),c=e.useRef(0),u=e.useRef(0),h=e.useRef(null),[d,f]=e.useState(a(o));e.useEffect(()=>{let e;return o!==d&&(e=setTimeout(()=>f(o),300)),()=>clearTimeout(e)},[d,o]);const p=e.useCallback(()=>{h.current&&(c.current+=(l-c.current)/2,(c.current>.95*l||100===l)&&(c.current=l),h.current.innerText=s(c.current),c.current<l&&(u.current=requestAnimationFrame(p)))},[s,l]);return e.useEffect(()=>(p(),()=>cancelAnimationFrame(u.current)),[p]),d?e.createElement("div",{style:{...ag.container,opacity:o?1:0,...t}},e.createElement("div",null,e.createElement("div",{style:{...ag.inner,...n}},e.createElement("div",{style:{...ag.bar,transform:`scaleX(${l/100})`,...r}}),e.createElement("span",{ref:h,style:{...ag.data,...i}})))):null}const ag={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};const og={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function lg(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function cg(e,t,n,r=.15){return 0===r?function(e,t,n){return Math.max(t,Math.min(e,n))}(e,t,n):e<t?-lg(t-e,n-t,r)+t:e>n?+lg(e-n,n-t,r)+n:e}function ug(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function hg(e,t,n){return(t=ug(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function fg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dg(Object(n),!0).forEach(function(t){hg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dg(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const pg={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function mg(e){return e?e[0].toUpperCase()+e.slice(1):""}const gg=["enter","leave"];function Ag(e,t="",n=!1){const r=pg[e],i=r&&r[t]||t;return"on"+mg(e)+mg(i)+(function(e=!1,t){return e&&!gg.includes(t)}(n,i)?"Capture":"")}const vg=["gotpointercapture","lostpointercapture"];function yg(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const r=vg.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}function Eg(e){return"touches"in e}function _g(e){return Eg(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function xg(e){return Eg(e)?function(e){return"touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches}(e)[0]:e}function bg(e,t){try{const n=t.clientX-e.clientX,r=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,s=(t.clientY+e.clientY)/2,a=Math.hypot(n,r),o=-180*Math.atan2(n,r)/Math.PI;return{angle:o,distance:a,origin:[i,s]}}catch(e){}return null}function Sg(e){return function(e){return Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))})}(e).map(e=>e.identifier)}function wg(e,t){const[n,r]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return bg(n,r)}function Cg(e){const t=xg(e);return Eg(e)?t.identifier:t.pointerId}function Tg(e){const t=xg(e);return[t.clientX,t.clientY]}function Mg(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return 1===r?(t*=40,n*=40):2===r&&(t*=800,n*=800),[t,n]}function Ig(e,...t){return"function"==typeof e?e(...t):e}function Rg(){}function Bg(...e){return 0===e.length?Rg:1===e.length?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function Pg(e,t){return Object.assign({},t,e||{})}class Dg{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?Ig(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s})}return t}(e)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);og.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[s,a]=t._movement,[o,l]=n.threshold,{_step:c,values:u}=t;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(s)>=o&&u[0]),!1===c[1]&&(c[1]=Math.abs(a)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(s)>=o&&Math.sign(s)*o),!1===c[1]&&(c[1]=Math.abs(a)>=l&&Math.sign(a)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;const h=[0,0];if(n.hasCustomTransform){const[e,t]=u;h[0]=!1!==c[0]?e-c[0]:0,h[1]=!1!==c[1]?t-c[1]:0}else h[0]=!1!==c[0]?s-c[0]:0,h[1]=!1!==c[1]?a-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);const d=t.offset,f=t._active&&!t._blocked||t.active;f&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=Ig(n.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));const[p,m]=t.offset,[[g,A],[v,y]]=t._bounds;t.overflow=[p<g?-1:p>A?1:0,m<v?-1:m>y?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const E=t._active&&n.rubberband||[0,0];if(t.offset=function(e,[t,n],[r,i]){const[[s,a],[o,l]]=e;return[cg(t,s,a,r),cg(n,o,l,i)]}(t._bounds,t.offset,E),t.delta=og.sub(t.offset,d),this.computeMovement(),f&&(!t.last||i>32)){t.delta=og.sub(t.offset,d);const e=t.delta.map(Math.abs);og.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const r=this.handler(fg(fg(fg({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class Lg extends Dg{constructor(...e){super(...e),hg(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=og.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=og.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const r="object"==typeof n.axisThreshold?n.axisThreshold[_g(e)]:n.axisThreshold;t.axis=function([e,t],n){const r=Math.abs(e),i=Math.abs(t);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const kg=e=>e,Fg={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>fg(fg({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return og.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?og.toVector(e):void 0,transform(e,t,n){const r=e||n.shared.transform;if(this.hasCustomTransform=!!r,"development"===process.env.NODE_ENV){const e=r||kg;return t=>{const n=e(t);return!isFinite(n[0])||isFinite(n[1]),n}}return r||kg},threshold:e=>og.toVector(e,0)};"development"===process.env.NODE_ENV&&Object.assign(Fg,{domTarget(e){if(void 0!==e)throw Error("[@use-gesture]: `domTarget` option has been renamed to `target`.");return NaN},lockDirection(e){if(void 0!==e)throw Error("[@use-gesture]: `lockDirection` option has been merged with `axis`. Use it as in `{ axis: 'lock' }`");return NaN},initial(e){if(void 0!==e)throw Error("[@use-gesture]: `initial` option has been renamed to `from`.");return NaN}});const Og=fg(fg({},Fg),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=0)=>e,bounds(e={}){if("function"==typeof e)return t=>Og.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),Ug={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};const Ng="undefined"!=typeof window&&window.document&&window.document.createElement;function zg(){return Ng&&"ontouchstart"in window}const Gg={isBrowser:Ng,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:zg(),touchscreen:zg()||Ng&&window.navigator.maxTouchPoints>1,pointer:Ng&&"onpointerdown"in window,pointerLock:Ng&&"exitPointerLock"in window.document},Qg={mouse:0,touch:0,pen:8},Hg=fg(fg({},Og),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Gg.pointerLock,Gg.touch&&n?"touch":this.pointerLock?"mouse":Gg.pointer&&!i?"pointer":Gg.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,Gg.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){const s=og.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,s},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(og.toVector(e)),distance:this.transform(og.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?fg(fg({},Qg),e):Qg,keyboardDisplacement:(e=10)=>e});function Vg(e){const[t,n]=e.overflow,[r,i]=e._delta,[s,a]=e._direction;(t<0&&r>0&&s<0||t>0&&r<0&&s>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&i>0&&a<0||n>0&&i<0&&a>0)&&(e._movement[1]=e._movementBound[1])}"development"===process.env.NODE_ENV&&Object.assign(Hg,{useTouch(e){if(void 0!==e)throw Error("[@use-gesture]: `useTouch` option has been renamed to `pointer.touch`. Use it as in `{ pointer: { touch: true } }`.");return NaN},experimental_preventWindowScrollY(e){if(void 0!==e)throw Error("[@use-gesture]: `experimental_preventWindowScrollY` option has been renamed to `preventScroll`.");return NaN},swipeVelocity(e){if(void 0!==e)throw Error("[@use-gesture]: `swipeVelocity` option has been renamed to `swipe.velocity`. Use it as in `{ swipe: { velocity: 0.5 } }`.");return NaN},swipeDistance(e){if(void 0!==e)throw Error("[@use-gesture]: `swipeDistance` option has been renamed to `swipe.distance`. Use it as in `{ swipe: { distance: 50 } }`.");return NaN},swipeDuration(e){if(void 0!==e)throw Error("[@use-gesture]: `swipeDuration` option has been renamed to `swipe.duration`. Use it as in `{ swipe: { duration: 250 } }`.");return NaN}});const jg=fg(fg({},Fg),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!Gg.touch&&Gg.gesture)return"gesture";if(Gg.touch&&r)return"touch";if(Gg.touchscreen){if(Gg.pointer)return"pointer";if(Gg.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){const i=e=>{const t=Pg(Ig(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},s=e=>{const t=Pg(Ig(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof r?[i(),s()]:e=>[i(e),s(e)]},threshold(e,t,n){this.lockDirection="lock"===n.axis;return og.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});const Wg=fg(fg({},Og),{},{mouseOnly:(e=!0)=>e});const Yg=Og;const Kg=Og;const qg=fg(fg({},Og),{},{mouseOnly:(e=!0)=>e}),Xg=new Map,$g=new Map;function Jg(e){Xg.set(e.key,e.engine),$g.set(e.key,e.resolver)}const Zg={key:"drag",engine:class extends Lg{constructor(...e){super(...e),hg(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),r={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=Og.bounds(r)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,n=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;const r=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),r&&r.size>1&&n._pointerActive||(this.start(e),this.setupPointer(e),n._pointerId=Cg(e),n._pointerActive=!0,this.computeValues(Tg(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==_g(e)?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,n=this.config;if(!t._pointerActive)return;const r=Cg(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;const i=Tg(e);return document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=og.sub(i,t._values),this.computeValues(i)),og.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional?(this.timeoutStore.remove("dragDelay"),t.active=!1,void this.startPointerDrag(e)):n.preventScrollAxis&&!t._preventScroll?t.axis?t.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(t._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(e)):void 0:void this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(e){process.env.NODE_ENV}const t=this.state,n=this.config;if(!t._active||!t._pointerActive)return;const r=Cg(e);if(void 0!==t._pointerId&&r!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[i,s]=t._distance;if(t.tap=i<=n.tapsThreshold&&s<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{const[e,r]=t._delta,[i,s]=t._movement,[a,o]=n.swipe.velocity,[l,c]=n.swipe.distance,u=n.swipe.duration;if(t.elapsedTime<u){const n=Math.abs(e/t.timeDelta),u=Math.abs(r/t.timeDelta);n>a&&Math.abs(i)>l&&(t.swipe[0]=Math.sign(e)),u>o&&Math.abs(s)>c&&(t.swipe[1]=Math.sign(r))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,n=t.device;if("development"===process.env.NODE_ENV)try{if("pointer"===n&&void 0===t.preventScrollDelay){const t="uv"in e?e.sourceEvent.currentTarget:e.currentTarget;window.getComputedStyle(t).touchAction}}catch(e){}t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,function(e){"persist"in e&&"function"==typeof e.persist&&e.persist()}(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const t=Ug[e.key];if(t){const n=this.state,r=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=t(this.config.keyboardDisplacement,r),n._keyboardActive=!0,og.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in Ug&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}},resolver:Hg},eA={key:"hover",engine:class extends Lg{constructor(...e){super(...e),hg(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(Tg(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&"mouse"!==e.pointerType)return;const t=this.state;if(!t._active)return;t._active=!1;const n=Tg(e);t._movement=t._delta=og.sub(n,t._values),this.computeValues(n),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}},resolver:qg},tA={key:"move",engine:class extends Lg{constructor(...e){super(...e),hg(this,"ingKey","moving")}move(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(Tg(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;const t=Tg(e),n=this.state;n._delta=og.sub(t,n._values),og.addTo(n._movement,n._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}},resolver:Wg},nA={key:"pinch",engine:class extends Dg{constructor(...e){super(...e),hg(this,"ingKey","pinching"),hg(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:n}=this.state;this.state.offset="wheel"===e?og.add(t,n):[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,n]=e._movement;if(!e.axis){const r=30*Math.abs(t)-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>n.has(e)))return;if(n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);const r=wg(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(e=>r.has(e)))return;if(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2)return;this.start(e);const i=bg(...Array.from(n.values()));i&&this.pinchStart(e,i)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=wg(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const n=bg(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){const n=this.state,r=n._values[1],i=t.angle-r;let s=0;Math.abs(i)>270&&(s+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*s]),n.origin=t.origin,n.turns=s,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=og.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&!(Array.isArray(t)?t.find(t=>e[t]):e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||(e.cancelable&&e.preventDefault(),"development"===process.env.NODE_ENV&&e.defaultPrevented);const t=this.state;t._delta=[-Mg(e)[1]/100*t.offset[0],0],og.addTo(t._movement,t._delta),Vg(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:jg},rA={key:"scroll",engine:class extends Lg{constructor(...e){super(...e),hg(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const t=this.state,n=function(e){var t,n;const{scrollX:r,scrollY:i,scrollLeft:s,scrollTop:a}=e.currentTarget;return[null!==(t=null!=r?r:s)&&void 0!==t?t:0,null!==(n=null!=i?i:a)&&void 0!==n?n:0]}(e);t._delta=og.sub(n,t._values),og.addTo(t._movement,t._delta),this.computeValues(n),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}},resolver:Yg},iA={key:"wheel",engine:class extends Lg{constructor(...e){super(...e),hg(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=Mg(e),og.addTo(t._movement,t._delta),Vg(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}},resolver:Kg};function sA(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const aA={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=(Gg.isBrowser?window:void 0))=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},oA=["target","eventOptions","window","enabled","transform"];function lA(e={},t){const n={};for(const[r,i]of Object.entries(t))switch(typeof i){case"function":if("development"===process.env.NODE_ENV){const t=i.call(n,e[r],r,e);Number.isNaN(t)||(n[r]=t)}else n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=lA(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}class cA{constructor(e,t){hg(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){const s=this._listeners,a=function(e,t=""){const n=pg[e];return e+(n&&n[t]||t)}(t,n),o=fg(fg({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);e.addEventListener(a,r,o);const l=()=>{e.removeEventListener(a,r,o),s.delete(l)};return s.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class uA{constructor(){hg(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>{window.clearTimeout(e)}),this._timeouts.clear()}}class hA{constructor(e){hg(this,"gestures",new Set),hg(this,"_targetEventStore",new cA(this)),hg(this,"gestureEventStores",{}),hg(this,"gestureTimeoutStores",{}),hg(this,"handlers",{}),hg(this,"config",{}),hg(this,"pointerIds",new Set),hg(this,"touchIds",new Set),hg(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&dA(e,"drag");t.wheel&&dA(e,"wheel");t.scroll&&dA(e,"scroll");t.move&&dA(e,"move");t.pinch&&dA(e,"pinch");t.hover&&dA(e,"hover")}(this,e)}setEventIds(e){return Eg(e)?(this.touchIds=new Set(Sg(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,n={}){const r=e,{target:i,eventOptions:s,window:a,enabled:o,transform:l}=r,c=sA(r,oA);if(n.shared=lA({target:i,eventOptions:s,window:a,enabled:o,transform:l},aA),t){const e=$g.get(t);n[t]=lA(fg({shared:n.shared},c),e)}else for(const e in c){const t=$g.get(e);if(t)n[e]=lA(fg({shared:n.shared},c[e]),t);else if("development"===process.env.NODE_ENV&&!["drag","pinch","scroll","wheel","move","hover"].includes(e)&&"domTarget"===e)throw Error("[@use-gesture]: `domTarget` option has been renamed to `target`.")}return n}(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let r;if(!t.target||(r=t.target(),r)){if(t.enabled){for(const t of this.gestures){const i=this.config[t],s=fA(n,i.eventOptions,!!r);if(i.enabled){new(Xg.get(t))(this,e,t).bind(s)}}const i=fA(n,t.eventOptions,!!r);for(const t in this.nativeHandlers)i(t,"",n=>this.nativeHandlers[t](fg(fg({},this.state.shared),{},{event:n,args:e})),void 0,!0)}for(const e in n)n[e]=Bg(...n[e]);if(!r)return n;for(const e in n){const{device:t,capture:i,passive:s}=yg(e);this._targetEventStore.add(r,t,"",n[e],{capture:i,passive:s})}}}}function dA(e,t){e.gestures.add(t),e.gestureEventStores[t]=new cA(e,t),e.gestureTimeoutStores[t]=new uA}const fA=(e,t,n)=>(r,i,s,a={},o=!1)=>{var l,c;const u=null!==(l=a.capture)&&void 0!==l?l:t.capture,h=null!==(c=a.passive)&&void 0!==c?c:t.passive;let d=o?r:Ag(r,i,u);n&&h&&(d+="Passive"),e[d]=e[d]||[],e[d].push(s)},pA=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function mA(e,t,n,r,i,s){if(!e.has(n))return;if(!Xg.has(r))return void process.env.NODE_ENV;const a=n+"Start",o=n+"End";i[r]=e=>{let r;return e.first&&a in t&&t[a](e),n in t&&(r=t[n](e)),e.last&&o in t&&t[o](e),r},s[r]=s[r]||{}}function gA(e,t){const[n,r,i]=function(e){const t={},n={},r=new Set;for(let i in e)pA.test(i)?(r.add(RegExp.lastMatch),n[i]=e[i]):t[i]=e[i];return[n,t,r]}(e),s={};return mA(i,n,"onDrag","drag",s,t),mA(i,n,"onWheel","wheel",s,t),mA(i,n,"onScroll","scroll",s,t),mA(i,n,"onPinch","pinch",s,t),mA(i,n,"onMove","move",s,t),mA(i,n,"onHover","hover",s,t),{handlers:s,config:t,nativeHandlers:r}}function AA(e){return e.forEach(Jg),function(e,n){const{handlers:r,nativeHandlers:i,config:s}=gA(e,n||{});return function(e,n={},r,i){const s=t.useMemo(()=>new hA(e),[]);if(s.applyHandlers(e,i),s.applyConfig(n,r),t.useEffect(s.effect.bind(s)),t.useEffect(()=>s.clean.bind(s),[]),void 0===n.target)return s.bind.bind(s)}(r,s,void 0,i)}}function vA(e,t){return AA([Zg,nA,rA,iA,tA,eA])(e,t||{})}const yA=new Dn,EA=new nn,_A=new Dn,xA=new Dn,bA=new Dn,SA=new ts,wA=e.forwardRef(({autoTransform:t=!0,matrix:n,axisLock:r,dragLimits:i,onHover:s,onDragStart:a,onDrag:o,onDragEnd:l,children:c,dragConfig:u,...h},d)=>{const f=zp(e=>e.controls),{camera:p,size:m,raycaster:g,invalidate:A}=zp(),v=e.useRef(null),y=vA({onHover:({hovering:e})=>s&&s(null!=e&&e),onDragStart:({event:e})=>{f&&(f.enabled=!1);const{point:t}=e;v.current.matrix.decompose(yA,new Pn,new Dn),_A.copy(t),xA.copy(_A).sub(yA),a&&a(yA),A()},onDrag:({xy:[e,n],intentional:s})=>{if(!s)return;const a=(e-m.left)/m.width*2-1,l=-(n-m.top)/m.height*2+1;if(EA.set(a,l),g.setFromCamera(EA,p),r)switch(r){case"x":bA.set(1,0,0);break;case"y":bA.set(0,1,0);break;case"z":bA.set(0,0,1)}else p.getWorldDirection(bA).negate();SA.setFromNormalAndCoplanarPoint(bA,_A),g.ray.intersectPlane(SA,_A);const c=v.current.matrix.clone(),u=v.current.matrixWorld.clone(),h=new Dn(_A.x-xA.x,_A.y-xA.y,_A.z-xA.z);if(i&&(h.x=i[0]?Math.max(Math.min(h.x,i[0][1]),i[0][0]):h.x,h.y=i[1]?Math.max(Math.min(h.y,i[1][1]),i[1][0]):h.y,h.z=i[2]?Math.max(Math.min(h.z,i[2][1]),i[2][0]):h.z),t){v.current.matrix.setPosition(h);const e=v.current.matrix.clone().multiply(c.invert()),t=v.current.matrix.clone().multiply(u.invert());o&&o(v.current.matrix,e,v.current.matrixWorld,t)}else{const e=(new cr).copy(v.current.matrix);e.setPosition(h);const t=e.clone().multiply(c.invert()),n=e.clone().multiply(u.invert());o&&o(e,t,v.current.matrixWorld,n)}A()},onDragEnd:()=>{f&&(f.enabled=!0),l&&l(),A()}},{drag:{filterTaps:!0,threshold:1,..."object"==typeof u?u:{}}});return e.useImperativeHandle(d,()=>v.current,[]),e.useLayoutEffect(()=>{n&&(v.current.matrix=n)},[n]),e.createElement("group",Lm({ref:v},y(),{matrix:n,matrixAutoUpdate:!1},h),c)});function CA(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TA(e,t){return TA=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},TA(e,t)}function MA(e,t){for(var n=[],r=e.toArray(),i=t.toArray(),s=0;s<r.length;s++)n[s]=r[s]+i[s];return(new rn).fromArray(n)}function IA(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function RA(e,t){if(e){if("string"==typeof e)return IA(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?IA(e,t):void 0}}function BA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return s}}(e,t)||RA(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function PA(e){return function(e){if(Array.isArray(e))return IA(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||RA(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function DA(e,t,n){return DA=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&TA(i,n.prototype),i},DA.apply(null,arguments)}function LA(e){var t=BA(e[0],2),n=t[0],r=t[1],i=BA(e[1],2),s=i[0],a=i[1],o=BA(e[2],2);return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8];return r*o*h+i*l*c+s*a*u-s*o*c-i*a*h-r*l*u}(n,r,1,s,a,1,o[0],o[1],1)}var kA=new nn,FA=new nn;function OA(e){var t=e.map(function(e){return Array.isArray(e)?DA(nn,PA(e)):e}),n=BA(t,3),r=n[0],i=n[1],s=n[2];if(function(e){return 0===LA(e)}(e))return!1;var a=kA.subVectors(i,r);return FA.subVectors(s,r).cross(a)>0}function UA(e,t,n){return Math.max(t,Math.min(n,e))}function NA(e,t){return UA(e-Math.floor(e/t)*t,0,t)}function zA(e,t){var n=NA(t-e,2*Math.PI);return n>Math.PI&&(n-=2*Math.PI),n}function GA(e,t){return e.x===t.x?void 0!==e.z&&e.y===t.y?e.z-t.z:e.y-t.y:e.x-t.x}function QA(e,t,n){return(n-e)/(t-e)}function HA(e,t){var n=(new Dn).crossVectors(e,t),r=e.dot(t),i=(new rn).identity(),s=(new rn).set(0,-n.z,n.y,n.z,0,-n.x,-n.y,n.x,0),a=(new rn).multiplyMatrices(s,s).multiplyScalar(1/(1+r));return MA(MA(i,s),a)}var VA=Object.freeze({__proto__:null,clamp:UA,repeat:NA,deltaAngle:zA,degToRad:function(e){return e/180*Math.PI},radToDeg:function(e){return 180*e/Math.PI},fibonacciOnSphere:function(e,t){for(var n=t.radius,r=void 0===n?1:n,i=e.length/3,s=2/i,a=Math.PI*(3-2.2360679775),o=0;o<e.length;o+=3){var l=o*s-1+s/2,c=Math.sqrt(1-Math.pow(l,2)),u=o%i*a,h=Math.cos(u)*c,d=Math.sin(u)*c;e[o]=h*r,e[o+1]=l*r,e[o+2]=d*r}},vectorEquals:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n},lexicographic:GA,convexHull:function(e){for(var t=e.sort(GA),n=[t[0],t[1]],r=2;r<t.length;r++)for(n.push(t[r]);n.length>2&&OA(PA(n.slice(-3)));)n.splice(n.length-2,1);for(var i=[t[t.length-1],t[t.length-2]],s=t.length-3;s>=0;s--)for(i.push(t[s]);i.length>2&&OA(PA(i.slice(-3)));)i.splice(i.length-2,1);return i.splice(0,1),i.splice(i.length-1,1),[].concat(n,i)},remap:function(e,t,n){var r=BA(t,2),i=r[0],s=r[1],a=BA(n,2),o=a[0];return o+(e-i)*(a[1]-o)/(s-i)},fade:function(e){return e*e*e*(e*(6*e-15)+10)},lerp:function(e,t,n){return e*(1-n)+t*n},inverseLerp:QA,normalize:function(e,t,n){var r=Math.sqrt(e*e+t*t+n*n);return[e/r,t/r,n/r]},pointOnCubeToPointOnSphere:function(e,t,n){var r=e*e,i=t*t,s=n*n;return[e*Math.sqrt(1-(i+s)/2+i*s/3),t*Math.sqrt(1-(s+r)/2+s*r/3),n*Math.sqrt(1-(r+i)/2+r*i/3)]},rotateVectorOnVector:HA,pointToCoordinate:function(e,t,n){return[Math.asin(t),Math.atan2(e,-n)]},coordinateToPoint:function(e,t){var n=Math.sin(e),r=Math.cos(e);return[Math.sin(t)*r,n,-Math.cos(t)*r]},planeSegmentIntersection:function(e,t){var n=BA(t,2),r=n[0],i=n[1],s=HA(e.normal,new Dn(0,1,0)),a=QA(r.clone().applyMatrix3(s).y,i.clone().applyMatrix3(s).y,0);return(new Dn).lerpVectors(r,i,a)},pointToPlaneDistance:function(e,t){return t.normal.dot(e)},getIndexFrom3D:function(e,t){var n=BA(e,3),r=n[0],i=n[1],s=n[2],a=BA(t,2),o=a[0];return s*o*a[1]+i*o+r},get3DFromIndex:function(e,t){var n=BA(t,2),r=n[0],i=r*n[1],s=e/i,a=e-i*s;return[a%r,a/r,s]},getIndexFrom2D:function(e,t){return e[0]+t[0]*e[1]},get2DFromIndex:function(e,t){return[e%t,Math.floor(e/t)]}});function jA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var WA=function e(t,n,r){var i=this;jA(this,e),CA(this,"dot2",function(e,t){return i.x*e+i.y*t}),CA(this,"dot3",function(e,t,n){return i.x*e+i.y*t+i.z*n}),this.x=t,this.y=n,this.z=r},YA=[new WA(1,1,0),new WA(-1,1,0),new WA(1,-1,0),new WA(-1,-1,0),new WA(1,0,1),new WA(-1,0,1),new WA(1,0,-1),new WA(-1,0,-1),new WA(0,1,1),new WA(0,-1,1),new WA(0,1,-1),new WA(0,-1,-1)],KA=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],qA=new Array(512),XA=new Array(512);function $A(e){var t=function(e){if("number"==typeof e)e=Math.abs(e);else if("string"==typeof e){var t=e;e=0;for(var n=0;n<t.length;n++)e=(e+(n+1)*(t.charCodeAt(n)%96))%2147483647}return 0===e&&(e=311),e}(e);return function(){var e=48271*t%2147483647;return t=e,e/2147483647}}!function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n;n=1&t?KA[t]^255&e:KA[t]^e>>8&255,qA[t]=qA[t+256]=n,XA[t]=XA[t+256]=YA[n%12]}}(0);new function e(t){var n=this;jA(this,e),CA(this,"seed",0),CA(this,"init",function(e){n.seed=e,n.value=$A(e)}),CA(this,"value",$A(this.seed)),this.init(t)}(Math.random());var JA=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)},ZA={in:function(e){return 1-Math.cos(e*Math.PI/2)},out:function(e){return Math.sin(e*Math.PI/2)},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},ev={in:function(e){return e*e*e},out:function(e){return 1-Math.pow(1-e,3)},inOut:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}},tv={in:function(e){return e*e*e*e*e},out:function(e){return 1-Math.pow(1-e,5)},inOut:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}},nv={in:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},out:function(e){return Math.sqrt(1-Math.pow(e-1,2))},inOut:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}},rv={in:function(e){return 0===e?0:Math.pow(2,10*e-10)},out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},inOut:function(e){return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}};function iv(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.25,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:JA,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.001,l="velocity_"+t;if(void 0===e.__damp&&(e.__damp={}),void 0===e.__damp[l]&&(e.__damp[l]=0),Math.abs(e[t]-n)<=o)return e[t]=n,!1;var c=2/(r=Math.max(1e-4,r)),u=a(c*i),h=e[t]-n,d=n,f=s*r;h=Math.min(Math.max(h,-f),f),n=e[t]-h;var p=(e.__damp[l]+c*h)*i;e.__damp[l]=(e.__damp[l]-c*p)*u;var m=n+(h+p)*u;return d-e[t]>0==m>d&&(m=d,e.__damp[l]=(m-d)/i),e[t]=m,!0}var sv=new Dn,av=new Pn,ov=new Pn,lv=new cr,cv=new Dn;function uv(e,t,n,r,i,s,a,o){return iv(e,t,e[t]+zA(e[t],n),r,i,s,a,o)}var hv,dv,fv=new nn;var pv,mv,gv,Av=new Dn;function vv(e,t,n,r,i,s,a){return"number"==typeof t?Av.setScalar(t):Array.isArray(t)?Av.set(t[0],t[1],t[2]):Av.copy(t),pv=iv(e,"x",Av.x,n,r,i,s,a),mv=iv(e,"y",Av.y,n,r,i,s,a),gv=iv(e,"z",Av.z,n,r,i,s,a),pv||mv||gv}var yv,Ev,_v,xv,bv=new Tn;var Sv,wv,Cv,Tv=new yr;var Mv,Iv,Rv,Bv=new $r;var Pv,Dv,Lv,kv,Fv=new Pn,Ov=new Tn,Uv=new Tn,Nv=new Tn;function zv(e,t,n,r,i,s,a){var o=e;Array.isArray(t)?Fv.set(t[0],t[1],t[2],t[3]):Fv.copy(t);var l=e.dot(Fv)>0?1:-1;return Fv.x*=l,Fv.y*=l,Fv.z*=l,Fv.w*=l,Pv=iv(e,"x",Fv.x,n,r,i,s,a),Dv=iv(e,"y",Fv.y,n,r,i,s,a),Lv=iv(e,"z",Fv.z,n,r,i,s,a),kv=iv(e,"w",Fv.w,n,r,i,s,a),Ov.set(e.x,e.y,e.z,e.w).normalize(),Uv.set(o.__damp.velocity_x,o.__damp.velocity_y,o.__damp.velocity_z,o.__damp.velocity_w),Nv.copy(Ov).multiplyScalar(Uv.dot(Ov)/Ov.dot(Ov)),o.__damp.velocity_x-=Nv.x,o.__damp.velocity_y-=Nv.y,o.__damp.velocity_z-=Nv.z,o.__damp.velocity_w-=Nv.w,e.set(Ov.x,Ov.y,Ov.z,Ov.w),Pv||Dv||Lv||kv}var Gv,Qv,Hv,Vv=new bd;var jv,Wv,Yv,Kv=new cr,qv=new Dn,Xv=new Pn,$v=new Dn;var Jv=Object.freeze({__proto__:null,rsqw:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/(2*Math.PI);return n/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*r)/t)},exp:JA,linear:function(e){return e},sine:ZA,cubic:ev,quint:tv,circ:nv,quart:{in:function(e){return e*e*e*e},out:function(e){return 1- --e*e*e*e},inOut:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},expo:rv,damp:iv,dampLookAt:function(e,t,n,r,i,s,a){"number"==typeof t?sv.setScalar(t):Array.isArray(t)?sv.set(t[0],t[1],t[2]):sv.copy(t);var o=e.parent;e.updateWorldMatrix(!0,!1),cv.setFromMatrixPosition(e.matrixWorld),function(e){return e&&e.isCamera}(e)||function(e){return e&&e.isLight}(e)?lv.lookAt(cv,sv,e.up):lv.lookAt(sv,cv,e.up),zv(e.quaternion,ov.setFromRotationMatrix(lv),n,r,i,s,a),o&&(lv.extractRotation(o.matrixWorld),av.setFromRotationMatrix(lv),zv(e.quaternion,ov.copy(e.quaternion).premultiply(av.invert()),n,r,i,s,a))},dampAngle:uv,damp2:function(e,t,n,r,i,s,a){return"number"==typeof t?fv.setScalar(t):Array.isArray(t)?fv.set(t[0],t[1]):fv.copy(t),hv=iv(e,"x",fv.x,n,r,i,s,a),dv=iv(e,"y",fv.y,n,r,i,s,a),hv||dv},damp3:vv,damp4:function(e,t,n,r,i,s,a){return"number"==typeof t?bv.setScalar(t):Array.isArray(t)?bv.set(t[0],t[1],t[2],t[3]):bv.copy(t),yv=iv(e,"x",bv.x,n,r,i,s,a),Ev=iv(e,"y",bv.y,n,r,i,s,a),_v=iv(e,"z",bv.z,n,r,i,s,a),xv=iv(e,"w",bv.w,n,r,i,s,a),yv||Ev||_v||xv},dampE:function(e,t,n,r,i,s,a){return Array.isArray(t)?Tv.set(t[0],t[1],t[2],t[3]):Tv.copy(t),Sv=uv(e,"x",Tv.x,n,r,i,s,a),wv=uv(e,"y",Tv.y,n,r,i,s,a),Cv=uv(e,"z",Tv.z,n,r,i,s,a),Sv||wv||Cv},dampC:function(e,t,n,r,i,s,a){return t instanceof $r?Bv.copy(t):Array.isArray(t)?Bv.setRGB(t[0],t[1],t[2]):Bv.set(t),Mv=iv(e,"r",Bv.r,n,r,i,s,a),Iv=iv(e,"g",Bv.g,n,r,i,s,a),Rv=iv(e,"b",Bv.b,n,r,i,s,a),Mv||Iv||Rv},dampQ:zv,dampS:function(e,t,n,r,i,s,a){return Array.isArray(t)?Vv.set(t[0],t[1],t[2]):Vv.copy(t),Gv=iv(e,"radius",Vv.radius,n,r,i,s,a),Qv=uv(e,"phi",Vv.phi,n,r,i,s,a),Hv=uv(e,"theta",Vv.theta,n,r,i,s,a),Gv||Qv||Hv},dampM:function(e,t,n,r,i,s,a){var o=e;return void 0===o.__damp&&(o.__damp={position:new Dn,rotation:new Pn,scale:new Dn},e.decompose(o.__damp.position,o.__damp.rotation,o.__damp.scale)),Array.isArray(t)?Kv.set.apply(Kv,PA(t)):Kv.copy(t),Kv.decompose(qv,Xv,$v),jv=vv(o.__damp.position,qv,n,r,i,s,a),Wv=zv(o.__damp.rotation,Xv,n,r,i,s,a),Yv=vv(o.__damp.scale,$v,n,r,i,s,a),e.compose(o.__damp.position,o.__damp.rotation,o.__damp.scale),jv||Wv||Yv}});const Zv=e.createContext(null);function ey(){return e.useContext(Zv)}function ty({eps:t=1e-5,enabled:n=!0,infinite:r,horizontal:i,pages:s=1,distance:a=1,damping:o=.25,maxSpeed:l=1/0,prepend:c=!1,style:u={},children:h}){const{get:d,setEvents:f,gl:p,size:m,invalidate:g,events:A}=zp(),[v]=e.useState(()=>document.createElement("div")),[y]=e.useState(()=>document.createElement("div")),[E]=e.useState(()=>document.createElement("div")),_=p.domElement.parentNode,x=e.useRef(0),b=e.useMemo(()=>{const e={el:v,eps:t,fill:y,fixed:E,horizontal:i,damping:o,offset:0,delta:0,scroll:x,pages:s,range(e,t,n=0){const r=e-n,i=r+t+2*n;return this.offset<r?0:this.offset>i?1:(this.offset-r)/(i-r)},curve(e,t,n=0){return Math.sin(this.range(e,t,n)*Math.PI)},visible(e,t,n=0){const r=e-n,i=r+t+2*n;return this.offset>=r&&this.offset<=i}};return e},[t,o,i,s]);e.useEffect(()=>{v.style.position="absolute",v.style.width="100%",v.style.height="100%",v.style[i?"overflowX":"overflowY"]="auto",v.style[i?"overflowY":"overflowX"]="hidden",v.style.top="0px",v.style.left="0px";for(const e in u)v.style[e]=u[e];E.style.position="sticky",E.style.top="0px",E.style.left="0px",E.style.width="100%",E.style.height="100%",E.style.overflow="hidden",v.appendChild(E),y.style.height=i?"100%":s*a*100+"%",y.style.width=i?s*a*100+"%":"100%",y.style.pointerEvents="none",v.appendChild(y),c?_.prepend(v):_.appendChild(v),v[i?"scrollLeft":"scrollTop"]=1;const e=A.connected||p.domElement;requestAnimationFrame(()=>null==A.connect?void 0:A.connect(v));const t=d().events.compute;return f({compute(e,t){const{left:n,top:r}=_.getBoundingClientRect(),i=e.clientX-n,s=e.clientY-r;t.pointer.set(i/t.size.width*2-1,-s/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{_.removeChild(v),f({compute:t}),null==A.connect||A.connect(e)}},[s,a,i,v,y,E,_]),e.useEffect(()=>{if(A.connected===v){const e=m[i?"width":"height"],t=v[i?"scrollWidth":"scrollHeight"],s=t-e;let a=0,o=!0,l=!0;const c=()=>{if(n&&!l&&(g(),a=v[i?"scrollLeft":"scrollTop"],x.current=a/s,r)){if(!o)if(a>=s){const e=1-b.offset;v[i?"scrollLeft":"scrollTop"]=1,x.current=b.offset=-e,o=!0}else if(a<=0){const e=1+b.offset;v[i?"scrollLeft":"scrollTop"]=t,x.current=b.offset=e,o=!0}o&&setTimeout(()=>o=!1,40)}};v.addEventListener("scroll",c,{passive:!0}),requestAnimationFrame(()=>l=!1);const u=e=>v.scrollLeft+=e.deltaY/2;return i&&v.addEventListener("wheel",u,{passive:!0}),()=>{v.removeEventListener("scroll",c),i&&v.removeEventListener("wheel",u)}}},[v,A,m,r,b,g,i,n]);let S=0;return Gp((e,n)=>{S=b.offset,Jv.damp(b,"offset",x.current,o,n,l,void 0,t),Jv.damp(b,"delta",Math.abs(S-b.offset),o,n,l,void 0,t),b.delta>t&&g()}),e.createElement(Zv.Provider,{value:b},h)}const ny=e.forwardRef(({children:t},n)=>{const r=e.useRef(null);e.useImperativeHandle(n,()=>r.current,[]);const i=ey(),{width:s,height:a}=zp(e=>e.viewport);return Gp(()=>{r.current.position.x=i.horizontal?-s*(i.pages-1)*i.offset:0,r.current.position.y=i.horizontal?0:a*(i.pages-1)*i.offset}),e.createElement("group",{ref:r},t)}),ry=e.forwardRef(({children:t,style:n,...r},i)=>{const s=ey(),a=e.useRef(null);e.useImperativeHandle(i,()=>a.current,[]);const{width:o,height:l}=zp(e=>e.size),c=e.useContext(Sp),u=e.useMemo(()=>Om.createRoot(s.fixed),[s.fixed]);return Gp(()=>{s.delta>s.eps&&(a.current.style.transform=`translate3d(${s.horizontal?-o*(s.pages-1)*s.offset:0}px,${s.horizontal?0:l*(s.pages-1)*-s.offset}px,0)`)}),u.render(e.createElement("div",Lm({ref:a,style:{...n,position:"absolute",top:0,left:0,willChange:"transform"}},r),e.createElement(Zv.Provider,{value:s},e.createElement(Sp.Provider,{value:c},t)))),null}),iy=e.forwardRef(({html:t,...n},r)=>{const i=t?ry:ny;return e.createElement(i,Lm({ref:r},n))});var sy=_y(),ay=e=>Ay(e,sy),oy=_y();ay.write=e=>Ay(e,oy);var ly=_y();ay.onStart=e=>Ay(e,ly);var cy=_y();ay.onFrame=e=>Ay(e,cy);var uy=_y();ay.onFinish=e=>Ay(e,uy);var hy=[];ay.setTimeout=(e,t)=>{const n=ay.now()+t,r=()=>{const e=hy.findIndex(e=>e.cancel==r);~e&&hy.splice(e,1),my-=~e?1:0},i={time:n,handler:e,cancel:r};return hy.splice(dy(n),0,i),my+=1,vy(),i};var dy=e=>~(~hy.findIndex(t=>t.time>e)||~hy.length);ay.cancel=e=>{ly.delete(e),cy.delete(e),uy.delete(e),sy.delete(e),oy.delete(e)},ay.sync=e=>{gy=!0,ay.batchedUpdates(e),gy=!1},ay.throttle=e=>{let t;function n(){try{e(...t)}finally{t=null}}function r(...e){t=e,ay.onStart(n)}return r.handler=e,r.cancel=()=>{ly.delete(n),t=null},r};var fy="undefined"!=typeof window?window.requestAnimationFrame:()=>{};ay.use=e=>fy=e,ay.now="undefined"!=typeof performance?()=>performance.now():Date.now,ay.batchedUpdates=e=>e(),ay.catch=console.error,ay.frameLoop="always",ay.advance=()=>{"demand"!==ay.frameLoop||Ey()};var py=-1,my=0,gy=!1;function Ay(e,t){gy?(t.delete(e),e(0)):(t.add(e),vy())}function vy(){py<0&&(py=0,"demand"!==ay.frameLoop&&fy(yy))}function yy(){~py&&(fy(yy),ay.batchedUpdates(Ey))}function Ey(){const e=py;py=ay.now();const t=dy(py);t&&(xy(hy.splice(0,t),e=>e.handler()),my-=t),my?(ly.flush(),sy.flush(e?Math.min(64,py-e):16.667),cy.flush(),oy.flush(),uy.flush()):py=-1}function _y(){let e=new Set,t=e;return{add(n){my+=t!=e||e.has(n)?0:1,e.add(n)},delete:n=>(my-=t==e&&e.has(n)?1:0,e.delete(n)),flush(n){t.size&&(e=new Set,my-=t.size,xy(t,t=>t(n)&&e.add(t)),my+=e.size,t=e)}}}function xy(e,t){e.forEach(e=>{try{t(e)}catch(e){ay.catch(e)}})}var by=Object.defineProperty,Sy={};function wy(){}((e,t)=>{for(var n in t)by(e,n,{get:t[n],enumerable:!0})})(Sy,{assign:()=>Ny,colors:()=>Fy,createStringInterpolator:()=>Py,skipAnimation:()=>Oy,to:()=>Dy,willAdvance:()=>Uy});var Cy={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function Ty(e,t){if(Cy.arr(e)){if(!Cy.arr(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e===t}var My=(e,t)=>e.forEach(t);function Iy(e,t,n){if(Cy.arr(e))for(let r=0;r<e.length;r++)t.call(n,e[r],`${r}`);else for(const r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r)}var Ry=e=>Cy.und(e)?[]:Cy.arr(e)?e:[e];function By(e,t){if(e.size){const n=Array.from(e);e.clear(),My(n,t)}}var Py,Dy,Ly=(e,...t)=>By(e,e=>e(...t)),ky=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Fy=null,Oy=!1,Uy=wy,Ny=e=>{e.to&&(Dy=e.to),e.now&&(ay.now=e.now),void 0!==e.colors&&(Fy=e.colors),null!=e.skipAnimation&&(Oy=e.skipAnimation),e.createStringInterpolator&&(Py=e.createStringInterpolator),e.requestAnimationFrame&&ay.use(e.requestAnimationFrame),e.batchedUpdates&&(ay.batchedUpdates=e.batchedUpdates),e.willAdvance&&(Uy=e.willAdvance),e.frameLoop&&(ay.frameLoop=e.frameLoop)},zy=new Set,Gy=[],Qy=[],Hy=0,Vy={get idle(){return!zy.size&&!Gy.length},start(e){Hy>e.priority?(zy.add(e),ay.onStart(jy)):(Wy(e),ay(Ky))},advance:Ky,sort(e){if(Hy)ay.onFrame(()=>Vy.sort(e));else{const t=Gy.indexOf(e);~t&&(Gy.splice(t,1),Yy(e))}},clear(){Gy=[],zy.clear()}};function jy(){zy.forEach(Wy),zy.clear(),ay(Ky)}function Wy(e){Gy.includes(e)||Yy(e)}function Yy(e){Gy.splice(function(e,t){const n=e.findIndex(t);return n<0?e.length:n}(Gy,t=>t.priority>e.priority),0,e)}function Ky(e){const t=Qy;for(let n=0;n<Gy.length;n++){const r=Gy[n];Hy=r.priority,r.idle||(Uy(r),r.advance(e),r.idle||t.push(r))}return Hy=0,(Qy=Gy).length=0,(Gy=t).length>0}var qy="[-+]?\\d*\\.?\\d+",Xy=qy+"%";function $y(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}var Jy=new RegExp("rgb"+$y(qy,qy,qy)),Zy=new RegExp("rgba"+$y(qy,qy,qy,qy)),eE=new RegExp("hsl"+$y(qy,Xy,Xy)),tE=new RegExp("hsla"+$y(qy,Xy,Xy,qy)),nE=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,rE=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,iE=/^#([0-9a-fA-F]{6})$/,sE=/^#([0-9a-fA-F]{8})$/;function aE(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function oE(e,t,n){const r=n<.5?n*(1+t):n+t-n*t,i=2*n-r,s=aE(i,r,e+1/3),a=aE(i,r,e),o=aE(i,r,e-1/3);return Math.round(255*s)<<24|Math.round(255*a)<<16|Math.round(255*o)<<8}function lE(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function cE(e){return(parseFloat(e)%360+360)%360/360}function uE(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function hE(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function dE(e){let t=function(e){let t;return"number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=iE.exec(e))?parseInt(t[1]+"ff",16)>>>0:Fy&&void 0!==Fy[e]?Fy[e]:(t=Jy.exec(e))?(lE(t[1])<<24|lE(t[2])<<16|lE(t[3])<<8|255)>>>0:(t=Zy.exec(e))?(lE(t[1])<<24|lE(t[2])<<16|lE(t[3])<<8|uE(t[4]))>>>0:(t=nE.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=sE.exec(e))?parseInt(t[1],16)>>>0:(t=rE.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=eE.exec(e))?(255|oE(cE(t[1]),hE(t[2]),hE(t[3])))>>>0:(t=tE.exec(e))?(oE(cE(t[1]),hE(t[2]),hE(t[3]))|uE(t[4]))>>>0:null}(e);if(null===t)return e;t=t||0;return`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`}var fE=(e,t,n)=>{if(Cy.fun(e))return e;if(Cy.arr(e))return fE({range:e,output:t,extrapolate:n});if(Cy.str(e.output[0]))return Py(e);const r=e,i=r.output,s=r.range||[0,1],a=r.extrapolateLeft||r.extrapolate||"extend",o=r.extrapolateRight||r.extrapolate||"extend",l=r.easing||(e=>e);return e=>{const t=function(e,t){for(var n=1;n<t.length-1&&!(t[n]>=e);++n);return n-1}(e,s);return function(e,t,n,r,i,s,a,o,l){let c=l?l(e):e;if(c<t){if("identity"===a)return c;"clamp"===a&&(c=t)}if(c>n){if("identity"===o)return c;"clamp"===o&&(c=n)}if(r===i)return r;if(t===n)return e<=t?r:i;t===-1/0?c=-c:n===1/0?c-=t:c=(c-t)/(n-t);c=s(c),r===-1/0?c=-c:i===1/0?c+=r:c=c*(i-r)+r;return c}(e,s[t],s[t+1],i[t],i[t+1],l,a,o,r.map)}};var pE=1.70158,mE=1.525*pE,gE=pE+1,AE=2*Math.PI/3,vE=2*Math.PI/4.5,yE=e=>{const t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},EE={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>gE*e*e*e-pE*e*e,easeOutBack:e=>1+gE*Math.pow(e-1,3)+pE*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-mE)/2:(Math.pow(2*e-2,2)*((mE+1)*(2*e-2)+mE)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*AE),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*AE)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*vE)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*vE)/2+1,easeInBounce:e=>1-yE(1-e),easeOutBounce:yE,easeInOutBounce:e=>e<.5?(1-yE(1-2*e))/2:(1+yE(2*e-1))/2,steps:(e,t="end")=>n=>{const r=(n="end"===t?Math.min(n,.999):Math.max(n,.001))*e;return((e,t,n)=>Math.min(Math.max(n,e),t))(0,1,("end"===t?Math.floor(r):Math.ceil(r))/e)}},_E=Symbol.for("FluidValue.get"),xE=Symbol.for("FluidValue.observers"),bE=e=>Boolean(e&&e[_E]),SE=e=>e&&e[_E]?e[_E]():e,wE=e=>e[xE]||null;function CE(e,t){const n=e[xE];n&&n.forEach(e=>{!function(e,t){e.eventObserved?e.eventObserved(t):e(t)}(e,t)})}var TE=class{constructor(e){if(!e&&!(e=this.get))throw Error("Unknown getter");ME(this,e)}},ME=(e,t)=>PE(e,_E,t);function IE(e,t){if(e[_E]){let n=e[xE];n||PE(e,xE,n=new Set),n.has(t)||(n.add(t),e.observerAdded&&e.observerAdded(n.size,t))}return t}function RE(e,t){const n=e[xE];if(n&&n.has(t)){const r=n.size-1;r?n.delete(t):e[xE]=null,e.observerRemoved&&e.observerRemoved(r,t)}}var BE,PE=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),DE=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,LE=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,kE=new RegExp(`(${DE.source})(%|[a-z]+)`,"i"),FE=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,OE=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,UE=e=>{const[t,n]=NE(e);if(!t||ky())return e;const r=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(r)return r.trim();if(n&&n.startsWith("--")){const t=window.getComputedStyle(document.documentElement).getPropertyValue(n);return t||e}return n&&OE.test(n)?UE(n):n||e},NE=e=>{const t=OE.exec(e);if(!t)return[,];const[,n,r]=t;return[n,r]},zE=(e,t,n,r,i)=>`rgba(${Math.round(t)}, ${Math.round(n)}, ${Math.round(r)}, ${i})`,GE=e=>{BE||(BE=Fy?new RegExp(`(${Object.keys(Fy).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map(e=>SE(e).replace(OE,UE).replace(LE,dE).replace(BE,dE)),n=t.map(e=>e.match(DE).map(Number)),r=n[0].map((e,t)=>n.map(e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})),i=r.map(t=>fE({...e,output:t}));return e=>{const n=!kE.test(t[0])&&t.find(e=>kE.test(e))?.replace(DE,"");let r=0;return t[0].replace(DE,()=>`${i[r++](e)}${n||""}`).replace(FE,zE)}},QE="react-spring: ",HE=e=>{const t=e;let n=!1;if("function"!=typeof t)throw new TypeError(`${QE}once requires a function parameter`);return(...e)=>{n||(t(...e),n=!0)}},VE=HE(console.warn);var jE=HE(console.warn);function WE(e){return Cy.str(e)&&("#"==e[0]||/\d/.test(e)||!ky()&&OE.test(e)||e in(Fy||{}))}var YE=ky()?s:a;function KE(){const e=o()[1],t=(()=>{const e=r(!1);return YE(()=>(e.current=!0,()=>{e.current=!1}),[]),e})();return()=>{t.current&&e(Math.random())}}var qE=e=>s(e,XE),XE=[];function $E(e){const t=r();return s(()=>{t.current=e}),t.current}var JE=Symbol.for("Animated:node"),ZE=e=>e&&e[JE],e_=(e,t)=>{return n=e,r=JE,i=t,Object.defineProperty(n,r,{value:i,writable:!0,configurable:!0});var n,r,i},t_=e=>e&&e[JE]&&e[JE].getPayload(),n_=class{constructor(){e_(this,this)}getPayload(){return this.payload||[]}},r_=class extends n_{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,Cy.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new r_(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return Cy.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,Cy.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},i_=class extends r_{constructor(e){super(0),this._string=null,this._toString=fE({output:[e,e]})}static create(e){return new i_(e)}getValue(){const e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(Cy.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=fE({output:[this.getValue(),e]})),this._value=0,super.reset()}},s_={dependencies:null},a_=class extends n_{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return Iy(this.source,(n,r)=>{var i;(i=n)&&i[JE]===i?t[r]=n.getValue(e):bE(n)?t[r]=SE(n):e||(t[r]=n)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&My(this.payload,e=>e.reset())}_makePayload(e){if(e){const t=new Set;return Iy(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){s_.dependencies&&bE(e)&&s_.dependencies.add(e);const t=t_(e);t&&My(t,e=>this.add(e))}},o_=class extends a_{constructor(e){super(e)}static create(e){return new o_(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const t=this.getPayload();return e.length==t.length?t.map((t,n)=>t.setValue(e[n])).some(Boolean):(super.setValue(e.map(l_)),!0)}};function l_(e){return(WE(e)?i_:r_).create(e)}function c_(e){const t=ZE(e);return t?t.constructor:Cy.arr(e)?o_:WE(e)?i_:r_}var u_=(t,n)=>{const i=!Cy.fun(t)||t.prototype&&t.prototype.isReactComponent;return c((a,o)=>{const l=r(null),c=i&&u(e=>{l.current=function(e,t){e&&(Cy.fun(e)?e(t):e.current=t);return t}(o,e)},[o]),[h,d]=function(e,t){const n=new Set;s_.dependencies=n,e.style&&(e={...e,style:t.createAnimatedStyle(e.style)});return e=new a_(e),s_.dependencies=null,[e,n]}(a,n),f=KE(),p=()=>{const e=l.current;if(i&&!e)return;!1===(!!e&&n.applyAnimatedValues(e,h.getValue(!0)))&&f()},m=new h_(p,d),g=r();YE(()=>(g.current=m,My(d,e=>IE(e,m)),()=>{g.current&&(My(g.current.deps,e=>RE(e,g.current)),ay.cancel(g.current.update))})),s(p,[]),qE(()=>()=>{const e=g.current;My(e.deps,t=>RE(t,e))});const A=n.getComponentProps(h.getValue());return e.createElement(t,{...A,ref:c})})},h_=class{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&ay.write(this.update)}};var d_=Symbol.for("AnimatedComponent"),f_=e=>Cy.str(e)?e:e&&Cy.str(e.displayName)?e.displayName:Cy.fun(e)&&e.name||null;function p_(e,...t){return Cy.fun(e)?e(...t):e}var m_=(e,t)=>!0===e||!!(t&&e&&(Cy.fun(e)?e(t):Ry(e).includes(t))),g_=(e,t)=>Cy.obj(e)?t&&e[t]:e,A_=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,v_=e=>e,y_=(e,t=v_)=>{let n=E_;e.default&&!0!==e.default&&(e=e.default,n=Object.keys(e));const r={};for(const i of n){const n=t(e[i],i);Cy.und(n)||(r[i]=n)}return r},E_=["config","onProps","onStart","onChange","onPause","onResume","onRest"],__={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function x_(e){const t=function(e){const t={};let n=0;if(Iy(e,(e,r)=>{__[r]||(t[r]=e,n++)}),n)return t}(e);if(t){const n={to:t};return Iy(e,(e,r)=>r in t||(n[r]=e)),n}return{...e}}function b_(e){return e=SE(e),Cy.arr(e)?e.map(b_):WE(e)?Sy.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function S_(e){return Cy.fun(e)||Cy.arr(e)&&Cy.obj(e[0])}var w_={tension:170,friction:26,mass:1,damping:1,easing:EE.linear,clamp:!1},C_=class{constructor(){this.velocity=0,Object.assign(this,w_)}};function T_(e,t){if(Cy.und(t.decay)){const n=!Cy.und(t.tension)||!Cy.und(t.friction);!n&&Cy.und(t.frequency)&&Cy.und(t.damping)&&Cy.und(t.mass)||(e.duration=void 0,e.decay=void 0),n&&(e.frequency=void 0)}else e.duration=void 0}var M_=[],I_=class{constructor(){this.changed=!1,this.values=M_,this.toValues=null,this.fromValues=M_,this.config=new C_,this.immediate=!1}};function R_(e,{key:t,props:n,defaultProps:r,state:i,actions:s}){return new Promise((a,o)=>{let l,c,u=m_(n.cancel??r?.cancel,t);if(u)f();else{Cy.und(n.pause)||(i.paused=m_(n.pause,t));let e=r?.pause;!0!==e&&(e=i.paused||m_(e,t)),l=p_(n.delay||0,t),e?(i.resumeQueue.add(d),s.pause()):(s.resume(),d())}function h(){i.resumeQueue.add(d),i.timeouts.delete(c),c.cancel(),l=c.time-ay.now()}function d(){l>0&&!Sy.skipAnimation?(i.delayed=!0,c=ay.setTimeout(f,l),i.pauseQueue.add(h),i.timeouts.add(c)):f()}function f(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(h),i.timeouts.delete(c),e<=(i.cancelId||0)&&(u=!0);try{s.start({...n,callId:e,cancel:u},a)}catch(e){o(e)}}})}var B_=(e,t)=>1==t.length?t[0]:t.some(e=>e.cancelled)?L_(e.get()):t.every(e=>e.noop)?P_(e.get()):D_(e.get(),t.every(e=>e.finished)),P_=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),D_=(e,t,n=!1)=>({value:e,finished:t,cancelled:n}),L_=e=>({value:e,cancelled:!0,finished:!1});function k_(e,t,n,r){const{callId:i,parentId:s,onRest:a}=t,{asyncTo:o,promise:l}=n;return s||e!==o||t.reset?n.promise=(async()=>{n.asyncId=i,n.asyncTo=e;const c=y_(t,(e,t)=>"onRest"===t?void 0:e);let u,h;const d=new Promise((e,t)=>(u=e,h=t)),f=e=>{const t=i<=(n.cancelId||0)&&L_(r)||i!==n.asyncId&&D_(r,!1);if(t)throw e.result=t,h(e),e},p=(e,t)=>{const s=new O_,a=new U_;return(async()=>{if(Sy.skipAnimation)throw F_(n),a.result=D_(r,!1),h(a),a;f(s);const o=Cy.obj(e)?{...e}:{...t,to:e};o.parentId=i,Iy(c,(e,t)=>{Cy.und(o[t])&&(o[t]=e)});const l=await r.start(o);return f(s),n.paused&&await new Promise(e=>{n.resumeQueue.add(e)}),l})()};let m;if(Sy.skipAnimation)return F_(n),D_(r,!1);try{let t;t=Cy.arr(e)?(async e=>{for(const t of e)await p(t)})(e):Promise.resolve(e(p,r.stop.bind(r))),await Promise.all([t.then(u),d]),m=D_(r.get(),!0,!1)}catch(e){if(e instanceof O_)m=e.result;else{if(!(e instanceof U_))throw e;m=e.result}}finally{i==n.asyncId&&(n.asyncId=s,n.asyncTo=s?o:void 0,n.promise=s?l:void 0)}return Cy.fun(a)&&ay.batchedUpdates(()=>{a(m,r,r.item)}),m})():l}function F_(e,t){By(e.timeouts,e=>e.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}var O_=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},U_=class extends Error{constructor(){super("SkipAnimationSignal")}},N_=e=>e instanceof G_,z_=1,G_=class extends TE{constructor(){super(...arguments),this.id=z_++,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=ZE(this);return e&&e.getValue()}to(...e){return Sy.to(this,e)}interpolate(...e){return VE(`${QE}The "interpolate" function is deprecated in v9 (use "to" instead)`),Sy.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){CE(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||Vy.sort(this),CE(this,{type:"priority",parent:this,priority:e})}},Q_=Symbol.for("SpringPhase"),H_=e=>(1&e[Q_])>0,V_=e=>(2&e[Q_])>0,j_=e=>(4&e[Q_])>0,W_=(e,t)=>t?e[Q_]|=3:e[Q_]&=-3,Y_=(e,t)=>t?e[Q_]|=4:e[Q_]&=-5,K_=class extends G_{constructor(e,t){if(super(),this.animation=new I_,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!Cy.und(e)||!Cy.und(t)){const n=Cy.obj(e)?{...e}:{...t,from:e};Cy.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(V_(this)||this._state.asyncTo)||j_(this)}get goal(){return SE(this.animation.to)}get velocity(){const e=ZE(this);return e instanceof r_?e.lastVelocity||0:e.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return H_(this)}get isAnimating(){return V_(this)}get isPaused(){return j_(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,n=!1;const r=this.animation;let{toValues:i}=r;const{config:s}=r,a=t_(r.to);!a&&bE(r.to)&&(i=Ry(SE(r.to))),r.values.forEach((o,l)=>{if(o.done)return;const c=o.constructor==i_?1:a?a[l].lastPosition:i[l];let u=r.immediate,h=c;if(!u){if(h=o.lastPosition,s.tension<=0)return void(o.done=!0);let t=o.elapsedTime+=e;const n=r.fromValues[l],i=null!=o.v0?o.v0:o.v0=Cy.arr(s.velocity)?s.velocity[l]:s.velocity;let a;const d=s.precision||(n==c?.005:Math.min(1,.001*Math.abs(c-n)));if(Cy.und(s.duration))if(s.decay){const e=!0===s.decay?.998:s.decay,r=Math.exp(-(1-e)*t);h=n+i/(1-e)*(1-r),u=Math.abs(o.lastPosition-h)<=d,a=i*r}else{a=null==o.lastVelocity?i:o.lastVelocity;const t=s.restVelocity||d/10,r=s.clamp?0:s.bounce,l=!Cy.und(r),f=n==c?o.v0>0:n<c;let p,m=!1;const g=1,A=Math.ceil(e/g);for(let e=0;e<A&&(p=Math.abs(a)>t,p||(u=Math.abs(c-h)<=d,!u));++e){l&&(m=h==c||h>c==f,m&&(a=-a*r,h=c));a+=(1e-6*-s.tension*(h-c)+.001*-s.friction*a)/s.mass*g,h+=a*g}}else{let r=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,o.durationProgress>0&&(o.elapsedTime=s.duration*o.durationProgress,t=o.elapsedTime+=e)),r=(s.progress||0)+t/this._memoizedDuration,r=r>1?1:r<0?0:r,o.durationProgress=r),h=n+s.easing(r)*(c-n),a=(h-o.lastPosition)/e,u=1==r}o.lastVelocity=a,Number.isNaN(h)&&(u=!0)}a&&!a[l].done&&(u=!1),u?o.done=!0:t=!1,o.setValue(h,s.round)&&(n=!0)});const o=ZE(this),l=o.getValue();if(t){const e=SE(r.to);l===e&&!n||s.decay?n&&s.decay&&this._onChange(l):(o.setValue(e),this._onChange(e)),this._stop()}else n&&this._onChange(l)}set(e){return ay.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(V_(this)){const{to:e,config:t}=this.animation;ay.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let n;return Cy.und(e)?(n=this.queue||[],this.queue=[]):n=[Cy.obj(e)?e:{...t,to:e}],Promise.all(n.map(e=>this._update(e))).then(e=>B_(this,e))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),F_(this._state,e&&this._lastCallId),ay.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:n,from:r}=e;n=Cy.obj(n)?n[t]:n,(null==n||S_(n))&&(n=void 0),r=Cy.obj(r)?r[t]:r,null==r&&(r=void 0);const i={to:n,from:r};return H_(this)||(e.reverse&&([n,r]=[r,n]),r=SE(r),Cy.und(r)?ZE(this)||this._set(n):this._set(r)),i}_update({...e},t){const{key:n,defaultProps:r}=this;e.default&&Object.assign(r,y_(e,(e,t)=>/^on/.test(t)?g_(e,n):e)),tx(this,e,"onProps"),nx(this,"onProps",e,this);const i=this._prepareNode(e);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return R_(++this._lastCallId,{key:n,props:e,defaultProps:r,state:s,actions:{pause:()=>{j_(this)||(Y_(this,!0),Ly(s.pauseQueue),nx(this,"onPause",D_(this,q_(this,this.animation.to)),this))},resume:()=>{j_(this)&&(Y_(this,!1),V_(this)&&this._resume(),Ly(s.resumeQueue),nx(this,"onResume",D_(this,q_(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(n=>{if(e.loop&&n.finished&&(!t||!n.noop)){const t=X_(e);if(t)return this._update(t,!0)}return n})}_merge(e,t,n){if(t.cancel)return this.stop(!0),n(L_(this));const r=!Cy.und(e.to),i=!Cy.und(e.from);if(r||i){if(!(t.callId>this._lastToId))return n(L_(this));this._lastToId=t.callId}const{key:s,defaultProps:a,animation:o}=this,{to:l,from:c}=o;let{to:u=l,from:h=c}=e;!i||r||t.default&&!Cy.und(u)||(u=h),t.reverse&&([u,h]=[h,u]);const d=!Ty(h,c);d&&(o.from=h),h=SE(h);const f=!Ty(u,l);f&&this._focus(u);const p=S_(t.to),{config:m}=o,{decay:g,velocity:A}=m;(r||i)&&(m.velocity=0),t.config&&!p&&function(e,t,n){n&&(T_(n={...n},t),t={...n,...t}),T_(e,t),Object.assign(e,t);for(const t in w_)null==e[t]&&(e[t]=w_[t]);let{frequency:r,damping:i}=e;const{mass:s}=e;Cy.und(r)||(r<.01&&(r=.01),i<0&&(i=0),e.tension=Math.pow(2*Math.PI/r,2)*s,e.friction=4*Math.PI*i*s/r)}(m,p_(t.config,s),t.config!==a.config?p_(a.config,s):void 0);let v=ZE(this);if(!v||Cy.und(u))return n(D_(this,!0));const y=Cy.und(t.reset)?i&&!t.default:!Cy.und(h)&&m_(t.reset,s),E=y?h:this.get(),_=b_(u),x=Cy.num(_)||Cy.arr(_)||WE(_),b=!p&&(!x||m_(a.immediate||t.immediate,s));if(f){const e=c_(u);if(e!==v.constructor){if(!b)throw Error(`Cannot animate between ${v.constructor.name} and ${e.name}, as the "to" prop suggests`);v=this._set(_)}}const S=v.constructor;let w=bE(u),C=!1;if(!w){const e=y||!H_(this)&&d;(f||e)&&(C=Ty(b_(E),_),w=!C),(Ty(o.immediate,b)||b)&&Ty(m.decay,g)&&Ty(m.velocity,A)||(w=!0)}if(C&&V_(this)&&(o.changed&&!y?w=!0:w||this._stop(l)),!p&&((w||bE(l))&&(o.values=v.getPayload(),o.toValues=bE(u)?null:S==i_?[1]:Ry(_)),o.immediate!=b&&(o.immediate=b,b||y||this._set(l)),w)){const{onRest:e}=o;My(ex,e=>tx(this,t,e));const r=D_(this,q_(this,l));Ly(this._pendingCalls,r),this._pendingCalls.add(n),o.changed&&ay.batchedUpdates(()=>{o.changed=!y,e?.(r,this),y?p_(a.onRest,r):o.onStart?.(r,this)})}y&&this._set(E),p?n(k_(t.to,t,this._state,this)):w?this._start():V_(this)&&!f?this._pendingCalls.add(n):n(P_(E))}_focus(e){const t=this.animation;e!==t.to&&(wE(this)&&this._detach(),t.to=e,wE(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;bE(t)&&(IE(t,this),N_(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;bE(e)&&RE(e,this)}_set(e,t=!0){const n=SE(e);if(!Cy.und(n)){const e=ZE(this);if(!e||!Ty(n,e.getValue())){const r=c_(n);e&&e.constructor==r?e.setValue(n):e_(this,r.create(n)),e&&ay.batchedUpdates(()=>{this._onChange(n,t)})}}return ZE(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,nx(this,"onStart",D_(this,q_(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),p_(this.animation.onChange,e,this)),p_(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;ZE(this).reset(SE(e.to)),e.immediate||(e.fromValues=e.values.map(e=>e.lastPosition)),V_(this)||(W_(this,!0),j_(this)||this._resume())}_resume(){Sy.skipAnimation?this.finish():Vy.start(this)}_stop(e,t){if(V_(this)){W_(this,!1);const n=this.animation;My(n.values,e=>{e.done=!0}),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),CE(this,{type:"idle",parent:this});const r=t?L_(this.get()):D_(this.get(),q_(this,e??n.to));Ly(this._pendingCalls,r),n.changed&&(n.changed=!1,nx(this,"onRest",r,this))}}};function q_(e,t){const n=b_(t);return Ty(b_(e.get()),n)}function X_(e,t=e.loop,n=e.to){const r=p_(t);if(r){const i=!0!==r&&x_(r),s=(i||e).reverse,a=!i||i.reset;return $_({...e,loop:t,default:!1,pause:void 0,to:!s||S_(n)?n:void 0,from:a?e.from:void 0,reset:a,...i})}}function $_(e){const{to:t,from:n}=e=x_(e),r=new Set;return Cy.obj(t)&&Z_(t,r),Cy.obj(n)&&Z_(n,r),e.keys=r.size?Array.from(r):null,e}function J_(e){const t=$_(e);return Cy.und(t.default)&&(t.default=y_(t)),t}function Z_(e,t){Iy(e,(e,n)=>null!=e&&t.add(n))}var ex=["onStart","onRest","onChange","onPause","onResume"];function tx(e,t,n){e.animation[n]=t[n]!==A_(t,n)?g_(t[n],e.key):void 0}function nx(e,t,...n){e.animation[t]?.(...n),e.defaultProps[t]?.(...n)}var rx=["onStart","onChange","onRest"],ix=1,sx=class{constructor(e,t){this.id=ix++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((t,n)=>e[n]=t.get()),e}set(e){for(const t in e){const n=e[t];Cy.und(n)||this.springs[t].set(n)}}update(e){return e&&this.queue.push($_(e)),this}start(e){let{queue:t}=this;return e?t=Ry(e).map($_):this.queue=[],this._flush?this._flush(this,t):(dx(this,t),ax(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const n=this.springs;My(Ry(t),t=>n[t].stop(!!e))}else F_(this._state,this._lastAsyncId),this.each(t=>t.stop(!!e));return this}pause(e){if(Cy.und(e))this.start({pause:!0});else{const t=this.springs;My(Ry(e),e=>t[e].pause())}return this}resume(e){if(Cy.und(e))this.start({pause:!1});else{const t=this.springs;My(Ry(e),e=>t[e].resume())}return this}each(e){Iy(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:n}=this._events,r=this._active.size>0,i=this._changed.size>0;(r&&!this._started||i&&!this._started)&&(this._started=!0,By(e,([e,t])=>{t.value=this.get(),e(t,this,this._item)}));const s=!r&&this._started,a=i||s&&n.size?this.get():null;i&&t.size&&By(t,([e,t])=>{t.value=a,e(t,this,this._item)}),s&&(this._started=!1,By(n,([e,t])=>{t.value=a,e(t,this,this._item)}))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}ay.onFrame(this._onFrame)}};function ax(e,t){return Promise.all(t.map(t=>ox(e,t))).then(t=>B_(e,t))}async function ox(e,t,n){const{keys:r,to:i,from:s,loop:a,onRest:o,onResolve:l}=t,c=Cy.obj(t.default)&&t.default;a&&(t.loop=!1),!1===i&&(t.to=null),!1===s&&(t.from=null);const u=Cy.arr(i)||Cy.fun(i)?i:void 0;u?(t.to=void 0,t.onRest=void 0,c&&(c.onRest=void 0)):My(rx,n=>{const r=t[n];if(Cy.fun(r)){const i=e._events[n];t[n]=({finished:e,cancelled:t})=>{const n=i.get(r);n?(e||(n.finished=!1),t&&(n.cancelled=!0)):i.set(r,{value:null,finished:e||!1,cancelled:t||!1})},c&&(c[n]=t[n])}});const h=e._state;t.pause===!h.paused?(h.paused=t.pause,Ly(t.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(t.pause=!0);const d=(r||Object.keys(e.springs)).map(n=>e.springs[n].start(t)),f=!0===t.cancel||!0===A_(t,"cancel");(u||f&&h.asyncId)&&d.push(R_(++e._lastAsyncId,{props:t,state:h,actions:{pause:wy,resume:wy,start(t,n){f?(F_(h,e._lastAsyncId),n(L_(e))):(t.onRest=o,n(k_(u,t,h,e)))}}})),h.paused&&await new Promise(e=>{h.resumeQueue.add(e)});const p=B_(e,await Promise.all(d));if(a&&p.finished&&(!n||!p.noop)){const n=X_(t,a,i);if(n)return dx(e,[n]),ox(e,n,!0)}return l&&ay.batchedUpdates(()=>l(p,e,e.item)),p}function lx(e,t){const n={...e.springs};return t&&My(Ry(t),e=>{Cy.und(e.keys)&&(e=$_(e)),Cy.obj(e.to)||(e={...e,to:void 0}),hx(n,e,e=>ux(e))}),cx(e,n),n}function cx(e,t){Iy(t,(t,n)=>{e.springs[n]||(e.springs[n]=t,IE(t,e))})}function ux(e,t){const n=new K_;return n.key=e,t&&IE(n,t),n}function hx(e,t,n){t.keys&&My(t.keys,r=>{(e[r]||(e[r]=n(r)))._prepareNode(t)})}function dx(e,t){My(t,t=>{hx(e.springs,t,t=>ux(t,e))})}var fx=({children:t,...n})=>{const i=h(px),a=n.pause||!!i.pause,l=n.immediate||!!i.immediate;n=function(e,t){const[n]=o(()=>({inputs:t,result:e()})),i=r(),a=i.current;let l=a;if(l){const n=Boolean(t&&l.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,l.inputs));n||(l={inputs:t,result:e()})}else l=n;return s(()=>{i.current=l,a==n&&(n.inputs=n.result=void 0)},[l]),l.result}(()=>({pause:a,immediate:l}),[a,l]);const{Provider:c}=px;return e.createElement(c,{value:n},t)},px=function(t,n){return Object.assign(t,e.createContext(n)),t.Provider._context=t,t.Consumer._context=t,t}(fx,{});fx.Provider=px.Provider,fx.Consumer=px.Consumer;var mx=()=>{const e=[],t=function(t){jE(`${QE}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`);const r=[];return My(e,(e,i)=>{if(Cy.und(t))r.push(e.start());else{const s=n(t,e,i);s&&r.push(e.start(s))}}),r};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){const n=e.indexOf(t);~n&&e.splice(n,1)},t.pause=function(){return My(e,e=>e.pause(...arguments)),this},t.resume=function(){return My(e,e=>e.resume(...arguments)),this},t.set=function(t){My(e,(e,n)=>{const r=Cy.fun(t)?t(n,e):t;r&&e.set(r)})},t.start=function(t){const n=[];return My(e,(e,r)=>{if(Cy.und(t))n.push(e.start());else{const i=this._getProps(t,e,r);i&&n.push(e.start(i))}}),n},t.stop=function(){return My(e,e=>e.stop(...arguments)),this},t.update=function(t){return My(e,(e,n)=>e.update(this._getProps(t,e,n))),this};const n=function(e,t,n){return Cy.fun(e)?e(n,t):e};return t._getProps=n,t};function gx(e,t){const n=Cy.fun(e),[[i],s]=function(e,t,n){const i=Cy.fun(t)&&t;i&&!n&&(n=[]);const s=l(()=>i||3==arguments.length?mx():void 0,[]),a=r(0),o=KE(),c=l(()=>({ctrls:[],queue:[],flush(e,t){const n=lx(e,t);return a.current>0&&!c.queue.length&&!Object.keys(n).some(t=>!e.springs[t])?ax(e,t):new Promise(r=>{cx(e,n),c.queue.push(()=>{r(ax(e,t))}),o()})}}),[]),u=r([...c.ctrls]),d=[],f=$E(e)||0;function p(e,n){for(let r=e;r<n;r++){const e=u.current[r]||(u.current[r]=new sx(null,c.flush)),n=i?i(r,e):t[r];n&&(d[r]=J_(n))}}l(()=>{My(u.current.slice(e,f),e=>{!function(e,t){e.ref?.delete(e),t?.delete(e)}(e,s),e.stop(!0)}),u.current.length=e,p(f,e)},[e]),l(()=>{p(0,Math.min(f,e))},n);const m=u.current.map((e,t)=>lx(e,d[t])),g=h(fx),A=$E(g),v=g!==A&&function(e){for(const t in e)return!0;return!1}(g);YE(()=>{a.current++,c.ctrls=u.current;const{queue:e}=c;e.length&&(c.queue=[],My(e,e=>e())),My(u.current,(e,t)=>{s?.add(e),v&&e.start({default:g});const n=d[t];n&&(function(e,t){t&&e.ref!==t&&(e.ref?.delete(e),t.add(e),e.ref=t)}(e,n.ref),e.ref?e.queue.push(n):e.start(n))})}),qE(()=>()=>{My(c.ctrls,e=>e.stop(!0))});const y=m.map(e=>({...e}));return s?[y,s]:y}(1,n?e:[e],n?t||[]:t);return n||2==arguments.length?[i,s]:i}var Ax=class extends G_{constructor(e,t){super(),this.source=e,this.idle=!0,this._active=new Set,this.calc=fE(...t);const n=this._get(),r=c_(n);e_(this,r.create(n))}advance(e){const t=this._get();Ty(t,this.get())||(ZE(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&yx(this._active)&&Ex(this)}_get(){const e=Cy.arr(this.source)?this.source.map(SE):Ry(SE(this.source));return this.calc(...e)}_start(){this.idle&&!yx(this._active)&&(this.idle=!1,My(t_(this),e=>{e.done=!1}),Sy.skipAnimation?(ay.batchedUpdates(()=>this.advance()),Ex(this)):Vy.start(this))}_attach(){let e=1;My(Ry(this.source),t=>{bE(t)&&IE(t,this),N_(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){My(Ry(this.source),e=>{bE(e)&&RE(e,this)}),this._active.clear(),Ex(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=Ry(this.source).reduce((e,t)=>Math.max(e,(N_(t)?t.priority:0)+1),0))}};function vx(e){return!1!==e.idle}function yx(e){return!e.size||Array.from(e).every(vx)}function Ex(e){e.idle||(e.idle=!0,My(t_(e),e=>{e.done=!0}),CE(e,{type:"idle",parent:e}))}Sy.assign({createStringInterpolator:GE,to:(e,t)=>new Ax(e,t)});var _x=["primitive"].concat(Object.keys($d).filter(e=>/^[A-Z]/.test(e)).map(e=>e[0].toLowerCase()+e.slice(1)));Sy.assign({createStringInterpolator:GE,colors:{transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},frameLoop:"demand"}),Rp(()=>{ay.advance()});var xx=((e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:n=e=>new a_(e),getComponentProps:r=e=>e}={})=>{const i={applyAnimatedValues:t,createAnimatedStyle:n,getComponentProps:r},s=e=>{const t=f_(e)||"Anonymous";return(e=Cy.str(e)?s[e]||(s[e]=u_(e,i)):e[d_]||(e[d_]=u_(e,i))).displayName=`Animated(${t})`,e};return Iy(e,(t,n)=>{Cy.arr(e)&&(n=f_(t)),s[n]=s(t)}),{animated:s}})(_x,{applyAnimatedValues:Xp}),bx=xx.animated;function Sx({enabled:t=!0,snap:n,global:r,domElement:i,cursor:s=!0,children:a,speed:o=1,rotation:l=[0,0,0],zoom:c=1,polar:u=[0,Math.PI/2],azimuth:h=[-1/0,1/0],config:d={mass:1,tension:170,friction:26}}){const f=zp(e=>e.events),p=zp(e=>e.gl),m=i||f.connected||p.domElement,{size:g}=zp(),A=e.useMemo(()=>[l[0]+u[0],l[0]+u[1]],[l[0],u[0],u[1]]),v=e.useMemo(()=>[l[1]+h[0],l[1]+h[1]],[l[1],h[0],h[1]]),y=e.useMemo(()=>[tn.clamp(l[0],...A),tn.clamp(l[1],...v),l[2]],[l[0],l[1],l[2],A,v]),[E,_]=gx(()=>({scale:1,rotation:y,config:d}));e.useEffect(()=>{_.start({scale:1,rotation:y,config:d})},[y]),e.useEffect(()=>{if(r&&s&&t)return m.style.cursor="grab",p.domElement.style.cursor="",()=>{m.style.cursor="default",p.domElement.style.cursor="default"}},[r,s,m,t]);const x=vA({onHover:({last:e})=>{s&&!r&&t&&(m.style.cursor=e?"auto":"grab")},onDrag:({down:e,delta:[r,i],memo:[a,l]=E.rotation.animation.to||y})=>{if(!t)return[i,r];s&&(m.style.cursor=e?"grabbing":"grab"),r=tn.clamp(l+r/g.width*Math.PI*o,...v),i=tn.clamp(a+i/g.height*Math.PI*o,...A);const u=n&&!e&&"boolean"!=typeof n?n:d;return _.start({scale:e&&i>A[1]/2?c:1,rotation:n&&!e?y:[i,r,0],config:e=>"scale"===e?{...u,friction:3*u.friction}:u}),[i,r]}},{target:r?m:void 0});return e.createElement(bx.group,Lm({},null==x?void 0:x(),E),a)}const wx=e=>(t,n,r)=>{const i=r.subscribe;r.subscribe=(e,t,n)=>{let s=e;if(t){const i=(null==n?void 0:n.equalityFn)||Object.is;let a=e(r.getState());s=n=>{const r=e(n);if(!i(a,r)){const e=a;t(a=r,e)}},(null==n?void 0:n.fireImmediately)&&t(a,a)}return i(s)};return e(t,n,r)},Cx=e.createContext(null);function Tx({map:t,children:n,onChange:r,domElement:i}){const s=t.map(e=>e.name+e.keys).join("-"),a=e.useMemo(()=>eg(wx(()=>t.reduce((e,t)=>({...e,[t.name]:!1}),{}))),[s]),o=e.useMemo(()=>[a.subscribe,a.getState,a],[s]),l=a.setState;return e.useEffect(()=>{const e=t.map(({name:e,keys:t,up:n})=>({keys:t,up:n,fn:t=>{l({[e]:t}),r&&r(e,t,o[1]())}})).reduce((e,{keys:t,fn:n,up:r=!0})=>(t.forEach(t=>e[t]={fn:n,pressed:!1,up:r}),e),{}),n=({key:t,code:n})=>{const r=e[t]||e[n];if(!r)return;const{fn:i,pressed:s,up:a}=r;r.pressed=!0,!a&&s||i(!0)},s=({key:t,code:n})=>{const r=e[t]||e[n];if(!r)return;const{fn:i,up:s}=r;r.pressed=!1,s&&i(!1)},a=i||window;return a.addEventListener("keydown",n,{passive:!0}),a.addEventListener("keyup",s,{passive:!0}),()=>{a.removeEventListener("keydown",n),a.removeEventListener("keyup",s)}},[i,s]),e.createElement(Cx.Provider,{value:o,children:n})}function Mx(t){const[n,r,i]=e.useContext(Cx);return t?i(t):[n,r]}const Ix=(()=>parseInt(E.replace(/\D+/g,"")))(),Rx=Ix>=125?"uv1":"uv2";var Bx=Object.defineProperty,Px=(e,t,n)=>(((e,t,n)=>{t in e?Bx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const Dx=1024,Lx=(e,t,n,r,i,s)=>{const a=e.image,{data:o}=a,l=4096*s;o[4*t+l+0]=n,o[4*t+l+1]=r,o[4*t+l+2]=i,o[4*t+l+3]=1};class kx{constructor(e,t=1){Px(this,"curveArray"),Px(this,"curveLengthArray"),Px(this,"object3D"),Px(this,"splineTexure"),Px(this,"uniforms");const n=e.clone(),r=((e=1)=>{const t=new Float32Array(4096*e*4),n=new wl(t,Dx,4*e,ye,pe);return n.wrapS=J,n.wrapT=J,n.magFilter=te,n.needsUpdate=!0,n})(t),i={spineTexture:{value:r},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}};n.traverse(e=>{(e instanceof Ui||e instanceof Ol)&&(e.material=e.material.clone(),function(e,t,n=1){e.__ok||(e.__ok=!0,e.onBeforeCompile=e=>{if(e.__modified)return;e.__modified=!0,Object.assign(e.uniforms,t);const r=`\n\t\tuniform sampler2D spineTexture;\n\t\tuniform float pathOffset;\n\t\tuniform float pathSegment;\n\t\tuniform float spineOffset;\n\t\tuniform float spineLength;\n\t\tuniform int flow;\n\n\t\tfloat textureLayers = ${4*n}.;\n\t\tfloat textureStacks = 1.;\n\n\t\t${e.vertexShader}\n\t\t`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,"\n        void main() {\n        #include <beginnormal_vertex>\n\n        vec4 worldPos = modelMatrix * vec4(position, 1.);\n\n        bool bend = flow > 0;\n        float xWeight = bend ? 0. : 1.;\n\n        #ifdef USE_INSTANCING\n        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];\n        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];\n        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;\n        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;\n        #else\n        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;\n        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;\n        #endif\n\n        mt = mod(mt, textureStacks);\n        float rowOffset = floor(mt);\n\n        #ifdef USE_INSTANCING\n        rowOffset += instanceMatrix[3][1] * 4.;\n        #endif\n\n        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;\n        mat3 basis = mat3(a, b, c);\n\n        vec3 transformed = basis\n          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)\n          + spinePos;\n\n        vec3 transformedNormal = normalMatrix * (basis * objectNormal);\n\t\t\t").replace("#include <project_vertex>","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\t\t\t\tgl_Position = projectionMatrix * mvPosition;");e.vertexShader=r})}(e.material,i,t))}),this.curveArray=new Array(t),this.curveLengthArray=new Array(t),this.object3D=n,this.splineTexure=r,this.uniforms=i}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");const n=t.getLength();this.uniforms.spineLength.value=n,this.curveLengthArray[e]=n,this.curveArray[e]=t,((e,t,n=0)=>{const r=Math.floor(1024);t.arcLengthDivisions=r/2,t.updateArcLengths();const i=t.getSpacedPoints(r),s=t.computeFrenetFrames(r,!0);for(let t=0;t<r;t++){const r=Math.floor(t/Dx),a=t%Dx;let o=i[t];Lx(e,a,o.x,o.y,o.z,0+r+4*n),o=s.tangents[t],Lx(e,a,o.x,o.y,o.z,1+r+4*n),o=s.normals[t],Lx(e,a,o.x,o.y,o.z,2+r+4*n),o=s.binormals[t],Lx(e,a,o.x,o.y,o.z,3+r+4*n)}e.needsUpdate=!0})(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}function Fx(e,t){if(0===t)return e;if(2===t||1===t){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,i=[];if(n)if(2===t)for(let e=1;e<=r;e++)i.push(n.getX(0)),i.push(n.getX(e)),i.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(i.push(n.getX(e)),i.push(n.getX(e+1)),i.push(n.getX(e+2))):(i.push(n.getX(e+2)),i.push(n.getX(e+1)),i.push(n.getX(e)));i.length;const s=e.clone();return s.setIndex(i),s.clearGroups(),s}return e}function Ox(e,t=Math.PI/3){const n=Math.cos(t),r=100*(1+1e-10),i=[new Dn,new Dn,new Dn],s=new Dn,a=new Dn,o=new Dn,l=new Dn;function c(e){return`${~~(e.x*r)},${~~(e.y*r)},${~~(e.z*r)}`}const u=e.index?e.toNonIndexed():e,h=u.attributes.position,d={};for(let e=0,t=h.count/3;e<t;e++){const t=3*e,n=i[0].fromBufferAttribute(h,t+0),r=i[1].fromBufferAttribute(h,t+1),o=i[2].fromBufferAttribute(h,t+2);s.subVectors(o,r),a.subVectors(n,r);const l=(new Dn).crossVectors(s,a).normalize();for(let e=0;e<3;e++){const t=c(i[e]);t in d||(d[t]=[]),d[t].push(l)}}const f=new Float32Array(3*h.count),p=new ci(f,3,!1);for(let e=0,t=h.count/3;e<t;e++){const t=3*e,r=i[0].fromBufferAttribute(h,t+0),u=i[1].fromBufferAttribute(h,t+1),f=i[2].fromBufferAttribute(h,t+2);s.subVectors(f,u),a.subVectors(r,u),o.crossVectors(s,a).normalize();for(let e=0;e<3;e++){const r=d[c(i[e])];l.set(0,0,0);for(let e=0,t=r.length;e<t;e++){const t=r[e];o.dot(t)>n&&l.add(t)}l.normalize(),p.setXYZ(t+e,l.x,l.y,l.z)}}return u.setAttribute("normal",p),u}var Ux=Uint8Array,Nx=Uint16Array,zx=Uint32Array,Gx=new Ux([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qx=new Ux([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Hx=new Ux([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vx=function(e,t){for(var n=new Nx(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new zx(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},jx=Vx(Gx,2),Wx=jx[0],Yx=jx[1];Wx[28]=258,Yx[258]=28;for(var Kx=Vx(Qx,0)[0],qx=new Nx(32768),Xx=0;Xx<32768;++Xx){var $x=(43690&Xx)>>>1|(21845&Xx)<<1;$x=(61680&($x=(52428&$x)>>>2|(13107&$x)<<2))>>>4|(3855&$x)<<4,qx[Xx]=((65280&$x)>>>8|(255&$x)<<8)>>>1}var Jx=function(e,t,n){for(var r=e.length,i=0,s=new Nx(t);i<r;++i)++s[e[i]-1];var a,o=new Nx(t);for(i=0;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;if(n){a=new Nx(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],h=o[e[i]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)a[qx[h]>>>l]=c}else for(a=new Nx(r),i=0;i<r;++i)e[i]&&(a[i]=qx[o[e[i]-1]++]>>>15-e[i]);return a},Zx=new Ux(288);for(Xx=0;Xx<144;++Xx)Zx[Xx]=8;for(Xx=144;Xx<256;++Xx)Zx[Xx]=9;for(Xx=256;Xx<280;++Xx)Zx[Xx]=7;for(Xx=280;Xx<288;++Xx)Zx[Xx]=8;var eb=new Ux(32);for(Xx=0;Xx<32;++Xx)eb[Xx]=5;var tb=Jx(Zx,9,1),nb=Jx(eb,5,1),rb=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},ib=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},sb=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},ab=function(e){return(e/8|0)+(7&e&&1)},ob=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new Ux(0);var i=!t||n,s=!n||n.i;n||(n={}),t||(t=new Ux(3*r));var a=function(e){var n=t.length;if(e>n){var r=new Ux(Math.max(2*n,e));r.set(t),t=r}},o=n.f||0,l=n.p||0,c=n.b||0,u=n.l,h=n.d,d=n.m,f=n.n,p=8*r;do{if(!u){n.f=o=ib(e,l,1);var m=ib(e,l+1,3);if(l+=3,!m){var g=e[(T=ab(l)+4)-4]|e[T-3]<<8,A=T+g;if(A>r){if(s)throw"unexpected EOF";break}i&&a(c+g),t.set(e.subarray(T,A),c),n.b=c+=g,n.p=l=8*A;continue}if(1==m)u=tb,h=nb,d=9,f=5;else{if(2!=m)throw"invalid block type";var v=ib(e,l,31)+257,y=ib(e,l+10,15)+4,E=v+ib(e,l+5,31)+1;l+=14;for(var _=new Ux(E),x=new Ux(19),b=0;b<y;++b)x[Hx[b]]=ib(e,l+3*b,7);l+=3*y;var S=rb(x),w=(1<<S)-1,C=Jx(x,S,1);for(b=0;b<E;){var T,M=C[ib(e,l,w)];if(l+=15&M,(T=M>>>4)<16)_[b++]=T;else{var I=0,R=0;for(16==T?(R=3+ib(e,l,3),l+=2,I=_[b-1]):17==T?(R=3+ib(e,l,7),l+=3):18==T&&(R=11+ib(e,l,127),l+=7);R--;)_[b++]=I}}var B=_.subarray(0,v),P=_.subarray(v);d=rb(B),f=rb(P),u=Jx(B,d,1),h=Jx(P,f,1)}if(l>p){if(s)throw"unexpected EOF";break}}i&&a(c+131072);for(var D=(1<<d)-1,L=(1<<f)-1,k=l;;k=l){var F=(I=u[sb(e,l)&D])>>>4;if((l+=15&I)>p){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(F<256)t[c++]=F;else{if(256==F){k=l,u=null;break}var O=F-254;if(F>264){var U=Gx[b=F-257];O=ib(e,l,(1<<U)-1)+Wx[b],l+=U}var N=h[sb(e,l)&L],z=N>>>4;if(!N)throw"invalid distance";l+=15&N;P=Kx[z];if(z>3){U=Qx[z];P+=sb(e,l)&(1<<U)-1,l+=U}if(l>p){if(s)throw"unexpected EOF";break}i&&a(c+131072);for(var G=c+O;c<G;c+=4)t[c]=t[c-P],t[c+1]=t[c+1-P],t[c+2]=t[c+2-P],t[c+3]=t[c+3-P];c=G}}n.l=u,n.p=k,n.b=c,u&&(o=1,n.m=d,n.d=h,n.n=f)}while(!o);return c==t.length?t:function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof Nx?Nx:e instanceof zx?zx:Ux)(n-t);return r.set(e.subarray(t,n)),r}(t,0,c)},lb=new Ux(0);function cb(e,t){return ob((function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"}(e),e.subarray(2,-4)),t)}var ub="undefined"!=typeof TextDecoder&&new TextDecoder;try{ub.decode(lb,{stream:!0})}catch(eJ){}class hb extends Ui{constructor(e,t,n=!1,r=!1,i=1e4){const s=new Ei;super(s,t),this.isMarchingCubes=!0;const a=this,o=new Float32Array(36),l=new Float32Array(36),c=new Float32Array(36);function u(e,t,n){return e+(t-e)*n}function h(e,t,n,r,i,s,h,d,f,p){const m=(n-h)/(d-h),g=a.normal_cache;o[t+0]=r+m*a.delta,o[t+1]=i,o[t+2]=s,l[t+0]=u(g[e+0],g[e+3],m),l[t+1]=u(g[e+1],g[e+4],m),l[t+2]=u(g[e+2],g[e+5],m),c[t+0]=u(a.palette[3*f+0],a.palette[3*p+0],m),c[t+1]=u(a.palette[3*f+1],a.palette[3*p+1],m),c[t+2]=u(a.palette[3*f+2],a.palette[3*p+2],m)}function d(e,t,n,r,i,s,h,d,f,p){const m=(n-h)/(d-h),g=a.normal_cache;o[t+0]=r,o[t+1]=i+m*a.delta,o[t+2]=s;const A=e+3*a.yd;l[t+0]=u(g[e+0],g[A+0],m),l[t+1]=u(g[e+1],g[A+1],m),l[t+2]=u(g[e+2],g[A+2],m),c[t+0]=u(a.palette[3*f+0],a.palette[3*p+0],m),c[t+1]=u(a.palette[3*f+1],a.palette[3*p+1],m),c[t+2]=u(a.palette[3*f+2],a.palette[3*p+2],m)}function f(e,t,n,r,i,s,h,d,f,p){const m=(n-h)/(d-h),g=a.normal_cache;o[t+0]=r,o[t+1]=i,o[t+2]=s+m*a.delta;const A=e+3*a.zd;l[t+0]=u(g[e+0],g[A+0],m),l[t+1]=u(g[e+1],g[A+1],m),l[t+2]=u(g[e+2],g[A+2],m),c[t+0]=u(a.palette[3*f+0],a.palette[3*p+0],m),c[t+1]=u(a.palette[3*f+1],a.palette[3*p+1],m),c[t+2]=u(a.palette[3*f+2],a.palette[3*p+2],m)}function p(e){const t=3*e;0===a.normal_cache[t]&&(a.normal_cache[t+0]=a.field[e-1]-a.field[e+1],a.normal_cache[t+1]=a.field[e-a.yd]-a.field[e+a.yd],a.normal_cache[t+2]=a.field[e-a.zd]-a.field[e+a.zd])}function m(e,t,n,r,i){const s=r+1,u=r+a.yd,m=r+a.zd,A=s+a.yd,v=s+a.zd,y=r+a.yd+a.zd,E=s+a.yd+a.zd;let _=0;const x=a.field[r],b=a.field[s],S=a.field[u],w=a.field[A],C=a.field[m],T=a.field[v],M=a.field[y],I=a.field[E];x<i&&(_|=1),b<i&&(_|=2),S<i&&(_|=8),w<i&&(_|=4),C<i&&(_|=16),T<i&&(_|=32),M<i&&(_|=128),I<i&&(_|=64);const R=db[_];if(0===R)return 0;const B=a.delta,P=e+B,D=t+B,L=n+B;1&R&&(p(r),p(s),h(3*r,0,i,e,t,n,x,b,r,s)),2&R&&(p(s),p(A),d(3*s,3,i,P,t,n,b,w,s,A)),4&R&&(p(u),p(A),h(3*u,6,i,e,D,n,S,w,u,A)),8&R&&(p(r),p(u),d(3*r,9,i,e,t,n,x,S,r,u)),16&R&&(p(m),p(v),h(3*m,12,i,e,t,L,C,T,m,v)),32&R&&(p(v),p(E),d(3*v,15,i,P,t,L,T,I,v,E)),64&R&&(p(y),p(E),h(3*y,18,i,e,D,L,M,I,y,E)),128&R&&(p(m),p(y),d(3*m,21,i,e,t,L,C,M,m,y)),256&R&&(p(r),p(m),f(3*r,24,i,e,t,n,x,C,r,m)),512&R&&(p(s),p(v),f(3*s,27,i,P,t,n,b,T,s,v)),1024&R&&(p(A),p(E),f(3*A,30,i,P,D,n,w,I,A,E)),2048&R&&(p(u),p(y),f(3*u,33,i,e,D,n,S,M,u,y)),_<<=4;let k,F,O,U=0,N=0;for(;-1!=fb[_+N];)k=_+N,F=k+1,O=k+2,g(o,l,c,3*fb[k],3*fb[F],3*fb[O]),N+=3,U++;return U}function g(e,t,n,r,i,s){const o=3*a.count;if(a.positionArray[o+0]=e[r],a.positionArray[o+1]=e[r+1],a.positionArray[o+2]=e[r+2],a.positionArray[o+3]=e[i],a.positionArray[o+4]=e[i+1],a.positionArray[o+5]=e[i+2],a.positionArray[o+6]=e[s],a.positionArray[o+7]=e[s+1],a.positionArray[o+8]=e[s+2],!0===a.material.flatShading){const e=(t[r+0]+t[i+0]+t[s+0])/3,n=(t[r+1]+t[i+1]+t[s+1])/3,l=(t[r+2]+t[i+2]+t[s+2])/3;a.normalArray[o+0]=e,a.normalArray[o+1]=n,a.normalArray[o+2]=l,a.normalArray[o+3]=e,a.normalArray[o+4]=n,a.normalArray[o+5]=l,a.normalArray[o+6]=e,a.normalArray[o+7]=n,a.normalArray[o+8]=l}else a.normalArray[o+0]=t[r+0],a.normalArray[o+1]=t[r+1],a.normalArray[o+2]=t[r+2],a.normalArray[o+3]=t[i+0],a.normalArray[o+4]=t[i+1],a.normalArray[o+5]=t[i+2],a.normalArray[o+6]=t[s+0],a.normalArray[o+7]=t[s+1],a.normalArray[o+8]=t[s+2];if(a.enableUvs){const t=2*a.count;a.uvArray[t+0]=e[r+0],a.uvArray[t+1]=e[r+2],a.uvArray[t+2]=e[i+0],a.uvArray[t+3]=e[i+2],a.uvArray[t+4]=e[s+0],a.uvArray[t+5]=e[s+2]}a.enableColors&&(a.colorArray[o+0]=n[r+0],a.colorArray[o+1]=n[r+1],a.colorArray[o+2]=n[r+2],a.colorArray[o+3]=n[i+0],a.colorArray[o+4]=n[i+1],a.colorArray[o+5]=n[i+2],a.colorArray[o+6]=n[s+0],a.colorArray[o+7]=n[s+1],a.colorArray[o+8]=n[s+2]),a.count+=3}this.enableUvs=n,this.enableColors=r,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.palette=new Float32Array(3*this.size3),this.count=0;const t=3*i;this.positionArray=new Float32Array(3*t);const n=new ci(this.positionArray,3);n.setUsage(Ft),s.setAttribute("position",n),this.normalArray=new Float32Array(3*t);const r=new ci(this.normalArray,3);if(r.setUsage(Ft),s.setAttribute("normal",r),this.enableUvs){this.uvArray=new Float32Array(2*t);const e=new ci(this.uvArray,2);e.setUsage(Ft),s.setAttribute("uv",e)}if(this.enableColors){this.colorArray=new Float32Array(3*t);const e=new ci(this.colorArray,3);e.setUsage(Ft),s.setAttribute("color",e)}s.boundingSphere=new er(new Dn,1)},this.addBall=function(e,t,n,r,i,s){const a=Math.sign(r);r=Math.abs(r);const o=!(null==s);let l=new $r(e,t,n);if(o)try{l=s instanceof $r?s:Array.isArray(s)?new $r(Math.min(Math.abs(s[0]),1),Math.min(Math.abs(s[1]),1),Math.min(Math.abs(s[2]),1)):new $r(s)}catch(r){l=new $r(e,t,n)}const c=this.size*Math.sqrt(r/i),u=n*this.size,h=t*this.size,d=e*this.size;let f=Math.floor(u-c);f<1&&(f=1);let p=Math.floor(u+c);p>this.size-1&&(p=this.size-1);let m=Math.floor(h-c);m<1&&(m=1);let g=Math.floor(h+c);g>this.size-1&&(g=this.size-1);let A=Math.floor(d-c);A<1&&(A=1);let v,y,E,_,x,b,S,w,C,T,M,I=Math.floor(d+c);for(I>this.size-1&&(I=this.size-1),E=f;E<p;E++)for(x=this.size2*E,w=E/this.size-n,C=w*w,y=m;y<g;y++)for(_=x+this.size*y,S=y/this.size-t,T=S*S,v=A;v<I;v++)if(b=v/this.size-e,M=r/(1e-6+b*b+T+C)-i,M>0){this.field[_+v]+=M*a;const e=Math.sqrt((v-d)*(v-d)+(y-h)*(y-h)+(E-u)*(E-u))/c,t=1-e*e*e*(e*(6*e-15)+10);this.palette[3*(_+v)+0]+=l.r*t,this.palette[3*(_+v)+1]+=l.g*t,this.palette[3*(_+v)+2]+=l.b*t}},this.addPlaneX=function(e,t){const n=this.size,r=this.yd,i=this.zd,s=this.field;let a,o,l,c,u,h,d,f=n*Math.sqrt(e/t);for(f>n&&(f=n),a=0;a<f;a++)if(h=a/n,c=h*h,u=e/(1e-4+c)-t,u>0)for(o=0;o<n;o++)for(d=a+o*r,l=0;l<n;l++)s[i*l+d]+=u},this.addPlaneY=function(e,t){const n=this.size,r=this.yd,i=this.zd,s=this.field;let a,o,l,c,u,h,d,f,p=n*Math.sqrt(e/t);for(p>n&&(p=n),o=0;o<p;o++)if(h=o/n,c=h*h,u=e/(1e-4+c)-t,u>0)for(d=o*r,a=0;a<n;a++)for(f=d+a,l=0;l<n;l++)s[i*l+f]+=u},this.addPlaneZ=function(e,t){const n=this.size,r=this.yd,i=this.zd,s=this.field;let a,o,l,c,u,h,d,f,p=n*Math.sqrt(e/t);for(p>n&&(p=n),l=0;l<p;l++)if(h=l/n,c=h*h,u=e/(1e-4+c)-t,u>0)for(d=i*l,o=0;o<n;o++)for(f=d+o*r,a=0;a<n;a++)s[f+a]+=u},this.setCell=function(e,t,n,r){const i=this.size2*n+this.size*t+e;this.field[i]=r},this.getCell=function(e,t,n){const r=this.size2*n+this.size*t+e;return this.field[r]},this.blur=function(e=1){const t=this.field,n=t.slice(),r=this.size,i=this.size2;for(let s=0;s<r;s++)for(let a=0;a<r;a++)for(let o=0;o<r;o++){const l=i*o+r*a+s;let c=n[l],u=1;for(let t=-1;t<=1;t+=2){const l=t+s;if(!(l<0||l>=r))for(let t=-1;t<=1;t+=2){const s=t+a;if(!(s<0||s>=r))for(let t=-1;t<=1;t+=2){const a=t+o;if(a<0||a>=r)continue;u++,c+=e*(n[i*a+r*s+l]-c)/u}}}t[l]=c}},this.reset=function(){for(let e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0,this.palette[3*e]=this.palette[3*e+1]=this.palette[3*e+2]=0},this.update=function(){this.count=0;const e=this.size-2;for(let t=1;t<e;t++){const n=this.size2*t,r=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++){const i=n+this.size*t,s=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++){m((t-this.halfsize)/this.halfsize,s,r,i+t,this.isolation)}}}this.geometry.setDrawRange(0,this.count),s.getAttribute("position").needsUpdate=!0,s.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(s.getAttribute("uv").needsUpdate=!0),this.enableColors&&(s.getAttribute("color").needsUpdate=!0),this.count},this.init(e)}}const db=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),fb=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var pb=Object.defineProperty,mb=(e,t,n)=>(((e,t,n)=>{t in e?pb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class gb{constructor(e=Math){mb(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),mb(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),mb(this,"p",[]),mb(this,"perm",[]),mb(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),mb(this,"dot",(e,t,n)=>e[0]*t+e[1]*n),mb(this,"dot3",(e,t,n,r)=>e[0]*t+e[1]*n+e[2]*r),mb(this,"dot4",(e,t,n,r,i)=>e[0]*t+e[1]*n+e[2]*r+e[3]*i),mb(this,"noise",(e,t)=>{let n,r,i;const s=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+s),o=Math.floor(t+s),l=(3-Math.sqrt(3))/6,c=(a+o)*l,u=e-(a-c),h=t-(o-c);let d=0,f=1;u>h&&(d=1,f=0);const p=u-d+l,m=h-f+l,g=u-1+2*l,A=h-1+2*l,v=255&a,y=255&o,E=this.perm[v+this.perm[y]]%12,_=this.perm[v+d+this.perm[y+f]]%12,x=this.perm[v+1+this.perm[y+1]]%12;let b=.5-u*u-h*h;b<0?n=0:(b*=b,n=b*b*this.dot(this.grad3[E],u,h));let S=.5-p*p-m*m;S<0?r=0:(S*=S,r=S*S*this.dot(this.grad3[_],p,m));let w=.5-g*g-A*A;return w<0?i=0:(w*=w,i=w*w*this.dot(this.grad3[x],g,A)),70*(n+r+i)}),mb(this,"noise3d",(e,t,n)=>{let r,i,s,a;const o=(e+t+n)*(1/3),l=Math.floor(e+o),c=Math.floor(t+o),u=Math.floor(n+o),h=1/6,d=(l+c+u)*h,f=e-(l-d),p=t-(c-d),m=n-(u-d);let g,A,v,y,E,_;f>=p?p>=m?(g=1,A=0,v=0,y=1,E=1,_=0):f>=m?(g=1,A=0,v=0,y=1,E=0,_=1):(g=0,A=0,v=1,y=1,E=0,_=1):p<m?(g=0,A=0,v=1,y=0,E=1,_=1):f<m?(g=0,A=1,v=0,y=0,E=1,_=1):(g=0,A=1,v=0,y=1,E=1,_=0);const x=f-g+h,b=p-A+h,S=m-v+h,w=f-y+2*h,C=p-E+2*h,T=m-_+2*h,M=f-1+.5,I=p-1+.5,R=m-1+.5,B=255&l,P=255&c,D=255&u,L=this.perm[B+this.perm[P+this.perm[D]]]%12,k=this.perm[B+g+this.perm[P+A+this.perm[D+v]]]%12,F=this.perm[B+y+this.perm[P+E+this.perm[D+_]]]%12,O=this.perm[B+1+this.perm[P+1+this.perm[D+1]]]%12;let U=.6-f*f-p*p-m*m;U<0?r=0:(U*=U,r=U*U*this.dot3(this.grad3[L],f,p,m));let N=.6-x*x-b*b-S*S;N<0?i=0:(N*=N,i=N*N*this.dot3(this.grad3[k],x,b,S));let z=.6-w*w-C*C-T*T;z<0?s=0:(z*=z,s=z*z*this.dot3(this.grad3[F],w,C,T));let G=.6-M*M-I*I-R*R;return G<0?a=0:(G*=G,a=G*G*this.dot3(this.grad3[O],M,I,R)),32*(r+i+s+a)}),mb(this,"noise4d",(e,t,n,r)=>{const i=this.grad4,s=this.simplex,a=this.perm,o=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let c,u,h,d,f;const p=(e+t+n+r)*o,m=Math.floor(e+p),g=Math.floor(t+p),A=Math.floor(n+p),v=Math.floor(r+p),y=(m+g+A+v)*l,E=e-(m-y),_=t-(g-y),x=n-(A-y),b=r-(v-y),S=(E>_?32:0)+(E>x?16:0)+(_>x?8:0)+(E>b?4:0)+(_>b?2:0)+(x>b?1:0);let w,C,T,M,I,R,B,P,D,L,k,F;w=s[S][0]>=3?1:0,C=s[S][1]>=3?1:0,T=s[S][2]>=3?1:0,M=s[S][3]>=3?1:0,I=s[S][0]>=2?1:0,R=s[S][1]>=2?1:0,B=s[S][2]>=2?1:0,P=s[S][3]>=2?1:0,D=s[S][0]>=1?1:0,L=s[S][1]>=1?1:0,k=s[S][2]>=1?1:0,F=s[S][3]>=1?1:0;const O=E-w+l,U=_-C+l,N=x-T+l,z=b-M+l,G=E-I+2*l,Q=_-R+2*l,H=x-B+2*l,V=b-P+2*l,j=E-D+3*l,W=_-L+3*l,Y=x-k+3*l,K=b-F+3*l,q=E-1+4*l,X=_-1+4*l,$=x-1+4*l,J=b-1+4*l,Z=255&m,ee=255&g,te=255&A,ne=255&v,re=a[Z+a[ee+a[te+a[ne]]]]%32,ie=a[Z+w+a[ee+C+a[te+T+a[ne+M]]]]%32,se=a[Z+I+a[ee+R+a[te+B+a[ne+P]]]]%32,ae=a[Z+D+a[ee+L+a[te+k+a[ne+F]]]]%32,oe=a[Z+1+a[ee+1+a[te+1+a[ne+1]]]]%32;let le=.6-E*E-_*_-x*x-b*b;le<0?c=0:(le*=le,c=le*le*this.dot4(i[re],E,_,x,b));let ce=.6-O*O-U*U-N*N-z*z;ce<0?u=0:(ce*=ce,u=ce*ce*this.dot4(i[ie],O,U,N,z));let ue=.6-G*G-Q*Q-H*H-V*V;ue<0?h=0:(ue*=ue,h=ue*ue*this.dot4(i[se],G,Q,H,V));let he=.6-j*j-W*W-Y*Y-K*K;he<0?d=0:(he*=he,d=he*he*this.dot4(i[ae],j,W,Y,K));let de=.6-q*q-X*X-$*$-J*J;return de<0?f=0:(de*=de,f=de*de*this.dot4(i[oe],q,X,$,J)),27*(c+u+h+d+f)});for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let e=0;e<512;e++)this.perm[e]=this.p[255&e]}}var Ab=Object.defineProperty,vb=(e,t,n)=>(((e,t,n)=>{t in e?Ab(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const yb=(()=>{const e={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Dn},up:{value:new Dn(0,1,0)}},vertexShader:"\n      uniform vec3 sunPosition;\n      uniform float rayleigh;\n      uniform float turbidity;\n      uniform float mieCoefficient;\n      uniform vec3 up;\n\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      // constants for atmospheric scattering\n      const float e = 2.71828182845904523536028747135266249775724709369995957;\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      // wavelength of used primaries, according to preetham\n      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\n      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n      // mie stuff\n      // K coefficient for the primaries\n      const float v = 4.0;\n      const vec3 K = vec3( 0.686, 0.678, 0.666 );\n      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\n      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n      // earth shadow hack\n      // cutoffAngle = pi / 1.95;\n      const float cutoffAngle = 1.6110731556870734;\n      const float steepness = 1.5;\n      const float EE = 1000.0;\n\n      float sunIntensity( float zenithAngleCos ) {\n        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n      }\n\n      vec3 totalMie( float T ) {\n        float c = ( 0.2 * T ) * 10E-18;\n        return 0.434 * c * MieConst;\n      }\n\n      void main() {\n\n        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        gl_Position.z = gl_Position.w; // set z to camera.far\n\n        vSunDirection = normalize( sunPosition );\n\n        vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n      // extinction (absorbtion + out scattering)\n      // rayleigh coefficients\n        vBetaR = totalRayleigh * rayleighCoefficient;\n\n      // mie coefficients\n        vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n      }\n    ",fragmentShader:`\n      varying vec3 vWorldPosition;\n      varying vec3 vSunDirection;\n      varying float vSunfade;\n      varying vec3 vBetaR;\n      varying vec3 vBetaM;\n      varying float vSunE;\n\n      uniform float mieDirectionalG;\n      uniform vec3 up;\n\n      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n      // constants for atmospheric scattering\n      const float pi = 3.141592653589793238462643383279502884197169;\n\n      const float n = 1.0003; // refractive index of air\n      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\n\n      // optical length at zenith for molecules\n      const float rayleighZenithLength = 8.4E3;\n      const float mieZenithLength = 1.25E3;\n      // 66 arc seconds -> degrees, and the cosine of that\n      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n      // 3.0 / ( 16.0 * pi )\n      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n      // 1.0 / ( 4.0 * pi )\n      const float ONE_OVER_FOURPI = 0.07957747154594767;\n\n      float rayleighPhase( float cosTheta ) {\n        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n      }\n\n      float hgPhase( float cosTheta, float g ) {\n        float g2 = pow( g, 2.0 );\n        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n      }\n\n      void main() {\n\n        vec3 direction = normalize( vWorldPosition - cameraPos );\n\n      // optical length\n      // cutoff angle at 90 to avoid singularity in next formula.\n        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );\n        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n        float sR = rayleighZenithLength * inverse;\n        float sM = mieZenithLength * inverse;\n\n      // combined extinction factor\n        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n      // in scattering\n        float cosTheta = dot( direction, vSunDirection );\n\n        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n        vec3 betaRTheta = vBetaR * rPhase;\n\n        float mPhase = hgPhase( cosTheta, mieDirectionalG );\n        vec3 betaMTheta = vBetaM * mPhase;\n\n        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n      // nightsky\n        float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n        float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n        vec3 L0 = vec3( 0.1 ) * Fex;\n\n      // composition + solar disc\n        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n        gl_FragColor = vec4( retColor, 1.0 );\n\n      #include <tonemapping_fragment>\n      #include <${Ix>=154?"colorspace_fragment":"encodings_fragment"}>\n\n      }\n    `},t=new ji({name:"SkyShader",fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:Vi.clone(e.uniforms),side:1,depthWrite:!1});class n extends Ui{constructor(){super(new zi(1,1,1),t)}}return vb(n,"SkyShader",e),vb(n,"material",t),n})();class Eb extends Ui{constructor(e,t){var n,r;const i=(s=e)&&s.isCubeTexture;var s;const a=(null!=(r=i?null==(n=e.image[0])?void 0:n.width:e.image.width)?r:1024)/4,o=Math.floor(Math.log2(a)),l=Math.pow(2,o),c=[i?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH "+1/(3*Math.max(l,112)),"#define CUBEUV_TEXEL_HEIGHT "+1/(4*l),`#define CUBEUV_MAX_MIP ${o}.0`].join("\n")+`\n        #define ENVMAP_TYPE_CUBE_UV\n        varying vec3 vWorldPosition;\n        uniform float radius;\n        uniform float height;\n        uniform float angle;\n        #ifdef ENVMAP_TYPE_CUBE\n            uniform samplerCube map;\n        #else\n            uniform sampler2D map;\n        #endif\n        // From: https://www.shadertoy.com/view/4tsBD7\n        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) \n        {\n            float d = dot ( rd, n );\n            \n            if( d > 0.0 ) { return 1e6; }\n            \n            vec3  o = ro - c;\n            float t = - dot( n, o ) / d;\n            vec3  q = o + rd * t;\n            \n            return ( dot( q, q ) < r * r ) ? t : 1e6;\n        }\n        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\n        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) \n        {\n            vec3 oc = ro - ce;\n            float b = dot( oc, rd );\n            float c = dot( oc, oc ) - ra * ra;\n            float h = b * b - c;\n            \n            if( h < 0.0 ) { return -1.0; }\n            \n            h = sqrt( h );\n            \n            return - b + h;\n        }\n        vec3 project() \n        {\n            vec3 p = normalize( vWorldPosition );\n            vec3 camPos = cameraPosition;\n            camPos.y -= height;\n            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );\n            if( intersection > 0.0 ) {\n                \n                vec3 h = vec3( 0.0, - height, 0.0 );\n                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );\n                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;\n            } else {\n                p = vec3( 0.0, 1.0, 0.0 );\n            }\n            return p;\n        }\n        #include <common>\n        #include <cube_uv_reflection_fragment>\n        void main() \n        {\n            vec3 projectedWorldPosition = project();\n            \n            #ifdef ENVMAP_TYPE_CUBE\n                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;\n            #else\n                vec3 direction = normalize( projectedWorldPosition );\n                vec2 uv = equirectUv( direction );\n                vec3 outcolor = texture2D( map, uv ).rgb;\n            #endif\n            gl_FragColor = vec4( outcolor, 1.0 );\n            #include <tonemapping_fragment>\n            #include <${Ix>=154?"colorspace_fragment":"encodings_fragment"}>\n        }\n        `,u={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}};super(new gu(1,16),new ji({uniforms:u,fragmentShader:c,vertexShader:"\n        varying vec3 vWorldPosition;\n        void main() \n        {\n            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );\n            vWorldPosition = worldPosition.xyz;\n            \n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n        ",side:2}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}function _b(e,t,n={}){const r=new Dn,i=new Pn,s=new Dn,a=new cr,o=new cr,l=new cr;n.preserveMatrix=void 0===n.preserveMatrix||n.preserveMatrix,n.preservePosition=void 0===n.preservePosition||n.preservePosition,n.preserveHipPosition=void 0!==n.preserveHipPosition&&n.preserveHipPosition,n.useTargetMatrix=void 0!==n.useTargetMatrix&&n.useTargetMatrix,n.hip=void 0!==n.hip?n.hip:"hip",n.names=n.names||{};const c=t.isObject3D?t.skeleton.bones:bb(t),u=e.isObject3D?e.skeleton.bones:bb(e);let h,d,f,p,m;if(e.isObject3D?e.skeleton.pose():(n.useTargetMatrix=!0,n.preserveMatrix=!1),n.preservePosition){m=[];for(let e=0;e<u.length;e++)m.push(u[e].position.clone())}if(n.preserveMatrix){e.updateMatrixWorld(),e.matrixWorld.identity();for(let t=0;t<e.children.length;++t)e.children[t].updateMatrixWorld(!0)}if(n.offsets){h=[];for(let e=0;e<u.length;++e)d=u[e],f=n.names[d.name]||d.name,n.offsets[f]&&(d.matrix.multiply(n.offsets[f]),d.matrix.decompose(d.position,d.quaternion,d.scale),d.updateMatrixWorld()),h.push(d.matrixWorld.clone())}for(let t=0;t<u.length;++t){if(d=u[t],f=n.names[d.name]||d.name,p=xb(f,c),l.copy(d.matrixWorld),p){if(p.updateMatrixWorld(),n.useTargetMatrix?o.copy(p.matrixWorld):(o.copy(e.matrixWorld).invert(),o.multiply(p.matrixWorld)),s.setFromMatrixScale(o),o.scale(s.set(1/s.x,1/s.y,1/s.z)),l.makeRotationFromQuaternion(i.setFromRotationMatrix(o)),e.isObject3D){const t=u.indexOf(d),n=h?h[t]:a.copy(e.skeleton.boneInverses[t]).invert();l.multiply(n)}l.copyPosition(o)}d.parent&&d.parent.isBone?(d.matrix.copy(d.parent.matrixWorld).invert(),d.matrix.multiply(l)):d.matrix.copy(l),n.preserveHipPosition&&f===n.hip&&d.matrix.setPosition(r.set(0,d.position.y,0)),d.matrix.decompose(d.position,d.quaternion,d.scale),d.updateMatrixWorld()}if(n.preservePosition)for(let e=0;e<u.length;++e)d=u[e],f=n.names[d.name]||d.name,f!==n.hip&&d.position.copy(m[e]);n.preserveMatrix&&e.updateMatrixWorld(!0)}function xb(e,t){for(let n=0,r=bb(t);n<r.length;n++)if(e===r[n].name)return r[n]}function bb(e){return Array.isArray(e)?e:e.bones}function Sb(e,t,n){n(e,t);for(let r=0;r<e.children.length;r++)Sb(e.children[r],t.children[r],n)}const wb={retarget:_b,retargetClip:function(e,t,n,r={}){r.useFirstFramePosition=void 0!==r.useFirstFramePosition&&r.useFirstFramePosition,r.fps=void 0!==r.fps?r.fps:30,r.names=r.names||[],t.isObject3D||(t=function(e){const t=new Dd(e.bones[0]);return t.skeleton=e,t}(t));const i=Math.round(n.duration*(r.fps/1e3)*1e3),s=1/r.fps,a=[],o=new gd(t),l=bb(e.skeleton),c=[];let u,h,d,f,p;o.clipAction(n).play(),o.update(0),t.updateMatrixWorld();for(let n=0;n<i;++n){const a=n*s;_b(e,t,r);for(let e=0;e<l.length;++e)p=r.names[l[e].name]||l[e].name,d=xb(p,t.skeleton),d&&(h=l[e],f=c[e]=c[e]||{bone:h},r.hip===p&&(f.pos||(f.pos={times:new Float32Array(i),values:new Float32Array(3*i)}),r.useFirstFramePosition&&(0===n&&(u=h.position.clone()),h.position.sub(u)),f.pos.times[n]=a,h.position.toArray(f.pos.values,3*n)),f.quat||(f.quat={times:new Float32Array(i),values:new Float32Array(4*i)}),f.quat.times[n]=a,h.quaternion.toArray(f.quat.values,4*n));o.update(s),t.updateMatrixWorld()}for(let e=0;e<c.length;++e)f=c[e],f&&(f.pos&&a.push(new th(".bones["+f.bone.name+"].position",f.pos.times,f.pos.values)),a.push(new Zu(".bones["+f.bone.name+"].quaternion",f.quat.times,f.quat.values)));return o.uncacheAction(n),new nh(n.name,-1,a)},clone:function(e){const t=new Map,n=new Map,r=e.clone();return Sb(e,r,function(e,r){t.set(r,e),n.set(e,r)}),r.traverse(function(e){if(!e.isSkinnedMesh)return;const r=e,i=t.get(e),s=i.skeleton.bones;r.skeleton=i.skeleton.clone(),r.bindMatrix.copy(i.bindMatrix),r.skeleton.bones=s.map(function(e){return n.get(e)}),r.bind(r.skeleton,r.bindMatrix)}),r}},Cb=new Wr,Tb=new Dn;class Mb{constructor(e){let t=e.geometry;t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,t=this.weightAttribute,n=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let i=1;t&&(i=t.getX(r)+t.getX(r+1)+t.getX(r+2)),Cb.a.fromBufferAttribute(e,r),Cb.b.fromBufferAttribute(e,r+1),Cb.c.fromBufferAttribute(e,r+2),i*=Cb.getArea(),n[r/3]=i}this.distribution=new Float32Array(e.count/3);let r=0;for(let e=0;e<n.length;e++)r+=n[e],this.distribution[e]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,n){const r=this.sampleFaceIndex();return this.sampleFace(r,e,t,n)}sampleFaceIndex(){const e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){const t=this.distribution;let n=0,r=t.length-1,i=-1;for(;n<=r;){const s=Math.ceil((n+r)/2);if(0===s||t[s-1]<=e&&t[s]>e){i=s;break}e<t[s]?r=s-1:n=s+1}return i}sampleFace(e,t,n,r){let i=this.randomFunction(),s=this.randomFunction();return i+s>1&&(i=1-i,s=1-s),Cb.a.fromBufferAttribute(this.positionAttribute,3*e),Cb.b.fromBufferAttribute(this.positionAttribute,3*e+1),Cb.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(Cb.a,i).addScaledVector(Cb.b,s).addScaledVector(Cb.c,1-(i+s)),void 0!==n&&Cb.getNormal(n),void 0!==r&&void 0!==this.colorAttribute&&(Cb.a.fromBufferAttribute(this.colorAttribute,3*e),Cb.b.fromBufferAttribute(this.colorAttribute,3*e+1),Cb.c.fromBufferAttribute(this.colorAttribute,3*e+2),Tb.set(0,0,0).addScaledVector(Cb.a,i).addScaledVector(Cb.b,s).addScaledVector(Cb.c,1-(i+s)),r.r=Tb.x,r.g=Tb.y,r.b=Tb.z),this}}var Ib=Object.defineProperty,Rb=(e,t,n)=>(((e,t,n)=>{t in e?Ib(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class Bb{constructor(){Rb(this,"_listeners")}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}var Pb=Object.defineProperty,Db=(e,t,n)=>(((e,t,n)=>{t in e?Pb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const Lb=new Dn;class kb extends Bb{constructor(e,t){super(),Db(this,"object"),Db(this,"domElement"),Db(this,"enabled",!0),Db(this,"movementSpeed",1),Db(this,"lookSpeed",.005),Db(this,"lookVertical",!0),Db(this,"autoForward",!1),Db(this,"activeLook",!0),Db(this,"heightSpeed",!1),Db(this,"heightCoef",1),Db(this,"heightMin",0),Db(this,"heightMax",1),Db(this,"constrainVertical",!1),Db(this,"verticalMin",0),Db(this,"verticalMax",Math.PI),Db(this,"mouseDragOn",!1),Db(this,"autoSpeedFactor",0),Db(this,"mouseX",0),Db(this,"mouseY",0),Db(this,"moveForward",!1),Db(this,"moveBackward",!1),Db(this,"moveLeft",!1),Db(this,"moveRight",!1),Db(this,"moveUp",!1),Db(this,"moveDown",!1),Db(this,"viewHalfX",0),Db(this,"viewHalfY",0),Db(this,"lat",0),Db(this,"lon",0),Db(this,"lookDirection",new Dn),Db(this,"spherical",new bd),Db(this,"target",new Dn),Db(this,"connect",e=>{e.setAttribute("tabindex","-1"),e.style.touchAction="none",e.addEventListener("contextmenu",this.contextmenu),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),this.domElement=e,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()}),Db(this,"dispose",()=>{var e,t,n,r;null==(e=this.domElement)||e.removeEventListener("contextmenu",this.contextmenu),null==(t=this.domElement)||t.removeEventListener("mousedown",this.onMouseDown),null==(n=this.domElement)||n.removeEventListener("mousemove",this.onMouseMove),null==(r=this.domElement)||r.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}),Db(this,"handleResize",()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}),Db(this,"onMouseDown",e=>{var t;if(null==(t=this.domElement)||t.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}),Db(this,"onMouseUp",e=>{if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}),Db(this,"onMouseMove",e=>{this.domElement&&(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)}),Db(this,"onKeyDown",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}),Db(this,"onKeyUp",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}),Db(this,"lookAt",(e,t,n)=>(e instanceof Dn?this.target.copy(e):t&&n&&this.target.set(e,t,n),this.object.lookAt(this.target),this.setOrientation(),this)),Db(this,"update",e=>{if(!this.enabled)return;if(this.heightSpeed){const t=tn.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let n=e*this.lookSpeed;this.activeLook||(n=0);let r=1;this.constrainVertical&&(r=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*n,this.lookVertical&&(this.lat-=this.mouseY*n*r),this.lat=Math.max(-85,Math.min(85,this.lat));let i=tn.degToRad(90-this.lat);const s=tn.degToRad(this.lon);this.constrainVertical&&(i=tn.mapLinear(i,0,Math.PI,this.verticalMin,this.verticalMax));const a=this.object.position;Lb.setFromSphericalCoords(1,i,s).add(a),this.object.lookAt(Lb)}),Db(this,"contextmenu",e=>e.preventDefault()),Db(this,"setOrientation",()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-tn.radToDeg(this.spherical.phi),this.lon=tn.radToDeg(this.spherical.theta)}),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}}var Fb=Object.defineProperty,Ob=(e,t,n)=>(((e,t,n)=>{t in e?Fb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class Ub extends Lr{constructor(e,t){super(),Ob(this,"isTransformControls",!0),Ob(this,"visible",!1),Ob(this,"domElement"),Ob(this,"raycaster",new Ed),Ob(this,"gizmo"),Ob(this,"plane"),Ob(this,"tempVector",new Dn),Ob(this,"tempVector2",new Dn),Ob(this,"tempQuaternion",new Pn),Ob(this,"unit",{X:new Dn(1,0,0),Y:new Dn(0,1,0),Z:new Dn(0,0,1)}),Ob(this,"pointStart",new Dn),Ob(this,"pointEnd",new Dn),Ob(this,"offset",new Dn),Ob(this,"rotationAxis",new Dn),Ob(this,"startNorm",new Dn),Ob(this,"endNorm",new Dn),Ob(this,"rotationAngle",0),Ob(this,"cameraPosition",new Dn),Ob(this,"cameraQuaternion",new Pn),Ob(this,"cameraScale",new Dn),Ob(this,"parentPosition",new Dn),Ob(this,"parentQuaternion",new Pn),Ob(this,"parentQuaternionInv",new Pn),Ob(this,"parentScale",new Dn),Ob(this,"worldPositionStart",new Dn),Ob(this,"worldQuaternionStart",new Pn),Ob(this,"worldScaleStart",new Dn),Ob(this,"worldPosition",new Dn),Ob(this,"worldQuaternion",new Pn),Ob(this,"worldQuaternionInv",new Pn),Ob(this,"worldScale",new Dn),Ob(this,"eye",new Dn),Ob(this,"positionStart",new Dn),Ob(this,"quaternionStart",new Pn),Ob(this,"scaleStart",new Dn),Ob(this,"camera"),Ob(this,"object"),Ob(this,"enabled",!0),Ob(this,"axis",null),Ob(this,"mode","translate"),Ob(this,"translationSnap",null),Ob(this,"rotationSnap",null),Ob(this,"scaleSnap",null),Ob(this,"space","world"),Ob(this,"size",1),Ob(this,"dragging",!1),Ob(this,"showX",!0),Ob(this,"showY",!0),Ob(this,"showZ",!0),Ob(this,"changeEvent",{type:"change"}),Ob(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),Ob(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),Ob(this,"objectChangeEvent",{type:"objectChange"}),Ob(this,"intersectObjectWithRay",(e,t,n)=>{const r=t.intersectObject(e,!0);for(let e=0;e<r.length;e++)if(r[e].object.visible||n)return r[e];return!1}),Ob(this,"attach",e=>(this.object=e,this.visible=!0,this)),Ob(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),Ob(this,"reset",()=>this.enabled?(this.dragging&&void 0!==this.object&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),Ob(this,"updateMatrixWorld",()=>{void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent||this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),Ob(this,"pointerHover",e=>{if(void 0===this.object||!0===this.dragging)return;this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);this.axis=t?t.object.name:null}),Ob(this,"pointerDown",e=>{if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){this.raycaster.setFromCamera(e,this.camera);const t=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(t){let e=this.space;if("scale"===this.mode?e="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(e="world"),"local"===e&&"rotate"===this.mode){const e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),Ob(this,"pointerMove",e=>{const t=this.axis,n=this.mode,r=this.object;let i=this.space;if("scale"===n?i="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(i="world"),void 0===r||null===t||!1===this.dragging||-1!==e.button)return;this.raycaster.setFromCamera(e,this.camera);const s=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===n)this.offset.copy(this.pointEnd).sub(this.pointStart),"local"===i&&"XYZ"!==t&&this.offset.applyQuaternion(this.worldQuaternionInv),-1===t.indexOf("X")&&(this.offset.x=0),-1===t.indexOf("Y")&&(this.offset.y=0),-1===t.indexOf("Z")&&(this.offset.z=0),"local"===i&&"XYZ"!==t?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),r.position.copy(this.offset).add(this.positionStart),this.translationSnap&&("local"===i&&(r.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this.quaternionStart)),"world"===i&&(r.parent&&r.position.add(this.tempVector.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(this.tempVector.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),this.tempVector2.set(e,e,e)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),-1===t.search("X")&&(this.tempVector2.x=1),-1===t.search("Y")&&(this.tempVector2.y=1),-1===t.search("Z")&&(this.tempVector2.z=1);r.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(-1!==t.search("X")&&(this.object.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this.offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(this.unit[t]),this.tempVector.copy(this.unit[t]),"local"===i&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===i&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(this.quaternionStart),r.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),r.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),Ob(this,"pointerUp",e=>{0===e.button&&(this.dragging&&null!==this.axis&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),Ob(this,"getPointer",e=>{var t;if(this.domElement&&(null==(t=this.domElement.ownerDocument)?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};{const t=e.changedTouches?e.changedTouches[0]:e,n=this.domElement.getBoundingClientRect();return{x:(t.clientX-n.left)/n.width*2-1,y:-(t.clientY-n.top)/n.height*2+1,button:e.button}}}),Ob(this,"onPointerHover",e=>{if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(e))}}),Ob(this,"onPointerDown",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(e)),this.pointerDown(this.getPointer(e)))}),Ob(this,"onPointerMove",e=>{this.enabled&&this.pointerMove(this.getPointer(e))}),Ob(this,"onPointerUp",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(e)))}),Ob(this,"getMode",()=>this.mode),Ob(this,"setMode",e=>{this.mode=e}),Ob(this,"setTranslationSnap",e=>{this.translationSnap=e}),Ob(this,"setRotationSnap",e=>{this.rotationSnap=e}),Ob(this,"setScaleSnap",e=>{this.scaleSnap=e}),Ob(this,"setSize",e=>{this.size=e}),Ob(this,"setSpace",e=>{this.space=e}),Ob(this,"update",()=>{}),Ob(this,"connect",e=>{document,this.domElement=e,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),Ob(this,"dispose",()=>{var e,t,n,r,i,s;null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointermove",this.onPointerHover),null==(r=null==(n=this.domElement)?void 0:n.ownerDocument)||r.removeEventListener("pointermove",this.onPointerMove),null==(s=null==(i=this.domElement)?void 0:i.ownerDocument)||s.removeEventListener("pointerup",this.onPointerUp),this.traverse(e=>{const t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new Nb,this.add(this.gizmo),this.plane=new zb,this.add(this.plane);const n=(e,t)=>{let n=t;Object.defineProperty(this,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),this[e]=t,this.plane[e]=t,this.gizmo[e]=t};n("camera",this.camera),n("object",this.object),n("enabled",this.enabled),n("axis",this.axis),n("mode",this.mode),n("translationSnap",this.translationSnap),n("rotationSnap",this.rotationSnap),n("scaleSnap",this.scaleSnap),n("space",this.space),n("size",this.size),n("dragging",this.dragging),n("showX",this.showX),n("showY",this.showY),n("showZ",this.showZ),n("worldPosition",this.worldPosition),n("worldPositionStart",this.worldPositionStart),n("worldQuaternion",this.worldQuaternion),n("worldQuaternionStart",this.worldQuaternionStart),n("cameraPosition",this.cameraPosition),n("cameraQuaternion",this.cameraQuaternion),n("pointStart",this.pointStart),n("pointEnd",this.pointEnd),n("rotationAxis",this.rotationAxis),n("rotationAngle",this.rotationAngle),n("eye",this.eye),void 0!==t&&this.connect(t)}}class Nb extends Lr{constructor(){super(),Ob(this,"isTransformControlsGizmo",!0),Ob(this,"type","TransformControlsGizmo"),Ob(this,"tempVector",new Dn(0,0,0)),Ob(this,"tempEuler",new yr),Ob(this,"alignVector",new Dn(0,1,0)),Ob(this,"zeroVector",new Dn(0,0,0)),Ob(this,"lookAtMatrix",new cr),Ob(this,"tempQuaternion",new Pn),Ob(this,"tempQuaternion2",new Pn),Ob(this,"identityQuaternion",new Pn),Ob(this,"unitX",new Dn(1,0,0)),Ob(this,"unitY",new Dn(0,1,0)),Ob(this,"unitZ",new Dn(0,0,1)),Ob(this,"gizmo"),Ob(this,"picker"),Ob(this,"helper"),Ob(this,"rotationAxis",new Dn),Ob(this,"cameraPosition",new Dn),Ob(this,"worldPositionStart",new Dn),Ob(this,"worldQuaternionStart",new Pn),Ob(this,"worldPosition",new Dn),Ob(this,"worldQuaternion",new Pn),Ob(this,"eye",new Dn),Ob(this,"camera",null),Ob(this,"enabled",!0),Ob(this,"axis",null),Ob(this,"mode","translate"),Ob(this,"space","world"),Ob(this,"size",1),Ob(this,"dragging",!1),Ob(this,"showX",!0),Ob(this,"showY",!0),Ob(this,"showZ",!0),Ob(this,"updateMatrixWorld",()=>{let e=this.space;"scale"===this.mode&&(e="local");const t="local"===e?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let e=0;e<n.length;e++){const r=n[e];let i;if(r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition),i=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(i*this.size/7),"helper"!==r.tag){if(r.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,n=.2,i=0;"X"!==r.name&&"XYZX"!==r.name||Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Y"!==r.name&&"XYZY"!==r.name||Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Z"!==r.name&&"XYZZ"!==r.name||Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XY"===r.name&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))<n&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"YZ"===r.name&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))<n&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XZ"===r.name&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))<n&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),-1!==r.name.search("X")&&(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye)<i?"fwd"===r.tag?r.visible=!1:r.scale.x*=-1:"bwd"===r.tag&&(r.visible=!1)),-1!==r.name.search("Y")&&(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye)<i?"fwd"===r.tag?r.visible=!1:r.scale.y*=-1:"bwd"===r.tag&&(r.visible=!1)),-1!==r.name.search("Z")&&(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye)<i?"fwd"===r.tag?r.visible=!1:r.scale.z*=-1:"bwd"===r.tag&&(r.visible=!1))}else"rotate"===this.mode&&(this.tempQuaternion2.copy(t),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(t).invert()),-1!==r.name.search("E")&&r.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),"X"===r.name&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),r.quaternion.copy(this.tempQuaternion)),"Y"===r.name&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),r.quaternion.copy(this.tempQuaternion)),"Z"===r.name&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),r.quaternion.copy(this.tempQuaternion)));r.visible=r.visible&&(-1===r.name.indexOf("X")||this.showX),r.visible=r.visible&&(-1===r.name.indexOf("Y")||this.showY),r.visible=r.visible&&(-1===r.name.indexOf("Z")||this.showZ),r.visible=r.visible&&(-1===r.name.indexOf("E")||this.showX&&this.showY&&this.showZ),r.material.tempOpacity=r.material.tempOpacity||r.material.opacity,r.material.tempColor=r.material.tempColor||r.material.color.clone(),r.material.color.copy(r.material.tempColor),r.material.opacity=r.material.tempOpacity,this.enabled?this.axis&&(r.name===this.axis||this.axis.split("").some(function(e){return r.name===e})?(r.material.opacity=1,r.material.color.lerp(new $r(1,1,1),.5)):(r.material.opacity*=.25,r.material.color.lerp(new $r(1,1,1),.5))):(r.material.opacity*=.5,r.material.color.lerp(new $r(1,1,1),.5))}else r.visible=!1,"AXIS"===r.name?(r.position.copy(this.worldPositionStart),r.visible=!!this.axis,"X"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),r.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Y"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),r.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Z"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),r.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"XYZE"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),r.quaternion.multiply(this.tempQuaternion),r.visible=this.dragging),"E"===this.axis&&(r.visible=!1)):"START"===r.name?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):"END"===r.name?(r.position.copy(this.worldPosition),r.visible=this.dragging):"DELTA"===r.name?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(this.tempVector),r.visible=this.dragging):(r.quaternion.copy(t),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=-1!==this.axis.search(r.name)))}super.updateMatrixWorld()});const e=new ti({depthTest:!1,depthWrite:!1,transparent:!0,side:2,fog:!1,toneMapped:!1}),t=new Ul({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=e.clone();n.opacity=.15;const r=e.clone();r.opacity=.33;const i=e.clone();i.color.set(16711680);const s=e.clone();s.color.set(65280);const a=e.clone();a.color.set(255);const o=e.clone();o.opacity=.25;const l=o.clone();l.color.set(16776960);const c=o.clone();c.color.set(65535);const u=o.clone();u.color.set(16711935);e.clone().color.set(16776960);const h=t.clone();h.color.set(16711680);const d=t.clone();d.color.set(65280);const f=t.clone();f.color.set(255);const p=t.clone();p.color.set(65535);const m=t.clone();m.color.set(16711935);const g=t.clone();g.color.set(16776960);const A=t.clone();A.color.set(7895160);const v=g.clone();v.opacity=.25;const y=new Rc(0,.05,.2,12,1,!1),E=new zi(.125,.125,.125),_=new Ei;_.setAttribute("position",new di([0,0,0,1,0,0],3));const x=(e,t)=>{const n=new Ei,r=[];for(let n=0;n<=64*t;++n)r.push(0,Math.cos(n/32*Math.PI)*e,Math.sin(n/32*Math.PI)*e);return n.setAttribute("position",new di(r,3)),n},b={X:[[new Ui(y,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new Ui(y,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new Vl(_,h)]],Y:[[new Ui(y,s),[0,1,0],null,null,"fwd"],[new Ui(y,s),[0,1,0],[Math.PI,0,0],null,"bwd"],[new Vl(_,d),null,[0,0,Math.PI/2]]],Z:[[new Ui(y,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new Ui(y,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new Vl(_,f),null,[0,-Math.PI/2,0]]],XYZ:[[new Ui(new Au(.1,0),o.clone()),[0,0,0],[0,0,0]]],XY:[[new Ui(new os(.295,.295),l.clone()),[.15,.15,0]],[new Vl(_,g),[.18,.3,0],null,[.125,1,1]],[new Vl(_,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Ui(new os(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new Vl(_,p),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new Vl(_,p),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Ui(new os(.295,.295),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new Vl(_,m),[.18,0,.3],null,[.125,1,1]],[new Vl(_,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},S={X:[[new Ui(new Rc(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Ui(new Rc(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new Ui(new Rc(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Ui(new Au(.2,0),n)]],XY:[[new Ui(new os(.4,.4),n),[.2,.2,0]]],YZ:[[new Ui(new os(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Ui(new os(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},w={START:[[new Ui(new Au(.01,2),r),null,null,null,"helper"]],END:[[new Ui(new Au(.01,2),r),null,null,null,"helper"]],DELTA:[[new Vl((()=>{const e=new Ei;return e.setAttribute("position",new di([0,0,0,1,1,1],3)),e})(),r),null,null,null,"helper"]],X:[[new Vl(_,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Vl(_,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Vl(_,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},C={X:[[new Vl(x(1,.5),h)],[new Ui(new Au(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new Vl(x(1,.5),d),null,[0,0,-Math.PI/2]],[new Ui(new Au(.04,0),s),[0,0,.99],null,[3,1,1]]],Z:[[new Vl(x(1,.5),f),null,[0,Math.PI/2,0]],[new Ui(new Au(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new Vl(x(1.25,1),v),null,[0,Math.PI/2,0]],[new Ui(new Rc(.03,0,.15,4,1,!1),v),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new Ui(new Rc(.03,0,.15,4,1,!1),v),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new Ui(new Rc(.03,0,.15,4,1,!1),v),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new Ui(new Rc(.03,0,.15,4,1,!1),v),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new Vl(x(1,1),A),null,[0,Math.PI/2,0]]]},T={AXIS:[[new Vl(_,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},M={X:[[new Ui(new xu(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Ui(new xu(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Ui(new xu(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Ui(new xu(1.25,.1,2,24),n)]],XYZE:[[new Ui(new Eu(.7,10,8),n)]]},I={X:[[new Ui(E,i),[.8,0,0],[0,0,-Math.PI/2]],[new Vl(_,h),null,null,[.8,1,1]]],Y:[[new Ui(E,s),[0,.8,0]],[new Vl(_,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new Ui(E,a),[0,0,.8],[Math.PI/2,0,0]],[new Vl(_,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new Ui(E,l),[.85,.85,0],null,[2,2,.2]],[new Vl(_,g),[.855,.98,0],null,[.125,1,1]],[new Vl(_,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Ui(E,c),[0,.85,.85],null,[.2,2,2]],[new Vl(_,p),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new Vl(_,p),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Ui(E,u),[.85,0,.85],null,[2,.2,2]],[new Vl(_,m),[.855,0,.98],null,[.125,1,1]],[new Vl(_,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new Ui(new zi(.125,.125,.125),o.clone()),[1.1,0,0]]],XYZY:[[new Ui(new zi(.125,.125,.125),o.clone()),[0,1.1,0]]],XYZZ:[[new Ui(new zi(.125,.125,.125),o.clone()),[0,0,1.1]]]},R={X:[[new Ui(new Rc(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new Ui(new Rc(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new Ui(new Rc(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new Ui(E,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new Ui(E,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new Ui(E,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new Ui(new zi(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new Ui(new zi(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new Ui(new zi(.2,.2,.2),n),[0,0,1.1]]]},B={X:[[new Vl(_,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Vl(_,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Vl(_,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P=e=>{const t=new Lr;for(let n in e)for(let r=e[n].length;r--;){const i=e[n][r][0].clone(),s=e[n][r][1],a=e[n][r][2],o=e[n][r][3],l=e[n][r][4];i.name=n,i.tag=l,s&&i.position.set(s[0],s[1],s[2]),a&&i.rotation.set(a[0],a[1],a[2]),o&&i.scale.set(o[0],o[1],o[2]),i.updateMatrix();const c=i.geometry.clone();c.applyMatrix4(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(b)),this.add(this.gizmo.rotate=P(C)),this.add(this.gizmo.scale=P(I)),this.add(this.picker.translate=P(S)),this.add(this.picker.rotate=P(M)),this.add(this.picker.scale=P(R)),this.add(this.helper.translate=P(w)),this.add(this.helper.rotate=P(T)),this.add(this.helper.scale=P(B)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class zb extends Ui{constructor(){super(new os(1e5,1e5,2,2),new ti({visible:!1,wireframe:!0,side:2,transparent:!0,opacity:.1,toneMapped:!1})),Ob(this,"isTransformControlsPlane",!0),Ob(this,"type","TransformControlsPlane"),Ob(this,"unitX",new Dn(1,0,0)),Ob(this,"unitY",new Dn(0,1,0)),Ob(this,"unitZ",new Dn(0,0,1)),Ob(this,"tempVector",new Dn),Ob(this,"dirVector",new Dn),Ob(this,"alignVector",new Dn),Ob(this,"tempMatrix",new cr),Ob(this,"identityQuaternion",new Pn),Ob(this,"cameraQuaternion",new Pn),Ob(this,"worldPosition",new Dn),Ob(this,"worldQuaternion",new Pn),Ob(this,"eye",new Dn),Ob(this,"axis",null),Ob(this,"mode","translate"),Ob(this,"space","world"),Ob(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),this.unitX.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0)}break;default:this.dirVector.set(0,0,0)}0===this.dirVector.length()?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}var Gb=Object.defineProperty,Qb=(e,t,n)=>(((e,t,n)=>{t in e?Gb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const Hb=new yr(0,0,0,"YXZ"),Vb=new Dn,jb={type:"change"},Wb={type:"lock"},Yb={type:"unlock"},Kb=Math.PI/2;class qb extends Bb{constructor(e,t){super(),Qb(this,"camera"),Qb(this,"domElement"),Qb(this,"isLocked"),Qb(this,"minPolarAngle"),Qb(this,"maxPolarAngle"),Qb(this,"pointerSpeed"),Qb(this,"onMouseMove",e=>{this.domElement&&!1!==this.isLocked&&(Hb.setFromQuaternion(this.camera.quaternion),Hb.y-=.002*e.movementX*this.pointerSpeed,Hb.x-=.002*e.movementY*this.pointerSpeed,Hb.x=Math.max(Kb-this.maxPolarAngle,Math.min(Kb-this.minPolarAngle,Hb.x)),this.camera.quaternion.setFromEuler(Hb),this.dispatchEvent(jb))}),Qb(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(Wb),this.isLocked=!0):(this.dispatchEvent(Yb),this.isLocked=!1))}),Qb(this,"onPointerlockError",()=>{}),Qb(this,"connect",e=>{this.domElement=e||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),Qb(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),Qb(this,"dispose",()=>{this.disconnect()}),Qb(this,"getObject",()=>this.camera),Qb(this,"direction",new Dn(0,0,-1)),Qb(this,"getDirection",e=>e.copy(this.direction).applyQuaternion(this.camera.quaternion)),Qb(this,"moveForward",e=>{Vb.setFromMatrixColumn(this.camera.matrix,0),Vb.crossVectors(this.camera.up,Vb),this.camera.position.addScaledVector(Vb,e)}),Qb(this,"moveRight",e=>{Vb.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(Vb,e)}),Qb(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),Qb(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}}var Xb=Object.defineProperty,$b=(e,t,n)=>(((e,t,n)=>{t in e?Xb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class Jb extends Bb{constructor(e){super(),$b(this,"object"),$b(this,"changeEvent",{type:"change"}),$b(this,"EPS",1e-6),$b(this,"enabled",!0),$b(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),$b(this,"screenOrientation",0),$b(this,"alphaOffset",0),$b(this,"onDeviceOrientationChangeEvent",e=>{this.deviceOrientation=e}),$b(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),$b(this,"zee",new Dn(0,0,1)),$b(this,"euler",new yr),$b(this,"q0",new Pn),$b(this,"q1",new Pn(-Math.sqrt(.5),0,0,Math.sqrt(.5))),$b(this,"setObjectQuaternion",(e,t,n,r,i)=>{this.euler.set(n,t,-r,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-i))}),$b(this,"connect",()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(e=>{}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),$b(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),$b(this,"lastQuaternion",new Pn),$b(this,"update",()=>{if(!1===this.enabled)return;const e=this.deviceOrientation;if(e){const t=e.alpha?tn.degToRad(e.alpha)+this.alphaOffset:0,n=e.beta?tn.degToRad(e.beta):0,r=e.gamma?tn.degToRad(e.gamma):0,i=this.screenOrientation?tn.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,n,r,i),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),$b(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}var Zb=Object.defineProperty,eS=(e,t,n)=>(((e,t,n)=>{t in e?Zb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class tS extends Bb{constructor(e,t){super(),eS(this,"enabled",!0),eS(this,"screen",{left:0,top:0,width:0,height:0}),eS(this,"rotateSpeed",1),eS(this,"zoomSpeed",1.2),eS(this,"panSpeed",.3),eS(this,"noRotate",!1),eS(this,"noZoom",!1),eS(this,"noPan",!1),eS(this,"staticMoving",!1),eS(this,"dynamicDampingFactor",.2),eS(this,"minDistance",0),eS(this,"maxDistance",1/0),eS(this,"keys",["KeyA","KeyS","KeyD"]),eS(this,"mouseButtons",{LEFT:_.ROTATE,MIDDLE:_.DOLLY,RIGHT:_.PAN}),eS(this,"object"),eS(this,"domElement"),eS(this,"cursorZoom",!1),eS(this,"target",new Dn),eS(this,"mousePosition",new nn),eS(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),eS(this,"EPS",1e-6),eS(this,"lastZoom",1),eS(this,"lastPosition",new Dn),eS(this,"cursorVector",new Dn),eS(this,"targetVector",new Dn),eS(this,"_state",this.STATE.NONE),eS(this,"_keyState",this.STATE.NONE),eS(this,"_eye",new Dn),eS(this,"_movePrev",new nn),eS(this,"_moveCurr",new nn),eS(this,"_lastAxis",new Dn),eS(this,"_lastAngle",0),eS(this,"_zoomStart",new nn),eS(this,"_zoomEnd",new nn),eS(this,"_touchZoomDistanceStart",0),eS(this,"_touchZoomDistanceEnd",0),eS(this,"_panStart",new nn),eS(this,"_panEnd",new nn),eS(this,"target0"),eS(this,"position0"),eS(this,"up0"),eS(this,"zoom0"),eS(this,"changeEvent",{type:"change"}),eS(this,"startEvent",{type:"start"}),eS(this,"endEvent",{type:"end"}),eS(this,"onScreenVector",new nn),eS(this,"getMouseOnScreen",(e,t)=>(this.onScreenVector.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),this.onScreenVector)),eS(this,"onCircleVector",new nn),eS(this,"getMouseOnCircle",(e,t)=>(this.onCircleVector.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),this.onCircleVector)),eS(this,"axis",new Dn),eS(this,"quaternion",new Pn),eS(this,"eyeDirection",new Dn),eS(this,"objectUpDirection",new Dn),eS(this,"objectSidewaysDirection",new Dn),eS(this,"moveDirection",new Dn),eS(this,"angle",0),eS(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),eS(this,"zoomCamera",()=>{let e;if(this._state===this.STATE.TOUCH_ZOOM_PAN)e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera&&(this.object.zoom/=e,this.object.updateProjectionMatrix());else{if(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,Math.abs(e-1)>this.EPS&&e>0&&(this.object.isPerspectiveCamera?(e>1&&this._eye.length()>=this.maxDistance-this.EPS&&(e=1),this._eye.multiplyScalar(e)):this.object.isOrthographicCamera&&(e>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(e=1),this.object.zoom/=e)),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let t=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(t,this.target,e)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),eS(this,"mouseChange",new nn),eS(this,"objectUp",new Dn),eS(this,"pan",new Dn),eS(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){const e=this.object,t=(e.right-e.left)/this.object.zoom,n=(e.top-e.bottom)/this.object.zoom;this.mouseChange.x*=t,this.mouseChange.y*=n}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),eS(this,"checkDistances",()=>{this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),eS(this,"handleResize",()=>{if(!this.domElement)return;const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}),eS(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera&&(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom))}),eS(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),eS(this,"keydown",e=>{!1!==this.enabled&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(e.code!==this.keys[this.STATE.ROTATE]||this.noRotate?e.code!==this.keys[this.STATE.ZOOM]||this.noZoom?e.code!==this.keys[this.STATE.PAN]||this.noPan||(this._keyState=this.STATE.PAN):this._keyState=this.STATE.ZOOM:this._keyState=this.STATE.ROTATE))}),eS(this,"onPointerDown",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseDown(e)}}),eS(this,"onPointerMove",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseMove(e)}}),eS(this,"onPointerUp",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseUp()}}),eS(this,"keyup",()=>{!1!==this.enabled&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),eS(this,"onMouseDown",e=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(e.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN}const t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||(this._panStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),eS(this,"onMouseMove",e=>{if(!1===this.enabled)return;const t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||this._panEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)))}),eS(this,"onMouseUp",()=>{this.domElement&&!1!==this.enabled&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),eS(this,"mousewheel",e=>{if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.mousePosition.x=e.offsetX/this.screen.width*2-1,this.mousePosition.y=-e.offsetY/this.screen.height*2+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),eS(this,"touchstart",e=>{if(!1!==this.enabled){if(e.preventDefault(),1===e.touches.length)this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr);else{this._state=this.STATE.TOUCH_ZOOM_PAN;const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+n*n);const r=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(r,i)),this._panEnd.copy(this._panStart)}this.dispatchEvent(this.startEvent)}}),eS(this,"touchmove",e=>{if(!1!==this.enabled)if(e.preventDefault(),1===e.touches.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));else{const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);const r=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(r,i))}}),eS(this,"touchend",e=>{if(!1!==this.enabled){switch(e.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(this.endEvent)}}),eS(this,"contextmenu",e=>{!1!==this.enabled&&e.preventDefault()}),eS(this,"connect",e=>{document,this.domElement=e,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),eS(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,void 0!==t&&this.connect(t),this.update()}}var nS=Object.defineProperty,rS=(e,t,n)=>(((e,t,n)=>{t in e?nS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const iS=new lr,sS=new ts,aS=Math.cos(Math.PI/180*70),oS=(e,t)=>(e%t+t)%t;class lS extends Bb{constructor(e,t){super(),rS(this,"object"),rS(this,"domElement"),rS(this,"enabled",!0),rS(this,"target",new Dn),rS(this,"minDistance",0),rS(this,"maxDistance",1/0),rS(this,"minZoom",0),rS(this,"maxZoom",1/0),rS(this,"minPolarAngle",0),rS(this,"maxPolarAngle",Math.PI),rS(this,"minAzimuthAngle",-1/0),rS(this,"maxAzimuthAngle",1/0),rS(this,"enableDamping",!1),rS(this,"dampingFactor",.05),rS(this,"enableZoom",!0),rS(this,"zoomSpeed",1),rS(this,"enableRotate",!0),rS(this,"rotateSpeed",1),rS(this,"enablePan",!0),rS(this,"panSpeed",1),rS(this,"screenSpacePanning",!0),rS(this,"keyPanSpeed",7),rS(this,"zoomToCursor",!1),rS(this,"autoRotate",!1),rS(this,"autoRotateSpeed",2),rS(this,"reverseOrbit",!1),rS(this,"reverseHorizontalOrbit",!1),rS(this,"reverseVerticalOrbit",!1),rS(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),rS(this,"mouseButtons",{LEFT:_.ROTATE,MIDDLE:_.DOLLY,RIGHT:_.PAN}),rS(this,"touches",{ONE:x.ROTATE,TWO:x.DOLLY_PAN}),rS(this,"target0"),rS(this,"position0"),rS(this,"zoom0"),rS(this,"_domElementKeyEvents",null),rS(this,"getPolarAngle"),rS(this,"getAzimuthalAngle"),rS(this,"setPolarAngle"),rS(this,"setAzimuthalAngle"),rS(this,"getDistance"),rS(this,"getZoomScale"),rS(this,"listenToKeyEvents"),rS(this,"stopListenToKeyEvents"),rS(this,"saveState"),rS(this,"reset"),rS(this,"update"),rS(this,"connect"),rS(this,"dispose"),rS(this,"dollyIn"),rS(this,"dollyOut"),rS(this,"getScale"),rS(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=e=>{let t=oS(e,2*Math.PI),r=c.phi;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.phi=t-r,n.update()},this.setAzimuthalAngle=e=>{let t=oS(e,2*Math.PI),r=c.theta;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.theta=t-r,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",J),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",J),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),o=a.NONE},this.update=(()=>{const t=new Dn,i=new Dn(0,1,0),s=(new Pn).setFromUnitVectors(e.up,i),f=s.clone().invert(),p=new Dn,m=new Pn,g=2*Math.PI;return function(){const A=n.object.position;s.setFromUnitVectors(e.up,i),f.copy(s).invert(),t.copy(A).sub(n.target),t.applyQuaternion(s),c.setFromVector3(t),n.autoRotate&&o===a.NONE&&R(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let v=n.minAzimuthAngle,y=n.maxAzimuthAngle;isFinite(v)&&isFinite(y)&&(v<-Math.PI?v+=g:v>Math.PI&&(v-=g),y<-Math.PI?y+=g:y>Math.PI&&(y-=g),c.theta=v<=y?Math.max(v,Math.min(y,c.theta)):c.theta>(v+y)/2?Math.max(v,c.theta):Math.min(y,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),n.zoomToCursor&&C||n.object.isOrthographicCamera?c.radius=N(c.radius):c.radius=N(c.radius*h),t.setFromSpherical(c),t.applyQuaternion(f),A.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),d.set(0,0,0));let E=!1;if(n.zoomToCursor&&C){let r=null;if(n.object instanceof Yi&&n.object.isPerspectiveCamera){const e=t.length();r=N(e*h);const i=e-r;n.object.position.addScaledVector(S,i),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const e=new Dn(w.x,w.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix(),E=!0;const i=new Dn(w.x,w.y,0);i.unproject(n.object),n.object.position.sub(i).add(e),n.object.updateMatrixWorld(),r=t.length()}else n.zoomToCursor=!1;null!==r&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(iS.origin.copy(n.object.position),iS.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(iS.direction))<aS?e.lookAt(n.target):(sS.setFromNormalAndCoplanarPoint(n.object.up,n.target),iS.intersectPlane(sS,n.target))))}else n.object instanceof vs&&n.object.isOrthographicCamera&&(E=1!==h,E&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix()));return h=1,C=!1,!!(E||p.distanceToSquared(n.object.position)>l||8*(1-m.dot(n.object.quaternion))>l)&&(n.dispatchEvent(r),p.copy(n.object.position),m.copy(n.object.quaternion),E=!1,!0)}})(),this.connect=e=>{n.domElement=e,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Z),n.domElement.addEventListener("pointerdown",K),n.domElement.addEventListener("pointercancel",X),n.domElement.addEventListener("wheel",$)},this.dispose=()=>{var e,t,r,i,s,a;n.domElement&&(n.domElement.style.touchAction="auto"),null==(e=n.domElement)||e.removeEventListener("contextmenu",Z),null==(t=n.domElement)||t.removeEventListener("pointerdown",K),null==(r=n.domElement)||r.removeEventListener("pointercancel",X),null==(i=n.domElement)||i.removeEventListener("wheel",$),null==(s=n.domElement)||s.ownerDocument.removeEventListener("pointermove",q),null==(a=n.domElement)||a.ownerDocument.removeEventListener("pointerup",X),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",J)};const n=this,r={type:"change"},i={type:"start"},s={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=a.NONE;const l=1e-6,c=new bd,u=new bd;let h=1;const d=new Dn,f=new nn,p=new nn,m=new nn,g=new nn,A=new nn,v=new nn,y=new nn,E=new nn,b=new nn,S=new Dn,w=new nn;let C=!1;const T=[],M={};function I(){return Math.pow(.95,n.zoomSpeed)}function R(e){n.reverseOrbit||n.reverseHorizontalOrbit?u.theta+=e:u.theta-=e}function B(e){n.reverseOrbit||n.reverseVerticalOrbit?u.phi+=e:u.phi-=e}const P=(()=>{const e=new Dn;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),d.add(e)}})(),D=(()=>{const e=new Dn;return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),d.add(e)}})(),L=(()=>{const e=new Dn;return function(t,r){const i=n.domElement;if(i&&n.object instanceof Yi&&n.object.isPerspectiveCamera){const s=n.object.position;e.copy(s).sub(n.target);let a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),P(2*t*a/i.clientHeight,n.object.matrix),D(2*r*a/i.clientHeight,n.object.matrix)}else i&&n.object instanceof vs&&n.object.isOrthographicCamera?(P(t*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),D(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):n.enablePan=!1}})();function k(e){n.object instanceof Yi&&n.object.isPerspectiveCamera||n.object instanceof vs&&n.object.isOrthographicCamera?h=e:n.enableZoom=!1}function F(e){k(h/e)}function O(e){k(h*e)}function U(e){if(!n.zoomToCursor||!n.domElement)return;C=!0;const t=n.domElement.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top,s=t.width,a=t.height;w.x=r/s*2-1,w.y=-i/a*2+1,S.set(w.x,w.y,1).unproject(n.object).sub(n.object.position).normalize()}function N(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function z(e){f.set(e.clientX,e.clientY)}function G(e){g.set(e.clientX,e.clientY)}function Q(){if(1==T.length)f.set(T[0].pageX,T[0].pageY);else{const e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);f.set(e,t)}}function H(){if(1==T.length)g.set(T[0].pageX,T[0].pageY);else{const e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);g.set(e,t)}}function V(){const e=T[0].pageX-T[1].pageX,t=T[0].pageY-T[1].pageY,n=Math.sqrt(e*e+t*t);y.set(0,n)}function j(e){if(1==T.length)p.set(e.pageX,e.pageY);else{const t=te(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(n,r)}m.subVectors(p,f).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(R(2*Math.PI*m.x/t.clientHeight),B(2*Math.PI*m.y/t.clientHeight)),f.copy(p)}function W(e){if(1==T.length)A.set(e.pageX,e.pageY);else{const t=te(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);A.set(n,r)}v.subVectors(A,g).multiplyScalar(n.panSpeed),L(v.x,v.y),g.copy(A)}function Y(e){const t=te(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);E.set(0,s),b.set(0,Math.pow(E.y/y.y,n.zoomSpeed)),F(b.y),y.copy(E)}function K(e){var t,r;!1!==n.enabled&&(0===T.length&&(null==(t=n.domElement)||t.ownerDocument.addEventListener("pointermove",q),null==(r=n.domElement)||r.ownerDocument.addEventListener("pointerup",X)),function(e){T.push(e)}(e),"touch"===e.pointerType?function(e){switch(ee(e),T.length){case 1:switch(n.touches.ONE){case x.ROTATE:if(!1===n.enableRotate)return;Q(),o=a.TOUCH_ROTATE;break;case x.PAN:if(!1===n.enablePan)return;H(),o=a.TOUCH_PAN;break;default:o=a.NONE}break;case 2:switch(n.touches.TWO){case x.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&V(),n.enablePan&&H(),o=a.TOUCH_DOLLY_PAN;break;case x.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&V(),n.enableRotate&&Q(),o=a.TOUCH_DOLLY_ROTATE;break;default:o=a.NONE}break;default:o=a.NONE}o!==a.NONE&&n.dispatchEvent(i)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case _.DOLLY:if(!1===n.enableZoom)return;!function(e){U(e),y.set(e.clientX,e.clientY)}(e),o=a.DOLLY;break;case _.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;G(e),o=a.PAN}else{if(!1===n.enableRotate)return;z(e),o=a.ROTATE}break;case _.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;z(e),o=a.ROTATE}else{if(!1===n.enablePan)return;G(e),o=a.PAN}break;default:o=a.NONE}o!==a.NONE&&n.dispatchEvent(i)}(e))}function q(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(ee(e),o){case a.TOUCH_ROTATE:if(!1===n.enableRotate)return;j(e),n.update();break;case a.TOUCH_PAN:if(!1===n.enablePan)return;W(e),n.update();break;case a.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&Y(e),n.enablePan&&W(e)}(e),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&Y(e),n.enableRotate&&j(e)}(e),n.update();break;default:o=a.NONE}}(e):function(e){if(!1===n.enabled)return;switch(o){case a.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),m.subVectors(p,f).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(R(2*Math.PI*m.x/t.clientHeight),B(2*Math.PI*m.y/t.clientHeight)),f.copy(p),n.update()}(e);break;case a.DOLLY:if(!1===n.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),b.subVectors(E,y),b.y>0?F(I()):b.y<0&&O(I()),y.copy(E),n.update()}(e);break;case a.PAN:if(!1===n.enablePan)return;!function(e){A.set(e.clientX,e.clientY),v.subVectors(A,g).multiplyScalar(n.panSpeed),L(v.x,v.y),g.copy(A),n.update()}(e)}}(e))}function X(e){var t,r,i;!function(e){delete M[e.pointerId];for(let t=0;t<T.length;t++)if(T[t].pointerId==e.pointerId)return void T.splice(t,1)}(e),0===T.length&&(null==(t=n.domElement)||t.releasePointerCapture(e.pointerId),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointermove",q),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointerup",X)),n.dispatchEvent(s),o=a.NONE}function $(e){!1===n.enabled||!1===n.enableZoom||o!==a.NONE&&o!==a.ROTATE||(e.preventDefault(),n.dispatchEvent(i),function(e){U(e),e.deltaY<0?O(I()):e.deltaY>0&&F(I()),n.update()}(e),n.dispatchEvent(s))}function J(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:L(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:L(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:L(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:L(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function Z(e){!1!==n.enabled&&e.preventDefault()}function ee(e){let t=M[e.pointerId];void 0===t&&(t=new nn,M[e.pointerId]=t),t.set(e.pageX,e.pageY)}function te(e){const t=e.pointerId===T[0].pointerId?T[1]:T[0];return M[t.pointerId]}this.dollyIn=(e=I())=>{O(e),n.update()},this.dollyOut=(e=I())=>{F(e),n.update()},this.getScale=()=>h,this.setScale=e=>{k(e),n.update()},this.getZoomScale=()=>I(),void 0!==t&&this.connect(t),this.update()}}class cS extends lS{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=_.PAN,this.mouseButtons.RIGHT=_.ROTATE,this.touches.ONE=x.PAN,this.touches.TWO=x.DOLLY_ROTATE}}var uS=Object.defineProperty,hS=(e,t,n)=>(((e,t,n)=>{t in e?uS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const dS={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},fS={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},pS={x:0,y:0},mS={camera:new cr,gizmos:new cr},gS={type:"change"},AS={type:"start"},vS={type:"end"};class yS extends Bb{constructor(e,t=null,n=null){super(),hS(this,"camera"),hS(this,"domElement"),hS(this,"scene"),hS(this,"mouseActions"),hS(this,"_mouseOp"),hS(this,"_v2_1"),hS(this,"_v3_1"),hS(this,"_v3_2"),hS(this,"_m4_1"),hS(this,"_m4_2"),hS(this,"_quat"),hS(this,"_translationMatrix"),hS(this,"_rotationMatrix"),hS(this,"_scaleMatrix"),hS(this,"_rotationAxis"),hS(this,"_cameraMatrixState"),hS(this,"_cameraProjectionState"),hS(this,"_fovState"),hS(this,"_upState"),hS(this,"_zoomState"),hS(this,"_nearPos"),hS(this,"_farPos"),hS(this,"_gizmoMatrixState"),hS(this,"_up0"),hS(this,"_zoom0"),hS(this,"_fov0"),hS(this,"_initialNear"),hS(this,"_nearPos0"),hS(this,"_initialFar"),hS(this,"_farPos0"),hS(this,"_cameraMatrixState0"),hS(this,"_gizmoMatrixState0"),hS(this,"_button"),hS(this,"_touchStart"),hS(this,"_touchCurrent"),hS(this,"_input"),hS(this,"_switchSensibility"),hS(this,"_startFingerDistance"),hS(this,"_currentFingerDistance"),hS(this,"_startFingerRotation"),hS(this,"_currentFingerRotation"),hS(this,"_devPxRatio"),hS(this,"_downValid"),hS(this,"_nclicks"),hS(this,"_downEvents"),hS(this,"_clickStart"),hS(this,"_maxDownTime"),hS(this,"_maxInterval"),hS(this,"_posThreshold"),hS(this,"_movementThreshold"),hS(this,"_currentCursorPosition"),hS(this,"_startCursorPosition"),hS(this,"_grid"),hS(this,"_gridPosition"),hS(this,"_gizmos"),hS(this,"_curvePts"),hS(this,"_timeStart"),hS(this,"_animationId"),hS(this,"focusAnimationTime"),hS(this,"_timePrev"),hS(this,"_timeCurrent"),hS(this,"_anglePrev"),hS(this,"_angleCurrent"),hS(this,"_cursorPosPrev"),hS(this,"_cursorPosCurr"),hS(this,"_wPrev"),hS(this,"_wCurr"),hS(this,"adjustNearFar"),hS(this,"scaleFactor"),hS(this,"dampingFactor"),hS(this,"wMax"),hS(this,"enableAnimations"),hS(this,"enableGrid"),hS(this,"cursorZoom"),hS(this,"minFov"),hS(this,"maxFov"),hS(this,"enabled"),hS(this,"enablePan"),hS(this,"enableRotate"),hS(this,"enableZoom"),hS(this,"minDistance"),hS(this,"maxDistance"),hS(this,"minZoom"),hS(this,"maxZoom"),hS(this,"target"),hS(this,"_currentTarget"),hS(this,"_tbRadius"),hS(this,"_state"),hS(this,"onWindowResize",()=>{const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e)}const t=this._tbRadius/e,n=new ac(0,0,t,t).getPoints(this._curvePts),r=(new Ei).setFromPoints(n);for(const e in this._gizmos.children){this._gizmos.children[e].geometry=r}this.dispatchEvent(gS)}),hS(this,"onContextMenu",e=>{if(this.enabled)for(let t=0;t<this.mouseActions.length;t++)if(2==this.mouseActions[t].mouse){e.preventDefault();break}}),hS(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=fS.NONE}),hS(this,"onPointerDown",e=>{if(0==e.button&&e.isPrimary?(this._downValid=!0,this._downEvents.push(e)):this._downValid=!1,"touch"==e.pointerType&&this._input!=fS.CURSOR)switch(this._touchStart.push(e),this._touchCurrent.push(e),this._input){case fS.NONE:this._input=fS.ONE_FINGER,this.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case fS.ONE_FINGER:case fS.ONE_FINGER_SWITCHED:this._input=fS.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case fS.TWO_FINGER:this._input=fS.MULT_FINGER,this.onTriplePanStart()}else if("touch"!=e.pointerType&&this._input==fS.NONE){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(e.button,t),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=fS.CURSOR,this._button=e.button,this.onSinglePanStart(e,this._mouseOp))}}),hS(this,"onPointerMove",e=>{if("touch"==e.pointerType&&this._input!=fS.CURSOR)switch(this._input){case fS.ONE_FINGER:this.updateTouchEvent(e),this.onSinglePanMove(e,dS.ROTATE);break;case fS.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],e)*this._devPxRatio>=this._switchSensibility){this._input=fS.ONE_FINGER,this.updateTouchEvent(e),this.onSinglePanStart(e,"ROTATE");break}break;case fS.TWO_FINGER:this.updateTouchEvent(e),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case fS.MULT_FINGER:this.updateTouchEvent(e),this.onTriplePanMove()}else if("touch"!=e.pointerType&&this._input==fS.CURSOR){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");const n=this.getOpStateFromAction(this._button,t);n&&this.onSinglePanMove(e,n)}if(this._downValid){this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],e)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}}),hS(this,"onPointerUp",e=>{if("touch"==e.pointerType&&this._input!=fS.CURSOR){const t=this._touchCurrent.length;for(let n=0;n<t;n++)if(this._touchCurrent[n].pointerId==e.pointerId){this._touchCurrent.splice(n,1),this._touchStart.splice(n,1);break}switch(this._input){case fS.ONE_FINGER:case fS.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=fS.NONE,this.onSinglePanEnd();break;case fS.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=fS.ONE_FINGER_SWITCHED;break;case fS.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=fS.NONE,this.onTriplePanEnd())}}else"touch"!=e.pointerType&&this._input==fS.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=fS.NONE,this.onSinglePanEnd(),this._button=-1);if(e.isPrimary)if(this._downValid){if(e.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{const t=e.timeStamp-this._clickStart,n=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;t<=this._maxInterval&&n<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(e)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}),hS(this,"onWheel",e=>{var t,n;if(this.enabled&&this.enableZoom&&this.domElement){let r=null;e.ctrlKey||e.metaKey?r="CTRL":e.shiftKey&&(r="SHIFT");const i=this.getOpFromAction("WHEEL",r);if(i){e.preventDefault(),this.dispatchEvent(AS);const r=125;let s=e.deltaY/r,a=1;switch(s>0?a=1/this.scaleFactor:s<0&&(a=this.scaleFactor),i){case"ZOOM":if(this.updateTbState(dS.SCALE,!0),s>0?a=1/Math.pow(this.scaleFactor,s):s<0&&(a=Math.pow(this.scaleFactor,-s)),this.cursorZoom&&this.enablePan){let r;this.camera instanceof vs&&(r=null==(t=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof Yi&&(r=null==(n=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:n.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),void 0!==r&&this.applyTransformMatrix(this.applyScale(a,r))}else this.applyTransformMatrix(this.applyScale(a,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(dS.IDLE,!1),this.dispatchEvent(gS),this.dispatchEvent(vS);break;case"FOV":if(this.camera instanceof Yi){this.updateTbState(dS.FOV,!0),0!=e.deltaX&&(s=e.deltaX/r,a=1,s>0?a=1/Math.pow(this.scaleFactor,s):s<0&&(a=Math.pow(this.scaleFactor,-s))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const t=this._v3_1.distanceTo(this._gizmos.position);let n=t/a;n=tn.clamp(n,this.minDistance,this.maxDistance);const i=t*Math.tan(tn.DEG2RAD*this.camera.fov*.5);let o=tn.RAD2DEG*(2*Math.atan(i/n));o>this.maxFov?o=this.maxFov:o<this.minFov&&(o=this.minFov);a=t/(i/Math.tan(tn.DEG2RAD*(o/2))),this.setFov(o),this.applyTransformMatrix(this.applyScale(a,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(dS.IDLE,!1),this.dispatchEvent(gS),this.dispatchEvent(vS)}}}}),hS(this,"onSinglePanStart",(e,t)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(AS),this.setCenter(e.clientX,e.clientY),t){case"PAN":if(!this.enablePan)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(gS)),this.camera){this.updateTbState(dS.PAN,!0);const e=this.unprojectOnTbPlane(this.camera,pS.x,pS.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(gS))}break;case"ROTATE":if(!this.enableRotate)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(dS.ROTATE,!0);const e=this.unprojectOnTbSurface(this.camera,pS.x,pS.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(gS);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof Yi&&(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(gS)),this.updateTbState(dS.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(pS.x,pS.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(gS)),this.updateTbState(dS.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(pS.x,pS.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),hS(this,"onSinglePanMove",(e,t)=>{if(this.enabled&&this.domElement){const n=t!=this._state;switch(this.setCenter(e.clientX,e.clientY),t){case dS.PAN:if(this.enablePan&&this.camera)if(n){this.dispatchEvent(vS),this.dispatchEvent(AS),this.updateTbState(t,!0);const e=this.unprojectOnTbPlane(this.camera,pS.x,pS.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{const e=this.unprojectOnTbPlane(this.camera,pS.x,pS.y,this.domElement);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}break;case dS.ROTATE:if(this.enableRotate&&this.camera)if(n){this.dispatchEvent(vS),this.dispatchEvent(AS),this.updateTbState(t,!0);const e=this.unprojectOnTbSurface(this.camera,pS.x,pS.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{const e=this.unprojectOnTbSurface(this.camera,pS.x,pS.y,this.domElement,this._tbRadius);void 0!==e&&this._currentCursorPosition.copy(e);const t=this._startCursorPosition.distanceTo(this._currentCursorPosition),n=this._startCursorPosition.angleTo(this._currentCursorPosition),r=Math.max(t/this._tbRadius,n);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),r)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=r,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case dS.SCALE:if(this.enableZoom)if(n)this.dispatchEvent(vS),this.dispatchEvent(AS),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(pS.x,pS.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const e=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(pS.x,pS.y,this.domElement).y);const t=this._currentCursorPosition.y-this._startCursorPosition.y;let n=1;t<0?n=1/Math.pow(this.scaleFactor,-t*e):t>0&&(n=Math.pow(this.scaleFactor,t*e)),this.applyTransformMatrix(this.applyScale(n,this._gizmos.position))}break;case dS.FOV:if(this.enableZoom&&this.camera instanceof Yi)if(n)this.dispatchEvent(vS),this.dispatchEvent(AS),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(pS.x,pS.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const e=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(pS.x,pS.y,this.domElement).y);const t=this._currentCursorPosition.y-this._startCursorPosition.y;let n=1;t<0?n=1/Math.pow(this.scaleFactor,-t*e):t>0&&(n=Math.pow(this.scaleFactor,t*e)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const r=this._v3_1.distanceTo(this._gizmos.position);let i=r/n;i=tn.clamp(i,this.minDistance,this.maxDistance);const s=r*Math.tan(tn.DEG2RAD*this._fovState*.5);let a=tn.RAD2DEG*(2*Math.atan(s/i));a=tn.clamp(a,this.minFov,this.maxFov);const o=s/Math.tan(tn.DEG2RAD*(a/2));n=r/o,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(a),this.applyTransformMatrix(this.applyScale(n,this._v3_2,!1));const l=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(o/r);this._m4_1.makeTranslation(l.x,l.y,l.z)}}this.dispatchEvent(gS)}}),hS(this,"onSinglePanEnd",()=>{if(this._state==dS.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations){if(performance.now()-this._timeCurrent<120){const e=Math.abs((this._wPrev+this._wCurr)/2),t=this;this._animationId=window.requestAnimationFrame(function(n){t.updateTbState(dS.ANIMATION_ROTATE,!0);const r=t.calculateRotationAxis(t._cursorPosPrev,t._cursorPosCurr);t.onRotationAnim(n,r,Math.min(e,t.wMax))})}else this.updateTbState(dS.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(gS)}else this.updateTbState(dS.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(gS)}else this._state!=dS.PAN&&this._state!=dS.IDLE||(this.updateTbState(dS.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(gS));this.dispatchEvent(vS)}),hS(this,"onDoubleTap",e=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(AS),this.setCenter(e.clientX,e.clientY);const t=this.unprojectOnObj(this.getCursorNDC(pS.x,pS.y,this.domElement),this.camera);if(t&&this.enableAnimations){const e=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(n){e.updateTbState(dS.ANIMATION_FOCUS,!0),e.onFocusAnim(n,t,e._cameraMatrixState,e._gizmoMatrixState)})}else t&&!this.enableAnimations&&(this.updateTbState(dS.FOCUS,!0),this.focus(t,this.scaleFactor),this.updateTbState(dS.IDLE,!1),this.dispatchEvent(gS))}this.dispatchEvent(vS)}),hS(this,"onDoublePanStart",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(AS),this.updateTbState(dS.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const e=this.unprojectOnTbPlane(this.camera,pS.x,pS.y,this.domElement,!0);void 0!==e&&this._startCursorPosition.copy(e),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}}),hS(this,"onDoublePanMove",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=dS.PAN&&(this.updateTbState(dS.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));const e=this.unprojectOnTbPlane(this.camera,pS.x,pS.y,this.domElement,!0);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(gS)}}),hS(this,"onDoublePanEnd",()=>{this.updateTbState(dS.IDLE,!1),this.dispatchEvent(vS)}),hS(this,"onRotateStart",()=>{var e;this.enabled&&this.enableRotate&&(this.dispatchEvent(AS),this.updateTbState(dS.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,null==(e=this.camera)||e.getWorldDirection(this._rotationAxis),this.enablePan||this.enableZoom||this.activateGizmos(!0))}),hS(this,"onRotateMove",()=>{var e;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){let t;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=dS.ZROTATE&&(this.updateTbState(dS.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),t=null==(e=this.unprojectOnTbPlane(this.camera,pS.x,pS.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):t=(new Dn).setFromMatrixPosition(this._gizmoMatrixState);const n=tn.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);void 0!==t&&this.applyTransformMatrix(this.zRotate(t,n)),this.dispatchEvent(gS)}}),hS(this,"onRotateEnd",()=>{this.updateTbState(dS.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(vS)}),hS(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(AS),this.updateTbState(dS.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),hS(this,"onPinchMove",()=>{var e,t;if(this.enabled&&this.enableZoom&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const n=12;this._state!=dS.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(dS.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),n*this._devPxRatio);const r=this._currentFingerDistance/this._startFingerDistance;let i;this.enablePan?this.camera instanceof vs?i=null==(e=this.unprojectOnTbPlane(this.camera,pS.x,pS.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof Yi&&(i=null==(t=this.unprojectOnTbPlane(this.camera,pS.x,pS.y,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):i=this._gizmos.position,void 0!==i&&this.applyTransformMatrix(this.applyScale(r,i)),this.dispatchEvent(gS)}}),hS(this,"onPinchEnd",()=>{this.updateTbState(dS.IDLE,!1),this.dispatchEvent(vS)}),hS(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(AS),this.updateTbState(dS.SCALE,!0);let e=0,t=0;const n=this._touchCurrent.length;for(let r=0;r<n;r++)e+=this._touchCurrent[r].clientX,t+=this._touchCurrent[r].clientY;this.setCenter(e/n,t/n),this._startCursorPosition.setY(.5*this.getCursorNDC(pS.x,pS.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),hS(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let e=0,t=0;const n=this._touchCurrent.length;for(let r=0;r<n;r++)e+=this._touchCurrent[r].clientX,t+=this._touchCurrent[r].clientY;this.setCenter(e/n,t/n);const r=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(pS.x,pS.y,this.domElement).y);const i=this._currentCursorPosition.y-this._startCursorPosition.y;let s=1;i<0?s=1/Math.pow(this.scaleFactor,-i*r):i>0&&(s=Math.pow(this.scaleFactor,i*r)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const a=this._v3_1.distanceTo(this._gizmos.position);let o=a/s;o=tn.clamp(o,this.minDistance,this.maxDistance);const l=a*Math.tan(tn.DEG2RAD*this._fovState*.5);let c=tn.RAD2DEG*(2*Math.atan(l/o));c=tn.clamp(c,this.minFov,this.maxFov);const u=l/Math.tan(tn.DEG2RAD*(c/2));s=a/u,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(c),this.applyTransformMatrix(this.applyScale(s,this._v3_2,!1));const h=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(u/a);this._m4_1.makeTranslation(h.x,h.y,h.z),this.dispatchEvent(gS)}}),hS(this,"onTriplePanEnd",()=>{this.updateTbState(dS.IDLE,!1),this.dispatchEvent(vS)}),hS(this,"setCenter",(e,t)=>{pS.x=e,pS.y=t}),hS(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),hS(this,"setMouseAction",(e,t,n=null)=>{let r;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(n))return!1;if("WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":r=dS.PAN;break;case"ROTATE":r=dS.ROTATE;break;case"ZOOM":r=dS.SCALE;break;case"FOV":r=dS.FOV}const i={operation:e,mouse:t,key:n,state:r};for(let e=0;e<this.mouseActions.length;e++)if(this.mouseActions[e].mouse==i.mouse&&this.mouseActions[e].key==i.key)return this.mouseActions.splice(e,1,i),!0;return this.mouseActions.push(i),!0}),hS(this,"getOpFromAction",(e,t)=>{let n;for(let r=0;r<this.mouseActions.length;r++)if(n=this.mouseActions[r],n.mouse==e&&n.key==t)return n.operation;if(t)for(let t=0;t<this.mouseActions.length;t++)if(n=this.mouseActions[t],n.mouse==e&&null==n.key)return n.operation;return null}),hS(this,"getOpStateFromAction",(e,t)=>{let n;for(let r=0;r<this.mouseActions.length;r++)if(n=this.mouseActions[r],n.mouse==e&&n.key==t)return n.state;if(t)for(let t=0;t<this.mouseActions.length;t++)if(n=this.mouseActions[t],n.mouse==e&&null==n.key)return n.state;return null}),hS(this,"getAngle",(e,t)=>180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI),hS(this,"updateTouchEvent",e=>{for(let t=0;t<this._touchCurrent.length;t++)if(this._touchCurrent[t].pointerId==e.pointerId){this._touchCurrent.splice(t,1,e);break}}),hS(this,"calculateAngularSpeed",(e,t,n,r)=>{const i=(r-n)/1e3;return 0==i?0:(t-e)/i}),hS(this,"calculatePointersDistance",(e,t)=>Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))),hS(this,"calculateRotationAxis",(e,t)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(e,t).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),hS(this,"calculateTbRadius",e=>{const t=e.position.distanceTo(this._gizmos.position);if(e instanceof Yi){const n=tn.DEG2RAD*e.fov*.5,r=Math.atan(e.aspect*Math.tan(n));return Math.tan(Math.min(n,r))*t*.67}if(e instanceof vs)return.67*Math.min(e.top,e.right)}),hS(this,"focus",(e,t,n=1)=>{if(this.camera){const r=e.clone();r.sub(this._gizmos.position).multiplyScalar(n),this._translationMatrix.makeTranslation(r.x,r.y,r.z);const i=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);const s=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(t,this._gizmos.position)),this._gizmoMatrixState.copy(i),this._cameraMatrixState.copy(s)}}),hS(this,"drawGrid",()=>{if(this.scene){const e=8947848,t=3;let n,r,i,s;if(this.camera instanceof vs){const e=this.camera.right-this.camera.left,a=this.camera.bottom-this.camera.top;i=Math.max(e,a),s=i/20,n=i/this.camera.zoom*t,r=n/s*this.camera.zoom}else if(this.camera instanceof Yi){const e=this.camera.position.distanceTo(this._gizmos.position),a=tn.DEG2RAD*this.camera.fov*.5,o=Math.atan(this.camera.aspect*Math.tan(a));i=Math.tan(Math.max(a,o))*e*2,s=i/20,n=i*t,r=n/s}null==this._grid&&this.camera&&(this._grid=new Ud(n,r,e,e),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}}),hS(this,"connect",e=>{document,this.domElement=e,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)}),hS(this,"dispose",()=>{var e,t,n,r,i;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointercancel",this.onPointerCancel),null==(n=this.domElement)||n.removeEventListener("wheel",this.onWheel),null==(r=this.domElement)||r.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null==(i=this.scene)||i.remove(this._gizmos),this.disposeGrid()}),hS(this,"disposeGrid",()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)}),hS(this,"easeOutCubic",e=>1-Math.pow(1-e,3)),hS(this,"activateGizmos",e=>{for(const t of this._gizmos.children)t.material.setValues({opacity:e?1:.6})}),hS(this,"getCursorNDC",(e,t,n)=>{const r=n.getBoundingClientRect();return this._v2_1.setX((e-r.left)/r.width*2-1),this._v2_1.setY((r.bottom-t)/r.height*2-1),this._v2_1.clone()}),hS(this,"getCursorPosition",(e,t,n)=>(this._v2_1.copy(this.getCursorNDC(e,t,n)),this.camera instanceof vs&&(this._v2_1.x*=.5*(this.camera.right-this.camera.left),this._v2_1.y*=.5*(this.camera.top-this.camera.bottom)),this._v2_1.clone())),hS(this,"setCamera",e=>{if(e){e.lookAt(this.target),e.updateMatrix(),e instanceof Yi&&(this._fov0=e.fov,this._fovState=e.fov),this._cameraMatrixState0.copy(e.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(e.projectionMatrix),this._zoom0=e.zoom,this._zoomState=this._zoom0,this._initialNear=e.near,this._nearPos0=e.position.distanceTo(this.target)-e.near,this._nearPos=this._initialNear,this._initialFar=e.far,this._farPos0=e.position.distanceTo(this.target)-e.far,this._farPos=this._initialFar,this._up0.copy(e.up),this._upState.copy(e.up),this.camera=e,this.camera.updateProjectionMatrix();const t=this.calculateTbRadius(e);void 0!==t&&(this._tbRadius=t),this.makeGizmos(this.target,this._tbRadius)}}),hS(this,"makeGizmos",(e,t)=>{const n=new ac(0,0,t,t).getPoints(this._curvePts),r=(new Ei).setFromPoints(n),i=new Ul({color:16744576,fog:!1,transparent:!0,opacity:.6}),s=new Ul({color:8454016,fog:!1,transparent:!0,opacity:.6}),a=new Ul({color:8421631,fog:!1,transparent:!0,opacity:.6}),o=new Vl(r,i),l=new Vl(r,s),c=new Vl(r,a),u=.5*Math.PI;if(o.rotation.x=u,l.rotation.y=u,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&1!=this.camera.zoom){const t=1/this.camera.zoom;this._scaleMatrix.makeScale(t,t,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(o),this._gizmos.add(l),this._gizmos.add(c)}),hS(this,"onFocusAnim",(e,t,n,r)=>{if(-1==this._timeStart&&(this._timeStart=e),this._state==dS.ANIMATION_FOCUS){const i=(e-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(r),i>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,this.scaleFactor),this._timeStart=-1,this.updateTbState(dS.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(gS);else{const e=this.easeOutCubic(i),s=1-e+this.scaleFactor*e;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,s,e),this.dispatchEvent(gS);const a=this;this._animationId=window.requestAnimationFrame(function(e){a.onFocusAnim(e,t,n,r.clone())})}}else this._animationId=-1,this._timeStart=-1}),hS(this,"onRotationAnim",(e,t,n)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=e),this._state==dS.ANIMATION_ROTATE){const r=(e-this._timeStart)/1e3;if(n+-this.dampingFactor*r>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(r,2)+n*r+0,this.applyTransformMatrix(this.rotate(t,this._angleCurrent)),this.dispatchEvent(gS);const e=this;this._animationId=window.requestAnimationFrame(function(r){e.onRotationAnim(r,t,n)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(dS.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(gS)}else this._animationId=-1,this._timeStart=-1,this._state!=dS.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(gS))}),hS(this,"pan",(e,t,n=!1)=>{if(this.camera){const r=e.clone().sub(t);if(this.camera instanceof vs&&r.multiplyScalar(1/this.camera.zoom),this.camera instanceof Yi&&n){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const e=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);r.multiplyScalar(1/e)}this._v3_1.set(r.x,r.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return mS}),hS(this,"reset",()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof Yi&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(dS.IDLE,!1),this.dispatchEvent(gS)}}),hS(this,"rotate",(e,t)=>{const n=this._gizmos.position;return this._translationMatrix.makeTranslation(-n.x,-n.y,-n.z),this._rotationMatrix.makeRotationAxis(e,-t),this._m4_1.makeTranslation(n.x,n.y,n.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),mS}),hS(this,"copyState",()=>{if(this.camera){const e=JSON.stringify(this.camera instanceof vs?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(e)}}),hS(this,"pasteState",()=>{const e=this;navigator.clipboard.readText().then(function(t){e.setStateFromJSON(t)})}),hS(this,"saveState",()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof Yi&&(this._fov0=this.camera.fov))}),hS(this,"applyScale",(e,t,n=!0)=>{if(!this.camera)return;const r=t.clone();let i=1/e;if(this.camera instanceof vs){this.camera.zoom=this._zoomState,this.camera.zoom*=e,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,i=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,i=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(i,i,i),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),r.sub(this._v3_1);const t=r.clone().multiplyScalar(i);return r.sub(t),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),mS}if(this.camera instanceof Yi){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let e=this._v3_1.distanceTo(r),t=e-e*i;const s=e-t;s<this.minDistance?(i=this.minDistance/e,t=e-e*i):s>this.maxDistance&&(i=this.maxDistance/e,t=e-e*i);let a=r.clone().sub(this._v3_1).normalize().multiplyScalar(t);if(this._m4_1.makeTranslation(a.x,a.y,a.z),n){const n=this._v3_2;e=n.distanceTo(r),t=e-e*i,a=r.clone().sub(this._v3_2).normalize().multiplyScalar(t),this._translationMatrix.makeTranslation(n.x,n.y,n.z),this._scaleMatrix.makeScale(i,i,i),this._m4_2.makeTranslation(a.x,a.y,a.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-n.x,-n.y,-n.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return mS}}),hS(this,"setFov",e=>{this.camera instanceof Yi&&(this.camera.fov=tn.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),hS(this,"setTarget",(e,t,n)=>{if(this.camera){this.target.set(e,t,n),this._gizmos.position.set(e,t,n);const r=this.calculateTbRadius(this.camera);void 0!==r&&(this._tbRadius=r),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}}),hS(this,"zRotate",(e,t)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._m4_1.makeTranslation(e.x,e.y,e.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(e),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,t),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),mS)),hS(this,"unprojectOnObj",(e,t)=>{if(!this.scene)return null;const n=new Ed;n.near=t.near,n.far=t.far,n.setFromCamera(e,t);const r=n.intersectObjects(this.scene.children,!0);for(let e=0;e<r.length;e++)if(r[e].object.uuid!=this._gizmos.uuid&&r[e].face)return r[e].point.clone();return null}),hS(this,"unprojectOnTbSurface",(e,t,n,r,i)=>{if(e instanceof vs){this._v2_1.copy(this.getCursorPosition(t,n,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const e=Math.pow(this._v2_1.x,2),i=Math.pow(this._v2_1.y,2),s=Math.pow(this._tbRadius,2);return e+i<=.5*s?this._v3_1.setZ(Math.sqrt(s-(e+i))):this._v3_1.setZ(.5*s/Math.sqrt(e+i)),this._v3_1}if(e instanceof Yi){this._v2_1.copy(this.getCursorNDC(t,n,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const s=this._v3_1.clone().normalize(),a=e.position.distanceTo(this._gizmos.position),o=Math.pow(i,2),l=this._v3_1.z,c=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==c)return s.set(this._v3_1.x,this._v3_1.y,i),s;const u=l/c,h=a;let d=Math.pow(u,2)+1,f=2*u*h,p=Math.pow(h,2)-o,m=Math.pow(f,2)-4*d*p;if(m>=0){this._v2_1.setX((-f-Math.sqrt(m))/(2*d)),this._v2_1.setY(u*this._v2_1.x+h);if(tn.RAD2DEG*this._v2_1.angle()>=45){const e=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(a-this._v2_1.y,2));return s.multiplyScalar(e),s.z+=a,s}}d=u,f=h,p=.5*-o,m=Math.pow(f,2)-4*d*p,this._v2_1.setX((-f-Math.sqrt(m))/(2*d)),this._v2_1.setY(u*this._v2_1.x+h);const g=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(a-this._v2_1.y,2));return s.multiplyScalar(g),s.z+=a,s}}),hS(this,"unprojectOnTbPlane",(e,t,n,r,i=!1)=>{if(e instanceof vs)return this._v2_1.copy(this.getCursorPosition(t,n,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(e instanceof Yi){this._v2_1.copy(this.getCursorNDC(t,n,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const s=this._v3_1.clone().normalize(),a=this._v3_1.z,o=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let l;if(l=i?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):e.position.distanceTo(this._gizmos.position),0==o)return s.set(0,0,0),s;const c=l,u=-c/(a/o),h=Math.sqrt(Math.pow(c,2)+Math.pow(u,2));return s.multiplyScalar(h),s.z=0,s}}),hS(this,"updateMatrixState",()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof vs&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof Yi&&(this._fovState=this.camera.fov))}),hS(this,"updateTbState",(e,t)=>{this._state=e,t&&this.updateMatrixState()}),hS(this,"update",()=>{const e=1e-6;if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof vs&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){const e=tn.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(e/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof Yi){const t=this.camera.position.distanceTo(this._gizmos.position);if(t>this.maxDistance+e||t<this.minDistance-e){const e=tn.clamp(t,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(e/t,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=tn.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const n=this._tbRadius,r=this.calculateTbRadius(this.camera);if(void 0!==r&&(this._tbRadius=r),n<this._tbRadius-e||n>this._tbRadius+e){const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,t=this._tbRadius/e,n=new ac(0,0,t,t).getPoints(this._curvePts),r=(new Ei).setFromPoints(n);for(const e in this._gizmos.children){this._gizmos.children[e].geometry=r}}}this.camera.lookAt(this._gizmos.position)}}),hS(this,"setStateFromJSON",e=>{const t=JSON.parse(e);if(t.arcballState&&this.camera){this._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(t.arcballState.cameraUp),this.camera.near=t.arcballState.cameraNear,this.camera.far=t.arcballState.cameraFar,this.camera.zoom=t.arcballState.cameraZoom,this.camera instanceof Yi&&(this.camera.fov=t.arcballState.cameraFov),this._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();const e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e);const n=(new cr).copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(n),this.camera.lookAt(this._gizmos.position),this.updateTbState(dS.IDLE,!1),this.dispatchEvent(gS)}}),this.camera=null,this.domElement=t,this.scene=n,this.mouseActions=[],this._mouseOp=null,this._v2_1=new nn,this._v3_1=new Dn,this._v3_2=new Dn,this._m4_1=new cr,this._m4_2=new cr,this._quat=new Pn,this._translationMatrix=new cr,this._rotationMatrix=new cr,this._scaleMatrix=new cr,this._rotationAxis=new Dn,this._cameraMatrixState=new cr,this._cameraProjectionState=new cr,this._fovState=1,this._upState=new Dn,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new cr,this._up0=new Dn,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new cr,this._gizmoMatrixState0=new cr,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=fS.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new Dn,this._startCursorPosition=new Dn,this._grid=null,this._gridPosition=new Dn,this._gizmos=new Lo,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new Dn,this._cursorPosCurr=new Dn,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new Dn(0,0,0),this._currentTarget=new Dn(0,0,0),this._tbRadius=1,this._state=dS.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if((null==e?void 0:e.camera)&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),this._state!=dS.ROTATE&&this._state!=dS.ZROTATE&&this._state!=dS.ANIMATION_ROTATE||this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),(null==e?void 0:e.gizmos)&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==dS.SCALE||this._state==dS.FOCUS||this._state==dS.ANIMATION_FOCUS)&&this.camera){const e=this.calculateTbRadius(this.camera);if(void 0!==e&&(this._tbRadius=e),this.adjustNearFar){const e=this.camera.position.distanceTo(this._gizmos.position),t=new Fn;t.setFromObject(this._gizmos);const n=new er;t.getBoundingSphere(n);const r=Math.max(this._nearPos0,n.radius+n.center.length()),i=e-this._initialNear,s=Math.min(r,i);this.camera.near=e-s;const a=Math.min(this._farPos0,-n.radius+n.center.length()),o=e-this._initialFar,l=Math.min(a,o);this.camera.far=e-l,this.camera.updateProjectionMatrix()}else{let e=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,e=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,e=!0),e&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(gS)}setTransformationMatrices(e=null,t=null){e?mS.camera?mS.camera.copy(e):mS.camera=e.clone():mS.camera=null,t?mS.gizmos?mS.gizmos.copy(t):mS.gizmos=t.clone():mS.gizmos=null}}var ES=Object.defineProperty,_S=(e,t,n)=>(((e,t,n)=>{t in e?ES(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);function xS(e){e.preventDefault()}class bS extends Bb{constructor(e,t){super(),_S(this,"object"),_S(this,"domElement",null),_S(this,"movementSpeed",1),_S(this,"rollSpeed",.005),_S(this,"dragToLook",!1),_S(this,"autoForward",!1),_S(this,"changeEvent",{type:"change"}),_S(this,"EPS",1e-6),_S(this,"tmpQuaternion",new Pn),_S(this,"mouseStatus",0),_S(this,"movementSpeedMultiplier",1),_S(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),_S(this,"moveVector",new Dn(0,0,0)),_S(this,"rotationVector",new Dn(0,0,0)),_S(this,"keydown",e=>{if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}}),_S(this,"keyup",e=>{switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()}),_S(this,"pointerdown",e=>{if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}}),_S(this,"pointermove",e=>{if(!this.dragToLook||this.mouseStatus>0){const t=this.getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this.updateRotationVector()}}),_S(this,"pointerup",e=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()}),_S(this,"lastQuaternion",new Pn),_S(this,"lastPosition",new Dn),_S(this,"update",e=>{const t=e*this.movementSpeed,n=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*n,this.rotationVector.y*n,this.rotationVector.z*n,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))}),_S(this,"updateMovementVector",()=>{const e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back}),_S(this,"updateRotationVector",()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft}),_S(this,"getContainerDimensions",()=>this.domElement==document||this.domElement instanceof Document?{size:[window.innerWidth,window.innerHeight],offset:[0,0]}:{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}),_S(this,"connect",e=>{this.domElement=e,e instanceof Document||e.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",xS),this.domElement.addEventListener("pointermove",this.pointermove),this.domElement.addEventListener("pointerdown",this.pointerdown),this.domElement.addEventListener("pointerup",this.pointerup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}),_S(this,"dispose",()=>{this.domElement.removeEventListener("contextmenu",xS),this.domElement.removeEventListener("pointermove",this.pointermove),this.domElement.removeEventListener("pointerdown",this.pointerdown),this.domElement.removeEventListener("pointerup",this.pointerup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)}),this.object=e,void 0!==t&&this.connect(t),this.updateMovementVector(),this.updateRotationVector()}}var SS=Object.defineProperty,wS=(e,t,n)=>(((e,t,n)=>{t in e?SS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class CS{constructor(){wS(this,"enabled",!0),wS(this,"needsSwap",!0),wS(this,"clear",!1),wS(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,n,r,i){}dispose(){}}class TS{constructor(e){wS(this,"camera",new vs(-1,1,1,-1,0,1)),wS(this,"geometry",new os(2,2)),wS(this,"mesh"),this.mesh=new Ui(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var MS=Object.defineProperty,IS=(e,t,n)=>(((e,t,n)=>{t in e?MS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class RS extends CS{constructor(e,t="tDiffuse"){super(),IS(this,"textureID"),IS(this,"uniforms"),IS(this,"material"),IS(this,"fsQuad"),this.textureID=t,e instanceof ji?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=Vi.clone(e.uniforms),this.material=new ji({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new TS(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.fsQuad.dispose(),this.material.dispose()}}const BS={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvUv = uv;\n    \tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n    uniform float opacity;\n\n    uniform sampler2D tDiffuse;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 texel = texture2D( tDiffuse, vUv );\n    \tgl_FragColor = opacity * texel;\n\n    }\n  "};var PS=Object.defineProperty,DS=(e,t,n)=>(((e,t,n)=>{t in e?PS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class LS extends CS{constructor(e,t){super(),DS(this,"scene"),DS(this,"camera"),DS(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),i=e.state;let s,a;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(s=0,a=1):(s=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,s,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class kS extends CS{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var FS=Object.defineProperty,OS=(e,t,n)=>(((e,t,n)=>{t in e?FS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class US{constructor(e,t){if(OS(this,"renderer"),OS(this,"_pixelRatio"),OS(this,"_width"),OS(this,"_height"),OS(this,"renderTarget1"),OS(this,"renderTarget2"),OS(this,"writeBuffer"),OS(this,"readBuffer"),OS(this,"renderToScreen"),OS(this,"passes",[]),OS(this,"copyPass"),OS(this,"clock"),this.renderer=e,void 0===t){const n={minFilter:ie,magFilter:ie,format:ye},r=e.getSize(new nn);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new In(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.copyPass=new RS(BS),this.copyPass.material.blending=0,this.clock=new Kh}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;const r=this.passes.length;for(let t=0;t<r;t++){const r=this.passes[t];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),r.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==LS&&(r instanceof LS?n=!0:r instanceof kS&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new nn);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var NS=Object.defineProperty,zS=(e,t,n)=>(((e,t,n)=>{t in e?NS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class GS extends CS{constructor(e,t,n,r,i=0){super(),zS(this,"scene"),zS(this,"camera"),zS(this,"overrideMaterial"),zS(this,"clearColor"),zS(this,"clearAlpha"),zS(this,"clearDepth",!1),zS(this,"_oldClearColor",new $r),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=i,this.clear=!0,this.needsSwap=!1}render(e,t,n){let r,i=e.autoClear;e.autoClear=!1;let s=null;void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),e.autoClear=i}}function QS(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}const HS="srgb",VS="srgb-linear";class jS extends oh{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new $S(e)}),this.register(function(e){return new JS(e)}),this.register(function(e){return new ow(e)}),this.register(function(e){return new lw(e)}),this.register(function(e){return new cw(e)}),this.register(function(e){return new ew(e)}),this.register(function(e){return new tw(e)}),this.register(function(e){return new nw(e)}),this.register(function(e){return new rw(e)}),this.register(function(e){return new XS(e)}),this.register(function(e){return new iw(e)}),this.register(function(e){return new ZS(e)}),this.register(function(e){return new aw(e)}),this.register(function(e){return new sw(e)}),this.register(function(e){return new KS(e)}),this.register(function(e){return new uw(e)}),this.register(function(e){return new hw(e)})}load(e,t,n,r){const i=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=kh.extractUrlBase(e);s=kh.resolveURL(t,this.path)}else s=kh.extractUrlBase(e);this.manager.itemStart(e);const a=function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)},o=new uh(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){try{i.parse(n,s,function(n){t(n),i.manager.itemEnd(e)},a)}catch(e){a(e)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let i;const s={},a={};if("string"==typeof e)i=JSON.parse(e);else if(e instanceof ArrayBuffer){if(QS(new Uint8Array(e.slice(0,4)))===dw){try{s[YS.KHR_BINARY_GLTF]=new mw(e)}catch(e){return void(r&&r(e))}i=JSON.parse(s[YS.KHR_BINARY_GLTF].content)}else i=JSON.parse(QS(new Uint8Array(e)))}else i=e;if(void 0===i.asset||i.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const o=new Gw(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});o.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](o);t.name,a[t.name]=t,s[t.name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){const t=i.extensionsUsed[e],n=i.extensionsRequired||[];switch(t){case YS.KHR_MATERIALS_UNLIT:s[t]=new qS;break;case YS.KHR_DRACO_MESH_COMPRESSION:s[t]=new gw(i,this.dracoLoader);break;case YS.KHR_TEXTURE_TRANSFORM:s[t]=new Aw;break;case YS.KHR_MESH_QUANTIZATION:s[t]=new vw;break;default:n.indexOf(t)>=0&&a[t]}}o.setExtensions(s),o.setPlugins(a),o.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,i){n.parse(e,t,r,i)})}}function WS(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const YS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class KS{constructor(e){this.parser=e,this.name=YS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const i=t.json,s=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let a;const o=new $r(16777215);void 0!==s.color&&o.setRGB(s.color[0],s.color[1],s.color[2],VS);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new Ih(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new Th(o),a.distance=l;break;case"spot":a=new xh(o),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,kw(a,s),void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),r=Promise.resolve(a),t.cache.add(n,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then(function(e){return n._getNodeRef(t.cache,i,e)})}}class qS{constructor(){this.name=YS.KHR_MATERIALS_UNLIT}getMaterialType(){return ti}extendParams(e,t,n){const r=[];e.color=new $r(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],VS),e.opacity=t[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture,HS))}return Promise.all(r)}}class XS{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class $S{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new nn(e,e)}return Promise.all(i)}}class JS{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=void 0!==r.dispersion?r.dispersion:0,Promise.resolve()}}class ZS{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&i.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&i.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}}class ew{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new $r(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=r.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],VS)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&i.push(n.assignTexture(t,"sheenColorMap",s.sheenColorTexture,HS)),void 0!==s.sheenRoughnessTexture&&i.push(n.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}}class tw{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class nw{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&i.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return t.attenuationColor=(new $r).setRGB(a[0],a[1],a[2],VS),Promise.all(i)}}class rw{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class iw{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return t.specularColor=(new $r).setRGB(a[0],a[1],a[2],VS),void 0!==s.specularColorTexture&&i.push(n.assignTexture(t,"specularColorMap",s.specularColorTexture,HS)),Promise.all(i)}}class sw{constructor(e){this.parser=e,this.name=YS.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&i.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(i)}}class aw{constructor(e){this.parser=e,this.name=YS.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Bu:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&i.push(n.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(i)}}class ow{constructor(e){this.parser=e,this.name=YS.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,s)}}class lw{constructor(e){this.parser=e,this.name=YS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],a=r.images[s.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then(function(i){if(i)return n.loadTextureImage(e,s.source,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class cw{constructor(e){this.parser=e,this.name=YS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],a=r.images[s.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then(function(i){if(i)return n.loadTextureImage(e,s.source,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class uw{constructor(e){this.name=YS.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(t){const n=e.byteOffset||0,r=e.byteLength||0,s=e.count,a=e.byteStride,o=new Uint8Array(t,n,r);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(s,a,o,e.mode,e.filter).then(function(e){return e.buffer}):i.ready.then(function(){const t=new ArrayBuffer(s*a);return i.decodeGltfBuffer(new Uint8Array(t),s,a,o,e.mode,e.filter),t})})}return null}}class hw{constructor(e){this.name=YS.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const r=t.meshes[n.mesh];for(const e of r.primitives)if(e.mode!==xw.TRIANGLES&&e.mode!==xw.TRIANGLE_STRIP&&e.mode!==xw.TRIANGLE_FAN&&void 0!==e.mode)return null;const i=n.extensions[this.name].attributes,s=[],a={};for(const e in i)s.push(this.parser.getDependency("accessor",i[e]).then(t=>(a[e]=t,a[e])));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then(e=>{const t=e.pop(),n=t.isGroup?t.children:[t],r=e[0].count,i=[];for(const e of n){const t=new cr,n=new Dn,s=new Pn,o=new Dn(1,1,1),l=new Ol(e.geometry,e.material,r);for(let e=0;e<r;e++)a.TRANSLATION&&n.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&s.fromBufferAttribute(a.ROTATION,e),a.SCALE&&o.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(n,s,o));for(const t in a)if("_COLOR_0"===t){const e=a[t];l.instanceColor=new Il(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);Lr.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),i.push(l)}return t.isGroup?(t.clear(),t.add(...i),t):i[0]}))}}const dw="glTF",fw=1313821514,pw=5130562;class mw{constructor(e){this.name=YS.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:QS(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==dw)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let i=0;for(;i<n;){const t=r.getUint32(i,!0);i+=4;const n=r.getUint32(i,!0);if(i+=4,n===fw){const n=new Uint8Array(e,12+i,t);this.content=QS(n)}else if(n===pw){const n=12+i;this.body=e.slice(n,n+t)}i+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class gw{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=YS.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},o={},l={};for(const e in s){const t=Tw[e]||e.toLowerCase();a[t]=s[e]}for(const t in e.attributes){const r=Tw[t]||t.toLowerCase();if(void 0!==s[t]){const i=n.accessors[e.attributes[t]],s=bw[i.componentType];l[r]=s.name,o[r]=!0===i.normalized}}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t,n){r.decodeDracoFile(e,function(e){for(const t in e.attributes){const n=e.attributes[t],r=o[t];void 0!==r&&(n.normalized=r)}t(e)},a,l,VS,n)})})}}class Aw{constructor(){this.name=YS.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class vw{constructor(){this.name=YS.KHR_MESH_QUANTIZATION}}class yw extends Vu{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[i+e];return t}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,c=r-t,u=(n-t)/c,h=u*u,d=h*u,f=e*l,p=f-l,m=-2*d+3*h,g=d-h,A=1-m,v=g-h+u;for(let e=0;e!==a;e++){const t=s[p+e+a],n=s[p+e+o]*c,r=s[f+e+a],l=s[f+e]*c;i[e]=A*t+v*n+m*r+g*l}return i}}const Ew=new Pn;class _w extends yw{interpolate_(e,t,n,r){const i=super.interpolate_(e,t,n,r);return Ew.fromArray(i).normalize().toArray(i),i}}const xw={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},bw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Sw={9728:te,9729:ie,9984:ne,9985:se,9986:re,9987:ae},ww={33071:Z,33648:ee,10497:J},Cw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Tw={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Ix>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Mw={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Iw={CUBICSPLINE:void 0,LINEAR:st,STEP:it},Rw="OPAQUE",Bw="MASK",Pw="BLEND";function Dw(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new Ru({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),e.DefaultMaterial}function Lw(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function kw(e,t){void 0!==t.extras&&"object"==typeof t.extras&&Object.assign(e.userData,t.extras)}function Fw(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}}}function Ow(e){let t;const n=e.extensions&&e.extensions[YS.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+Uw(n.attributes):e.indices+":"+Uw(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,r=e.targets.length;n<r;n++)t+=":"+Uw(e.targets[n]);return t}function Uw(e){let t="";const n=Object.keys(e).sort();for(let r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function Nw(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const zw=new cr;class Gw{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new WS,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,i=-1;"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||r&&i<98?this.textureLoader=new ph(this.options.manager):this.textureLoader=new Gh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new uh(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){const s={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};return Lw(i,s,r),kw(s,r),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(s)})).then(function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),i=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,r]of e.children.entries())i(r,t.children[n])};return i(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[YS.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(e,i){n.load(kh.resolveURL(t.uri,r.path),e,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const e=Cw[r.type],t=bw[r.componentType],n=!0===r.normalized,i=new t(r.count*e);return Promise.resolve(new ci(i,e,n))}const i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(e){const i=e[0],s=Cw[r.type],a=bw[r.componentType],o=a.BYTES_PER_ELEMENT,l=o*s,c=r.byteOffset||0,u=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,h=!0===r.normalized;let d,f;if(u&&u!==l){const e=Math.floor(c/u),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let l=t.cache.get(n);l||(d=new a(i,e*u,r.count*u/o),l=new Wo(d,u/o),t.cache.add(n,l)),f=new Ko(l,s,c%u/o,h)}else d=null===i?new a(r.count*s):new a(i,c,r.count*s),f=new ci(d,s,h);if(void 0!==r.sparse){const t=Cw.SCALAR,n=bw[r.sparse.indices.componentType],o=r.sparse.indices.byteOffset||0,l=r.sparse.values.byteOffset||0,c=new n(e[1],o,r.sparse.count*t),u=new a(e[2],l,r.sparse.count*s);null!==i&&(f=new ci(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=c.length;e<t;e++){const t=c[e];if(f.setX(t,u[e*s]),s>=2&&f.setY(t,u[e*s+1]),s>=3&&f.setZ(t,u[e*s+2]),s>=4&&f.setW(t,u[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,i=t.images[r];let s=this.textureLoader;if(i.uri){const e=n.manager.getHandler(i.uri);null!==e&&(s=e)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,n){const r=this,i=this.json,s=i.textures[e],a=i.images[t],o=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=s.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const n=(i.samplers||{})[s.sampler]||{};return t.magFilter=Sw[n.magFilter]||ie,t.minFilter=Sw[n.minFilter]||ae,t.wrapS=ww[n.wrapS]||J,t.wrapT=ww[n.wrapT]||J,r.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(e,t){const n=this,r=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const s=r.images[e],a=self.URL||self.webkitURL;let o=s.uri||"",l=!1;if(void 0!==s.bufferView)o=n.getDependency("bufferView",s.bufferView).then(function(e){l=!0;const t=new Blob([e],{type:s.mimeType});return o=a.createObjectURL(t),o});else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then(function(e){return new Promise(function(n,r){let s=n;!0===t.isImageBitmapLoader&&(s=function(e){const t=new Cn(e);t.needsUpdate=!0,n(t)}),t.load(kh.resolveURL(e,i.path),s,void 0,r)})}).then(function(e){var t;return!0===l&&a.revokeObjectURL(o),kw(e,s),e.userData.mimeType=s.mimeType||((t=s.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw e});return this.sourceCache[e]=c,c}assignTexture(e,t,n,r){const i=this;return this.getDependency("texture",n.index).then(function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),i.extensions[YS.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[YS.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(s);s=i.extensions[YS.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),i.associations.set(s,t)}}return void 0!==r&&("number"==typeof r&&(r=3001===r?HS:VS),"colorSpace"in s?s.colorSpace=r:s.encoding=r===HS?3001:3e3),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new ql,ei.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Ul,ei.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(r||i||s){let e="ClonedMaterial:"+n.uuid+":";r&&(e+="derivative-tangents:"),i&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),i&&(t.vertexColors=!0),s&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return Ru}loadMaterial(e){const t=this,n=this.json,r=this.extensions,i=n.materials[e];let s;const a={},o=[];if((i.extensions||{})[YS.KHR_MATERIALS_UNLIT]){const e=r[YS.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),o.push(e.extendParams(a,i,t))}else{const n=i.pbrMetallicRoughness||{};if(a.color=new $r(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;a.color.setRGB(e[0],e[1],e[2],VS),a.opacity=e[3]}void 0!==n.baseColorTexture&&o.push(t.assignTexture(a,"map",n.baseColorTexture,HS)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(o.push(t.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),o.push(t.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),o.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)})))}!0===i.doubleSided&&(a.side=2);const l=i.alphaMode||Rw;if(l===Pw?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===Bw&&(a.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&s!==ti&&(o.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new nn(1,1),void 0!==i.normalTexture.scale)){const e=i.normalTexture.scale;a.normalScale.set(e,e)}if(void 0!==i.occlusionTexture&&s!==ti&&(o.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(a.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&s!==ti){const e=i.emissiveFactor;a.emissive=(new $r).setRGB(e[0],e[1],e[2],VS)}return void 0!==i.emissiveTexture&&s!==ti&&o.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,HS)),Promise.all(o).then(function(){const n=new s(a);return i.name&&(n.name=i.name),kw(n,i),t.associations.set(n,{materials:e}),i.extensions&&Lw(r,n,i),n})}createUniqueName(e){const t=fd.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function i(e){return n[YS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return Qw(n,e,t)})}const s=[];for(let n=0,a=e.length;n<a;n++){const a=e[n],o=Ow(a),l=r[o];if(l)s.push(l.promise);else{let e;e=a.extensions&&a.extensions[YS.KHR_DRACO_MESH_COMPRESSION]?i(a):Qw(new Ei,a,t),r[o]={primitive:a,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],s=i.primitives,a=[];for(let e=0,t=s.length;e<t;e++){const t=void 0===s[e].material?Dw(this.cache):this.getDependency("material",s[e].material);a.push(t)}return a.push(t.loadGeometries(s)),Promise.all(a).then(function(n){const a=n.slice(0,n.length-1),o=n[n.length-1],l=[];for(let n=0,c=o.length;n<c;n++){const c=o[n],u=s[n];let h;const d=a[n];if(u.mode===xw.TRIANGLES||u.mode===xw.TRIANGLE_STRIP||u.mode===xw.TRIANGLE_FAN||void 0===u.mode)h=!0===i.isSkinnedMesh?new bl(c,d):new Ui(c,d),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),u.mode===xw.TRIANGLE_STRIP?h.geometry=Fx(h.geometry,1):u.mode===xw.TRIANGLE_FAN&&(h.geometry=Fx(h.geometry,2));else if(u.mode===xw.LINES)h=new Yl(c,d);else if(u.mode===xw.LINE_STRIP)h=new Vl(c,d);else if(u.mode===xw.LINE_LOOP)h=new Kl(c,d);else{if(u.mode!==xw.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new ec(c,d)}Object.keys(h.geometry.morphAttributes).length>0&&Fw(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),kw(h,i),u.extensions&&Lw(r,h,u),t.assignFinalMaterial(h),l.push(h)}for(let n=0,r=l.length;n<r;n++)t.associations.set(l[n],{meshes:e,primitives:n});if(1===l.length)return i.extensions&&Lw(r,l[0],i),l[0];const c=new Lo;i.extensions&&Lw(r,c,i),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new Yi(tn.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new vs(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),kw(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let e=0,r=t.joints.length;e<r;e++)n.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){const t=e.pop(),n=e,r=[],i=[];for(let e=0,s=n.length;e<s;e++){const s=n[e];if(s){r.push(s);const n=new cr;null!==t&&n.fromArray(t.array,16*e),i.push(n)}}return new Ml(r,i)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],i=r.name?r.name:"animation_"+e,s=[],a=[],o=[],l=[],c=[];for(let e=0,t=r.channels.length;e<t;e++){const t=r.channels[e],n=r.samplers[t.sampler],i=t.target,u=i.node,h=void 0!==r.parameters?r.parameters[n.input]:n.input,d=void 0!==r.parameters?r.parameters[n.output]:n.output;void 0!==i.node&&(s.push(this.getDependency("node",u)),a.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",d)),l.push(n),c.push(i))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],r=e[1],s=e[2],a=e[3],o=e[4],l=[];for(let e=0,i=t.length;e<i;e++){const i=t[e],c=r[e],u=s[e],h=a[e],d=o[e];if(void 0===i)continue;i.updateMatrix&&i.updateMatrix();const f=n._createAnimationTracks(i,c,u,h,d);if(f)for(let e=0;e<f.length;e++)l.push(f[e])}return new nh(i,void 0,l)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]}),t})}loadNode(e){const t=this,n=this.json.nodes[e],r=t._loadNodeShallow(e),i=[],s=n.children||[];for(let e=0,n=s.length;e<n;e++)i.push(t.getDependency("node",s[e]));const a=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([r,Promise.all(i),a]).then(function(e){const t=e[0],n=e[1],r=e[2];null!==r&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(r,zw)});for(let e=0,r=n.length;e<r;e++)t.add(n[e]);return t})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const i=t.nodes[e],s=i.name?r.createUniqueName(i.name):"",a=[],o=r._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return o&&a.push(o),void 0!==i.camera&&a.push(r.getDependency("camera",i.camera).then(function(e){return r._getNodeRef(r.cameraCache,i.camera,e)})),r._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){a.push(e)}),this.nodeCache[e]=Promise.all(a).then(function(t){let a;if(a=!0===i.isBone?new Sl:t.length>1?new Lo:1===t.length?t[0]:new Lr,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(i.name&&(a.userData.name=i.name,a.name=s),kw(a,i),i.extensions&&Lw(n,a,i),void 0!==i.matrix){const e=new cr;e.fromArray(i.matrix),a.applyMatrix4(e)}else void 0!==i.translation&&a.position.fromArray(i.translation),void 0!==i.rotation&&a.quaternion.fromArray(i.rotation),void 0!==i.scale&&a.scale.fromArray(i.scale);return r.associations.has(a)||r.associations.set(a,{}),r.associations.get(a).nodes=e,a}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,i=new Lo;n.name&&(i.name=r.createUniqueName(n.name)),kw(i,n),n.extensions&&Lw(t,i,n);const s=n.nodes||[],a=[];for(let e=0,t=s.length;e<t;e++)a.push(r.getDependency("node",s[e]));return Promise.all(a).then(function(e){for(let t=0,n=e.length;t<n;t++)i.add(e[t]);return r.associations=(e=>{const t=new Map;for(const[e,n]of r.associations)(e instanceof ei||e instanceof Cn)&&t.set(e,n);return e.traverse(e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)}),t})(i),i})}_createAnimationTracks(e,t,n,r,i){const s=[],a=e.name?e.name:e.uuid,o=[];let l;switch(Mw[i.path]===Mw.weights?e.traverse(function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)}):o.push(a),Mw[i.path]){case Mw.weights:l=$u;break;case Mw.rotation:l=Zu;break;case Mw.position:case Mw.scale:l=th;break;default:if(1===n.itemSize)l=$u;else l=th}const c=void 0!==r.interpolation?Iw[r.interpolation]:st,u=this._getArrayFromAccessor(n);for(let e=0,n=o.length;e<n;e++){const n=new l(o[e]+"."+Mw[i.path],t.array,u,c);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(n),s.push(n)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=Nw(t.constructor),n=new Float32Array(t.length);for(let r=0,i=t.length;r<i;r++)n[r]=t[r]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Zu?_w:yw)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Qw(e,t,n){const r=t.attributes,i=[];function s(t,r){return n.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(const t in r){const n=Tw[t]||t.toLowerCase();n in e.attributes||i.push(s(r[t],n))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(r)}return kw(e,t),function(e,t,n){const r=t.attributes,i=new Fn;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return;if(i.set(new Dn(t[0],t[1],t[2]),new Dn(s[0],s[1],s[2])),e.normalized){const t=Nw(bw[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new Dn,t=new Dn;for(let r=0,i=s.length;r<i;r++){const i=s[r];if(void 0!==i.POSITION){const r=n.json.accessors[i.POSITION],s=r.min,a=r.max;if(void 0!==s&&void 0!==a){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),r.normalized){const e=Nw(bw[r.componentType]);t.multiplyScalar(e)}e.max(t)}}}i.expandByVector(e)}e.boundingBox=i;const a=new er;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=a}(e,t,n),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,n){let r=!1,i=!1,s=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(i=!0),void 0!==n.COLOR_0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(e);const a=[],o=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(r){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;a.push(t)}if(i){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;o.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(t){const n=t[0],a=t[1],o=t[2];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=a),s&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}class Hw extends Ei{constructor(e,t,n,r){super();const i=[],s=[],a=[],o=new Dn,l=new cr;l.makeRotationFromEuler(n),l.setPosition(t);const c=new cr;function u(t,n,r){n.applyMatrix4(e.matrixWorld),n.applyMatrix4(c),r.transformDirection(e.matrixWorld),t.push(new Vw(n.clone(),r.clone()))}function h(e,t){const n=[],i=.5*Math.abs(r.dot(t));for(let r=0;r<e.length;r+=3){let s,a,o,l,c,u,h,f=0;switch(s=e[r+0].position.dot(t)-i>0,a=e[r+1].position.dot(t)-i>0,o=e[r+2].position.dot(t)-i>0,f=(s?1:0)+(a?1:0)+(o?1:0),f){case 0:n.push(e[r]),n.push(e[r+1]),n.push(e[r+2]);break;case 1:if(s&&(l=e[r+1],c=e[r+2],u=d(e[r],l,t,i),h=d(e[r],c,t,i)),a){l=e[r],c=e[r+2],u=d(e[r+1],l,t,i),h=d(e[r+1],c,t,i),n.push(u),n.push(c.clone()),n.push(l.clone()),n.push(c.clone()),n.push(u.clone()),n.push(h);break}o&&(l=e[r],c=e[r+1],u=d(e[r+2],l,t,i),h=d(e[r+2],c,t,i)),n.push(l.clone()),n.push(c.clone()),n.push(u),n.push(h),n.push(u.clone()),n.push(c.clone());break;case 2:s||(l=e[r].clone(),c=d(l,e[r+1],t,i),u=d(l,e[r+2],t,i),n.push(l),n.push(c),n.push(u)),a||(l=e[r+1].clone(),c=d(l,e[r+2],t,i),u=d(l,e[r],t,i),n.push(l),n.push(c),n.push(u)),o||(l=e[r+2].clone(),c=d(l,e[r],t,i),u=d(l,e[r+1],t,i),n.push(l),n.push(c),n.push(u))}}return n}function d(e,t,n,r){const i=e.position.dot(n)-r,s=i/(i-(t.position.dot(n)-r));return new Vw(new Dn(e.position.x+s*(t.position.x-e.position.x),e.position.y+s*(t.position.y-e.position.y),e.position.z+s*(t.position.z-e.position.z)),new Dn(e.normal.x+s*(t.normal.x-e.normal.x),e.normal.y+s*(t.normal.y-e.normal.y),e.normal.z+s*(t.normal.z-e.normal.z)))}c.copy(l).invert(),function(){let t,n=[];const c=new Dn,d=new Dn;if(!0===e.geometry.isGeometry)return;const f=e.geometry,p=f.attributes.position,m=f.attributes.normal;if(null!==f.index){const e=f.index;for(t=0;t<e.count;t++)c.fromBufferAttribute(p,e.getX(t)),d.fromBufferAttribute(m,e.getX(t)),u(n,c,d)}else for(t=0;t<p.count;t++)c.fromBufferAttribute(p,t),d.fromBufferAttribute(m,t),u(n,c,d);for(n=h(n,o.set(1,0,0)),n=h(n,o.set(-1,0,0)),n=h(n,o.set(0,1,0)),n=h(n,o.set(0,-1,0)),n=h(n,o.set(0,0,1)),n=h(n,o.set(0,0,-1)),t=0;t<n.length;t++){const e=n[t];a.push(.5+e.position.x/r.x,.5+e.position.y/r.y),e.position.applyMatrix4(l),i.push(e.position.x,e.position.y,e.position.z),s.push(e.normal.x,e.normal.y,e.normal.z)}}(),this.setAttribute("position",new di(i,3)),this.setAttribute("normal",new di(s,3)),this.setAttribute("uv",new di(a,2))}}class Vw{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class jw extends pu{constructor(e,t={}){const{bevelEnabled:n=!1,bevelSize:r=8,bevelThickness:i=10,font:s,height:a=50,size:o=100,lineHeight:l=1,letterSpacing:c=0,...u}=t;if(void 0===s)super();else{super(s.generateShapes(e,o,{lineHeight:l,letterSpacing:c}),{...u,bevelEnabled:n,bevelSize:r,bevelThickness:i,depth:a})}this.type="TextGeometry"}}const Ww={uniforms:{tDiffuse:{value:null}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvUv = uv;\n    \tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 tex = texture2D( tDiffuse, vUv );\n\n    \t#ifdef LinearTosRGB\n    \t\tgl_FragColor = LinearTosRGB( tex );\n    \t#else\n    \t\tgl_FragColor = sRGBTransferOETF( tex );\n    \t#endif\n\n    }\n  "},Yw={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n      }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float h;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 sum = vec4( 0.0 );\n\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n    \tgl_FragColor = sum;\n\n    }\n  "},Kw={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n\n  uniform sampler2D tDiffuse;\n  uniform float v;\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vec4 sum = vec4( 0.0 );\n\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n    gl_FragColor = sum;\n\n  }\n  "},qw=new is,Xw=new Dn,$w=new Dn,Jw=new Dn,Zw=new Dn,eC=new Dn,tC=new Dn,nC=new Dn,rC=new Dn,iC=new Dn,sC=new Dn,aC=new Dn,oC=new Dn,lC=new Dn,cC=new Dn;class uC{constructor(e,t,n){this.camera=e,this.scene=t,this.startPoint=new Dn,this.endPoint=new Dn,this.collection=[],this.deep=n||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(qw,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera)$w.copy(e),$w.x=Math.min(e.x,t.x),$w.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),Jw.setFromMatrixPosition(this.camera.matrixWorld),Zw.copy($w),eC.set(t.x,$w.y,0),tC.copy(t),nC.set($w.x,t.y,0),Zw.unproject(this.camera),eC.unproject(this.camera),tC.unproject(this.camera),nC.unproject(this.camera),oC.copy(Zw).sub(Jw),lC.copy(eC).sub(Jw),cC.copy(tC).sub(Jw),oC.normalize(),lC.normalize(),cC.normalize(),oC.multiplyScalar(this.deep),lC.multiplyScalar(this.deep),cC.multiplyScalar(this.deep),oC.add(Jw),lC.add(Jw),cC.add(Jw),(n=qw.planes)[0].setFromCoplanarPoints(Jw,Zw,eC),n[1].setFromCoplanarPoints(Jw,eC,tC),n[2].setFromCoplanarPoints(tC,nC,Jw),n[3].setFromCoplanarPoints(nC,Zw,Jw),n[4].setFromCoplanarPoints(eC,tC,nC),n[5].setFromCoplanarPoints(cC,lC,oC),n[5].normal.multiplyScalar(-1);else if(this.camera.isOrthographicCamera){const r=Math.min(e.x,t.x),i=Math.max(e.y,t.y),s=Math.max(e.x,t.x),a=Math.min(e.y,t.y);var n;Zw.set(r,i,-1),eC.set(s,i,-1),tC.set(s,a,-1),nC.set(r,a,-1),rC.set(r,i,1),iC.set(s,i,1),sC.set(s,a,1),aC.set(r,a,1),Zw.unproject(this.camera),eC.unproject(this.camera),tC.unproject(this.camera),nC.unproject(this.camera),rC.unproject(this.camera),iC.unproject(this.camera),sC.unproject(this.camera),aC.unproject(this.camera),(n=qw.planes)[0].setFromCoplanarPoints(Zw,rC,iC),n[1].setFromCoplanarPoints(eC,iC,sC),n[2].setFromCoplanarPoints(sC,aC,nC),n[3].setFromCoplanarPoints(aC,rC,Zw),n[4].setFromCoplanarPoints(eC,tC,nC),n[5].setFromCoplanarPoints(sC,iC,rC),n[5].normal.multiplyScalar(-1)}}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&void 0!==t.material&&(null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),Xw.copy(t.geometry.boundingSphere.center),Xw.applyMatrix4(t.matrixWorld),e.containsPoint(Xw)&&this.collection.push(t)),t.children.length>0)for(let n=0;n<t.children.length;n++)this.searchChildInFrustum(e,t.children[n])}}class hC{constructor(e,t=" .:-=+*#%@",n={}){const r=n.resolution||.15,i=n.scale||1,s=n.color||!1,a=n.alpha||!1,o=n.block||!1,l=n.invert||!1,c=n.strResolution||"low";let u,h;const d=document.createElement("div");d.style.cursor="default";const f=document.createElement("table");let p,m,g;d.appendChild(f),this.setSize=function(t,n){u=t,h=n,e.setSize(t,n),function(){p=Math.floor(u*r),m=Math.floor(h*r),_.width=p,_.height=m,g=e.domElement,g.style.backgroundColor&&(f.rows[0].cells[0].style.backgroundColor=g.style.backgroundColor,f.rows[0].cells[0].style.color=g.style.color);f.cellSpacing=0,f.cellPadding=0;const t=f.style;t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=C+"px",t.fontFamily=y,t.fontSize=S+"px",t.lineHeight=w+"px",t.textAlign="left",t.textDecoration="none"}()},this.render=function(t,n){e.render(t,n),function(e){x.clearRect(0,0,p,m),x.drawImage(E,0,0,p,m);const t=x.getImageData(0,0,p,m).data;let n="";for(let e=0;e<m;e+=2){for(let r=0;r<p;r++){const i=4*(e*p+r),c=t[i],u=t[i+1],h=t[i+2],d=t[i+3];let f,m;m=(.3*c+.59*u+.11*h)/255,0==d&&(m=1),f=Math.floor((1-m)*(b.length-1)),l&&(f=b.length-f-1);let g=b[f];void 0!==g&&" "!=g||(g="&nbsp;"),n+=s?"<span style='color:rgb("+c+","+u+","+h+");"+(o?"background-color:rgb("+c+","+u+","+h+");":"")+(a?"opacity:"+d/255+";":"")+"'>"+g+"</span>":g}n+="<br/>"}e.innerHTML=`<tr><td style="display:block;width:${u}px;height:${h}px;overflow:hidden">${n}</td></tr>`}(f)},this.domElement=d;const A=" .,:;i1tfLCG08@".split(""),v=" CGO08@".split(""),y="courier new, monospace",E=e.domElement,_=document.createElement("canvas");if(!_.getContext)return;const x=_.getContext("2d");if(!x.getImageData)return;let b=s?v:A;t&&(b=t);const S=2/r*i,w=2/r*i;let C=0;if("low"==c)switch(i){case 1:C=-1;break;case 2:case 3:C=-2.1;break;case 4:C=-3.1;break;case 5:C=-4.15}if("medium"==c)switch(i){case 1:C=0;break;case 2:C=-1;break;case 3:C=-1.04;break;case 4:case 5:C=-2.1}if("high"==c)switch(i){case 1:case 2:C=0;break;case 3:case 4:case 5:C=-1}}}function dC(e,t,n){const r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;let i=e,s=r,a=Math.floor((i+s)/2);for(;t<n[a]||t>=n[a+1];)t<n[a]?s=a:i=a,a=Math.floor((i+s)/2);return a}function fC(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let r=1;for(let e=2;e<=t;++e)r*=e;for(let n=2;n<=e-t;++n)r*=n;return n/r}function pC(e,t,n,r,i){const s=function(e,t,n,r,i){const s=i<e?i:e,a=[],o=dC(e,r,t),l=function(e,t,n,r,i){const s=[];for(let e=0;e<=n;++e)s[e]=0;const a=[];for(let e=0;e<=r;++e)a[e]=s.slice(0);const o=[];for(let e=0;e<=n;++e)o[e]=s.slice(0);o[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let r=1;r<=n;++r){l[r]=t-i[e+1-r],c[r]=i[e+r]-t;let n=0;for(let e=0;e<r;++e){const t=c[e+1],i=l[r-e];o[r][e]=t+i;const s=o[e][r-1]/o[r][e];o[e][r]=n+t*s,n=i*s}o[r][r]=n}for(let e=0;e<=n;++e)a[0][e]=o[e][n];for(let e=0;e<=n;++e){let t=0,i=1;const l=[];for(let e=0;e<=n;++e)l[e]=s.slice(0);l[0][0]=1;for(let s=1;s<=r;++s){let r=0;const c=e-s,u=n-s;e>=s&&(l[i][0]=l[t][0]/o[u+1][c],r=l[i][0]*o[c][u]);const h=e-1<=u?s-1:n-e;for(let e=c>=-1?1:-c;e<=h;++e)l[i][e]=(l[t][e]-l[t][e-1])/o[u+1][c+e],r+=l[i][e]*o[c+e][u];e<=u&&(l[i][s]=-l[t][s-1]/o[u+1][e],r+=l[i][s]*o[e][u]),a[s][e]=r;const d=t;t=i,i=d}}let u=n;for(let e=1;e<=r;++e){for(let t=0;t<=n;++t)a[e][t]*=u;u*=n-e}return a}(o,r,e,s,t),c=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),r=t.w;t.x*=r,t.y*=r,t.z*=r,c[e]=t}for(let t=0;t<=s;++t){const n=c[o-e].clone().multiplyScalar(l[t][0]);for(let r=1;r<=e;++r)n.add(c[o-e+r].clone().multiplyScalar(l[t][r]));a[t]=n}for(let e=s+1;e<=i+1;++e)a[e]=new Tn(0,0,0);return a}(e,t,n,r,i);return function(e){const t=e.length,n=[],r=[];for(let i=0;i<t;++i){const t=e[i];n[i]=new Dn(t.x,t.y,t.z),r[i]=t.w}const i=[];for(let e=0;e<t;++e){const t=n[e].clone();for(let n=1;n<=e;++n)t.sub(i[e-n].clone().multiplyScalar(fC(e,n)*r[n]));i[e]=t.divideScalar(r[0])}return i}(s)}class mC extends sc{constructor(e,t,n,r,i){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||this.knots.length-1;for(let e=0;e<n.length;++e){const t=n[e];this.controlPoints[e]=new Tn(t.x,t.y,t.z,t.w)}}getPoint(e,t){const n=t||new Dn,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=function(e,t,n,r){const i=dC(e,r,t),s=function(e,t,n,r){const i=[],s=[],a=[];i[0]=1;for(let o=1;o<=n;++o){s[o]=t-r[e+1-o],a[o]=r[e+o]-t;let n=0;for(let e=0;e<o;++e){const t=a[e+1],r=s[o-e],l=i[e]/(t+r);i[e]=n+t*l,n=r*l}i[o]=n}return i}(i,r,e,t),a=new Tn(0,0,0,0);for(let t=0;t<=e;++t){const r=n[i-e+t],o=s[t],l=r.w*o;a.x+=r.x*l,a.y+=r.y*l,a.z+=r.z*l,a.w+=r.w*o}return a}(this.degree,this.knots,this.controlPoints,r);return 1!=i.w&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)}getTangent(e,t){const n=t||new Dn,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=pC(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n}}let gC,AC,vC;class yC extends oh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=""===i.path?kh.extractUrlBase(e):i.path,a=new uh(this.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,function(n){try{t(i.parse(n,s))}catch(t){r&&r(t),i.manager.itemError(e)}},n,r)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===FC(e,0,t.length)}(e))gC=(new SC).parse(e);else{const t=FC(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(t){const r=e[t-1];return e=e.slice(n+t),n++,r}for(let e=0;e<t.length;++e){if(r(1)===t[e])return!1}return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(TC(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+TC(t));gC=(new bC).parse(t)}const n=new ph(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new EC(n,this.manager).parse(gC)}}class EC{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){AC=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),i=(new _C).parse(r);return this.parseScene(r,i,n),vC}parseConnections(){const e=new Map;if("Connections"in gC){gC.Connections.connections.forEach(function(t){const n=t[0],r=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:r,relationship:i};e.get(n).parents.push(s),e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:n,relationship:i};e.get(r).children.push(a)})}return e}parseImages(){const e={},t={};if("Video"in gC.Objects){const n=gC.Objects.Video;for(const r in n){const i=n[r];if(e[parseInt(r)]=i.RelativeFilename||i.Filename,"Content"in i){const e=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,s="string"==typeof i.Content&&""!==i.Content;if(e||s){const e=this.parseImage(n[r]);t[i.RelativeFilename||i.Filename]=e}}}}for(const n in e){const r=e[n];void 0!==t[r]?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename;let r;switch(n.slice(n.lastIndexOf(".")+1).toLowerCase()){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga"),r="image/tga";break;default:return}if("string"==typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in gC.Objects){const n=gC.Objects.Texture;for(const r in n){const i=this.parseTexture(n[r],e);t.set(parseInt(r),i)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,i=e.WrapModeV,s=void 0!==r?r.value:0,a=void 0!==i?i.value:0;if(n.wrapS=0===s?J:Z,n.wrapT=0===a?J:Z,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,i=AC.get(e.id).children;let s;void 0!==i&&i.length>0&&void 0!==t[i[0].ID]&&(n=t[i[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const e=this.manager.getHandler(".tga");null===e?s=new Cn:(e.setPath(this.textureLoader.path),s=e.load(n))}else s="psd"===a?new Cn:this.textureLoader.load(n);return this.textureLoader.setPath(r),s}parseMaterials(e){const t=new Map;if("Material"in gC.Objects){const n=gC.Objects.Material;for(const r in n){const i=this.parseMaterial(n[r],e);null!==i&&t.set(parseInt(r),i)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let i=e.ShadingModel;if("object"==typeof i&&(i=i.value),!AC.has(n))return null;const s=this.parseParameters(e,t,n);let a;switch(i.toLowerCase()){case"phong":default:a=new Pu;break;case"lambert":a=new ku}return a.setValues(s),a.name=r,a}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new $r).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(r.color=(new $r).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new $r).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(r.emissive=(new $r).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new $r).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new $r).fromArray(e.SpecularColor.value));const i=this;return AC.get(n).children.forEach(function(e){switch(e.relationship){case"Bump":r.bumpMap=i.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=i.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=i.getTexture(t,e.ID),void 0!==r.map&&("colorSpace"in r.map?r.map.colorSpace="srgb":r.map.encoding=3001);break;case"DisplacementColor":r.displacementMap=i.getTexture(t,e.ID);break;case"EmissiveColor":r.emissiveMap=i.getTexture(t,e.ID),void 0!==r.emissiveMap&&("colorSpace"in r.emissiveMap?r.emissiveMap.colorSpace="srgb":r.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=i.getTexture(t,e.ID);break;case"ReflectionColor":r.envMap=i.getTexture(t,e.ID),void 0!==r.envMap&&(r.envMap.mapping=q,"colorSpace"in r.envMap?r.envMap.colorSpace="srgb":r.envMap.encoding=3001);break;case"SpecularColor":r.specularMap=i.getTexture(t,e.ID),void 0!==r.specularMap&&("colorSpace"in r.specularMap?r.specularMap.colorSpace="srgb":r.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=i.getTexture(t,e.ID),r.transparent=!0}}),r}getTexture(e,t){return"LayeredTexture"in gC.Objects&&t in gC.Objects.LayeredTexture&&(t=AC.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in gC.Objects){const n=gC.Objects.Deformer;for(const r in n){const i=n[r],s=AC.get(parseInt(r));if("Skin"===i.attrType){const t=this.parseSkeleton(s,n);t.ID=r,s.parents.length,t.geometryID=s.parents[0].ID,e[r]=t}else if("BlendShape"===i.attrType){const e={id:r};e.rawTargets=this.parseMorphTargets(s,n),e.id=r,s.parents.length,t[r]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(e){const r=t[e.ID];if("Cluster"!==r.attrType)return;const i={ID:e.ID,indices:[],weights:[],transformLink:(new cr).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const i=e.children[r],s=t[i.ID],a={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;a.geoID=AC.get(parseInt(i.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,n.push(a)}return n}parseScene(e,t,n){vC=new Lo;const r=this.parseModels(e.skeletons,t,n),i=gC.Objects.Model,s=this;r.forEach(function(e){const t=i[e.ID];s.setLookAtProperties(e,t);AC.get(e.ID).parents.forEach(function(t){const n=r.get(t.ID);void 0!==n&&n.add(e)}),null===e.parent&&vC.add(e)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),vC.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=DC(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});const a=(new xC).parse();1===vC.children.length&&vC.children[0].isGroup&&(vC.children[0].animations=a,vC=vC.children[0]),vC.animations=a}parseModels(e,t,n){const r=new Map,i=gC.Objects.Model;for(const s in i){const a=parseInt(s),o=i[s],l=AC.get(a);let c=this.buildSkeleton(l,e,a,o.attrName);if(!c){switch(o.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,t,n);break;case"NurbsCurve":c=this.createCurve(l,t);break;case"LimbNode":case"Root":c=new Sl;break;default:c=new Lo}c.name=o.attrName?fd.sanitizeNodeName(o.attrName):"",c.ID=a}this.getTransformData(c,o),r.set(a,c)}return r}buildSkeleton(e,t,n,r){let i=null;return e.parents.forEach(function(e){for(const s in t){const a=t[s];a.rawBones.forEach(function(t,s){if(t.ID===e.ID){const e=i;i=new Sl,i.matrixWorld.copy(t.transformLink),i.name=r?fd.sanitizeNodeName(r):"",i.ID=n,a.bones[s]=i,null!==e&&i.add(e)}})}}),i}createCamera(e){let t,n;if(e.children.forEach(function(e){const t=gC.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new Lr;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let r=1;void 0!==n.NearPlane&&(r=n.NearPlane.value/1e3);let i=1e3;void 0!==n.FarPlane&&(i=n.FarPlane.value/1e3);let s=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,a=n.AspectHeight.value);const o=s/a;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const c=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new Yi(l,o,r,i),null!==c&&t.setFocalLength(c);break;case 1:t=new vs(-s/2,s/2,a/2,-a/2,r,i);break;default:t=new Lr}}return t}createLight(e){let t,n;if(e.children.forEach(function(e){const t=gC.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new Lr;else{let e;e=void 0===n.LightType?0:n.LightType.value;let r=16777215;void 0!==n.Color&&(r=(new $r).fromArray(n.Color.value));let i=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(i=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new Th(r,i,s,a);break;case 1:t=new Ih(r,i);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=tn.degToRad(n.InnerAngle.value));let o=0;void 0!==n.OuterAngle&&(o=tn.degToRad(n.OuterAngle.value),o=Math.max(o,1)),t=new xh(r,i,s,e,o,a);break;default:t=new Th(r,i)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,i=null,s=null;const a=[];return e.children.forEach(function(e){t.has(e.ID)&&(i=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))}),a.length>1?s=a:a.length>0?s=a[0]:(s=new Pu({color:13421772}),a.push(s)),"color"in i.attributes&&a.forEach(function(e){e.vertexColors=!0}),i.FBX_Deformer?(r=new bl(i,s),r.normalizeSkinWeights()):r=new Ui(i,s),r}createCurve(e,t){const n=e.children.reduce(function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e},null),r=new Ul({color:3342591,linewidth:1});return new Vl(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?LC(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){if("LookAtProperty"in t){AC.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){const n=gC.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),vC.add(e.target)):e.lookAt((new Dn).fromArray(t))}}})}}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const i in e){const s=e[i];AC.get(parseInt(s.ID)).parents.forEach(function(e){if(t.has(e.ID)){const t=e.ID;AC.get(t).parents.forEach(function(e){if(n.has(e.ID)){n.get(e.ID).bind(new Ml(s.bones),r[e.ID])}})}})}}parsePoseNodes(){const e={};if("Pose"in gC.Objects){const t=gC.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(t){e[t.Node]=(new cr).fromArray(t.Matrix.a)}):e[r.Node]=(new cr).fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in gC&&"AmbientColor"in gC.GlobalSettings){const e=gC.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(0!==t||0!==n||0!==r){const e=new $r(t,n,r);vC.add(new Rh(e,1))}}}}class _C{parse(e){const t=new Map;if("Geometry"in gC.Objects){const n=gC.Objects.Geometry;for(const r in n){const i=AC.get(parseInt(r)),s=this.parseGeometry(i,n[r],e);t.set(parseInt(r),s)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,i=[],s=e.parents.map(function(e){return gC.Objects.Model[e.ID]});if(0===s.length)return;const a=e.children.reduce(function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e},null);e.children.forEach(function(e){void 0!==n.morphTargets[e.ID]&&i.push(n.morphTargets[e.ID])});const o=s[0],l={};"RotationOrder"in o&&(l.eulerOrder=LC(o.RotationOrder.value)),"InheritType"in o&&(l.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(l.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(l.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(l.scale=o.GeometricScaling.value);const c=DC(l);return this.genGeometry(t,a,i,c)}genGeometry(e,t,n,r){const i=new Ei;e.attrName&&(i.name=e.attrName);const s=this.parseGeoNode(e,t),a=this.genBuffers(s),o=new di(a.vertex,3);if(o.applyMatrix4(r),i.setAttribute("position",o),a.colors.length>0&&i.setAttribute("color",new di(a.colors,3)),t&&(i.setAttribute("skinIndex",new ui(a.weightsIndices,4)),i.setAttribute("skinWeight",new di(a.vertexWeights,4)),i.FBX_Deformer=t),a.normal.length>0){const e=(new rn).getNormalMatrix(r),t=new di(a.normal,3);t.applyNormalMatrix(e),i.setAttribute("normal",t)}if(a.uvs.forEach(function(e,t){"uv2"===Rx&&t++;const n=0===t?"uv":`uv${t}`;i.setAttribute(n,new di(a.uvs[t],2))}),s.material&&"AllSame"!==s.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach(function(n,r){n!==e&&(i.addGroup(t,r-t,e),e=n,t=r)}),i.groups.length>0){const t=i.groups[i.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&i.addGroup(n,a.materialIndex.length-n,e)}0===i.groups.length&&i.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,i=!1,s=[],a=[],o=[],l=[],c=[],u=[];const h=this;return e.vertexIndices.forEach(function(d,f){let p,m=!1;d<0&&(d^=-1,m=!0);let g=[],A=[];if(s.push(3*d,3*d+1,3*d+2),e.color){const t=RC(f,n,d,e.color);o.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach(function(e){A.push(e.weight),g.push(e.id)}),A.length>4){i||(i=!0);const e=[0,0,0,0],t=[0,0,0,0];A.forEach(function(n,r){let i=n,s=g[r];t.forEach(function(t,n,r){if(i>t){r[n]=i,i=t;const a=e[n];e[n]=s,s=a}})}),g=e,A=t}for(;A.length<4;)A.push(0),g.push(0);for(let e=0;e<4;++e)c.push(A[e]),u.push(g[e])}if(e.normal){const t=RC(f,n,d,e.normal);a.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(p=RC(f,n,d,e.material)[0]),e.uv&&e.uv.forEach(function(e,t){const r=RC(f,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(r[0]),l[t].push(r[1])}),r++,m&&(h.genFace(t,e,s,p,a,o,l,c,u,r),n++,r=0,s=[],a=[],o=[],l=[],c=[],u=[])}),t}genFace(e,t,n,r,i,s,a,o,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[4*(u-1)]),e.vertexWeights.push(o[4*(u-1)+1]),e.vertexWeights.push(o[4*(u-1)+2]),e.vertexWeights.push(o[4*(u-1)+3]),e.vertexWeights.push(o[4*u]),e.vertexWeights.push(o[4*u+1]),e.vertexWeights.push(o[4*u+2]),e.vertexWeights.push(o[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(u-1)]),e.colors.push(s[3*(u-1)+1]),e.colors.push(s[3*(u-1)+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach(function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][0]),e.uvs[n].push(a[n][1]),e.uvs[n].push(a[n][2*(u-1)]),e.uvs[n].push(a[n][2*(u-1)+1]),e.uvs[n].push(a[n][2*u]),e.uvs[n].push(a[n][2*u+1])})}addMorphTargets(e,t,n,r){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const i=this;n.forEach(function(n){n.rawTargets.forEach(function(n){const s=gC.Objects.Geometry[n.geoID];void 0!==s&&i.genMorphGeometry(e,t,s,r,n.name)})})}genMorphGeometry(e,t,n,r,i){const s=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],o=void 0!==n.Indexes?n.Indexes.a:[],l=3*e.attributes.position.count,c=new Float32Array(l);for(let e=0;e<o.length;e++){const t=3*o[e];c[t]=a[3*e],c[t+1]=a[3*e+1],c[t+2]=a[3*e+2]}const u={vertexIndices:s,vertexPositions:c},h=this.genBuffers(u),d=new di(h.vertex,3);d.name=i||n.attrName,d.applyMatrix4(r),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let i=[];return"IndexToDirect"===n&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,i=[];for(let e=0;e<r.length;++e)i.push(e);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(void 0===mC)return new Ei;const t=parseInt(e.Order);if(isNaN(t))return new Ei;const n=t-1,r=e.KnotVector.a,i=[],s=e.Points.a;for(let e=0,t=s.length;e<t;e+=4)i.push((new Tn).fromArray(s,e));let a,o;if("Closed"===e.Form)i.push(i[0]);else if("Periodic"===e.Form){a=n,o=r.length-1-a;for(let e=0;e<n;++e)i.push(i[e])}const l=new mC(n,r,i,a,o).getPoints(12*i.length);return(new Ei).setFromPoints(l)}}class xC{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const r=t[n],i=this.addClip(r);e.push(i)}return e}parseClips(){if(void 0===gC.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=gC.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){const e={id:r.id,attr:r.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=gC.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(MC),values:t[n].KeyValueFloat.a},i=AC.get(r.id);if(void 0!==i){const t=i.parents[0].ID,n=i.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=r:n.match(/Y/)?e.get(t).curves.y=r:n.match(/Z/)?e.get(t).curves.z=r:n.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=r)}}}parseAnimationLayers(e){const t=gC.Objects.AnimationLayer,n=new Map;for(const r in t){const t=[],i=AC.get(parseInt(r));if(void 0!==i){i.children.forEach(function(n,r){if(e.has(n.ID)){const i=e.get(n.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===t[r]){const e=AC.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){const n=gC.Objects.Model[e.toString()];if(void 0===n)return;const i={modelName:n.attrName?fd.sanitizeNodeName(n.attrName):"",ID:n.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};vC.traverse(function(e){e.ID===n.id&&(i.transform=e.matrix,e.userData.transformData&&(i.eulerOrder=e.userData.transformData.eulerOrder))}),i.transform||(i.transform=new cr),"PreRotation"in n&&(i.preRotation=n.PreRotation.value),"PostRotation"in n&&(i.postRotation=n.PostRotation.value),t[r]=i}}t[r]&&(t[r][i.attr]=i)}else if(void 0!==i.curves.morph){if(void 0===t[r]){const e=AC.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,i=AC.get(e).parents[0].ID,s=AC.get(i).parents[0].ID,a=AC.get(s).parents[0].ID,o=gC.Objects.Model[a],l={modelName:o.attrName?fd.sanitizeNodeName(o.attrName):"",morphName:gC.Objects.Deformer[e].attrName};t[r]=l}t[r][i.attr]=i}}}),n.set(parseInt(r),t)}}return n}parseAnimStacks(e){const t=gC.Objects.AnimationStack,n={};for(const r in t){const i=AC.get(parseInt(r)).children;i.length;const s=e.get(i[0].ID);n[r]={name:t[r].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(e){t=t.concat(n.generateTracks(e))}),new nh(e.name,-1,t)}generateTracks(e){const t=[];let n=new Dn,r=new Pn,i=new Dn;if(e.transform&&e.transform.decompose(n,r,i),n=n.toArray(),r=(new yr).setFromQuaternion(r,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==r&&t.push(r)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,r){const i=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(i,t,n);return new th(e+"."+r,i,s)}generateRotationTrack(e,t,n,r,i,s){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(tn.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(tn.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(tn.degToRad));const a=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(a,t,n);void 0!==r&&((r=r.map(tn.degToRad)).push(s),r=(new yr).fromArray(r),r=(new Pn).setFromEuler(r)),void 0!==i&&((i=i.map(tn.degToRad)).push(s),i=(new yr).fromArray(i),i=(new Pn).setFromEuler(i).invert());const l=new Pn,c=new yr,u=[];for(let e=0;e<o.length;e+=3)c.set(o[e],o[e+1],o[e+2],s),l.setFromEuler(c),void 0!==r&&l.premultiply(r),void 0!==i&&l.multiply(i),l.toArray(u,e/3*4);return new Zu(e+".quaternion",a,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(e){return e/100}),r=vC.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new $u(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}),t.length>1){let e=1,n=t[0];for(let r=1;r<t.length;r++){const i=t[r];i!==n&&(t[e]=i,n=i,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const r=n,i=[];let s=-1,a=-1,o=-1;return e.forEach(function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];i.push(e),r[0]=e}else i.push(r[0]);if(-1!==a){const e=t.y.values[a];i.push(e),r[1]=e}else i.push(r[1]);if(-1!==o){const e=t.z.values[o];i.push(e),r[2]=e}else i.push(r[2])}),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){const s=i/180,a=r/s;let o=n+a;const l=e.times[t-1],c=(e.times[t]-l)/s;let u=l+c;const h=[],d=[];for(;u<e.times[t];)h.push(u),u+=c,d.push(o),o+=a;e.times=OC(e.times,t,h),e.values=OC(e.values,t,d)}}}}class bC{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new CC,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(e,r){const i=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(i||s)return;const a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):o?t.parseNodeProperty(e,o,n[++r]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:n},s=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in a?("PoseNode"===n?a.PoseNode.push(i):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==s.id&&(a[n][s.id]=i)):"number"==typeof s.id?(a[n]={},a[n][s.id]=i):"Properties70"!==n&&(a[n]="PoseNode"===n?[i]:i),"number"==typeof s.id&&(i.id=s.id),""!==s.name&&(i.attrName=s.name),""!==s.type&&(i.attrType=s.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===r){const e=i.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let a=i.split(",").slice(3);a=a.map(function(e){return e.trim().replace(/^"/,"")}),r="connections",i=[t,n],function(e,t){for(let n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i,a),void 0===s[r]&&(s[r]=[])}"Node"===r&&(s.id=i),r in s&&Array.isArray(s[r])?s[r].push(i):"a"!==r?s[r]=i:s.a=i,this.setCurrentProp(s,r),"a"===r&&","!==i.slice(-1)&&(s.a=kC(i))}else this.parseNodeSpecialProperty(e,r,i)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=kC(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=r[0],s=r[1],a=r[2],o=r[3];let l=r[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=kC(l)}this.getPrevNode()[i]={type:s,type2:a,flag:o,value:l},this.setCurrentProp(this.getPrevNode(),i)}}class SC{parse(e){const t=new wC(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new CC;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&r.add(e.name,e)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),a=e.getString(s);if(0===r)return null;const o=[];for(let t=0;t<i;t++)o.push(this.parseProperty(e));const l=o.length>0?o[0]:"",c=o.length>1?o[1]:"",u=o.length>2?o[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){const r=this.parseNode(e,t);null!==r&&this.parseSubNode(a,n,r)}return n.propertyList=o,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==u&&(n.attrType=u),""!==a&&(n.name=a),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach(function(t,n){0!==n&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name){Object.keys(n).forEach(function(e){t[e]=n[e]})}else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],r=n.propertyList[1];const i=n.propertyList[2],s=n.propertyList[3];let a;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),a="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:r,type2:i,flag:s,value:a}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),i=e.getUint32(),s=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=cb(new Uint8Array(e.getArrayBuffer(s))),o=new wC(a.buffer);switch(t){case"b":case"c":return o.getBooleanArray(r);case"d":return o.getFloat64Array(r);case"f":return o.getFloat32Array(r);case"i":return o.getInt32Array(r);case"l":return o.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class wC{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let n=0;n<e;n++)t[n]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),QS(new Uint8Array(t))}}class CC{add(e,t){this[e]=t}}function TC(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function MC(e){return e/46186158e3}const IC=[];function RC(e,t,n,r){let i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0]}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);const s=i*r.dataSize,a=s+r.dataSize;return function(e,t,n,r){for(let i=n,s=0;i<r;i++,s++)e[s]=t[i];return e}(IC,r.buffer,s,a)}const BC=new yr,PC=new Dn;function DC(e){const t=new cr,n=new cr,r=new cr,i=new cr,s=new cr,a=new cr,o=new cr,l=new cr,c=new cr,u=new cr,h=new cr,d=new cr,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(PC.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(tn.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(BC.fromArray(t))}if(e.rotation){const t=e.rotation.map(tn.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(BC.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(tn.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(BC.fromArray(t)),i.invert()}e.scale&&s.scale(PC.fromArray(e.scale)),e.scalingOffset&&o.setPosition(PC.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(PC.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(PC.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(PC.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),u.copy(e.parentMatrixWorld));const p=n.clone().multiply(r).multiply(i),m=new cr;m.extractRotation(u);const g=new cr;g.copyPosition(u);const A=g.clone().invert().multiply(u),v=m.clone().invert().multiply(A),y=s,E=new cr;if(0===f)E.copy(m).multiply(p).multiply(v).multiply(y);else if(1===f)E.copy(m).multiply(v).multiply(p).multiply(y);else{const e=(new cr).scale((new Dn).setFromMatrixScale(h)).clone().invert(),t=v.clone().multiply(e);E.copy(m).multiply(p).multiply(t).multiply(y)}const _=c.clone().invert(),x=a.clone().invert();let b=t.clone().multiply(l).multiply(c).multiply(n).multiply(r).multiply(i).multiply(_).multiply(o).multiply(a).multiply(s).multiply(x);const S=(new cr).copyPosition(b),w=u.clone().multiply(S);return d.copyPosition(w),b=d.clone().multiply(E),b.premultiply(u.invert()),b}function LC(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?t[0]:t[e]}function kC(e){return e.split(",").map(function(e){return parseFloat(e)})}function FC(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),QS(new Uint8Array(e,t,n))}function OC(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}var UC=Object.defineProperty,NC=(e,t,n)=>(((e,t,n)=>{t in e?UC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class zC extends oh{constructor(e){super(e)}load(e,t,n,r){const i=new uh(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,e=>{if("string"!=typeof e)throw new Error("unsupported data type");const n=JSON.parse(e),r=this.parse(n);t&&t(r)},n,r)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new GC(e)}}class GC{constructor(e){NC(this,"data"),NC(this,"isFont",!0),NC(this,"type","Font"),this.data=e}generateShapes(e,t=100,n){const r=[],i={letterSpacing:0,lineHeight:1,...n},s=function(e,t,n,r){const i=Array.from(e),s=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,o=[];let l=0,c=0;for(let e=0;e<i.length;e++){const t=i[e];if("\n"===t)l=0,c-=a*r.lineHeight;else{const e=QC(t,s,l,c,n);e&&(l+=e.offsetX+r.letterSpacing,o.push(e.path))}}return o}(e,t,this.data,i);for(let e=0,t=s.length;e<t;e++)Array.prototype.push.apply(r,s[e].toShapes(!1));return r}}function QC(e,t,n,r,i){const s=i.glyphs[e]||i.glyphs["?"];if(!s)return;const a=new Xd;let o,l,c,u,h,d,f,p;if(s.o){const e=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let i=0,s=e.length;i<s;){switch(e[i++]){case"m":o=parseInt(e[i++])*t+n,l=parseInt(e[i++])*t+r,a.moveTo(o,l);break;case"l":o=parseInt(e[i++])*t+n,l=parseInt(e[i++])*t+r,a.lineTo(o,l);break;case"q":c=parseInt(e[i++])*t+n,u=parseInt(e[i++])*t+r,h=parseInt(e[i++])*t+n,d=parseInt(e[i++])*t+r,a.quadraticCurveTo(h,d,c,u);break;case"b":c=parseInt(e[i++])*t+n,u=parseInt(e[i++])*t+r,h=parseInt(e[i++])*t+n,d=parseInt(e[i++])*t+r,f=parseInt(e[i++])*t+n,p=parseInt(e[i++])*t+r,a.bezierCurveTo(h,d,f,p,c,u)}}}return{offsetX:s.ha*t,path:a}}class HC extends Cn{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=te,this.minFilter=te,this.wrapR=Z,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class VC{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:t,msg:n,transfer:r}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(n,r)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const r=this._getIdleWorker();-1!==r?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const jC=9,WC=15,YC=16,KC=22,qC=37,XC=43,$C=76,JC=83,ZC=97,eT=100,tT=103,nT=109,rT=165,iT=166;class sT{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class aT{constructor(e,t,n,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const oT=[171,75,84,88,32,50,48,187,13,10,26,10];function lT(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}let cT,uT,hT;const dT={env:{emscripten_notify_memory_growth:function(e){hT=new Uint8Array(uT.exports.memory.buffer)}}};class fT{init(){return cT||(cT="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+pT).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,dT)).then(this._init):WebAssembly.instantiate(Buffer.from(pT,"base64"),dT).then(this._init),cT)}_init(e){uT=e.instance,dT.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!uT)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,r=uT.exports.malloc(n);hT.set(e,r),t=t||Number(uT.exports.ZSTD_findDecompressedSize(r,n));const i=uT.exports.malloc(t),s=uT.exports.ZSTD_decompress(i,t,r,n),a=hT.slice(i,i+s);return uT.exports.free(r),uT.exports.free(i),a}}const pT="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";class mT extends rc{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,Y),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class gT extends rc{constructor(e,t,n,r,i,s){super(e,t,n,i,s),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Z}}var AT=Object.defineProperty,vT=(e,t,n)=>(((e,t,n)=>{t in e?AT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const yT=3e3,ET=3001,_T="srgb",xT=new WeakMap;let bT;const ST=(()=>{const e=class extends oh{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new VC,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const t=new uh(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const n=t.loadAsync("basis_transcoder.js"),r=new uh(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const i=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([n,i]).then(([t,n])=>{const r=e.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(e.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(e.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(e.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=n,this.workerPool.setWorkerCreator(()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})})}return this.transcoderPending}load(e,t,n,r){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const i=new uh(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials),i.load(e,e=>{if(xT.has(e)){return xT.get(e).promise.then(t).catch(r)}this._createTexture(e).then(e=>t?t(e):null).catch(r)},n,r)}_createTextureFrom(e,t){const{faces:n,width:r,height:i,format:s,type:a,error:o,dfdFlags:l}=e;if("error"===a)return Promise.reject(o);let c;if(6===t.faceCount)c=new mT(n,s,le);else{const e=n[0].mipmaps;c=t.layerCount>1?new gT(e,r,i,t.layerCount,s,le):new rc(e,r,i,s,le)}c.minFilter=1===n[0].mipmaps.length?ie:ae,c.magFilter=ie,c.generateMipmaps=!1,c.needsUpdate=!0;const u=MT(t);return"colorSpace"in c?c.colorSpace=u:c.encoding=u===_T?3001:3e3,c.premultiplyAlpha=!!(1&l),c}async _createTexture(e,t={}){const n=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,oT.length);if(t[0]!==oT[0]||t[1]!==oT[1]||t[2]!==oT[2]||t[3]!==oT[3]||t[4]!==oT[4]||t[5]!==oT[5]||t[6]!==oT[6]||t[7]!==oT[7]||t[8]!==oT[8]||t[9]!==oT[9]||t[10]!==oT[10]||t[11]!==oT[11])throw new Error("Missing KTX 2.0 identifier.");const n=new sT,r=17*Uint32Array.BYTES_PER_ELEMENT,i=new aT(e,oT.length,r,!0);n.vkFormat=i._nextUint32(),n.typeSize=i._nextUint32(),n.pixelWidth=i._nextUint32(),n.pixelHeight=i._nextUint32(),n.pixelDepth=i._nextUint32(),n.layerCount=i._nextUint32(),n.faceCount=i._nextUint32();const s=i._nextUint32();n.supercompressionScheme=i._nextUint32();const a=i._nextUint32(),o=i._nextUint32(),l=i._nextUint32(),c=i._nextUint32(),u=i._nextUint64(),h=i._nextUint64(),d=new aT(e,oT.length+r,3*s*8,!0);for(let t=0;t<s;t++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const f=new aT(e,a,o,!0),p={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},m=(p.descriptorBlockSize/4-6)/4;for(let e=0;e<m;e++){const t={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=f._nextInt32(),t.sampleUpper=f._nextInt32()):(t.sampleLower=f._nextUint32(),t.sampleUpper=f._nextUint32()),p.samples[e]=t}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(p);const g=new aT(e,l,c,!0);for(;g._offset<c;){const e=g._nextUint32(),t=g._scan(e),r=lT(t);if(n.keyValue[r]=g._nextUint8Array(e-t.byteLength-1),r.match(/^ktx/i)){const e=lT(n.keyValue[r]);n.keyValue[r]=e.substring(0,e.lastIndexOf("\0"))}const i=e%4?4-e%4:0;g._skip(i)}if(h<=0)return n;const A=new aT(e,u,h,!0),v=A._nextUint16(),y=A._nextUint16(),E=A._nextUint32(),_=A._nextUint32(),x=A._nextUint32(),b=A._nextUint32(),S=[];for(let e=0;e<s;e++)S.push({imageFlags:A._nextUint32(),rgbSliceByteOffset:A._nextUint32(),rgbSliceByteLength:A._nextUint32(),alphaSliceByteOffset:A._nextUint32(),alphaSliceByteLength:A._nextUint32()});const w=u+A._offset,C=w+E,T=C+_,M=T+x,I=new Uint8Array(e.buffer,e.byteOffset+w,E),R=new Uint8Array(e.buffer,e.byteOffset+C,_),B=new Uint8Array(e.buffer,e.byteOffset+T,x),P=new Uint8Array(e.buffer,e.byteOffset+M,b);return n.globalData={endpointCount:v,selectorCount:y,imageDescs:S,endpointsData:I,selectorsData:R,tablesData:B,extendedData:P},n}(new Uint8Array(e));if(0!==n.vkFormat)return async function(e){const{vkFormat:t}=e;if(void 0===CT[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let n;2===e.supercompressionScheme&&(bT||(bT=new Promise(async e=>{const t=new fT;await t.init(),e(t)})),n=await bT);const r=[];for(let i=0;i<e.levels.length;i++){const s=Math.max(1,e.pixelWidth>>i),a=Math.max(1,e.pixelHeight>>i),o=e.pixelDepth?Math.max(1,e.pixelDepth>>i):0,l=e.levels[i];let c,u;if(0===e.supercompressionScheme)c=l.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=n.decode(l.levelData,l.uncompressedByteLength)}u=TT[t]===pe?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):TT[t]===me?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,r.push({data:u,width:s,height:a,depth:o})}let i;if(wT.has(CT[t]))i=0===e.pixelDepth?new wl(r[0].data,e.pixelWidth,e.pixelHeight):new HC(r[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");i=new rc(r,e.pixelWidth,e.pixelHeight)}i.mipmaps=r,i.type=TT[t],i.format=CT[t],i.needsUpdate=!0;const s=MT(e);"colorSpace"in i?i.colorSpace=s:i.encoding=s===_T?ET:yT;return Promise.resolve(i)}(n);const r=t,i=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e])).then(e=>this._createTextureFrom(e.data,n));return xT.set(e,{promise:i}),i}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};let t=e;return vT(t,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),vT(t,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),vT(t,"EngineFormat",{RGBAFormat:ye,RGBA_ASTC_4x4_Format:Ue,RGBA_BPTC_Format:Je,RGBA_ETC2_EAC_Format:Oe,RGBA_PVRTC_4BPPV1_Format:De,RGBA_S3TC_DXT5_Format:Re,RGB_ETC1_Format:ke,RGB_ETC2_Format:Fe,RGB_PVRTC_4BPPV1_Format:Be,RGB_S3TC_DXT1_Format:Te}),vT(t,"BasisWorker",function(){let e,t,n;const r=_EngineFormat,i=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(a){const h=a.data;switch(h.type){case"init":e=h.config,d=h.transcoderBinary,t=new Promise(e=>{n={wasmBinary:d,onRuntimeInitialized:e},BASIS(n)}).then(()=>{n.initializeBasis(),n.KTX2File});break;case"transcode":t.then(()=>{try{const{faces:t,buffers:a,width:d,height:f,hasAlpha:p,format:m,dfdFlags:g}=function(t){const a=new n.KTX2File(new Uint8Array(t));function h(){a.close(),a.delete()}if(!a.isValid())throw h(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const d=a.isUASTC()?s.UASTC_4x4:s.ETC1S,f=a.getWidth(),p=a.getHeight(),m=a.getLayers()||1,g=a.getLevels(),A=a.getFaces(),v=a.getHasAlpha(),y=a.getDFDFlags(),{transcoderFormat:E,engineFormat:_}=function(t,n,a,u){let h,d;const f=t===s.ETC1S?o:l;for(let r=0;r<f.length;r++){const i=f[r];if(e[i.if]&&(i.basisFormat.includes(t)&&!(u&&i.transcoderFormat.length<2)&&(!i.needsPowerOfTwo||c(n)&&c(a))))return h=i.transcoderFormat[u?1:0],d=i.engineFormat[u?1:0],{transcoderFormat:h,engineFormat:d}}return h=i.RGBA32,d=r.RGBAFormat,{transcoderFormat:h,engineFormat:d}}(d,f,p,v);if(!f||!p||!g)throw h(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!a.startTranscoding())throw h(),new Error("THREE.KTX2Loader: .startTranscoding failed");const x=[],b=[];for(let e=0;e<A;e++){const t=[];for(let n=0;n<g;n++){const r=[];let i,s;for(let t=0;t<m;t++){const o=a.getImageLevelInfo(n,t,e);0===e&&0===n&&0===t&&(o.origWidth%4!=0||o.origHeight),g>1?(i=o.origWidth,s=o.origHeight):(i=o.width,s=o.height);const l=new Uint8Array(a.getImageTranscodedSizeInBytes(n,t,0,E));if(!a.transcodeImage(l,n,t,e,E,0,-1,-1))throw h(),new Error("THREE.KTX2Loader: .transcodeImage failed.");r.push(l)}const o=u(r);t.push({data:o,width:i,height:s}),b.push(o.buffer)}x.push({mipmaps:t,width:f,height:p,format:_})}return h(),{faces:x,buffers:b,width:f,height:p,hasAlpha:v,format:_,dfdFlags:y}}(h.buffer);self.postMessage({type:"transcode",id:h.id,faces:t,width:d,height:f,hasAlpha:p,format:m,dfdFlags:g},a)}catch(e){self.postMessage({type:"error",id:h.id,error:e.message})}})}var d});const a=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],o=a.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),l=a.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(e){return e<=2||!(e&e-1)&&0!==e}function u(e){if(1===e.length)return e[0];let t=0;for(let n=0;n<e.length;n++){t+=e[n].byteLength}const n=new Uint8Array(t);let r=0;for(let t=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.byteLength}return n}}),t})(),wT=new Set([ye,Se,xe]),CT={[nT]:ye,[ZC]:ye,[qC]:ye,[XC]:ye,[tT]:Se,[JC]:Se,[YC]:Se,[KC]:Se,[eT]:xe,[$C]:xe,[WC]:xe,[jC]:xe,[iT]:Qe,[rT]:Qe},TT={[nT]:pe,[ZC]:me,[qC]:le,[XC]:le,[tT]:pe,[JC]:me,[YC]:le,[KC]:le,[eT]:pe,[$C]:me,[WC]:le,[jC]:le,[iT]:le,[rT]:le};function MT(e){const t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?_T:"srgb-linear":10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(t.colorPrimaries,"")}class IT extends fh{constructor(e){super(e),this.type=me}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},n=function(e,t,n){t=t||1024;let r=e.pos,i=-1,s=0,a="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(i=o.indexOf("\n"))&&s<t&&r<e.byteLength;)a+=o,s+=o.length,r+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i&&(!1!==n&&(e.pos+=s+i+1),a+o.slice(0,i))},r=function(e,t,n,r){const i=e[t+3],s=Math.pow(2,i-128)/255;n[r+0]=e[t+0]*s,n[r+1]=e[t+1]*s,n[r+2]=e[t+2]*s,n[r+3]=1},i=function(e,t,n,r){const i=e[t+3],s=Math.pow(2,i-128)/255;n[r+0]=ai.toHalfFloat(Math.min(e[t+0]*s,65504)),n[r+1]=ai.toHalfFloat(Math.min(e[t+1]*s,65504)),n[r+2]=ai.toHalfFloat(Math.min(e[t+2]*s,65504)),n[r+3]=ai.toHalfFloat(1)},s=new Uint8Array(e);s.pos=0;const a=function(e){const r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=n(e)))&&t(1,"no header found"),(c=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),o.valid|=1,o.programtype=c[1],o.string+=l+"\n";l=n(e),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(r))&&(o.gamma=parseFloat(c[1])),(c=l.match(i))&&(o.exposure=parseFloat(c[1])),(c=l.match(s))&&(o.valid|=2,o.format=c[1]),(c=l.match(a))&&(o.valid|=4,o.height=parseInt(c[1],10),o.width=parseInt(c[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid||t(3,"missing format specifier"),4&o.valid||t(3,"missing image size specifier"),o}(s),o=a.width,l=a.height,c=function(e,n,r){const i=n;if(i<8||i>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);i!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const s=new Uint8Array(4*n*r);s.length||t(4,"unable to allocate buffer space");let a=0,o=0;const l=4*i,c=new Uint8Array(4),u=new Uint8Array(l);let h=r;for(;h>0&&o<e.byteLength;){o+4>e.byteLength&&t(1),c[0]=e[o++],c[1]=e[o++],c[2]=e[o++],c[3]=e[o++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==i||t(3,"bad rgbe scanline format");let n,r=0;for(;r<l&&o<e.byteLength;){n=e[o++];const i=n>128;if(i&&(n-=128),(0===n||r+n>l)&&t(3,"bad scanline data"),i){const t=e[o++];for(let e=0;e<n;e++)u[r++]=t}else u.set(e.subarray(o,o+n),r),r+=n,o+=n}const d=i;for(let e=0;e<d;e++){let t=0;s[a]=u[e+t],t+=i,s[a+1]=u[e+t],t+=i,s[a+2]=u[e+t],t+=i,s[a+3]=u[e+t],a+=4}h--}return s}(s.subarray(s.pos),o,l);let u,h,d;switch(this.type){case pe:d=c.length/4;const e=new Float32Array(4*d);for(let t=0;t<d;t++)r(c,4*t,e,4*t);u=e,h=pe;break;case me:d=c.length/4;const t=new Uint16Array(4*d);for(let e=0;e<d;e++)i(c,4*e,t,4*e);u=t,h=me;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:o,height:l,data:u,header:a.string,gamma:a.gamma,exposure:a.exposure,type:h}}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,function(e,n){switch(e.type){case pe:case me:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=ie,e.magFilter=ie,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)},n,r)}}const RT=Ix>=152;class BT extends fh{constructor(e){super(e),this.type=me}parse(e){const t=65536,n=14,r=65537,i=16384,s=Math.pow(2.7182818,2.2);const a={l:0,c:0,lc:0};function o(e,t,n,r,i){for(;n<e;)t=t<<8|G(r,i),n+=8;n-=e,a.l=t>>n&(1<<e)-1,a.c=t,a.lc=n}const l=new Array(59);function c(e,t,n,i,s,c,u){for(var h=n,d=0,f=0;s<=c;s++){if(h.value-n.value>i)return!1;o(6,d,f,e,h);var p=a.l;if(d=a.c,f=a.lc,u[s]=p,63==p){if(h.value-n.value>i)throw"Something wrong with hufUnpackEncTable";o(8,d,f,e,h);var m=a.l+6;if(d=a.c,f=a.lc,s+m>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)u[s++]=0;s--}else if(p>=59){if(s+(m=p-59+2)>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)u[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)l[t]=0;for(t=0;t<r;++t)l[e[t]]+=1;var n=0;for(t=58;t>0;--t){var i=n+l[t]>>1;l[t]=n,n=i}for(t=0;t<r;++t){var s=e[t];s>0&&(e[t]=s|l[s]++<<6)}}(u)}function u(e){return 63&e}function h(e){return e>>6}const d={c:0,lc:0};function f(e,t,n,r){e=e<<8|G(n,r),t+=8,d.c=e,d.lc=t}const p={c:0,lc:0};function m(e,t,n,r,i,s,a,o,l,c){if(e==t){r<8&&(f(n,r,i,a),n=d.c,r=d.lc);var u=n>>(r-=8);u=new Uint8Array([u])[0];if(l.value+u>c)return!1;for(var h=o[l.value-1];u-- >0;)o[l.value++]=h}else{if(!(l.value<c))return!1;o[l.value++]=e}p.c=n,p.lc=r}function g(e){return 65535&e}function A(e){var t=g(e);return t>32767?t-65536:t}const v={a:0,b:0};function y(e,t){var n=A(e),r=A(t),i=n+(1&r)+(r>>1),s=i,a=i-r;v.a=s,v.b=a}function E(e,t){var n=g(e),r=g(t),i=n-(r>>1)&65535,s=r+i-32768&65535;v.a=s,v.b=i}function _(e,t,n,r,i,s,a){for(var o,l=a<16384,c=n>i?i:n,u=1;u<=c;)u<<=1;for(o=u>>=1,u>>=1;u>=1;){for(var h,d,f,p,m=0,g=m+s*(i-o),A=s*u,_=s*o,x=r*u,b=r*o;m<=g;m+=_){for(var S=m,w=m+r*(n-o);S<=w;S+=b){var C=S+x,T=(M=S+A)+x;l?(y(e[S+t],e[M+t]),h=v.a,f=v.b,y(e[C+t],e[T+t]),d=v.a,p=v.b,y(h,d),e[S+t]=v.a,e[C+t]=v.b,y(f,p),e[M+t]=v.a,e[T+t]=v.b):(E(e[S+t],e[M+t]),h=v.a,f=v.b,E(e[C+t],e[T+t]),d=v.a,p=v.b,E(h,d),e[S+t]=v.a,e[C+t]=v.b,E(f,p),e[M+t]=v.a,e[T+t]=v.b)}if(n&u){var M=S+A;l?y(e[S+t],e[M+t]):E(e[S+t],e[M+t]),h=v.a,e[M+t]=v.b,e[S+t]=h}}if(i&u)for(S=m,w=m+r*(n-o);S<=w;S+=b){C=S+x;l?y(e[S+t],e[C+t]):E(e[S+t],e[C+t]),h=v.a,e[C+t]=v.b,e[S+t]=h}o=u,u>>=1}return m}function x(e,t,s,a,o,l){var g=s.value,A=z(t,s),v=z(t,s);s.value+=4;var y=z(t,s);if(s.value+=4,A<0||A>=r||v<0||v>=r)throw"Something wrong with HUF_ENCSIZE";var E=new Array(r),_=new Array(i);if(function(e){for(var t=0;t<i;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(_),c(e,0,s,a-(s.value-g),A,v,E),y>8*(a-(s.value-g)))throw"Something wrong with hufUncompress";!function(e,t,r,i){for(;t<=r;t++){var s=h(e[t]),a=u(e[t]);if(s>>a)throw"Invalid table entry";if(a>n){if((d=i[s>>a-n]).len)throw"Invalid table entry";if(d.lit++,d.p){var o=d.p;d.p=new Array(d.lit);for(var l=0;l<d.lit-1;++l)d.p[l]=o[l]}else d.p=new Array(1);d.p[d.lit-1]=t}else if(a){var c=0;for(l=1<<n-a;l>0;l--){var d;if((d=i[(s<<n-a)+c]).len||d.p)throw"Invalid table entry";d.len=a,d.lit=t,c++}}}}(E,A,v,_),function(e,t,r,i,s,a,o,l,c,g){for(var A=0,v=0,y=l,E=Math.trunc(s.value+(a+7)/8);s.value<E;)for(f(A,v,r,s),A=d.c,v=d.lc;v>=n;)if((S=t[A>>v-n&16383]).len)v-=S.len,m(S.lit,o,A,v,r,0,s,c,g,y),A=p.c,v=p.lc;else{if(!S.p)throw"hufDecode issues";var _;for(_=0;_<S.lit;_++){for(var x=u(e[S.p[_]]);v<x&&s.value<E;)f(A,v,r,s),A=d.c,v=d.lc;if(v>=x&&h(e[S.p[_]])==(A>>v-x&(1<<x)-1)){v-=x,m(S.p[_],o,A,v,r,0,s,c,g,y),A=p.c,v=p.lc;break}}if(_==S.lit)throw"hufDecode issues"}var b=8-a&7;for(A>>=b,v-=b;v>0;){var S;if(!(S=t[A<<n-v&16383]).len)throw"hufDecode issues";v-=S.len,m(S.lit,o,A,v,r,0,s,c,g,y),A=p.c,v=p.lc}}(E,_,e,0,s,y,v,l,o,{value:0})}function b(e){for(var t=1;t<e.length;t++){var n=e[t-1]+e[t]-128;e[t]=n}}function S(e,t){for(var n=0,r=Math.floor((e.length+1)/2),i=0,s=e.length-1;!(i>s||(t[i++]=e[n++],i>s));)t[i++]=e[r++]}function w(e){for(var t=e.byteLength,n=new Array,r=0,i=new DataView(e);t>0;){var s=i.getInt8(r++);if(s<0){t-=(o=-s)+1;for(var a=0;a<o;a++)n.push(i.getUint8(r++))}else{var o=s;t-=2;var l=i.getUint8(r++);for(a=0;a<o+1;a++)n.push(l)}}return n}function C(e,t,n){for(var r,i=1;i<64;)65280==(r=t[e.value])?i=64:r>>8==255?i+=255&r:(n[i]=r,i++),e.value++}function T(e,t){t[0]=W(e[0]),t[1]=W(e[1]),t[2]=W(e[5]),t[3]=W(e[6]),t[4]=W(e[14]),t[5]=W(e[15]),t[6]=W(e[27]),t[7]=W(e[28]),t[8]=W(e[2]),t[9]=W(e[4]),t[10]=W(e[7]),t[11]=W(e[13]),t[12]=W(e[16]),t[13]=W(e[26]),t[14]=W(e[29]),t[15]=W(e[42]),t[16]=W(e[3]),t[17]=W(e[8]),t[18]=W(e[12]),t[19]=W(e[17]),t[20]=W(e[25]),t[21]=W(e[30]),t[22]=W(e[41]),t[23]=W(e[43]),t[24]=W(e[9]),t[25]=W(e[11]),t[26]=W(e[18]),t[27]=W(e[24]),t[28]=W(e[31]),t[29]=W(e[40]),t[30]=W(e[44]),t[31]=W(e[53]),t[32]=W(e[10]),t[33]=W(e[19]),t[34]=W(e[23]),t[35]=W(e[32]),t[36]=W(e[39]),t[37]=W(e[45]),t[38]=W(e[52]),t[39]=W(e[54]),t[40]=W(e[20]),t[41]=W(e[22]),t[42]=W(e[33]),t[43]=W(e[38]),t[44]=W(e[46]),t[45]=W(e[51]),t[46]=W(e[55]),t[47]=W(e[60]),t[48]=W(e[21]),t[49]=W(e[34]),t[50]=W(e[37]),t[51]=W(e[47]),t[52]=W(e[50]),t[53]=W(e[56]),t[54]=W(e[59]),t[55]=W(e[61]),t[56]=W(e[35]),t[57]=W(e[36]),t[58]=W(e[48]),t[59]=W(e[49]),t[60]=W(e[57]),t[61]=W(e[58]),t[62]=W(e[62]),t[63]=W(e[63])}function M(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),a=.5*Math.cos(3*3.14159/8),o=.5*Math.cos(1.374445625);for(var l=new Array(4),c=new Array(4),u=new Array(4),h=new Array(4),d=0;d<8;++d){var f=8*d;l[0]=r*e[f+2],l[1]=a*e[f+2],l[2]=r*e[f+6],l[3]=a*e[f+6],c[0]=n*e[f+1]+i*e[f+3]+s*e[f+5]+o*e[f+7],c[1]=i*e[f+1]-o*e[f+3]-n*e[f+5]-s*e[f+7],c[2]=s*e[f+1]-n*e[f+3]+o*e[f+5]+i*e[f+7],c[3]=o*e[f+1]-s*e[f+3]+i*e[f+5]-n*e[f+7],u[0]=t*(e[f+0]+e[f+4]),u[3]=t*(e[f+0]-e[f+4]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[f+0]=h[0]+c[0],e[f+1]=h[1]+c[1],e[f+2]=h[2]+c[2],e[f+3]=h[3]+c[3],e[f+4]=h[3]-c[3],e[f+5]=h[2]-c[2],e[f+6]=h[1]-c[1],e[f+7]=h[0]-c[0]}for(var p=0;p<8;++p)l[0]=r*e[16+p],l[1]=a*e[16+p],l[2]=r*e[48+p],l[3]=a*e[48+p],c[0]=n*e[8+p]+i*e[24+p]+s*e[40+p]+o*e[56+p],c[1]=i*e[8+p]-o*e[24+p]-n*e[40+p]-s*e[56+p],c[2]=s*e[8+p]-n*e[24+p]+o*e[40+p]+i*e[56+p],c[3]=o*e[8+p]-s*e[24+p]+i*e[40+p]-n*e[56+p],u[0]=t*(e[p]+e[32+p]),u[3]=t*(e[p]-e[32+p]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[0+p]=h[0]+c[0],e[8+p]=h[1]+c[1],e[16+p]=h[2]+c[2],e[24+p]=h[3]+c[3],e[32+p]=h[3]-c[3],e[40+p]=h[2]-c[2],e[48+p]=h[1]-c[1],e[56+p]=h[0]-c[0]}function I(e){for(var t=0;t<64;++t){var n=e[0][t],r=e[1][t],i=e[2][t];e[0][t]=n+1.5747*i,e[1][t]=n-.1873*r-.4682*i,e[2][t]=n+1.8556*r}}function R(e,t,n){for(var r=0;r<64;++r)t[n+r]=ai.toHalfFloat(B(e[r]))}function B(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(s,Math.abs(e)-1)}function P(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function D(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(w(t)),r=new Uint8Array(n.length);return b(n),S(n,r),new DataView(r.buffer)}function L(e){var t=cb(e.array.slice(e.offset.value,e.offset.value+e.size)),n=new Uint8Array(t.length);return b(t),S(t,n),new DataView(n.buffer)}function k(e){for(var n=e.viewer,r={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),s=new Uint8Array(8192),a=0,o=new Array(e.channels),l=0;l<e.channels;l++)o[l]={},o[l].start=a,o[l].end=o[l].start,o[l].nx=e.width,o[l].ny=e.lines,o[l].size=e.type,a+=o[l].nx*o[l].ny*o[l].size;var c=Y(n,r),u=Y(n,r);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=u)for(l=0;l<u-c+1;l++)s[l+c]=Q(n,r);var h=new Uint16Array(t),d=function(e,n){for(var r=0,i=0;i<t;++i)(0==i||e[i>>3]&1<<(7&i))&&(n[r++]=i);for(var s=r-1;r<t;)n[r++]=0;return s}(s,h),f=z(n,r);x(e.array,n,r,f,i,a);for(l=0;l<e.channels;++l)for(var p=o[l],m=0;m<o[l].size;++m)_(i,p.start+m,p.nx,p.size,p.ny,p.nx*p.size,d);!function(e,t,n){for(var r=0;r<n;++r)t[r]=e[t[r]]}(h,i,a);for(var g=0,A=new Uint8Array(i.buffer.byteLength),v=0;v<e.lines;v++)for(var y=0;y<e.channels;y++){var E=(p=o[y]).nx*p.size,b=new Uint8Array(i.buffer,2*p.end,2*E);A.set(b,g),g+=2*E,p.end+=E}return new DataView(A.buffer)}function F(e){var t=cb(e.array.slice(e.offset.value,e.offset.value+e.size));const n=e.lines*e.channels*e.width,r=1==e.type?new Uint16Array(n):new Uint32Array(n);let i=0,s=0;const a=new Array(4);for(let n=0;n<e.lines;n++)for(let n=0;n<e.channels;n++){let n=0;switch(e.type){case 1:a[0]=i,a[1]=a[0]+e.width,i=a[1]+e.width;for(let i=0;i<e.width;++i){n+=t[a[0]++]<<8|t[a[1]++],r[s]=n,s++}break;case 2:a[0]=i,a[1]=a[0]+e.width,a[2]=a[1]+e.width,i=a[2]+e.width;for(let i=0;i<e.width;++i){n+=t[a[0]++]<<24|t[a[1]++]<<16|t[a[2]++]<<8,r[s]=n,s++}}}return new DataView(r.buffer)}function O(e){var t=e.viewer,n={value:e.offset.value},r=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:H(t,n),unknownUncompressedSize:H(t,n),unknownCompressedSize:H(t,n),acCompressedSize:H(t,n),dcCompressedSize:H(t,n),rleCompressedSize:H(t,n),rleUncompressedSize:H(t,n),rleRawSize:H(t,n),totalAcUncompressedCount:H(t,n),totalDcUncompressedCount:H(t,n),acCompression:H(t,n)};if(i.version<2)throw"EXRLoader.parse: "+Z.compression+" version "+i.version+" is unsupported";for(var s=new Array,a=Y(t,n)-2;a>0;){var o=U(t.buffer,n),l=Q(t,n),c=l>>2&3,u=new Int8Array([(l>>4)-1])[0],h=Q(t,n);s.push({name:o,index:u,type:h,compression:c}),a-=o.length+3}for(var d=Z.channels,f=new Array(e.channels),p=0;p<e.channels;++p){var m=f[p]={},g=d[p];m.name=g.name,m.compression=0,m.decoded=!1,m.type=g.pixelType,m.pLinear=g.pLinear,m.width=e.width,m.height=e.lines}for(var A={idx:new Array(3)},v=0;v<e.channels;++v)for(m=f[v],p=0;p<s.length;++p){var y=s[p];m.name==y.name&&(m.compression=y.compression,y.index>=0&&(A.idx[y.index]=v),m.offset=v)}if(i.acCompressedSize>0)switch(i.acCompression){case 0:var E=new Uint16Array(i.totalAcUncompressedCount);x(e.array,t,n,i.acCompressedSize,E,i.totalAcUncompressedCount);break;case 1:var _=cb(e.array.slice(n.value,n.value+i.totalAcUncompressedCount));E=new Uint16Array(_.buffer);n.value+=i.totalAcUncompressedCount}if(i.dcCompressedSize>0){var b={array:e.array,offset:n,size:i.dcCompressedSize},S=new Uint16Array(L(b).buffer);n.value+=i.dcCompressedSize}if(i.rleRawSize>0){var B=w((_=cb(e.array.slice(n.value,n.value+i.rleCompressedSize))).buffer);n.value+=i.rleCompressedSize}var P=0,D=new Array(f.length);for(p=0;p<D.length;++p)D[p]=new Array;for(var k=0;k<e.lines;++k)for(var F=0;F<f.length;++F)D[F].push(P),P+=f[F].width*e.type*2;!function(e,t,n,r,i,s){var a=new DataView(s.buffer),o=n[e.idx[0]].width,l=n[e.idx[0]].height,c=Math.floor(o/8),u=Math.ceil(o/8),h=Math.ceil(l/8),d=o-8*(u-1),f=l-8*(h-1),p={value:0},m=new Array(3),g=new Array(3),A=new Array(3),v=new Array(3),y=new Array(3);for(let n=0;n<3;++n)y[n]=t[e.idx[n]],m[n]=n<1?0:m[n-1]+u*h,g[n]=new Float32Array(64),A[n]=new Uint16Array(64),v[n]=new Uint16Array(64*u);for(let t=0;t<h;++t){var E=8;t==h-1&&(E=f);var _=8;for(let e=0;e<u;++e){e==u-1&&(_=d);for(let e=0;e<3;++e)A[e].fill(0),A[e][0]=i[m[e]++],C(p,r,A[e]),T(A[e],g[e]),M(g[e]);I(g);for(let t=0;t<3;++t)R(g[t],v[t],64*e)}let s=0;for(let r=0;r<3;++r){const i=n[e.idx[r]].type;for(let e=8*t;e<8*t+E;++e){s=y[r][e];for(let t=0;t<c;++t){const n=64*t+8*(7&e);a.setUint16(s+0*i,v[r][n+0],!0),a.setUint16(s+2*i,v[r][n+1],!0),a.setUint16(s+4*i,v[r][n+2],!0),a.setUint16(s+6*i,v[r][n+3],!0),a.setUint16(s+8*i,v[r][n+4],!0),a.setUint16(s+10*i,v[r][n+5],!0),a.setUint16(s+12*i,v[r][n+6],!0),a.setUint16(s+14*i,v[r][n+7],!0),s+=16*i}}if(c!=u)for(let e=8*t;e<8*t+E;++e){const t=y[r][e]+8*c*2*i,n=64*c+8*(7&e);for(let e=0;e<_;++e)a.setUint16(t+2*e*i,v[r][n+e],!0)}}}for(var x=new Uint16Array(o),b=(a=new DataView(s.buffer),0);b<3;++b){n[e.idx[b]].decoded=!0;var S=n[e.idx[b]].type;if(2==n[b].type)for(var w=0;w<l;++w){const e=y[b][w];for(var B=0;B<o;++B)x[B]=a.getUint16(e+2*B*S,!0);for(B=0;B<o;++B)a.setFloat32(e+2*B*S,W(x[B]),!0)}}}(A,D,f,E,S,r);for(p=0;p<f.length;++p){if(!(m=f[p]).decoded){if(2!==m.compression)throw"EXRLoader.parse: unsupported channel compression";var O=0,N=0;for(k=0;k<e.lines;++k){for(var z=D[p][O],G=0;G<m.width;++G){for(var V=0;V<2*m.type;++V)r[z++]=B[N+V*m.width*m.height];N++}O++}}}return new DataView(r.buffer)}function U(e,t){for(var n=new Uint8Array(e),r=0;0!=n[t.value+r];)r+=1;var i=(new TextDecoder).decode(n.slice(t.value,t.value+r));return t.value=t.value+r+1,i}function N(e,t){var n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function z(e,t){var n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function G(e,t){var n=e[t.value];return t.value=t.value+1,n}function Q(e,t){var n=e.getUint8(t.value);return t.value=t.value+1,n}const H=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function V(e,t){var n=e.getFloat32(t.value,!0);return t.value+=4,n}function j(e,t){return ai.toHalfFloat(V(e,t))}function W(e){var t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function Y(e,t){var n=e.getUint16(t.value,!0);return t.value+=2,n}function K(e,t){return W(Y(e,t))}function q(e,t,n,r,i){return"string"===r||"stringvector"===r||"iccProfile"===r?function(e,t,n){var r=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,r}(t,n,i):"chlist"===r?function(e,t,n,r){for(var i=n.value,s=[];n.value<i+r-1;){var a=U(t,n),o=N(e,n),l=Q(e,n);n.value+=3;var c=N(e,n),u=N(e,n);s.push({name:a,pixelType:o,pLinear:l,xSampling:c,ySampling:u})}return n.value+=1,s}(e,t,n,i):"chromaticities"===r?function(e,t){return{redX:V(e,t),redY:V(e,t),greenX:V(e,t),greenY:V(e,t),blueX:V(e,t),blueY:V(e,t),whiteX:V(e,t),whiteY:V(e,t)}}(e,n):"compression"===r?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Q(e,t)]}(e,n):"box2i"===r?function(e,t){return{xMin:z(e,t),yMin:z(e,t),xMax:z(e,t),yMax:z(e,t)}}(e,n):"lineOrder"===r?function(e,t){return["INCREASING_Y"][Q(e,t)]}(e,n):"float"===r?V(e,n):"v2f"===r?function(e,t){return[V(e,t),V(e,t)]}(e,n):"v3f"===r?function(e,t){return[V(e,t),V(e,t),V(e,t)]}(e,n):"int"===r?N(e,n):"rational"===r?function(e,t){return[N(e,t),z(e,t)]}(e,n):"timecode"===r?function(e,t){return[z(e,t),z(e,t)]}(e,n):"preview"===r?(n.value+=i,"skipped"):void(n.value+=i)}const X=new DataView(e),$=new Uint8Array(e),J={value:0},Z=function(e,t,n){const r={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";r.version=e.getUint8(4);const i=e.getUint8(5);r.spec={singleTile:!!(2&i),longName:!!(4&i),deepFormat:!!(8&i),multiPart:!!(16&i)},n.value=8;for(var s=!0;s;){var a=U(t,n);if(0==a)s=!1;else{var o=q(e,t,n,U(t,n),z(e,n));void 0===o||(r[a]=o)}}if(-5&i)throw"THREE.EXRLoader: provided file is currently unsupported.";return r}(X,e,J),ee=function(e,t,n,r,i){const s={size:0,viewer:t,array:n,offset:r,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[RT?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":s.lines=1,s.uncompress=P;break;case"RLE_COMPRESSION":s.lines=1,s.uncompress=D;break;case"ZIPS_COMPRESSION":s.lines=1,s.uncompress=L;break;case"ZIP_COMPRESSION":s.lines=16,s.uncompress=L;break;case"PIZ_COMPRESSION":s.lines=32,s.uncompress=k;break;case"PXR24_COMPRESSION":s.lines=16,s.uncompress=F;break;case"DWAA_COMPRESSION":s.lines=32,s.uncompress=O;break;case"DWAB_COMPRESSION":s.lines=256,s.uncompress=O;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(s.scanlineBlockSize=s.lines,1==s.type)switch(i){case pe:s.getter=K,s.inputSize=2;break;case me:s.getter=Y,s.inputSize=2}else{if(2!=s.type)throw"EXRLoader.parse: unsupported pixelType "+s.type+" for "+e.compression+".";switch(i){case pe:s.getter=V,s.inputSize=4;break;case me:s.getter=j,s.inputSize=4}}s.blockCount=(e.dataWindow.yMax+1)/s.scanlineBlockSize;for(var a=0;a<s.blockCount;a++)H(t,r);s.outputChannels=3==s.channels?4:s.channels;const o=s.width*s.height*s.outputChannels;switch(i){case pe:s.byteArray=new Float32Array(o),s.channels<s.outputChannels&&s.byteArray.fill(1,0,o);break;case me:s.byteArray=new Uint16Array(o),s.channels<s.outputChannels&&s.byteArray.fill(15360,0,o)}return s.bytesPerLine=s.width*s.inputSize*s.channels,4==s.outputChannels?s.format=ye:s.format=xe,RT?s.colorSpace="srgb-linear":s.encoding=3e3,s}(Z,X,$,J,this.type),te={value:0},ne={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<ee.height/ee.scanlineBlockSize;e++){const t=z(X,J);ee.size=z(X,J),ee.lines=t+ee.scanlineBlockSize>ee.height?ee.height-t:ee.scanlineBlockSize;const n=ee.size<ee.lines*ee.bytesPerLine?ee.uncompress(ee):P(ee);J.value+=ee.size;for(let t=0;t<ee.scanlineBlockSize;t++){const r=t+e*ee.scanlineBlockSize;if(r>=ee.height)break;for(let e=0;e<ee.channels;e++){const i=ne[Z.channels[e].name];for(let s=0;s<ee.width;s++){te.value=(t*(ee.channels*ee.width)+e*ee.width+s)*ee.inputSize;const a=(ee.height-1-r)*(ee.width*ee.outputChannels)+s*ee.outputChannels+i;ee.byteArray[a]=ee.getter(n,te)}}}}return{header:Z,width:ee.width,height:ee.height,data:ee.byteArray,format:ee.format,[RT?"colorSpace":"encoding"]:ee[RT?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,function(e,n){RT?e.colorSpace=n.colorSpace:e.encoding=n.encoding,e.minFilter=ie,e.magFilter=ie,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,n)},n,r)}}const PT=(()=>{class e extends oh{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,n,r){const i=this,s=new uh(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,function(n){try{t(i.parse(n))}catch(t){r&&r(t),i.manager.itemError(e)}},n,r)}parse(e){const t=this;function n(e,t,n,i,s,a,o,l){if(0==t||0==n)return void e.lineTo(l.x,l.y);i=i*Math.PI/180,t=Math.abs(t),n=Math.abs(n);const c=(o.x-l.x)/2,u=(o.y-l.y)/2,h=Math.cos(i)*c+Math.sin(i)*u,d=-Math.sin(i)*c+Math.cos(i)*u;let f=t*t,p=n*n;const m=h*h,g=d*d,A=m/f+g/p;if(A>1){const e=Math.sqrt(A);f=(t*=e)*t,p=(n*=e)*n}const v=f*g+p*m,y=(f*p-v)/v;let E=Math.sqrt(Math.max(0,y));s===a&&(E=-E);const _=E*t*d/n,x=-E*n*h/t,b=Math.cos(i)*_-Math.sin(i)*x+(o.x+l.x)/2,S=Math.sin(i)*_+Math.cos(i)*x+(o.y+l.y)/2,w=r(1,0,(h-_)/t,(d-x)/n),C=r((h-_)/t,(d-x)/n,(-h-_)/t,(-d-x)/n)%(2*Math.PI);e.currentPath.absellipse(b,S,t,n,w,w+C,0===a,i)}function r(e,t,n,r){const i=e*n+t*r,s=Math.sqrt(e*e+t*t)*Math.sqrt(n*n+r*r);let a=Math.acos(Math.max(-1,Math.min(1,i/s)));return e*r-t*n<0&&(a=-a),a}function i(e,t){t=Object.assign({},t);let n={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map(e=>e.trim());for(let e=0;e<t.length;e++)n=Object.assign(n,m["."+t[e]])}function r(r,i,s){void 0===s&&(s=function(e){return e.startsWith("url"),e}),e.hasAttribute(r)&&(t[i]=s(e.getAttribute(r))),n[r]&&(t[i]=s(n[r])),e.style&&""!==e.style[r]&&(t[i]=s(e.style[r]))}function i(e){return Math.max(0,Math.min(1,c(e)))}function s(e){return Math.max(0,c(e))}return e.hasAttribute("id")&&(n=Object.assign(n,m["#"+e.getAttribute("id")])),r("fill","fill"),r("fill-opacity","fillOpacity",i),r("fill-rule","fillRule"),r("opacity","opacity",i),r("stroke","stroke"),r("stroke-opacity","strokeOpacity",i),r("stroke-width","strokeWidth",s),r("stroke-linejoin","strokeLineJoin"),r("stroke-linecap","strokeLineCap"),r("stroke-miterlimit","strokeMiterLimit",s),r("visibility","visibility"),t}function s(e,t){return e-(t-e)}function a(e,t,n){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const r={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let i=0,s=!0,a="",o="";const l=[];function c(e,t,n){const r=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw r.partial=n,r}function u(){""!==a&&(""===o?l.push(Number(a)):l.push(Number(a)*Math.pow(10,Number(o)))),a="",o=""}let h;const d=e.length;for(let f=0;f<d;f++)if(h=e[f],Array.isArray(t)&&t.includes(l.length%n)&&r.FLAGS.test(h))i=1,a=h,u();else{if(0===i){if(r.WHITESPACE.test(h))continue;if(r.DIGIT.test(h)||r.SIGN.test(h)){i=1,a=h;continue}if(r.POINT.test(h)){i=2,a=h;continue}r.COMMA.test(h)&&(s&&c(h,f,l),s=!0)}if(1===i){if(r.DIGIT.test(h)){a+=h;continue}if(r.POINT.test(h)){a+=h,i=2;continue}if(r.EXP.test(h)){i=3;continue}r.SIGN.test(h)&&1===a.length&&r.SIGN.test(a[0])&&c(h,f,l)}if(2===i){if(r.DIGIT.test(h)){a+=h;continue}if(r.EXP.test(h)){i=3;continue}r.POINT.test(h)&&"."===a[a.length-1]&&c(h,f,l)}if(3===i){if(r.DIGIT.test(h)){o+=h;continue}if(r.SIGN.test(h)){if(""===o){o+=h;continue}1===o.length&&r.SIGN.test(o)&&c(h,f,l)}}r.WHITESPACE.test(h)?(u(),i=0,s=!1):r.COMMA.test(h)?(u(),i=0,s=!0):r.SIGN.test(h)?(u(),i=1,a=h):r.POINT.test(h)?(u(),i=2,a=h):c(h,f,l)}return u(),l}const o=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function c(e){let n,r="px";if("string"==typeof e||e instanceof String)for(let t=0,n=o.length;t<n;t++){const n=o[t];if(e.endsWith(n)){r=n,e=e.substring(0,e.length-n.length);break}}return"px"===r&&"px"!==t.defaultUnit?n=l.in[t.defaultUnit]/t.defaultDPI:(n=l[r][t.defaultUnit],n<0&&(n=l[r].in*t.defaultDPI)),n*parseFloat(e)}function u(e){const t=e.elements;return t[0]*t[4]-t[1]*t[3]<0}function h(e){const t=e.elements,n=t[0]*t[3]+t[1]*t[4];if(0===n)return!1;const r=d(e),i=f(e);return Math.abs(n/(r*i))>Number.EPSILON}function d(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function f(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const p=[],m={},g=[],A=new rn,v=new rn,y=new rn,E=new rn,_=new nn,x=new Dn,b=new rn,S=(new DOMParser).parseFromString(e,"image/svg+xml");!function e(t,r){if(1!==t.nodeType)return;const o=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;const t=function(e){const t=new rn,n=A;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){const n=c(e.getAttribute("x")),r=c(e.getAttribute("y"));t.translate(n,r)}if(e.hasAttribute("transform")){const r=e.getAttribute("transform").split(")");for(let e=r.length-1;e>=0;e--){const i=r[e].trim();if(""===i)continue;const s=i.indexOf("("),o=i.length;if(s>0&&s<o){const e=i.slice(0,s),t=a(i.slice(s+1));switch(n.identity(),e){case"translate":if(t.length>=1){const e=t[0];let r=0;t.length>=2&&(r=t[1]),n.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,i=0;e=t[0]*Math.PI/180,t.length>=3&&(r=t[1],i=t[2]),v.makeTranslation(-r,-i),y.makeRotation(e),E.multiplyMatrices(y,v),v.makeTranslation(r,i),n.multiplyMatrices(v,E)}break;case"scale":if(t.length>=1){const e=t[0];let r=e;t.length>=2&&(r=t[1]),n.scale(e,r)}break;case"skewX":1===t.length&&n.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&n.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&n.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(n)}}return t}(e);g.length>0&&t.premultiply(g[g.length-1]);return b.copy(t),g.push(t),t}(t);let l=!1,S=null;switch(t.nodeName){case"svg":case"g":r=i(t,r);break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(let t=0;t<e.sheet.cssRules.length;t++){const n=e.sheet.cssRules[t];if(1!==n.type)continue;const r=n.selectorText.split(/,/gm).filter(Boolean).map(e=>e.trim());for(let e=0;e<r.length;e++){const t=Object.fromEntries(Object.entries(n.style).filter(([,e])=>""!==e));m[r[e]]=Object.assign(m[r[e]]||{},t)}}}(t);break;case"path":r=i(t,r),t.hasAttribute("d")&&(S=function(e){const t=new Xd,r=new nn,i=new nn,o=new nn;let l=!0,c=!1;const u=e.getAttribute("d");if(""===u||"none"===u)return null;const h=u.match(/[a-df-z][^a-df-z]*/gi);for(let e=0,u=h.length;e<u;e++){const u=h[e],d=u.charAt(0),f=u.slice(1).trim();let p;switch(!0===l&&(c=!0,l=!1),d){case"M":p=a(f);for(let e=0,n=p.length;e<n;e+=2)r.x=p[e+0],r.y=p[e+1],i.x=r.x,i.y=r.y,0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===e&&o.copy(r);break;case"H":p=a(f);for(let e=0,n=p.length;e<n;e++)r.x=p[e],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&o.copy(r);break;case"V":p=a(f);for(let e=0,n=p.length;e<n;e++)r.y=p[e],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&o.copy(r);break;case"L":p=a(f);for(let e=0,n=p.length;e<n;e+=2)r.x=p[e+0],r.y=p[e+1],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&o.copy(r);break;case"C":p=a(f);for(let e=0,n=p.length;e<n;e+=6)t.bezierCurveTo(p[e+0],p[e+1],p[e+2],p[e+3],p[e+4],p[e+5]),i.x=p[e+2],i.y=p[e+3],r.x=p[e+4],r.y=p[e+5],0===e&&!0===c&&o.copy(r);break;case"S":p=a(f);for(let e=0,n=p.length;e<n;e+=4)t.bezierCurveTo(s(r.x,i.x),s(r.y,i.y),p[e+0],p[e+1],p[e+2],p[e+3]),i.x=p[e+0],i.y=p[e+1],r.x=p[e+2],r.y=p[e+3],0===e&&!0===c&&o.copy(r);break;case"Q":p=a(f);for(let e=0,n=p.length;e<n;e+=4)t.quadraticCurveTo(p[e+0],p[e+1],p[e+2],p[e+3]),i.x=p[e+0],i.y=p[e+1],r.x=p[e+2],r.y=p[e+3],0===e&&!0===c&&o.copy(r);break;case"T":p=a(f);for(let e=0,n=p.length;e<n;e+=2){const n=s(r.x,i.x),a=s(r.y,i.y);t.quadraticCurveTo(n,a,p[e+0],p[e+1]),i.x=n,i.y=a,r.x=p[e+0],r.y=p[e+1],0===e&&!0===c&&o.copy(r)}break;case"A":p=a(f,[3,4],7);for(let e=0,s=p.length;e<s;e+=7){if(p[e+5]==r.x&&p[e+6]==r.y)continue;const s=r.clone();r.x=p[e+5],r.y=p[e+6],i.x=r.x,i.y=r.y,n(t,p[e],p[e+1],p[e+2],p[e+3],p[e+4],s,r),0===e&&!0===c&&o.copy(r)}break;case"m":p=a(f);for(let e=0,n=p.length;e<n;e+=2)r.x+=p[e+0],r.y+=p[e+1],i.x=r.x,i.y=r.y,0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===e&&o.copy(r);break;case"h":p=a(f);for(let e=0,n=p.length;e<n;e++)r.x+=p[e],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&o.copy(r);break;case"v":p=a(f);for(let e=0,n=p.length;e<n;e++)r.y+=p[e],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&o.copy(r);break;case"l":p=a(f);for(let e=0,n=p.length;e<n;e+=2)r.x+=p[e+0],r.y+=p[e+1],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===e&&!0===c&&o.copy(r);break;case"c":p=a(f);for(let e=0,n=p.length;e<n;e+=6)t.bezierCurveTo(r.x+p[e+0],r.y+p[e+1],r.x+p[e+2],r.y+p[e+3],r.x+p[e+4],r.y+p[e+5]),i.x=r.x+p[e+2],i.y=r.y+p[e+3],r.x+=p[e+4],r.y+=p[e+5],0===e&&!0===c&&o.copy(r);break;case"s":p=a(f);for(let e=0,n=p.length;e<n;e+=4)t.bezierCurveTo(s(r.x,i.x),s(r.y,i.y),r.x+p[e+0],r.y+p[e+1],r.x+p[e+2],r.y+p[e+3]),i.x=r.x+p[e+0],i.y=r.y+p[e+1],r.x+=p[e+2],r.y+=p[e+3],0===e&&!0===c&&o.copy(r);break;case"q":p=a(f);for(let e=0,n=p.length;e<n;e+=4)t.quadraticCurveTo(r.x+p[e+0],r.y+p[e+1],r.x+p[e+2],r.y+p[e+3]),i.x=r.x+p[e+0],i.y=r.y+p[e+1],r.x+=p[e+2],r.y+=p[e+3],0===e&&!0===c&&o.copy(r);break;case"t":p=a(f);for(let e=0,n=p.length;e<n;e+=2){const n=s(r.x,i.x),a=s(r.y,i.y);t.quadraticCurveTo(n,a,r.x+p[e+0],r.y+p[e+1]),i.x=n,i.y=a,r.x=r.x+p[e+0],r.y=r.y+p[e+1],0===e&&!0===c&&o.copy(r)}break;case"a":p=a(f,[3,4],7);for(let e=0,s=p.length;e<s;e+=7){if(0==p[e+5]&&0==p[e+6])continue;const s=r.clone();r.x+=p[e+5],r.y+=p[e+6],i.x=r.x,i.y=r.y,n(t,p[e],p[e+1],p[e+2],p[e+3],p[e+4],s,r),0===e&&!0===c&&o.copy(r)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(r.copy(o),t.currentPath.currentPoint.copy(r),l=!0)}c=!1}return t}(t));break;case"rect":r=i(t,r),S=function(e){const t=c(e.getAttribute("x")||0),n=c(e.getAttribute("y")||0),r=c(e.getAttribute("rx")||e.getAttribute("ry")||0),i=c(e.getAttribute("ry")||e.getAttribute("rx")||0),s=c(e.getAttribute("width")),a=c(e.getAttribute("height")),o=.448084975506,l=new Xd;l.moveTo(t+r,n),l.lineTo(t+s-r,n),(0!==r||0!==i)&&l.bezierCurveTo(t+s-r*o,n,t+s,n+i*o,t+s,n+i);l.lineTo(t+s,n+a-i),(0!==r||0!==i)&&l.bezierCurveTo(t+s,n+a-i*o,t+s-r*o,n+a,t+s-r,n+a);l.lineTo(t+r,n+a),(0!==r||0!==i)&&l.bezierCurveTo(t+r*o,n+a,t,n+a-i*o,t,n+a-i);l.lineTo(t,n+i),(0!==r||0!==i)&&l.bezierCurveTo(t,n+i*o,t+r*o,n,t+r,n);return l}(t);break;case"polygon":r=i(t,r),S=function(e){function t(e,t,n){const s=c(t),a=c(n);0===i?r.moveTo(s,a):r.lineTo(s,a),i++}const n=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,r=new Xd;let i=0;return e.getAttribute("points").replace(n,t),r.currentPath.autoClose=!0,r}(t);break;case"polyline":r=i(t,r),S=function(e){function t(e,t,n){const s=c(t),a=c(n);0===i?r.moveTo(s,a):r.lineTo(s,a),i++}const n=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,r=new Xd;let i=0;return e.getAttribute("points").replace(n,t),r.currentPath.autoClose=!1,r}(t);break;case"circle":r=i(t,r),S=function(e){const t=c(e.getAttribute("cx")||0),n=c(e.getAttribute("cy")||0),r=c(e.getAttribute("r")||0),i=new Cc;i.absarc(t,n,r,0,2*Math.PI);const s=new Xd;return s.subPaths.push(i),s}(t);break;case"ellipse":r=i(t,r),S=function(e){const t=c(e.getAttribute("cx")||0),n=c(e.getAttribute("cy")||0),r=c(e.getAttribute("rx")||0),i=c(e.getAttribute("ry")||0),s=new Cc;s.absellipse(t,n,r,i,0,2*Math.PI);const a=new Xd;return a.subPaths.push(s),a}(t);break;case"line":r=i(t,r),S=function(e){const t=c(e.getAttribute("x1")||0),n=c(e.getAttribute("y1")||0),r=c(e.getAttribute("x2")||0),i=c(e.getAttribute("y2")||0),s=new Xd;return s.moveTo(t,n),s.lineTo(r,i),s.currentPath.autoClose=!1,s}(t);break;case"defs":l=!0;break;case"use":r=i(t,r);const o=(t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),u=t.viewportElement.getElementById(o);u&&e(u,r)}S&&(void 0!==r.fill&&"none"!==r.fill&&S.color.setStyle(r.fill,"srgb"),function(e,t){function n(e){x.set(e.x,e.y,1).applyMatrix3(t),e.set(x.x,x.y)}function r(e){const n=e.xRadius,r=e.yRadius,i=Math.cos(e.aRotation),s=Math.sin(e.aRotation),a=new Dn(n*i,n*s,0),o=new Dn(-r*s,r*i,0),l=a.applyMatrix3(t),c=o.applyMatrix3(t),h=A.set(l.x,c.x,0,l.y,c.y,0,0,0,1),d=v.copy(h).invert(),f=y.copy(d).transpose().multiply(d).elements,p=function(e,t,n){let r,i,s,a,o;const l=e+n,c=e-n,u=Math.sqrt(c*c+4*t*t);l>0?(r=.5*(l+u),o=1/r,i=e*o*n-t*o*t):l<0?i=.5*(l-u):(r=.5*u,i=-.5*u);s=c>0?c+u:c-u;Math.abs(s)>2*Math.abs(t)?(o=-2*t/s,a=1/Math.sqrt(1+o*o),s=o*a):0===Math.abs(t)?(s=1,a=0):(o=-.5*s/t,s=1/Math.sqrt(1+o*o),a=o*s);c>0&&(o=s,s=-a,a=o);return{rt1:r,rt2:i,cs:s,sn:a}}(f[0],f[1],f[4]),m=Math.sqrt(p.rt1),g=Math.sqrt(p.rt2);e.xRadius=1/m,e.yRadius=1/g,e.aRotation=Math.atan2(p.sn,p.cs);if(!((e.aEndAngle-e.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const n=v.set(m,0,0,0,g,0,0,0,1),r=y.set(p.cs,p.sn,0,-p.sn,p.cs,0,0,0,1),i=n.multiply(r).multiply(h),s=e=>{const{x:t,y:n}=new Dn(Math.cos(e),Math.sin(e),0).applyMatrix3(i);return Math.atan2(n,t)};e.aStartAngle=s(e.aStartAngle),e.aEndAngle=s(e.aEndAngle),u(t)&&(e.aClockwise=!e.aClockwise)}}function i(e){const n=d(t),r=f(t);e.xRadius*=n,e.yRadius*=r;const i=n>Number.EPSILON?Math.atan2(t.elements[1],t.elements[0]):Math.atan2(-t.elements[3],t.elements[4]);e.aRotation+=i,u(t)&&(e.aStartAngle*=-1,e.aEndAngle*=-1,e.aClockwise=!e.aClockwise)}const s=e.subPaths;for(let e=0,a=s.length;e<a;e++){const a=s[e].curves;for(let e=0;e<a.length;e++){const s=a[e];s.isLineCurve?(n(s.v1),n(s.v2)):s.isCubicBezierCurve?(n(s.v0),n(s.v1),n(s.v2),n(s.v3)):s.isQuadraticBezierCurve?(n(s.v0),n(s.v1),n(s.v2)):s.isEllipseCurve&&(_.set(s.aX,s.aY),n(_),s.aX=_.x,s.aY=_.y,h(t)?r(s):i(s))}}}(S,b),p.push(S),S.userData={node:t,style:r});const w=t.childNodes;for(let t=0;t<w.length;t++){const n=w[t];l&&"style"!==n.nodeName&&"defs"!==n.nodeName||e(n,r)}o&&(g.pop(),g.length>0?b.copy(g[g.length-1]):b.identity())}(S.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:p,xml:S.documentElement}}static createShapes(e){const t=999999999,n=0,r=1,i=2,s=3,a=4,o=5,l=6,c={loc:n,t:0};function u(e,t,r,s){const a=e.x,o=t.x,l=r.x,u=s.x,d=e.y,f=t.y,p=r.y,m=s.y,g=(u-l)*(d-p)-(m-p)*(a-l),A=(m-p)*(o-a)-(u-l)*(f-d),v=g/A,y=((o-a)*(d-p)-(f-d)*(a-l))/A;if(0===A&&0!==g||v<=0||v>=1||y<0||y>1)return null;if(0===g&&0===A){for(let l=0;l<2;l++){if(h(0===l?r:s,e,t),c.loc==n){const e=0===l?r:s;return{x:e.x,y:e.y,t:c.t}}if(c.loc==i){return{x:+(a+c.t*(o-a)).toPrecision(10),y:+(d+c.t*(f-d)).toPrecision(10),t:c.t}}}return null}for(let i=0;i<2;i++)if(h(0===i?r:s,e,t),c.loc==n){const e=0===i?r:s;return{x:e.x,y:e.y,t:c.t}}return{x:+(a+v*(o-a)).toPrecision(10),y:+(d+v*(f-d)).toPrecision(10),t:v}}function h(e,t,u){const h=u.x-t.x,d=u.y-t.y,f=e.x-t.x,p=e.y-t.y,m=h*p-f*d;if(e.x===t.x&&e.y===t.y)return c.loc=n,void(c.t=0);if(e.x===u.x&&e.y===u.y)return c.loc=r,void(c.t=1);if(m<-Number.EPSILON)return void(c.loc=s);if(m>Number.EPSILON)return void(c.loc=a);if(h*f<0||d*p<0)return void(c.loc=o);if(Math.sqrt(h*h+d*d)<Math.sqrt(f*f+p*p))return void(c.loc=l);let g;g=0!==h?f/h:p/d,c.loc=i,c.t=g}function d(e,t,n){const r=new nn;t.getCenter(r);const i=[];return n.forEach(t=>{if(t.boundingBox.containsPoint(r)){const n=function(e,t){const n=[],r=[];for(let i=1;i<e.length;i++){const s=e[i-1],a=e[i];for(let e=1;e<t.length;e++){const i=u(s,a,t[e-1],t[e]);null!==i&&void 0===n.find(e=>e.t<=i.t+Number.EPSILON&&e.t>=i.t-Number.EPSILON)&&(n.push(i),r.push(new nn(i.x,i.y)))}}return r}(e,t.points);n.forEach(e=>{i.push({identifier:t.identifier,isCW:t.isCW,point:e})})}}),i.sort((e,t)=>e.point.x-t.point.x),i}let f=t,p=-999999999,m=e.subPaths.map(e=>{const n=e.getPoints();let r=-999999999,i=t,s=-999999999,a=t;for(let e=0;e<n.length;e++){const t=n[e];t.y>r&&(r=t.y),t.y<i&&(i=t.y),t.x>s&&(s=t.x),t.x<a&&(a=t.x)}return p<=s&&(p=s+1),f>=a&&(f=a-1),{curves:e.curves,points:n,isCW:hu.isClockWise(n),identifier:-1,boundingBox:new wd(new nn(a,i),new nn(s,r))}});m=m.filter(e=>e.points.length>1);for(let e=0;e<m.length;e++)m[e].identifier=e;const g=m.map(t=>function(e,t,n,r,i){null!=i&&""!==i||(i="nonzero");const s=new nn;e.boundingBox.getCenter(s);const a=d([new nn(n,s.y),new nn(r,s.y)],e.boundingBox,t);a.sort((e,t)=>e.point.x-t.point.x);const o=[],l=[];a.forEach(t=>{t.identifier===e.identifier?o.push(t):l.push(t)});const c=o[0].point.x,u=[];let h=0;for(;h<l.length&&l[h].point.x<c;)u.length>0&&u[u.length-1]===l[h].identifier?u.pop():u.push(l[h].identifier),h++;if(u.push(e.identifier),"evenodd"===i){const t=u.length%2==0,n=u[u.length-2];return{identifier:e.identifier,isHole:t,for:n}}if("nonzero"===i){let n=!0,r=null,i=null;for(let e=0;e<u.length;e++){const s=u[e];n?(i=t[s].isCW,n=!1,r=s):i!==t[s].isCW&&(i=t[s].isCW,n=!0)}return{identifier:e.identifier,isHole:n,for:r}}}(t,m,f,p,e.userData?e.userData.style.fillRule:void 0)),A=[];return m.forEach(e=>{if(!g[e.identifier].isHole){const t=new Nc;t.curves=e.curves;const n=g.filter(t=>t.isHole&&t.for===e.identifier);n.forEach(e=>{const n=m[e.identifier],r=new Cc;r.curves=n.curves,t.holes.push(r)}),A.push(t)}}),A}static getStrokeStyle(e,t,n,r,i){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:n=void 0!==n?n:"miter",strokeLineCap:r=void 0!==r?r:"butt",strokeMiterLimit:i=void 0!==i?i:4}}static pointsToStroke(t,n,r,i){const s=[],a=[],o=[];if(0===e.pointsToStrokeWithBuffers(t,n,r,i,s,a,o))return null;const l=new Ei;return l.setAttribute("position",new di(s,3)),l.setAttribute("normal",new di(a,3)),l.setAttribute("uv",new di(o,2)),l}static pointsToStrokeWithBuffers(e,t,n,r,i,s,a,o){const l=new nn,c=new nn,u=new nn,h=new nn,d=new nn,f=new nn,p=new nn,m=new nn,g=new nn,A=new nn,v=new nn,y=new nn,E=new nn,_=new nn,x=new nn,b=new nn,S=new nn;n=void 0!==n?n:12,r=void 0!==r?r:.001,o=void 0!==o?o:0,e=function(e){let t=!1;for(let n=1,i=e.length-1;n<i;n++)if(e[n].distanceTo(e[n+1])<r){t=!0;break}if(!t)return e;const n=[];n.push(e[0]);for(let t=1,i=e.length-1;t<i;t++)e[t].distanceTo(e[t+1])>=r&&n.push(e[t]);return n.push(e[e.length-1]),n}(e);const w=e.length;if(w<2)return 0;const C=e[0].equals(e[w-1]);let T,M,I=e[0];const R=t.strokeWidth/2,B=1/(w-1);let P,D,L,k,F=0,O=!1,U=0,N=3*o,z=2*o;G(e[0],e[1],l).multiplyScalar(R),m.copy(e[0]).sub(l),g.copy(e[0]).add(l),A.copy(m),v.copy(g);for(let n=1;n<w;n++){T=e[n],M=n===w-1?C?e[1]:void 0:e[n+1];const r=l;if(G(I,T,r),u.copy(r).multiplyScalar(R),y.copy(T).sub(u),E.copy(T).add(u),P=F+B,D=!1,void 0!==M){G(T,M,c),u.copy(c).multiplyScalar(R),_.copy(T).sub(u),x.copy(T).add(u),L=!0,u.subVectors(M,I),r.dot(u)<0&&(L=!1),1===n&&(O=L),u.subVectors(M,T),u.normalize();const e=Math.abs(r.dot(u));if(e>Number.EPSILON){const n=R/e;u.multiplyScalar(-n),h.subVectors(T,I),d.copy(h).setLength(n).add(u),b.copy(d).negate();const r=d.length(),i=h.length();h.divideScalar(i),f.subVectors(M,T);const s=f.length();switch(f.divideScalar(s),h.dot(b)<i&&f.dot(b)<s&&(D=!0),S.copy(d).add(T),b.add(T),k=!1,D?L?(x.copy(b),E.copy(b)):(_.copy(b),y.copy(b)):V(),t.strokeLineJoin){case"bevel":j(L,D,P);break;case"round":W(L,D),L?H(T,y,_,P,0):H(T,x,E,P,1);break;default:const e=R*t.strokeMiterLimit/r;if(e<1){if("miter-clip"!==t.strokeLineJoin){j(L,D,P);break}W(L,D),L?(f.subVectors(S,y).multiplyScalar(e).add(y),p.subVectors(S,_).multiplyScalar(e).add(_),Q(y,P,0),Q(f,P,0),Q(T,P,.5),Q(T,P,.5),Q(f,P,0),Q(p,P,0),Q(T,P,.5),Q(p,P,0),Q(_,P,0)):(f.subVectors(S,E).multiplyScalar(e).add(E),p.subVectors(S,x).multiplyScalar(e).add(x),Q(E,P,1),Q(f,P,1),Q(T,P,.5),Q(T,P,.5),Q(f,P,1),Q(p,P,1),Q(T,P,.5),Q(p,P,1),Q(x,P,1))}else D?(L?(Q(g,F,1),Q(m,F,0),Q(S,P,0),Q(g,F,1),Q(S,P,0),Q(b,P,1)):(Q(g,F,1),Q(m,F,0),Q(S,P,1),Q(m,F,0),Q(b,P,0),Q(S,P,1)),L?_.copy(S):x.copy(S)):L?(Q(y,P,0),Q(S,P,0),Q(T,P,.5),Q(T,P,.5),Q(S,P,0),Q(_,P,0)):(Q(E,P,1),Q(S,P,1),Q(T,P,.5),Q(T,P,.5),Q(S,P,1),Q(x,P,1)),k=!0}}else V()}else V();C||n!==w-1||Y(e[0],A,v,L,!0,F),F=P,I=T,m.copy(_),g.copy(x)}if(C){if(D&&i){let e=S,t=b;O!==L&&(e=b,t=S),L?(k||O)&&(t.toArray(i,0),t.toArray(i,9),k&&e.toArray(i,3)):!k&&O||(t.toArray(i,3),t.toArray(i,9),k&&e.toArray(i,0))}}else Y(T,y,E,L,!1,P);return U;function G(e,t,n){return n.subVectors(t,e),n.set(-n.y,n.x).normalize()}function Q(e,t,n){i&&(i[N]=e.x,i[N+1]=e.y,i[N+2]=0,s&&(s[N]=0,s[N+1]=0,s[N+2]=1),N+=3,a&&(a[z]=t,a[z+1]=n,z+=2)),U+=3}function H(e,t,r,i,s){l.copy(t).sub(e).normalize(),c.copy(r).sub(e).normalize();let a=Math.PI;const o=l.dot(c);Math.abs(o)<1&&(a=Math.abs(Math.acos(o))),a/=n,u.copy(t);for(let t=0,r=n-1;t<r;t++)h.copy(u).rotateAround(e,a),Q(u,i,s),Q(h,i,s),Q(e,i,.5),u.copy(h);Q(h,i,s),Q(r,i,s),Q(e,i,.5)}function V(){Q(g,F,1),Q(m,F,0),Q(y,P,0),Q(g,F,1),Q(y,P,0),Q(E,P,1)}function j(e,t,n){t?e?(Q(g,F,1),Q(m,F,0),Q(y,P,0),Q(g,F,1),Q(y,P,0),Q(b,P,1),Q(y,n,0),Q(_,n,0),Q(b,n,.5)):(Q(g,F,1),Q(m,F,0),Q(E,P,1),Q(m,F,0),Q(b,P,0),Q(E,P,1),Q(E,n,1),Q(b,n,0),Q(x,n,1)):e?(Q(y,n,0),Q(_,n,0),Q(T,n,.5)):(Q(E,n,1),Q(x,n,0),Q(T,n,.5))}function W(e,t){t&&(e?(Q(g,F,1),Q(m,F,0),Q(y,P,0),Q(g,F,1),Q(y,P,0),Q(b,P,1),Q(y,F,0),Q(T,P,.5),Q(b,P,1),Q(T,P,.5),Q(_,F,0),Q(b,P,1)):(Q(g,F,1),Q(m,F,0),Q(E,P,1),Q(m,F,0),Q(b,P,0),Q(E,P,1),Q(E,F,1),Q(b,P,0),Q(T,P,.5),Q(T,P,.5),Q(b,P,0),Q(x,F,1)))}function Y(e,n,r,s,o,d){switch(t.strokeLineCap){case"round":o?H(e,r,n,d,.5):H(e,n,r,d,.5);break;case"square":if(o)l.subVectors(n,e),c.set(l.y,-l.x),u.addVectors(l,c).add(e),h.subVectors(c,l).add(e),s?(u.toArray(i,3),h.toArray(i,0),h.toArray(i,9)):(u.toArray(i,3),1===a[7]?h.toArray(i,9):u.toArray(i,9),h.toArray(i,0));else{l.subVectors(r,e),c.set(l.y,-l.x),u.addVectors(l,c).add(e),h.subVectors(c,l).add(e);const t=i.length;s?(u.toArray(i,t-3),h.toArray(i,t-6),h.toArray(i,t-12)):(h.toArray(i,t-6),u.toArray(i,t-3),h.toArray(i,t-12))}}}}}return e})(),DT=new WeakMap;class LT extends oh{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const i=new uh(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,e=>{const n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(r)},n,r)}decodeDracoFile(e,t,n,r){const i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,i).then(t)}decodeGeometry(e,t){for(const e in t.attributeTypes){const n=t.attributeTypes[e];void 0!==n.BYTES_PER_ELEMENT&&(t.attributeTypes[e]=n.name)}const n=JSON.stringify(t);if(DT.has(e)){const t=DT.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const i=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(i,s).then(n=>(r=n,new Promise((n,s)=>{r._callbacks[i]={resolve:n,reject:s},r.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return a.catch(()=>!0).then(()=>{r&&i&&this._releaseTask(r,i)}),DT.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new Ei;e.index&&t.setIndex(new ci(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],i=r.name,s=r.array,a=r.itemSize;t.setAttribute(i,new ci(s,a))}return t}_loadLibrary(e,t){const n=new uh(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((t,r)=>{n.load(e,t,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const r=kT.toString(),i=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n)}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function kT(){let e,t;function n(e,t,n,r,i,s){const a=s.num_components(),o=n.num_points()*a,l=o*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,s,c,l,u);const h=new i(e.HEAPF32.buffer,u,o).slice();return e._free(u),{name:r,array:h,itemSize:a}}onmessage=function(r){const i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":const r=i.buffer,s=i.taskConfig;t.then(e=>{const t=e.draco,a=new t.Decoder,o=new t.DecoderBuffer;o.Init(new Int8Array(r),r.byteLength);try{const e=function(e,t,r,i){const s=i.attributeIDs,a=i.attributeTypes;let o,l;const c=t.GetEncodedGeometryType(r);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeBufferToMesh(r,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeBufferToPointCloud(r,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const r in s){const l=self[a[r]];let c,h;if(i.useUniqueIDs)h=s[r],c=t.GetAttributeByUniqueId(o,h);else{if(h=t.GetAttributeId(o,e[s[r]]),-1===h)continue;c=t.GetAttribute(o,h)}u.attributes.push(n(e,t,o,r,l,c))}c===e.TRIANGULAR_MESH&&(u.index=function(e,t,n){const r=n.num_faces(),i=3*r,s=4*i,a=e._malloc(s);t.GetTrianglesUInt32Array(n,s,a);const o=new Uint32Array(e.HEAPF32.buffer,a,i).slice();return e._free(a),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),u}(t,a,o,s),r=e.attributes.map(e=>e.array.buffer);e.index&&r.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},r)}catch(e){self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(o),t.destroy(a)}})}}}const FT=new Fn,OT=new Dn;class UT extends Fh{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new di([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new di([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new yd(t,6,1);return this.setAttribute("instanceStart",new Ko(n,3,0)),this.setAttribute("instanceEnd",new Ko(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,t=3){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const r=new yd(n,2*t,1);return this.setAttribute("instanceColorStart",new Ko(r,t,0)),this.setAttribute("instanceColorEnd",new Ko(r,t,t)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new wu(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Fn);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),FT.setFromBufferAttribute(t),this.boundingBox.union(FT))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new er),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let i=0,s=e.count;i<s;i++)OT.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(OT)),OT.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(OT));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)}}toJSON(){}applyMatrix(e){return this.applyMatrix4(e)}}class NT extends UT{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e,t=3){const n=e.length-t,r=new Float32Array(2*n);if(3===t)for(let i=0;i<n;i+=t)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];else for(let i=0;i<n;i+=t)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5],r[2*i+6]=e[i+6],r[2*i+7]=e[i+7];return super.setColors(r,t),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class zT extends ji{constructor(e){super({type:"LineMaterial",uniforms:Vi.clone(Vi.merge([cs.common,cs.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new nn(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>\n\n\t\t\t\tuniform float linewidth;\n\t\t\t\tuniform vec2 resolution;\n\n\t\t\t\tattribute vec3 instanceStart;\n\t\t\t\tattribute vec3 instanceEnd;\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t\tattribute vec4 instanceColorStart;\n\t\t\t\t\t\tattribute vec4 instanceColorEnd;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t\tattribute vec3 instanceColorStart;\n\t\t\t\t\t\tattribute vec3 instanceColorEnd;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashScale;\n\t\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#endif\n\n\t\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t\t\t// conservative estimate of the near plane\n\t\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#ifdef USE_COLOR\n\n\t\t\t\t\t\tvLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t\t\t// camera space\n\t\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\tworldStart = start.xyz;\n\t\t\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\t\t\tif ( perspective ) {\n\n\t\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// clip space\n\t\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t\t\t// ndc space\n\t\t\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t\t\t// direction\n\t\t\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\t\tdir.x *= aspect;\n\t\t\t\t\tdir = normalize( dir );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\t\t\tvec3 offset;\n\t\t\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t\t\t// set the world position\n\t\t\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t\t\t// project the worldpos\n\t\t\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t\t\t// segments overlap neatly\n\t\t\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\t\t\tdir.x /= aspect;\n\t\t\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset += - dir;\n\n\t\t\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\t\t\toffset += dir;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth;\n\n\t\t\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t\t\t// select end\n\t\t\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t\t\t// back to clip space\n\t\t\t\t\t\toffset *= clip.w;\n\n\t\t\t\t\t\tclip.xy += offset;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tgl_Position = clip;\n\n\t\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t\t#include <fog_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:`\n\t\t\t\tuniform vec3 diffuse;\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform float linewidth;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashOffset;\n\t\t\t\t\tuniform float dashSize;\n\t\t\t\t\tuniform float gapSize;\n\n\t\t\t\t#endif\n\n\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\t\t\tfloat mua;\n\t\t\t\t\tfloat mub;\n\n\t\t\t\t\tvec3 p13 = p1 - p3;\n\t\t\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\t\t\tmua = numer / denom;\n\t\t\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\t\t\treturn vec2( mua, mub );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat alpha = opacity;\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\t\t\tfloat len = length( delta );\n\t\t\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\t\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\t\tdiffuseColor *= vLineColor;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tdiffuseColor.rgb *= vLineColor;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\t\t\tgl_FragColor = diffuseColor;\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <${Ix>=154?"colorspace_fragment":"encodings_fragment"}>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t\t}\n\t\t\t`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const GT=new Tn,QT=new Dn,HT=new Dn,VT=new Tn,jT=new Tn,WT=new Tn,YT=new Dn,KT=new cr,qT=new Md,XT=new Dn,$T=new Fn,JT=new er,ZT=new Tn;let eM,tM,nM;function rM(e,t,n){return ZT.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),ZT.multiplyScalar(1/ZT.w),ZT.x=tM/n.width,ZT.y=tM/n.height,ZT.applyMatrix4(e.projectionMatrixInverse),ZT.multiplyScalar(1/ZT.w),Math.abs(Math.max(ZT.x,ZT.y))}class iM extends Ui{constructor(e=new UT,t=new zT({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let e=0,i=0,s=t.count;e<s;e++,i+=2)QT.fromBufferAttribute(t,e),HT.fromBufferAttribute(n,e),r[i]=0===i?0:r[i-1],r[i+1]=r[i]+QT.distanceTo(HT);const i=new yd(r,2,1);return e.setAttribute("instanceDistanceStart",new Ko(i,1,0)),e.setAttribute("instanceDistanceEnd",new Ko(i,1,1)),this}raycast(e,t){const n=this.material.worldUnits,r=e.camera,i=void 0!==e.params.Line2&&e.params.Line2.threshold||0;eM=e.ray;const s=this.matrixWorld,a=this.geometry,o=this.material;let l,c;if(tM=o.linewidth+i,null===a.boundingSphere&&a.computeBoundingSphere(),JT.copy(a.boundingSphere).applyMatrix4(s),n)l=.5*tM;else{l=rM(r,Math.max(r.near,JT.distanceToPoint(eM.origin)),o.resolution)}if(JT.radius+=l,!1!==eM.intersectsSphere(JT)){if(null===a.boundingBox&&a.computeBoundingBox(),$T.copy(a.boundingBox).applyMatrix4(s),n)c=.5*tM;else{c=rM(r,Math.max(r.near,$T.distanceToPoint(eM.origin)),o.resolution)}$T.expandByScalar(c),!1!==eM.intersectsBox($T)&&(n?function(e,t){const n=e.matrixWorld,r=e.geometry,i=r.attributes.instanceStart,s=r.attributes.instanceEnd;for(let a=0,o=Math.min(r.instanceCount,i.count);a<o;a++){qT.start.fromBufferAttribute(i,a),qT.end.fromBufferAttribute(s,a),qT.applyMatrix4(n);const r=new Dn,o=new Dn;eM.distanceSqToSegment(qT.start,qT.end,o,r),o.distanceTo(r)<.5*tM&&t.push({point:o,pointOnLine:r,distance:eM.origin.distanceTo(o),object:e,face:null,faceIndex:a,uv:null,[Rx]:null})}}(this,t):function(e,t,n){const r=t.projectionMatrix,i=e.material.resolution,s=e.matrixWorld,a=e.geometry,o=a.attributes.instanceStart,l=a.attributes.instanceEnd,c=Math.min(a.instanceCount,o.count),u=-t.near;eM.at(1,WT),WT.w=1,WT.applyMatrix4(t.matrixWorldInverse),WT.applyMatrix4(r),WT.multiplyScalar(1/WT.w),WT.x*=i.x/2,WT.y*=i.y/2,WT.z=0,YT.copy(WT),KT.multiplyMatrices(t.matrixWorldInverse,s);for(let t=0,a=c;t<a;t++){if(VT.fromBufferAttribute(o,t),jT.fromBufferAttribute(l,t),VT.w=1,jT.w=1,VT.applyMatrix4(KT),jT.applyMatrix4(KT),VT.z>u&&jT.z>u)continue;if(VT.z>u){const e=VT.z-jT.z,t=(VT.z-u)/e;VT.lerp(jT,t)}else if(jT.z>u){const e=jT.z-VT.z,t=(jT.z-u)/e;jT.lerp(VT,t)}VT.applyMatrix4(r),jT.applyMatrix4(r),VT.multiplyScalar(1/VT.w),jT.multiplyScalar(1/jT.w),VT.x*=i.x/2,VT.y*=i.y/2,jT.x*=i.x/2,jT.y*=i.y/2,qT.start.copy(VT),qT.start.z=0,qT.end.copy(jT),qT.end.z=0;const a=qT.closestPointToPointParameter(YT,!0);qT.at(a,XT);const c=tn.lerp(VT.z,jT.z,a),h=c>=-1&&c<=1,d=YT.distanceTo(XT)<.5*tM;if(h&&d){qT.start.fromBufferAttribute(o,t),qT.end.fromBufferAttribute(l,t),qT.start.applyMatrix4(s),qT.end.applyMatrix4(s);const r=new Dn,i=new Dn;eM.distanceSqToSegment(qT.start,qT.end,i,r),n.push({point:i,pointOnLine:r,distance:eM.origin.distanceTo(i),object:e,face:null,faceIndex:t,uv:null,[Rx]:null})}}}(this,r,t))}}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(GT),this.material.uniforms.resolution.value.set(GT.z,GT.w))}}class sM extends iM{constructor(e=new NT,t=new zT({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}const aM=()=>{if(nM)return nM;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!=typeof WebAssembly)return{supported:!1};let n,r="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(e)&&(r="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB");const i=WebAssembly.instantiate(function(e){const n=new Uint8Array(e.length);for(let t=0;t<e.length;++t){const r=e.charCodeAt(t);n[t]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let r=0;for(let i=0;i<e.length;++i)n[r++]=n[i]<60?t[n[i]]:64*(n[i]-60)+n[++i];return n.buffer.slice(0,r)}(r),{}).then(e=>{n=e.instance,n.exports.__wasm_call_ctors()});function s(e,t,r,i,s,a){const o=n.exports.sbrk,l=r+3&-4,c=o(l*i),u=o(s.length),h=new Uint8Array(n.exports.memory.buffer);h.set(s,u);const d=e(c,r,i,u,s.length);if(0===d&&a&&a(c,l,i),t.set(h.subarray(c,c+r*i)),o(c-o(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}const a={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return nM={ready:i,supported:!0,decodeVertexBuffer(e,t,r,i,o){s(n.exports.meshopt_decodeVertexBuffer,e,t,r,i,n.exports[a[o]])},decodeIndexBuffer(e,t,r,i){s(n.exports.meshopt_decodeIndexBuffer,e,t,r,i)},decodeIndexSequence(e,t,r,i){s(n.exports.meshopt_decodeIndexSequence,e,t,r,i)},decodeGltfBuffer(e,t,r,i,l,c){s(n.exports[o[l]],e,t,r,i,n.exports[a[c]])}},nM},oM=e=>Symbol.iterator in e,lM=e=>"entries"in e,cM=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),r=t instanceof Map?t:new Map(t.entries());if(n.size!==r.size)return!1;for(const[e,t]of n)if(!r.has(e)||!Object.is(t,r.get(e)))return!1;return!0};function uM(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Object.getPrototypeOf(e)===Object.getPrototypeOf(t)&&(oM(e)&&oM(t)?lM(e)&&lM(t)?cM(e,t):((e,t)=>{const n=e[Symbol.iterator](),r=t[Symbol.iterator]();let i=n.next(),s=r.next();for(;!i.done&&!s.done;){if(!Object.is(i.value,s.value))return!1;i=n.next(),s=r.next()}return!!i.done&&!!s.done})(e,t):cM({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})))}const hM=e.createContext([]);function dM({box:t,multiple:n,children:r,onChange:i,onChangePointerUp:s,border:a="1px solid #55aaff",backgroundColor:o="rgba(75, 160, 255, 0.1)",filter:l=e=>e,...c}){const[u,h]=e.useState(!1),{setEvents:d,camera:f,raycaster:p,gl:m,controls:g,size:A,get:v}=zp(),[y,E]=e.useState(!1),[_,x]=e.useReducer((e,{object:t,shift:n})=>void 0===t?[]:Array.isArray(t)?t:n?e.includes(t)?e.filter(e=>e!==t):[t,...e]:e[0]===t?[]:[t],[]);e.useEffect(()=>{u?null==i||i(_):null==s||s(_)},[_,u]);const b=e.useCallback(e=>{e.stopPropagation(),x({object:l([e.object])[0],shift:n&&e.shiftKey})},[]),S=e.useCallback(e=>!y&&x({}),[y]),w=e.useRef(null);return e.useEffect(()=>{if(!t||!n)return;const e=new uC(f,w.current),r=document.createElement("div");r.style.pointerEvents="none",r.style.border=a,r.style.backgroundColor=o,r.style.position="fixed";const i=new nn,s=new nn,c=new nn,u=v().events.enabled,p=null==g?void 0:g.enabled;let y=!1;function E(e,t){const{offsetX:n,offsetY:r}=e,{width:i,height:s}=A;t.set(n/i*2-1,-r/s*2+1)}function _(t){t.shiftKey&&(!function(e){var t;g&&(g.enabled=!1),d({enabled:!1}),h(y=!0),null==(t=m.domElement.parentElement)||t.appendChild(r),r.style.left=`${e.clientX}px`,r.style.top=`${e.clientY}px`,r.style.width="0px",r.style.height="0px",i.x=e.clientX,i.y=e.clientY}(t),E(t,e.startPoint))}let b=[];function S(t){if(y){!function(e){c.x=Math.max(i.x,e.clientX),c.y=Math.max(i.y,e.clientY),s.x=Math.min(i.x,e.clientX),s.y=Math.min(i.y,e.clientY),r.style.left=`${s.x}px`,r.style.top=`${s.y}px`,r.style.width=c.x-s.x+"px",r.style.height=c.y-s.y+"px"}(t),E(t,e.endPoint);const n=e.select().sort(e=>e.uuid).filter(e=>e.isMesh);uM(n,b)||(b=n,x({object:l(n)}))}}function C(e){var t;y&&y&&(g&&(g.enabled=p),d({enabled:u}),h(y=!1),null==(t=r.parentElement)||t.removeChild(r))}return document.addEventListener("pointerdown",_,{passive:!0}),document.addEventListener("pointermove",S,{passive:!0,capture:!0}),document.addEventListener("pointerup",C,{passive:!0}),()=>{document.removeEventListener("pointerdown",_),document.removeEventListener("pointermove",S,!0),document.removeEventListener("pointerup",C)}},[A.width,A.height,p,f,g,m]),e.createElement("group",Lm({ref:w,onClick:b,onPointerOver:()=>E(!0),onPointerOut:()=>E(!1),onPointerMissed:S},c),e.createElement(hM.Provider,{value:_},r))}function fM(){return e.useContext(hM)}const pM=e.forwardRef(function({children:t,follow:n=!0,lockX:r=!1,lockY:i=!1,lockZ:s=!1,...a},o){const l=e.useRef(null),c=e.useRef(null),u=new Pn;return Gp(({camera:e})=>{if(!n||!c.current)return;const t=l.current.rotation.clone();c.current.updateMatrix(),c.current.updateWorldMatrix(!1,!1),c.current.getWorldQuaternion(u),e.getWorldQuaternion(l.current.quaternion).premultiply(u.invert()),r&&(l.current.rotation.x=t.x),i&&(l.current.rotation.y=t.y),s&&(l.current.rotation.z=t.z)}),e.useImperativeHandle(o,()=>c.current,[]),e.createElement("group",Lm({ref:c},a),e.createElement("group",{ref:l},t))}),mM=e.forwardRef(({children:t,depth:n=-1,...r},i)=>{const s=e.useRef(null);return e.useImperativeHandle(i,()=>s.current,[]),Gp(({camera:e})=>{s.current.quaternion.copy(e.quaternion),s.current.position.copy(e.position)}),e.createElement("group",Lm({ref:s},r),e.createElement("group",{"position-z":-n},t))}),gM=new Dn,AM=new Dn,vM=new Dn,yM=(e,t,n,r=1)=>{const i=gM.set(e.x/n.width*2-1,-e.y/n.height*2+1,r);return i.unproject(t),i},EM=(e,t,n,r)=>{const i=((e,t,n)=>{const r=n.width/2,i=n.height/2;t.updateMatrixWorld(!1);const s=e.project(t);return s.x=s.x*r+r,s.y=-s.y*i+i,s})(vM.copy(e),n,r);let s=0;for(let a=0;a<2;++a){const o=AM.copy(i).setComponent(a,i.getComponent(a)+t),l=yM(o,n,r,o.z);s=Math.max(s,e.distanceTo(l))}return s},_M=new Dn,xM=c(({scale:t=1,...n},i)=>{const s=r(null);return e.useImperativeHandle(i,()=>s.current,[]),Gp(e=>{const n=s.current;if(!n)return;const r=EM(n.getWorldPosition(_M),t,e.camera,e.size);n.scale.setScalar(r*t)}),e.createElement("object3D",Lm({ref:s},n))}),bM=e.forwardRef(function({points:t,color:n=16777215,vertexColors:r,linewidth:i,lineWidth:s,segments:a,dashed:o,...l},c){var u,h;const d=zp(e=>e.size),f=e.useMemo(()=>a?new iM:new sM,[a]),[p]=e.useState(()=>new zT),m=4===(null==r||null==(u=r[0])?void 0:u.length)?4:3,g=e.useMemo(()=>{const e=a?new UT:new NT,i=t.map(e=>{const t=Array.isArray(e);return e instanceof Dn||e instanceof Tn?[e.x,e.y,e.z]:e instanceof nn?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e});if(e.setPositions(i.flat()),r){n=16777215;const t=r.map(e=>e instanceof $r?e.toArray():e);e.setColors(t.flat(),m)}return e},[t,a,r,m]);return e.useLayoutEffect(()=>{f.computeLineDistances()},[t,f]),e.useLayoutEffect(()=>{o?p.defines.USE_DASH="":delete p.defines.USE_DASH,p.needsUpdate=!0},[o,p]),e.useEffect(()=>()=>{g.dispose(),p.dispose()},[g]),e.createElement("primitive",Lm({object:f,ref:c},l),e.createElement("primitive",{object:g,attach:"geometry"}),e.createElement("primitive",Lm({object:p,attach:"material",color:n,vertexColors:Boolean(r),resolution:[d.width,d.height],linewidth:null!==(h=null!=i?i:s)&&void 0!==h?h:1,dashed:o,transparent:4===m},l)))}),SM=new Dn,wM=e.forwardRef(function({start:t=[0,0,0],end:n=[0,0,0],mid:r,segments:i=20,...s},a){const o=e.useRef(null);e.useImperativeHandle(a,()=>o.current);const[l]=e.useState(()=>new xc(void 0,void 0,void 0)),c=e.useCallback((e,t,n,r=20)=>(e instanceof Dn?l.v0.copy(e):l.v0.set(...e),t instanceof Dn?l.v2.copy(t):l.v2.set(...t),n instanceof Dn?l.v1.copy(n):Array.isArray(n)?l.v1.set(...n):l.v1.copy(l.v0.clone().add(l.v2.clone().sub(l.v0)).add(SM.set(0,l.v0.y-l.v2.y,0))),l.getPoints(r)),[]);e.useLayoutEffect(()=>{o.current.setPoints=(e,t,n)=>{const r=c(e,t,n);o.current.geometry&&o.current.geometry.setPositions(r.map(e=>e.toArray()).flat())}},[]);const u=e.useMemo(()=>c(t,n,r,i),[t,n,r,i]);return e.createElement(bM,Lm({ref:o,points:u},s))}),CM=e.forwardRef(function({start:t,end:n,midA:r,midB:i,segments:s=20,...a},o){const l=e.useMemo(()=>{const e=t instanceof Dn?t:new Dn(...t),a=n instanceof Dn?n:new Dn(...n),o=r instanceof Dn?r:new Dn(...r),l=i instanceof Dn?i:new Dn(...i);return new vc(e,o,l,a).getPoints(s)},[t,n,r,i,s]);return e.createElement(bM,Lm({ref:o,points:l},a))}),TM=e.forwardRef(function({points:t,closed:n=!1,curveType:r="centripetal",tension:i=.5,segments:s=20,vertexColors:a,...o},l){const c=e.useMemo(()=>{const e=t.map(e=>e instanceof Dn?e:new Dn(...e));return new fc(e,n,r,i)},[t,n,r,i]),u=e.useMemo(()=>c.getPoints(s),[c,s]),h=e.useMemo(()=>{if(!a||a.length<2)return;if(a.length===s+1)return a;const e=a.map(e=>e instanceof $r?e:new $r(...e));n&&e.push(e[0].clone());const t=[e[0]],r=s/(e.length-1);for(let n=1;n<s;n++){const i=n%r/r,s=Math.floor(n/r);t.push(e[s].clone().lerp(e[s+1],i))}return t.push(e[e.length-1]),t},[a,s]);return e.createElement(bM,Lm({ref:l,points:u,vertexColors:h},o))}),MM=e.forwardRef(({url:t,distance:n=1,loop:r=!0,autoplay:i,...s},a)=>{const o=e.useRef(null);e.useImperativeHandle(a,()=>o.current,[]);const l=zp(({camera:e})=>e),[c]=e.useState(()=>new ed),u=jp(Vh,t);return e.useEffect(()=>{const e=o.current;e&&(e.setBuffer(u),e.setRefDistance(n),e.setLoop(r),i&&!e.isPlaying&&e.play())},[u,l,n,r]),e.useEffect(()=>{const e=o.current;return l.add(c),()=>{l.remove(c),e&&(e.isPlaying&&e.stop(),e.source&&e.source._connected&&e.disconnect())}},[]),e.createElement("positionalAudio",Lm({ref:o,args:[c]},s))});function IM(){var e=Object.create(null);function t(r,i){var s=r.id,a=r.name,o=r.dependencies;void 0===o&&(o=[]);var l=r.init;void 0===l&&(l=function(){});var c=r.getTransferables;if(void 0===c&&(c=null),!e[s])try{o=o.map(function(n){return n&&n.isWorkerModule&&(t(n,function(e){if(e instanceof Error)throw e}),n=e[n.id].value),n}),l=n("<"+a+">.init",l),c&&(c=n("<"+a+">.getTransferables",c));var u=null;"function"==typeof l&&(u=l.apply(void 0,o)),e[s]={id:s,value:u,getTransferables:c},i(u)}catch(e){!e||e.noLog,i(e)}}function n(e,t){var n=void 0;self.troikaDefine=function(e){return n=e};var r=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(r)}catch(e){}return URL.revokeObjectURL(r),delete self.troikaDefine,n}self.addEventListener("message",function(n){var r=n.data,i=r.messageId,s=r.action,a=r.data;try{"registerModule"===s&&t(a,function(e){e instanceof Error?postMessage({messageId:i,success:!1,error:e.message}):postMessage({messageId:i,success:!0,result:{isCallable:"function"==typeof e}})}),"callModule"===s&&function(t,n){var r,i=t.id,s=t.args;e[i]&&"function"==typeof e[i].value||n(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var a=(r=e[i]).value.apply(r,s);a&&"function"==typeof a.then?a.then(o,function(e){return n(e instanceof Error?e:new Error(""+e))}):o(a)}catch(e){n(e)}function o(t){try{var r=e[i].getTransferables&&e[i].getTransferables(t);r&&Array.isArray(r)&&r.length||(r=void 0),n(t,r)}catch(e){n(e)}}}(a,function(e,t){e instanceof Error?postMessage({messageId:i,success:!1,error:e.message}):postMessage({messageId:i,success:!0,result:e},t||void 0)})}catch(e){postMessage({messageId:i,success:!1,error:e.stack})}})}var RM=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){"undefined"!=typeof process&&process.env.NODE_ENV}return RM=function(){return e},e},BM=0,PM=0,DM=!1,LM=Object.create(null),kM=Object.create(null),FM=Object.create(null);function OM(e){if(!(e&&"function"==typeof e.init||DM))throw new Error("requires `options.init` function");var t=e.dependencies,n=e.init,r=e.getTransferables,i=e.workerId,s=function(e){var t=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return t._getInitResult().then(function(t){if("function"==typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var n=e.dependencies,r=e.init;n=Array.isArray(n)?n.map(function(e){return e&&(e=e.onMainThread||e)._getInitResult&&(e=e._getInitResult()),e}):[];var i=Promise.all(n).then(function(e){return r.apply(null,e)});return t._getInitResult=function(){return i},i},t}(e);null==i&&(i="#default");var a="workerModule"+ ++BM,o=e.name||a,l=null;function c(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!RM())return s.apply(void 0,e);if(!l){l=NM(i,"registerModule",c.workerModuleData);var n=function(){l=null,kM[i].delete(n)};(kM[i]||(kM[i]=new Set)).add(n)}return l.then(function(t){if(t.isCallable)return NM(i,"callModule",{id:a,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")})}return t=t&&t.map(function(e){return"function"!=typeof e||e.workerModuleData||(DM=!0,e=OM({workerId:i,name:"<"+o+"> function dependency: "+e.name,init:"function(){return (\n"+UM(e)+"\n)}"}),DM=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e}),c.workerModuleData={isWorkerModule:!0,id:a,name:o,dependencies:t,init:UM(n),getTransferables:r&&UM(r)},c.onMainThread=s,c}function UM(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function NM(e,t,n){return new Promise(function(r,i){var s=++PM;FM[s]=function(e){e.success?r(e.result):i(new Error("Error in worker "+t+" call: "+e.error))},function(e){var t=LM[e];if(!t){var n=UM(IM);(t=LM[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,n=t.messageId,r=FM[n];if(!r)throw new Error("WorkerModule response with empty or unknown messageId");delete FM[n],r(t)}}return t}(e).postMessage({messageId:s,action:t,data:n})})}function zM(){var e=function(e){function t(e,t,n,r,i,s,a,o){var l=1-a;o.x=l*l*e+2*l*a*n+a*a*i,o.y=l*l*t+2*l*a*r+a*a*s}function n(e,t,n,r,i,s,a,o,l,c){var u=1-l;c.x=u*u*u*e+3*u*u*l*n+3*u*l*l*i+l*l*l*a,c.y=u*u*u*t+3*u*u*l*r+3*u*l*l*s+l*l*l*o}function r(e,t){for(var n,r,i,s,a,o=/([MLQCZ])([^MLQCZ]*)/g;n=o.exec(e);){var l=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(e){return parseFloat(e)});switch(n[1]){case"M":s=r=l[0],a=i=l[1];break;case"L":l[0]===s&&l[1]===a||t("L",s,a,s=l[0],a=l[1]);break;case"Q":t("Q",s,a,s=l[2],a=l[3],l[0],l[1]);break;case"C":t("C",s,a,s=l[4],a=l[5],l[0],l[1],l[2],l[3]);break;case"Z":s===r&&a===i||t("L",s,a,r,i)}}}function i(e,i,s){void 0===s&&(s=16);var a={x:0,y:0};r(e,function(e,r,o,l,c,u,h,d,f){switch(e){case"L":i(r,o,l,c);break;case"Q":for(var p=r,m=o,g=1;g<s;g++)t(r,o,u,h,l,c,g/(s-1),a),i(p,m,a.x,a.y),p=a.x,m=a.y;break;case"C":for(var A=r,v=o,y=1;y<s;y++)n(r,o,u,h,d,f,l,c,y/(s-1),a),i(A,v,a.x,a.y),A=a.x,v=a.y}})}var s="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(e,t){var n=e.getContext?e.getContext("webgl",o):e,r=a.get(n);if(!r){var i="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,s={},l={},c={},u=-1,h=[];function d(e){var t=s[e];if(!t&&!(t=s[e]=n.getExtension(e)))throw new Error(e+" not supported");return t}function f(e,t){var r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),r}function p(e,t,r,s){if(!l[e]){var a={},o={},c=n.createProgram();n.attachShader(c,f(t,n.VERTEX_SHADER)),n.attachShader(c,f(r,n.FRAGMENT_SHADER)),n.linkProgram(c),l[e]={program:c,transaction:function(e){n.useProgram(c),e({setUniform:function(e,t){for(var r=[],i=arguments.length-2;i-- >0;)r[i]=arguments[i+2];var s=o[t]||(o[t]=n.getUniformLocation(c,t));n["uniform"+e].apply(n,[s].concat(r))},setAttribute:function(e,t,r,s,o){var l=a[e];l||(l=a[e]={buf:n.createBuffer(),loc:n.getAttribLocation(c,e),data:null}),n.bindBuffer(n.ARRAY_BUFFER,l.buf),n.vertexAttribPointer(l.loc,t,n.FLOAT,!1,0,0),n.enableVertexAttribArray(l.loc),i?n.vertexAttribDivisor(l.loc,s):d("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,s),o!==l.data&&(n.bufferData(n.ARRAY_BUFFER,o,r),l.data=o)}})}}}l[e].transaction(s)}function m(e,t){u++;try{n.activeTexture(n.TEXTURE0+u);var r=c[e];r||(r=c[e]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,r),t(r,u)}finally{u--}}function g(e,t,r){var i=n.createFramebuffer();h.push(i),n.bindFramebuffer(n.FRAMEBUFFER,i),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);try{r(i)}finally{n.deleteFramebuffer(i),n.bindFramebuffer(n.FRAMEBUFFER,h[--h.length-1]||null)}}function A(){s={},l={},c={},u=-1,h.length=0}n.canvas.addEventListener("webglcontextlost",function(e){A(),e.preventDefault()},!1),a.set(n,r={gl:n,isWebGL2:i,getExtension:d,withProgram:p,withTexture:m,withTextureFramebuffer:g,handleContextLoss:A})}t(r)}function c(e,t,n,r,i,a,o,c){void 0===o&&(o=15),void 0===c&&(c=null),l(e,function(e){var l=e.gl,u=e.withProgram;(0,e.withTexture)("copy",function(e,h){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,i,a,0,l.RGBA,l.UNSIGNED_BYTE,t),u("copy",s,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",h),l.bindFramebuffer(l.FRAMEBUFFER,c||null),l.disable(l.BLEND),l.colorMask(8&o,4&o,2&o,1&o),l.viewport(n,r,i,a),l.scissor(n,r,i,a),l.drawArrays(l.TRIANGLES,0,3)})})})}var u=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:c,resizeWebGLCanvasWithoutClearing:function(e,t,n){var r=e.width,i=e.height;l(e,function(s){var a=s.gl,o=new Uint8Array(r*i*4);a.readPixels(0,0,r,i,a.RGBA,a.UNSIGNED_BYTE,o),e.width=t,e.height=n,c(a,o,0,0,r,i)})}});function h(e,t,n,r,s,a){void 0===a&&(a=1);var o=new Uint8Array(e*t),l=r[2]-r[0],c=r[3]-r[1],u=[];i(n,function(e,t,n,r){u.push({x1:e,y1:t,x2:n,y2:r,minX:Math.min(e,n),minY:Math.min(t,r),maxX:Math.max(e,n),maxY:Math.max(t,r)})}),u.sort(function(e,t){return e.maxX-t.maxX});for(var h=0;h<e;h++)for(var d=0;d<t;d++){var f=g(r[0]+l*(h+.5)/e,r[1]+c*(d+.5)/t),m=Math.pow(1-Math.abs(f)/s,a)/2;f<0&&(m=1-m),m=Math.max(0,Math.min(255,Math.round(255*m))),o[d*e+h]=m}return o;function g(e,t){for(var n=1/0,r=1/0,i=u.length;i--;){var s=u[i];if(s.maxX+r<=e)break;if(e+r>s.minX&&t-r<s.maxY&&t+r>s.minY){var a=p(e,t,s.x1,s.y1,s.x2,s.y2);a<n&&(n=a,r=Math.sqrt(n))}}return function(e,t){for(var n=0,r=u.length;r--;){var i=u[r];if(i.maxX<=e)break;i.y1>t!=i.y2>t&&e<(i.x2-i.x1)*(t-i.y1)/(i.y2-i.y1)+i.x1&&(n+=i.y1<i.y2?1:-1)}return 0!==n}(e,t)&&(r=-r),r}}function d(e,t,n,r,i,s,a,o,l,c){void 0===s&&(s=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===c&&(c=0),f(e,t,n,r,i,s,a,null,o,l,c)}function f(e,t,n,r,i,s,a,o,l,u,d){void 0===s&&(s=1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===d&&(d=0);for(var f=h(e,t,n,r,i,s),p=new Uint8Array(4*f.length),m=0;m<f.length;m++)p[4*m+d]=f[m];c(a,p,l,u,e,t,1<<3-d,o)}function p(e,t,n,r,i,s){var a=i-n,o=s-r,l=a*a+o*o,c=l?Math.max(0,Math.min(1,((e-n)*a+(t-r)*o)/l)):0,u=e-(n+c*a),h=t-(r+c*o);return u*u+h*h}var m=Object.freeze({__proto__:null,generate:h,generateIntoCanvas:d,generateIntoFramebuffer:f}),g=new Float32Array([0,0,2,0,0,2]),A=null,v=!1,y={},E=new WeakMap;function _(e){if(!v&&!w(e))throw new Error("WebGL generation not supported")}function x(e,t,n,r,i,s,a){if(void 0===s&&(s=1),void 0===a&&(a=null),!a&&!(a=A)){var o="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!o)throw new Error("OffscreenCanvas or DOM canvas not supported");a=A=o.getContext("webgl",{depth:!1})}_(a);var c=new Uint8Array(e*t*4);l(a,function(a){var o=a.gl,l=a.withTexture,u=a.withTextureFramebuffer;l("readable",function(a,l){o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,t,0,o.RGBA,o.UNSIGNED_BYTE,null),u(a,l,function(a){S(e,t,n,r,i,s,o,a,0,0,0),o.readPixels(0,0,e,t,o.RGBA,o.UNSIGNED_BYTE,c)})})});for(var u=new Uint8Array(e*t),h=0,d=0;h<c.length;h+=4)u[d++]=c[h];return u}function b(e,t,n,r,i,s,a,o,l,c){void 0===s&&(s=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===c&&(c=0),S(e,t,n,r,i,s,a,null,o,l,c)}function S(e,t,n,r,a,o,c,u,h,d,f){void 0===o&&(o=1),void 0===h&&(h=0),void 0===d&&(d=0),void 0===f&&(f=0),_(c);var p=[];i(n,function(e,t,n,r){p.push(e,t,n,r)}),p=new Float32Array(p),l(c,function(n){var i=n.gl,l=n.isWebGL2,c=n.getExtension,m=n.withProgram,A=n.withTexture,v=n.withTextureFramebuffer,y=n.handleContextLoss;if(A("rawDistances",function(n,A){e===n._lastWidth&&t===n._lastHeight||i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n._lastWidth=e,n._lastHeight=t,0,i.RGBA,i.UNSIGNED_BYTE,null),m("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(s){var u=s.setAttribute,h=s.setUniform,d=!l&&c("ANGLE_instanced_arrays"),f=!l&&c("EXT_blend_minmax");u("aUV",2,i.STATIC_DRAW,0,g),u("aLineSegment",4,i.DYNAMIC_DRAW,1,p),h.apply(void 0,["4f","uGlyphBounds"].concat(r)),h("1f","uMaxDistance",a),h("1f","uExponent",o),v(n,A,function(n){i.enable(i.BLEND),i.colorMask(!0,!0,!0,!0),i.viewport(0,0,e,t),i.scissor(0,0,e,t),i.blendFunc(i.ONE,i.ONE),i.blendEquationSeparate(i.FUNC_ADD,l?i.MAX:f.MAX_EXT),i.clear(i.COLOR_BUFFER_BIT),l?i.drawArraysInstanced(i.TRIANGLES,0,3,p.length/4):d.drawArraysInstancedANGLE(i.TRIANGLES,0,3,p.length/4)})}),m("post",s,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(n){n.setAttribute("aUV",2,i.STATIC_DRAW,0,g),n.setUniform("1i","tex",A),i.bindFramebuffer(i.FRAMEBUFFER,u),i.disable(i.BLEND),i.colorMask(0===f,1===f,2===f,3===f),i.viewport(h,d,e,t),i.scissor(h,d,e,t),i.drawArrays(i.TRIANGLES,0,3)})}),i.isContextLost())throw y(),new Error("webgl context lost")})}function w(e){var t=e&&e!==A?e.canvas||e:y,n=E.get(t);if(void 0===n){v=!0;try{var r=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],i=x(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);n=i&&r.length===i.length&&i.every(function(e,t){return e===r[t]}),n||"bad trial run results"}catch(e){n=!1,e.message}v=!1,E.set(t,n)}return n}var C=Object.freeze({__proto__:null,generate:x,generateIntoCanvas:b,generateIntoFramebuffer:S,isSupported:w});return e.forEachPathCommand=r,e.generate=function(e,t,n,r,i,s){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===s&&(s=1);try{return x.apply(C,arguments)}catch(e){return h.apply(m,arguments)}},e.generateIntoCanvas=function(e,t,n,r,i,s,a,o,l,c){void 0===i&&(i=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===s&&(s=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return b.apply(C,arguments)}catch(e){return d.apply(m,arguments)}},e.javascript=m,e.pathToLineSegments=i,e.webgl=C,e.webglUtils=u,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}const GM=/\bvoid\s+main\s*\(\s*\)\s*{/g;function QM(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){let n=ls[t];return n?QM(n):e})}const HM=[];for(let e=0;e<256;e++)HM[e]=(e<16?"0":"")+e.toString(16);const VM=Object.assign||function(){let e=arguments[0];for(let t=1,n=arguments.length;t<n;t++){let n=arguments[t];if(n)for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},jM=Date.now(),WM=new WeakMap,YM=new Map;let KM=1e10;function qM(e,t){const n=function(e){const t=JSON.stringify(e,$M);let n=ZM.get(t);null==n&&ZM.set(t,n=++JM);return n}(t);let r=WM.get(e);if(r||WM.set(e,r=Object.create(null)),r[n])return new r[n];const i=`_onBeforeCompile${n}`,s=function(r,s){e.onBeforeCompile.call(this,r,s);const a=this.customProgramCacheKey()+"|"+r.vertexShader+"|"+r.fragmentShader;let o=YM[a];if(!o){const e=function(e,{vertexShader:t,fragmentShader:n},r,i){let{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:h,fragmentColorTransform:d,customRewriter:f,timeUniform:p}=r;s=s||"",a=a||"",o=o||"",c=c||"",u=u||"",h=h||"",(l||f)&&(t=QM(t));(d||f)&&(n=QM(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(f){let e=f({vertexShader:t,fragmentShader:n});t=e.vertexShader,n=e.fragmentShader}if(d){let e=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,t=>(e.push(t),"")),h=`${d}\n${e.join("\n")}\n${h}`}if(p){const e=`\nuniform float ${p};\n`;s=e+s,c=e+c}l&&(s=`${s}\nvoid troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${l}\n}\n`,a=`\ntroika_position_${i} = vec3(position);\ntroika_normal_${i} = vec3(normal);\ntroika_uv_${i} = vec2(uv);\ntroikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});\n${a}\n`,t=(t=`vec3 troika_position_${i};\nvec3 troika_normal_${i};\nvec2 troika_uv_${i};\n${t}\n`).replace(/\b(position|normal|uv)\b/g,(e,t,n,r)=>/\battribute\s+vec[23]\s+$/.test(r.substr(0,n))?t:`troika_${t}_${i}`),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${i}`)));return t=XM(t,i,s,a,o),n=XM(n,i,c,u,h),{vertexShader:t,fragmentShader:n}}(this,r,t,n);o=YM[a]=e}r.vertexShader=o.vertexShader,r.fragmentShader=o.fragmentShader,VM(r.uniforms,this.uniforms),t.timeUniform&&(r.uniforms[t.timeUniform]={get value(){return Date.now()-jM}}),this[i]&&this[i](r)},a=function(){return o(t.chained?e:e.clone())},o=function(r){const i=Object.create(r,l);return Object.defineProperty(i,"baseMaterial",{value:e}),Object.defineProperty(i,"id",{value:KM++}),i.uuid=function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(HM[255&e]+HM[e>>8&255]+HM[e>>16&255]+HM[e>>24&255]+"-"+HM[255&t]+HM[t>>8&255]+"-"+HM[t>>16&15|64]+HM[t>>24&255]+"-"+HM[63&n|128]+HM[n>>8&255]+"-"+HM[n>>16&255]+HM[n>>24&255]+HM[255&r]+HM[r>>8&255]+HM[r>>16&255]+HM[r>>24&255]).toUpperCase()}(),i.uniforms=VM({},r.uniforms,t.uniforms),i.defines=VM({},r.defines,t.defines),i.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",i.extensions=VM({},r.extensions,t.extensions),i._listeners=void 0,i},l={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>e.type,set:t=>{e.type=t}},isDerivedFrom:{writable:!0,configurable:!0,value:function(e){const t=this.baseMaterial;return e===t||t.isDerivedMaterial&&t.isDerivedFrom(e)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>s,set(e){this[i]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(VM(this.extensions,t.extensions),VM(this.defines,t.defines),VM(this.uniforms,Vi.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const t=new e.constructor;return o(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||(n=this._depthMaterial=qM(e.isDerivedMaterial?e.getDepthMaterial():new To({depthPacking:pt}),t),n.defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||(n=this._distanceMaterial=qM(e.isDerivedMaterial?e.getDistanceMaterial():new Mo,t),n.defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:t,_distanceMaterial:n}=this;t&&t.dispose(),n&&n.dispose(),e.dispose.call(this)}}};return r[n]=a,new a}function XM(e,t,n,r,i){return(r||i||n)&&(e=e.replace(GM,`\n${n}\nvoid troikaOrigMain${t}() {`),e+=`\nvoid main() {\n  ${r}\n  troikaOrigMain${t}();\n  ${i}\n}`),e}function $M(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let JM=0;const ZM=new Map;const eI=OM({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var t={parse:function(e){var n=t._bin,r=new Uint8Array(e);if("ttcf"==n.readASCII(r,0,4)){var i=4;n.readUshort(r,i),i+=2,n.readUshort(r,i),i+=2;var s=n.readUint(r,i);i+=4;for(var a=[],o=0;o<s;o++){var l=n.readUint(r,i);i+=4,a.push(t._readFont(r,l))}return a}return[t._readFont(r,0)]},_readFont:function(e,n){var r=t._bin,i=n;r.readFixed(e,n),n+=4;var s=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],o={_data:e,_offset:i},l={},c=0;c<s;c++){var u=r.readASCII(e,n,4);n+=4,r.readUint(e,n),n+=4;var h=r.readUint(e,n);n+=4;var d=r.readUint(e,n);n+=4,l[u]={offset:h,length:d}}for(c=0;c<a.length;c++){var f=a[c];l[f]&&(o[f.trim()]=t[f.trim()].parse(e,l[f].offset,l[f].length,o))}return o},_tabOffset:function(e,n,r){for(var i=t._bin,s=i.readUshort(e,r+4),a=r+12,o=0;o<s;o++){var l=i.readASCII(e,a,4);a+=4,i.readUint(e,a),a+=4;var c=i.readUint(e,a);if(a+=4,i.readUint(e,a),a+=4,l==n)return c}return 0}};t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,n){return t._bin.readShort(e,n)/16384},readInt:function(e,n){return t._bin._view(e).getInt32(n)},readInt8:function(e,n){return t._bin._view(e).getInt8(n)},readShort:function(e,n){return t._bin._view(e).getInt16(n)},readUshort:function(e,n){return t._bin._view(e).getUint16(n)},readUshorts:function(e,n,r){for(var i=[],s=0;s<r;s++)i.push(t._bin.readUshort(e,n+2*s));return i},readUint:function(e,n){return t._bin._view(e).getUint32(n)},readUint64:function(e,n){return 4294967296*t._bin.readUint(e,n)+t._bin.readUint(e,n+4)},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},readUnicode:function(e,t,n){for(var r="",i=0;i<n;i++){var s=e[t++]<<8|e[t++];r+=String.fromCharCode(s)}return r},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,n,r){var i=t._bin._tdec;return i&&0==n&&r==e.length?i.decode(e):t._bin.readASCII(e,n,r)},readBytes:function(e,t,n){for(var r=[],i=0;i<n;i++)r.push(e[t+i]);return r},readASCIIArray:function(e,t,n){for(var r=[],i=0;i<n;i++)r.push(String.fromCharCode(e[t+i]));return r},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,n,r,i,s){var a=t._bin,o={},l=n;a.readFixed(e,n),n+=4;var c=a.readUshort(e,n);n+=2;var u=a.readUshort(e,n);n+=2;var h=a.readUshort(e,n);return n+=2,o.scriptList=t._lctf.readScriptList(e,l+c),o.featureList=t._lctf.readFeatureList(e,l+u),o.lookupList=t._lctf.readLookupList(e,l+h,s),o},t._lctf.readLookupList=function(e,n,r){var i=t._bin,s=n,a=[],o=i.readUshort(e,n);n+=2;for(var l=0;l<o;l++){var c=i.readUshort(e,n);n+=2;var u=t._lctf.readLookupTable(e,s+c,r);a.push(u)}return a},t._lctf.readLookupTable=function(e,n,r){var i=t._bin,s=n,a={tabs:[]};a.ltype=i.readUshort(e,n),n+=2,a.flag=i.readUshort(e,n),n+=2;var o=i.readUshort(e,n);n+=2;for(var l=a.ltype,c=0;c<o;c++){var u=i.readUshort(e,n);n+=2;var h=r(e,l,s+u,a);a.tabs.push(h)}return a},t._lctf.numOfOnes=function(e){for(var t=0,n=0;n<32;n++)e>>>n&1&&t++;return t},t._lctf.readClassDef=function(e,n){var r=t._bin,i=[],s=r.readUshort(e,n);if(n+=2,1==s){var a=r.readUshort(e,n);n+=2;var o=r.readUshort(e,n);n+=2;for(var l=0;l<o;l++)i.push(a+l),i.push(a+l),i.push(r.readUshort(e,n)),n+=2}if(2==s){var c=r.readUshort(e,n);for(n+=2,l=0;l<c;l++)i.push(r.readUshort(e,n)),n+=2,i.push(r.readUshort(e,n)),n+=2,i.push(r.readUshort(e,n)),n+=2}return i},t._lctf.getInterval=function(e,t){for(var n=0;n<e.length;n+=3){var r=e[n],i=e[n+1];if(e[n+2],r<=t&&t<=i)return n}return-1},t._lctf.readCoverage=function(e,n){var r=t._bin,i={};i.fmt=r.readUshort(e,n),n+=2;var s=r.readUshort(e,n);return n+=2,1==i.fmt&&(i.tab=r.readUshorts(e,n,s)),2==i.fmt&&(i.tab=r.readUshorts(e,n,3*s)),i},t._lctf.coverageIndex=function(e,n){var r=e.tab;if(1==e.fmt)return r.indexOf(n);if(2==e.fmt){var i=t._lctf.getInterval(r,n);if(-1!=i)return r[i+2]+(n-r[i])}return-1},t._lctf.readFeatureList=function(e,n){var r=t._bin,i=n,s=[],a=r.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=r.readASCII(e,n,4);n+=4;var c=r.readUshort(e,n);n+=2;var u=t._lctf.readFeatureTable(e,i+c);u.tag=l.trim(),s.push(u)}return s},t._lctf.readFeatureTable=function(e,n){var r=t._bin,i=n,s={},a=r.readUshort(e,n);n+=2,a>0&&(s.featureParams=i+a);var o=r.readUshort(e,n);n+=2,s.tab=[];for(var l=0;l<o;l++)s.tab.push(r.readUshort(e,n+2*l));return s},t._lctf.readScriptList=function(e,n){var r=t._bin,i=n,s={},a=r.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=r.readASCII(e,n,4);n+=4;var c=r.readUshort(e,n);n+=2,s[l.trim()]=t._lctf.readScriptTable(e,i+c)}return s},t._lctf.readScriptTable=function(e,n){var r=t._bin,i=n,s={},a=r.readUshort(e,n);n+=2,a>0&&(s.default=t._lctf.readLangSysTable(e,i+a));var o=r.readUshort(e,n);n+=2;for(var l=0;l<o;l++){var c=r.readASCII(e,n,4);n+=4;var u=r.readUshort(e,n);n+=2,s[c.trim()]=t._lctf.readLangSysTable(e,i+u)}return s},t._lctf.readLangSysTable=function(e,n){var r=t._bin,i={};r.readUshort(e,n),n+=2,i.reqFeature=r.readUshort(e,n),n+=2;var s=r.readUshort(e,n);return n+=2,i.features=r.readUshorts(e,n,s),i},t.CFF={},t.CFF.parse=function(e,n,r){var i=t._bin;(e=new Uint8Array(e.buffer,n,r))[n=0],e[++n],e[++n],e[++n],n++;var s=[];n=t.CFF.readIndex(e,n,s);for(var a=[],o=0;o<s.length-1;o++)a.push(i.readASCII(e,n+s[o],s[o+1]-s[o]));n+=s[s.length-1];var l=[];n=t.CFF.readIndex(e,n,l);var c=[];for(o=0;o<l.length-1;o++)c.push(t.CFF.readDict(e,n+l[o],n+l[o+1]));n+=l[l.length-1];var u=c[0],h=[];n=t.CFF.readIndex(e,n,h);var d=[];for(o=0;o<h.length-1;o++)d.push(i.readASCII(e,n+h[o],h[o+1]-h[o]));if(n+=h[h.length-1],t.CFF.readSubrs(e,n,u),u.CharStrings){n=u.CharStrings,h=[],n=t.CFF.readIndex(e,n,h);var f=[];for(o=0;o<h.length-1;o++)f.push(i.readBytes(e,n+h[o],h[o+1]-h[o]));u.CharStrings=f}if(u.ROS){n=u.FDArray;var p=[];for(n=t.CFF.readIndex(e,n,p),u.FDArray=[],o=0;o<p.length-1;o++){var m=t.CFF.readDict(e,n+p[o],n+p[o+1]);t.CFF._readFDict(e,m,d),u.FDArray.push(m)}n+=p[p.length-1],n=u.FDSelect,u.FDSelect=[];var g=e[n];if(n++,3!=g)throw g;var A=i.readUshort(e,n);for(n+=2,o=0;o<A+1;o++)u.FDSelect.push(i.readUshort(e,n),e[n+2]),n+=3}return u.Encoding&&(u.Encoding=t.CFF.readEncoding(e,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=t.CFF.readCharset(e,u.charset,u.CharStrings.length)),t.CFF._readFDict(e,u,d),u},t.CFF._readFDict=function(e,n,r){var i;for(var s in n.Private&&(i=n.Private[1],n.Private=t.CFF.readDict(e,i,i+n.Private[0]),n.Private.Subrs&&t.CFF.readSubrs(e,i+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(s)&&(n[s]=r[n[s]-426+35])},t.CFF.readSubrs=function(e,n,r){var i=t._bin,s=[];n=t.CFF.readIndex(e,n,s);var a,o=s.length;a=o<1240?107:o<33900?1131:32768,r.Bias=a,r.Subrs=[];for(var l=0;l<s.length-1;l++)r.Subrs.push(i.readBytes(e,n+s[l],s[l+1]-s[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var n=0;n<e.charset.length;n++)if(e.charset[n]==t)return n;return-1},t.CFF.glyphBySE=function(e,n){return n<0||n>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[n])},t.CFF.readEncoding=function(e,n,r){t._bin;var i=[".notdef"],s=e[n];if(n++,0!=s)throw"error: unknown encoding format: "+s;var a=e[n];n++;for(var o=0;o<a;o++)i.push(e[n+o]);return i},t.CFF.readCharset=function(e,n,r){var i=t._bin,s=[".notdef"],a=e[n];if(n++,0==a)for(var o=0;o<r;o++){var l=i.readUshort(e,n);n+=2,s.push(l)}else{if(1!=a&&2!=a)throw"error: format: "+a;for(;s.length<r;){l=i.readUshort(e,n),n+=2;var c=0;for(1==a?(c=e[n],n++):(c=i.readUshort(e,n),n+=2),o=0;o<=c;o++)s.push(l),l++}}return s},t.CFF.readIndex=function(e,n,r){var i=t._bin,s=i.readUshort(e,n)+1,a=e[n+=2];if(n++,1==a)for(var o=0;o<s;o++)r.push(e[n+o]);else if(2==a)for(o=0;o<s;o++)r.push(i.readUshort(e,n+2*o));else if(3==a)for(o=0;o<s;o++)r.push(16777215&i.readUint(e,n+3*o-1));else if(1!=s)throw"unsupported offset size: "+a+", count: "+s;return(n+=s*a)-1},t.CFF.getCharString=function(e,n,r){var i=t._bin,s=e[n],a=e[n+1];e[n+2],e[n+3],e[n+4];var o=1,l=null,c=null;s<=20&&(l=s,o=1),12==s&&(l=100*s+a,o=2),21<=s&&s<=27&&(l=s,o=1),28==s&&(c=i.readShort(e,n+1),o=3),29<=s&&s<=31&&(l=s,o=1),32<=s&&s<=246&&(c=s-139,o=1),247<=s&&s<=250&&(c=256*(s-247)+a+108,o=2),251<=s&&s<=254&&(c=256*-(s-251)-a-108,o=2),255==s&&(c=i.readInt(e,n+1)/65535,o=5),r.val=null!=c?c:"o"+l,r.size=o},t.CFF.readCharString=function(e,n,r){for(var i=n+r,s=t._bin,a=[];n<i;){var o=e[n],l=e[n+1];e[n+2],e[n+3],e[n+4];var c=1,u=null,h=null;o<=20&&(u=o,c=1),12==o&&(u=100*o+l,c=2),19!=o&&20!=o||(u=o,c=2),21<=o&&o<=27&&(u=o,c=1),28==o&&(h=s.readShort(e,n+1),c=3),29<=o&&o<=31&&(u=o,c=1),32<=o&&o<=246&&(h=o-139,c=1),247<=o&&o<=250&&(h=256*(o-247)+l+108,c=2),251<=o&&o<=254&&(h=256*-(o-251)-l-108,c=2),255==o&&(h=s.readInt(e,n+1)/65535,c=5),a.push(null!=h?h:"o"+u),n+=c}return a},t.CFF.readDict=function(e,n,r){for(var i=t._bin,s={},a=[];n<r;){var o=e[n],l=e[n+1];e[n+2],e[n+3],e[n+4];var c=1,u=null,h=null;if(28==o&&(h=i.readShort(e,n+1),c=3),29==o&&(h=i.readInt(e,n+1),c=5),32<=o&&o<=246&&(h=o-139,c=1),247<=o&&o<=250&&(h=256*(o-247)+l+108,c=2),251<=o&&o<=254&&(h=256*-(o-251)-l-108,c=2),255==o)throw h=i.readInt(e,n+1)/65535,c=5,"unknown number";if(30==o){var d=[];for(c=1;;){var f=e[n+c];c++;var p=f>>4,m=15&f;if(15!=p&&d.push(p),15!=m&&d.push(m),15==m)break}for(var g="",A=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],v=0;v<d.length;v++)g+=A[d[v]];h=parseFloat(g)}o<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][o],c=1,12==o&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2)),null!=u?(s[u]=1==a.length?a[0]:a,a=[]):a.push(h),n+=c}return s},t.cmap={},t.cmap.parse=function(e,n,r){e=new Uint8Array(e.buffer,n,r),n=0;var i=t._bin,s={};i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);n+=2;var o=[];s.tables=[];for(var l=0;l<a;l++){var c=i.readUshort(e,n);n+=2;var u=i.readUshort(e,n);n+=2;var h=i.readUint(e,n);n+=4;var d="p"+c+"e"+u,f=o.indexOf(h);if(-1==f){var p;f=s.tables.length,o.push(h);var m=i.readUshort(e,h);0==m?p=t.cmap.parse0(e,h):4==m?p=t.cmap.parse4(e,h):6==m?p=t.cmap.parse6(e,h):12==m&&(p=t.cmap.parse12(e,h)),s.tables.push(p)}if(null!=s[d])throw"multiple tables for one platform+encoding";s[d]=f}return s},t.cmap.parse0=function(e,n){var r=t._bin,i={};i.format=r.readUshort(e,n),n+=2;var s=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2,i.map=[];for(var a=0;a<s-6;a++)i.map.push(e[n+a]);return i},t.cmap.parse4=function(e,n){var r=t._bin,i=n,s={};s.format=r.readUshort(e,n),n+=2;var a=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2;var o=r.readUshort(e,n);n+=2;var l=o/2;s.searchRange=r.readUshort(e,n),n+=2,s.entrySelector=r.readUshort(e,n),n+=2,s.rangeShift=r.readUshort(e,n),n+=2,s.endCount=r.readUshorts(e,n,l),n+=2*l,n+=2,s.startCount=r.readUshorts(e,n,l),n+=2*l,s.idDelta=[];for(var c=0;c<l;c++)s.idDelta.push(r.readShort(e,n)),n+=2;for(s.idRangeOffset=r.readUshorts(e,n,l),n+=2*l,s.glyphIdArray=[];n<i+a;)s.glyphIdArray.push(r.readUshort(e,n)),n+=2;return s},t.cmap.parse6=function(e,n){var r=t._bin,i={};i.format=r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2,i.firstCode=r.readUshort(e,n),n+=2;var s=r.readUshort(e,n);n+=2,i.glyphIdArray=[];for(var a=0;a<s;a++)i.glyphIdArray.push(r.readUshort(e,n)),n+=2;return i},t.cmap.parse12=function(e,n){var r=t._bin,i={};i.format=r.readUshort(e,n),n+=2,n+=2,r.readUint(e,n),n+=4,r.readUint(e,n),n+=4;var s=r.readUint(e,n);n+=4,i.groups=[];for(var a=0;a<s;a++){var o=n+12*a,l=r.readUint(e,o+0),c=r.readUint(e,o+4),u=r.readUint(e,o+8);i.groups.push([l,c,u])}return i},t.glyf={},t.glyf.parse=function(e,t,n,r){for(var i=[],s=0;s<r.maxp.numGlyphs;s++)i.push(null);return i},t.glyf._parseGlyf=function(e,n){var r=t._bin,i=e._data,s=t._tabOffset(i,"glyf",e._offset)+e.loca[n];if(e.loca[n]==e.loca[n+1])return null;var a={};if(a.noc=r.readShort(i,s),s+=2,a.xMin=r.readShort(i,s),s+=2,a.yMin=r.readShort(i,s),s+=2,a.xMax=r.readShort(i,s),s+=2,a.yMax=r.readShort(i,s),s+=2,a.xMin>=a.xMax||a.yMin>=a.yMax)return null;if(a.noc>0){a.endPts=[];for(var o=0;o<a.noc;o++)a.endPts.push(r.readUshort(i,s)),s+=2;var l=r.readUshort(i,s);if(s+=2,i.length-s<l)return null;a.instructions=r.readBytes(i,s,l),s+=l;var c=a.endPts[a.noc-1]+1;for(a.flags=[],o=0;o<c;o++){var u=i[s];if(s++,a.flags.push(u),8&u){var h=i[s];s++;for(var d=0;d<h;d++)a.flags.push(u),o++}}for(a.xs=[],o=0;o<c;o++){var f=!!(2&a.flags[o]),p=!!(16&a.flags[o]);f?(a.xs.push(p?i[s]:-i[s]),s++):p?a.xs.push(0):(a.xs.push(r.readShort(i,s)),s+=2)}for(a.ys=[],o=0;o<c;o++)f=!!(4&a.flags[o]),p=!!(32&a.flags[o]),f?(a.ys.push(p?i[s]:-i[s]),s++):p?a.ys.push(0):(a.ys.push(r.readShort(i,s)),s+=2);var m=0,g=0;for(o=0;o<c;o++)m+=a.xs[o],g+=a.ys[o],a.xs[o]=m,a.ys[o]=g}else{var A;a.parts=[];do{A=r.readUshort(i,s),s+=2;var v={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(a.parts.push(v),v.glyphIndex=r.readUshort(i,s),s+=2,1&A){var y=r.readShort(i,s);s+=2;var E=r.readShort(i,s);s+=2}else y=r.readInt8(i,s),s++,E=r.readInt8(i,s),s++;2&A?(v.m.tx=y,v.m.ty=E):(v.p1=y,v.p2=E),8&A?(v.m.a=v.m.d=r.readF2dot14(i,s),s+=2):64&A?(v.m.a=r.readF2dot14(i,s),s+=2,v.m.d=r.readF2dot14(i,s),s+=2):128&A&&(v.m.a=r.readF2dot14(i,s),s+=2,v.m.b=r.readF2dot14(i,s),s+=2,v.m.c=r.readF2dot14(i,s),s+=2,v.m.d=r.readF2dot14(i,s),s+=2)}while(32&A);if(256&A){var _=r.readUshort(i,s);for(s+=2,a.instr=[],o=0;o<_;o++)a.instr.push(i[s]),s++}}return a},t.GDEF={},t.GDEF.parse=function(e,n,r,i){var s=n;n+=4;var a=t._bin.readUshort(e,n);return{glyphClassDef:0===a?null:t._lctf.readClassDef(e,s+a)}},t.GPOS={},t.GPOS.parse=function(e,n,r,i){return t._lctf.parse(e,n,r,i,t.GPOS.subt)},t.GPOS.subt=function(e,n,r,i){var s=t._bin,a=r,o={};if(o.fmt=s.readUshort(e,r),r+=2,1==n||2==n||3==n||7==n||8==n&&o.fmt<=2){var l=s.readUshort(e,r);r+=2,o.coverage=t._lctf.readCoverage(e,l+a)}if(1==n&&1==o.fmt){var c=s.readUshort(e,r);r+=2,0!=c&&(o.pos=t.GPOS.readValueRecord(e,r,c))}else if(2==n&&o.fmt>=1&&o.fmt<=2){c=s.readUshort(e,r),r+=2;var u=s.readUshort(e,r);r+=2;var h=t._lctf.numOfOnes(c),d=t._lctf.numOfOnes(u);if(1==o.fmt){o.pairsets=[];var f=s.readUshort(e,r);r+=2;for(var p=0;p<f;p++){var m=a+s.readUshort(e,r);r+=2;var g=s.readUshort(e,m);m+=2;for(var A=[],v=0;v<g;v++){var y=s.readUshort(e,m);m+=2,0!=c&&(w=t.GPOS.readValueRecord(e,m,c),m+=2*h),0!=u&&(C=t.GPOS.readValueRecord(e,m,u),m+=2*d),A.push({gid2:y,val1:w,val2:C})}o.pairsets.push(A)}}if(2==o.fmt){var E=s.readUshort(e,r);r+=2;var _=s.readUshort(e,r);r+=2;var x=s.readUshort(e,r);r+=2;var b=s.readUshort(e,r);for(r+=2,o.classDef1=t._lctf.readClassDef(e,a+E),o.classDef2=t._lctf.readClassDef(e,a+_),o.matrix=[],p=0;p<x;p++){var S=[];for(v=0;v<b;v++){var w=null,C=null;0!=c&&(w=t.GPOS.readValueRecord(e,r,c),r+=2*h),0!=u&&(C=t.GPOS.readValueRecord(e,r,u),r+=2*d),S.push({val1:w,val2:C})}o.matrix.push(S)}}}else if(4==n&&1==o.fmt)o.markCoverage=t._lctf.readCoverage(e,s.readUshort(e,r)+a),o.baseCoverage=t._lctf.readCoverage(e,s.readUshort(e,r+2)+a),o.markClassCount=s.readUshort(e,r+4),o.markArray=t.GPOS.readMarkArray(e,s.readUshort(e,r+6)+a),o.baseArray=t.GPOS.readBaseArray(e,s.readUshort(e,r+8)+a,o.markClassCount);else if(6==n&&1==o.fmt)o.mark1Coverage=t._lctf.readCoverage(e,s.readUshort(e,r)+a),o.mark2Coverage=t._lctf.readCoverage(e,s.readUshort(e,r+2)+a),o.markClassCount=s.readUshort(e,r+4),o.mark1Array=t.GPOS.readMarkArray(e,s.readUshort(e,r+6)+a),o.mark2Array=t.GPOS.readBaseArray(e,s.readUshort(e,r+8)+a,o.markClassCount);else if(9==n&&1==o.fmt){var T=s.readUshort(e,r);r+=2;var M=s.readUint(e,r);if(r+=4,9==i.ltype)i.ltype=T;else if(i.ltype!=T)throw"invalid extension substitution";return t.GPOS.subt(e,i.ltype,a+M)}return o},t.GPOS.readValueRecord=function(e,n,r){var i=t._bin,s=[];return s.push(1&r?i.readShort(e,n):0),n+=1&r?2:0,s.push(2&r?i.readShort(e,n):0),n+=2&r?2:0,s.push(4&r?i.readShort(e,n):0),n+=4&r?2:0,s.push(8&r?i.readShort(e,n):0),n+=8&r?2:0,s},t.GPOS.readBaseArray=function(e,n,r){var i=t._bin,s=[],a=n,o=i.readUshort(e,n);n+=2;for(var l=0;l<o;l++){for(var c=[],u=0;u<r;u++)c.push(t.GPOS.readAnchorRecord(e,a+i.readUshort(e,n))),n+=2;s.push(c)}return s},t.GPOS.readMarkArray=function(e,n){var r=t._bin,i=[],s=n,a=r.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=t.GPOS.readAnchorRecord(e,r.readUshort(e,n+2)+s);l.markClass=r.readUshort(e,n),i.push(l),n+=4}return i},t.GPOS.readAnchorRecord=function(e,n){var r=t._bin,i={};return i.fmt=r.readUshort(e,n),i.x=r.readShort(e,n+2),i.y=r.readShort(e,n+4),i},t.GSUB={},t.GSUB.parse=function(e,n,r,i){return t._lctf.parse(e,n,r,i,t.GSUB.subt)},t.GSUB.subt=function(e,n,r,i){var s=t._bin,a=r,o={};if(o.fmt=s.readUshort(e,r),r+=2,1!=n&&2!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||2==n||4==n||5==n&&o.fmt<=2||6==n&&o.fmt<=2){var l=s.readUshort(e,r);r+=2,o.coverage=t._lctf.readCoverage(e,a+l)}if(1==n&&o.fmt>=1&&o.fmt<=2){if(1==o.fmt)o.delta=s.readShort(e,r),r+=2;else if(2==o.fmt){var c=s.readUshort(e,r);r+=2,o.newg=s.readUshorts(e,r,c),r+=2*o.newg.length}}else if(2==n&&1==o.fmt){c=s.readUshort(e,r),r+=2,o.seqs=[];for(var u=0;u<c;u++){var h=s.readUshort(e,r)+a;r+=2;var d=s.readUshort(e,h);o.seqs.push(s.readUshorts(e,h+2,d))}}else if(4==n)for(o.vals=[],c=s.readUshort(e,r),r+=2,u=0;u<c;u++){var f=s.readUshort(e,r);r+=2,o.vals.push(t.GSUB.readLigatureSet(e,a+f))}else if(5==n&&2==o.fmt){if(2==o.fmt){var p=s.readUshort(e,r);r+=2,o.cDef=t._lctf.readClassDef(e,a+p),o.scset=[];var m=s.readUshort(e,r);for(r+=2,u=0;u<m;u++){var g=s.readUshort(e,r);r+=2,o.scset.push(0==g?null:t.GSUB.readSubClassSet(e,a+g))}}}else if(6==n&&3==o.fmt){if(3==o.fmt){for(u=0;u<3;u++){c=s.readUshort(e,r),r+=2;for(var A=[],v=0;v<c;v++)A.push(t._lctf.readCoverage(e,a+s.readUshort(e,r+2*v)));r+=2*c,0==u&&(o.backCvg=A),1==u&&(o.inptCvg=A),2==u&&(o.ahedCvg=A)}c=s.readUshort(e,r),r+=2,o.lookupRec=t.GSUB.readSubstLookupRecords(e,r,c)}}else if(7==n&&1==o.fmt){var y=s.readUshort(e,r);r+=2;var E=s.readUint(e,r);if(r+=4,9==i.ltype)i.ltype=y;else if(i.ltype!=y)throw"invalid extension substitution";return t.GSUB.subt(e,i.ltype,a+E)}return o},t.GSUB.readSubClassSet=function(e,n){var r=t._bin.readUshort,i=n,s=[],a=r(e,n);n+=2;for(var o=0;o<a;o++){var l=r(e,n);n+=2,s.push(t.GSUB.readSubClassRule(e,i+l))}return s},t.GSUB.readSubClassRule=function(e,n){var r=t._bin.readUshort,i={},s=r(e,n),a=r(e,n+=2);n+=2,i.input=[];for(var o=0;o<s-1;o++)i.input.push(r(e,n)),n+=2;return i.substLookupRecords=t.GSUB.readSubstLookupRecords(e,n,a),i},t.GSUB.readSubstLookupRecords=function(e,n,r){for(var i=t._bin.readUshort,s=[],a=0;a<r;a++)s.push(i(e,n),i(e,n+2)),n+=4;return s},t.GSUB.readChainSubClassSet=function(e,n){var r=t._bin,i=n,s=[],a=r.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=r.readUshort(e,n);n+=2,s.push(t.GSUB.readChainSubClassRule(e,i+l))}return s},t.GSUB.readChainSubClassRule=function(e,n){for(var r=t._bin,i={},s=["backtrack","input","lookahead"],a=0;a<s.length;a++){var o=r.readUshort(e,n);n+=2,1==a&&o--,i[s[a]]=r.readUshorts(e,n,o),n+=2*i[s[a]].length}return o=r.readUshort(e,n),n+=2,i.subst=r.readUshorts(e,n,2*o),n+=2*i.subst.length,i},t.GSUB.readLigatureSet=function(e,n){var r=t._bin,i=n,s=[],a=r.readUshort(e,n);n+=2;for(var o=0;o<a;o++){var l=r.readUshort(e,n);n+=2,s.push(t.GSUB.readLigature(e,i+l))}return s},t.GSUB.readLigature=function(e,n){var r=t._bin,i={chain:[]};i.nglyph=r.readUshort(e,n),n+=2;var s=r.readUshort(e,n);n+=2;for(var a=0;a<s-1;a++)i.chain.push(r.readUshort(e,n)),n+=2;return i},t.head={},t.head.parse=function(e,n,r){var i=t._bin,s={};return i.readFixed(e,n),n+=4,s.fontRevision=i.readFixed(e,n),n+=4,i.readUint(e,n),n+=4,i.readUint(e,n),n+=4,s.flags=i.readUshort(e,n),n+=2,s.unitsPerEm=i.readUshort(e,n),n+=2,s.created=i.readUint64(e,n),n+=8,s.modified=i.readUint64(e,n),n+=8,s.xMin=i.readShort(e,n),n+=2,s.yMin=i.readShort(e,n),n+=2,s.xMax=i.readShort(e,n),n+=2,s.yMax=i.readShort(e,n),n+=2,s.macStyle=i.readUshort(e,n),n+=2,s.lowestRecPPEM=i.readUshort(e,n),n+=2,s.fontDirectionHint=i.readShort(e,n),n+=2,s.indexToLocFormat=i.readShort(e,n),n+=2,s.glyphDataFormat=i.readShort(e,n),n+=2,s},t.hhea={},t.hhea.parse=function(e,n,r){var i=t._bin,s={};return i.readFixed(e,n),n+=4,s.ascender=i.readShort(e,n),n+=2,s.descender=i.readShort(e,n),n+=2,s.lineGap=i.readShort(e,n),n+=2,s.advanceWidthMax=i.readUshort(e,n),n+=2,s.minLeftSideBearing=i.readShort(e,n),n+=2,s.minRightSideBearing=i.readShort(e,n),n+=2,s.xMaxExtent=i.readShort(e,n),n+=2,s.caretSlopeRise=i.readShort(e,n),n+=2,s.caretSlopeRun=i.readShort(e,n),n+=2,s.caretOffset=i.readShort(e,n),n+=2,n+=8,s.metricDataFormat=i.readShort(e,n),n+=2,s.numberOfHMetrics=i.readUshort(e,n),n+=2,s},t.hmtx={},t.hmtx.parse=function(e,n,r,i){for(var s=t._bin,a={aWidth:[],lsBearing:[]},o=0,l=0,c=0;c<i.maxp.numGlyphs;c++)c<i.hhea.numberOfHMetrics&&(o=s.readUshort(e,n),n+=2,l=s.readShort(e,n),n+=2),a.aWidth.push(o),a.lsBearing.push(l);return a},t.kern={},t.kern.parse=function(e,n,r,i){var s=t._bin,a=s.readUshort(e,n);if(n+=2,1==a)return t.kern.parseV1(e,n-2,r,i);var o=s.readUshort(e,n);n+=2;for(var l={glyph1:[],rval:[]},c=0;c<o;c++){n+=2,r=s.readUshort(e,n),n+=2;var u=s.readUshort(e,n);n+=2;var h=u>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;n=t.kern.readFormat0(e,n,l)}return l},t.kern.parseV1=function(e,n,r,i){var s=t._bin;s.readFixed(e,n),n+=4;var a=s.readUint(e,n);n+=4;for(var o={glyph1:[],rval:[]},l=0;l<a;l++){s.readUint(e,n),n+=4;var c=s.readUshort(e,n);n+=2,s.readUshort(e,n),n+=2;var u=c>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;n=t.kern.readFormat0(e,n,o)}return o},t.kern.readFormat0=function(e,n,r){var i=t._bin,s=-1,a=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2;for(var o=0;o<a;o++){var l=i.readUshort(e,n);n+=2;var c=i.readUshort(e,n);n+=2;var u=i.readShort(e,n);n+=2,l!=s&&(r.glyph1.push(l),r.rval.push({glyph2:[],vals:[]}));var h=r.rval[r.rval.length-1];h.glyph2.push(c),h.vals.push(u),s=l}return n},t.loca={},t.loca.parse=function(e,n,r,i){var s=t._bin,a=[],o=i.head.indexToLocFormat,l=i.maxp.numGlyphs+1;if(0==o)for(var c=0;c<l;c++)a.push(s.readUshort(e,n+(c<<1))<<1);if(1==o)for(c=0;c<l;c++)a.push(s.readUint(e,n+(c<<2)));return a},t.maxp={},t.maxp.parse=function(e,n,r){var i=t._bin,s={},a=i.readUint(e,n);return n+=4,s.numGlyphs=i.readUshort(e,n),n+=2,65536==a&&(s.maxPoints=i.readUshort(e,n),n+=2,s.maxContours=i.readUshort(e,n),n+=2,s.maxCompositePoints=i.readUshort(e,n),n+=2,s.maxCompositeContours=i.readUshort(e,n),n+=2,s.maxZones=i.readUshort(e,n),n+=2,s.maxTwilightPoints=i.readUshort(e,n),n+=2,s.maxStorage=i.readUshort(e,n),n+=2,s.maxFunctionDefs=i.readUshort(e,n),n+=2,s.maxInstructionDefs=i.readUshort(e,n),n+=2,s.maxStackElements=i.readUshort(e,n),n+=2,s.maxSizeOfInstructions=i.readUshort(e,n),n+=2,s.maxComponentElements=i.readUshort(e,n),n+=2,s.maxComponentDepth=i.readUshort(e,n),n+=2),s},t.name={},t.name.parse=function(e,n,r){var i=t._bin,s={};i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);n+=2,i.readUshort(e,n);for(var o,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=n+=2,u=0;u<a;u++){var h=i.readUshort(e,n);n+=2;var d=i.readUshort(e,n);n+=2;var f=i.readUshort(e,n);n+=2;var p=i.readUshort(e,n);n+=2;var m=i.readUshort(e,n);n+=2;var g=i.readUshort(e,n);n+=2;var A,v=l[p],y=c+12*a+g;if(0==h)A=i.readUnicode(e,y,m/2);else if(3==h&&0==d)A=i.readUnicode(e,y,m/2);else if(0==d)A=i.readASCII(e,y,m);else if(1==d)A=i.readUnicode(e,y,m/2);else if(3==d)A=i.readUnicode(e,y,m/2);else{if(1!=h)throw"unknown encoding "+d+", platformID: "+h;A=i.readASCII(e,y,m)}var E="p"+h+","+f.toString(16);null==s[E]&&(s[E]={}),s[E][void 0!==v?v:p]=A,s[E]._lang=f}for(var _ in s)if(null!=s[_].postScriptName&&1033==s[_]._lang)return s[_];for(var _ in s)if(null!=s[_].postScriptName&&0==s[_]._lang)return s[_];for(var _ in s)if(null!=s[_].postScriptName&&3084==s[_]._lang)return s[_];for(var _ in s)if(null!=s[_].postScriptName)return s[_];for(var _ in s){o=_;break}return s[o]},t["OS/2"]={},t["OS/2"].parse=function(e,n,r){var i=t._bin.readUshort(e,n);n+=2;var s={};if(0==i)t["OS/2"].version0(e,n,s);else if(1==i)t["OS/2"].version1(e,n,s);else if(2==i||3==i||4==i)t["OS/2"].version2(e,n,s);else{if(5!=i)throw"unknown OS/2 table version: "+i;t["OS/2"].version5(e,n,s)}return s},t["OS/2"].version0=function(e,n,r){var i=t._bin;return r.xAvgCharWidth=i.readShort(e,n),n+=2,r.usWeightClass=i.readUshort(e,n),n+=2,r.usWidthClass=i.readUshort(e,n),n+=2,r.fsType=i.readUshort(e,n),n+=2,r.ySubscriptXSize=i.readShort(e,n),n+=2,r.ySubscriptYSize=i.readShort(e,n),n+=2,r.ySubscriptXOffset=i.readShort(e,n),n+=2,r.ySubscriptYOffset=i.readShort(e,n),n+=2,r.ySuperscriptXSize=i.readShort(e,n),n+=2,r.ySuperscriptYSize=i.readShort(e,n),n+=2,r.ySuperscriptXOffset=i.readShort(e,n),n+=2,r.ySuperscriptYOffset=i.readShort(e,n),n+=2,r.yStrikeoutSize=i.readShort(e,n),n+=2,r.yStrikeoutPosition=i.readShort(e,n),n+=2,r.sFamilyClass=i.readShort(e,n),n+=2,r.panose=i.readBytes(e,n,10),n+=10,r.ulUnicodeRange1=i.readUint(e,n),n+=4,r.ulUnicodeRange2=i.readUint(e,n),n+=4,r.ulUnicodeRange3=i.readUint(e,n),n+=4,r.ulUnicodeRange4=i.readUint(e,n),n+=4,r.achVendID=[i.readInt8(e,n),i.readInt8(e,n+1),i.readInt8(e,n+2),i.readInt8(e,n+3)],n+=4,r.fsSelection=i.readUshort(e,n),n+=2,r.usFirstCharIndex=i.readUshort(e,n),n+=2,r.usLastCharIndex=i.readUshort(e,n),n+=2,r.sTypoAscender=i.readShort(e,n),n+=2,r.sTypoDescender=i.readShort(e,n),n+=2,r.sTypoLineGap=i.readShort(e,n),n+=2,r.usWinAscent=i.readUshort(e,n),n+=2,r.usWinDescent=i.readUshort(e,n),n+2},t["OS/2"].version1=function(e,n,r){var i=t._bin;return n=t["OS/2"].version0(e,n,r),r.ulCodePageRange1=i.readUint(e,n),n+=4,r.ulCodePageRange2=i.readUint(e,n),n+4},t["OS/2"].version2=function(e,n,r){var i=t._bin;return n=t["OS/2"].version1(e,n,r),r.sxHeight=i.readShort(e,n),n+=2,r.sCapHeight=i.readShort(e,n),n+=2,r.usDefault=i.readUshort(e,n),n+=2,r.usBreak=i.readUshort(e,n),n+=2,r.usMaxContext=i.readUshort(e,n),n+2},t["OS/2"].version5=function(e,n,r){var i=t._bin;return n=t["OS/2"].version2(e,n,r),r.usLowerOpticalPointSize=i.readUshort(e,n),n+=2,r.usUpperOpticalPointSize=i.readUshort(e,n),n+2},t.post={},t.post.parse=function(e,n,r){var i=t._bin,s={};return s.version=i.readFixed(e,n),n+=4,s.italicAngle=i.readFixed(e,n),n+=4,s.underlinePosition=i.readShort(e,n),n+=2,s.underlineThickness=i.readShort(e,n),n+=2,s},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var n=e.cmap,r=-1;if(null!=n.p0e4?r=n.p0e4:null!=n.p3e1?r=n.p3e1:null!=n.p1e0?r=n.p1e0:null!=n.p0e3&&(r=n.p0e3),-1==r)throw"no familiar platform and encoding!";var i=n.tables[r];if(0==i.format)return t>=i.map.length?0:i.map[t];if(4==i.format){for(var s=-1,a=0;a<i.endCount.length;a++)if(t<=i.endCount[a]){s=a;break}return-1==s||i.startCount[s]>t?0:65535&(0!=i.idRangeOffset[s]?i.glyphIdArray[t-i.startCount[s]+(i.idRangeOffset[s]>>1)-(i.idRangeOffset.length-s)]:t+i.idDelta[s])}if(12==i.format){if(t>i.groups[i.groups.length-1][1])return 0;for(a=0;a<i.groups.length;a++){var o=i.groups[a];if(o[0]<=t&&t<=o[1])return o[2]+(t-o[0])}return 0}throw"unknown cmap table format "+i.format},t.U.glyphToPath=function(e,n){var r={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[n]){var i=e.SVG.entries[n];return null==i?r:("string"==typeof i&&(i=t.SVG.toPath(i),e.SVG.entries[n]=i),i)}if(e.CFF){var s={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},a=e.CFF,o=e.CFF.Private;if(a.ROS){for(var l=0;a.FDSelect[l+2]<=n;)l+=2;o=a.FDArray[a.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[n],s,a,o,r)}else e.glyf&&t.U._drawGlyf(n,e,r);return r},t.U._drawGlyf=function(e,n,r){var i=n.glyf[e];null==i&&(i=n.glyf[e]=t.glyf._parseGlyf(n,e)),null!=i&&(i.noc>-1?t.U._simpleGlyph(i,r):t.U._compoGlyph(i,n,r))},t.U._simpleGlyph=function(e,n){for(var r=0;r<e.noc;r++){for(var i=0==r?0:e.endPts[r-1]+1,s=e.endPts[r],a=i;a<=s;a++){var o=a==i?s:a-1,l=a==s?i:a+1,c=1&e.flags[a],u=1&e.flags[o],h=1&e.flags[l],d=e.xs[a],f=e.ys[a];if(a==i)if(c){if(!u){t.U.P.moveTo(n,d,f);continue}t.U.P.moveTo(n,e.xs[o],e.ys[o])}else u?t.U.P.moveTo(n,e.xs[o],e.ys[o]):t.U.P.moveTo(n,(e.xs[o]+d)/2,(e.ys[o]+f)/2);c?u&&t.U.P.lineTo(n,d,f):h?t.U.P.qcurveTo(n,d,f,e.xs[l],e.ys[l]):t.U.P.qcurveTo(n,d,f,(d+e.xs[l])/2,(f+e.ys[l])/2)}t.U.P.closePath(n)}},t.U._compoGlyph=function(e,n,r){for(var i=0;i<e.parts.length;i++){var s={cmds:[],crds:[]},a=e.parts[i];t.U._drawGlyf(a.glyphIndex,n,s);for(var o=a.m,l=0;l<s.crds.length;l+=2){var c=s.crds[l],u=s.crds[l+1];r.crds.push(c*o.a+u*o.b+o.tx),r.crds.push(c*o.c+u*o.d+o.ty)}for(l=0;l<s.cmds.length;l++)r.cmds.push(s.cmds[l])}},t.U._getGlyphClass=function(e,n){var r=t._lctf.getInterval(n,e);return-1==r?0:n[r+2]},t.U._applySubs=function(e,n,r,i){for(var s=e.length-n-1,a=0;a<r.tabs.length;a++)if(null!=r.tabs[a]){var o,l=r.tabs[a];if(!l.coverage||-1!=(o=t._lctf.coverageIndex(l.coverage,e[n])))if(1==r.ltype)e[n],1==l.fmt?e[n]=e[n]+l.delta:e[n]=l.newg[o];else if(4==r.ltype)for(var c=l.vals[o],u=0;u<c.length;u++){var h=c[u],d=h.chain.length;if(!(d>s)){for(var f=!0,p=0,m=0;m<d;m++){for(;-1==e[n+p+(1+m)];)p++;h.chain[m]!=e[n+p+(1+m)]&&(f=!1)}if(f){for(e[n]=h.nglyph,m=0;m<d+p;m++)e[n+m+1]=-1;break}}}else if(5==r.ltype&&2==l.fmt)for(var g=t._lctf.getInterval(l.cDef,e[n]),A=l.cDef[g+2],v=l.scset[A],y=0;y<v.length;y++){var E=v[y],_=E.input;if(!(_.length>s)){for(f=!0,m=0;m<_.length;m++){var x=t._lctf.getInterval(l.cDef,e[n+1+m]);if(-1==g&&l.cDef[x+2]!=_[m]){f=!1;break}}if(f){var b=E.substLookupRecords;for(u=0;u<b.length;u+=2)b[u],b[u+1]}}}else if(6==r.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,n-l.backCvg.length))continue;if(!t.U._glsCovered(e,l.inptCvg,n))continue;if(!t.U._glsCovered(e,l.ahedCvg,n+l.inptCvg.length))continue;var S=l.lookupRec;for(y=0;y<S.length;y+=2){g=S[y];var w=i[S[y+1]];t.U._applySubs(e,n+g,w,i)}}}},t.U._glsCovered=function(e,n,r){for(var i=0;i<n.length;i++)if(-1==t._lctf.coverageIndex(n[i],e[r+i]))return!1;return!0},t.U.glyphsToPath=function(e,n,r){for(var i={cmds:[],crds:[]},s=0,a=0;a<n.length;a++){var o=n[a];if(-1!=o){for(var l=a<n.length-1&&-1!=n[a+1]?n[a+1]:0,c=t.U.glyphToPath(e,o),u=0;u<c.crds.length;u+=2)i.crds.push(c.crds[u]+s),i.crds.push(c.crds[u+1]);for(r&&i.cmds.push(r),u=0;u<c.cmds.length;u++)i.cmds.push(c.cmds[u]);r&&i.cmds.push("X"),s+=e.hmtx.aWidth[o],a<n.length-1&&(s+=t.U.getPairAdjustment(e,o,l))}}return i},t.U.P={},t.U.P.moveTo=function(e,t,n){e.cmds.push("M"),e.crds.push(t,n)},t.U.P.lineTo=function(e,t,n){e.cmds.push("L"),e.crds.push(t,n)},t.U.P.curveTo=function(e,t,n,r,i,s,a){e.cmds.push("C"),e.crds.push(t,n,r,i,s,a)},t.U.P.qcurveTo=function(e,t,n,r,i){e.cmds.push("Q"),e.crds.push(t,n,r,i)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,n,r,i,s){for(var a=n.stack,o=n.nStems,l=n.haveWidth,c=n.width,u=n.open,h=0,d=n.x,f=n.y,p=0,m=0,g=0,A=0,v=0,y=0,E=0,_=0,x=0,b=0,S={val:0,size:0};h<e.length;){t.CFF.getCharString(e,h,S);var w=S.val;if(h+=S.size,"o1"==w||"o18"==w)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),o+=a.length>>1,a.length=0,l=!0;else if("o3"==w||"o23"==w)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),o+=a.length>>1,a.length=0,l=!0;else if("o4"==w)a.length>1&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),u&&t.U.P.closePath(s),f+=a.pop(),t.U.P.moveTo(s,d,f),u=!0;else if("o5"==w)for(;a.length>0;)d+=a.shift(),f+=a.shift(),t.U.P.lineTo(s,d,f);else if("o6"==w||"o7"==w)for(var C=a.length,T="o6"==w,M=0;M<C;M++){var I=a.shift();T?d+=I:f+=I,T=!T,t.U.P.lineTo(s,d,f)}else if("o8"==w||"o24"==w){C=a.length;for(var R=0;R+6<=C;)p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),d=g+a.shift(),f=A+a.shift(),t.U.P.curveTo(s,p,m,g,A,d,f),R+=6;"o24"==w&&(d+=a.shift(),f+=a.shift(),t.U.P.lineTo(s,d,f))}else{if("o11"==w)break;if("o1234"==w||"o1235"==w||"o1236"==w||"o1237"==w)"o1234"==w&&(m=f,g=(p=d+a.shift())+a.shift(),b=A=m+a.shift(),y=A,_=f,d=(E=(v=(x=g+a.shift())+a.shift())+a.shift())+a.shift(),t.U.P.curveTo(s,p,m,g,A,x,b),t.U.P.curveTo(s,v,y,E,_,d,f)),"o1235"==w&&(p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),x=g+a.shift(),b=A+a.shift(),v=x+a.shift(),y=b+a.shift(),E=v+a.shift(),_=y+a.shift(),d=E+a.shift(),f=_+a.shift(),a.shift(),t.U.P.curveTo(s,p,m,g,A,x,b),t.U.P.curveTo(s,v,y,E,_,d,f)),"o1236"==w&&(p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),b=A=m+a.shift(),y=A,E=(v=(x=g+a.shift())+a.shift())+a.shift(),_=y+a.shift(),d=E+a.shift(),t.U.P.curveTo(s,p,m,g,A,x,b),t.U.P.curveTo(s,v,y,E,_,d,f)),"o1237"==w&&(p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),x=g+a.shift(),b=A+a.shift(),v=x+a.shift(),y=b+a.shift(),E=v+a.shift(),_=y+a.shift(),Math.abs(E-d)>Math.abs(_-f)?d=E+a.shift():f=_+a.shift(),t.U.P.curveTo(s,p,m,g,A,x,b),t.U.P.curveTo(s,v,y,E,_,d,f));else if("o14"==w){if(a.length>0&&!l&&(c=a.shift()+r.nominalWidthX,l=!0),4==a.length){var B=a.shift(),P=a.shift(),D=a.shift(),L=a.shift(),k=t.CFF.glyphBySE(r,D),F=t.CFF.glyphBySE(r,L);t.U._drawCFF(r.CharStrings[k],n,r,i,s),n.x=B,n.y=P,t.U._drawCFF(r.CharStrings[F],n,r,i,s)}u&&(t.U.P.closePath(s),u=!1)}else if("o19"==w||"o20"==w)a.length%2!=0&&!l&&(c=a.shift()+i.nominalWidthX),o+=a.length>>1,a.length=0,l=!0,h+=o+7>>3;else if("o21"==w)a.length>2&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),f+=a.pop(),d+=a.pop(),u&&t.U.P.closePath(s),t.U.P.moveTo(s,d,f),u=!0;else if("o22"==w)a.length>1&&!l&&(c=a.shift()+i.nominalWidthX,l=!0),d+=a.pop(),u&&t.U.P.closePath(s),t.U.P.moveTo(s,d,f),u=!0;else if("o25"==w){for(;a.length>6;)d+=a.shift(),f+=a.shift(),t.U.P.lineTo(s,d,f);p=d+a.shift(),m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),d=g+a.shift(),f=A+a.shift(),t.U.P.curveTo(s,p,m,g,A,d,f)}else if("o26"==w)for(a.length%2&&(d+=a.shift());a.length>0;)p=d,m=f+a.shift(),d=g=p+a.shift(),f=(A=m+a.shift())+a.shift(),t.U.P.curveTo(s,p,m,g,A,d,f);else if("o27"==w)for(a.length%2&&(f+=a.shift());a.length>0;)m=f,g=(p=d+a.shift())+a.shift(),A=m+a.shift(),d=g+a.shift(),f=A,t.U.P.curveTo(s,p,m,g,A,d,f);else if("o10"==w||"o29"==w){var O="o10"==w?i:r;if(0==a.length);else{var U=a.pop(),N=O.Subrs[U+O.Bias];n.x=d,n.y=f,n.nStems=o,n.haveWidth=l,n.width=c,n.open=u,t.U._drawCFF(N,n,r,i,s),d=n.x,f=n.y,o=n.nStems,l=n.haveWidth,c=n.width,u=n.open}}else if("o30"==w||"o31"==w){var z=a.length,G=(R=0,"o31"==w);for(R+=z-(C=-3&z);R<C;)G?(m=f,g=(p=d+a.shift())+a.shift(),f=(A=m+a.shift())+a.shift(),C-R==5?(d=g+a.shift(),R++):d=g,G=!1):(p=d,m=f+a.shift(),g=p+a.shift(),A=m+a.shift(),d=g+a.shift(),C-R==5?(f=A+a.shift(),R++):f=A,G=!0),t.U.P.curveTo(s,p,m,g,A,d,f),R+=4}else{if("o"==(w+"").charAt(0))throw w;a.push(w)}}}n.x=d,n.y=f,n.nStems=o,n.haveWidth=l,n.width=c,n.open=u};var n=t,r={Typr:n};return e.Typr=n,e.default=r,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr},function(){return function(e){var t=Uint8Array,n=Uint16Array,r=Uint32Array,i=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(e,t){for(var i=new n(31),s=0;s<31;++s)i[s]=t+=1<<e[s-1];var a=new r(i[30]);for(s=1;s<30;++s)for(var o=i[s];o<i[s+1];++o)a[o]=o-i[s]<<5|s;return[i,a]},l=o(i,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=o(s,0)[0],d=new n(32768),f=0;f<32768;++f){var p=(43690&f)>>>1|(21845&f)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[f]=((65280&p)>>>8|(255&p)<<8)>>>1}var m=function(e,t,r){for(var i=e.length,s=0,a=new n(t);s<i;++s)++a[e[s]-1];var o,l=new n(t);for(s=0;s<t;++s)l[s]=l[s-1]+a[s-1]<<1;if(r){o=new n(1<<t);var c=15-t;for(s=0;s<i;++s)if(e[s])for(var u=s<<4|e[s],h=t-e[s],f=l[e[s]-1]++<<h,p=f|(1<<h)-1;f<=p;++f)o[d[f]>>>c]=u}else for(o=new n(i),s=0;s<i;++s)e[s]&&(o[s]=d[l[e[s]-1]++]>>>15-e[s]);return o},g=new t(288);for(f=0;f<144;++f)g[f]=8;for(f=144;f<256;++f)g[f]=9;for(f=256;f<280;++f)g[f]=7;for(f=280;f<288;++f)g[f]=8;var A=new t(32);for(f=0;f<32;++f)A[f]=5;var v=m(g,9,1),y=m(A,5,1),E=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},_=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},x=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},b=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],S=function(e,t,n){var r=new Error(t||b[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,S),!n)throw r;return r},w=function(e,o,l){var u=e.length;if(!u||l&&!l.l&&u<5)return o||new t(0);var d=!o||l,f=!l||l.i;l||(l={}),o||(o=new t(3*u));var p,g=function(e){var n=o.length;if(e>n){var r=new t(Math.max(2*n,e));r.set(o),o=r}},A=l.f||0,b=l.p||0,w=l.b||0,C=l.l,T=l.d,M=l.m,I=l.n,R=8*u;do{if(!C){l.f=A=_(e,b,1);var B=_(e,b+1,3);if(b+=3,!B){var P=e[(H=((p=b)/8|0)+(7&p&&1)+4)-4]|e[H-3]<<8,D=H+P;if(D>u){f&&S(0);break}d&&g(w+P),o.set(e.subarray(H,D),w),l.b=w+=P,l.p=b=8*D;continue}if(1==B)C=v,T=y,M=9,I=5;else if(2==B){var L=_(e,b,31)+257,k=_(e,b+10,15)+4,F=L+_(e,b+5,31)+1;b+=14;for(var O=new t(F),U=new t(19),N=0;N<k;++N)U[a[N]]=_(e,b+3*N,7);b+=3*k;var z=E(U),G=(1<<z)-1,Q=m(U,z,1);for(N=0;N<F;){var H,V=Q[_(e,b,G)];if(b+=15&V,(H=V>>>4)<16)O[N++]=H;else{var j=0,W=0;for(16==H?(W=3+_(e,b,3),b+=2,j=O[N-1]):17==H?(W=3+_(e,b,7),b+=3):18==H&&(W=11+_(e,b,127),b+=7);W--;)O[N++]=j}}var Y=O.subarray(0,L),K=O.subarray(L);M=E(Y),I=E(K),C=m(Y,M,1),T=m(K,I,1)}else S(1);if(b>R){f&&S(0);break}}d&&g(w+131072);for(var q=(1<<M)-1,X=(1<<I)-1,$=b;;$=b){var J=(j=C[x(e,b)&q])>>>4;if((b+=15&j)>R){f&&S(0);break}if(j||S(2),J<256)o[w++]=J;else{if(256==J){$=b,C=null;break}var Z=J-254;if(J>264){var ee=i[N=J-257];Z=_(e,b,(1<<ee)-1)+c[N],b+=ee}var te=T[x(e,b)&X],ne=te>>>4;if(te||S(3),b+=15&te,K=h[ne],ne>3&&(ee=s[ne],K+=x(e,b)&(1<<ee)-1,b+=ee),b>R){f&&S(0);break}d&&g(w+131072);for(var re=w+Z;w<re;w+=4)o[w]=o[w-K],o[w+1]=o[w+1-K],o[w+2]=o[w+2-K],o[w+3]=o[w+3-K];w=re}}l.l=C,l.p=$,l.b=w,C&&(A=1,l.m=M,l.d=T,l.n=I)}while(!A);return w==o.length?o:function(e,i,s){(null==i||i<0)&&(i=0),(null==s||s>e.length)&&(s=e.length);var a=new(e instanceof n?n:e instanceof r?r:t)(s-i);return a.set(e.subarray(i,s)),a}(o,0,w)},C=new t(0),T="undefined"!=typeof TextDecoder&&new TextDecoder;try{T.decode(C,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),n=0;function r(){var e=t.getUint16(n);return n+=2,e}function i(){var e=t.getUint32(n);return n+=4,e}function s(e){A.setUint16(v,e),v+=2}function a(e){A.setUint32(v,e),v+=4}for(var o={signature:i(),flavor:i(),length:i(),numTables:r(),reserved:r(),totalSfntSize:i(),majorVersion:r(),minorVersion:r(),metaOffset:i(),metaLength:i(),metaOrigLength:i(),privOffset:i(),privLength:i()},l=0;Math.pow(2,l)<=o.numTables;)l++;l--;for(var c=16*Math.pow(2,l),u=16*o.numTables-c,h=12,d=[],f=0;f<o.numTables;f++)d.push({tag:i(),offset:i(),compLength:i(),origLength:i(),origChecksum:i()}),h+=16;var p,m=new Uint8Array(12+16*d.length+d.reduce(function(e,t){return e+t.origLength+4},0)),g=m.buffer,A=new DataView(g),v=0;return a(o.flavor),s(o.numTables),s(c),s(l),s(u),d.forEach(function(e){a(e.tag),a(e.origChecksum),a(h),a(e.origLength),e.outOffset=h,(h+=e.origLength)%4!=0&&(h+=4-h%4)}),d.forEach(function(t){var n,r=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var i=new Uint8Array(t.origLength);n=new Uint8Array(r,2),w(n,i)}else i=new Uint8Array(r);m.set(i,t.outOffset);var s=0;(h=t.outOffset+t.origLength)%4!=0&&(s=4-h%4),m.set(new Uint8Array(s).buffer,t.outOffset+t.origLength),p=h+s}),g.slice(0,p)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){const n={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let i;function s(e){if(!i){const e={R:2,L:1,D:4,C:16,U:32,T:8};i=new Map;for(let t in r){let n=0;r[t].split(",").forEach(r=>{let[s,a]=r.split("+");s=parseInt(s,36),a=a?parseInt(a,36):0,i.set(n+=s,e[t]);for(let r=a;r--;)i.set(++n,e[t])})}}return i.get(e)||32}const a=[null,"isol","init","fina","medi"];function o(e){const t=new Uint8Array(e.length);let n=32,r=1,i=-1;for(let a=0;a<e.length;a++){const o=e.codePointAt(a);let l=0|s(o),c=1;8&l||(21&n?22&l?(c=3,1!==r&&3!==r||t[i]++):33&l&&(2!==r&&4!==r||t[i]--):34&n&&(2!==r&&4!==r||t[i]--),r=t[a]=c,n=l,i=a,o>65535&&a++)}return t}function l(t,n){const r=t.GDEF&&t.GDEF.glyphClassDef;return r?e.U._getGlyphClass(n,r):0}function c(...e){for(let t=0;t<e.length;t++)if("number"==typeof e[t])return e[t]}function u(t){const r=Object.create(null),i=t["OS/2"],s=t.hhea,u=t.head.unitsPerEm,h=c(i&&i.sTypoAscender,s&&s.ascender,u),d={unitsPerEm:u,ascender:h,descender:c(i&&i.sTypoDescender,s&&s.descender,0),capHeight:c(i&&i.sCapHeight,h),xHeight:c(i&&i.sxHeight,h),lineGap:c(i&&i.sTypoLineGap,s&&s.lineGap),supportsCodePoint:n=>e.U.codeToGlyph(t,n)>0,forEachGlyph(i,s,c,u){let h=0;const f=1/d.unitsPerEm*s,p=function(t,n){const r=[];for(let i=0;i<n.length;i++){const s=n.codePointAt(i);s>65535&&i++,r.push(e.U.codeToGlyph(t,s))}const i=t.GSUB;if(i){const{lookupList:t,featureList:s}=i;let l;const c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,u=[];s.forEach(i=>{if(c.test(i.tag))for(let s=0;s<i.tab.length;s++){if(u[i.tab[s]])continue;u[i.tab[s]]=!0;const c=t[i.tab[s]],h=/^(isol|init|fina|medi)$/.test(i.tag);h&&!l&&(l=o(n));for(let n=0;n<r.length;n++)l&&h&&a[l[n]]!==i.tag||e.U._applySubs(r,n,c,t)}})}return r}(t,i);let m=0;const g=function(t,n){const r=new Int16Array(3*n.length);let i=0;for(;i<n.length;i++){const c=n[i];if(-1===c)continue;r[3*i+2]=t.hmtx.aWidth[c];const u=t.GPOS;if(u){const h=u.lookupList;for(let u=0;u<h.length;u++){const d=h[u];for(let u=0;u<d.tabs.length;u++){const h=d.tabs[u];if(1===d.ltype){if(-1!==e._lctf.coverageIndex(h.coverage,c)&&h.pos){o(h.pos,i);break}}else if(2===d.ltype){let t=null,r=s();if(-1!==r){const s=e._lctf.coverageIndex(h.coverage,n[r]);if(-1!==s){if(1===h.fmt){const e=h.pairsets[s];for(let n=0;n<e.length;n++)e[n].gid2===c&&(t=e[n])}else if(2===h.fmt){const i=e.U._getGlyphClass(n[r],h.classDef1),s=e.U._getGlyphClass(c,h.classDef2);t=h.matrix[i][s]}if(t){t.val1&&o(t.val1,r),t.val2&&o(t.val2,i);break}}}}else if(4===d.ltype){const t=e._lctf.coverageIndex(h.markCoverage,c);if(-1!==t){const o=s(a),l=-1===o?-1:e._lctf.coverageIndex(h.baseCoverage,n[o]);if(-1!==l){const e=h.markArray[t],n=h.baseArray[l][e.markClass];r[3*i]=n.x-e.x+r[3*o]-r[3*o+2],r[3*i+1]=n.y-e.y+r[3*o+1];break}}}else if(6===d.ltype){const a=e._lctf.coverageIndex(h.mark1Coverage,c);if(-1!==a){const o=s();if(-1!==o){const s=n[o];if(3===l(t,s)){const t=e._lctf.coverageIndex(h.mark2Coverage,s);if(-1!==t){const e=h.mark1Array[a],n=h.mark2Array[t][e.markClass];r[3*i]=n.x-e.x+r[3*o]-r[3*o+2],r[3*i+1]=n.y-e.y+r[3*o+1];break}}}}}}}}else if(t.kern&&!t.cff){const e=s();if(-1!==e){const i=t.kern.glyph1.indexOf(n[e]);if(-1!==i){const n=t.kern.rval[i].glyph2.indexOf(c);-1!==n&&(r[3*e+2]+=t.kern.rval[i].vals[n])}}}}return r;function s(e){for(let t=i-1;t>=0;t--)if(-1!==n[t]&&(!e||e(n[t])))return t;return-1}function a(e){return 1===l(t,e)}function o(e,t){for(let n=0;n<3;n++)r[3*t+n]+=e[n]||0}}(t,p);return p.forEach((a,o)=>{if(-1!==a){let i=r[a];if(!i){const{cmds:s,crds:o}=e.U.glyphToPath(t,a);let l,c,u,h,d="",f=0;for(let e=0,t=s.length;e<t;e++){const t=n[s[e]];d+=s[e];for(let e=1;e<=t;e++)d+=(e>1?",":"")+o[f++]}if(o.length){l=c=1/0,u=h=-1/0;for(let e=0,t=o.length;e<t;e+=2){let t=o[e],n=o[e+1];t<l&&(l=t),n<c&&(c=n),t>u&&(u=t),n>h&&(h=n)}}else l=u=c=h=0;i=r[a]={index:a,advanceWidth:t.hmtx.aWidth[a],xMin:l,yMin:c,xMax:u,yMax:h,path:d}}u.call(null,i,h+g[3*o]*f,g[3*o+1]*f,m),h+=g[3*o+2]*f,c&&(h+=c*s)}m+=i.codePointAt(m)>65535?2:1}),h}};return d}return function(n){const r=new Uint8Array(n,0,4),i=e._bin.readASCII(r,0,4);if("wOFF"===i)n=t(n);else if("wOF2"===i)throw new Error("woff2 fonts not supported");return u(e.parse(n)[0])}}],init:(e,t,n)=>n(e(),t())});const tI=OM({name:"FontResolver",dependencies:[function(e,t){const n=Object.create(null),r=Object.create(null);function i(t,i){let s=n[t];s?i(s):r[t]?r[t].push(i):(r[t]=[i],function(t,n){const r=e=>{};try{const i=new XMLHttpRequest;i.open("get",t,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)new Error(i.statusText);else if(i.status>0)try{const r=e(i.response);r.src=t,n(r)}catch(e){}},i.onerror=r,i.send()}catch(e){}}(t,e=>{e.src=t,n[t]=e,r[t].forEach(t=>t(e)),delete r[t]}))}return function(e,r,{lang:s,fonts:a=[],style:o="normal",weight:l="normal",unicodeFontsURL:c}={}){const u=new Uint8Array(e.length),h=[];e.length||m();const d=new Map,f=[];if("italic"!==o&&(o="normal"),"number"!=typeof l&&(l="bold"===l?700:400),a&&!Array.isArray(a)&&(a=[a]),(a=a.slice().filter(e=>!e.lang||e.lang.test(s)).reverse()).length){const t=1,r=2;let s=0;!function o(l=0){for(let c=l,p=e.length;c<p;c++){const l=e.codePointAt(c);if(s===t&&h[u[c-1]].supportsCodePoint(l)||c>0&&/\s/.test(e[c]))u[c]=u[c-1],s===r&&(f[f.length-1][1]=c);else for(let e=u[c],p=a.length;e<=p;e++)if(e===p){(s===r?f[f.length-1]:f[f.length]=[c,c])[1]=c,s=r}else{u[c]=e;const{src:r,unicodeRange:f}=a[e];if(!f||g(l,f)){const e=n[r];if(!e)return void i(r,()=>{o(c)});if(e.supportsCodePoint(l)){let n=d.get(e);"number"!=typeof n&&(n=h.length,h.push(e),d.set(e,n)),u[c]=n,s=t;break}}}l>65535&&c+1<p&&(u[c+1]=u[c],c++,s===r&&(f[f.length-1][1]=c))}p()}()}else f.push([0,e.length-1]),p();function p(){if(f.length){const n=f.map(t=>e.substring(t[0],t[1]+1)).join("\n");t.getFontsForString(n,{lang:s||void 0,style:o,weight:l,dataUrl:c}).then(({fontUrls:e,chars:t})=>{const n=h.length;let r=0;f.forEach(e=>{for(let i=0,s=e[1]-e[0];i<=s;i++)u[e[0]+i]=t[r++]+n;r++});let s=0;e.forEach((t,r)=>{i(t,t=>{h[r+n]=t,++s===e.length&&m()})})})}else m()}function m(){r({chars:u,fonts:h})}function g(e,t){for(let n=0;n<t.length;n++){const[r,i=r]=t[n];if(r<=e&&e<=i)return!0}return!1}}},eI,function(){return function(e){var t=function(){this.buckets=new Map};t.prototype.add=function(e){var t=e>>5;this.buckets.set(t,(this.buckets.get(t)||0)|1<<(31&e))},t.prototype.has=function(e){var t=this.buckets.get(e>>5);return void 0!==t&&!!(t&1<<(31&e))},t.prototype.serialize=function(){var e=[];return this.buckets.forEach(function(t,n){e.push((+n).toString(36)+":"+t.toString(36))}),e.join(",")},t.prototype.deserialize=function(e){var t=this;this.buckets.clear(),e.split(",").forEach(function(e){var n=e.split(":");t.buckets.set(parseInt(n[0],36),parseInt(n[1],36))})};var n=Math.pow(2,8),r=n-1,i=~r;function s(e){var t=function(e){return e&i}(e).toString(16),r=function(e){return(e&i)+n-1}(e).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+t+"-"+r+".json"}function a(e,t){var n=e&r,i=t.codePointAt(n/6|0);return!!((i=(i||48)-48)&1<<n%6)}function o(e,t){!function(e,t){var n;(n=e,n.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(e){return e.split("-").map(function(e){return parseInt(e.trim(),16)})})).forEach(function(e){var n=e[0],r=e[1];void 0===r&&(r=n),t(n,r)})}(e,function(e,n){for(var r=e;r<=n;r++)t(r)})}var l={},c={},u=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(e){var n=u.get(e);return n||(n=new t,o(e.ranges,function(e){return n.add(e)}),u.set(e,n)),n}var f,p=new Map;function m(e,t,n){return e[t]?t:e[n]?n:function(e){for(var t in e)return t}(e)}function g(e,t){var n=t;if(!e.includes(n)){n=1/0;for(var r=0;r<e.length;r++)Math.abs(e[r]-t)<Math.abs(n-t)&&(n=e[r])}return n}function A(e){return f||(f=new Set,o("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(e){f.add(e)})),f.has(e)}return e.CodePointSet=t,e.clearCache=function(){l={},c={}},e.getFontsForString=function(e,t){void 0===t&&(t={});var n,r=t.lang;void 0===r&&(r=/\p{Script=Hangul}/u.test(n=e)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(n)?"ja":"en");var i=t.category;void 0===i&&(i="sans-serif");var o=t.style;void 0===o&&(o="normal");var u=t.weight;void 0===u&&(u=400);var f=(t.dataUrl||h).replace(/\/$/g,""),v=new Map,y=new Uint8Array(e.length),E={},_={},x=new Array(e.length),b=new Map,S=!1;function w(e){var t=p.get(e);return t||(t=fetch(f+"/"+e).then(function(e){if(!e.ok)throw new Error(e.statusText);return e.json().then(function(e){if(!Array.isArray(e)||1!==e[0])throw new Error("Incorrect schema version; need 1, got "+e[0]);return e[1]})}).catch(function(t){if(f!==h)return S||(S=!0),f=h,p.delete(e),w(e);throw t}),p.set(e,t)),t}for(var C=function(t){var n=e.codePointAt(t),r=s(n);x[t]=r,l[r]||b.has(r)||b.set(r,w(r).then(function(e){l[r]=e})),n>65535&&(t++,T=t)},T=0;T<e.length;T++)C(T);return Promise.all(b.values()).then(function(){b.clear();for(var t=function(t){var i=e.codePointAt(t),s=null,o=l[x[t]],u=void 0;for(var h in o){var d=_[h];if(void 0===d&&(d=_[h]=new RegExp(h).test(r||"en")),d){for(var f in u=h,o[h])if(a(i,o[h][f])){s=f;break}break}}if(!s)e:for(var p in o)if(p!==u)for(var m in o[p])if(a(i,o[p][m])){s=m;break e}s||(s="latin"),x[t]=s,c[s]||b.has(s)||b.set(s,w("font-meta/"+s+".json").then(function(e){c[s]=e})),i>65535&&(t++,n=t)},n=0;n<e.length;n++)t(n);return Promise.all(b.values())}).then(function(){for(var t,n=null,r=0;r<e.length;r++){var s=e.codePointAt(r);if(n&&(A(s)||d(n).has(s)))y[r]=y[r-1];else{n=c[x[r]];var a=E[n.id];if(!a){var l=n.typeforms,h=m(l,i,"sans-serif"),p=m(l[h],o,"normal"),_=g(null===(t=l[h])||void 0===t?void 0:t[p],u);a=E[n.id]=f+"/font-files/"+n.id+"/"+h+"."+p+"."+_+".woff"}var b=v.get(a);null==b&&(b=v.size,v.set(a,b)),y[r]=b}s>65535&&(r++,y[r]=y[r-1])}return{fontUrls:Array.from(v.keys()),chars:y}})},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,n)=>e(t,n())});const nI=()=>(self.performance||Date).now(),rI=zM();let iI;const sI=[];let aI=0;function oI(){const e=nI();for(;sI.length&&nI()-e<5;)sI.shift()();aI=sI.length?setTimeout(oI,0):0}const lI=(...e)=>new Promise((t,n)=>{sI.push(()=>{const r=nI();try{rI.webgl.generateIntoCanvas(...e),t({timing:nI()-r})}catch(e){n(e)}}),aI||(aI=setTimeout(oI,0))}),cI=4,uI=2e3,hI={};let dI=0;function fI(e,t,n,r,i,s,a,o,l,c){const u="TroikaTextSDFGenerator_JS_"+dI++%cI;let h=hI[u];return h||(h=hI[u]={workerModule:OM({name:u,workerId:u,dependencies:[zM,nI],init(e,t){const n=e().javascript.generate;return function(...e){const r=t();return{textureData:n(...e),timing:t()-r}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(e,t,n,r,i,s).then(({textureData:n,timing:r})=>{const i=nI(),s=new Uint8Array(4*n.length);for(let e=0;e<n.length;e++)s[4*e+c]=n[e];return rI.webglUtils.renderImageData(a,s,o,l,e,t,1<<3-c),r+=nI()-i,0===--h.requests&&(h.idleTimer=setTimeout(()=>{!function(e){kM[e]&&kM[e].forEach(function(e){e()}),LM[e]&&(LM[e].terminate(),delete LM[e])}(u)},uI)),{timing:r}})}const pI=rI.webglUtils.resizeWebGLCanvasWithoutClearing,mI={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},gI=new $r;function AI(){return(self.performance||Date).now()}const vI=Object.create(null);function yI(e,t){e=function(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}({},e);const n=AI(),{defaultFontURL:r}=mI,i=[];if(r&&i.push({label:"default",src:xI(r)}),e.font&&i.push({label:"user",src:xI(e.font)}),e.font=i,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||mI.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||mI.unicodeFontsURL,null!=e.colorRanges){let t={};for(let n in e.colorRanges)if(e.colorRanges.hasOwnProperty(n)){let r=e.colorRanges[n];"number"!=typeof r&&(r=gI.set(r).getHex()),t[n]=r}e.colorRanges=t}Object.freeze(e);const{textureWidth:s,sdfExponent:a}=mI,{sdfGlyphSize:o}=e,l=s/o*4;let c=vI[o];if(!c){const e=document.createElement("canvas");e.width=s,e.height=256*o/l,c=vI[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:e,sdfTexture:new Cn(e,void 0,void 0,void 0,ie,ie),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,function(e){const t=e.sdfCanvas;t.addEventListener("webglcontextlost",t=>{t.preventDefault(),e.contextLost=!0}),t.addEventListener("webglcontextrestored",t=>{e.contextLost=!1;const n=[];e.glyphsByFont.forEach(t=>{t.forEach(t=>{n.push(EI(t,e,!0))})}),Promise.all(n).then(()=>{bI(e),e.sdfTexture.needsUpdate=!0})})}(c)}const{sdfTexture:u,sdfCanvas:h}=c;wI(e).then(r=>{const{glyphIds:i,glyphFontIndices:d,fontData:f,glyphPositions:p,fontSize:m,timings:g}=r,A=[],v=new Float32Array(4*i.length);let y=0,E=0;const _=AI(),x=f.map(e=>{let t=c.glyphsByFont.get(e.src);return t||c.glyphsByFont.set(e.src,t=new Map),t});i.forEach((e,t)=>{const n=d[t],{src:s,unitsPerEm:a}=f[n];let l=x[n].get(e);if(!l){const{path:t,pathBounds:i}=r.glyphData[s][e],a=Math.max(i[2]-i[0],i[3]-i[1])/o*(mI.sdfMargin*o+.5),u=c.glyphCount++,h=[i[0]-a,i[1]-a,i[2]+a,i[3]+a];x[n].set(e,l={path:t,atlasIndex:u,sdfViewBox:h}),A.push(l)}const{sdfViewBox:u}=l,h=p[E++],g=p[E++],_=m/a;v[y++]=h+u[0]*_,v[y++]=g+u[1]*_,v[y++]=h+u[2]*_,v[y++]=g+u[3]*_,i[t]=l.atlasIndex}),g.quads=(g.quads||0)+(AI()-_);const b=AI();g.sdf={};const S=h.height,w=Math.ceil(c.glyphCount/l),C=Math.pow(2,Math.ceil(Math.log2(w*o)));C>S&&(pI(h,s,C),u.dispose()),Promise.all(A.map(t=>EI(t,c,e.gpuAccelerateSDF).then(({timing:e})=>{g.sdf[t.atlasIndex]=e}))).then(()=>{A.length&&!c.contextLost&&(bI(c),u.needsUpdate=!0),g.sdfTotal=AI()-b,g.total=AI()-n,t(Object.freeze({parameters:e,sdfTexture:u,sdfGlyphSize:o,sdfExponent:a,glyphBounds:v,glyphAtlasIndices:i,glyphColors:r.glyphColors,caretPositions:r.caretPositions,chunkedBounds:r.chunkedBounds,ascender:r.ascender,descender:r.descender,lineHeight:r.lineHeight,capHeight:r.capHeight,xHeight:r.xHeight,topBaseline:r.topBaseline,blockBounds:r.blockBounds,visibleBounds:r.visibleBounds,timings:r.timings}))})}),Promise.resolve().then(()=>{var e;c.contextLost||(e=h)._warm||(rI.webgl.isSupported(e),e._warm=!0)})}function EI({path:e,atlasIndex:t,sdfViewBox:n},{sdfGlyphSize:r,sdfCanvas:i,contextLost:s},a){if(s)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:l}=mI,c=Math.max(n[2]-n[0],n[3]-n[1]),u=Math.floor(t/4);return function(e,t,n,r,i,s,a,o,l,c,u=!0){return u?lI(e,t,n,r,i,s,a,o,l,c).then(null,u=>(iI||(iI=!0),fI(e,t,n,r,i,s,a,o,l,c))):fI(e,t,n,r,i,s,a,o,l,c)}(r,r,e,n,c,l,i,u%(o/r)*r,Math.floor(u/(o/r))*r,t%4,a)}let _I;function xI(e){return _I||(_I="undefined"==typeof document?{}:document.createElement("a")),_I.href=e,_I.href}function bI(e){if("function"!=typeof createImageBitmap){const{sdfCanvas:t,sdfTexture:n}=e,{width:r,height:i}=t,s=e.sdfCanvas.getContext("webgl");let a=n.image.data;a&&a.length===r*i*4||(a=new Uint8Array(r*i*4),n.image={width:r,height:i,data:a},n.flipY=!1,n.isDataTexture=!0),s.readPixels(0,0,r,i,s.RGBA,s.UNSIGNED_BYTE,a)}}const SI=OM({name:"Typesetter",dependencies:[function(e,t){const n=1/0,r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,i="[^\\S\\u00A0]",s=new RegExp(`${i}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:a="",font:h,lang:d,sdfGlyphSize:f=64,fontSize:p=400,fontWeight:m=1,fontStyle:g="normal",letterSpacing:A=0,lineHeight:v="normal",maxWidth:y=n,direction:E,textAlign:_="left",textIndent:x=0,whiteSpace:b="normal",overflowWrap:S="normal",anchorX:w=0,anchorY:C=0,metricsOnly:T=!1,unicodeFontsURL:M,preResolvedFonts:I=null,includeCaretPositions:R=!1,chunkedBoundsSize:B=8192,colorRanges:P=null},D){const L=c(),k={fontLoad:0,typesetting:0};a.indexOf("\r")>-1&&(a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),p=+p,A=+A,y=+y,v=v||"normal",x=+x,function({text:t,lang:n,fonts:r,style:i,weight:s,preResolvedFonts:a,unicodeFontsURL:o},l){const c=({chars:e,fonts:t})=>{let n,r;const i=[];for(let s=0;s<e.length;s++)e[s]!==r?(r=e[s],i.push(n={start:s,end:s,fontObj:t[e[s]]})):n.end=s;l(i)};a?c(a):e(t,c,{lang:n,fonts:r,style:i,weight:s,unicodeFontsURL:o})}({text:a,lang:d,style:g,weight:m,fonts:"string"==typeof h?[{src:h}]:h,unicodeFontsURL:M,preResolvedFonts:I},e=>{k.fontLoad=c()-L;const h=isFinite(y);let d=null,f=null,m=null,g=null,M=null,I=null,F=null,O=null,U=0,N=0,z="nowrap"!==b;const G=new Map,Q=c();let H=x,V=0,j=new u;const W=[j];e.forEach(e=>{const{fontObj:t}=e,{ascender:n,descender:o,unitsPerEm:l,lineGap:c,capHeight:d,xHeight:f}=t;let m=G.get(t);if(!m){const e=p/l,r="normal"===v?(n-o+c)*e:v*p,i=(r-(n-o)*e)/2,s=Math.min(r,(n-o)*e),a=(n+o)/2*e+s/2;m={index:G.size,src:t.src,fontObj:t,fontSizeMult:e,unitsPerEm:l,ascender:n*e,descender:o*e,capHeight:d*e,xHeight:f*e,lineHeight:r,baseline:-i-n*e,caretTop:a,caretBottom:a-s},G.set(t,m)}const{fontSizeMult:g}=m,E=a.slice(e.start,e.end+1);let _,b;t.forEachGlyph(E,p,A,(t,n,o,l)=>{n+=V,l+=e.start,_=n,b=t;const c=a.charAt(l),d=t.advanceWidth*g,f=j.count;let v;if("isEmpty"in t||(t.isWhitespace=!!c&&new RegExp(i).test(c),t.canBreakAfter=!!c&&s.test(c),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax||r.test(c)),t.isWhitespace||t.isEmpty||N++,z&&h&&!t.isWhitespace&&n+d+H>y&&f){if(j.glyphAt(f-1).glyphObj.canBreakAfter)v=new u,H=-n;else for(let e=f;e--;){if(0===e&&"break-word"===S){v=new u,H=-n;break}if(j.glyphAt(e).glyphObj.canBreakAfter){v=j.splitAt(e+1);const t=v.glyphAt(0).x;H-=t;for(let e=v.count;e--;)v.glyphAt(e).x-=t;break}}v&&(j.isSoftWrapped=!0,j=v,W.push(j),U=y)}let E=j.glyphAt(j.count);E.glyphObj=t,E.x=n+H,E.y=o,E.width=d,E.charIndex=l,E.fontData=m,"\n"===c&&(j=new u,W.push(j),H=-(n+d+A*p)+x)}),V=_+b.advanceWidth*g+A*p});let Y=0;W.forEach(e=>{let t=!0;for(let n=e.count;n--;){const r=e.glyphAt(n);t&&!r.glyphObj.isWhitespace&&(e.width=r.x+r.width,e.width>U&&(U=e.width),t=!1);let{lineHeight:i,capHeight:s,xHeight:a,baseline:o}=r.fontData;i>e.lineHeight&&(e.lineHeight=i);const l=o-e.baseline;l<0&&(e.baseline+=l,e.cap+=l,e.ex+=l),e.cap=Math.max(e.cap,e.baseline+s),e.ex=Math.max(e.ex,e.baseline+a)}e.baseline-=Y,e.cap-=Y,e.ex-=Y,Y+=e.lineHeight});let K=0,q=0;if(w&&("number"==typeof w?K=-w:"string"==typeof w&&(K=-U*("left"===w?0:"center"===w?.5:"right"===w?1:o(w)))),C&&("number"==typeof C?q=-C:"string"==typeof C&&(q="top"===C?0:"top-baseline"===C?-W[0].baseline:"top-cap"===C?-W[0].cap:"top-ex"===C?-W[0].ex:"middle"===C?Y/2:"bottom"===C?Y:"bottom-baseline"===C?-W[W.length-1].baseline:o(C)*Y)),!T){const e=t.getEmbeddingLevels(a,E);d=new Uint16Array(N),f=new Uint8Array(N),m=new Float32Array(2*N),g={},F=[n,n,-1/0,-1/0],O=[],R&&(I=new Float32Array(4*a.length)),P&&(M=new Uint8Array(3*N));let r,i,s=0,o=-1,c=-1;if(W.forEach((u,h)=>{let{count:p,width:A}=u;if(p>0){let h=0;for(let e=p;e--&&u.glyphAt(e).glyphObj.isWhitespace;)h++;let v=0,y=0;if("center"===_)v=(U-A)/2;else if("right"===_)v=U-A;else if("justify"===_&&u.isSoftWrapped){let e=0;for(let t=p-h;t--;)u.glyphAt(t).glyphObj.isWhitespace&&e++;y=(U-A)/e}if(y||v){let e=0;for(let t=0;t<p;t++){let n=u.glyphAt(t);const r=n.glyphObj;n.x+=v+e,0!==y&&r.isWhitespace&&t<p-h&&(e+=y,n.width+=y)}}const E=t.getReorderSegments(a,e,u.glyphAt(0).charIndex,u.glyphAt(u.count-1).charIndex);for(let e=0;e<E.length;e++){const[t,n]=E[e];let r=1/0,i=-1/0;for(let e=0;e<p;e++)if(u.glyphAt(e).charIndex>=t){let t=e,s=e;for(;s<p;s++){let e=u.glyphAt(s);if(e.charIndex>n)break;s<p-h&&(r=Math.min(r,e.x),i=Math.max(i,e.x+e.width))}for(let e=t;e<s;e++){const t=u.glyphAt(e);t.x=i-(t.x+t.width-r)}break}}let x;const b=e=>x=e;for(let h=0;h<p;h++){const p=u.glyphAt(h);x=p.glyphObj;const A=x.index,v=1&e.levels[p.charIndex];if(v){const e=t.getMirroredCharacter(a[p.charIndex]);e&&p.fontData.fontObj.forEachGlyph(e,0,0,b)}if(R){const{charIndex:e,fontData:t}=p,n=p.x+K,r=p.x+p.width+K;I[4*e]=v?r:n,I[4*e+1]=v?n:r,I[4*e+2]=u.baseline+t.caretBottom+q,I[4*e+3]=u.baseline+t.caretTop+q;const i=e-o;i>1&&l(I,o,i),o=e}if(P){const{charIndex:e}=p;for(;e>c;)c++,P.hasOwnProperty(c)&&(i=P[c])}if(!x.isWhitespace&&!x.isEmpty){const e=s++,{fontSizeMult:t,src:a,index:o}=p.fontData,l=g[a]||(g[a]={});l[A]||(l[A]={path:x.path,pathBounds:[x.xMin,x.yMin,x.xMax,x.yMax]});const c=p.x+K,h=p.y+u.baseline+q;m[2*e]=c,m[2*e+1]=h;const v=c+x.xMin*t,y=h+x.yMin*t,E=c+x.xMax*t,_=h+x.yMax*t;v<F[0]&&(F[0]=v),y<F[1]&&(F[1]=y),E>F[2]&&(F[2]=E),_>F[3]&&(F[3]=_),e%B===0&&(r={start:e,end:e,rect:[n,n,-1/0,-1/0]},O.push(r)),r.end++;const b=r.rect;if(v<b[0]&&(b[0]=v),y<b[1]&&(b[1]=y),E>b[2]&&(b[2]=E),_>b[3]&&(b[3]=_),d[e]=A,f[e]=o,P){const t=3*e;M[t]=i>>16&255,M[t+1]=i>>8&255,M[t+2]=255&i}}}}}),I){const e=a.length-o;e>1&&l(I,o,e)}}const X=[];G.forEach(({index:e,src:t,unitsPerEm:n,ascender:r,descender:i,lineHeight:s,capHeight:a,xHeight:o})=>{X[e]={src:t,unitsPerEm:n,ascender:r,descender:i,lineHeight:s,capHeight:a,xHeight:o}}),k.typesetting=c()-Q,D({glyphIds:d,glyphFontIndices:f,glyphPositions:m,glyphData:g,fontData:X,caretPositions:I,glyphColors:M,chunkedBounds:O,fontSize:p,topBaseline:q+W[0].baseline,blockBounds:[K,q-Y,K+U,q],visibleBounds:F,timings:k})})}function o(e){let t=e.match(/^([\d.]+)%$/),n=t?parseFloat(t[1]):NaN;return isNaN(n)?0:n/100}function l(e,t,n){const r=e[4*t],i=e[4*t+1],s=e[4*t+2],a=e[4*t+3],o=(i-r)/n;for(let i=0;i<n;i++){const n=4*(t+i);e[n]=r+o*i,e[n+1]=r+o*(i+1),e[n+2]=s,e[n+3]=a}}function c(){return(self.performance||Date).now()}function u(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return u.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(e){let t=u.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new u;return t.data=this.data.splice(e*h.length),t}},u.flyweight=h.reduce((e,t,n,r)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*h.length+n]},set(e){this.data[this.index*h.length+n]=e}}),e),{data:null,index:0}),{typeset:a,measure:function(e,t){a({...e,metricsOnly:!0},e=>{const[n,r,i,s]=e.blockBounds;t({width:i-n,height:s-r})})}}},tI,function(){var e=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(t).forEach(function(e,t){n[e]=1<<t+1,r[n[e]]=e}),Object.freeze(n);var i=n.LRI|n.RLI|n.FSI,s=n.L|n.R|n.AL,a=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,o=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,l=n.S|n.WS|n.B|i|n.PDI|o,c=null;function u(e){return function(){if(!c){c=new Map;var e=function(e){if(t.hasOwnProperty(e)){var r=0;t[e].split(",").forEach(function(t){var i=t.split("+"),s=i[0],a=i[1];s=parseInt(s,36),a=a?parseInt(a,36):0,c.set(r+=s,n[e]);for(var o=0;o<a;o++)c.set(++r,n[e])})}};for(var r in t)e(r)}}(),c.get(e.codePointAt(0))||n.L}var h,d,f,p="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",m="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function g(e,t){var n,r=0,i=new Map,s=t&&new Map;return e.split(",").forEach(function e(a){if(-1!==a.indexOf("+"))for(var o=+a;o--;)e(n);else{n=a;var l=a.split(">"),c=l[0],u=l[1];c=String.fromCodePoint(r+=parseInt(c,36)),u=String.fromCodePoint(r+=parseInt(u,36)),i.set(c,u),t&&s.set(u,c)}}),{map:i,reverseMap:s}}function A(){if(!h){var e=g(p,!0),t=e.map,n=e.reverseMap;h=t,d=n,f=g(m,!1).map}}function v(e){return A(),h.get(e)||null}function y(e){return A(),d.get(e)||null}function E(e){return A(),f.get(e)||null}var _=n.L,x=n.R,b=n.EN,S=n.ES,w=n.ET,C=n.AN,T=n.CS,M=n.B,I=n.S,R=n.ON,B=n.BN,P=n.NSM,D=n.AL,L=n.LRO,k=n.RLO,F=n.LRE,O=n.RLE,U=n.PDF,N=n.LRI,z=n.RLI,G=n.FSI,Q=n.PDI;var H;function V(e){return function(){if(!H){var e=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach(function(e,n){t.set(n,e)}),H=t}}(),H.get(e)||null}function j(e,t,n,r){var i=e.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);var s=[];return t.paragraphs.forEach(function(i){var a=Math.max(n,i.start),o=Math.min(r,i.end);if(a<o){for(var c=t.levels.slice(a,o+1),h=o;h>=a&&u(e[h])&l;h--)c[h]=i.level;for(var d=i.level,f=1/0,p=0;p<c.length;p++){var m=c[p];m>d&&(d=m),m<f&&(f=1|m)}for(var g=d;g>=f;g--)for(var A=0;A<c.length;A++)if(c[A]>=g){for(var v=A;A+1<c.length&&c[A+1]>=g;)A++;A>v&&s.push([v+a,A+a])}}}),s}function W(e,t,n,r){for(var i=j(e,t,n,r),s=[],a=0;a<e.length;a++)s[a]=a;return i.forEach(function(e){for(var t=e[0],n=e[1],r=s.slice(t,n+1),i=r.length;i--;)s[n-i]=r[i]}),s}return e.closingToOpeningBracket=y,e.getBidiCharType=u,e.getBidiCharTypeName=function(e){return r[u(e)]},e.getCanonicalBracket=E,e.getEmbeddingLevels=function(e,t){for(var n=new Uint32Array(e.length),r=0;r<e.length;r++)n[r]=u(e[r]);var c=new Map;function h(e,t){var r=n[e];n[e]=t,c.set(r,c.get(r)-1),r&a&&c.set(a,c.get(a)-1),c.set(t,(c.get(t)||0)+1),t&a&&c.set(a,(c.get(a)||0)+1)}for(var d=new Uint8Array(e.length),f=new Map,p=[],m=null,g=0;g<e.length;g++)m||p.push(m={start:g,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:Gt(g,!1)}),n[g]&M&&(m.end=g,m=null);for(var A=O|F|k|L|i|Q|U|M,H=function(e){return e+(1&e?1:2)},V=function(e){return e+(1&e?2:1)},j=0;j<p.length;j++){var W=[{_level:(m=p[j]).level,_override:0,_isolate:0}],Y=void 0,K=0,q=0,X=0;c.clear();for(var $=m.start;$<=m.end;$++){var J=n[$];if(Y=W[W.length-1],c.set(J,(c.get(J)||0)+1),J&a&&c.set(a,(c.get(a)||0)+1),J&A)if(J&(O|F)){d[$]=Y._level;var Z=(J===O?V:H)(Y._level);Z<=125&&!K&&!q?W.push({_level:Z,_override:0,_isolate:0}):K||q++}else if(J&(k|L)){d[$]=Y._level;var ee=(J===k?V:H)(Y._level);ee<=125&&!K&&!q?W.push({_level:ee,_override:J&k?x:_,_isolate:0}):K||q++}else if(J&i){J&G&&(J=1===Gt($+1,!0)?z:N),d[$]=Y._level,Y._override&&h($,Y._override);var te=(J===z?V:H)(Y._level);te<=125&&0===K&&0===q?(X++,W.push({_level:te,_override:0,_isolate:1,_isolInitIndex:$})):K++}else if(J&Q){if(K>0)K--;else if(X>0){for(q=0;!W[W.length-1]._isolate;)W.pop();var ne=W[W.length-1]._isolInitIndex;null!=ne&&(f.set(ne,$),f.set($,ne)),W.pop(),X--}Y=W[W.length-1],d[$]=Y._level,Y._override&&h($,Y._override)}else J&U?(0===K&&(q>0?q--:!Y._isolate&&W.length>1&&(W.pop(),Y=W[W.length-1])),d[$]=Y._level):J&M&&(d[$]=m.level);else d[$]=Y._level,Y._override&&J!==B&&h($,Y._override)}for(var re=[],ie=null,se=m.start;se<=m.end;se++){var ae=n[se];if(!(ae&o)){var oe=d[se],le=ae&i,ce=ae===Q;ie&&oe===ie._level?(ie._end=se,ie._endsWithIsolInit=le):re.push(ie={_start:se,_end:se,_level:oe,_startsWithPDI:ce,_endsWithIsolInit:le})}}for(var ue=[],he=0;he<re.length;he++){var de=re[he];if(!de._startsWithPDI||de._startsWithPDI&&!f.has(de._start)){for(var fe=[ie=de],pe=void 0;ie&&ie._endsWithIsolInit&&null!=(pe=f.get(ie._end));)for(var me=he+1;me<re.length;me++)if(re[me]._start===pe){fe.push(ie=re[me]);break}for(var ge=[],Ae=0;Ae<fe.length;Ae++)for(var ve=fe[Ae],ye=ve._start;ye<=ve._end;ye++)ge.push(ye);for(var Ee=d[ge[0]],_e=m.level,xe=ge[0]-1;xe>=0;xe--)if(!(n[xe]&o)){_e=d[xe];break}var be=ge[ge.length-1],Se=d[be],we=m.level;if(!(n[be]&i))for(var Ce=be+1;Ce<=m.end;Ce++)if(!(n[Ce]&o)){we=d[Ce];break}ue.push({_seqIndices:ge,_sosType:Math.max(_e,Ee)%2?x:_,_eosType:Math.max(we,Se)%2?x:_})}}for(var Te=0;Te<ue.length;Te++){var Me=ue[Te],Ie=Me._seqIndices,Re=Me._sosType,Be=Me._eosType,Pe=1&d[Ie[0]]?x:_;if(c.get(P))for(var De=0;De<Ie.length;De++){var Le=Ie[De];if(n[Le]&P){for(var ke=Re,Fe=De-1;Fe>=0;Fe--)if(!(n[Ie[Fe]]&o)){ke=n[Ie[Fe]];break}h(Le,ke&(i|Q)?R:ke)}}if(c.get(b))for(var Oe=0;Oe<Ie.length;Oe++){var Ue=Ie[Oe];if(n[Ue]&b)for(var Ne=Oe-1;Ne>=-1;Ne--){var ze=-1===Ne?Re:n[Ie[Ne]];if(ze&s){ze===D&&h(Ue,C);break}}}if(c.get(D))for(var Ge=0;Ge<Ie.length;Ge++){var Qe=Ie[Ge];n[Qe]&D&&h(Qe,x)}if(c.get(S)||c.get(T))for(var He=1;He<Ie.length-1;He++){var Ve=Ie[He];if(n[Ve]&(S|T)){for(var je=0,We=0,Ye=He-1;Ye>=0&&(je=n[Ie[Ye]])&o;Ye--);for(var Ke=He+1;Ke<Ie.length&&(We=n[Ie[Ke]])&o;Ke++);je===We&&(n[Ve]===S?je===b:je&(b|C))&&h(Ve,je)}}if(c.get(b))for(var qe=0;qe<Ie.length;qe++){var Xe=Ie[qe];if(n[Xe]&b){for(var $e=qe-1;$e>=0&&n[Ie[$e]]&(w|o);$e--)h(Ie[$e],b);for(qe++;qe<Ie.length&&n[Ie[qe]]&(w|o|b);qe++)n[Ie[qe]]!==b&&h(Ie[qe],b)}}if(c.get(w)||c.get(S)||c.get(T))for(var Je=0;Je<Ie.length;Je++){var Ze=Ie[Je];if(n[Ze]&(w|S|T)){h(Ze,R);for(var et=Je-1;et>=0&&n[Ie[et]]&o;et--)h(Ie[et],R);for(var tt=Je+1;tt<Ie.length&&n[Ie[tt]]&o;tt++)h(Ie[tt],R)}}if(c.get(b))for(var nt=0,rt=Re;nt<Ie.length;nt++){var it=Ie[nt],st=n[it];st&b?rt===_&&h(it,_):st&s&&(rt=st)}if(c.get(a)){for(var at=x|b|C,ot=at|_,lt=[],ct=[],ut=0;ut<Ie.length;ut++)if(n[Ie[ut]]&a){var ht=e[Ie[ut]],dt=void 0;if(null!==v(ht)){if(!(ct.length<63))break;ct.push({char:ht,seqIndex:ut})}else if(null!==(dt=y(ht)))for(var ft=ct.length-1;ft>=0;ft--){var pt=ct[ft].char;if(pt===dt||pt===y(E(ht))||v(E(pt))===ht){lt.push([ct[ft].seqIndex,ut]),ct.length=ft;break}}}lt.sort(function(e,t){return e[0]-t[0]});for(var mt=0;mt<lt.length;mt++){for(var gt=lt[mt],At=gt[0],vt=gt[1],yt=!1,Et=0,_t=At+1;_t<vt;_t++){var xt=Ie[_t];if(n[xt]&ot){yt=!0;var bt=n[xt]&at?x:_;if(bt===Pe){Et=bt;break}}}if(yt&&!Et){Et=Re;for(var St=At-1;St>=0;St--){var wt=Ie[St];if(n[wt]&ot){var Ct=n[wt]&at?x:_;Et=Ct!==Pe?Ct:Pe;break}}}if(Et){if(n[Ie[At]]=n[Ie[vt]]=Et,Et!==Pe)for(var Tt=At+1;Tt<Ie.length;Tt++)if(!(n[Ie[Tt]]&o)){u(e[Ie[Tt]])&P&&(n[Ie[Tt]]=Et);break}if(Et!==Pe)for(var Mt=vt+1;Mt<Ie.length;Mt++)if(!(n[Ie[Mt]]&o)){u(e[Ie[Mt]])&P&&(n[Ie[Mt]]=Et);break}}}for(var It=0;It<Ie.length;It++)if(n[Ie[It]]&a){for(var Rt=It,Bt=It,Pt=Re,Dt=It-1;Dt>=0;Dt--){if(!(n[Ie[Dt]]&o)){Pt=n[Ie[Dt]]&at?x:_;break}Rt=Dt}for(var Lt=Be,kt=It+1;kt<Ie.length;kt++){if(!(n[Ie[kt]]&(a|o))){Lt=n[Ie[kt]]&at?x:_;break}Bt=kt}for(var Ft=Rt;Ft<=Bt;Ft++)n[Ie[Ft]]=Pt===Lt?Pt:Pe;It=Bt}}}for(var Ot=m.start;Ot<=m.end;Ot++){var Ut=d[Ot],Nt=n[Ot];if(1&Ut?Nt&(_|b|C)&&d[Ot]++:Nt&x?d[Ot]++:Nt&(C|b)&&(d[Ot]+=2),Nt&o&&(d[Ot]=0===Ot?m.level:d[Ot-1]),Ot===m.end||u(e[Ot])&(I|M))for(var zt=Ot;zt>=0&&u(e[zt])&l;zt--)d[zt]=m.level}}return{levels:d,paragraphs:p};function Gt(t,r){for(var s=t;s<e.length;s++){var a=n[s];if(a&(x|D))return 1;if(a&(M|_)||r&&a===Q)return 0;if(a&i){var o=Qt(s);s=-1===o?e.length:o}}return 0}function Qt(t){for(var r=1,s=t+1;s<e.length;s++){var a=n[s];if(a&M)break;if(a&Q){if(0===--r)return s}else a&i&&r++}return-1}},e.getMirroredCharacter=V,e.getMirroredCharactersMap=function(e,t,n,r){var i=e.length;n=Math.max(0,null==n?0:+n),r=Math.min(i-1,null==r?i-1:+r);for(var s=new Map,a=n;a<=r;a++)if(1&t[a]){var o=V(e[a]);null!==o&&s.set(a,o)}return s},e.getReorderSegments=j,e.getReorderedIndices=W,e.getReorderedString=function(e,t,n,r){var i=W(e,t,n,r),s=[].concat(e);return i.forEach(function(n,r){s[r]=(1&t.levels[n]?V(e[n]):null)||e[n]}),s.join("")},e.openingToClosingBracket=v,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}],init:(e,t,n)=>e(t,n())}),wI=OM({name:"Typesetter",dependencies:[SI],init:e=>function(t){return new Promise(n=>{e.typeset(t,n)})},getTransferables(e){const t=[];for(let n in e)e[n]&&e[n].buffer&&t.push(e[n].buffer);return t}});wI.onMainThread;const CI={};const TI="aTroikaGlyphIndex";class MI extends Fh{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new er,this.boundingBox=new Fn}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);let t=function(e){let t=CI[e];return t||(t=CI[e]=new os(1,1,e,e).translate(.5,.5,0)),t}(e);["position","normal","uv"].forEach(e=>{this.attributes[e]=t.attributes[e].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,n,r,i){this.updateAttributeData("aTroikaGlyphBounds",e,4),this.updateAttributeData(TI,t,1),this.updateAttributeData("aTroikaGlyphColor",i,3),this._blockBounds=n,this._chunkedBounds=r,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:n}=this;if(t){const{PI:r,floor:i,min:s,max:a,sin:o,cos:l}=Math,c=r/2,u=2*r,h=Math.abs(t),d=e[0]/h,f=e[2]/h,p=i((d+c)/u)!==i((f+c)/u)?-h:s(o(d)*h,o(f)*h),m=i((d-c)/u)!==i((f-c)/u)?h:a(o(d)*h,o(f)*h),g=i((d+r)/u)!==i((f+r)/u)?2*h:a(h-l(d)*h,h-l(f)*h);n.min.set(p,e[1],t<0?-g:0),n.max.set(m,e[3],t<0?0:g)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(TI).count,n=this._chunkedBounds;if(n)for(let r=n.length;r--;){t=n[r].end;let i=n[r].rect;if(i[1]<e.w&&i[3]>e.y&&i[0]<e.z&&i[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,n){const r=this.getAttribute(e);t?r&&r.array.length===t.length?(r.array.set(t),r.needsUpdate=!0):(this.setAttribute(e,new Il(t,n)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(e)}}const II=new ti({color:16777215,side:2,transparent:!0}),RI=8421504,BI=new cr,PI=new Dn,DI=new Dn,LI=[],kI=new Dn,FI="+x+y";function OI(e){return Array.isArray(e)?e[0]:e}let UI=()=>{const e=new Ui(new os(1,1),II);return UI=()=>e,e},NI=()=>{const e=new Ui(new os(1,1,32,1),II);return NI=()=>e,e};const zI={type:"syncstart"},GI={type:"synccomplete"},QI=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],HI=QI.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class VI extends Ui{constructor(){super(new MI,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=RI,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=FI,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(zI),yI({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(e=>e&&e())})),this.dispatchEvent(GI),e&&e()})))}onBeforeRender(e,t,n,r,i,s){this.sync(),i.isTroikaTextMaterial&&this._prepareForRender(i)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return function(e){const t=qM(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new nn},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Tn(0,0,0,0)},uTroikaClipRect:{value:new Tn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new nn},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new $r},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new rn},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:e,fragmentShader:t}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(t)&&(t=t.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(e)||(e=e.replace(GM,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=II.clone());if(e&&e.isDerivedFrom(t)||(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),this.hasOutline()){let t=e._outlineMtl;return t||(t=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),t.isTextOutlineMaterial=!0,t.depthWrite=!1,t.map=null,e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),t.dispose()})),[t,e]}return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return OI(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return OI(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,n=e.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:e,blockBounds:i}=r;n.uTroikaSDFTexture.value=e,n.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height),n.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,n.uTroikaSDFExponent.value=r.sdfExponent,n.uTroikaTotalBounds.value.fromArray(i),n.uTroikaUseGlyphColors.value=!t&&!!r.glyphColors;let s,a,o,l=0,c=0,u=0,h=0,d=0;if(t){let{outlineWidth:e,outlineOffsetX:t,outlineOffsetY:n,outlineBlur:r,outlineOpacity:i}=this;l=this._parsePercent(e)||0,c=Math.max(0,this._parsePercent(r)||0),s=i,h=this._parsePercent(t)||0,d=this._parsePercent(n)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(o=this.strokeColor,n.uTroikaStrokeColor.value.set(null==o?RI:o),a=this.strokeOpacity,null==a&&(a=1)),s=this.fillOpacity;n.uTroikaEdgeOffset.value=l,n.uTroikaPositionOffset.value.set(h,d),n.uTroikaBlurRadius.value=c,n.uTroikaStrokeWidth.value=u,n.uTroikaStrokeOpacity.value=a,n.uTroikaFillOpacity.value=null==s?1:s,n.uTroikaCurveRadius.value=this.curveRadius||0;let f=this.clipRect;if(f&&Array.isArray(f)&&4===f.length)n.uTroikaClipRect.value.fromArray(f);else{const e=100*(this.fontSize||.1);n.uTroikaClipRect.value.set(i[0]-e,i[1]-e,i[2]+e,i[3]+e)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const i=t?this.outlineColor||0:this.color;if(null==i)delete e.color;else{const t=e.hasOwnProperty("color")?e.color:e.color=new $r;i===t._input&&"object"!=typeof i||t.set(t._input=i)}let s=this.orientation||FI;if(s!==e._orientation){let t=n.uTroikaOrient.value;s=s.replace(/[^-+xyz]/g,"");let r=s!==FI&&s.match(/^([-+])([xyz])([-+])([xyz])$/);if(r){let[,e,n,i,s]=r;PI.set(0,0,0)[n]="-"===e?1:-1,DI.set(0,0,0)[s]="-"===i?-1:1,BI.lookAt(kI,PI.cross(DI),DI),t.setFromMatrix4(BI)}else t.identity();e._orientation=s}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new nn){t.copy(e);const n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}worldPositionToTextCoords(e,t=new nn){return PI.copy(e),this.localPositionToTextCoords(this.worldToLocal(PI),t)}raycast(e,t){const{textRenderInfo:n,curveRadius:r}=this;if(n){const i=n.blockBounds,s=r?NI():UI(),a=s.geometry,{position:o,uv:l}=a.attributes;for(let e=0;e<l.count;e++){let t=i[0]+l.getX(e)*(i[2]-i[0]);const n=i[1]+l.getY(e)*(i[3]-i[1]);let s=0;r&&(s=r-Math.cos(t/r)*r,t=Math.sin(t/r)*r),o.setXYZ(e,t,n,s)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,s.matrixWorld=this.matrixWorld,s.material.side=this.material.side,LI.length=0,s.raycast(e,LI);for(let e=0;e<LI.length;e++)LI[e].object=this,t.push(LI[e])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,HI.forEach(t=>{this[t]=e[t]}),this}clone(){return(new this.constructor).copy(this)}}QI.forEach(e=>{const t="_private_"+e;Object.defineProperty(VI.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}),new Fn,new $r;const jI=e.forwardRef(({sdfGlyphSize:t=64,anchorX:n="center",anchorY:r="middle",font:i,fontSize:s=1,children:a,characters:o,onSync:l,...c},u)=>{const h=zp(({invalidate:e})=>e),[d]=e.useState(()=>new VI),[f,p]=e.useMemo(()=>{const t=[];let n="";return e.Children.forEach(a,e=>{"string"==typeof e||"number"==typeof e?n+=e:t.push(e)}),[t,n]},[a]);return ff(()=>new Promise(e=>function({font:e,characters:t,sdfGlyphSize:n},r){yI({font:e,sdfGlyphSize:n,text:Array.isArray(t)?t.join("\n"):""+t},r)}({font:i,characters:o},e)),["troika-text",i,o]),e.useLayoutEffect(()=>{d.sync(()=>{h(),l&&l(d)})}),e.useEffect(()=>()=>d.dispose(),[d]),e.createElement("primitive",Lm({object:d,ref:u,font:i,text:p,anchorX:n,anchorY:r,fontSize:s,sdfGlyphSize:t},c),f)});let WI=null;async function YI(e){const t=await async function(e){return"string"==typeof e?await(await fetch(e)).json():e}(e);return n=t,WI||(WI=new zC),WI.parse(n);var n}function KI(e){return ff(YI,[e])}KI.preload=e=>pf(YI,[e]),KI.clear=e=>mf([e]);const qI=["string","number"],XI=e.forwardRef(({font:t,letterSpacing:n=0,lineHeight:r=1,size:i=1,height:s=.2,bevelThickness:a=.1,bevelSize:o=.01,bevelEnabled:c=!1,bevelOffset:u=0,bevelSegments:h=4,curveSegments:d=8,smooth:f,children:p,...m},g)=>{e.useMemo(()=>Hf({RenamedTextGeometry:jw}),[]);const A=e.useRef(null),v=KI(t),y=l(()=>({font:v,size:i,height:s,bevelThickness:a,bevelSize:o,bevelEnabled:c,bevelSegments:h,bevelOffset:u,curveSegments:d,letterSpacing:n,lineHeight:r}),[v,i,s,a,o,c,h,u,d,n,r]),[E,..._]=l(()=>(t=>{let n="";const r=[];return e.Children.forEach(t,e=>{qI.includes(typeof e)?n+=e+"":r.push(e)}),[n,...r]})(p),[p]),x=e.useMemo(()=>[E,y],[E,y]);return e.useLayoutEffect(()=>{f&&(A.current.geometry=function(e,t=1e-4){t=Math.max(t,Number.EPSILON);const n={},r=e.getIndex(),i=e.getAttribute("position"),s=r?r.count:i.count;let a=0;const o=Object.keys(e.attributes),l={},c={},u=[],h=["getX","getY","getZ","getW"];for(let t=0,n=o.length;t<n;t++){const n=o[t];l[n]=[];const r=e.morphAttributes[n];r&&(c[n]=new Array(r.length).fill(0).map(()=>[]))}const d=Math.log10(1/t),f=Math.pow(10,d);for(let t=0;t<s;t++){const i=r?r.getX(t):t;let s="";for(let t=0,n=o.length;t<n;t++){const n=o[t],r=e.getAttribute(n),a=r.itemSize;for(let e=0;e<a;e++)s+=~~(r[h[e]](i)*f)+","}if(s in n)u.push(n[s]);else{for(let t=0,n=o.length;t<n;t++){const n=o[t],r=e.getAttribute(n),s=e.morphAttributes[n],a=r.itemSize,u=l[n],d=c[n];for(let e=0;e<a;e++){const t=h[e];if(u.push(r[t](i)),s)for(let e=0,n=s.length;e<n;e++)d[e].push(s[e][t](i))}}n[s]=a,u.push(a),a++}}const p=e.clone();for(let t=0,n=o.length;t<n;t++){const n=o[t],r=e.getAttribute(n),i=new r.array.constructor(l[n]),s=new ci(i,r.itemSize,r.normalized);if(p.setAttribute(n,s),n in c)for(let t=0;t<c[n].length;t++){const r=e.morphAttributes[n][t],i=new r.array.constructor(c[n][t]),s=new ci(i,r.itemSize,r.normalized);p.morphAttributes[n][t]=s}}return p.setIndex(u),p}(A.current.geometry,f),A.current.geometry.computeVertexNormals())},[x,f]),e.useImperativeHandle(g,()=>A.current,[]),e.createElement("mesh",Lm({},m,{ref:A}),e.createElement("renamedTextGeometry",{args:x}),_)}),$I=()=>{try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},JI=e.forwardRef(({children:t,multisamping:n=8,renderIndex:r=1,disableRender:i,disableGamma:s,disableRenderPass:a,depthBuffer:o=!0,stencilBuffer:l=!1,anisotropy:c=1,encoding:u,type:h,...d},f)=>{e.useMemo(()=>Hf({EffectComposer:US,RenderPass:GS,ShaderPass:RS}),[]);const p=e.useRef(null);e.useImperativeHandle(f,()=>p.current,[]);const{scene:m,camera:g,gl:A,size:v,viewport:y}=zp(),[E]=e.useState(()=>{const e=new In(v.width,v.height,{type:h||me,format:ye,depthBuffer:o,stencilBuffer:l,anisotropy:c});return h===le&&null!=u&&("colorSpace"in e?e.texture.colorSpace=u:e.texture.encoding=u),e.samples=n,e});e.useEffect(()=>{var e,t;null==(e=p.current)||e.setSize(v.width,v.height),null==(t=p.current)||t.setPixelRatio(y.dpr)},[A,v,y.dpr]),Gp(()=>{var e;i||null==(e=p.current)||e.render()},r);const _=[];return a||_.push(e.createElement("renderPass",{key:"renderpass",attach:`passes-${_.length}`,args:[m,g]})),s||_.push(e.createElement("shaderPass",{attach:`passes-${_.length}`,key:"gammapass",args:[Ww]})),e.Children.forEach(t,t=>{t&&_.push(e.cloneElement(t,{key:_.length,attach:`passes-${_.length}`}))}),e.createElement("effectComposer",Lm({ref:p,args:[A,E]},d),_)});let ZI=function(e){return e.Linear="linear",e.Radial="radial",e}({});function eR({stops:t,colors:n,size:r=1024,width:i=16,type:s=ZI.Linear,innerCircleRadius:a=0,outerCircleRadius:o="auto",...l}){const c=zp(e=>e.gl),u=e.useMemo(()=>{const e=document.createElement("canvas"),l=e.getContext("2d");let c;if(e.width=i,e.height=r,s===ZI.Linear)c=l.createLinearGradient(0,0,0,r);else{const t=e.width/2,n=e.height/2,r="auto"!==o?Math.abs(Number(o)):Math.sqrt(t**2+n**2);c=l.createRadialGradient(t,n,Math.abs(a),t,n,r)}const u=new $r;let h=t.length;for(;h--;)c.addColorStop(t[h],u.set(n[h]).getStyle());return l.save(),l.fillStyle=c,l.fillRect(0,0,i,r),l.restore(),e},[t]);return e.createElement("canvasTexture",Lm({colorSpace:c.outputColorSpace,args:[u],attach:"map"},l))}function tR(e,t,n,r){const i=class extends ji{constructor(i={}){const s=Object.entries(e);super({uniforms:s.reduce((e,[t,n])=>({...e,...Vi.clone({[t]:{value:n}})}),{}),vertexShader:t,fragmentShader:n}),this.key="",s.forEach(([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t})),Object.assign(this,i),r&&r(this)}};return i.key=tn.generateUUID(),i}const nR=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function rR(e,t){const n=zp(e=>e.gl),r=jp(ph,nR(e)?Object.values(e):e);a(()=>{null==t||t(r)},[t]),s(()=>{if("initTexture"in n){let e=[];Array.isArray(r)?e=r:r instanceof Cn?e=[r]:nR(r)&&(e=Object.values(r)),e.forEach(e=>{e instanceof Cn&&n.initTexture(e)})}},[n,r]);const i=l(()=>{if(nR(e)){const t={};let n=0;for(const i in e)t[i]=r[n++];return t}return r},[e,r]);return i}rR.preload=e=>jp.preload(ph,e),rR.clear=e=>jp.clear(ph,e);const iR=({children:t,input:n,onLoad:r})=>{const i=rR(n,r);return e.createElement(e.Fragment,null,null==t?void 0:t(i))},sR=(()=>parseInt(E.replace(/\D+/g,"")))(),aR=tR({color:new $r("white"),scale:new nn(1,1),imageBounds:new nn(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},"\n  varying vec2 vUv;\n  varying vec2 vPos;\n  void main() {\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n    vUv = uv;\n    vPos = position.xy;\n  }\n",`\n  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44\n  varying vec2 vUv;\n  varying vec2 vPos;\n  uniform vec2 scale;\n  uniform vec2 imageBounds;\n  uniform float resolution;\n  uniform vec3 color;\n  uniform sampler2D map;\n  uniform float radius;\n  uniform float zoom;\n  uniform float grayscale;\n  uniform float opacity;\n  const vec3 luma = vec3(.299, 0.587, 0.114);\n  vec4 toGrayscale(vec4 color, float intensity) {\n    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);\n  }\n  vec2 aspect(vec2 size) {\n    return size / min(size.x, size.y);\n  }\n  \n  const float PI = 3.14159265;\n    \n  // from https://iquilezles.org/articles/distfunctions\n  float udRoundBox( vec2 p, vec2 b, float r ) {\n    return length(max(abs(p)-b+r,0.0))-r;\n  }\n\n  void main() {\n    vec2 s = aspect(scale);\n    vec2 i = aspect(imageBounds);\n    float rs = s.x / s.y;\n    float ri = i.x / i.y;\n    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);\n    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;\n    vec2 uv = vUv * s / new + offset;\n    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);\n\n    vec2 res = vec2(scale * resolution);\n    vec2 halfRes = 0.5 * res;\n    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    \n\t  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));\n    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);\n    \n    #include <tonemapping_fragment>\n    #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n  }\n`),oR=e.forwardRef(({children:t,color:n,segments:r=1,scale:i=1,zoom:s=1,grayscale:a=0,opacity:o=1,radius:l=0,texture:c,toneMapped:u,transparent:h,side:d,...f},p)=>{Hf({ImageMaterial:aR});const m=e.useRef(null),g=zp(e=>e.size),A=Array.isArray(i)?[i[0],i[1]]:[i,i],v=[c.image.width,c.image.height],y=Math.max(g.width,g.height);return e.useImperativeHandle(p,()=>m.current,[]),e.useLayoutEffect(()=>{m.current.geometry.parameters&&m.current.material.scale.set(A[0]*m.current.geometry.parameters.width,A[1]*m.current.geometry.parameters.height)},[A[0],A[1]]),e.createElement("mesh",Lm({ref:m,scale:Array.isArray(i)?[...i,1]:i},f),e.createElement("planeGeometry",{args:[1,1,r,r]}),e.createElement("imageMaterial",{color:n,map:c,zoom:s,grayscale:a,opacity:o,scale:A,imageBounds:v,resolution:y,radius:l,toneMapped:u,transparent:h,side:d,key:aR.key}),t)}),lR=e.forwardRef(({url:t,...n},r)=>{const i=rR(t);return e.createElement(oR,Lm({},n,{texture:i,ref:r}))}),cR=e.forwardRef(({url:t,...n},r)=>e.createElement(oR,Lm({},n,{ref:r}))),uR=e.forwardRef((t,n)=>{if(t.url)return e.createElement(lR,Lm({},t,{ref:n}));if(t.texture)return e.createElement(cR,Lm({},t,{ref:n}));throw new Error("<Image /> requires a url or texture")}),hR=e.forwardRef(({threshold:t=15,geometry:n,...r},i)=>{const s=e.useRef(null);e.useImperativeHandle(i,()=>s.current,[]);const a=e.useMemo(()=>[0,0,0,1,0,0],[]),o=e.useRef(),l=e.useRef();return e.useLayoutEffect(()=>{const e=s.current.parent,r=null!=n?n:null==e?void 0:e.geometry;if(!r)return;if(o.current===r&&l.current===t)return;o.current=r,l.current=t;const i=new Uc(r,t).attributes.position.array;s.current.geometry.setPositions(i),s.current.geometry.attributes.instanceStart.needsUpdate=!0,s.current.geometry.attributes.instanceEnd.needsUpdate=!0,s.current.computeLineDistances()}),e.createElement(bM,Lm({segments:!0,points:a,ref:s,raycast:()=>null},r))}),dR=tR({screenspace:!1,color:new $r("black"),opacity:1,thickness:.05,size:new nn},"#include <common>\n   #include <morphtarget_pars_vertex>\n   #include <skinning_pars_vertex>\n   #include <clipping_planes_pars_vertex>\n   uniform float thickness;\n   uniform bool screenspace;\n   uniform vec2 size;\n   void main() {\n     #if defined (USE_SKINNING)\n\t     #include <beginnormal_vertex>\n       #include <morphnormal_vertex>\n       #include <skinbase_vertex>\n       #include <skinnormal_vertex>\n       #include <defaultnormal_vertex>\n     #endif\n     #include <begin_vertex>\n\t   #include <morphtarget_vertex>\n\t   #include <skinning_vertex>\n     #include <project_vertex>\n     #include <clipping_planes_vertex>\n     vec4 tNormal = vec4(normal, 0.0);\n     vec4 tPosition = vec4(transformed, 1.0);\n     #ifdef USE_INSTANCING\n       tNormal = instanceMatrix * tNormal;\n       tPosition = instanceMatrix * tPosition;\n     #endif\n     if (screenspace) {\n       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;\n       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); \n     } else {\n       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;\n       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;\n       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;\n       clipPosition.xy += offset;\n       gl_Position = clipPosition;\n     }\n   }",`uniform vec3 color;\n   uniform float opacity;\n   #include <clipping_planes_pars_fragment>\n   void main(){\n     #include <clipping_planes_fragment>\n     gl_FragColor = vec4(color, opacity);\n     #include <tonemapping_fragment>\n     #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n   }`);function fR({color:t="black",opacity:n=1,transparent:r=!1,screenspace:i=!1,toneMapped:s=!0,polygonOffset:a=!1,polygonOffsetFactor:o=0,renderOrder:l=0,thickness:c=.05,angle:u=Math.PI,clippingPlanes:h,...d}){const f=e.useRef(),[p]=e.useState(()=>new dR({side:1})),{gl:m}=zp(),g=m.getDrawingBufferSize(new nn);e.useMemo(()=>Hf({OutlinesMaterial:dR}),[]);const A=e.useRef(0),v=e.useRef();return e.useLayoutEffect(()=>{const e=f.current;if(!e)return;const t=e.parent;if(t&&t.geometry&&(A.current!==u||v.current!==t.geometry)){var n;A.current=u,v.current=t.geometry;let r=null==(n=e.children)?void 0:n[0];r&&(u&&r.geometry.dispose(),e.remove(r)),t.skeleton?(r=new bl,r.material=p,r.bind(t.skeleton,t.bindMatrix),e.add(r)):t.isInstancedMesh?(r=new Ol(t.geometry,p,t.count),r.instanceMatrix=t.instanceMatrix,e.add(r)):(r=new Ui,r.material=p,e.add(r)),r.geometry=u?Ox(t.geometry,u):t.geometry,r.morphTargetInfluences=t.morphTargetInfluences,r.morphTargetDictionary=t.morphTargetDictionary}}),e.useLayoutEffect(()=>{const e=f.current;if(!e)return;const u=e.children[0];if(u){u.renderOrder=l;const d=e.parent;Xp(u,{morphTargetInfluences:d.morphTargetInfluences,morphTargetDictionary:d.morphTargetDictionary}),Xp(u.material,{transparent:r,thickness:c,color:t,opacity:n,size:g,screenspace:i,toneMapped:s,polygonOffset:a,polygonOffsetFactor:o,clippingPlanes:h,clipping:h&&h.length>0})}}),e.useEffect(()=>()=>{const e=f.current;if(!e)return;const t=e.children[0];t&&(u&&t.geometry.dispose(),e.remove(t))},[]),e.createElement("group",Lm({ref:f},d))}var pR=Object.defineProperty,mR=(e,t,n)=>(((e,t,n)=>{t in e?pR(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);function gR(e,t,n,r,i){let s;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,i&&t+i):e.slice(t,i&&t+i):e,n.set)n.set(e,r);else for(s=0;s<e.length;s++)n[s+r]=e[s];return n}class AR extends Ei{constructor(){super(),mR(this,"type","MeshLine"),mR(this,"isMeshLine",!0),mR(this,"positions",[]),mR(this,"previous",[]),mR(this,"next",[]),mR(this,"side",[]),mR(this,"width",[]),mR(this,"indices_array",[]),mR(this,"uvs",[]),mR(this,"counters",[]),mR(this,"widthCallback",null),mR(this,"_attributes"),mR(this,"_points",[]),mR(this,"points"),mR(this,"matrixWorld",new cr),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,t){if(e=function(e){return e instanceof Float32Array?e:e instanceof Ei?e.getAttribute("position").array:e.map(e=>{const t=Array.isArray(e);return e instanceof Dn?[e.x,e.y,e.z]:e instanceof nn?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e}).flat()}(e),this._points=e,this.widthCallback=null!=t?t:null,this.positions=[],this.counters=[],e.length&&e[0]instanceof Dn)for(let t=0;t<e.length;t++){const n=e[t],r=t/(e.length-1);this.positions.push(n.x,n.y,n.z),this.positions.push(n.x,n.y,n.z),this.counters.push(r),this.counters.push(r)}else for(let t=0;t<e.length;t+=3){const n=t/(e.length-1);this.positions.push(e[t],e[t+1],e[t+2]),this.positions.push(e[t],e[t+1],e[t+2]),this.counters.push(n),this.counters.push(n)}this.process()}compareV3(e,t){const n=6*e,r=6*t;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]}copyV3(e){const t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){const e=this.positions.length/6;let t,n;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],n=this.compareV3(0,e-1)?this.copyV3(e-2):this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let r=0;r<e;r++){if(this.side.push(1),this.side.push(-1),t=this.widthCallback?this.widthCallback(r/(e-1)):1,this.width.push(t),this.width.push(t),this.uvs.push(r/(e-1),0),this.uvs.push(r/(e-1),1),r<e-1){n=this.copyV3(r),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);const e=2*r;this.indices_array.push(e,e+1,e+2),this.indices_array.push(e+2,e+1,e+3)}r>0&&(n=this.copyV3(r),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]))}n=this.compareV3(e-1,0)?this.copyV3(1):this.copyV3(e-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]),this._attributes&&this._attributes.position.count===this.counters.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new ci(new Float32Array(this.positions),3),previous:new ci(new Float32Array(this.previous),3),next:new ci(new Float32Array(this.next),3),side:new ci(new Float32Array(this.side),1),width:new ci(new Float32Array(this.width),1),uv:new ci(new Float32Array(this.uvs),2),index:new ci(new Uint16Array(this.indices_array),1),counters:new ci(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:t,z:n}){const r=this._attributes.position.array,i=this._attributes.previous.array,s=this._attributes.next.array,a=r.length;gR(r,0,i,0,a),gR(r,6,r,0,a-6),r[a-6]=e,r[a-5]=t,r[a-4]=n,r[a-3]=e,r[a-2]=t,r[a-1]=n,gR(r,6,s,0,a-6),s[a-6]=e,s[a-5]=t,s[a-4]=n,s[a-3]=e,s[a-2]=t,s[a-1]=n,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const vR=`\n  #include <fog_pars_fragment>\n  #include <logdepthbuf_pars_fragment>\n  #include <clipping_planes_pars_fragment>\n  \n  uniform sampler2D map;\n  uniform sampler2D alphaMap;\n  uniform float useGradient;\n  uniform float useMap;\n  uniform float useAlphaMap;\n  uniform float useDash;\n  uniform float dashArray;\n  uniform float dashOffset;\n  uniform float dashRatio;\n  uniform float visibility;\n  uniform float alphaTest;\n  uniform vec2 repeat;\n  uniform vec3 gradient[2];\n  \n  varying vec2 vUV;\n  varying vec4 vColor;\n  varying float vCounters;\n  \n  void main() {\n    #include <logdepthbuf_fragment>\n    vec4 diffuseColor = vColor;\n    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);\n    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);\n    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;\n    if (diffuseColor.a < alphaTest) discard;\n    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));\n    diffuseColor.a *= step(vCounters, visibility);\n    #include <clipping_planes_fragment>\n    gl_FragColor = diffuseColor;     \n    #include <fog_fragment>\n    #include <tonemapping_fragment>\n    #include <${(()=>parseInt(E.replace(/\D+/g,"")))()>=154?"colorspace_fragment":"encodings_fragment"}>\n  }\n`;class yR extends ji{constructor(e){super({uniforms:{...cs.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new $r(16777215)},gradient:{value:[new $r(16711680),new $r(65280)]},opacity:{value:1},resolution:{value:new nn(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new nn(1,1)}},vertexShader:"\n  #include <common>\n  #include <logdepthbuf_pars_vertex>\n  #include <fog_pars_vertex>\n  #include <clipping_planes_pars_vertex>\n\n  attribute vec3 previous;\n  attribute vec3 next;\n  attribute float side;\n  attribute float width;\n  attribute float counters;\n  \n  uniform vec2 resolution;\n  uniform float lineWidth;\n  uniform vec3 color;\n  uniform float opacity;\n  uniform float sizeAttenuation;\n  \n  varying vec2 vUV;\n  varying vec4 vColor;\n  varying float vCounters;\n  \n  vec2 fix(vec4 i, float aspect) {\n    vec2 res = i.xy / i.w;\n    res.x *= aspect;\n    return res;\n  }\n  \n  void main() {\n    float aspect = resolution.x / resolution.y;\n    vColor = vec4(color, opacity);\n    vUV = uv;\n    vCounters = counters;\n  \n    mat4 m = projectionMatrix * modelViewMatrix;\n    vec4 finalPosition = m * vec4(position, 1.0) * aspect;\n    vec4 prevPos = m * vec4(previous, 1.0);\n    vec4 nextPos = m * vec4(next, 1.0);\n  \n    vec2 currentP = fix(finalPosition, aspect);\n    vec2 prevP = fix(prevPos, aspect);\n    vec2 nextP = fix(nextPos, aspect);\n  \n    float w = lineWidth * width;\n  \n    vec2 dir;\n    if (nextP == currentP) dir = normalize(currentP - prevP);\n    else if (prevP == currentP) dir = normalize(nextP - currentP);\n    else {\n      vec2 dir1 = normalize(currentP - prevP);\n      vec2 dir2 = normalize(nextP - currentP);\n      dir = normalize(dir1 + dir2);\n  \n      vec2 perp = vec2(-dir1.y, dir1.x);\n      vec2 miter = vec2(-dir.y, dir.x);\n      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);\n    }\n  \n    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;\n    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);\n    normal.xy *= .5 * w;\n    //normal *= projectionMatrix;\n    if (sizeAttenuation == 0.) {\n      normal.xy *= finalPosition.w;\n      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;\n    }\n  \n    finalPosition.xy += normal.xy * side;\n    gl_Position = finalPosition;\n    #include <logdepthbuf_vertex>\n    #include <fog_vertex>\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    #include <clipping_planes_vertex>\n    #include <fog_vertex>\n  }\n",fragmentShader:vR}),mR(this,"lineWidth"),mR(this,"map"),mR(this,"useMap"),mR(this,"alphaMap"),mR(this,"useAlphaMap"),mR(this,"color"),mR(this,"gradient"),mR(this,"resolution"),mR(this,"sizeAttenuation"),mR(this,"dashArray"),mR(this,"dashOffset"),mR(this,"dashRatio"),mR(this,"useDash"),mR(this,"useGradient"),mR(this,"visibility"),mR(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(e){this.uniforms.color.value=e}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(e){this.uniforms.gradient.value=e}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(e){this.uniforms.useDash.value=e}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(e){this.uniforms.useGradient.value=e}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(e){this.uniforms.repeat.value.copy(e)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}const ER={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},_R=(e,t=1)=>(e.set(e.subarray(t)),e.fill(-1/0,-t),e);function xR(t,n){const{length:r,local:i,decay:s,interval:a,stride:o}={...ER,...n},l=e.useRef(),[c]=e.useState(()=>new Dn);e.useLayoutEffect(()=>{t&&(l.current=Float32Array.from({length:10*r*3},(e,n)=>t.position.getComponent(n%3)))},[r,t]);const u=e.useRef(new Dn),h=e.useRef(0);return Gp(()=>{if(t&&l.current){if(0===h.current){let e;i?e=t.position:(t.getWorldPosition(c),e=c);const n=1*s;for(let t=0;t<n;t++)e.distanceTo(u.current)<o||(_R(l.current,3),l.current.set(e.toArray(),l.current.length-3));u.current.copy(e)}h.current++,h.current=h.current%a}}),l}const bR=e.forwardRef((t,n)=>{const{children:r}=t,{width:i,length:s,decay:a,local:o,stride:l,interval:c}={...ER,...t},{color:u="hotpink",attenuation:h,target:d}=t,f=zp(e=>e.size),p=zp(e=>e.scene),m=e.useRef(null),[g,A]=e.useState(null),v=xR(g,{length:s,decay:a,local:o,stride:l,interval:c});e.useEffect(()=>{const e=(null==d?void 0:d.current)||m.current.children.find(e=>e instanceof Lr);e&&A(e)},[v,d]);const y=e.useMemo(()=>new AR,[]),E=e.useMemo(()=>{var e;const t=new yR({lineWidth:.1*i,color:u,sizeAttenuation:1,resolution:new nn(f.width,f.height)});let n;if(r)if(Array.isArray(r))n=r.find(e=>{const t=e;return"string"==typeof t.type&&"meshLineMaterial"===t.type});else{const e=r;"string"==typeof e.type&&"meshLineMaterial"===e.type&&(n=e)}return"object"==typeof(null==(e=n)?void 0:e.props)&&t.setValues(n.props),t},[i,u,f,r]);return e.useEffect(()=>{E.uniforms.resolution.value.set(f.width,f.height)},[f]),Gp(()=>{v.current&&y.setPoints(v.current,h)}),e.createElement("group",null,rm(e.createElement("mesh",{ref:n,geometry:y,material:E}),p),e.createElement("group",{ref:m},r))});function SR(t,n=16,r,i,s){const[a,o]=e.useState(()=>{const e=Array.from({length:n},()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).flat();return new Il(Float32Array.from(e),16)});return e.useLayoutEffect(()=>{if(void 0===t.current)return;const e=new Mb(t.current);i&&e.setWeightAttribute(i),e.build();const l=new Dn,c=new Dn,u=new $r,h=new Lr;t.current.updateMatrixWorld(!0);for(let i=0;i<n;i++)e.sample(l,c,u),"function"==typeof r?r({dummy:h,sampledMesh:t.current,position:l,normal:c,color:u},i):h.position.copy(l),h.updateMatrix(),null!=s&&s.current&&s.current.setMatrixAt(i,h.matrix),h.matrix.toArray(a.array,16*i);null!=s&&s.current&&(s.current.instanceMatrix.needsUpdate=!0),a.needsUpdate=!0,o(new Il(a.array,a.itemSize).copy(a))},[t,s,i,n,r]),a}function wR({children:t,weight:n,transform:r,instances:i,mesh:s,count:a=16,...o}){const l=e.useRef(null),c=e.useRef(null),u=e.useRef(null);return e.useLayoutEffect(()=>{var e,t;c.current=null!==(e=null==i?void 0:i.current)&&void 0!==e?e:l.current.children.find(e=>e.hasOwnProperty("instanceMatrix")),u.current=null!==(t=null==s?void 0:s.current)&&void 0!==t?t:l.current.children.find(e=>"Mesh"===e.type)},[t,null==s?void 0:s.current,null==i?void 0:i.current]),SR(u,a,r,n,c),e.createElement("group",Lm({ref:l},o),t)}const CR=({compute:t,name:n,...r})=>{const[i]=e.useState(()=>new ci(new Float32Array(0),1)),s=e.useRef(null);return e.useLayoutEffect(()=>{if(s.current){var e;const n=null!==(e=s.current.parent)&&void 0!==e?e:s.current.__r3f.parent,r=t(n);s.current.copy(r)}},[t]),e.createElement("primitive",Lm({ref:s,object:i,attach:`attributes-${n}`},r))};const TR=e.forwardRef(({isChild:t=!1,object:n,children:r,deep:i,castShadow:s,receiveShadow:a,inject:o,keys:l,...c},u)=>{const h={keys:l,deep:i,inject:o,castShadow:s,receiveShadow:a};if(n=e.useMemo(()=>{if(!1===t&&!Array.isArray(n)){let e=!1;if(n.traverse(t=>{t.isSkinnedMesh&&(e=!0)}),e)return wb.clone(n)}return n},[n,t]),Array.isArray(n))return e.createElement("group",Lm({},c,{ref:u}),n.map(t=>e.createElement(TR,Lm({key:t.uuid,object:t},h))),r);const{children:d,...f}=function(t,{keys:n=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:r,inject:i,castShadow:s,receiveShadow:a}){let o={};for(const e of n)o[e]=t[e];return r&&(o.geometry&&"materialsOnly"!==r&&(o.geometry=o.geometry.clone()),o.material&&"geometriesOnly"!==r&&(o.material=o.material.clone())),i&&(o="function"==typeof i?{...o,children:i(t)}:e.isValidElement(i)?{...o,children:i}:{...o,...i}),t instanceof Ui&&(s&&(o.castShadow=!0),a&&(o.receiveShadow=!0)),o}(n,h),p=n.type[0].toLowerCase()+n.type.slice(1);return e.createElement(p,Lm({},f,c,{ref:u}),n.children.map(t=>"Bone"===t.type?e.createElement("primitive",Lm({key:t.uuid,object:t},h)):e.createElement(TR,Lm({key:t.uuid,object:t},h,{isChild:!0}))),r,d)}),MR=e.createContext(null),IR=e.forwardRef(({resolution:t=28,maxPolyCount:n=1e4,enableUvs:r=!1,enableColors:i=!1,children:s,...a},o)=>{const l=e.useRef(null);e.useImperativeHandle(o,()=>l.current,[]);const c=e.useMemo(()=>new hb(t,null,r,i,n),[t,n,r,i]),u=e.useMemo(()=>({getParent:()=>l}),[]);return Gp(()=>{c.update(),c.reset()},-1),e.createElement(e.Fragment,null,e.createElement("primitive",Lm({object:c,ref:l},a),e.createElement(MR.Provider,{value:u},s)))}),RR=e.forwardRef(({strength:t=.5,subtract:n=12,color:r,...i},s)=>{const{getParent:a}=e.useContext(MR),o=e.useMemo(()=>a(),[a]),l=e.useRef(null);e.useImperativeHandle(s,()=>l.current,[]);const c=new Dn;return Gp(e=>{o.current&&l.current&&(l.current.getWorldPosition(c),o.current.addBall(.5+.5*c.x,.5+.5*c.y,.5+.5*c.z,t,n,r))}),e.createElement("group",Lm({ref:l},i))}),BR=e.forwardRef(({planeType:t="x",strength:n=.5,subtract:r=12,...i},s)=>{const{getParent:a}=e.useContext(MR),o=e.useMemo(()=>a(),[a]),l=e.useRef(null);e.useImperativeHandle(s,()=>l.current,[]);const c=e.useMemo(()=>"x"===t?"addPlaneX":"y"===t?"addPlaneY":"addPlaneZ",[t]);return Gp(()=>{o.current&&l.current&&o.current[c](n,r)}),e.createElement("group",Lm({ref:l},i))});function PR(e=[0,0,0]){return function(e){return Array.isArray(e)}(e)?e:e instanceof Dn||e instanceof yr?[e.x,e.y,e.z]:[e,e,e]}const DR=e.forwardRef(function({debug:t,depthTest:n=!1,polygonOffsetFactor:r=-10,map:i,mesh:s,children:a,position:o,rotation:l,scale:c,...u},h){const d=e.useRef(null);e.useImperativeHandle(h,()=>d.current);const f=e.useRef(null),p=e.useRef({position:new Dn,rotation:new yr,scale:new Dn(1,1,1)});return e.useLayoutEffect(()=>{const e=(null==s?void 0:s.current)||d.current.parent,t=d.current;if(!(e instanceof Ui))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(e){Xp(p.current,{position:o,scale:c});const n=e.matrixWorld.clone();if(e.matrixWorld.identity(),l&&"number"!=typeof l)Xp(p.current,{rotation:l});else{const t=new Lr;t.position.copy(p.current.position);const n=e.geometry.attributes.position.array;void 0===e.geometry.attributes.normal&&e.geometry.computeVertexNormals();const r=e.geometry.attributes.normal.array;let i=1/0;new Dn;let s=new Dn;const a=t.position.x,o=t.position.y,c=t.position.z,u=n.length;let h=-1;for(let e=0;e<u;e+=3){const t=n[e]-a,r=n[e+1]-o,s=n[e+2]-c,l=t*t+r*r+s*s;l<i&&(i=l,h=e)}s.fromArray(r,h),t.lookAt(t.position.clone().add(s)),t.rotateZ(Math.PI),t.rotateY(Math.PI),"number"==typeof l&&t.rotateZ(l),Xp(p.current,{rotation:t.rotation})}return t.geometry=new Hw(e,p.current.position,p.current.rotation,p.current.scale),e.matrixWorld=n,()=>{t.geometry.dispose()}}},[s,...PR(o),...PR(c),...PR(l)]),e.useLayoutEffect(()=>{f.current&&(Xp(f.current,p.current),f.current.traverse(e=>e.raycast=()=>null))},[t]),e.createElement("mesh",Lm({ref:d,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":r,"material-depthTest":n,"material-map":i},u),a,t&&e.createElement("mesh",{ref:f},e.createElement("boxGeometry",null),e.createElement("meshNormalMaterial",{wireframe:!0}),e.createElement("axesHelper",null)))}),LR=c(function({src:t,skipFill:n,skipStrokes:r,fillMaterial:i,strokeMaterial:a,fillMeshProps:o,strokeMeshProps:c,...u},h){const f=jp(PT,t.startsWith("<svg")?`data:image/svg+xml;utf8,${t}`:t),p=l(()=>r?[]:f.paths.map(e=>{var t;return void 0===(null==(t=e.userData)?void 0:t.style.stroke)||"none"===e.userData.style.stroke?null:e.subPaths.map(t=>PT.pointsToStroke(t.getPoints(),e.userData.style))}),[f,r]);s(()=>()=>p.forEach(e=>e&&e.map(e=>e.dispose())),[p]);let m=0;return e.createElement("object3D",Lm({ref:h},u),e.createElement("object3D",{scale:[1,-1,1]},f.paths.map((t,s)=>{var l,u;return e.createElement(d,{key:s},!n&&void 0!==(null==(l=t.userData)?void 0:l.style.fill)&&"none"!==t.userData.style.fill&&PT.createShapes(t).map((n,r)=>e.createElement("mesh",Lm({key:r},o,{renderOrder:m++}),e.createElement("shapeGeometry",{args:[n]}),e.createElement("meshBasicMaterial",Lm({color:t.userData.style.fill,opacity:t.userData.style.fillOpacity,transparent:!0,side:2,depthWrite:!1},i)))),!r&&void 0!==(null==(u=t.userData)?void 0:u.style.stroke)&&"none"!==t.userData.style.stroke&&t.subPaths.map((n,r)=>e.createElement("mesh",Lm({key:r,geometry:p[s][r]},c,{renderOrder:m++}),e.createElement("meshBasicMaterial",Lm({color:t.userData.style.stroke,opacity:t.userData.style.strokeOpacity,transparent:!0,side:2,depthWrite:!1},a)))))})))});let kR=null,FR="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function OR(e=!0,t=!0,n){return r=>{n&&n(r),e&&(kR||(kR=new LT),kR.setDecoderPath("string"==typeof e?e:FR),r.setDRACOLoader(kR)),t&&r.setMeshoptDecoder(aM())}}const UR=(e,t,n,r)=>jp(jS,e,OR(t,n,r));UR.preload=(e,t,n,r)=>jp.preload(jS,e,OR(t,n,r)),UR.clear=e=>jp.clear(jS,e),UR.setDecoderPath=e=>{FR=e};const NR=e.forwardRef(({src:t,useDraco:n,useMeshOpt:r,extendLoader:i,...s},a)=>{const{scene:o}=UR(t,n,r,i);return e.createElement(TR,Lm({ref:a},s,{object:o}))});function zR({renderIndex:t=1,bgColor:n="black",fgColor:r="white",characters:i=" .:-+*=%@#",invert:s=!0,color:a=!1,resolution:o=.15}){const{size:l,gl:c,scene:u,camera:h}=zp(),d=e.useMemo(()=>{const e=new hC(c,i,{invert:s,color:a,resolution:o});return e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.left="0px",e.domElement.style.pointerEvents="none",e},[i,s,a,o]);return e.useLayoutEffect(()=>{d.domElement.style.color=r,d.domElement.style.backgroundColor=n},[r,n]),e.useEffect(()=>(c.domElement.style.opacity="0",c.domElement.parentNode.appendChild(d.domElement),()=>{c.domElement.style.opacity="1",c.domElement.parentNode.removeChild(d.domElement)}),[d]),e.useEffect(()=>{d.setSize(l.width,l.height)},[d,l]),Gp(e=>{d.render(u,h)},t),e.createElement(e.Fragment,null)}const GR=tR({alphaTest:0,viewport:new nn(1980,1080),focal:1e3,centerAndScaleTexture:null,covAndColorTexture:null},"\n    precision highp sampler2D;\n    precision highp usampler2D;\n    out vec4 vColor;\n    out vec3 vPosition;\n    uniform vec2 resolution;\n    uniform vec2 viewport;\n    uniform float focal;\n    attribute uint splatIndex;\n    uniform sampler2D centerAndScaleTexture;\n    uniform usampler2D covAndColorTexture;    \n\n    vec2 unpackInt16(in uint value) {\n      int v = int(value);\n      int v0 = v >> 16;\n      int v1 = (v & 0xFFFF);\n      if((v & 0x8000) != 0)\n        v1 |= 0xFFFF0000;\n      return vec2(float(v1), float(v0));\n    }\n\n    void main () {\n      ivec2 texSize = textureSize(centerAndScaleTexture, 0);\n      ivec2 texPos = ivec2(splatIndex%uint(texSize.x), splatIndex/uint(texSize.x));\n      vec4 centerAndScaleData = texelFetch(centerAndScaleTexture, texPos, 0);\n      vec4 center = vec4(centerAndScaleData.xyz, 1);\n      vec4 camspace = modelViewMatrix * center;\n      vec4 pos2d = projectionMatrix * camspace;\n\n      float bounds = 1.2 * pos2d.w;\n      if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds\n        || pos2d.y < -bounds || pos2d.y > bounds) {\n        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);\n        return;\n      }\n\n      uvec4 covAndColorData = texelFetch(covAndColorTexture, texPos, 0);\n      vec2 cov3D_M11_M12 = unpackInt16(covAndColorData.x) * centerAndScaleData.w;\n      vec2 cov3D_M13_M22 = unpackInt16(covAndColorData.y) * centerAndScaleData.w;\n      vec2 cov3D_M23_M33 = unpackInt16(covAndColorData.z) * centerAndScaleData.w;\n      mat3 Vrk = mat3(\n        cov3D_M11_M12.x, cov3D_M11_M12.y, cov3D_M13_M22.x,\n        cov3D_M11_M12.y, cov3D_M13_M22.y, cov3D_M23_M33.x,\n        cov3D_M13_M22.x, cov3D_M23_M33.x, cov3D_M23_M33.y\n      );\n\n      mat3 J = mat3(\n        focal / camspace.z, 0., -(focal * camspace.x) / (camspace.z * camspace.z),\n        0., focal / camspace.z, -(focal * camspace.y) / (camspace.z * camspace.z),\n        0., 0., 0.\n      );\n\n      mat3 W = transpose(mat3(modelViewMatrix));\n      mat3 T = W * J;\n      mat3 cov = transpose(T) * Vrk * T;\n      vec2 vCenter = vec2(pos2d) / pos2d.w;\n      float diagonal1 = cov[0][0] + 0.3;\n      float offDiagonal = cov[0][1];\n      float diagonal2 = cov[1][1] + 0.3;\n      float mid = 0.5 * (diagonal1 + diagonal2);\n      float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));\n      float lambda1 = mid + radius;\n      float lambda2 = max(mid - radius, 0.1);\n      vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));\n      vec2 v1 = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;\n      vec2 v2 = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);\n      uint colorUint = covAndColorData.w;\n      vColor = vec4(\n        float(colorUint & uint(0xFF)) / 255.0,\n        float((colorUint >> uint(8)) & uint(0xFF)) / 255.0,\n        float((colorUint >> uint(16)) & uint(0xFF)) / 255.0,\n        float(colorUint >> uint(24)) / 255.0\n      );\n      vPosition = position;\n\n      gl_Position = vec4(\n        vCenter \n          + position.x * v2 / viewport * 2.0 \n          + position.y * v1 / viewport * 2.0, pos2d.z / pos2d.w, 1.0);\n    }\n    ",`\n    #include <alphatest_pars_fragment>\n    #include <alphahash_pars_fragment>\n    in vec4 vColor;\n    in vec3 vPosition;\n    void main () {\n      float A = -dot(vPosition.xy, vPosition.xy);\n      if (A < -4.0) discard;\n      float B = exp(A) * vColor.a;\n      vec4 diffuseColor = vec4(vColor.rgb, B);\n      #include <alphatest_fragment>\n      #include <alphahash_fragment>\n      gl_FragColor = diffuseColor;\n      #include <tonemapping_fragment>\n      #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n    }\n  `);function QR(e){let t=null,n=0;e.onmessage=r=>{if("push"==r.data.method){0===n&&(t=new Float32Array(r.data.length));const e=new Float32Array(r.data.matrices);t.set(e,n),n+=e.length}else if("sort"==r.data.method&&null!==t){const n=function(e,n=!1){const r=t.length/16;let i=-1/0,s=1/0;const a=new Float32Array(r),o=new Int32Array(a.buffer),l=new Int32Array(r);let c=0;for(let o=0;o<r;o++){const r=e[0]*t[16*o+12]+e[1]*t[16*o+13]+e[2]*t[16*o+14]+e[3];(n||r<0&&t[16*o+15]>-1e-4*r)&&(a[c]=r,l[c]=o,c++,r>i&&(i=r),r<s&&(s=r))}const u=65535/(i-s),h=new Uint32Array(65536);for(let e=0;e<c;e++)o[e]=(a[e]-s)*u|0,h[o[e]]++;const d=new Uint32Array(65536);for(let e=1;e<65536;e++)d[e]=d[e-1]+h[e-1];const f=new Uint32Array(c);for(let e=0;e<c;e++)f[d[o[e]]++]=l[e];return f}(new Float32Array(r.data.view),r.data.hashed);e.postMessage({indices:n,key:r.data.key},[n.buffer])}}}class HR extends oh{constructor(...e){super(...e),this.gl=null,this.chunkSize=25e3}load(e,t,n,r){const i={gl:this.gl,url:this.manager.resolveURL(e),worker:new Worker(URL.createObjectURL(new Blob(["(",QR.toString(),")(self)"],{type:"application/javascript"}))),manager:this.manager,update:(e,t,n)=>function(e,t,n,r){if(e.updateMatrixWorld(),t.gl.getCurrentViewport(n.viewport),n.material.viewport.x=n.viewport.z,n.material.viewport.y=n.viewport.w,n.material.focal=n.viewport.w/2*Math.abs(e.projectionMatrix.elements[5]),n.ready){if(r&&n.sorted)return;n.ready=!1;const e=new Float32Array([n.modelViewMatrix.elements[2],-n.modelViewMatrix.elements[6],n.modelViewMatrix.elements[10],n.modelViewMatrix.elements[14]]);t.worker.postMessage({method:"sort",src:t.url,key:n.uuid,view:e.buffer,hashed:r},[e.buffer]),r&&t.loaded&&(n.sorted=!0)}}(t,i,e,n),connect:e=>function(e,t){e.loading||async function(e){e.loading=!0;let t=0,n=0;const r=[];let i=0;const s=0!==e.totalDownloadBytes;for(;;)try{const{value:a,done:o}=await e.stream.read();if(o)break;if(t+=a.length,null!=e.totalDownloadBytes){const n=t/e.totalDownloadBytes*100;if(e.onProgress&&n-i>1){const r=new ProgressEvent("progress",{lengthComputable:s,loaded:t,total:e.totalDownloadBytes});e.onProgress(r),i=n}}r.push(a);const l=t-n;if(null!=e.totalDownloadBytes&&l>e.rowLength*e.chunkSize){let t=Math.floor(l/e.rowLength);const i=new Uint8Array(l);let a=0;for(const e of r)i.set(e,a),a+=e.length;if(r.length=0,l>t*e.rowLength){const n=new Uint8Array(l-t*e.rowLength);n.set(i.subarray(l-n.length,l),0),r.push(n)}const o=new Uint8Array(t*e.rowLength);o.set(i.subarray(0,o.byteLength),0);const c=VR(e,o.buffer,t);if(e.worker.postMessage({method:"push",src:e.url,length:16*e.numVertices,matrices:c.buffer},[c.buffer]),n+=t*e.rowLength,e.onProgress){const t=new ProgressEvent("progress",{lengthComputable:s,loaded:e.totalDownloadBytes,total:e.totalDownloadBytes});e.onProgress(t)}}}catch(e){break}if(t-n>0){let t=new Uint8Array(r.reduce((e,t)=>e+t.length,0)),n=0;for(const e of r)t.set(e,n),n+=e.length;let i=Math.floor(t.byteLength/e.rowLength);const s=VR(e,t.buffer,i);e.worker.postMessage({method:"push",src:e.url,length:16*i,matrices:s.buffer},[s.buffer])}e.loaded=!0,e.manager.itemEnd(e.url)}(e);t.ready=!1,t.pm=new cr,t.vm1=new cr,t.vm2=new cr,t.viewport=new Tn;let n=new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight);const r=new Il(n,1,!1);r.setUsage(Ft);const i=t.geometry=new Fh,s=new Float32Array(18),a=new ci(s,3);function o(e){if(t&&e.data.key===t.uuid){let n=new Uint32Array(e.data.indices);i.attributes.splatIndex.set(n),i.attributes.splatIndex.needsUpdate=!0,i.instanceCount=n.length,t.ready=!0}}async function l(){for(;;){const t=e.gl.properties.get(e.centerAndScaleTexture),n=e.gl.properties.get(e.covAndColorTexture);if(null!=t&&t.__webglTexture&&null!=n&&n.__webglTexture&&e.loadedVertexCount>0)break;await new Promise(e=>setTimeout(e,10))}t.ready=!0}return i.setAttribute("position",a),a.setXYZ(2,-2,2,0),a.setXYZ(1,2,2,0),a.setXYZ(0,-2,-2,0),a.setXYZ(5,-2,-2,0),a.setXYZ(4,2,2,0),a.setXYZ(3,2,-2,0),a.needsUpdate=!0,i.setAttribute("splatIndex",r),i.instanceCount=1,e.worker.addEventListener("message",o),l(),()=>e.worker.removeEventListener("message",o)}(i,e),loading:!1,loaded:!1,loadedVertexCount:0,chunkSize:this.chunkSize,totalDownloadBytes:0,numVertices:0,rowLength:32,maxVertexes:0,bufferTextureWidth:0,bufferTextureHeight:0,stream:null,centerAndScaleData:null,covAndColorData:null,covAndColorTexture:null,centerAndScaleTexture:null,onProgress:n};(async function(e){e.manager.itemStart(e.url);const t=await fetch(e.url);if(null===t.body)throw"Failed to fetch file";let n=t.headers.get("Content-Length");const r=n?parseInt(n):void 0;if(null==r)throw"Failed to get content length";e.stream=t.body.getReader(),e.totalDownloadBytes=r,e.numVertices=Math.floor(e.totalDownloadBytes/e.rowLength);const i=e.gl.getContext();let s=i.getParameter(i.MAX_TEXTURE_SIZE);e.maxVertexes=s*s,e.numVertices>e.maxVertexes&&(e.numVertices=e.maxVertexes);return e.bufferTextureWidth=s,e.bufferTextureHeight=Math.floor((e.numVertices-1)/s)+1,e.centerAndScaleData=new Float32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.covAndColorData=new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.centerAndScaleTexture=new wl(e.centerAndScaleData,e.bufferTextureWidth,e.bufferTextureHeight,ye,pe),e.centerAndScaleTexture.needsUpdate=!0,e.covAndColorTexture=new wl(e.covAndColorData,e.bufferTextureWidth,e.bufferTextureHeight,Ce,fe),e.covAndColorTexture.internalFormat="RGBA32UI",e.covAndColorTexture.needsUpdate=!0,e})(i).then(t).catch(e=>{null==r||r(e),i.manager.itemError(i.url)})}}function VR(e,t,n){const r=e.gl.getContext();if(e.loadedVertexCount+n>e.maxVertexes&&(n=e.maxVertexes-e.loadedVertexCount),n<=0)throw"Failed to parse file";const i=new Uint8Array(t),s=new Float32Array(t),a=new Float32Array(16*n),o=new Uint8Array(e.covAndColorData.buffer),l=new Int16Array(e.covAndColorData.buffer);for(let t=0;t<n;t++){const n=new Pn(-(i[32*t+28+1]-128)/128,(i[32*t+28+2]-128)/128,(i[32*t+28+3]-128)/128,-(i[32*t+28+0]-128)/128);n.invert();const r=new Dn(s[8*t+0],s[8*t+1],-s[8*t+2]),c=new Dn(s[8*t+3+0],s[8*t+3+1],s[8*t+3+2]),u=new cr;u.makeRotationFromQuaternion(n),u.transpose(),u.scale(c);const h=u.clone();u.transpose(),u.premultiply(h),u.setPosition(r);const d=[0,1,2,5,6,10];let f=0;for(let e=0;e<d.length;e++)Math.abs(u.elements[d[e]])>f&&(f=Math.abs(u.elements[d[e]]));let p=4*e.loadedVertexCount+4*t;e.centerAndScaleData[p+0]=r.x,e.centerAndScaleData[p+1]=-r.y,e.centerAndScaleData[p+2]=r.z,e.centerAndScaleData[p+3]=f/32767,p=8*e.loadedVertexCount+4*t*2;for(let e=0;e<d.length;e++)l[p+e]=32767*u.elements[d[e]]/f;p=16*e.loadedVertexCount+4*(4*t+3);const m=new $r(i[32*t+24+0]/255,i[32*t+24+1]/255,i[32*t+24+2]/255);m.convertSRGBToLinear(),o[p+0]=255*m.r,o[p+1]=255*m.g,o[p+2]=255*m.b,o[p+3]=i[32*t+24+3],u.elements[15]=Math.max(c.x,c.y,c.z)*i[32*t+24+3]/255;for(let e=0;e<16;e++)a[16*t+e]=u.elements[e]}for(;n>0;){let t=0,i=0;const s=e.loadedVertexCount%e.bufferTextureWidth,a=Math.floor(e.loadedVertexCount/e.bufferTextureWidth);e.loadedVertexCount%e.bufferTextureWidth!=0?(t=Math.min(e.bufferTextureWidth,s+n)-s,i=1):Math.floor(n/e.bufferTextureWidth)>0?(t=e.bufferTextureWidth,i=Math.floor(n/e.bufferTextureWidth)):(t=n%e.bufferTextureWidth,i=1);const o=e.gl.properties.get(e.centerAndScaleTexture);r.bindTexture(r.TEXTURE_2D,o.__webglTexture),r.texSubImage2D(r.TEXTURE_2D,0,s,a,t,i,r.RGBA,r.FLOAT,e.centerAndScaleData,4*e.loadedVertexCount);const l=e.gl.properties.get(e.covAndColorTexture);r.bindTexture(r.TEXTURE_2D,l.__webglTexture),r.texSubImage2D(r.TEXTURE_2D,0,s,a,t,i,r.RGBA_INTEGER,r.UNSIGNED_INT,e.covAndColorData,4*e.loadedVertexCount),e.gl.resetState(),e.loadedVertexCount+=t*i,n-=t*i}return a}function jR({src:t,toneMapped:n=!1,alphaTest:r=0,alphaHash:i=!1,chunkSize:s=25e3,...a}){Hf({SplatMaterial:GR});const o=e.useRef(null),l=zp(e=>e.gl),c=zp(e=>e.camera),u=jp(HR,t,e=>{e.gl=l,e.chunkSize=s});return e.useLayoutEffect(()=>u.connect(o.current),[t]),Gp(()=>u.update(o.current,c,i)),e.createElement("mesh",Lm({ref:o,frustumCulled:!1},a),e.createElement("splatMaterial",{key:`${t}/${r}/${i}${GR.key}`,transparent:!i,depthTest:!0,alphaTest:i?0:r,centerAndScaleTexture:u.centerAndScaleTexture,covAndColorTexture:u.covAndColorTexture,depthWrite:!!i||r>0,blending:i?1:5,blendSrcAlpha:R,alphaHash:!!i,toneMapped:n}))}function WR(t,n,r){const i=zp(e=>e.size),s=zp(e=>e.viewport),a="number"==typeof t?t:i.width*s.dpr,o="number"==typeof n?n:i.height*s.dpr,l=("number"==typeof t?r:t)||{},{samples:c=0,depth:u,...h}=l,d=e.useMemo(()=>{const e=new In(a,o,{minFilter:ie,magFilter:ie,type:me,...h});return u&&(e.depthTexture=new Oo(a,o,pe)),e.samples=c,e},[]);return e.useLayoutEffect(()=>{d.setSize(a,o),c&&(d.samples=c)},[c,d,a,o]),e.useEffect(()=>()=>d.dispose(),[]),d}const YR=({children:t,width:n,height:r,...i})=>{const s=WR(n,r,i);return e.createElement(e.Fragment,null,null==t?void 0:t(s))},KR=e.forwardRef(({envMap:t,resolution:n=256,frames:r=1/0,children:i,makeDefault:s,...a},o)=>{const l=zp(({set:e})=>e),c=zp(({camera:e})=>e),u=zp(({size:e})=>e),h=e.useRef(null);e.useImperativeHandle(o,()=>h.current,[]);const d=e.useRef(null),f=WR(n);e.useLayoutEffect(()=>{a.manual||h.current.updateProjectionMatrix()},[u,a]),e.useLayoutEffect(()=>{h.current.updateProjectionMatrix()}),e.useLayoutEffect(()=>{if(s){const e=c;return l(()=>({camera:h.current})),()=>l(()=>({camera:e}))}},[h,s,l]);let p=0,m=null;const g="function"==typeof i;return Gp(e=>{g&&(r===1/0||p<r)&&(d.current.visible=!1,e.gl.setRenderTarget(f),m=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,h.current),e.scene.background=m,e.gl.setRenderTarget(null),d.current.visible=!0,p++)}),e.createElement(e.Fragment,null,e.createElement("orthographicCamera",Lm({left:u.width/-2,right:u.width/2,top:u.height/2,bottom:u.height/-2,ref:h},a),!g&&i),e.createElement("group",{ref:d},g&&i(f.texture)))}),qR=e.forwardRef(({envMap:t,resolution:n=256,frames:r=1/0,makeDefault:i,children:s,...a},o)=>{const l=zp(({set:e})=>e),c=zp(({camera:e})=>e),u=zp(({size:e})=>e),h=e.useRef(null);e.useImperativeHandle(o,()=>h.current,[]);const d=e.useRef(null),f=WR(n);e.useLayoutEffect(()=>{a.manual||(h.current.aspect=u.width/u.height)},[u,a]),e.useLayoutEffect(()=>{h.current.updateProjectionMatrix()});let p=0,m=null;const g="function"==typeof s;return Gp(e=>{g&&(r===1/0||p<r)&&(d.current.visible=!1,e.gl.setRenderTarget(f),m=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,h.current),e.scene.background=m,e.gl.setRenderTarget(null),d.current.visible=!0,p++)}),e.useLayoutEffect(()=>{if(i){const e=c;return l(()=>({camera:h.current})),()=>l(()=>({camera:e}))}},[h,i,l]),e.createElement(e.Fragment,null,e.createElement("perspectiveCamera",Lm({ref:h},a),!g&&s),e.createElement("group",{ref:d},g&&s(f.texture)))});function XR({resolution:t=256,near:n=.1,far:r=1e3,envMap:i,fog:a}={}){const o=zp(({gl:e})=>e),c=zp(({scene:e})=>e),u=l(()=>{const e=new $i(t);return e.texture.type=me,e},[t]);s(()=>()=>{u.dispose()},[u]);const h=l(()=>new qi(n,r,u),[n,r,u]);let d,f;const p=e.useCallback(()=>{d=c.fog,f=c.background,c.background=i||f,c.fog=a||d,h.update(o,c),c.fog=d,c.background=f},[o,c,h]);return{fbo:u,camera:h,update:p}}function $R({children:t,frames:n=1/0,resolution:r,near:i,far:s,envMap:a,fog:o,...l}){const c=e.useRef(null),{fbo:u,camera:h,update:d}=XR({resolution:r,near:i,far:s,envMap:a,fog:o});let f=0;return Gp(()=>{c.current&&(n===1/0||f<n)&&(c.current.visible=!1,d(),c.current.visible=!0,f++)}),e.createElement("group",l,e.createElement("primitive",{object:h}),e.createElement("group",{ref:c},null==t?void 0:t(u.texture)))}const JR=e.forwardRef((t,n)=>{const{camera:r,onChange:i,makeDefault:s,...a}=t,o=zp(e=>e.camera),l=zp(e=>e.invalidate),c=zp(e=>e.get),u=zp(e=>e.set),h=r||o,d=e.useMemo(()=>new Jb(h),[h]);return e.useEffect(()=>{const e=e=>{l(),i&&i(e)};return null==d||null==d.addEventListener||d.addEventListener("change",e),()=>null==d||null==d.removeEventListener?void 0:d.removeEventListener("change",e)},[i,d,l]),Gp(()=>null==d?void 0:d.update(),-1),e.useEffect(()=>{const e=d;return null==e||e.connect(),()=>null==e?void 0:e.dispose()},[d]),e.useEffect(()=>{if(s){const e=c().controls;return u({controls:d}),()=>u({controls:e})}},[s,d]),d?e.createElement("primitive",Lm({ref:n,object:d},a)):null}),ZR=e.forwardRef(({domElement:t,...n},r)=>{const{onChange:i,makeDefault:s,...a}=n,o=zp(e=>e.invalidate),l=zp(e=>e.camera),c=zp(e=>e.gl),u=zp(e=>e.events),h=zp(e=>e.get),d=zp(e=>e.set),f=t||u.connected||c.domElement,p=e.useMemo(()=>new bS(l),[l]);return e.useEffect(()=>(p.connect(f),()=>{p.dispose()}),[f,p,o]),e.useEffect(()=>{const e=e=>{o(),i&&i(e)};return null==p.addEventListener||p.addEventListener("change",e),()=>null==p.removeEventListener?void 0:p.removeEventListener("change",e)},[i,o]),e.useEffect(()=>{if(s){const e=h().controls;return d({controls:p}),()=>d({controls:e})}},[s,p]),Gp((e,t)=>p.update(t)),e.createElement("primitive",Lm({ref:r,object:p,args:[l,f]},a))}),eB=e.forwardRef((t={enableDamping:!0},n)=>{const{domElement:r,camera:i,makeDefault:s,onChange:a,onStart:o,onEnd:l,...c}=t,u=zp(e=>e.invalidate),h=zp(e=>e.camera),d=zp(e=>e.gl),f=zp(e=>e.events),p=zp(e=>e.set),m=zp(e=>e.get),g=r||f.connected||d.domElement,A=i||h,v=e.useMemo(()=>new cS(A),[A]);return e.useEffect(()=>{v.connect(g);const e=e=>{u(),a&&a(e)};return v.addEventListener("change",e),o&&v.addEventListener("start",o),l&&v.addEventListener("end",l),()=>{v.dispose(),v.removeEventListener("change",e),o&&v.removeEventListener("start",o),l&&v.removeEventListener("end",l)}},[a,o,l,v,u,g]),e.useEffect(()=>{if(s){const e=m().controls;return p({controls:v}),()=>p({controls:e})}},[s,v]),Gp(()=>v.update(),-1),e.createElement("primitive",Lm({ref:n,object:v,enableDamping:!0},c))}),tB=e.forwardRef(({makeDefault:t,camera:n,regress:r,domElement:i,enableDamping:s=!0,keyEvents:a=!1,onChange:o,onStart:l,onEnd:c,...u},h)=>{const d=zp(e=>e.invalidate),f=zp(e=>e.camera),p=zp(e=>e.gl),m=zp(e=>e.events),g=zp(e=>e.setEvents),A=zp(e=>e.set),v=zp(e=>e.get),y=zp(e=>e.performance),E=n||f,_=i||m.connected||p.domElement,x=e.useMemo(()=>new lS(E),[E]);return Gp(()=>{x.enabled&&x.update()},-1),e.useEffect(()=>(a&&x.connect(!0===a?_:a),x.connect(_),()=>{x.dispose()}),[a,_,r,x,d]),e.useEffect(()=>{const e=e=>{d(),r&&y.regress(),o&&o(e)},t=e=>{l&&l(e)},n=e=>{c&&c(e)};return x.addEventListener("change",e),x.addEventListener("start",t),x.addEventListener("end",n),()=>{x.removeEventListener("start",t),x.removeEventListener("end",n),x.removeEventListener("change",e)}},[o,l,c,x,d,g]),e.useEffect(()=>{if(t){const e=v().controls;return A({controls:x}),()=>A({controls:e})}},[t,x]),e.createElement("primitive",Lm({ref:h,object:x,enableDamping:s},u))}),nB=e.forwardRef(({makeDefault:t,camera:n,domElement:r,regress:i,onChange:s,onStart:a,onEnd:o,...l},c)=>{const{invalidate:u,camera:h,gl:d,events:f,set:p,get:m,performance:g,viewport:A}=zp(),v=n||h,y=r||f.connected||d.domElement,E=e.useMemo(()=>new tS(v),[v]);return Gp(()=>{E.enabled&&E.update()},-1),e.useEffect(()=>(E.connect(y),()=>{E.dispose()}),[y,i,E,u]),e.useEffect(()=>{const e=e=>{u(),i&&g.regress(),s&&s(e)};return E.addEventListener("change",e),a&&E.addEventListener("start",a),o&&E.addEventListener("end",o),()=>{a&&E.removeEventListener("start",a),o&&E.removeEventListener("end",o),E.removeEventListener("change",e)}},[s,a,o,E,u]),e.useEffect(()=>{E.handleResize()},[A]),e.useEffect(()=>{if(t){const e=m().controls;return p({controls:E}),()=>p({controls:e})}},[t,E]),e.createElement("primitive",Lm({ref:c,object:E},l))}),rB=c(({camera:t,makeDefault:n,regress:r,domElement:i,onChange:a,onStart:o,onEnd:c,...u},h)=>{const d=zp(e=>e.invalidate),f=zp(e=>e.camera),p=zp(e=>e.gl),m=zp(e=>e.events),g=zp(e=>e.set),A=zp(e=>e.get),v=zp(e=>e.performance),y=t||f,E=i||m.connected||p.domElement,_=l(()=>new yS(y),[y]);return Gp(()=>{_.enabled&&_.update()},-1),s(()=>(_.connect(E),()=>{_.dispose()}),[E,r,_,d]),s(()=>{const e=e=>{d(),r&&v.regress(),a&&a(e)};return _.addEventListener("change",e),o&&_.addEventListener("start",o),c&&_.addEventListener("end",c),()=>{_.removeEventListener("change",e),o&&_.removeEventListener("start",o),c&&_.removeEventListener("end",c)}},[a,o,c]),s(()=>{if(n){const e=A().controls;return g({controls:_}),()=>g({controls:e})}},[n,_]),e.createElement("primitive",Lm({ref:h,object:_},u))}),iB=e.forwardRef(({children:t,domElement:n,onChange:r,onMouseDown:i,onMouseUp:s,onObjectChange:a,object:o,makeDefault:l,camera:c,enabled:u,axis:h,mode:d,translationSnap:f,rotationSnap:p,scaleSnap:m,space:g,size:A,showX:v,showY:y,showZ:E,..._},x)=>{const b=zp(e=>e.controls),S=zp(e=>e.gl),w=zp(e=>e.events),C=zp(e=>e.camera),T=zp(e=>e.invalidate),M=zp(e=>e.get),I=zp(e=>e.set),R=c||C,B=n||w.connected||S.domElement,P=e.useMemo(()=>new Ub(R,B),[R,B]),D=e.useRef(null);e.useLayoutEffect(()=>(o?P.attach(o instanceof Lr?o:o.current):D.current instanceof Lr&&P.attach(D.current),()=>{P.detach()}),[o,t,P]),e.useEffect(()=>{if(b){const e=e=>b.enabled=!e.value;return P.addEventListener("dragging-changed",e),()=>P.removeEventListener("dragging-changed",e)}},[P,b]);const L=e.useRef(),k=e.useRef(),F=e.useRef(),O=e.useRef();return e.useLayoutEffect(()=>{L.current=r},[r]),e.useLayoutEffect(()=>{k.current=i},[i]),e.useLayoutEffect(()=>{F.current=s},[s]),e.useLayoutEffect(()=>{O.current=a},[a]),e.useEffect(()=>{const e=e=>{T(),null==L.current||L.current(e)},t=e=>null==k.current?void 0:k.current(e),n=e=>null==F.current?void 0:F.current(e),r=e=>null==O.current?void 0:O.current(e);return P.addEventListener("change",e),P.addEventListener("mouseDown",t),P.addEventListener("mouseUp",n),P.addEventListener("objectChange",r),()=>{P.removeEventListener("change",e),P.removeEventListener("mouseDown",t),P.removeEventListener("mouseUp",n),P.removeEventListener("objectChange",r)}},[T,P]),e.useEffect(()=>{if(l){const e=M().controls;return I({controls:P}),()=>I({controls:e})}},[l,P]),e.createElement(e.Fragment,null,e.createElement("primitive",{ref:x,object:P,enabled:u,axis:h,mode:d,translationSnap:f,rotationSnap:p,scaleSnap:m,space:g,size:A,showX:v,showY:y,showZ:E}),e.createElement("group",Lm({ref:D},_),t))}),sB=e.forwardRef(({domElement:t,selector:n,onChange:r,onLock:i,onUnlock:s,enabled:a=!0,makeDefault:o,...l},c)=>{const{camera:u,...h}=l,d=zp(e=>e.setEvents),f=zp(e=>e.gl),p=zp(e=>e.camera),m=zp(e=>e.invalidate),g=zp(e=>e.events),A=zp(e=>e.get),v=zp(e=>e.set),y=u||p,E=t||g.connected||f.domElement,_=e.useMemo(()=>new qb(y),[y]);return e.useEffect(()=>{if(a){_.connect(E);const e=A().events.compute;return d({compute(e,t){const n=t.size.width/2,r=t.size.height/2;t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{_.disconnect(),d({compute:e})}}},[a,_]),e.useEffect(()=>{const e=e=>{m(),r&&r(e)};_.addEventListener("change",e),i&&_.addEventListener("lock",i),s&&_.addEventListener("unlock",s);const t=()=>_.lock(),a=n?Array.from(document.querySelectorAll(n)):[document];return a.forEach(e=>e&&e.addEventListener("click",t)),()=>{_.removeEventListener("change",e),i&&_.removeEventListener("lock",i),s&&_.removeEventListener("unlock",s),a.forEach(e=>e?e.removeEventListener("click",t):void 0)}},[r,i,s,n,_,m]),e.useEffect(()=>{if(o){const e=A().controls;return v({controls:_}),()=>v({controls:e})}},[o,_]),e.createElement("primitive",Lm({ref:c,object:_},h))}),aB=e.forwardRef(({domElement:t,makeDefault:n,...r},i)=>{const s=zp(e=>e.camera),a=zp(e=>e.gl),o=zp(e=>e.events),l=zp(e=>e.get),c=zp(e=>e.set),u=t||o.connected||a.domElement,[h]=e.useState(()=>new kb(s,u));return e.useEffect(()=>{if(n){const e=l().controls;return c({controls:h}),()=>c({controls:e})}},[n,h]),Gp((e,t)=>{h.update(t)},-1),h?e.createElement("primitive",Lm({ref:i,object:h},r)):null}),oB=1,lB=2,cB=4,uB=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),hB=0,dB=1,fB=-1;function pB(e){return e.isPerspectiveCamera}function mB(e){return e.isOrthographicCamera}const gB=2*Math.PI,AB=Math.PI/2,vB=Math.PI/180;function yB(e,t,n){return Math.max(t,Math.min(n,e))}function EB(e,t=1e-5){return Math.abs(e)<t}function _B(e,t,n=1e-5){return EB(e-t,n)}function xB(e,t){return Math.round(e/t)*t}function bB(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function SB(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function wB(e,t,n,r,i=1/0,s){const a=2/(r=Math.max(1e-4,r)),o=a*s,l=1/(1+o+.48*o*o+.235*o*o*o);let c=e-t;const u=t,h=i*r;c=yB(c,-h,h),t=e-c;const d=(n.value+a*c)*s;n.value=(n.value-a*d)*l;let f=t+(c+d)*l;return u-e>0==f>u&&(f=u,n.value=(f-u)/s),f}function CB(e,t,n,r,i=1/0,s,a){const o=2/(r=Math.max(1e-4,r)),l=o*s,c=1/(1+l+.48*l*l+.235*l*l*l);let u=t.x,h=t.y,d=t.z,f=e.x-u,p=e.y-h,m=e.z-d;const g=u,A=h,v=d,y=i*r,E=f*f+p*p+m*m;if(E>y*y){const e=Math.sqrt(E);f=f/e*y,p=p/e*y,m=m/e*y}u=e.x-f,h=e.y-p,d=e.z-m;const _=(n.x+o*f)*s,x=(n.y+o*p)*s,b=(n.z+o*m)*s;n.x=(n.x-o*_)*c,n.y=(n.y-o*x)*c,n.z=(n.z-o*b)*c,a.x=u+(f+_)*c,a.y=h+(p+x)*c,a.z=d+(m+b)*c;const S=g-e.x,w=A-e.y,C=v-e.z;return S*(a.x-g)+w*(a.y-A)+C*(a.z-v)>0&&(a.x=g,a.y=A,a.z=v,n.x=(a.x-g)/s,n.y=(a.y-A)/s,n.z=(a.z-v)/s),a}function TB(e,t){t.set(0,0),e.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=e.length,t.y/=e.length}function MB(e,t){return!!mB(e)}class IB{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}removeAllEventListeners(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}}dispatchEvent(e){const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e)}}}var RB;const BB=1/8,PB=/Mac/.test(null===(RB=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===RB?void 0:RB.platform);let DB,LB,kB,FB,OB,UB,NB,zB,GB,QB,HB,VB,jB,WB,YB,KB,qB,XB,$B,JB,ZB,eP,tP;class nP extends IB{static install(e){DB=e.THREE,LB=Object.freeze(new DB.Vector3(0,0,0)),kB=Object.freeze(new DB.Vector3(0,1,0)),FB=Object.freeze(new DB.Vector3(0,0,1)),OB=new DB.Vector2,UB=new DB.Vector3,NB=new DB.Vector3,zB=new DB.Vector3,GB=new DB.Vector3,QB=new DB.Vector3,HB=new DB.Vector3,VB=new DB.Vector3,jB=new DB.Vector3,WB=new DB.Vector3,YB=new DB.Spherical,KB=new DB.Spherical,qB=new DB.Box3,XB=new DB.Box3,$B=new DB.Sphere,JB=new DB.Quaternion,ZB=new DB.Quaternion,eP=new DB.Matrix4,tP=new DB.Raycaster}static get ACTION(){return uB}set verticalDragToForward(e){}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=uB.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=hB,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new DB.Vector3,this._focalOffsetVelocity=new DB.Vector3,this._zoomVelocity={value:0},this._truckInternal=(e,t,n,r)=>{let i,s;if(pB(this._camera)){const n=UB.copy(this._camera.position).sub(this._target),r=this._camera.getEffectiveFOV()*vB,a=n.length()*Math.tan(.5*r);i=this.truckSpeed*e*a/this._elementRect.height,s=this.truckSpeed*t*a/this._elementRect.height}else{if(!mB(this._camera))return;{const n=this._camera;i=this.truckSpeed*e*(n.right-n.left)/n.zoom/this._elementRect.width,s=this.truckSpeed*t*(n.top-n.bottom)/n.zoom/this._elementRect.height}}r?(n?this.setFocalOffset(this._focalOffsetEnd.x+i,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(i,0,!0),this.forward(-s,!0)):n?this.setFocalOffset(this._focalOffsetEnd.x+i,this._focalOffsetEnd.y+s,this._focalOffsetEnd.z,!0):this.truck(i,s,!0)},this._rotateInternal=(e,t)=>{const n=gB*this.azimuthRotateSpeed*e/this._elementRect.height,r=gB*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(n,r,!0)},this._dollyInternal=(e,t,n)=>{const r=Math.pow(.95,-e*this.dollySpeed),i=this._sphericalEnd.radius,s=this._sphericalEnd.radius*r,a=yB(s,this.minDistance,this.maxDistance),o=a-s;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(s,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(o,!0),this._dollyToNoClamp(a,!0)):this._dollyToNoClamp(a,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?s:a)-i,this._dollyControlCoord.set(t,n)),this._lastDollyDirection=Math.sign(-e)},this._zoomInternal=(e,t,n)=>{const r=Math.pow(.95,e*this.dollySpeed),i=this._zoom,s=this._zoom*r;this.zoomTo(s,!0),this.dollyToCursor&&(this._changedZoom+=s-i,this._dollyControlCoord.set(t,n))},this._camera=e,this._yAxisUpSpace=(new DB.Quaternion).setFromUnitVectors(this._camera.up,kB),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=uB.NONE,this._target=new DB.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new DB.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new DB.Spherical).setFromVector3(UB.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new DB.Vector3,new DB.Vector3,new DB.Vector3,new DB.Vector3],this._updateNearPlaneCorners(),this._boundary=new DB.Box3(new DB.Vector3(-1/0,-1/0,-1/0),new DB.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new DB.Vector2,this.mouseButtons={left:uB.ROTATE,middle:uB.DOLLY,right:uB.TRUCK,wheel:pB(this._camera)?uB.DOLLY:mB(this._camera)?uB.ZOOM:uB.NONE},this.touches={one:uB.TOUCH_ROTATE,two:pB(this._camera)?uB.TOUCH_DOLLY_TRUCK:mB(this._camera)?uB.TOUCH_ZOOM_TRUCK:uB.NONE,three:uB.TOUCH_TRUCK};const n=new DB.Vector2,r=new DB.Vector2,i=new DB.Vector2,s=e=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const t=this._domElement.getBoundingClientRect(),n=e.clientX/t.width,r=e.clientY/t.height;if(n<this._interactiveArea.left||n>this._interactiveArea.right||r<this._interactiveArea.top||r>this._interactiveArea.bottom)return}const t="mouse"!==e.pointerType?null:(e.buttons&oB)===oB?oB:(e.buttons&cB)===cB?cB:(e.buttons&lB)===lB?lB:null;if(null!==t){const e=this._findPointerByMouseButton(t);e&&this._disposePointer(e)}if((e.buttons&oB)===oB&&this._lockedPointer)return;const n={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(n),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",o),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",o),this._isDragging=!0,h(e)},a=e=>{e.cancelable&&e.preventDefault();const t=e.pointerId,n=this._lockedPointer||this._findPointerById(t);if(n){if(n.clientX=e.clientX,n.clientY=e.clientY,n.deltaX=e.movementX,n.deltaY=e.movementY,this._state=0,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(e.buttons&oB)===oB)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(e.buttons&cB)===cB&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(e.buttons&lB)===lB&&(this._state=this._state|this.mouseButtons.right);d()}},o=e=>{const t=this._findPointerById(e.pointerId);if(!t||t!==this._lockedPointer){if(t&&this._disposePointer(t),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=uB.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=uB.NONE;f()}};let l=-1;const c=e=>{if(!this._domElement)return;if(!this._enabled||this.mouseButtons.wheel===uB.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){const t=this._domElement.getBoundingClientRect(),n=e.clientX/t.width,r=e.clientY/t.height;if(n<this._interactiveArea.left||n>this._interactiveArea.right||r<this._interactiveArea.top||r>this._interactiveArea.bottom)return}if(e.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===uB.ROTATE||this.mouseButtons.wheel===uB.TRUCK){const e=performance.now();l-e<1e3&&this._getClientRect(this._elementRect),l=e}const t=PB?-1:-3,n=1===e.deltaMode||e.ctrlKey?e.deltaY/t:e.deltaY/(10*t),r=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,i=this.dollyToCursor?(e.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case uB.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case uB.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1,!1),this._isUserControllingTruck=!0;break;case uB.SCREEN_PAN:this._truckInternal(e.deltaX,e.deltaY,!1,!0),this._isUserControllingTruck=!0;break;case uB.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0,!1),this._isUserControllingOffset=!0;break;case uB.DOLLY:this._dollyInternal(-n,r,i),this._isUserControllingDolly=!0;break;case uB.ZOOM:this._zoomInternal(-n,r,i),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},u=e=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===nP.ACTION.NONE){const t=e instanceof PointerEvent?e.pointerId:0,n=this._findPointerById(t);return n&&this._disposePointer(n),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),void this._domElement.ownerDocument.removeEventListener("pointerup",o)}e.preventDefault()}},h=e=>{if(!this._enabled)return;TB(this._activePointers,OB),this._getClientRect(this._elementRect),n.copy(OB),r.copy(OB);if(this._activePointers.length>=2){const e=OB.x-this._activePointers[1].clientX,t=OB.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t);i.set(0,n);const s=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),a=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);r.set(s,a)}if(this._state=0,e)if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(e.buttons&oB)!==oB||(this._state=this._state|this.mouseButtons.left),(e.buttons&cB)===cB&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&lB)===lB&&(this._state=this._state|this.mouseButtons.right);else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);(this._state&uB.ROTATE)!==uB.ROTATE&&(this._state&uB.TOUCH_ROTATE)!==uB.TOUCH_ROTATE&&(this._state&uB.TOUCH_DOLLY_ROTATE)!==uB.TOUCH_DOLLY_ROTATE&&(this._state&uB.TOUCH_ZOOM_ROTATE)!==uB.TOUCH_ZOOM_ROTATE||(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),(this._state&uB.TRUCK)!==uB.TRUCK&&(this._state&uB.SCREEN_PAN)!==uB.SCREEN_PAN&&(this._state&uB.TOUCH_TRUCK)!==uB.TOUCH_TRUCK&&(this._state&uB.TOUCH_SCREEN_PAN)!==uB.TOUCH_SCREEN_PAN&&(this._state&uB.TOUCH_DOLLY_TRUCK)!==uB.TOUCH_DOLLY_TRUCK&&(this._state&uB.TOUCH_DOLLY_SCREEN_PAN)!==uB.TOUCH_DOLLY_SCREEN_PAN&&(this._state&uB.TOUCH_ZOOM_TRUCK)!==uB.TOUCH_ZOOM_TRUCK&&(this._state&uB.TOUCH_ZOOM_SCREEN_PAN)!==uB.TOUCH_DOLLY_SCREEN_PAN||(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),(this._state&uB.DOLLY)!==uB.DOLLY&&(this._state&uB.TOUCH_DOLLY)!==uB.TOUCH_DOLLY&&(this._state&uB.TOUCH_DOLLY_TRUCK)!==uB.TOUCH_DOLLY_TRUCK&&(this._state&uB.TOUCH_DOLLY_SCREEN_PAN)!==uB.TOUCH_DOLLY_SCREEN_PAN&&(this._state&uB.TOUCH_DOLLY_OFFSET)!==uB.TOUCH_DOLLY_OFFSET&&(this._state&uB.TOUCH_DOLLY_ROTATE)!==uB.TOUCH_DOLLY_ROTATE||(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),(this._state&uB.ZOOM)!==uB.ZOOM&&(this._state&uB.TOUCH_ZOOM)!==uB.TOUCH_ZOOM&&(this._state&uB.TOUCH_ZOOM_TRUCK)!==uB.TOUCH_ZOOM_TRUCK&&(this._state&uB.TOUCH_ZOOM_SCREEN_PAN)!==uB.TOUCH_ZOOM_SCREEN_PAN&&(this._state&uB.TOUCH_ZOOM_OFFSET)!==uB.TOUCH_ZOOM_OFFSET&&(this._state&uB.TOUCH_ZOOM_ROTATE)!==uB.TOUCH_ZOOM_ROTATE||(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),(this._state&uB.OFFSET)!==uB.OFFSET&&(this._state&uB.TOUCH_OFFSET)!==uB.TOUCH_OFFSET&&(this._state&uB.TOUCH_DOLLY_OFFSET)!==uB.TOUCH_DOLLY_OFFSET&&(this._state&uB.TOUCH_ZOOM_OFFSET)!==uB.TOUCH_ZOOM_OFFSET||(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,TB(this._activePointers,OB);const e=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,t=e?-e.deltaX:r.x-OB.x,s=e?-e.deltaY:r.y-OB.y;if(r.copy(OB),(this._state&uB.ROTATE)!==uB.ROTATE&&(this._state&uB.TOUCH_ROTATE)!==uB.TOUCH_ROTATE&&(this._state&uB.TOUCH_DOLLY_ROTATE)!==uB.TOUCH_DOLLY_ROTATE&&(this._state&uB.TOUCH_ZOOM_ROTATE)!==uB.TOUCH_ZOOM_ROTATE||(this._rotateInternal(t,s),this._isUserControllingRotate=!0),(this._state&uB.DOLLY)===uB.DOLLY||(this._state&uB.ZOOM)===uB.ZOOM){const e=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,r=this.dollyDragInverted?-1:1;(this._state&uB.DOLLY)===uB.DOLLY?(this._dollyInternal(r*s*BB,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(r*s*BB,e,t),this._isUserControllingZoom=!0)}if((this._state&uB.TOUCH_DOLLY)===uB.TOUCH_DOLLY||(this._state&uB.TOUCH_ZOOM)===uB.TOUCH_ZOOM||(this._state&uB.TOUCH_DOLLY_TRUCK)===uB.TOUCH_DOLLY_TRUCK||(this._state&uB.TOUCH_ZOOM_TRUCK)===uB.TOUCH_ZOOM_TRUCK||(this._state&uB.TOUCH_DOLLY_SCREEN_PAN)===uB.TOUCH_DOLLY_SCREEN_PAN||(this._state&uB.TOUCH_ZOOM_SCREEN_PAN)===uB.TOUCH_ZOOM_SCREEN_PAN||(this._state&uB.TOUCH_DOLLY_OFFSET)===uB.TOUCH_DOLLY_OFFSET||(this._state&uB.TOUCH_ZOOM_OFFSET)===uB.TOUCH_ZOOM_OFFSET||(this._state&uB.TOUCH_DOLLY_ROTATE)===uB.TOUCH_DOLLY_ROTATE||(this._state&uB.TOUCH_ZOOM_ROTATE)===uB.TOUCH_ZOOM_ROTATE){const e=OB.x-this._activePointers[1].clientX,t=OB.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t),s=i.y-n;i.set(0,n);const a=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,o=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&uB.TOUCH_DOLLY)===uB.TOUCH_DOLLY||(this._state&uB.TOUCH_DOLLY_ROTATE)===uB.TOUCH_DOLLY_ROTATE||(this._state&uB.TOUCH_DOLLY_TRUCK)===uB.TOUCH_DOLLY_TRUCK||(this._state&uB.TOUCH_DOLLY_SCREEN_PAN)===uB.TOUCH_DOLLY_SCREEN_PAN||(this._state&uB.TOUCH_DOLLY_OFFSET)===uB.TOUCH_DOLLY_OFFSET?(this._dollyInternal(s*BB,a,o),this._isUserControllingDolly=!0):(this._zoomInternal(s*BB,a,o),this._isUserControllingZoom=!0)}(this._state&uB.TRUCK)!==uB.TRUCK&&(this._state&uB.TOUCH_TRUCK)!==uB.TOUCH_TRUCK&&(this._state&uB.TOUCH_DOLLY_TRUCK)!==uB.TOUCH_DOLLY_TRUCK&&(this._state&uB.TOUCH_ZOOM_TRUCK)!==uB.TOUCH_ZOOM_TRUCK||(this._truckInternal(t,s,!1,!1),this._isUserControllingTruck=!0),(this._state&uB.SCREEN_PAN)!==uB.SCREEN_PAN&&(this._state&uB.TOUCH_SCREEN_PAN)!==uB.TOUCH_SCREEN_PAN&&(this._state&uB.TOUCH_DOLLY_SCREEN_PAN)!==uB.TOUCH_DOLLY_SCREEN_PAN&&(this._state&uB.TOUCH_ZOOM_SCREEN_PAN)!==uB.TOUCH_ZOOM_SCREEN_PAN||(this._truckInternal(t,s,!1,!0),this._isUserControllingTruck=!0),(this._state&uB.OFFSET)!==uB.OFFSET&&(this._state&uB.TOUCH_OFFSET)!==uB.TOUCH_OFFSET&&(this._state&uB.TOUCH_DOLLY_OFFSET)!==uB.TOUCH_DOLLY_OFFSET&&(this._state&uB.TOUCH_ZOOM_OFFSET)!==uB.TOUCH_ZOOM_OFFSET||(this._truckInternal(t,s,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},f=()=>{TB(this._activePointers,OB),r.copy(OB),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",o),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",o),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",p),this._domElement.ownerDocument.addEventListener("pointerlockerror",m),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",o),h())},this.unlockPointer=()=>{var e,t,n;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null===(e=this._domElement)||void 0===e||e.ownerDocument.exitPointerLock(),null===(t=this._domElement)||void 0===t||t.ownerDocument.removeEventListener("pointerlockchange",p),null===(n=this._domElement)||void 0===n||n.ownerDocument.removeEventListener("pointerlockerror",m),this.cancel()};const p=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},m=()=>{this.unlockPointer()};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",s),this._domElement.addEventListener("pointercancel",o),this._domElement.addEventListener("wheel",c,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",s),this._domElement.removeEventListener("pointercancel",o),this._domElement.removeEventListener("wheel",c,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",o),this._domElement.ownerDocument.removeEventListener("pointerlockchange",p),this._domElement.ownerDocument.removeEventListener("pointerlockerror",m))},this.cancel=()=>{this._state!==uB.NONE&&(this._state=uB.NONE,this._activePointers.length=0,f())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=yB(e.width,0,1),this._interactiveArea.height=yB(e.height,0,1),this._interactiveArea.x=yB(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=yB(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const r=yB(e,this.minAzimuthAngle,this.maxAzimuthAngle),i=yB(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=i,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const s=!n||_B(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&_B(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(s)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=hB,this._changedDolly=0,this._dollyToNoClamp(yB(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const t=this._collisionTest(),r=_B(t,this._spherical.radius);if(!(n>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,t)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const r=!t||_B(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(GB).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||_B(this._target.x,this._targetEnd.x,this.restThreshold)&&_B(this._target.y,this._targetEnd.y,this.restThreshold)&&_B(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=yB(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||_B(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),QB.setFromMatrixColumn(this._camera.matrix,0),HB.setFromMatrixColumn(this._camera.matrix,1),QB.multiplyScalar(e),HB.multiplyScalar(-t);const r=UB.copy(QB).add(HB),i=NB.copy(this._targetEnd).add(r);return this.moveTo(i.x,i.y,i.z,n)}forward(e,t=!1){UB.setFromMatrixColumn(this._camera.matrix,0),UB.crossVectors(this._camera.up,UB),UB.multiplyScalar(e);const n=NB.copy(this._targetEnd).add(UB);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return UB.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+UB.x,this._targetEnd.y+UB.y,this._targetEnd.z+UB.z,t)}moveTo(e,t,n,r=!1){this._isUserControllingTruck=!1;const i=UB.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,i,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const s=!r||_B(this._target.x,this._targetEnd.x,this.restThreshold)&&_B(this._target.y,this._targetEnd.y,this.restThreshold)&&_B(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}lookInDirectionOf(e,t,n,r=!1){const i=UB.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(i.x,i.y,i.z,r)}fitToBox(e,t,{cover:n=!1,paddingLeft:r=0,paddingRight:i=0,paddingBottom:s=0,paddingTop:a=0}={}){const o=[],l=e.isBox3?qB.copy(e):qB.setFromObject(e);l.isEmpty()&&Promise.resolve();const c=xB(this._sphericalEnd.theta,AB),u=xB(this._sphericalEnd.phi,AB);o.push(this.rotateTo(c,u,t));const h=UB.setFromSpherical(this._sphericalEnd).normalize(),d=JB.setFromUnitVectors(h,FB),f=_B(Math.abs(h.y),1);f&&d.multiply(ZB.setFromAxisAngle(kB,c)),d.multiply(this._yAxisUpSpaceInverse);const p=XB.makeEmpty();NB.copy(l.min).applyQuaternion(d),p.expandByPoint(NB),NB.copy(l.min).setX(l.max.x).applyQuaternion(d),p.expandByPoint(NB),NB.copy(l.min).setY(l.max.y).applyQuaternion(d),p.expandByPoint(NB),NB.copy(l.max).setZ(l.min.z).applyQuaternion(d),p.expandByPoint(NB),NB.copy(l.min).setZ(l.max.z).applyQuaternion(d),p.expandByPoint(NB),NB.copy(l.max).setY(l.min.y).applyQuaternion(d),p.expandByPoint(NB),NB.copy(l.max).setX(l.min.x).applyQuaternion(d),p.expandByPoint(NB),NB.copy(l.max).applyQuaternion(d),p.expandByPoint(NB),p.min.x-=r,p.min.y-=s,p.max.x+=i,p.max.y+=a,d.setFromUnitVectors(FB,h),f&&d.premultiply(ZB.invert()),d.premultiply(this._yAxisUpSpace);const m=p.getSize(UB),g=p.getCenter(NB).applyQuaternion(d);if(pB(this._camera)){const e=this.getDistanceToFitBox(m.x,m.y,m.z,n);o.push(this.moveTo(g.x,g.y,g.z,t)),o.push(this.dollyTo(e,t)),o.push(this.setFocalOffset(0,0,0,t))}else if(mB(this._camera)){const e=this._camera,r=e.right-e.left,i=e.top-e.bottom,s=n?Math.max(r/m.x,i/m.y):Math.min(r/m.x,i/m.y);o.push(this.moveTo(g.x,g.y,g.z,t)),o.push(this.zoomTo(s,t)),o.push(this.setFocalOffset(0,0,0,t))}return Promise.all(o)}fitToSphere(e,t){const n=[],r="isObject3D"in e?nP.createBoundingSphere(e,$B):$B.copy(e);if(n.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),pB(this._camera)){const e=this.getDistanceToFitSphere(r.radius);n.push(this.dollyTo(e,t))}else if(mB(this._camera)){const e=this._camera.right-this._camera.left,i=this._camera.top-this._camera.bottom,s=2*r.radius,a=Math.min(e/s,i/s);n.push(this.zoomTo(a,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,r,i,s,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=hB,this._changedDolly=0;const o=NB.set(r,i,s),l=UB.set(e,t,n);this._targetEnd.copy(o),this._sphericalEnd.setFromVector3(l.sub(o).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!a||_B(this._target.x,this._targetEnd.x,this.restThreshold)&&_B(this._target.y,this._targetEnd.y,this.restThreshold)&&_B(this._target.z,this._targetEnd.z,this.restThreshold)&&_B(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&_B(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&_B(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,n,r,i,s,a,o,l,c,u,h,d,f=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=hB,this._changedDolly=0;const p=UB.set(r,i,s),m=NB.set(e,t,n);YB.setFromVector3(m.sub(p).applyQuaternion(this._yAxisUpSpace));const g=zB.set(c,u,h),A=NB.set(a,o,l);KB.setFromVector3(A.sub(g).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(g,d));const v=KB.theta-YB.theta,y=KB.phi-YB.phi,E=KB.radius-YB.radius;this._sphericalEnd.set(YB.radius+E*d,YB.phi+y*d,YB.theta+v*d),this.normalizeRotations(),this._needsUpdate=!0,f||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const _=!f||_B(this._target.x,this._targetEnd.x,this.restThreshold)&&_B(this._target.y,this._targetEnd.y,this.restThreshold)&&_B(this._target.z,this._targetEnd.z,this.restThreshold)&&_B(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&_B(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&_B(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(_)}setPosition(e,t,n,r=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,n,r=!1){const i=this.getPosition(UB),s=this.setLookAt(i.x,i.y,i.z,e,t,n,r);return this._sphericalEnd.phi=yB(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),s}setFocalOffset(e,t,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const i=!r||_B(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&_B(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&_B(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),QB.setFromMatrixColumn(this._camera.matrixWorldInverse,0),HB.setFromMatrixColumn(this._camera.matrixWorldInverse,1),VB.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=UB.set(e,t,n),i=r.distanceTo(this._camera.position),s=r.sub(this._camera.position);QB.multiplyScalar(s.x),HB.multiplyScalar(s.y),VB.multiplyScalar(s.z),UB.copy(QB).add(HB).add(VB),UB.z=UB.z+i,this.dollyTo(i,!1),this.setFocalOffset(-UB.x,UB.y,-UB.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,r){null!==e?(this._viewport=this._viewport||new DB.Vector4,"number"==typeof e?this._viewport.set(e,t,n,r):this._viewport.copy(e)):this._viewport=null}getDistanceToFitBox(e,t,n,r=!1){if(MB(this._camera))return this._spherical.radius;const i=e/t,s=this._camera.getEffectiveFOV()*vB,a=this._camera.aspect;return.5*((r?i>a:i<a)?t:e/a)/Math.tan(.5*s)+.5*n}getDistanceToFitSphere(e){if(MB(this._camera))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*vB,n=2*Math.atan(Math.tan(.5*t)*this._camera.aspect),r=1<this._camera.aspect?t:n;return e/Math.sin(.5*r)}getTarget(e,t=!0){return(e&&e.isVector3?e:new DB.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new DB.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new DB.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new DB.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%gB,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=gB),this._spherical.theta+=gB*Math.round((this._sphericalEnd.theta-this._spherical.theta)/gB)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!_B(this._camera.up.x,this._cameraUp0.x)||!_B(this._camera.up.y,this._cameraUp0.y)||!_B(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const e=this.getPosition(UB);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,kB),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=UB.subVectors(this._target,this._camera.position).normalize(),t=NB.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(UB);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,i=jB.subVectors(this._targetEnd,this._target),s=WB.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(EB(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=wB(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(EB(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=wB(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(EB(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=wB(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(EB(i.x)&&EB(i.y)&&EB(i.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;CB(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(EB(s.x)&&EB(s.y)&&EB(s.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;CB(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(EB(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=wB(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}if(this.dollyToCursor)if(pB(this._camera)&&0!==this._changedDolly){const e=this._spherical.radius-this._lastDistance,t=this._camera,n=this._getCameraDirection(GB),r=UB.copy(n).cross(t.up).normalize();0===r.lengthSq()&&(r.x=1);const i=NB.crossVectors(r,n),s=this._sphericalEnd.radius*Math.tan(t.getEffectiveFOV()*vB*.5),a=(this._sphericalEnd.radius-e-this._sphericalEnd.radius)/this._sphericalEnd.radius,o=zB.copy(this._targetEnd).add(r.multiplyScalar(this._dollyControlCoord.x*s*t.aspect)).add(i.multiplyScalar(this._dollyControlCoord.y*s)),l=UB.copy(this._targetEnd).lerp(o,a),c=this._lastDollyDirection===dB&&this._spherical.radius<=this.minDistance,u=this._lastDollyDirection===fB&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(c||u)){this._sphericalEnd.radius-=e,this._spherical.radius-=e;const t=NB.copy(n).multiplyScalar(-e);l.add(t)}this._boundary.clampPoint(l,l);const h=NB.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(h),this._changedDolly-=e,EB(this._changedDolly)&&(this._changedDolly=0)}else if(mB(this._camera)&&0!==this._changedZoom){const e=this._zoom-this._lastZoom,t=this._camera,n=UB.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.near+t.far)/(t.near-t.far)).unproject(t),r=NB.set(0,0,-1).applyQuaternion(t.quaternion),i=zB.copy(n).add(r.multiplyScalar(-n.dot(t.up))),s=-(this._zoom-e-this._zoom)/this._zoom,a=this._getCameraDirection(GB),o=this._targetEnd.dot(a),l=UB.copy(this._targetEnd).lerp(i,s),c=l.dot(a),u=a.multiplyScalar(c-o);l.sub(u),this._boundary.clampPoint(l,l);const h=NB.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(h),this._changedZoom-=e,EB(this._changedZoom)&&(this._changedZoom=0)}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const o=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,o),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target);(!EB(this._focalOffset.x)||!EB(this._focalOffset.y)||!EB(this._focalOffset.z))&&(QB.setFromMatrixColumn(this._camera.matrix,0),HB.setFromMatrixColumn(this._camera.matrix,1),VB.setFromMatrixColumn(this._camera.matrix,2),QB.multiplyScalar(this._focalOffset.x),HB.multiplyScalar(-this._focalOffset.y),VB.multiplyScalar(this._focalOffset.z),UB.copy(QB).add(HB).add(VB),this._camera.position.add(UB),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),UB.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):l?(this.dispatchEvent({type:"update"}),EB(t,this.restThreshold)&&EB(n,this.restThreshold)&&EB(r,this.restThreshold)&&EB(i.x,this.restThreshold)&&EB(i.y,this.restThreshold)&&EB(i.z,this.restThreshold)&&EB(s.x,this.restThreshold)&&EB(s.y,this.restThreshold)&&EB(s.z,this.restThreshold)&&EB(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!l&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=l,this._needsUpdate=!1,l}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:bB(this.maxDistance),minZoom:this.minZoom,maxZoom:bB(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:bB(this.maxPolarAngle),minAzimuthAngle:bB(this.minAzimuthAngle),maxAzimuthAngle:bB(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:UB.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=SB(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=SB(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=SB(n.maxPolarAngle),this.minAzimuthAngle=SB(n.minAzimuthAngle),this.maxAzimuthAngle=SB(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),YB.setFromVector3(UB.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(YB.theta,YB.phi,t),this.dollyTo(YB.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){this._domElement||(e.setAttribute("data-camera-controls-version","2.10.1"),this._addAllEventListeners(e),this._getClientRect(this._elementRect))}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const r=t.lengthSq();if(0===r)return e;const i=NB.copy(t).add(e),s=this._boundary.clampPoint(i,zB).sub(i),a=s.lengthSq();if(0===a)return e.add(t);if(a===r)return e;if(0===n)return e.add(t).add(s);{const r=1+n*a/t.dot(s);return e.add(NB.copy(t).multiplyScalar(r)).add(s.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(pB(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*vB,r=Math.tan(.5*n)*t,i=r*e.aspect;this._nearPlaneCorners[0].set(-i,-r,0),this._nearPlaneCorners[1].set(i,-r,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(-i,r,0)}else if(mB(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,r=e.right*t,i=e.top*t,s=e.bottom*t;this._nearPlaneCorners[0].set(n,i,0),this._nearPlaneCorners[1].set(r,i,0),this._nearPlaneCorners[2].set(r,s,0),this._nearPlaneCorners[3].set(n,s,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1))return e;if(MB(this._camera))return e;const t=this._getTargetDirection(GB);eP.lookAt(LB,t,this._camera.up);for(let n=0;n<4;n++){const r=NB.copy(this._nearPlaneCorners[n]);r.applyMatrix4(eP);const i=zB.addVectors(this._target,r);tP.set(i,t),tP.far=this._spherical.radius+1;const s=tP.intersectObjects(this.colliderMeshes);0!==s.length&&s[0].distance<e&&(e=s[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return 0}set dampingFactor(e){}get draggingDampingFactor(){return 0}set draggingDampingFactor(e){}static createBoundingSphere(e,t=new DB.Sphere){const n=t,r=n.center;qB.makeEmpty(),e.traverseVisible(e=>{e.isMesh&&qB.expandByObject(e)}),qB.getCenter(r);let i=0;return e.traverseVisible(e=>{if(!e.isMesh)return;const t=e;if(!t.geometry)return;const n=t.geometry.clone();n.applyMatrix4(t.matrixWorld);const s=n.attributes.position;for(let e=0,t=s.count;e<t;e++)UB.fromBufferAttribute(s,e),i=Math.max(i,r.distanceToSquared(UB))}),n.radius=Math.sqrt(i),n}}const rP=c((t,n)=>{l(()=>{const e={Box3:Fn,MathUtils:{clamp:tn.clamp},Matrix4:cr,Quaternion:Pn,Raycaster:Ed,Sphere:er,Spherical:bd,Vector2:nn,Vector3:Dn,Vector4:Tn};nP.install({THREE:e}),Hf({CameraControlsImpl:nP})},[]);const{camera:r,domElement:i,makeDefault:a,onStart:o,onEnd:c,onChange:u,regress:h,...d}=t,f=zp(e=>e.camera),p=zp(e=>e.gl),m=zp(e=>e.invalidate),g=zp(e=>e.events),A=zp(e=>e.setEvents),v=zp(e=>e.set),y=zp(e=>e.get),E=zp(e=>e.performance),_=r||f,x=i||g.connected||p.domElement,b=l(()=>new nP(_),[_]);return Gp((e,t)=>{b.enabled&&b.update(t)},-1),s(()=>(b.connect(x),()=>{b.disconnect()}),[x,b]),s(()=>{const e=e=>{m(),h&&E.regress(),u&&u(e)},t=e=>{o&&o(e)},n=e=>{c&&c(e)};return b.addEventListener("update",e),b.addEventListener("controlstart",t),b.addEventListener("controlend",n),b.addEventListener("control",e),b.addEventListener("transitionstart",e),b.addEventListener("wake",e),()=>{b.removeEventListener("update",e),b.removeEventListener("controlstart",t),b.removeEventListener("controlend",n),b.removeEventListener("control",e),b.removeEventListener("transitionstart",e),b.removeEventListener("wake",e)}},[b,o,c,m,A,h,u]),s(()=>{if(a){const e=y().controls;return v({controls:b}),()=>v({controls:e})}},[a,b]),e.createElement("primitive",Lm({ref:n,object:b},d))}),iP=e.createContext(null);function sP(){const t=e.useContext(iP);if(!t)throw new Error("useMotion hook must be used in a MotionPathControls component.");return t}function aP({points:t=50,color:n="black"}){const{path:r}=sP(),[i,s]=e.useState([]),a=e.useMemo(()=>new ti({color:n}),[n]),o=e.useMemo(()=>new Eu(.025,16,16),[]),l=e.useRef([]);return e.useEffect(()=>{r.curves!==l.current&&(s(r.getPoints(t)),l.current=r.curves)}),i.map((t,n)=>e.createElement("mesh",{key:n,material:a,geometry:o,position:[t.x,t.y,t.z]}))}const oP=e.forwardRef(({children:t,curves:n=[],debug:r=!1,debugColor:i="black",object:s,focus:a,loop:o=!0,offset:l,smooth:c=!1,eps:u=1e-5,damping:h=.1,focusDamping:d=.1,maxSpeed:f=1/0,...p},m)=>{const{camera:g}=zp(),A=e.useRef(null),v=e.useRef(null!=l?l:0),y=e.useMemo(()=>new wc,[]),E=e.useMemo(()=>({focus:a,object:(null==s?void 0:s.current)instanceof Lr?s:{current:g},path:y,current:v.current,offset:v.current,point:new Dn,tangent:new Dn,next:new Dn}),[a,s]);e.useLayoutEffect(()=>{var e,t;y.curves=[];const r=n.length>0?n:null!==(e=null==(t=A.current)||null==(t=t.__r3f)?void 0:t.objects)&&void 0!==e?e:[];for(let e=0;e<r.length;e++)y.add(r[e]);if(c){const e=y.getPoints("number"==typeof c?c:1),t=new fc(e);y.curves=[t]}y.updateArcLengths()}),e.useImperativeHandle(m,()=>Object.assign(A.current,{motion:E}),[E]),e.useLayoutEffect(()=>{v.current=VA.repeat(v.current,1)},[l]);const _=e.useMemo(()=>new Dn,[]);return Gp((e,t)=>{const n=E.offset;if(Jv.damp(v,"current",void 0!==l?l:E.current,h,t,f,void 0,u),E.offset=o?VA.repeat(v.current,1):VA.clamp(v.current,0,1),y.getCurveLengths().length>0){y.getPointAt(E.offset,E.point),y.getTangentAt(E.offset,E.tangent).normalize(),y.getPointAt(VA.repeat(v.current-(n-E.offset),1),E.next);const e=(null==s?void 0:s.current)instanceof Lr?s.current:g;e.position.copy(E.point),a&&Jv.dampLookAt(e,(e=>(null==e?void 0:e.current)instanceof Lr)(a)?a.current.getWorldPosition(_):a,d,t,f,void 0,u)}}),e.createElement("group",Lm({ref:A},p),e.createElement(iP.Provider,{value:E},t,r&&e.createElement(aP,{color:i})))});function lP({defaultScene:t,defaultCamera:n,renderPriority:r=1}){const{gl:i,scene:s,camera:a}=zp();let o;return Gp(()=>{o=i.autoClear,1===r&&(i.autoClear=!0,i.render(t,n)),i.autoClear=!1,i.clearDepth(),i.render(s,a),i.autoClear=o},r),e.createElement("group",{onPointerOver:()=>null})}function cP({children:t,renderPriority:n=1}){const{scene:r,camera:i}=zp(),[s]=e.useState(()=>new jo);return e.createElement(e.Fragment,null,rm(e.createElement(e.Fragment,null,t,e.createElement(lP,{defaultScene:r,defaultCamera:i,renderPriority:n})),s,{events:{priority:n+1}}))}const uP=e.createContext({}),hP=()=>e.useContext(uP),dP=2*Math.PI,fP=new Lr,pP=new cr,[mP,gP]=[new Pn,new Pn],AP=new Dn,vP=new Dn,yP=e=>"getTarget"in e,EP=({alignment:t="bottom-right",margin:n=[80,80],renderPriority:r=1,onUpdate:i,onTarget:s,children:a})=>{const o=zp(e=>e.size),l=zp(e=>e.camera),c=zp(e=>e.controls),u=zp(e=>e.invalidate),h=e.useRef(null),d=e.useRef(null),f=e.useRef(!1),p=e.useRef(0),m=e.useRef(new Dn(0,0,0)),g=e.useRef(new Dn(0,0,0));e.useEffect(()=>{g.current.copy(l.up),fP.up.copy(l.up)},[l]);const A=e.useCallback(e=>{f.current=!0,(c||s)&&(m.current=(null==s?void 0:s())||(yP(c)?c.getTarget(m.current):null==c?void 0:c.target)),p.current=l.position.distanceTo(AP),mP.copy(l.quaternion),vP.copy(e).multiplyScalar(p.current).add(AP),fP.lookAt(vP),gP.copy(fP.quaternion),u()},[c,l,s,u]);Gp((e,t)=>{if(d.current&&h.current){var n;if(f.current)if(mP.angleTo(gP)<.01)f.current=!1,"minPolarAngle"in c&&l.up.copy(g.current);else{const e=t*dP;mP.rotateTowards(gP,e),l.position.set(0,0,1).applyQuaternion(mP).multiplyScalar(p.current).add(m.current),l.up.set(0,1,0).applyQuaternion(mP).normalize(),l.quaternion.copy(mP),yP(c)&&c.setPosition(l.position.x,l.position.y,l.position.z),i?i():c&&c.update(t),u()}pP.copy(l.matrix).invert(),null==(n=h.current)||n.quaternion.setFromRotationMatrix(pP)}});const v=e.useMemo(()=>({tweenCamera:A}),[A]),[y,E]=n,_=t.endsWith("-center")?0:t.endsWith("-left")?-o.width/2+y:o.width/2-y,x=t.startsWith("center-")?0:t.startsWith("top-")?o.height/2-E:-o.height/2+E;return e.createElement(cP,{renderPriority:r},e.createElement(uP.Provider,{value:v},e.createElement(KR,{makeDefault:!0,ref:d,position:[0,0,200]}),e.createElement("group",{ref:h,position:[_,x,0]},a)))},_P="#f0f0f0",xP="#999",bP="black",SP="black",wP=["Right","Left","Top","Bottom","Front","Back"],CP=e=>new Dn(...e).multiplyScalar(.38),TP=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(CP),MP=[.25,.25,.25],IP=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(CP),RP=IP.map(e=>e.toArray().map(e=>0==e?.5:.25)),BP=({hover:t,index:n,font:r="20px Inter var, Arial, sans-serif",faces:i=wP,color:s=_P,hoverColor:a=xP,textColor:o=bP,strokeColor:l=SP,opacity:c=1})=>{const u=zp(e=>e.gl),h=e.useMemo(()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const t=e.getContext("2d");return t.fillStyle=s,t.fillRect(0,0,e.width,e.height),t.strokeStyle=l,t.strokeRect(0,0,e.width,e.height),t.font=r,t.textAlign="center",t.fillStyle=o,t.fillText(i[n].toUpperCase(),64,76),new ic(e)},[n,i,r,s,o,l]);return e.createElement("meshBasicMaterial",{map:h,"map-anisotropy":u.capabilities.getMaxAnisotropy()||1,attach:`material-${n}`,color:t?a:"white",transparent:!0,opacity:c})},PP=t=>{const{tweenCamera:n}=hP(),[r,i]=e.useState(null);return e.createElement("mesh",{onPointerOut:e=>{e.stopPropagation(),i(null)},onPointerMove:e=>{e.stopPropagation(),i(Math.floor(e.faceIndex/2))},onClick:t.onClick||(e=>{e.stopPropagation(),n(e.face.normal)})},[...Array(6)].map((n,i)=>e.createElement(BP,Lm({key:i,index:i,hover:r===i},t))),e.createElement("boxGeometry",null))},DP=({onClick:t,dimensions:n,position:r,hoverColor:i=xP})=>{const{tweenCamera:s}=hP(),[a,o]=e.useState(!1);return e.createElement("mesh",{scale:1.01,position:r,onPointerOver:e=>{e.stopPropagation(),o(!0)},onPointerOut:e=>{e.stopPropagation(),o(!1)},onClick:t||(e=>{e.stopPropagation(),s(r)})},e.createElement("meshBasicMaterial",{color:a?i:"white",transparent:!0,opacity:.6,visible:a}),e.createElement("boxGeometry",{args:n}))},LP=t=>e.createElement("group",{scale:[60,60,60]},e.createElement(PP,t),IP.map((n,r)=>e.createElement(DP,Lm({key:r,position:n,dimensions:RP[r]},t))),TP.map((n,r)=>e.createElement(DP,Lm({key:r,position:n,dimensions:MP},t))));function kP({scale:t=[.8,.05,.05],color:n,rotation:r}){return e.createElement("group",{rotation:r},e.createElement("mesh",{position:[.4,0,0]},e.createElement("boxGeometry",{args:t}),e.createElement("meshBasicMaterial",{color:n,toneMapped:!1})))}function FP({onClick:t,font:n,disabled:r,arcStyle:i,label:s,labelColor:a,axisHeadScale:o=1,...l}){const c=zp(e=>e.gl),u=e.useMemo(()=>{const e=document.createElement("canvas");e.width=64,e.height=64;const t=e.getContext("2d");return t.beginPath(),t.arc(32,32,16,0,2*Math.PI),t.closePath(),t.fillStyle=i,t.fill(),s&&(t.font=n,t.textAlign="center",t.fillStyle=a,t.fillText(s,32,41)),new ic(e)},[i,s,a,n]),[h,d]=e.useState(!1),f=(s?1:.75)*(h?1.2:1)*o;return e.createElement("sprite",Lm({scale:f,onPointerOver:r?void 0:e=>{e.stopPropagation(),d(!0)},onPointerOut:r?void 0:t||(e=>{e.stopPropagation(),d(!1)})},l),e.createElement("spriteMaterial",{map:u,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}const OP=({hideNegativeAxes:t,hideAxisHeads:n,disabled:r,font:i="18px Inter var, Arial, sans-serif",axisColors:s=["#ff2060","#20df80","#2080ff"],axisHeadScale:a=1,axisScale:o,labels:l=["X","Y","Z"],labelColor:c="#000",onClick:u,...h})=>{const[d,f,p]=s,{tweenCamera:m}=hP(),g={font:i,disabled:r,labelColor:c,onClick:u,axisHeadScale:a,onPointerDown:r?void 0:e=>{m(e.object.position),e.stopPropagation()}};return e.createElement("group",Lm({scale:40},h),e.createElement(kP,{color:d,rotation:[0,0,0],scale:o}),e.createElement(kP,{color:f,rotation:[0,0,Math.PI/2],scale:o}),e.createElement(kP,{color:p,rotation:[0,-Math.PI/2,0],scale:o}),!n&&e.createElement(e.Fragment,null,e.createElement(FP,Lm({arcStyle:d,position:[1,0,0],label:l[0]},g)),e.createElement(FP,Lm({arcStyle:f,position:[0,1,0],label:l[1]},g)),e.createElement(FP,Lm({arcStyle:p,position:[0,0,1],label:l[2]},g)),!t&&e.createElement(e.Fragment,null,e.createElement(FP,Lm({arcStyle:d,position:[-1,0,0]},g)),e.createElement(FP,Lm({arcStyle:f,position:[0,-1,0]},g)),e.createElement(FP,Lm({arcStyle:p,position:[0,0,-1]},g)))))},UP=tR({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new $r,sectionColor:new $r,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new Dn,worldPlanePosition:new Dn},"\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform vec3 worldPlanePosition;\n    uniform float fadeDistance;\n    uniform bool infiniteGrid;\n    uniform bool followCamera;\n\n    void main() {\n      localPosition = position.xzy;\n      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;\n      \n      worldPosition = modelMatrix * vec4(localPosition, 1.0);\n      if (followCamera) {\n        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);\n        localPosition = (inverse(modelMatrix) * worldPosition).xyz;\n      }\n\n      gl_Position = projectionMatrix * viewMatrix * worldPosition;\n    }\n  ",`\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform float cellSize;\n    uniform float sectionSize;\n    uniform vec3 cellColor;\n    uniform vec3 sectionColor;\n    uniform float fadeDistance;\n    uniform float fadeStrength;\n    uniform float fadeFrom;\n    uniform float cellThickness;\n    uniform float sectionThickness;\n\n    float getGrid(float size, float thickness) {\n      vec2 r = localPosition.xz / size;\n      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);\n      float line = min(grid.x, grid.y) + 1.0 - thickness;\n      return 1.0 - min(line, 1.0);\n    }\n\n    void main() {\n      float g1 = getGrid(cellSize, cellThickness);\n      float g2 = getGrid(sectionSize, sectionThickness);\n\n      vec3 from = worldCamProjPosition*vec3(fadeFrom);\n      float dist = distance(from, worldPosition.xyz);\n      float d = 1.0 - min(dist / fadeDistance, 1.0);\n      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));\n\n      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));\n      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);\n      if (gl_FragColor.a <= 0.0) discard;\n\n      #include <tonemapping_fragment>\n      #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n    }\n  `),NP=e.forwardRef(({args:t,cellColor:n="#000000",sectionColor:r="#2080ff",cellSize:i=.5,sectionSize:s=1,followCamera:a=!1,infiniteGrid:o=!1,fadeDistance:l=100,fadeStrength:c=1,fadeFrom:u=1,cellThickness:h=.5,sectionThickness:d=1,side:f=1,...p},m)=>{Hf({GridMaterial:UP});const g=e.useRef(null);e.useImperativeHandle(m,()=>g.current,[]);const A=new ts,v=new Dn(0,1,0),y=new Dn(0,0,0);Gp(e=>{A.setFromNormalAndCoplanarPoint(v,y).applyMatrix4(g.current.matrixWorld);const t=g.current.material,n=t.uniforms.worldCamProjPosition,r=t.uniforms.worldPlanePosition;A.projectPoint(e.camera.position,n.value),r.value.set(0,0,0).applyMatrix4(g.current.matrixWorld)});const E={cellSize:i,sectionSize:s,cellColor:n,sectionColor:r,cellThickness:h,sectionThickness:d},_={fadeDistance:l,fadeStrength:c,fadeFrom:u,infiniteGrid:o,followCamera:a};return e.createElement("mesh",Lm({ref:g,frustumCulled:!1},p),e.createElement("gridMaterial",Lm({transparent:!0,"extensions-derivatives":!0,side:f},E,_)),e.createElement("planeGeometry",{args:t}))});function zP(e,{path:t}){const[n]=jp(dh,[e],e=>e.setPath(t));return n}function GP({children:t,files:n,...r}){const i=zP(n,{...r});return e.createElement(e.Fragment,null,null==t?void 0:t(i))}function QP(e){return jp(yC,e)}function HP({path:t,...n}){const r=QP(t).children[0];return e.createElement(TR,Lm({},n,{object:r}))}zP.preload=(e,{path:t})=>jp.preload(dh,[e],e=>e.setPath(t)),QP.preload=e=>jp.preload(yC,e),QP.clear=e=>jp.clear(yC,e);const VP="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function jP(e,t=`${VP}/basis/`){const n=zp(e=>e.gl),r=jp(ST,nR(e)?Object.values(e):e,e=>{e.detectSupport(n),e.setTranscoderPath(t)});if(s(()=>{(Array.isArray(r)?r:[r]).forEach(n.initTexture)},[n,r]),nR(e)){const t=Object.keys(e),n={};return t.forEach(e=>Object.assign(n,{[e]:r[t.indexOf(e)]})),n}return r}jP.preload=(e,t=`${VP}/basis/`)=>jp.preload(ST,e,e=>{e.setTranscoderPath(t)}),jP.clear=e=>jp.clear(ST,e);const WP=({children:t,input:n,basisPath:r})=>{const i=jP(n,r);return e.createElement(e.Fragment,null,null==t?void 0:t(i))},YP=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},KP=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=qP},qP=Number.MAX_SAFE_INTEGER||9007199254740991;let XP=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),$P=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),JP=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var ZP="manifest",eD="level",tD="audioTrack",nD="subtitleTrack",rD={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class iD{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class sD{constructor(e,t,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new iD(e),this.fast_=new iD(t),this.defaultTTFB_=r,this.ttfb_=new iD(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:i}=this;n.halfLife!==e&&(this.slow_=new iD(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new iD(t,r.getEstimate(),r.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new iD(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){const n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function aD(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oD(){return oD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},oD.apply(null,arguments)}function lD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lD(Object(n),!0).forEach(function(t){aD(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lD(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class uD{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=hD,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const hD=function(){},dD={trace:hD,debug:hD,log:hD,warn:hD,info:hD,error:hD};function fD(){return oD({},dD)}function pD(e,t,n){return t[e]?t[e].bind(t):function(e,t){const n=self.console[e];return n?n.bind(self.console,`${t?"["+t+"] ":""}[${e}] >`):hD}(e,n)}const mD=fD();const gD=mD;function AD(e=!0){if("undefined"==typeof self)return;return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function vD(e,t){const n=Object.keys(e),r=Object.keys(t),i=n.length,s=r.length;return!i||!s||i===s&&!n.some(e=>-1===r.indexOf(e))}function yD(e,t=!1){if("undefined"!=typeof TextDecoder){const n=new TextDecoder("utf-8").decode(e);if(t){const e=n.indexOf("\0");return-1!==e?n.substring(0,e):n}return n.replace(/\0/g,"")}const n=e.length;let r,i,s,a="",o=0;for(;o<n;){if(r=e[o++],0===r&&t)return a;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:i=e[o++],a+=String.fromCharCode((31&r)<<6|63&i);break;case 14:i=e[o++],s=e[o++],a+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&s)}}return a}function ED(e){let t="";for(let n=0;n<e.length;n++){let r=e[n].toString(16);r.length<2&&(r="0"+r),t+=r}return t}function _D(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function xD(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var bD,SD={exports:{}};var wD,CD,TD,MD,ID,RD=bD?SD.exports:(bD=1,wD=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,CD=/^(?=([^\/?#]*))\1([^]*)$/,TD=/(?:\/|^)\.(?=\/)/g,MD=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,SD.exports=ID={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=ID.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=ID.normalizePath(r.path),ID.buildURLFromParts(r)}var i=ID.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return n.alwaysNormalize?(i.path=ID.normalizePath(i.path),ID.buildURLFromParts(i)):t;var s=ID.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var a=CD.exec(s.path);s.netLoc=a[1],s.path=a[2]}s.netLoc&&!s.path&&(s.path="/");var o={scheme:s.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(o.netLoc=s.netLoc,"/"!==i.path[0]))if(i.path){var l=s.path,c=l.substring(0,l.lastIndexOf("/")+1)+i.path;o.path=ID.normalizePath(c)}else o.path=s.path,i.params||(o.params=s.params,i.query||(o.query=s.query));return null===o.path&&(o.path=n.alwaysNormalize?ID.normalizePath(i.path):i.path),ID.buildURLFromParts(o)},parseURL:function(e){var t=wD.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(TD,"");e.length!==(e=e.replace(MD,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}});class BD{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var PD="audio",DD="video",LD="audiovideo";class kD{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){const n=ND(e,t);n&&(n.enumerable=!0,Object.defineProperty(e,t,n))}(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;r=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[PD]:null,[DD]:null,[LD]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new BD),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=RD.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[PD]=null,e[DD]=null,e[LD]=null}}function FD(e){return"initSegment"!==e.sn}class OD extends kD{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(YP(e)&&YP(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length){const t=this._decryptdata=this.levelkeys[e[0]]||null;if(t)return t.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=YP(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t;const e=Object.keys(this.levelkeys),n=e.length;if(n>1||1===n&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){YP(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return FD(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,n,r,i,s=!1){const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,i)):a[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:i,partial:s}}}class UD extends kD{constructor(e,t,n,r,i){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const s=e.enumeratedString("BYTERANGE");s&&this.setByteRange(s,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function ND(e,t){const n=Object.getPrototypeOf(e);if(n){const e=Object.getOwnPropertyDescriptor(n,t);return e||ND(n,t)}}const zD=Math.pow(2,32)-1,GD=[].push,QD={video:1,audio:2,id3:3,text:4};function HD(e){return String.fromCharCode.apply(null,e)}function VD(e,t){const n=e[t]<<8|e[t+1];return n<0?65536+n:n}function jD(e,t){const n=YD(e,t);return n<0?4294967296+n:n}function WD(e,t){let n=jD(e,t);return n*=Math.pow(2,32),n+=jD(e,t+4),n}function YD(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function KD(e,t){const n=[];if(!t.length)return n;const r=e.byteLength;for(let i=0;i<r;){const s=jD(e,i),a=s>1?i+s:r;if(HD(e.subarray(i+4,i+8))===t[0])if(1===t.length)n.push(e.subarray(i+8,a));else{const r=KD(e.subarray(i+8,a),t.slice(1));r.length&&GD.apply(n,r)}i=a}return n}function qD(e){const t=[],n=e[0];let r=8;const i=jD(e,r);r+=4;let s=0,a=0;0===n?(s=jD(e,r),a=jD(e,r+4),r+=8):(s=WD(e,r),a=WD(e,r+8),r+=16),r+=2;let o=e.length+a;const l=VD(e,r);r+=2;for(let n=0;n<l;n++){let n=r;const s=jD(e,n);n+=4;const a=2147483647&s;if(1===(2147483648&s)>>>31)return gD.warn("SIDX has hierarchical references (not supported)"),null;const l=jD(e,n);n+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/i,start:o,end:o+a-1}}),o+=a,n+=4,r=n}return{earliestPresentationTime:s,timescale:i,version:n,referencesCount:l,references:t}}function XD(e){const t=[],n=KD(e,["moov","trak"]);for(let e=0;e<n.length;e++){const r=n[e],i=KD(r,["tkhd"])[0];if(i){let e=i[0];const n=jD(i,0===e?12:20),s=KD(r,["mdia","mdhd"])[0];if(s){e=s[0];const i=jD(s,0===e?12:20),a=KD(r,["mdia","hdlr"])[0];if(a){const e=HD(a.subarray(8,12)),s={soun:PD,vide:DD}[e],o=$D(KD(r,["mdia","minf","stbl","stsd"])[0]);s?(t[n]={timescale:i,type:s,stsd:o},t[s]=cD({timescale:i,id:n},o)):t[n]={timescale:i,type:e,stsd:o}}}}}return KD(e,["moov","mvex","trex"]).forEach(e=>{const n=jD(e,4),r=t[n];r&&(r.default={duration:jD(e,12),flags:jD(e,20)})}),t}function $D(e){const t=e.subarray(8),n=t.subarray(86),r=HD(t.subarray(4,8));let i,s=r;const a="enca"===r||"encv"===r;if(a){const e=KD(t,[r])[0];KD(e.subarray("enca"===r?28:78),["sinf"]).forEach(e=>{const t=KD(e,["schm"])[0];if(t){const n=HD(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=KD(e,["frma"])[0];t&&(s=HD(t))}}})}const o=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const e=KD(n,["avcC"])[0];e&&e.length>3&&(s+="."+eL(e[1])+eL(e[2])+eL(e[3]),i=JD("avc1"===o?"dva1":"dvav",n));break}case"mp4a":{const e=KD(t,[r])[0],n=KD(e.subarray(28),["esds"])[0];if(n&&n.length>7){let e=4;if(3!==n[e++])break;e=ZD(n,e),e+=2;const t=n[e++];if(128&t&&(e+=2),64&t&&(e+=n[e++]),4!==n[e++])break;e=ZD(n,e);const r=n[e++];if(64!==r)break;if(s+="."+eL(r),e+=12,5!==n[e++])break;e=ZD(n,e);const i=n[e++];let a=(248&i)>>3;31===a&&(a+=1+((7&i)<<3)+((224&n[e])>>5)),s+="."+a}break}case"hvc1":case"hev1":{const e=KD(n,["hvcC"])[0];if(e&&e.length>12){const t=e[1],n=["","A","B","C"][t>>6],r=31&t,i=jD(e,2),a=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);s+="."+n+r,s+="."+function(e){let t=0;for(let n=0;n<32;n++)t|=(e>>n&1)<<31-n;return t>>>0}(i).toString(16).toUpperCase(),s+="."+a+o;let c="";for(let e=l.length;e--;){const t=l[e];if(t||c){c="."+t.toString(16).toUpperCase()+c}}s+=c}i=JD("hev1"==o?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":s=JD(s,n)||s;break;case"vp09":{const e=KD(n,["vpcC"])[0];if(e&&e.length>6){const t=e[4],n=e[5],r=e[6]>>4&15;s+="."+tL(t)+"."+tL(n)+"."+tL(r)}break}case"av01":{const e=KD(n,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,r=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,c=2===t&&o?l?12:10:o?10:8,u=(16&e[2])>>4,h=(8&e[2])>>3,d=(4&e[2])>>2,f=3&e[2],p=1,m=1,g=1,A=0;s+="."+t+"."+tL(r)+a+"."+tL(c)+"."+u+"."+h+d+f+"."+tL(p)+"."+tL(m)+"."+tL(g)+"."+A,i=JD("dav1",n)}break}}return{codec:s,encrypted:a,supplemental:i}}function JD(e,t){const n=KD(t,["dvvC"]),r=n.length?n[0]:KD(t,["dvcC"])[0];if(r){const t=r[2]>>1&127,n=r[2]<<5&32|r[3]>>3&31;return e+"."+tL(t)+"."+tL(n)}}function ZD(e,t){const n=t+5;for(;128&e[t++]&&t<n;);return t}function eL(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function tL(e){return(e<10?"0":"")+e}function nL(e){const t=KD(e,["schm"])[0];if(t){const n=HD(t.subarray(4,8));if("cbcs"===n||"cenc"===n)return KD(e,["schi","tenc"])[0]}return null}function rL(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function iL(e,t){const n=[],r=t.samples,i=t.timescale,s=t.id;let a=!1;return KD(r,["moof"]).map(o=>{const l=o.byteOffset-8;KD(o,["traf"]).map(o=>{const c=KD(o,["tfdt"]).map(e=>{const t=e[0];let n=jD(e,4);return 1===t&&(n*=Math.pow(2,32),n+=jD(e,8)),n/i})[0];return void 0!==c&&(e=c),KD(o,["tfhd"]).map(c=>{const u=jD(c,4),h=16777215&jD(c,0);let d=0;const f=!!(16&h);let p=0;const m=!!(32&h);let g=8;u===s&&(!!(1&h)&&(g+=8),!!(2&h)&&(g+=4),!!(8&h)&&(d=jD(c,g),g+=4),f&&(p=jD(c,g),g+=4),m&&(g+=4),"video"===t.type&&(a=sL(t.codec)),KD(o,["trun"]).map(s=>{const o=s[0],c=16777215&jD(s,0),u=!!(1&c);let h=0;const f=!!(4&c),m=!!(256&c);let g=0;const A=!!(512&c);let v=0;const y=!!(1024&c),E=!!(2048&c);let _=0;const x=jD(s,4);let b=8;u&&(h=jD(s,b),b+=4),f&&(b+=4);let S=h+l;for(let l=0;l<x;l++){if(m?(g=jD(s,b),b+=4):g=d,A?(v=jD(s,b),b+=4):v=p,y&&(b+=4),E&&(_=0===o?jD(s,b):YD(s,b),b+=4),t.type===DD){let t=0;for(;t<v;){const s=jD(r,S);if(S+=4,aL(a,r[S])){oL(r.subarray(S,S+s),a?2:1,e+_/i,n)}S+=s,t+=s+4}}e+=g/i}}))})})}),n}function sL(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function aL(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function oL(e,t,n,r){const i=lL(e);let s=0;s+=t;let a=0,o=0,l=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;l=i[s++],a+=l}while(255===l);o=0;do{if(s>=i.length)break;l=i[s++],o+=l}while(255===l);const e=i.length-s;let t=s;if(o<e)s+=o;else if(o>e){gD.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===a){if(181===i[t++]){const e=VD(i,t);if(t+=2,49===e){const e=jD(i,t);if(t+=4,1195456820===e){const e=i[t++];if(3===e){const s=i[t++],o=64&s,l=o?2+3*(31&s):0,c=new Uint8Array(l);if(o){c[0]=s;for(let e=1;e<l;e++)c[e]=i[t++]}r.push({type:e,payloadType:a,pts:n,bytes:c})}}}}}else if(5===a&&o>16){const e=[];for(let n=0;n<16;n++){const r=i[t++].toString(16);e.push(1==r.length?"0"+r:r),3!==n&&5!==n&&7!==n&&9!==n||e.push("-")}const s=o-16,l=new Uint8Array(s);for(let e=0;e<s;e++)l[e]=i[t++];r.push({payloadType:a,pts:n,uuid:e.join(""),userData:yD(l),userDataBytes:l})}}}function lL(e){const t=e.byteLength,n=[];let r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;const i=t-n.length,s=new Uint8Array(i);let a=0;for(r=0;r<i;a++,r++)a===n[0]&&(a++,n.shift()),s[r]=e[a];return s}function cL(e,t,n){if(16!==e.byteLength)throw new RangeError("Invalid system id");let r,i,s;r=0,i=new Uint8Array,s=new Uint8Array;const a=new Uint8Array(4);return n.byteLength>0&&new DataView(a.buffer).setUint32(0,n.byteLength,!1),function(e,...t){const n=t.length;let r=8,i=n;for(;i--;)r+=t[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(e,4),i=0,r=8;i<n;i++)s.set(t[i],r),r+=t[i].byteLength;return s}([112,115,115,104],new Uint8Array([0,0,0,0]),e,s,i,a,n)}const uL=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),hL={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function dL(e,t){const n=hL[t];return!!n&&!!n[e.slice(0,4)]}function fL(e,t,n=!0){return!e.split(",").some(e=>!pL(e,t,n))}function pL(e,t,n=!0){var r;const i=AD(n);return null!=(r=null==i?void 0:i.isTypeSupported(mL(e,t)))&&r}function mL(e,t){return`${t}/mp4;codecs=${e}`}function gL(e){if(e){const t=e.substring(0,4);return hL.video[t]}return 2}function AL(e){const t=uL();return e.split(",").reduce((e,n)=>{const r=t&&sL(n)?9:hL.video[n];return r?(2*r+e)/(e?3:2):(hL.audio[n]+e)/(e?2:1)},0)}const vL={};const yL=/flac|opus|mp4a\.40\.34/i;function EL(e,t=!0){return e.replace(yL,e=>function(e,t=!0){if(vL[e])return vL[e];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let i=0;i<n.length;i++){var r;if(pL(n[i],"audio",t))return vL[e]=n[i],n[i];if("mp3"===n[i]&&null!=(r=AD(t))&&r.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t))}function _L(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(xL(e,"audio")||xL(e,"video")))return e;if(t){const n=t.split(",");if(n.length>1){if(e)for(let t=n.length;t--;)if(n[t].substring(0,4)===e.substring(0,4))return n[t];return n[0]}}return t||e}function xL(e,t){return dL(e,t)&&pL(e,t)}function bL(e){if(e.startsWith("av01.")){const t=e.split("."),n=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=n[e-4];return t.join(".")}return e}function SL(e){const t=AD(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function wL(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const CL={supported:!1,smooth:!1,powerEfficient:!1},TL={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function ML(e,t){return{supported:!1,configurations:t,decodingInfoResults:[CL],error:e}}function IL(e,t,n,r,i,s){const a=e.videoCodec,o=e.audioCodec?e.audioGroups:null,l=null==s?void 0:s.audioCodec,c=null==s?void 0:s.channels,u=c?parseInt(c):l?1/0:2;let h=null;if(null!=o&&o.length)try{h=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce((e,n)=>{if(n){const r=t.groups[n];if(!r)throw new Error(`Audio track group ${n} not found`);Object.keys(r.channels).forEach(t=>{e[t]=(e[t]||0)+r.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==a&&(a.split(",").some(e=>sL(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(r,30)||"SDR"!==e.videoRange&&e.videoRange!==n||e.bitrate>Math.max(i,8e6))||!!h&&YP(u)&&Object.keys(h).some(e=>parseInt(e)>u)}function RL(e,t,n,r={}){const i=e.videoCodec;if(!i&&!e.audioCodec||!n)return Promise.resolve(TL);const s=[],a=function(e){var t;const n=null==(t=e.videoCodec)?void 0:t.split(","),r=PL(e),i=e.width||640,s=e.height||480,a=e.frameRate||30,o=e.videoRange.toLowerCase();return n?n.map(e=>{const t={contentType:mL(bL(e),"video"),width:i,height:s,bitrate:r,framerate:a};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=a.length,l=function(e,t,n){var r;const i=null==(r=e.audioCodec)?void 0:r.split(","),s=PL(e);if(i&&e.audioGroups)return e.audioGroups.reduce((e,r)=>{var a;const o=r?null==(a=t.groups[r])?void 0:a.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===r){const r=parseFloat(t.channels||"");i.forEach(t=>{const i={contentType:mL(t,"audio"),bitrate:n?BL(t,s):s};r&&(i.channels=""+r),e.push(i)})}return e},e):e},[]);return[]}(e,t,o>0),c=l.length;for(let e=o||1*c||1;e--;){const t={type:"media-source"};if(o&&(t.video=a[e%o]),c){t.audio=l[e%c];const n=t.audio.bitrate;t.video&&n&&(t.video.bitrate-=n)}s.push(t)}if(i){const e=navigator.userAgent;if(i.split(",").some(e=>sL(e))&&uL())return Promise.resolve(ML(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${e})`),s))}return Promise.all(s.map(e=>{const t=function(e){let t="";const{audio:n,video:r}=e;if(r){t+=`${wL(r.contentType)}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(n){t+=`${r?"_":""}${wL(n.contentType)}_c${n.channels}`}return t}(e);return r[t]||(r[t]=n.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:s,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:s,decodingInfoResults:[],error:e}))}function BL(e,t){if(t<=1)return 1;let n=128e3;return"ec-3"===e?n=768e3:"ac-3"===e&&(n=64e4),Math.min(t/2,n)}function PL(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}const DL=["NONE","TYPE-0","TYPE-1",null];const LL=["SDR","PQ","HLG"];var kL={No:"",Yes:"YES",v2:"v2"};function FL(e){const{canSkipUntil:t,canSkipDateRanges:n,age:r}=e;return t&&r<t/2?n?kL.v2:kL.Yes:kL.No}class OL{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class UL{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=null==(t=e.supplemental)?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return NL(this._audioGroups,e)}hasSubtitleGroup(e){return NL(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function NL(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function zL(e,t){let n=!1,r=[];if(e&&(n="SDR"!==e,r=[e]),t){r=t.allowedVideoRanges||LL.slice(0);const e="SDR"!==r.join("")&&!t.videoCodec;n=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),n||(r=["SDR"])}return{preferHDR:n,allowedVideoRanges:r}}const GL=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(n,r)=>{if(e&&(r=e(n,r)),"object"==typeof r&&null!==r){if(t.has(r))return;t.add(r)}return r}})(t));function QL(e,t){gD.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function HL(e){return e.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function VL(e){if(!e)return e;const{lang:t,assocLang:n,characteristics:r,channels:i,audioCodec:s}=e;return{lang:t,assocLang:n,characteristics:r,channels:i,audioCodec:s}}function jL(e,t,n){if("attrs"in e){const n=t.indexOf(e);if(-1!==n)return n}for(let r=0;r<t.length;r++){if(WL(e,t[r],n))return r}return-1}function WL(e,t,n){const{groupId:r,name:i,lang:s,assocLang:a,default:o}=e,l=e.forced;return(void 0===r||t.groupId===r)&&(void 0===i||t.name===i)&&(void 0===s||function(e,t="--"){if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(s,t.lang))&&(void 0===s||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e,t=""){const n=e.split(","),r=t.split(",");return n.length===r.length&&!n.some(e=>-1===r.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===n||n(e,t))}function YL(e,t){const{audioCodec:n,channels:r}=e;return!(void 0!==n&&(t.audioCodec||"").substring(0,4)!==n.substring(0,4)||void 0!==r&&r!==(t.channels||"2"))}function KL(e,t,n){for(let r=t;r>-1;r--)if(n(e[r]))return r;for(let r=t+1;r<e.length;r++)if(n(e[r]))return r;return-1}function qL(e,t){var n;return!!e&&e!==(null==(n=t.loadLevelObj)?void 0:n.uri)}class XL extends uD{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:n,partCurrent:r,hls:i}=this,{autoLevelEnabled:s,media:a}=i;if(!n||!a)return;const o=performance.now(),l=r?r.stats:n.stats,c=r?r.duration:n.duration,u=o-l.loading.start,h=i.minAutoLevel,d=n.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||d<=h)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!s)return;const p=f>-1&&f!==d,m=!!e||p;if(!m&&(a.paused||!a.playbackRate||!a.readyState))return;const g=i.mainForwardBufferInfo;if(!m&&null===g)return;const A=this.bwEstimator.getEstimateTTFB(),v=Math.abs(a.playbackRate);if(u<=Math.max(A,c/(2*v)*1e3))return;const y=g?g.len/v:0,E=l.loading.first?l.loading.first-l.loading.start:-1,_=l.loaded&&E>-1,x=this.getBwEstimate(),b=i.levels,S=b[d],w=Math.max(l.loaded,Math.round(c*(n.bitrate||S.averageBitrate)/8));let C=_?u-E:u;C<1&&_&&(C=Math.min(u,8*l.loaded/x));const T=_?1e3*l.loaded/C:0,M=A/1e3,I=T?(w-l.loaded)/T:8*w/x+M;if(I<=y)return;const R=T?8*T:x,B=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),P=this.hls.config.abrBandWidthUpFactor;let D,L=Number.POSITIVE_INFINITY;for(D=d-1;D>h;D--){const e=b[D].maxBitrate,t=!b[D].details||B;if(L=this.getTimeToLoadFrag(M,R,c*e,t),L<Math.min(y,c+M))break}if(L>=I)return;if(L>10*c)return;_?this.bwEstimator.sample(u-Math.min(A,E),l.loaded):this.bwEstimator.sampleTTFB(u);const k=b[D].maxBitrate;this.getBwEstimate()*P>k&&this.resetEstimator(k);const F=this.findBestLevel(k,h,D,0,y,1,1);F>-1&&(D=F),this.warn(`Fragment ${n.sn}${r?" part "+r.index:""} of level ${d} is loading too slowly;\n      Fragment duration: ${n.duration.toFixed(3)}\n      Time to underbuffer: ${y.toFixed(3)} s\n      Estimated load time for current fragment: ${I.toFixed(3)} s\n      Estimated load time for down switch fragment: ${L.toFixed(3)} s\n      TTFB estimate: ${0|E} ms\n      Current BW estimate: ${YP(x)?0|x:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${D} @ ${0|k} bps`),i.nextLoadLevel=i.nextAutoLevel=D,this.clearTimer();const O=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===D&&D>0){const e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${D>0?"and switching down":""}\n      Fragment duration: ${n.duration.toFixed(3)} s\n      Time to underbuffer: ${e.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,D>h){let t=this.findBestLevel(this.hls.levels[h].bitrate,h,D,0,e,1,1);-1===t&&(t=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};p||I>2*L?O():this.timer=self.setInterval(O,1e3*L),i.trigger(JP.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new sD(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.FRAG_LOADING,this.onFragLoading,this),e.on(JP.FRAG_LOADED,this.onFragLoaded,this),e.on(JP.FRAG_BUFFERED,this.onFragBuffered,this),e.on(JP.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.on(JP.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(JP.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(JP.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.FRAG_LOADING,this.onFragLoading,this),e.off(JP.FRAG_LOADED,this.onFragLoaded,this),e.off(JP.FRAG_BUFFERED,this.onFragBuffered,this),e.off(JP.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.off(JP.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(JP.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(JP.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){var r;if(!n.bitrateTest)this.fragCurrent=n,this.partCurrent=null!=(r=t.part)?r:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case $P.BUFFER_ADD_CODEC_ERROR:case $P.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case $P.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:n,partCurrent:r}=this;if(e&&n&&e.sn===n.sn&&e.level===n.level){const t=performance.now(),n=r?r.stats:e.stats,i=t-n.loading.start,s=n.loading.first?n.loading.first-n.loading.start:-1;if(n.loaded&&s>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(i-Math.min(e,s),n.loaded)}else this.bwEstimator.sampleTTFB(i)}break}}}getTimeToLoadFrag(e,t,n,r){return e+n/t+(r?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,i=r.end-r.first;YP(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const r=n?n.stats:t.stats;if(t.type===rD.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=n?n.duration:t.duration,i=this.hls.levels[t.level],s=(i.loaded?i.loaded.bytes:0)+r.loaded,a=(i.loaded?i.loaded.duration:0)+e;i.loaded={bytes:s,duration:a},i.realBitrate=Math.round(8*s/a)}if(t.bitrateTest){const e={stats:r,frag:t,part:n,id:t.type};this.onFragBuffered(JP.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,i=null!=r&&r.stats.loaded?r.stats:n.stats;if(i.aborted)return;if(this.ignoreFragment(n))return;const s=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,i.loaded),i.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==rD.MAIN||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,i=this.findBestLevel(n,t,e,0,r,1,1);if(i>-1)return i;const s=this.hls.firstLevel,a=Math.min(Math.max(s,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${s} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&n&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const r=t&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,r)&&t[e].loadError<=t[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:i,minAutoLevel:s}=n,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=i.abrBandWidthFactor,u=i.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,s,r,l,0,c,u);if(e>=0)return this.rebufferNotice=-1,e}let h=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){h=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-e,this.info(`bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),c=u=1}}const d=this.findBestLevel(o,s,r,l,h,c,u);if(this.rebufferNotice!==d&&(this.rebufferNotice=d,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${d}`)),d>-1)return d;const f=n.levels[s],p=n.loadLevelObj;return p&&(null==f?void 0:f.bitrate)<p.bitrate?s:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,i,s,a){var o;const l=r+i,c=this.lastLoadedFragLevel,u=-1===c?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:d}=this,{levels:f,allAudioTracks:p,loadLevel:m,config:g}=this.hls;if(1===f.length)return 0;const A=f[u],v=!(null==(o=this.hls.latestLevelDetails)||!o.live),y=-1===m||-1===c;let E,_="SDR",x=(null==A?void 0:A.frameRate)||0;const{audioPreference:b,videoPreference:S}=g,w=this.audioTracksByGroup||(this.audioTracksByGroup=HL(p));let C=-1;if(y){if(-1!==this.firstSelection)return this.firstSelection;const r=this.codecTiers||(this.codecTiers=function(e,t,n,r){return e.slice(n,r+1).reduce((e,n,r)=>{if(!n.codecSet)return e;const i=n.audioGroups;let s=e[n.codecSet];s||(e[n.codecSet]=s={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:r,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),s.minBitrate=Math.min(s.minBitrate,n.bitrate);const a=Math.min(n.height,n.width);return s.minHeight=Math.min(s.minHeight,a),s.minFramerate=Math.min(s.minFramerate,n.frameRate),s.minIndex=Math.min(s.minIndex,r),s.maxScore=Math.max(s.maxScore,n.score),s.fragmentError+=n.fragmentError,s.videoRanges[n.videoRange]=(s.videoRanges[n.videoRange]||0)+1,i&&i.forEach(e=>{if(!e)return;const n=t.groups[e];n&&(s.hasDefaultAudio=s.hasDefaultAudio||t.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(n.channels).forEach(e=>{s.channels[e]=(s.channels[e]||0)+n.channels[e]}))}),e},{})}(f,w,t,n)),i=function(e,t,n,r,i){const s=Object.keys(e),a=null==r?void 0:r.channels,o=null==r?void 0:r.audioCodec,l=null==i?void 0:i.videoCodec,c=a&&2===parseInt(a);let u=!1,h=!1,d=1/0,f=1/0,p=1/0,m=1/0,g=0,A=[];const{preferHDR:v,allowedVideoRanges:y}=zL(t,i);for(let t=s.length;t--;){const n=e[s[t]];u||(u=n.channels[2]>0),d=Math.min(d,n.minHeight),f=Math.min(f,n.minFramerate),p=Math.min(p,n.minBitrate),y.filter(e=>n.videoRanges[e]>0).length>0&&(h=!0)}d=YP(d)?d:0,f=YP(f)?f:0;const E=Math.max(1080,d),_=Math.max(30,f);p=YP(p)?p:n,n=Math.max(p,n),h||(t=void 0);const x=s.length>1;return{codecSet:s.reduce((t,r)=>{const i=e[r];if(r===t)return t;if(A=h?y.filter(e=>i.videoRanges[e]>0):[],x){if(i.minBitrate>n)return QL(r,`min bitrate of ${i.minBitrate} > current estimate of ${n}`),t;if(!i.hasDefaultAudio)return QL(r,"no renditions with default or auto-select sound found"),t;if(o&&r.indexOf(o.substring(0,4))%5!=0)return QL(r,`audio codec preference "${o}" not found`),t;if(a&&!c){if(!i.channels[a])return QL(r,`no renditions with ${a} channel sound found (channels options: ${Object.keys(i.channels)})`),t}else if((!o||c)&&u&&0===i.channels[2])return QL(r,"no renditions with stereo sound found"),t;if(i.minHeight>E)return QL(r,`min resolution of ${i.minHeight} > maximum of ${E}`),t;if(i.minFramerate>_)return QL(r,`min framerate of ${i.minFramerate} > maximum of ${_}`),t;if(!A.some(e=>i.videoRanges[e]>0))return QL(r,`no variants with VIDEO-RANGE of ${GL(A)} found`),t;if(l&&r.indexOf(l.substring(0,4))%5!=0)return QL(r,`video codec preference "${l}" not found`),t;if(i.maxScore<g)return QL(r,`max score of ${i.maxScore} < selected max of ${g}`),t}return t&&(AL(r)>=AL(t)||i.fragmentError>e[t].fragmentError)?t:(m=i.minIndex,g=i.maxScore,r)},void 0),videoRanges:A,preferHDR:v,minFramerate:f,minBitrate:p,minIndex:m}}(r,_,e,b,S),{codecSet:s,videoRanges:a,minFramerate:o,minBitrate:l,minIndex:c,preferHDR:u}=i;C=c,E=s,_=u?a[a.length-1]:a[0],x=o,e=Math.max(e,l),this.log(`picked start tier ${GL(i)}`)}else E=null==A?void 0:A.codecSet,_=null==A?void 0:A.videoRange;const T=d?d.duration:h?h.duration:0,M=this.bwEstimator.getEstimateTTFB()/1e3,I=[];for(let o=n;o>=t;o--){var R;const t=f[o],h=o>u;if(!t)continue;if(g.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const n=navigator.mediaCapabilities;"function"==typeof(null==n?void 0:n.decodingInfo)&&IL(t,w,_,x,e,b)?(t.supportedPromise=RL(t,w,n,this.supportedCache),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const n=this.hls.levels,r=n.indexOf(t);e.error?this.warn(`MediaCapabilities decodingInfo error: "${e.error}" for level ${r} ${GL(e)}`):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log(`MediaCapabilities decodingInfo for level ${r} not smooth or powerEfficient: ${GL(e)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${r} ${GL(e)}`),r>-1&&n.length>1&&(this.log(`Removing unsupported level ${r}`),this.hls.removeLevel(r),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${e}`)})):t.supportedResult=TL}if((E&&t.codecSet!==E||_&&t.videoRange!==_||h&&x>t.frameRate||!h&&x>0&&x<t.frameRate||null!=(R=t.supportedResult)&&null!=(R=R.decodingInfoResults)&&R.some(e=>!1===e.smooth))&&(!y||o!==C)){I.push(o);continue}const p=t.details,A=(d?null==p?void 0:p.partTarget:null==p?void 0:p.averagetargetduration)||T;let S;S=h?a*e:s*e;const B=T&&r>=2*T&&0===i?t.averageBitrate:t.maxBitrate,P=this.getTimeToLoadFrag(M,S,B*A,void 0===p);if(S>=B&&(o===c||0===t.loadError&&0===t.fragmentError)&&(P<=M||!YP(P)||v&&!this.bitrateTestDelay||P<l)){const e=this.forcedAutoLevel;return o===m||-1!==e&&e===m||(I.length&&this.trace(`Skipped level(s) ${I.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${f[I[0]].codecs}" ${f[I[0]].videoRange}; not compatible with "${E}" ${_}`),this.info(`switch candidate:${u}->${o} adjustedbw(${Math.round(S)})-bitrate=${Math.round(S-B)} ttfb:${M.toFixed(1)} avgDuration:${A.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${P.toFixed(1)} firstSelection:${y} codecSet:${t.codecSet} videoRange:${t.videoRange} hls.loadLevel:${m}`)),y&&(this.firstSelection=o),o}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const $L=function(e,t){let n=0,r=e.length-1,i=null,s=null;for(;n<=r;){i=(n+r)/2|0,s=e[i];const a=t(s);if(a>0)n=i+1;else{if(!(a<0))return s;r=i-1}}return null};function JL(e,t,n=0,r=0,i=.005){let s=null;if(e){s=t[1+e.sn-t[0].sn]||null;const r=e.endDTS-n;r>0&&r<15e-7&&(n+=15e-7),s&&e.level!==s.level&&s.end<=e.end&&(s=t[2+e.sn-t[0].sn]||null)}else 0===n&&0===t[0].start&&(s=t[0]);if(s&&((!e||e.level===s.level)&&0===ZL(n,r,s)||function(e,t,n){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const r=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),n);return e.start<=r}return!1}(s,e,Math.min(i,r))))return s;const a=$L(t,ZL.bind(null,n,r));return!a||a===e&&s?s:a}function ZL(e=0,t=0,n){if(n.start<=e&&n.start+n.duration>e)return 0;const r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function ek(e,t,n){const r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}function tk(e,t,n){if(e&&e.startCC<=t&&e.endCC>=t){let r=e.fragments;const{fragmentHint:i}=e;let s;return i&&(r=r.concat(i)),$L(r,e=>e.cc<t?1:e.cc>t?-1:(s=e,e.end<=n?1:e.start>n?-1:0)),s||null}return null}function nk(e){switch(e.details){case $P.FRAG_LOAD_TIMEOUT:case $P.KEY_LOAD_TIMEOUT:case $P.LEVEL_LOAD_TIMEOUT:case $P.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function rk(e,t){const n=nk(t);return e.default[(n?"timeout":"error")+"Retry"]}function ik(e,t){const n="linear"===e.backoff?1:Math.pow(2,t);return Math.min(n*e.retryDelayMs,e.maxRetryDelayMs)}function sk(e){return cD(cD({},e),{errorRetry:null,timeoutRetry:null})}function ak(e,t,n,r){if(!e)return!1;const i=null==r?void 0:r.code,s=t<e.maxNumRetry&&(function(e){return ok(e)||!!e&&(e<400||e>499)}(i)||!!n);return e.shouldRetry?e.shouldRetry(e,t,n,r,s):s}function ok(e){return 0===e&&!1===navigator.onLine}var lk={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ck={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class uk extends uD{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(JP.ERROR,this.onError,this),e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(JP.ERROR,this.onError,this),e.off(JP.ERROR,this.onErrorOut,this),e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===rD.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===n?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if(null!=(n=e.details)&&n.hasKey(t))return!0;const r=e.audioGroups;if(r){return this.hls.allAudioTracks.filter(e=>r.indexOf(e.groupId)>=0).some(e=>{var n;return null==(n=e.details)?void 0:n.hasKey(t)})}}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,i=t.context;switch(t.details){case $P.FRAG_LOAD_ERROR:case $P.FRAG_LOAD_TIMEOUT:case $P.KEY_LOAD_ERROR:case $P.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case $P.FRAG_PARSING_ERROR:if(null!=(n=t.frag)&&n.gap)return void(t.errorAction=hk());case $P.FRAG_GAP:case $P.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=lk.SendAlternateToPenaltyBox);case $P.LEVEL_EMPTY_ERROR:case $P.LEVEL_PARSING_ERROR:{var s;const e=t.parent===rD.MAIN?t.level:r.loadLevel;t.details===$P.LEVEL_EMPTY_ERROR&&null!=(s=t.context)&&null!=(s=s.levelDetails)&&s.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case $P.LEVEL_LOAD_ERROR:case $P.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==i?void 0:i.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level)));case $P.AUDIO_TRACK_LOAD_ERROR:case $P.AUDIO_TRACK_LOAD_TIMEOUT:case $P.SUBTITLE_LOAD_ERROR:case $P.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const e=r.loadLevelObj;if(e&&(i.type===tD&&e.hasAudioGroup(i.groupId)||i.type===nD&&e.hasSubtitleGroup(i.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=lk.SendAlternateToPenaltyBox,void(t.errorAction.flags=ck.MoveAllAlternatesMatchingHost)}return;case $P.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(t.errorAction={action:lk.SendAlternateToPenaltyBox,flags:ck.MoveAllAlternatesMatchingHDCP});case $P.KEY_SYSTEM_SESSION_UPDATE_FAILED:case $P.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case $P.KEY_SYSTEM_NO_SESSION:return void(t.errorAction={action:lk.SendAlternateToPenaltyBox,flags:ck.MoveAllAlternatesMatchingKey});case $P.BUFFER_ADD_CODEC_ERROR:case $P.REMUX_ALLOC_ERROR:case $P.BUFFER_APPEND_ERROR:var a;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(a=t.level)?a:r.loadLevel);return;case $P.INTERNAL_EXCEPTION:case $P.BUFFER_APPENDING_ERROR:case $P.BUFFER_FULL_ERROR:case $P.LEVEL_SWITCH_ERROR:case $P.BUFFER_STALLED_ERROR:case $P.BUFFER_SEEK_OVER_HOLE:case $P.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=hk())}t.type===XP.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=hk())}getPlaylistRetryOrSwitchAction(e,t){const n=rk(this.hls.config.playlistLoadPolicy,e),r=this.playlistError++;if(ak(n,r,nk(e),e.response))return{action:lk.RetryRequest,flags:ck.None,retryConfig:n,retryCount:r};const i=this.getLevelSwitchAction(e,t);return n&&(i.retryConfig=n,i.retryCount=r),i}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:i,keyLoadPolicy:s}=t.config,a=rk(e.details.startsWith("key")?s:i,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(r){e.details!==$P.FRAG_GAP&&r.fragmentError++;if(ak(a,o,nk(e),e.response))return{action:lk.RetryRequest,flags:ck.None,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(e,n);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(e,t){const n=this.hls;null==t&&(t=n.loadLevel);const r=this.hls.levels[t];if(r){var i,s;const t=e.details;r.loadError++,t===$P.BUFFER_APPEND_ERROR&&r.fragmentError++;let l=-1;const{levels:c,loadLevel:u,minAutoLevel:h,maxAutoLevel:d}=n;n.autoLevelEnabled||n.config.preserveManualLevelOnError||(n.loadLevel=-1);const f=null==(i=e.frag)?void 0:i.type,p=(f===rD.AUDIO&&t===$P.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===$P.BUFFER_ADD_CODEC_ERROR||t===$P.BUFFER_APPEND_ERROR))&&c.some(({audioCodec:e})=>r.audioCodec!==e),m="video"===e.sourceBufferName&&(t===$P.BUFFER_ADD_CODEC_ERROR||t===$P.BUFFER_APPEND_ERROR)&&c.some(({codecSet:e,audioCodec:t})=>r.codecSet!==e&&r.audioCodec===t),{type:g,groupId:A}=null!=(s=e.context)?s:{};for(let n=c.length;n--;){const i=(n+u)%c.length;if(i!==u&&i>=h&&i<=d&&0===c[i].loadError){var a,o;const n=c[i];if(t===$P.FRAG_GAP&&f===rD.MAIN&&e.frag){const t=c[i].details;if(t){const n=JL(e.frag,t.fragments,e.frag.start);if(null!=n&&n.gap)continue}}else{if(g===tD&&n.hasAudioGroup(A)||g===nD&&n.hasSubtitleGroup(A))continue;if(f===rD.AUDIO&&null!=(a=r.audioGroups)&&a.some(e=>n.hasAudioGroup(e))||f===rD.SUBTITLE&&null!=(o=r.subtitleGroups)&&o.some(e=>n.hasSubtitleGroup(e))||p&&r.audioCodec===n.audioCodec||m&&r.codecSet===n.codecSet||!p&&r.codecSet!==n.codecSet)continue}l=i;break}}if(l>-1&&n.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:lk.SendAlternateToPenaltyBox,flags:ck.None,nextAutoLevel:l}}return{action:lk.SendAlternateToPenaltyBox,flags:ck.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch(null==(n=t.errorAction)?void 0:n.action){case lk.DoNothing:break;case lk.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===$P.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r}=n,i=n.nextAutoLevel;switch(r){case ck.None:this.switchLevel(e,i);break;case ck.MoveAllAlternatesMatchingHDCP:{const r=this.getVariantLevelIndex(e.frag),i=t.levels[r],s=null==i?void 0:i.attrs["HDCP-LEVEL"];if(n.hdcpLevel=s,s){t.maxHdcpLevel=DL[DL.indexOf(s)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case ck.MoveAllAlternatesMatchingKey:{const t=e.decryptdata;if(t){const r=this.hls.levels;for(let n=r.length;n--;){var s,a;if(this.variantHasKey(r[n],t))this.log(`Banned key found in level ${n} (${r[n].bitrate}bps) or audio group "${null==(s=r[n].audioGroups)?void 0:s.join(",")}" (${null==(a=e.frag)?void 0:a.type} fragment) ${ED(t.keyId||[])}`),r[n].fragmentError++,r[n].loadError++,this.log(`Removing level ${n} with key error (${e.error})`),this.hls.removeLevel(n)}r.length&&(n.resolved=!0)}break}}n.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===$P.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=wL(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r][`${e.sourceBufferName}Codec`]===t&&(this.log(`Removing level ${r} for ${e.details} ("${t}" not supported)`),this.hls.removeLevel(r))}}}function hk(e){const t={action:lk.DoNothing,flags:ck.None};return e&&(t.resolved=!0),t}var dk="NOT_LOADED",fk="APPENDING",pk="PARTIAL",mk="OK";class gk{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.BUFFER_APPENDED,this.onBufferAppended,this),e.on(JP.FRAG_BUFFERED,this.onFragBuffered,this),e.on(JP.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.BUFFER_APPENDED,this.onBufferAppended,this),e.off(JP.FRAG_BUFFERED,this.onFragBuffered,this),e.off(JP.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let t=n.length;t--;){const r=n[t];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,i=Object.keys(r);for(let s=i.length;s--;){const a=r[i[s]];if((null==a?void 0:a.body.type)===t&&(!n||a.buffered)){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,n,r,i){this.timeRanges&&(this.timeRanges[e]=t);const s=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(r=>{const a=this.fragments[r];if(!a)return;if(s>=a.body.sn)return;if(!a.buffered&&(!a.loaded||i))return void(a.body.type===n&&this.removeFragment(a.body));const o=a.range[e];o&&(0!==o.time.length?o.time.some(e=>{const n=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&this.removeFragment(a.body),n}):this.removeFragment(a.body))})}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const n=e.frag,r=vk(n),i=this.fragments[r];if(!i||i.buffered&&n.gap)return;const s=!n.relurl;if(Object.keys(t).forEach(r=>{const a=n.elementaryStreams[r];if(!a)return;const o=t[r],l=s||!0===a.partial;i.range[r]=this.getBufferedTimes(n,e.part,l,o)}),i.loaded=null,Object.keys(i.range).length){i.buffered=!0;(i.body.endList=n.endList||i.body.endList)&&(this.endListFragments[i.body.type]=i),Ak(i)||this.removeParts(n.sn-1,n.type)}else this.removeFragment(i.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=yk(n,t=>t.fragment.sn>=e))}fragBuffered(e,t){const n=vk(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,n,r){const i={time:[],partial:n},s=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||s;for(let e=0;e<r.length;e++){const t=r.start(e)-this.bufferPadding,n=r.end(e)+this.bufferPadding;if(l>=t&&o<=n){i.time.push({startPTS:Math.max(s,r.start(e)),endPTS:Math.min(a,r.end(e))});break}if(s<n&&a>t){const t=Math.max(s,r.start(e)),n=Math.min(a,r.end(e));n>t&&(i.partial=!0,i.time.push({startPTS:t,endPTS:n}))}else if(a<=t)break}return i}getPartialFragment(e){let t,n,r,i=null,s=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const c=o[l];c&&Ak(c)&&(n=c.body.start-a,r=c.body.end+a,e>=n&&e<=r&&(t=Math.min(e-n,r-e),s<=t&&(i=c.body,s=t)))}),i}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||Ak(t))}getState(e){const t=vk(e),n=this.fragments[t];return n?n.buffered?Ak(n)?pk:mk:fk:dk}isTimeBuffered(e,t,n){let r,i;for(let s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,i=vk(n);this.fragments[i]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:i,type:s}=t;if("initSegment"===n.sn)return;const a=n.type;if(r){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(r)}this.timeRanges=i;const o=i[s];this.detectEvictedFragments(s,o,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=vk(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const i=t[n[r]];if((null==i?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,n,r,i){r&&!this.hasGaps||Object.keys(this.fragments).forEach(s=>{const a=this.fragments[s];if(!a)return;const o=a.body;o.type!==n||r&&!o.gap||o.start<t&&o.end>e&&(a.buffered||i)&&this.removeFragment(o)})}removeFragment(e){const t=vk(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const t=e.sn;this.activePartLists[e.type]=yk(n,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function Ak(e){var t,n,r;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(n=e.range.audio)&&n.partial||null!=(r=e.range.audiovideo)&&r.partial)}function vk(e){return`${e.type}_${e.level}_${e.sn}`}function yk(e,t){return e.filter(e=>{const n=t(e);return n||e.clearElementaryStreamInfo(),n})}var Ek=0,_k=1;class xk{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case Ek:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case _k:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class bk{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let e=0;e<4;e++)n[e]=t.getUint32(4*e);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],s=n[2],a=n[3],o=this.invSubMix,l=o[0],c=o[1],u=o[2],h=o[3],d=new Uint32Array(256);let f=0,p=0,m=0;for(m=0;m<256;m++)d[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let n=p^p<<1^p<<2^p<<3^p<<4;n=n>>>8^255&n^99,e[f]=n,t[n]=f;const o=d[f],m=d[o],g=d[m];let A=257*d[n]^16843008*n;r[f]=A<<24|A>>>8,i[f]=A<<16|A>>>16,s[f]=A<<8|A>>>24,a[f]=A,A=16843009*g^65537*m^257*o^16843008*f,l[n]=A<<24|A>>>8,c[n]=A<<16|A>>>16,u[n]=A<<8|A>>>24,h[n]=A,f?(f=o^d[d[d[g^o]]],p^=d[d[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);const s=this.ksRows=4*(i+6+1);let a,o;const l=this.keySchedule=new Uint32Array(s),c=this.invKeySchedule=new Uint32Array(s),u=this.sBox,h=this.rcon,d=this.invSubMix,f=d[0],p=d[1],m=d[2],g=d[3];let A,v;for(a=0;a<s;a++)a<i?A=l[a]=t[a]:(v=A,a%i===0?(v=v<<8|v>>>24,v=u[v>>>24]<<24|u[v>>>16&255]<<16|u[v>>>8&255]<<8|u[255&v],v^=h[a/i|0]<<24):i>6&&a%i===4&&(v=u[v>>>24]<<24|u[v>>>16&255]<<16|u[v>>>8&255]<<8|u[255&v]),l[a]=A=(l[a-i]^v)>>>0);for(o=0;o<s;o++)a=s-o,v=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?v:f[u[v>>>24]]^p[u[v>>>16&255]]^m[u[v>>>8&255]]^g[u[255&v]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,i=this.invKeySchedule,s=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],u=a[3],h=this.uint8ArrayToUint32Array_(n);let d=h[0],f=h[1],p=h[2],m=h[3];const g=new Int32Array(e),A=new Int32Array(g.length);let v,y,E,_,x,b,S,w,C,T,M,I,R,B;const P=this.networkToHostOrderSwap;for(;t<g.length;){for(C=P(g[t]),T=P(g[t+1]),M=P(g[t+2]),I=P(g[t+3]),x=C^i[0],b=I^i[1],S=M^i[2],w=T^i[3],R=4,B=1;B<r;B++)v=o[x>>>24]^l[b>>16&255]^c[S>>8&255]^u[255&w]^i[R],y=o[b>>>24]^l[S>>16&255]^c[w>>8&255]^u[255&x]^i[R+1],E=o[S>>>24]^l[w>>16&255]^c[x>>8&255]^u[255&b]^i[R+2],_=o[w>>>24]^l[x>>16&255]^c[b>>8&255]^u[255&S]^i[R+3],x=v,b=y,S=E,w=_,R+=4;v=s[x>>>24]<<24^s[b>>16&255]<<16^s[S>>8&255]<<8^s[255&w]^i[R],y=s[b>>>24]<<24^s[S>>16&255]<<16^s[w>>8&255]<<8^s[255&x]^i[R+1],E=s[S>>>24]<<24^s[w>>16&255]<<16^s[x>>8&255]<<8^s[255&b]^i[R+2],_=s[w>>>24]<<24^s[x>>16&255]<<16^s[b>>8&255]<<8^s[255&S]^i[R+3],A[t]=P(v^d),A[t+1]=P(_^f),A[t+2]=P(E^p),A[t+3]=P(y^m),d=C,f=T,p=M,m=I,t+=4}return A.buffer}}class Sk{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=function(e){switch(e){case Ek:return"AES-CBC";case _k:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${e}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class wk{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?e.slice(0,t-n):e}(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((i,s)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,r);const o=this.flush();o?i(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:i,currentResult:s,remainderData:a}=this;if(r!==Ek||16!==t.byteLength)return gD.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=rL(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;i&&(n=i);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new bk),l.expandKey(t);const c=s;return this.currentResult=l.decrypt(o.buffer,0,n),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new Sk(this.subtle,t,r)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new xk(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,t)}).catch(i=>(gD.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const i=this.flush();if(i)return i.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%16;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(gD.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Ck=Math.pow(2,17);class Tk{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Rk({type:XP.NETWORK_ERROR,details:$P.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(n?"part list":"url")),networkDetails:null}));this.abort();const r=this.config,i=r.fLoader,s=r.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void o(Ik(e));e.gap=!1}const l=this.loader=i?new i(r):new s(r),c=Mk(e);e.loader=l;const u=sk(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Ck};e.stats=l.stats;const d={onSuccess:(t,n,r,i)=>{this.resetLoader(e,l);let s=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),a({frag:e,part:null,payload:s,networkDetails:i})},onError:(t,r,i,s)=>{this.resetLoader(e,l),o(new Rk({type:XP.NETWORK_ERROR,details:$P.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:cD({url:n,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:i,stats:s}))},onAbort:(t,n,r)=>{this.resetLoader(e,l),o(new Rk({type:XP.NETWORK_ERROR,details:$P.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:(t,n,r)=>{this.resetLoader(e,l),o(new Rk({type:XP.NETWORK_ERROR,details:$P.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:t}))}};t&&(d.onProgress=(n,r,i,s)=>t({frag:e,part:null,payload:i,networkDetails:s})),l.load(c,h,d)})}loadPart(e,t,n){this.abort();const r=this.config,i=r.fLoader,s=r.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(Ik(e,t));const l=this.loader=i?new i(r):new s(r),c=Mk(e,t);e.loader=l;const u=sk(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ck};t.stats=l.stats,l.load(c,h,{onSuccess:(r,i,s,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:r.data,networkDetails:o};n(c),a(c)},onError:(n,r,i,s)=>{this.resetLoader(e,l),o(new Rk({type:XP.NETWORK_ERROR,details:$P.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:cD({url:c.url,data:void 0},n),error:new Error(`HTTP Error ${n.code} ${n.text}`),networkDetails:i,stats:s}))},onAbort:(n,r,i)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new Rk({type:XP.NETWORK_ERROR,details:$P.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:i,stats:n}))},onTimeout:(n,r,i)=>{this.resetLoader(e,l),o(new Rk({type:XP.NETWORK_ERROR,details:$P.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:i,stats:n}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,i=r.total;if(n.loaded+=r.loaded,i){const r=Math.round(e.duration/t.duration),s=Math.min(Math.round(n.loaded/i),r),a=(r-s)*Math.round(n.loaded/s);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);const s=n.loading,a=r.loading;s.start?s.first+=a.first-a.start:(s.start=a.start,s.first=a.first),s.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Mk(e,t=null){const n=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},i=n.byteRangeStartOffset,s=n.byteRangeEndOffset;if(YP(i)&&YP(s)){var a;let t=i,n=s;if("initSegment"===e.sn&&("AES-128"===(o=null==(a=e.decryptdata)?void 0:a.method)||"AES-256"===o)){const e=s-i;e%16&&(n=s+(16-e%16)),0!==i&&(r.resetIV=!0,t=i-16)}r.rangeStart=t,r.rangeEnd=n}var o;return r}function Ik(e,t){const n=new Error(`GAP ${e.gap?"tag":"attribute"} found`),r={type:XP.MEDIA_ERROR,details:$P.FRAG_GAP,fatal:!1,frag:e,error:n,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new Rk(r)}class Rk extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Bk extends uD{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Pk{constructor(e,t,n,r=0,i=-1,s=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=i,this.partial=s}}const Dk={length:0,start:()=>0,end:()=>0};class Lk{static isBuffered(e,t){if(e){const n=Lk.getBuffered(e);for(let e=n.length;e--;)if(t>=n.start(e)&&t<=n.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Lk.getBuffered(e);return Lk.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=Lk.bufferedRanges(e);if(r.length)return Lk.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let r=-1,i=[];if(n)for(let s=0;s<e.length;s++){t>=e[s].start&&t<=e[s].end&&(r=s);const a=i.length;if(a){const t=i[a-1].end;e[s].start-t<n?e[s].end>t&&(i[a-1].end=e[s].end):i.push(e[s])}else i.push(e[s])}else i=e;let s,a=0,o=t,l=t;for(let e=0;e<i.length;e++){const c=i[e].start,u=i[e].end;if(-1===r&&t>=c&&t<=u&&(r=e),t+n>=c&&t<u)o=c,l=u,a=l-t;else if(t+n<c){s=c;break}}return{len:a,start:o||0,end:l||0,nextStart:s,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||Dk}catch(e){return gD.log("failed to get media.buffered",e),Dk}}}const kk=/\{\$([a-zA-Z0-9-_]+)\}/g;function Fk(e){return kk.test(e)}function Ok(e,t){if(null!==e.variableList||e.hasVariableRefs){const n=e.variableList;return t.replace(kk,t=>{const r=t.substring(2,t.length-1),i=null==n?void 0:n[r];return void 0===i?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),t):i})}return t}function Uk(e,t,n){let r,i,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{const e=new self.URL(n).searchParams;if(!e.has(r))throw new Error(`"${r}" does not match any query parameter in URI: "${n}"`);i=e.get(r)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else r=t.NAME,i=t.VALUE;r in s?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=i||""}function Nk(e,t,n){const r=t.IMPORT;if(n&&r in n){let t=e.variableList;t||(e.variableList=t={}),t[r]=n[r]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const zk=/^(\d+)x(\d+)$/,Gk=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Qk{constructor(e,t){"string"==typeof e&&(e=Qk.parseAttrList(e,t)),oD(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const n=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)n[e]=parseInt(t.slice(2*e,2*e+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=zk.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={};for(Gk.lastIndex=0;null!==(n=Gk.exec(e));){const i=n[1].trim();let s=n[2];const a=0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1;let o=!1;if(a)s=s.slice(1,-1);else switch(i){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(a||o))s=Ok(t,s);else if(!o&&!a)switch(i){case"CLOSED-CAPTIONS":if("NONE"===s)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":gD.warn(`${e}: attribute ${i} is missing quotes`)}r[i]=s}return r}}function Hk(e){return"ID"!==e&&"CLASS"!==e&&"CUE"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function Vk(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class jk{constructor(e,t,n=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(r=null==t?void 0:t.tagOrder)?r:n,t){const n=t.attr;for(const t in n)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==n[t]){gD.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=oD(new Qk({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);YP(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(gD.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(YP(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&YP(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class Wk{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return!!this.fragments.length&&YP(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Yk(e,t){return e.length===t.length&&!e.some((e,n)=>e!==t[n])}function Kk(e,t){return!e&&!t||!(!e||!t)&&Yk(e,t)}function qk(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function Xk(e){switch(e){case"AES-128":case"AES-256":return Ek;case"AES-256-CTR":return _k;default:throw new Error(`invalid full segment method ${e}`)}}function $k(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function Jk(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function Zk(e){const t=e.split(":");let n=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),r=e[e.length-1].split(",");if(2===r.length){const t="base64"===r[0],i=r[1];t?(e.splice(-1,1),n=$k(i)):n=function(e){const t=Jk(e).subarray(0,16),n=new Uint8Array(16);return n.set(t,16-t.length),n}(i)}}return n}const eF="undefined"!=typeof self?self:void 0;var tF={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},nF={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function rF(e){switch(e){case nF.FAIRPLAY:return tF.FAIRPLAY;case nF.PLAYREADY:return tF.PLAYREADY;case nF.WIDEVINE:return tF.WIDEVINE;case nF.CLEARKEY:return tF.CLEARKEY}}function iF(e){switch(e){case tF.FAIRPLAY:return nF.FAIRPLAY;case tF.PLAYREADY:return nF.PLAYREADY;case tF.WIDEVINE:return nF.WIDEVINE;case tF.CLEARKEY:return nF.CLEARKEY}}function sF(e){const{drmSystems:t,widevineLicenseUrl:n}=e,r=t?[tF.FAIRPLAY,tF.WIDEVINE,tF.PLAYREADY,tF.CLEARKEY].filter(e=>!!t[e]):[];return!r[tF.WIDEVINE]&&n&&r.push(tF.WIDEVINE),r}const aF=null!=eF&&null!=(oF=eF.navigator)&&oF.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var oF;let lF={};class cF{static clearKeyUriToKeyIdMap(){lF={}}constructor(e,t,n,r=[1],i=null,s){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=i,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!qk(e),null!=s&&s.startsWith("0x")&&(this.keyId=new Uint8Array(_D(s)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Yk(e.keyFormatVersions,this.keyFormatVersions)&&Kk(e.iv,this.iv)&&Kk(e.keyId,this.keyId)}isSupported(){if(this.method){if(qk(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case nF.FAIRPLAY:case nF.WIDEVINE:case nF.PLAYREADY:case nF.CLEARKEY:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(qk(this.method)&&this.uri&&!this.iv){"number"!=typeof e&&(gD.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}(e);return new cF(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.pssh&&this.keyId)return this;const t=Zk(this.uri);if(t)switch(this.keyFormat){case nF.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){const e=t.length-22;this.keyId=t.subarray(e,e+16)}break;case nF.PLAYREADY:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=cL(e,0,t),this.keyId=function(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),n=String.fromCharCode.apply(null,Array.from(t)),r=n.substring(n.indexOf("<"),n.length),i=(new DOMParser).parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(i){const e=i.childNodes[0]?i.childNodes[0].nodeValue:i.getAttribute("VALUE");if(e){const t=$k(e).subarray(0,16);return function(e){const t=function(e,t,n){const r=e[t];e[t]=e[n],e[n]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),t}}return null}(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=lF[this.uri];if(!e){const t=Object.keys(lF).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),lF[this.uri]=e}this.keyId=e}return this}}const uF=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,hF=/#EXT-X-MEDIA:(.*)/g,dF=/^#EXT(?:INF|-X-TARGETDURATION):/m,fF=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),pF=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class mF{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return RD.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return dF.test(e)}static parseMasterPlaylist(e,t){const n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Fk(e)},r=[];let i;for(uF.lastIndex=0;null!=(i=uF.exec(e));)if(i[1]){var s;const e=new Qk(i[1],n),a=Ok(n,i[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:mF.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),EF(e.CODECS,o);const c=e["SUPPLEMENTAL-CODECS"];c&&(o.supplemental={},EF(c,o.supplemental)),null!=(s=o.unknownCodecs)&&s.length||r.push(o),n.levels.push(o)}else if(i[3]){const e=i[3],r=i[4];switch(e){case"SESSION-DATA":{const e=new Qk(r,n),t=e["DATA-ID"];t&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[t]=e);break}case"SESSION-KEY":{const e=vF(r,t,n);e.encrypted&&e.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(e)):gD.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${r}"`);break}case"DEFINE":Uk(n,new Qk(r,n),t);break;case"CONTENT-STEERING":{const e=new Qk(r,n);n.contentSteering={uri:mF.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=yF(r)}}const a=r.length>0&&r.length<n.levels.length;return n.levels=a?r:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,n){let r;const i={},s=n.levels,a={AUDIO:s.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:s.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(hF.lastIndex=0;null!==(r=hF.exec(e));){const e=new Qk(r[1],n),s=e.TYPE;if(s){const n=a[s],r=i[s]||[];i[s]=r;const l=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],u=e.CHANNELS,h=e.CHARACTERISTICS,d=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:s,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?mF.resolve(e.URI,t):""};if(c&&(f.assocLang=c),u&&(f.channels=u),h&&(f.characteristics=h),d&&(f.instreamId=d),null!=n&&n.length){const e=mF.findGroup(n,f.groupId)||n[0];_F(f,e,"audioCodec"),_F(f,e,"textCodec")}r.push(f)}}return i}static parseLevelPlaylist(e,t,n,r,i,s){var a;const o={url:t},l=new Wk(t),c=l.fragments,u=[];let h,d,f,p,m=null,g=0,A=0,v=0,y=0,E=0,_=null,x=new OD(r,o),b=-1,S=!1,w=null;if(fF.lastIndex=0,l.m3u8=e,l.hasVariableRefs=Fk(e),"#EXTM3U"!==(null==(a=fF.exec(e))?void 0:a[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(h=fF.exec(e));){S&&(S=!1,x=new OD(r,o),x.playlistOffset=v,x.setStart(v),x.sn=g,x.cc=y,E&&(x.bitrate=E),x.level=n,m&&(x.initSegment=m,m.rawProgramDateTime&&(x.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),w&&(x.setByteRange(w),w=null)));const e=h[1];if(e){x.duration=parseFloat(e);const t=(" "+h[2]).slice(1);x.title=t||null,x.tagList.push(t?["INF",e,t]:["INF",e])}else if(h[3]){if(YP(x.duration)){x.playlistOffset=v,x.setStart(v),f&&SF(x,f,l),x.sn=g,x.level=n,x.cc=y,c.push(x);const e=(" "+h[3]).slice(1);x.relurl=Ok(l,e),xF(x,_,u),_=x,v+=x.duration,g++,A=0,S=!0}}else{if(h=h[0].match(pF),!h){gD.warn("No matches on slow regex match for level playlist!");continue}for(d=1;d<h.length&&void 0===h[d];d++);const e=(" "+h[d]).slice(1),i=(" "+h[d+1]).slice(1),a=h[d+2]?(" "+h[d+2]).slice(1):null;switch(e){case"BYTERANGE":_?x.setByteRange(i,_):x.setByteRange(i);break;case"PROGRAM-DATE-TIME":x.rawProgramDateTime=i,x.tagList.push(["PROGRAM-DATE-TIME",i]),-1===b&&(b=c.length);break;case"PLAYLIST-TYPE":l.type&&wF(l,e,h),l.type=i.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?wF(l,e,h):c.length>0&&CF(l,e,h),g=l.startSN=parseInt(i);break;case"SKIP":{l.skippedSegments&&wF(l,e,h);const t=new Qk(i,l),n=t.decimalInteger("SKIPPED-SEGMENTS");if(YP(n)){l.skippedSegments+=n;for(let e=n;e--;)c.push(null);g+=n}const r=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(r.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&wF(l,e,h),l.targetduration=Math.max(parseInt(i),1);break;case"VERSION":null!==l.version&&wF(l,e,h),l.version=parseInt(i);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||wF(l,e,h),l.live=!1;break;case"#":(i||a)&&x.tagList.push(a?[i,a]:[i]);break;case"DISCONTINUITY":y++,x.tagList.push(["DIS"]);break;case"GAP":x.gap=!0,x.tagList.push([e]);break;case"BITRATE":x.tagList.push([e,i]),E=1e3*parseInt(i),YP(E)?x.bitrate=E:E=0;break;case"DATERANGE":{const e=new Qk(i,l),t=new jk(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:gD.warn(`Ignoring invalid DATERANGE tag: "${i}"`),x.tagList.push(["EXT-X-DATERANGE",i]);break}case"DEFINE":{const e=new Qk(i,l);"IMPORT"in e?Nk(l,e,s):Uk(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?wF(l,e,h):c.length>0&&CF(l,e,h),l.startCC=y=parseInt(i);break;case"KEY":{const e=vF(i,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={});const t=f[e.keyFormat];null!=t&&t.matches(e)||(t&&(f=oD({},f)),f[e.keyFormat]=e)}else gD.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${i}"`);break}case"START":l.startTimeOffset=yF(i);break;case"MAP":{const e=new Qk(i,l);if(x.duration){const t=new OD(r,o);bF(t,e,n,f),m=t,x.initSegment=m,m.rawProgramDateTime&&!x.rawProgramDateTime&&(x.rawProgramDateTime=m.rawProgramDateTime)}else{const t=x.byteRangeEndOffset;if(t){const e=x.byteRangeStartOffset;w=`${t-e}@${e}`}else w=null;bF(x,e,n,f),m=x,S=!0}m.cc=y;break}case"SERVER-CONTROL":p&&wF(l,e,h),p=new Qk(i),l.canBlockReload=p.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=p.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&p.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=p.optionalFloat("PART-HOLD-BACK",0),l.holdBack=p.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&wF(l,e,h);const t=new Qk(i);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=A>0?e[e.length-1]:void 0,n=A++,r=new Qk(i,l),s=new UD(r,x,o,n,t);e.push(s),x.duration+=s.duration;break}case"PRELOAD-HINT":{const e=new Qk(i,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new Qk(i,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:gD.warn(`line parsed but not handled: ${h}`)}}}_&&!_.relurl?(c.pop(),v-=_.duration,l.partList&&(l.fragmentHint=_)):l.partList&&(xF(x,_,u),x.cc=y,l.fragmentHint=x,f&&SF(x,f,l)),l.targetduration||(l.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const C=c.length,T=c[0],M=c[C-1];if(v+=l.skippedSegments*l.targetduration,v>0&&C&&M){l.averagetargetduration=v/C;const e=M.sn;l.endSN="initSegment"!==e?e:0,l.live||(M.endList=!0),b>0&&(!function(e,t){let n=e[t];for(let r=t;r--;){const t=e[r];if(!t)return;t.programDateTime=n.programDateTime-1e3*t.duration,n=t}}(c,b),T&&u.unshift(T))}return l.fragmentHint&&(v+=l.fragmentHint.duration),l.totalduration=v,u.length&&l.dateRangeTagCount&&T&&gF(u,l),l.endCC=y,l}}function gF(e,t){let n=e.length;if(!n){if(!t.hasProgramDateTime)return;{const r=t.fragments[t.fragments.length-1];e.push(r),n++}}const r=e[n-1],i=t.live?1/0:t.totalduration,s=Object.keys(t.dateRanges);for(let o=s.length;o--;){const l=t.dateRanges[s[o]],c=l.startDate.getTime();l.tagAnchor=r.ref;for(let r=n;r--;){var a;if((null==(a=e[r])?void 0:a.sn)<t.startSN)break;const n=AF(t,c,e,r,i);if(-1!==n){l.tagAnchor=t.fragments[n].ref;break}}}}function AF(e,t,n,r,i){const s=n[r];if(s){const o=s.programDateTime;if(t>=o||0===r){var a;if(t<=o+1e3*(((null==(a=n[r+1])?void 0:a.start)||i)-s.start)){const i=n[r].sn-e.startSN;if(i<0)return-1;const s=e.fragments;if(s.length>n.length){for(let a=(n[r+1]||s[s.length-1]).sn-e.startSN;a>i;a--){const e=s[a].programDateTime;if(t>=e&&t<e+1e3*s[a].duration)return a}}return i}}}return-1}function vF(e,t,n){var r,i;const s=new Qk(e,n),a=null!=(r=s.METHOD)?r:"",o=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=null!=(i=s.KEYFORMAT)?i:"identity";o&&s.IV&&!l&&gD.error(`Invalid IV: ${s.IV}`);const h=o?mF.resolve(o,t):"",d=(c||"1").split("/").map(Number).filter(Number.isFinite);return new cF(a,h,u,d,l,s.KEYID)}function yF(e){const t=new Qk(e).decimalFloatingPoint("TIME-OFFSET");return YP(t)?t:null}function EF(e,t){let n=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const r=n.filter(t=>dL(t,e));r.length&&(t[`${e}Codec`]=r.map(e=>e.split("/")[0]).join(","),n=n.filter(e=>-1===r.indexOf(e)))}),t.unknownCodecs=n}function _F(e,t,n){const r=t[n];r&&(e[n]=r)}function xF(e,t,n){e.rawProgramDateTime?n.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function bF(e,t,n,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function SF(e,t,n){e.levelkeys=t;const{encryptedFragments:r}=n;r.length&&r[r.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||r.push(e)}function wF(e,t,n){e.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${n[0]})`)}function CF(e,t,n){e.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${n[0]})`)}function TF(e,t){const n=t.startPTS;if(YP(n)){let r,i=0;t.sn>e.sn?(i=n-e.start,r=e):(i=e.start-n,r=t),r.duration!==i&&r.setDuration(i)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function MF(e,t,n,r,i,s,a){r-n<=0&&(a.warn("Fragment should have a positive duration",t),r=n+t.duration,s=i+t.duration);let o=n,l=r;const c=t.startPTS,u=t.endPTS;if(YP(c)){const h=Math.abs(c-n);e&&h>e.totalduration?a.warn(`media timestamps and playlist times differ by ${h}s for level ${t.level} ${e.url}`):YP(t.deltaPTS)?t.deltaPTS=Math.max(h,t.deltaPTS):t.deltaPTS=h,o=Math.max(n,c),n=Math.min(n,c),i=void 0!==t.startDTS?Math.min(i,t.startDTS):i,l=Math.min(r,u),r=Math.max(r,u),s=void 0!==t.endDTS?Math.max(s,t.endDTS):s}const h=n-t.start;0!==t.start&&t.setStart(n),t.setDuration(r-t.start),t.startPTS=n,t.maxStartPTS=o,t.startDTS=i,t.endPTS=r,t.minEndPTS=l,t.endDTS=s;const d=t.sn;if(!e||d<e.startSN||d>e.endSN)return 0;let f;const p=d-e.startSN,m=e.fragments;for(m[p]=t,f=p;f>0;f--)TF(m[f],m[f-1]);for(f=p;f<m.length-1;f++)TF(m[f],m[f+1]);return e.fragmentHint&&TF(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,h}function IF(e,t,n){if(e===t)return;let r=null;const i=e.fragments;for(let e=i.length-1;e>=0;e--){const t=i[e].initSegment;if(t){r=t;break}}let s;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,n){const r=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=i;c<=s;c++){const i=l[a+c];let s=o[c];if(r&&!s&&i&&(s=t.fragments[c]=i),i&&s){n(i,s,c,o);const r=i.relurl,a=s.relurl;if(r&&UF(r,a))return void(t.playlistParsingError=RF(`media sequence mismatch ${s.sn}:`,e,t,i,s));if(i.cc!==s.cc)return void(t.playlistParsingError=RF(`discontinuity sequence mismatch (${i.cc}!=${s.cc})`,e,t,i,s))}}}(e,t,(e,n,i,a)=>{if((!t.startCC||t.skippedSegments)&&n.cc!==e.cc){const r=e.cc-n.cc;for(let e=i;e<a.length;e++)a[e].cc+=r;t.endCC=a[a.length-1].cc}YP(e.startPTS)&&YP(e.endPTS)&&(n.setStart(n.startPTS=e.startPTS),n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.setDuration(e.endPTS-e.startPTS),n.duration&&(s=n),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(n.elementaryStreams=e.elementaryStreams),n.loader=e.loader,e.hasStats&&(n.stats=e.stats),e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)});const a=t.fragments,o=t.fragmentHint?a.concat(t.fragmentHint):a;if(r&&o.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)}),t.skippedSegments){if(t.deltaUpdateFailed=a.some(e=>!e),t.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)a.shift();t.startSN=a[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,n){const{dateRanges:r,recentlyRemovedDateranges:i}=t,s=oD({},e);i&&i.forEach(e=>{delete s[e]});const a=Object.keys(s).length;if(!a)return r;return Object.keys(r).forEach(e=>{const t=s[e],i=new jk(r[e].attr,t);i.isValid?(s[e]=i,t||(i.tagOrder+=a)):n.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${GL(r[e].attr)}"`)}),s}(e.dateRanges,t,n));const r=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<o.length;e++)null===o[e].programDateTime&&xF(o[e],o[e-1],r);gF(r,t)}t.endCC=a[a.length-1].cc}if(!t.startCC){var l;const n=LF(e,t.startSN-1);t.startCC=null!=(l=null==n?void 0:n.cc)?l:a[0].cc}!function(e,t,n){if(e&&t){let r=0;for(let i=0,s=e.length;i<=s;i++){const s=e[i],a=t[i+r];s&&a&&s.index===a.index&&s.fragment.sn===a.fragment.sn?n(s,a):r--}}}(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),s?MF(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,n):BF(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const c=t.advancedDateTime;if(t.advanced&&c){const e=t.edge;t.driftStart||(t.driftStartTime=c,t.driftStart=e),t.driftEndTime=c,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function RF(e,t,n,r,i){return new Error(`${e} ${i.url}\nPlaylist starting @${t.startSN}\n${t.m3u8}\n\nPlaylist starting @${n.startSN}\n${n.m3u8}`)}function BF(e,t,n=!0){const r=t.startSN+t.skippedSegments-e.startSN,i=e.fragments,s=r>=0;let a=0;if(s&&r<i.length)a=i[r].start;else if(s&&t.startSN===e.endSN+1)a=e.fragmentEnd;else if(s&&n)a=e.fragmentStart+r*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;a=e.fragmentStart}PF(t,a)}function PF(e,t){if(t){const n=e.fragments;for(let r=e.skippedSegments;r<n.length;r++)n[r].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function DF(e,t=1/0){let n=1e3*e.targetduration;if(e.updated){const r=e.fragments,i=4;if(r.length&&n*i>t){const e=1e3*r[r.length-1].duration;e<n&&(n=e)}}else n/=2;return Math.round(n)}function LF(e,t,n){if(!e)return null;let r=e.fragments[t-e.startSN];return r||(r=e.fragmentHint,r&&r.sn===t?r:t<e.startSN&&n&&n.sn===t?n:null)}function kF(e,t,n){return e?FF(e.partList,t,n):null}function FF(e,t,n){if(e)for(let r=e.length;r--;){const i=e[r];if(i.index===n&&i.fragment.sn===t)return i}return null}function OF(e){e.forEach((e,t)=>{var n;null==(n=e.details)||n.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function UF(e,t){return!(e===t||!t)&&NF(e)!==NF(t)}function NF(e){return e.replace(/\?[^?]*$/,"")}function zF(e,t){for(let r=0,i=e.length;r<i;r++){var n;if((null==(n=e[r])?void 0:n.cc)===t)return e[r]}return null}function GF(e,t){const n=e.start+t;e.startPTS=n,e.setStart(n),e.endPTS=n+e.duration}function QF(e,t){const n=t.fragments;for(let t=0,r=n.length;t<r;t++)GF(n[t],e);t.fragmentHint&&GF(t.fragmentHint,e),t.alignedSliding=!0}function HF(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const n=Math.min(t.endCC,e.endCC),r=zF(t.fragments,n),i=zF(e.fragments,n);if(!r||!i)return;gD.log(`Aligning playlist at start of dicontinuity sequence ${n}`);QF(r.start-i.start,e)}function VF(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const n=e.fragments,r=t.fragments;if(!n.length||!r.length)return;let i,s;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(i=zF(r,a),s=zF(n,a)),i&&s||(i=r[Math.floor(r.length/2)],s=zF(n,i.cc)||n[Math.floor(n.length/2)]);const o=i.programDateTime,l=s.programDateTime;if(!o||!l)return;QF((l-o)/1e3-(s.start-i.start),e)}function jF(e,t,n){WF(e,t,n),e.addEventListener(t,n)}function WF(e,t,n){e.removeEventListener(t,n)}const YF=function(e){let t="";const n=e.length;for(let r=0;r<n;r++)t+=`[${e.start(r).toFixed(3)}-${e.end(r).toFixed(3)}]`;return t},KF="STOPPED",qF="IDLE",XF="KEY_LOADING",$F="FRAG_LOADING",JF="FRAG_LOADING_WAITING_RETRY",ZF="WAITING_TRACK",eO="PARSING",tO="PARSED",nO="ENDED",rO="ERROR",iO="WAITING_INIT_PTS",sO="WAITING_LEVEL";class aO extends Bk{constructor(e,t,n,r,i){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=KF,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:n,mediaBuffer:r,state:i}=this,s=n?n.currentTime:0,a=Lk.bufferInfo(r||n,s,e.maxBufferHole),o=!a.len;if(this.log(`Media seeking to ${YP(s)?s.toFixed(3):s}, state: ${i}, ${o?"out of":"in"} buffer`),this.state===nO)this.resetLoadingState();else if(t){const n=e.maxFragLookUpTolerance,r=t.start-n,i=t.start+t.duration+n;if(o||i<a.start||r>a.end){const e=s>i;(s<r||e)&&(e&&t.loader&&(this.log(`Cancelling fragment load for seek (sn: ${t.sn})`),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(n){this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0);if(s>this.lastCurrentTime&&(this.lastCurrentTime=s),!this.loadingParts){const e=Math.max(a.end,s),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log(`LL-Part loading ON after seeking to ${s.toFixed(2)} with buffer @${e.toFixed(2)}`),this.loadingParts=t)}}this.hls.hasEnoughToStart||(this.log(`Setting ${o?"startPosition":"nextLoadPosition"} to ${s} for seek without enough to start`),this.nextLoadPosition=s,o&&(this.startPosition=s)),o&&this.state===qF&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new Tk(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new wk(e.config)}registerListeners(){const{hls:e}=this;e.on(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(JP.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(JP.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===KF)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=KF}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=Lk.bufferedInfo(i,e.start,0));const s=e.nextStart;if(s&&s>r&&s<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const a=t.partList;if(null!=a&&a.length){const e=a[a.length-1];return Lk.isBuffered(this.media,e.start+e.duration/2)}const o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;jF(n,"seeking",this.onMediaSeeking),jF(n,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===KF&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(null!==r){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),WF(r,"seeking",this.onMediaSeeking),WF(r,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=KF,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){this._doFragLoad(e,t,n,e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn(`${t.type} sn: ${t.sn}${e.part?" part: "+e.part.index:""} of ${this.fragInfo(t,!1,e.part)}) was dropped during download.`),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const t=this.state,n=e.frag;this.fragContextChanged(n)?(t===$F||!this.fragCurrent&&t===eO)&&(this.fragmentTracker.removeFragment(n),this.state=qF):("payload"in e&&(this.log(`Loaded ${n.type} sn: ${n.sn} of ${this.playlistLabel()} ${n.level}`),this.hls.trigger(JP.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(t=>{this.state!==KF&&this.state!==rO&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===fk){const t=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,t),i=Math.max(e.duration,r?r.len:this.config.maxBufferLength),s=this.backtrackFragment;(1===(s?e.sn-s.sn:0)||this.reduceMaxBufferLength(i,e.duration))&&n.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===pk&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:n};this.hls.trigger(JP.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:t}=this,{frag:n,payload:r}=e,i=n.decryptdata;if(r&&r.byteLength>0&&null!=i&&i.key&&i.iv&&qk(i.method)){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer,Xk(i.method)).catch(e=>{throw t.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:n}),e}).then(r=>{const i=self.performance.now();return t.trigger(JP.FRAG_DECRYPTED,{frag:n,payload:r,stats:{tstart:s,tdecrypt:i}}),e.payload=r,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==KF&&this.state!==rO&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==KF&&(this.state=qF),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,r;const i=e.tracks;if(i&&!t.encrypted&&(null!=(n=i.audio)&&n.encrypted||null!=(r=i.video)&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const e=this.media,n=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${e?"attached mediaKeys: "+e.mediaKeys:"detached"})`);return this.warn(n.message),!e||e.mediaKeys?!1:(this.hls.trigger(JP.ERROR,{type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_NO_KEYS,fatal:!1,error:n,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?YF(Lk.getBuffered(n)):"(detached)"})`),FD(e)){var r;if(e.type!==rD.SUBTITLE){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=qF)}const t=null==(r=this.levels)?void 0:r[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=qF}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:i}=e,s=!i||0===i.length||i.some(e=>!e),a=new Pk(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!s);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,r){var i;this.fragCurrent=e;const s=t.details;if(!this.levels||!s)throw new Error(`frag load aborted, missing level${s?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(i=e.decryptdata)&&i.key)e.encrypted||(a=this.keyLoader.loadClear(e,s.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log(`Loading key for ${e.sn} of [${s.startSN}-${s.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=XF,this.fragCurrent=e,a=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(JP.KEY_LOADED,e),this.state===XF&&(this.state=qF),e}),this.hls.trigger(JP.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const o=this.fragPrevious;if(FD(e)&&(!o||e.sn!==o.sn)){const n=this.shouldLoadParts(t.details,e.end);n!==this.loadingParts&&(this.log(`LL-Part loading ${n?"ON":"OFF"} loading sn ${null==o?void 0:o.sn}->${e.sn}`),this.loadingParts=n)}if(n=Math.max(e.start,n||0),this.loadingParts&&FD(e)){const i=s.partList;if(i&&r){n>s.fragmentEnd&&s.fragmentHint&&(e=s.fragmentHint);const o=this.getNextPart(i,e,n);if(o>-1){const l=i[o];let c;return e=this.fragCurrent=l.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${l.index} (${o}/${i.length-1}) of ${this.fragInfo(e,!1,l)}) cc: ${e.cc} [${s.startSN}-${s.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=$F,c=a?a.then(n=>!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(e,l,t,r)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,r).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(JP.FRAG_LOADING,{frag:e,part:l,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(i,n))return Promise.resolve(null)}}var l;if(FD(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${null==(l=s.partList)?void 0:l.filter(e=>e.loaded).map(e=>`[${e.start}-${e.end}]`)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+s.startSN+"-"+s.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),YP(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=$F;const c=this.config.progressive;let u;return u=c&&a?a.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,r)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,c?r:void 0),a]).then(([e])=>(!c&&r&&r(e),e)).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(JP.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,n,r){return new Promise((i,s)=>{var a;const o=[],l=null==(a=n.details)?void 0:a.partList,c=t=>{this.fragmentLoader.loadPart(e,t,r).then(r=>{o[t.index]=r;const s=r.part;this.hls.trigger(JP.FRAG_LOADED,r);const a=kF(n.details,e.sn,t.index+1)||FF(l,e.sn,t.index+1);if(!a)return i({frag:e,part:s,partsLoaded:o});c(a)}).catch(s)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===$P.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===XP.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetFragmentLoading(t.frag)):this.hls.trigger(JP.ERROR,t)}else this.hls.trigger(JP.ERROR,{type:XP.OTHER_ERROR,details:$P.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==eO)return void(this.fragCurrent||this.state===KF||this.state===rO||(this.state=qF));const{frag:n,part:r,level:i}=t,s=self.performance.now();n.stats.parsing.end=s,r&&(r.stats.parsing.end=s);const a=this.getLevelDetails(),o=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);o!==this.loadingParts&&(this.log(`LL-Part loading ${o?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=o),this.updateLevelTiming(n,r,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const i=e.partList[0];if(i.fragment.type===rD.SUBTITLE)return!1;if(t>=i.end+((null==(n=e.fragmentHint)?void 0:n.duration)||0)){var r;if((this.hls.hasEnoughToStart?(null==(r=this.media)?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:i,part:s}=e;if(null==t||!t[r])return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const a=t[r],o=a.details,l=s>-1?kF(o,i,s):null,c=l?l.fragment:LF(o,i,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,n,r,i){if(this.state!==eO)return;const{data1:s,data2:a}=e;let o=s;if(a&&(o=rL(s,a)),!o.length)return;const l=this.initPTS[t.cc],c=l?-l.baseTime/l.timescale:void 0,u={type:e.type,frag:t,part:n,chunkMeta:r,offset:c,parent:t.type,data:o};if(this.hls.trigger(JP.BUFFER_APPENDING,u),e.dropped&&e.independent&&!n){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Lk.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const n=t.currentTime,r=Lk.bufferInfo(t,n,0),i=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),a=Math.max(Math.min(e.start-s,r.end-s),n+s);e.start-a>s&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!YP(r))return null;const i=this.lastCurrentTime>r||null!=(n=this.media)&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,i)}getFwdBufferInfoAtPos(e,t,n,r){const i=Lk.bufferInfo(e,t,r);if(0===i.len&&void 0!==i.nextStart){const s=this.fragmentTracker.getBufferedFrag(t,n);if(s&&(i.nextStart<=s.end||s.gap)){const n=Math.max(Math.min(i.nextStart,s.end)-t,r);return Lk.bufferInfo(e,t,n)}}return i}getMaxBufferLength(e){const{config:t}=this;let n;return n=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),i=Math.max(e-3*t,n.maxMaxBufferLength/2,r);return i>=r&&(n.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0)}getAppendedFrag(e,t=rD.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:i}=this,s=n[0].start,a=i.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const n=i.initialLiveManifestSize;if(r<n)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${n})`),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<s){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);const n=this.hls.startPosition,r=this.hls.liveSyncPosition,i=o?(-1!==n&&n>=s?n:r)||o.start:e;this.log(`Setting startPosition to ${i} to match start frag at live edge. mainStart: ${n} liveSyncPosition: ${r} frag.start: ${null==(l=o)?void 0:l.start}`),this.startPosition=this.nextLoadPosition=i}}else e<=s&&(o=n[0]);if(!o){const n=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,n,t)}let c=this.filterReplacedPrimary(o,t);if(!c&&o){const e=o.sn-t.startSN;c=this.filterReplacedPrimary(n[e+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===mk||n===pk&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,i){let s=null;if(e.gap&&(s=this.getNextFragment(this.nextLoadPosition,t),s&&!s.gap&&n.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(null!==e&&n.len+e.len>=i){const e=s.sn;return this.loopSn!==e&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${e}`),this.loopSn=e),null}}return this.loopSn=void 0,s}get primaryPrefetch(){if(oO(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(oO(this.config)&&e.type!==rD.SUBTITLE){const n=this.hls.interstitialsManager,r=null==n?void 0:n.bufferingItem;if(r){const n=r.event;if(n){if(n.appendInPlace||Math.abs(e.start-r.start)>1||0===r.start)return null}else{if(e.end<=r.start&&!1===(null==t?void 0:t.live))return null;if(e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}}const i=null==n?void 0:n.playerQueue;if(i)for(let t=i.length;t--;){const n=i[t].interstitial;if(n.appendInPlace&&e.start>=n.startTime&&e.end<=n.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,n){let r=-1,i=!1,s=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(s=s&&!o.independent,r>-1&&n<o.start)break;const l=o.loaded;l?r=-1:(i||(o.independent||s)&&o.fragment===t)&&(o.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${o.start}`),r=a),i=l}return r}loadedEndOfParts(e,t){let n;for(let r=e.length;r--;){if(n=e[r],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=function(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!YP(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;for(let r=0;r<e.length;++r){const i=e[r];if(ek(t,n,i))return i}return null}(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const i=n.sn+1;if(i>=e.startSN&&i<=e.endSN){const s=t[i-e.startSN];n.cc===s.cc&&(r=s,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=tk(e,n.cc,n.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:i}=this,{fragments:s,endSN:a}=n;const{fragmentHint:o}=n,{maxFragLookUpTolerance:l}=r,c=n.partList,u=!!(this.loadingParts&&null!=c&&c.length&&o);let h;if(u&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(s=s.concat(o),a=o.sn),e<t){var d;h=JL(i,s,e,e<this.lastCurrentTime||e>t-l||null!=(d=this.media)&&d.paused||!this.startFragRequested?0:l)}else h=s[s.length-1];if(h){const e=h.sn-n.startSN,t=this.fragmentTracker.getState(h);if((t===mk||t===pk&&h.gap)&&(i=h),i&&h.sn===i.sn&&(!u||c[0].fragment.sn>h.sn||!n.live)){if(h.level===i.level){const t=s[e+1];h=h.sn<a&&this.fragmentTracker.getState(t)!==mk?t:null}}}return h}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,s=!t,a=e.alignedSliding&&YP(i);if(s||!a&&!i){!function(e,t){e&&(HF(t,e),t.alignedSliding||VF(t,e),t.alignedSliding||t.skippedSegments||BF(e,t,!1))}(n,e);const i=e.fragmentStart;return this.log(`Live playlist sliding: ${i.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),i}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(-1===n){const i=null!==this.startTimeOffset,s=i?this.startTimeOffset:e.startTimeOffset;null!==s&&YP(s)?(n=t+s,s<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${s} found in ${i?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&FD(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===JF)||(this.state=qF)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var i;if(this.fragContextChanged(r))return void this.warn(`Frag load error must match current frag to retry ${r.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const s=t.details===$P.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction;if(!a)return void(this.state=rO);const{action:o,flags:l,retryCount:c=0,retryConfig:u}=a,h=!!u,d=h&&o===lk.RetryRequest,f=h&&!a.resolved&&l===ck.MoveAllAlternatesMatchingHost,p=null==(n=this.hls.latestLevelDetails)?void 0:n.live;if(!d&&f&&FD(r)&&!r.endList&&p)this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((d||f)&&c<u.maxNumRetry){var m;const n=ok(null==(m=t.response)?void 0:m.code),i=ik(u,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+i,this.state=JF,a.resolved=!0,n)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(t.reason="offline");this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${c+1}/${u.maxNumRetry} in ${i}ms`)}else if(u){if(this.resetFragmentErrors(e),!(c<u.maxNumRetry))return void this.warn(`${t.details} reached or exceeded max retry (${c})`);s||o===lk.RemoveAlternatePermanently||(a.resolved=!0)}else this.state=o===lk.SendAlternateToPenaltyBox?sO:rO;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!ok(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=qF)}reduceLengthAndFlushBuffer(e){if(this.state===eO||this.state===tO){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),i=r&&r.len>.5;i&&this.reduceMaxBufferLength(r.len,(null==t?void 0:t.duration)||10);const s=!i;return s&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===rD.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==KF&&(this.state=qF)}afterBufferFlushed(e,t,n){if(!e)return;const r=Lk.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===nO&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==KF&&(this.state=qF)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${-1===e.level?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const i=n.details;if(!i)return void this.warn("level.details undefined");var s;if(!Object.keys(e.elementaryStreams).reduce((t,s)=>{const a=e.elementaryStreams[s];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${s} duration reliably (${o})`),t||!1;const l=r?0:MF(i,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS,this);return this.hls.trigger(JP.LEVEL_PTS_UPDATED,{details:i,level:n,drift:l,type:s,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t},!1)&&(0===n.fragmentError&&this.treatAsGap(e,n),null===(null==(s=this.transmuxer)?void 0:s.error))){const t=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(t.message),this.hls.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=tO,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(JP.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===rD.MAIN?"level":"track"}fragInfo(e,t=!0,n){var r,i;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${(null!=(r=t&&!n?e.startPTS:(n||e).start)?r:NaN).toFixed(3)}-${(null!=(i=t&&!n?e.endPTS:(n||e).end)?i:NaN).toFixed(3)}]${n&&"main"===e.type?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function oO(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class lO{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;return e.length?(n=1===e.length?e[0]:function(e,t){const n=new Uint8Array(t);let r=0;for(let t=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.length}return n}(e,t),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var cO,uO={exports:{}};var hO=(cO||(cO=1,function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,r,s,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new i(r,s||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);i<s;i++)a[i]=r[i].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,i,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,s),!0;case 6:return u.fn.call(u.context,t,r,i,s,a),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||i&&!o.once||r&&o.context!==r||a(this,s);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||i&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[s]=1===c.length?c[0]:c:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(uO)),uO.exports),dO=xD(hO);const fO="1.6.11",pO={};function mO(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function gO(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function AO(e,t){let n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3],n}function vO(e,t){const n=t;let r=0;for(;gO(e,t);){r+=10;r+=AO(e,t+6),mO(e,t+10)&&(r+=10),t+=r}if(r>0)return e.subarray(n,n+r)}function yO(e,t){return 255===e[t]&&240==(246&e[t+1])}function EO(e,t){return 1&e[t+1]?7:9}function _O(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function xO(e,t){return t+1<e.length&&yO(e,t)}function bO(e,t){if(xO(e,t)){const n=EO(e,t);if(t+n>=e.length)return!1;const r=_O(e,t);if(r<=n)return!1;const i=t+r;return i===e.length||xO(e,i)}return!1}function SO(e,t,n,r,i){if(!e.samplerate){const s=function(e,t,n,r){const i=t[n+2],s=i>>2&15;if(s>12){const t=new Error(`invalid ADTS sampling index:${s}`);return void e.emit(JP.ERROR,JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const a=1+(i>>6&3),o=t[n+3]>>6&3|(1&i)<<2,l="mp4a.40."+a,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][s];let u=s;5!==a&&29!==a||(u-=3);const h=[a<<3|(14&u)>>1,(1&u)<<7|o<<3];return gD.log(`manifest codec:${r}, parsed codec:${l}, channels:${o}, rate:${c} (ADTS object type:${a} sampling index:${s})`),{config:h,samplerate:c,channelCount:o,codec:l,parsedCodec:l,manifestCodec:r}}(t,n,r,i);if(!s)return;oD(e,s)}}function wO(e){return 9216e4/e}function CO(e,t,n,r,i){const s=r+i*wO(e.samplerate),a=function(e,t){const n=EO(e,t);if(t+n<=e.length){const r=_O(e,t)-n;if(r>0)return{headerLength:n,frameLength:r}}}(t,n);let o;if(a){const{frameLength:r,headerLength:i}=a,l=i+r,c=Math.max(0,n+l-t.length);c?(o=new Uint8Array(l-i),o.set(t.subarray(n+i,t.length),0)):o=t.subarray(n+i,n+l);const u={unit:o,pts:s};return c||e.samples.push(u),{sample:u,length:l,missing:c}}const l=t.length-n;o=new Uint8Array(l),o.set(t.subarray(n,t.length),0);return{sample:{unit:o,pts:s},length:l,missing:-1}}function TO(e,t){return gO(e,t)&&AO(e,t+6)+10<=e.length-t}function MO(e,t=0,n=1/0){return function(e,t,n,r){const i=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let s=1;"BYTES_PER_ELEMENT"in r&&(s=r.BYTES_PER_ELEMENT);const a=(h=e,h&&h.buffer instanceof ArrayBuffer&&void 0!==h.byteLength&&void 0!==h.byteOffset?e.byteOffset:0),o=(a+e.byteLength)/s,l=(a+t)/s,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(n,0),o));var h;return new r(i,c,u-c)}(e,t,n,Uint8Array)}function IO(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return;const n=e.data.subarray(1).indexOf(0);if(-1===n)return;const r=yD(MO(e.data,1,n)),i=e.data[2+n],s=e.data.subarray(3+n).indexOf(0);if(-1===s)return;const a=yD(MO(e.data,3+n,s));let o;return o="--\x3e"===r?yD(MO(e.data,4+n+s)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+n+s)),t.mimeType=r,t.pictureType=i,t.description=a,t.data=o,t}function RO(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=yD(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const n=yD(e.data.subarray(t),!0);t+=n.length+1;const r=yD(e.data.subarray(t));return{key:e.type,info:n,data:r}}const t=yD(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?IO(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const n=yD(e.data.subarray(t),!0);t+=n.length+1;const r=yD(e.data.subarray(t));return{key:e.type,info:n,data:r}}const t=yD(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function BO(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=AO(e,4);return{type:t,size:n,data:e.subarray(10,10+n)}}function PO(e){let t=0;const n=[];for(;gO(e,t);){const r=AO(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const i=t+r;for(;t+10<i;){const r=BO(e.subarray(t)),i=RO(r);i&&n.push(i),t+=r.size+10}mO(e,t)&&(t+=10)}return n}function DO(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function LO(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),n=1&t[3];let r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}}function kO(e){const t=PO(e);for(let e=0;e<t.length;e++){const n=t[e];if(DO(n))return LO(n)}}let FO=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function OO(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class UO{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=rL(this.cachedData,e),this.cachedData=null);let n,r=vO(e,0),i=r?r.length:0;const s=this._audioTrack,a=this._id3Track,o=r?kO(r):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&YP(o))&&(this.basePTS=NO(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:FO.audioId3,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){const t=this.appendFrame(s,e,i);t?(this.frameIndex++,this.lastPTS=t.sample.pts,i+=t.length,n=i):i=l}else TO(e,i)?(r=vO(e,i),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:FO.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,n=i):i++;if(i===l&&n!==l){const t=e.slice(n);this.cachedData?this.cachedData=rL(this.cachedData,t):this.cachedData=t}}return{audioTrack:s,videoTrack:OO(),id3Track:a,textTrack:OO()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:OO(),id3Track:this._id3Track,textTrack:OO()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const NO=(e,t,n)=>{if(YP(e))return 90*e;return 9e4*t+(n?9e4*n.baseTime/n.timescale:0)};let zO=null;const GO=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],QO=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],HO=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],VO=[0,1,1,4];function jO(e,t,n,r,i){if(n+24>t.length)return;const s=WO(t,n);if(s&&n+s.frameLength<=t.length){const a=r+i*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:t.subarray(n,n+s.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}function WO(e,t){const n=e[t+1]>>3&3,r=e[t+1]>>1&3,i=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==n&&0!==i&&15!==i&&3!==s){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*GO[14*(3===n?3-r:3===r?3:4)+i-1],c=QO[3*(3===n?0:2===n?1:2)+s],u=3===o?1:2,h=HO[n][r],d=VO[r],f=8*h*d,p=Math.floor(h*l/c+a)*d;if(null===zO){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);zO=e?parseInt(e[1]):0}return!!zO&&zO<=87&&2===r&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:u,frameLength:p,samplesPerFrame:f}}}function YO(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function KO(e,t){return t+1<e.length&&YO(e,t)}function qO(e,t){if(t+1<e.length&&YO(e,t)){const n=4,r=WO(e,t);let i=n;null!=r&&r.frameLength&&(i=r.frameLength);const s=t+i;return s===e.length||KO(e,s)}return!1}const XO=(e,t)=>{let n=0,r=5;t+=r;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=e[t];const o=Math.min(r,8),l=8-o;s[0]=4278190080>>>24+l<<l,i[0]=(a[0]&s[0])>>l,n=n?n<<o|i[0]:i[0],t+=1,r-=o}return n};class $O extends UO{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=JO(e,t,n,this.basePTS,this.frameIndex);if(-1!==r){return{sample:e.samples[e.samples.length-1],length:r,missing:0}}}static probe(e){if(!e)return!1;const t=vO(e,0);if(!t)return!1;const n=t.length;return 11===e[n]&&119===e[n+1]&&void 0!==kO(t)&&XO(e,n)<16}}function JO(e,t,n,r,i){if(n+8>t.length)return-1;if(11!==t[n]||119!==t[n+1])return-1;const s=t[n+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],o=63&t[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+s];if(n+l>t.length)return-1;const c=t[n+6]>>5;let u=0;2===c?u+=2:(1&c&&1!==c&&(u+=2),4&c&&(u+=2));const h=(t[n+6]<<8|t[n+7])>>12-u&1,d=[2,1,2,3,3,4,4,5][c]+h,f=t[n+5]>>3,p=7&t[n+5],m=new Uint8Array([s<<6|f<<1|p>>2,(3&p)<<6|c<<3|h<<2|o>>4,o<<4&224]),g=r+i*(1536/a*9e4),A=t.subarray(n,n+l);return e.config=m,e.channelCount=d,e.samplerate=a,e.samples.push({unit:A,pts:g}),l}const ZO=/\/emsg[-/]ID3/i;function eU(e,t){return YP(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class tU{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new wk(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ek)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const i=r.subarray(16,r.length-r.length%16),s=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(s).then(i=>{const s=new Uint8Array(i);r.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t);let r=0;for(let t=32;t<e.length-16;t+=160,r+=16)n.set(e.subarray(t,t+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let t=32;t<e.length-16;t+=160,r+=16)e.set(n.subarray(r,r+16),t);return e}decryptAvcSample(e,t,n,r,i){const s=lL(i.data),a=this.getAvcEncryptedData(s);this.decryptBuffer(a.buffer).then(a=>{i.data=this.getAvcDecryptedUnit(s,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)}).catch(r)}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void r();const i=e[t].units;for(;!(n>=i.length);n++){const s=i[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type||(this.decryptAvcSample(e,t,n,r,s),this.decrypter.isSync())))return}}}}class nU{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n,r=this.VideoSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!=(t=r)&&t.units){const e=r.units;n=e[e.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const n=t.samples,r=n.length;if(!r)return void t.dropped++;{const t=n[r-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let i=e.naluState||0;const s=i,a=[];let o,l,c,u=0,h=-1,d=0;for(-1===i&&(h=0,d=this.getNALuType(t,0),i=0,u=1);u<r;)if(o=t[u++],i)if(1!==i)if(o)if(1===o){if(l=u-i-1,h>=0){const e={data:t.subarray(h,l),type:d};a.push(e)}else{const n=this.getLastNalUnit(e.samples);n&&(s&&u<=4-s&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-s)),l>0&&(n.data=rL(n.data,t.subarray(0,l)),n.state=0))}u<r?(c=this.getNALuType(t,u),h=u,d=c,i=0):i=-1}else i=0;else i=3;else i=o?0:2;else i=o?0:1;if(h>=0&&i>=0){const e={data:t.subarray(h,r),type:d,state:i};a.push(e)}if(0===a.length){const n=this.getLastNalUnit(e.samples);n&&(n.data=rL(n.data,t))}return e.naluState=i,a}}class rU{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&gD.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class iU extends nU{parsePES(e,t,n,r){const i=this.parseNALu(e,n.data,r);let s,a=this.VideoSample,o=!1;n.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(r=>{var i,l;switch(r.type){case 1:{let t=!1;s=!0;const i=r.data;if(o&&i.length>4){const e=this.readSliceType(i);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var c;if(t)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=t;break}case 5:s=!0,null!=(i=a)&&i.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:s=!0,oL(r.data,1,n.pts,t.samples);break;case 7:{var u,h;s=!0,o=!0;const t=r.data,n=this.readSPS(t);if(!e.sps||e.width!==n.width||e.height!==n.height||(null==(u=e.pixelRatio)?void 0:u[0])!==n.pixelRatio[0]||(null==(h=e.pixelRatio)?void 0:h[1])!==n.pixelRatio[1]){e.width=n.width,e.height=n.height,e.pixelRatio=n.pixelRatio,e.sps=[t];const r=t.subarray(1,4);let i="avc1.";for(let e=0;e<3;e++){let t=r[e].toString(16);t.length<2&&(t="0"+t),i+=t}e.codec=i}break}case 8:s=!0,e.pps=[r.data];break;case 9:s=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:s=!0;break;default:s=!1}if(a&&s){a.units.push(r)}}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new rU(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n,r=8,i=8;for(let s=0;s<e;s++)0!==i&&(n=t.readEG(),i=(r+n+256)%256),r=0===i?r:i}readSPS(e){const t=new rU(e);let n,r,i,s=0,a=0,o=0,l=0;const c=t.readUByte.bind(t),u=t.readBits.bind(t),h=t.readUEG.bind(t),d=t.readBoolean.bind(t),f=t.skipBits.bind(t),p=t.skipEG.bind(t),m=t.skipUEG.bind(t),g=this.skipScalingList.bind(this);c();const A=c();if(u(5),f(3),c(),m(),100===A||110===A||122===A||244===A||44===A||83===A||86===A||118===A||128===A){const e=h();if(3===e&&f(1),m(),m(),f(1),d())for(r=3!==e?8:12,i=0;i<r;i++)d()&&g(i<6?16:64,t)}m();const v=h();if(0===v)h();else if(1===v)for(f(1),p(),p(),n=h(),i=0;i<n;i++)p();m(),f(1);const y=h(),E=h(),_=u(1);0===_&&f(1),f(1),d()&&(s=h(),a=h(),o=h(),l=h());let x=[1,1];if(d()&&d()){switch(c()){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(y+1)-2*s-2*a),height:(2-_)*(E+1)*16-(_?2:4)*(o+l),pixelRatio:x}}}class sU extends nU{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,r){const i=this.parseNALu(e,n.data,r);let s,a=this.VideoSample,o=!1;n.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(r=>{var i,l;switch(r.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,s=!0;break;case 16:case 17:case 18:case 21:var c;if(s=!0,o)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:s=!0,null!=(i=a)&&i.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:s=!0,oL(r.data,2,n.pts,t.samples);break;case 32:s=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=oD(e.params,this.readVPS(r.data)),this.initVPS=r.data),e.vps=[r.data];break;case 33:if(s=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],r.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(r.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={});for(const n in t.params)e.params[n]=t.params[n]}this.pushParameterSet(e.sps,r.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(s=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(r.data);for(const n in t)e.params[n]=t[n]}this.pushParameterSet(e.pps,r.data,e.vps)}break;case 35:s=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:s=!1}if(a&&s){a.units.push(r)}}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&3===e[r]&&0===e[r-1]&&0===e[r-2]||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new rU(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new rU(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),i=t.readBoolean(),s=t.readBits(5),a=t.readUByte(),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),h=t.readUByte(),d=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),g=t.readUByte(),A=[],v=[];for(let e=0;e<n;e++)A.push(t.readBoolean()),v.push(t.readBoolean());if(n>0)for(let e=n;e<8;e++)t.readBits(2);for(let e=0;e<n;e++)A[e]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),v[e]&&t.readUByte();t.readUEG();const y=t.readUEG();3==y&&t.skipBits(1);const E=t.readUEG(),_=t.readUEG(),x=t.readBoolean();let b=0,S=0,w=0,C=0;x&&(b+=t.readUEG(),S+=t.readUEG(),w+=t.readUEG(),C+=t.readUEG());const T=t.readUEG(),M=t.readUEG(),I=t.readUEG();for(let e=t.readBoolean()?0:n;e<=n;e++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let n=0;n<(3===e?2:6);n++){if(t.readBoolean()){const n=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<n;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const R=t.readUEG();let B=0;for(let e=0;e<R;e++){let n=!1;if(0!==e&&(n=t.readBoolean()),n){e===R&&t.readUEG(),t.readBoolean(),t.readUEG();let n=0;for(let e=0;e<=B;e++){const e=t.readBoolean();let r=!1;e||(r=t.readBoolean()),(e||r)&&n++}B=n}else{const e=t.readUEG(),n=t.readUEG();B=e+n;for(let n=0;n<e;n++)t.readUEG(),t.readBoolean();for(let e=0;e<n;e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let n=0;n<e;n++){for(let e=0;e<I+4;e++)t.readBits(1);t.readBits(1)}}let P=0,D=1,L=1,k=!0,F=1,O=0;t.readBoolean(),t.readBoolean();let U=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],L=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(D=t.readBits(16),L=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readBoolean(),U&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG());if(t.readBoolean()){F=t.readBits(32),O=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),r=t.readBoolean();let i=!1;(e||r)&&(i=t.readBoolean(),i&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),i&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let s=0;s<=n;s++){k=t.readBoolean();let n=!1;k||t.readBoolean()?t.readEG():n=t.readBoolean();const s=n?1:t.readUEG()+1;if(e)for(let e=0;e<s;e++)t.readUEG(),t.readUEG(),i&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(r)for(let e=0;e<s;e++)t.readUEG(),t.readUEG(),i&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let N=E,z=_;if(x){let e=1,t=1;1===y?e=t=2:2==y&&(e=2),N=E-e*S-e*b,z=_-t*C-t*w}const G=r?["A","B","C"][r]:"",Q=a<<24|o<<16|l<<8|c;let H=0;for(let e=0;e<32;e++)H=(H|(Q>>e&1)<<31-e)>>>0;let V=H.toString(16);1===s&&"2"===V&&(V="6");return{codecString:`hvc1.${G}${s}.${V}.${i?"H":"L"}${g}.B0`,params:{general_tier_flag:i,general_profile_idc:s,general_profile_space:r,general_profile_compatibility_flags:[a,o,l,c],general_constraint_indicator_flags:[u,h,d,f,p,m],general_level_idc:g,bit_depth:T+8,bit_depth_luma_minus8:T,bit_depth_chroma_minus8:M,min_spatial_segmentation_idc:P,chroma_format_idc:y,frame_rate:{fixed:k,fps:O/F}},width:N,height:z,pixelRatio:[D,L]}}readPPS(e){const t=new rU(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let i=1;return r&&n?i=0:r?i=3:n&&(i=2),{parallelismType:i}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const aU=188;class oU{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=oU.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),-1!==n}static syncOffset(e){const t=e.length;let n=Math.min(940,t-aU)+1,r=0;for(;r<n;){let i=!1,s=-1,a=0;for(let o=r;o<t;o+=aU){if(71!==e[o]||t-o!==aU&&71!==e[o+aU]){if(a)return-1;break}if(a++,-1===s&&(s=o,0!==s&&(n=Math.min(s+18612,e.length-aU)+1)),i||(i=0===lU(e,o)),i&&a>1&&(0===s&&a>2||o+aU>n))return s}r++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:QD[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=oU.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=oU.createTrack("audio",r),this._id3Track=oU.createTrack("id3"),this._txtTrack=oU.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,r=!1){let i;n||(this.sampleAes=null);const s=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=s.pid,u=s.pesData,h=a.pid,d=o.pid,f=a.pesData,p=o.pesData,m=null,g=this.pmtParsed,A=this._pmtId,v=e.length;if(this.remainderData&&(v=(e=rL(this.remainderData,e)).length,this.remainderData=null),v<aU&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};const y=Math.max(0,oU.syncOffset(e));v-=(v-y)%aU,v<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,v,e.buffer.byteLength-v));let E=0;for(let t=y;t<v;t+=aU)if(71===e[t]){const r=!!(64&e[t+1]),v=lU(e,t);let E;if((48&e[t+3])>>4>1){if(E=t+5+e[t+4],E===t+aU)continue}else E=t+4;switch(v){case c:r&&(u&&(i=fU(u,this.logger))&&(this.readyVideoParser(s.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(s,l,i,!1)),u={data:[],size:0}),u&&(u.data.push(e.subarray(E,t+aU)),u.size+=t+aU-E);break;case h:if(r){if(f&&(i=fU(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i);break;case"ac3":this.parseAC3PES(a,i)}f={data:[],size:0}}f&&(f.data.push(e.subarray(E,t+aU)),f.size+=t+aU-E);break;case d:r&&(p&&(i=fU(p,this.logger))&&this.parseID3PES(o,i),p={data:[],size:0}),p&&(p.data.push(e.subarray(E,t+aU)),p.size+=t+aU-E);break;case 0:r&&(E+=e[E]+1),A=this._pmtId=cU(e,E);break;case A:{r&&(E+=e[E]+1);const i=uU(e,E,this.typeSupported,n,this.observer,this.logger);c=i.videoPid,c>0&&(s.pid=c,s.segmentCodec=i.segmentVideoCodec),h=i.audioPid,h>0&&(a.pid=h,a.segmentCodec=i.segmentAudioCodec),d=i.id3Pid,d>0&&(o.pid=d),null===m||g||(this.logger.warn(`MPEG-TS PMT found at ${t} after unknown PID '${m}'. Backtracking to sync byte @${y} to parse all TS packets.`),m=null,t=y-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=v}}else E++;E>0&&hU(this.observer,new Error(`Found ${E} TS packet/s that do not start with 0x47`),void 0,this.logger),s.pesData=u,a.pesData=f,o.pesData=p;const _={audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};return r&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:i}=e,s=n.pesData,a=t.pesData,o=r.pesData;let l;if(s&&(l=fU(s,this.logger))?(this.readyVideoParser(n.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(n,i,l,!0),n.pesData=null)):n.pesData=s,a&&(l=fU(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=fU(o,this.logger))?(this.parseID3PES(r,l),r.pesData=null):r.pesData=o}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),i=this.sampleAes=new tU(this.observer,this.config,t);return this.decrypt(r,i)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new iU:"hevc"===e&&(this.videoParser=new sU))}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:i}=e;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{n(e)}):n(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let i,s,a,o=t.data;if(r){this.aacOverFlow=null;const t=r.missing,i=r.sample.unit.byteLength;if(-1===t)o=rL(r.sample.unit,o);else{const s=i-t;r.sample.unit.set(o.subarray(0,t),s),e.samples.push(r.sample),n=r.missing}}for(i=n,s=o.length;i<s-1&&!xO(o,i);i++);if(i!==n){let e;const t=i<s-1;if(e=t?`AAC PES did not start with ADTS header,offset:${i}`:"No ADTS header found in AAC PES",hU(this.observer,new Error(e),t,this.logger),!t)return}if(SO(e,this.observer,o,i,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!r)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=wO(e.samplerate);a=r.sample.pts+t}}let l,c=0;for(;i<s;){if(l=CO(e,o,i,a,c),i+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;i<s-1&&!xO(o,i);i++);}}parseMPEGPES(e,t){const n=t.data,r=n.length;let i=0,s=0;const a=t.pts;if(void 0!==a)for(;s<r;)if(KO(n,s)){const t=jO(e,n,s,a,i);if(!t)break;s+=t.length,i++}else s++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(void 0===r)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const i=n.length;let s,a=0,o=0;for(;o<i&&(s=JO(e,n,o,r,a++))>0;)o+=s}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=oD({},t,{type:this._videoTrack?FO.emsg:FO.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function lU(e,t){return((31&e[t+1])<<8)+e[t+2]}function cU(e,t){return(31&e[t+10])<<8|e[t+11]}function uU(e,t,n,r,i,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=lU(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!r){dU("ADTS AAC",s);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!r){dU("H.264",s);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:n.mpeg||n.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):s.log("MPEG audio found, not supported in this browser");break;case 193:if(!r){dU("AC-3",s);break}case 129:n.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let r=t+5,i=l;for(;i>2;){if(106===e[r])!0!==n.ac3?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const t=e[r+1]+2;r+=t,i-=t}}break;case 194:case 135:return hU(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"))}t+=l+5}return a}function hU(e,t,n,r){r.warn(`parsing error: ${t.message}`),e.emit(JP.ERROR,JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:t,reason:t.message})}function dU(e,t){t.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function fU(e,t){let n,r,i,s,a,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=rL(l[0],l[1]),l.splice(1,1);n=l[0];if(1===(n[0]<<16)+(n[1]<<8)+n[2]){if(r=(n[4]<<8)+n[5],r&&r>e.size-6)return null;const c=n[7];192&c&&(s=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&c?(a=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2,s-a>54e5&&(t.warn(`${Math.round((s-a)/9e4)}s delta between PTS and DTS, align them`),s=a)):a=s),i=n[8];let u=i+9;if(e.size<=u)return null;e.size-=u;const h=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){n=l[e];let t=n.byteLength;if(u){if(u>t){u-=t;continue}n=n.subarray(u),t-=u,u=0}h.set(n,o),o+=t}return r&&(r-=i+3),{data:h,pts:s,dts:a,len:r}}return null}class pU{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const mU=Math.pow(2,32)-1;class gU{static init(){let e;for(e in gU.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},gU.types)gU.types.hasOwnProperty(e)&&(gU.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);gU.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);gU.STTS=gU.STSC=gU.STCO=i,gU.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),gU.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),gU.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),gU.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);gU.FTYP=gU.box(gU.types.ftyp,s,o,s,a),gU.DINF=gU.box(gU.types.dinf,gU.box(gU.types.dref,r))}static box(e,...t){let n=8,r=t.length;const i=r;for(;r--;)n+=t[r].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=255&n,s.set(e,4),r=0,n=8;r<i;r++)s.set(t[r],n),n+=t[r].byteLength;return s}static hdlr(e){return gU.box(gU.types.hdlr,gU.HDLR_TYPES[e])}static mdat(e){return gU.box(gU.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(mU+1)),r=Math.floor(t%(mU+1));return gU.box(gU.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(e){return gU.box(gU.types.mdia,gU.mdhd(e.timescale||0,e.duration||0),gU.hdlr(e.type),gU.minf(e))}static mfhd(e){return gU.box(gU.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?gU.box(gU.types.minf,gU.box(gU.types.smhd,gU.SMHD),gU.DINF,gU.stbl(e)):gU.box(gU.types.minf,gU.box(gU.types.vmhd,gU.VMHD),gU.DINF,gU.stbl(e))}static moof(e,t,n){return gU.box(gU.types.moof,gU.mfhd(e),gU.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=gU.trak(e[t]);return gU.box.apply(null,[gU.types.moov,gU.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(gU.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=gU.trex(e[t]);return gU.box.apply(null,[gU.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(mU+1)),r=Math.floor(t%(mU+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return gU.box(gU.types.mvhd,i)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,i;for(r=0;r<t.length;r++)i=t[r].flags,n[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return gU.box(gU.types.sdtp,n)}static stbl(e){return gU.box(gU.types.stbl,gU.stsd(e),gU.box(gU.types.stts,gU.STTS),gU.box(gU.types.stsc,gU.STSC),gU.box(gU.types.stsz,gU.STSZ),gU.box(gU.types.stco,gU.STCO))}static avc1(e){let t,n,r,i=[],s=[];for(t=0;t<e.sps.length;t++)n=e.sps[t],r=n.byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(n));for(t=0;t<e.pps.length;t++)n=e.pps[t],r=n.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(n));const a=gU.box(gU.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(s))),o=e.width,l=e.height,c=e.pixelRatio[0],u=e.pixelRatio[1];return gU.box(gU.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,gU.box(gU.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),gU.box(gU.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return gU.box(gU.types.mp4a,gU.audioStsd(e),gU.box(gU.types.esds,gU.esds(e)))}static mp3(e){return gU.box(gU.types[".mp3"],gU.audioStsd(e))}static ac3(e){return gU.box(gU.types["ac-3"],gU.audioStsd(e),gU.box(gU.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return gU.box(gU.types.stsd,gU.STSD,gU.mp4a(e));if("ac3"===t&&e.config)return gU.box(gU.types.stsd,gU.STSD,gU.ac3(e));if("mp3"===t&&"mp3"===e.codec)return gU.box(gU.types.stsd,gU.STSD,gU.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return gU.box(gU.types.stsd,gU.STSD,gU.avc1(e));if("hevc"===t&&e.vps)return gU.box(gU.types.stsd,gU.STSD,gU.hvc1(e))}throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,i=e.height||0,s=Math.floor(n/(mU+1)),a=Math.floor(n%(mU+1));return gU.box(gU.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))}static traf(e,t){const n=gU.sdtp(e),r=e.id,i=Math.floor(t/(mU+1)),s=Math.floor(t%(mU+1));return gU.box(gU.types.traf,gU.box(gU.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),gU.box(gU.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s])),gU.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,gU.box(gU.types.trak,gU.tkhd(e),gU.mdia(e))}static trex(e){const t=e.id;return gU.box(gU.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,i=12+16*r,s=new Uint8Array(i);let a,o,l,c,u,h;for(t+=8+i,s.set(["video"===e.type?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<r;a++)o=n[a],l=o.duration,c=o.size,u=o.flags,h=o.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*a);return gU.box(gU.types.trun,s)}static initSegment(e){gU.types||gU.init();const t=gU.moov(e);return rL(gU.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let i=r.length;for(let e=0;e<n.length;e+=1){i+=3;for(let t=0;t<n[e].length;t+=1)i+=2+n[e][t].length}const s=new Uint8Array(i);s.set(r,0),i=r.length;const a=n.length-1;for(let e=0;e<n.length;e+=1){s.set(new Uint8Array([32+e|(e===a?128:0),0,n[e].length]),i),i+=3;for(let t=0;t<n[e].length;t+=1)s.set(new Uint8Array([n[e][t].length>>8,255&n[e][t].length]),i),i+=2,s.set(n[e][t],i),i+=n[e][t].length}const o=gU.box(gU.types.hvcC,s),l=e.width,c=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return gU.box(gU.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,gU.box(gU.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),gU.box(gU.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,h>>24,h>>16&255,h>>8&255,255&h])))}}gU.types=void 0,gU.HDLR_TYPES=void 0,gU.STTS=void 0,gU.STSC=void 0,gU.STCO=void 0,gU.STSZ=void 0,gU.VMHD=void 0,gU.SMHD=void 0,gU.STSD=void 0,gU.FTYP=void 0,gU.DINF=void 0;function AU(e,t,n=1,r=!1){const i=e*t*n;return r?Math.round(i):i}function vU(e,t=!1){return AU(e,1e3,1/9e4,t)}let yU,EU=null,_U=null;function xU(e,t,n,r){return{duration:t,size:n,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class bU extends uD{constructor(e,t,n,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===EU){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);EU=e?parseInt(e[1]):0}if(null===_U){const e=navigator.userAgent.match(/Safari\/(\d+)/i);_U=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((e,r)=>{let i=r.pts,s=i-e;return s<-4294967296&&(t=!0,i=SU(i,n),s=i-e),s>0?e:i},n);return t&&this.debug("PTS rollover detected"),r}remux(e,t,n,r,i,s,a,o){let l,c,u,h,d,f,p=i,m=i;const g=e.pid>-1,A=t.pid>-1,v=t.samples.length,y=e.samples.length>0,E=a&&v>0||v>1;if((!g||y)&&(!A||E)||this.ISGenerated||a){if(this.ISGenerated){var _,x,b,S;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(_=t.pixelRatio)?void 0:_[0])!==(null==(x=e.pixelRatio)?void 0:x[0])||(null==(b=t.pixelRatio)?void 0:b[1])!==(null==(S=e.pixelRatio)?void 0:S[1]))||!e&&E||null===this.nextAudioTs&&y)&&this.resetInitSegment()}this.ISGenerated||(u=this.generateIS(e,t,i,s));const n=this.isVideoContiguous;let r,a=-1;if(E&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){this.warn(`Dropped ${a} out of ${v} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,m+=(t.samples[0].pts-e)/t.inputTimeScale,r=m}else-1===a&&(this.warn(`No keyframe found out of ${v} video samples`),f=!1);if(this.ISGenerated){if(y&&E){const n=this.getVideoStartPts(t.samples),r=(SU(e.samples[0].pts,n)-n)/t.inputTimeScale;p+=Math.max(0,r),m+=Math.max(0,-r)}if(y){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),u=this.generateIS(e,t,i,s)),c=this.remuxAudio(e,p,this.isAudioContiguous,s,A||E||o===rD.AUDIO?m:void 0),E){const r=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),u=this.generateIS(e,t,i,s)),l=this.remuxVideo(t,m,n,r)}}else E&&(l=this.remuxVideo(t,m,n,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(d=wU(n,i,this._initPTS,this._initDTS)),r.samples.length&&(h=CU(r,i,this._initPTS))),{audio:c,video:l,initSegment:u,independent:f,text:h,id3:d}}generateIS(e,t,n,r){const i=e.samples,s=t.samples,a=this.typeSupported,o={},l=this._initPTS;let c,u,h,d=!l||r,f="audio/mp4",p=-1;if(d&&(c=u=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):gU.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(p=e.id,h=e.inputTimeScale,l&&h===l.timescale?d=!1:c=u=i[0].pts-Math.round(h*n))}if(t.sps&&t.pps&&s.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:gU.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(p=t.id,h=t.inputTimeScale,l&&h===l.timescale)d=!1;else{const e=this.getVideoStartPts(s),t=Math.round(h*n);u=Math.min(u,SU(s[0].dts,e)-t),c=Math.min(c,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,d?(l&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${n} ${c/h} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${c/h} (${c}/${h}) trackId: ${p}`),this._initPTS={baseTime:c,timescale:h,trackId:p},this._initDTS={baseTime:u,timescale:h,trackId:p}):c=h=void 0,{tracks:o,initPTS:c,timescale:h,trackId:p}}remuxVideo(e,t,n,r){const i=e.inputTimeScale,s=e.samples,a=[],o=s.length,l=this._initPTS,c=l.baseTime*i/l.timescale;let u,h,d=this.nextVideoTs,f=8,p=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,A=!1;if(!n||null===d){const e=c+t*i,r=s[0].pts-SU(s[0].dts,s[0].pts);EU&&null!==d&&Math.abs(e-r-(d+c))<15e3?n=!0:d=e-r-c}const v=d+c;for(let e=0;e<o;e++){const t=s[e];t.pts=SU(t.pts,v),t.dts=SU(t.dts,v),t.dts<s[e>0?e-1:e].dts&&(A=!0)}A&&s.sort(function(e,t){const n=e.dts-t.dts,r=e.pts-t.pts;return n||r}),u=s[0].dts,h=s[s.length-1].dts;const y=h-u,E=y?Math.round(y/(o-1)):p||e.inputTimeScale/30;if(n){const n=u-v,r=n>E,i=n<-1;if((r||i)&&(r?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${vU(n,!0)} ms (${n}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${vU(-n,!0)} ms (${n}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!i||v>=s[0].pts||EU)){u=v;const e=s[0].pts-n;if(r)s[0].dts=u,s[0].pts=e;else{let t=!0;for(let r=0;r<s.length&&!(s[r].dts>e&&t);r++){const e=s[r].pts;if(s[r].dts-=n,s[r].pts-=n,r<s.length-1){const n=s[r+1].pts;t=n<=s[r].pts==n<=e}}}this.log(`Video: Initial PTS/DTS adjusted: ${vU(e,!0)}/${vU(u,!0)}, delta: ${vU(n,!0)} ms`)}}u=Math.max(0,u);let _=0,x=0,b=u;for(let e=0;e<o;e++){const t=s[e],n=t.units,r=n.length;let i=0;for(let e=0;e<r;e++)i+=n[e].data.length;x+=i,_+=r,t.length=i,t.dts<b?(t.dts=b,b+=E/4|0||1):b=t.dts,m=Math.min(t.pts,m),g=Math.max(t.pts,g)}h=s[o-1].dts;const S=x+4*_+8;let w;try{w=new Uint8Array(S)}catch(e){return void this.observer.emit(JP.ERROR,JP.ERROR,{type:XP.MUX_ERROR,details:$P.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:S,reason:`fail allocating video mdat ${S}`})}const C=new DataView(w.buffer);C.setUint32(0,S),w.set(gU.types.mdat,4);let T=!1,M=Number.POSITIVE_INFINITY,I=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(let e=0;e<o;e++){const t=s[e],n=t.units;let l,u=0;for(let e=0,t=n.length;e<t;e++){const t=n[e],r=t.data,i=t.data.byteLength;C.setUint32(f,i),f+=4,w.set(r,f),f+=i,u+=4+i}if(e<o-1)p=s[e+1].dts-t.dts,l=s[e+1].pts-t.pts;else{const n=this.config,a=e>0?t.dts-s[e-1].dts:E;if(l=e>0?t.pts-s[e-1].pts:E,n.stretchShortVideoTrack&&null!==this.nextAudioTs){const e=Math.floor(n.maxBufferHole*i),s=(r?m+r*i:this.nextAudioTs+c)-t.pts;s>e?(p=s-a,p<0?p=a:T=!0,this.log(`It is approximately ${s/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=a}else p=a}const h=Math.round(t.pts-t.dts);M=Math.min(M,p),R=Math.max(R,p),I=Math.min(I,l),B=Math.max(B,l),a.push(xU(t.key,p,u,h))}if(a.length)if(EU){if(EU<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(_U&&B-I<R-M&&E/R<.025&&0===a[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,n=a.length;t<n;t++){const r=e+a[t].duration,i=e+a[t].cts;if(t<n-1){const e=r+a[t+1].cts;a[t].duration=e-i}else a[t].duration=t?a[t-1].duration:E;a[t].cts=0,e=r}}p=T||!p?E:p;const P=h+p;this.nextVideoTs=d=P-c,this.videoSampleDuration=p,this.isVideoContiguous=!0;const D={data1:gU.moof(e.sequenceNumber++,u,oD(e,{samples:a})),data2:w,startPTS:(m-c)/i,endPTS:(g+p-c)/i,startDTS:(u-c)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,D}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,n,r,i){const s=e.inputTimeScale,a=s/(e.samplerate?e.samplerate:s),o=this.getSamplesPerFrame(e),l=o*a,c=this._initPTS,u="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],d=void 0!==i;let f=e.samples,p=u?0:8,m=this.nextAudioTs||-1;const g=c.baseTime*s/c.timescale,A=g+t*s;if(this.isAudioContiguous=n=n||f.length&&m>0&&(r&&Math.abs(A-(m+g))<9e3||Math.abs(SU(f[0].pts,A)-(m+g))<20*l),f.forEach(function(e){e.pts=SU(e.pts,A)}),!n||m<0){if(f=f.filter(e=>e.pts>=0),!f.length)return;m=0===i?0:r&&!d?Math.max(0,A-g):f[0].pts-g}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let n=0,r=m+g;n<f.length;n++){const i=f[n],a=i.pts,o=a-r,c=Math.abs(1e3*o/s);if(o<=-t*l&&d)0===n&&(this.warn(`Audio frame @ ${(a/s).toFixed(3)}s overlaps marker by ${Math.round(1e3*o/s)} ms.`),this.nextAudioTs=m=a-g,r=a);else if(o>=t*l&&c<1e4&&d){let t=Math.round(o/l);for(r=a-t*l;r<0&&t&&l;)t--,r+=l;0===n&&(this.nextAudioTs=m=r-g),this.warn(`Injecting ${t} audio frames @ ${((r-g)/s).toFixed(3)}s due to ${Math.round(1e3*o/s)} ms gap.`);for(let s=0;s<t;s++){let t=pU.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=i.unit.subarray()),f.splice(n,0,{unit:t,pts:r}),r+=l,n++}}i.pts=r,r+=l}}let v,y=null,E=null,_=0,x=f.length;for(;x--;)_+=f[x].unit.byteLength;for(let t=0,r=f.length;t<r;t++){const r=f[t],i=r.unit;let s=r.pts;if(null!==E){h[t-1].duration=Math.round((s-E)/a)}else{if(n&&"aac"===e.segmentCodec&&(s=m+g),y=s,!(_>0))return;_+=p;try{v=new Uint8Array(_)}catch(e){return void this.observer.emit(JP.ERROR,JP.ERROR,{type:XP.MUX_ERROR,details:$P.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:_,reason:`fail allocating audio mdat ${_}`})}if(!u){new DataView(v.buffer).setUint32(0,_),v.set(gU.types.mdat,4)}}v.set(i,p);const l=i.byteLength;p+=l,h.push(xU(!0,o,l,0)),E=s}const b=h.length;if(!b)return;const S=h[h.length-1];m=E-g,this.nextAudioTs=m+a*S.duration;const w=u?new Uint8Array(0):gU.moof(e.sequenceNumber++,y/a,oD({},e,{samples:h}));e.samples=[];const C=(y-g)/s,T=m/s,M={data1:w,data2:v,startPTS:C,endPTS:T,startDTS:C,endDTS:T,type:"audio",hasAudio:!0,hasVideo:!1,nb:b};return this.isAudioContiguous=!0,M}}function SU(e,t){let n;if(null===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}function wU(e,t,n,r){const i=e.samples.length;if(!i)return;const s=e.inputTimeScale;for(let a=0;a<i;a++){const i=e.samples[a];i.pts=SU(i.pts-n.baseTime*s/n.timescale,t*s)/s,i.dts=SU(i.dts-r.baseTime*s/r.timescale,t*s)/s}const a=e.samples;return e.samples=[],{samples:a}}function CU(e,t,n){const r=e.samples.length;if(!r)return;const i=e.inputTimeScale;for(let s=0;s<r;s++){const r=e.samples[s];r.pts=SU(r.pts-n.baseTime*i/n.timescale,t*i)/i}e.samples.sort((e,t)=>e.pts-t.pts);const s=e.samples;return e.samples=[],{samples:s}}function TU(e,t,n=!1){return void 0!==(null==e?void 0:e.start)?(e.start+(n?e.duration:0))/e.timescale:t}function MU(e,t,n){const r=e.codec;if(r&&r.length>4)return r;if(t===PD){if("ec-3"===r||"ac-3"===r||"alac"===r)return r;if("fLaC"===r||"Opus"===r){return EL(r,!1)}return n.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"}return n.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1"}try{yU=self.performance.now.bind(self.performance)}catch(e){yU=Date.now}const IU=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const i=this.videoTrack=OO("video",1),s=this.audioTrack=OO("audio",1),a=this.txtTrack=OO("text",1);if(this.id3Track=OO("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=XD(e);if(o.video){const{id:e,timescale:t,codec:n,supplemental:r}=o.video;i.id=e,i.timescale=a.timescale=t,i.codec=n,i.supplemental=r}if(o.audio){const{id:e,timescale:t,codec:n}=o.audio;s.id=e,s.timescale=t,s.codec=n}a.id=QD.text,i.sampleDuration=0,i.duration=s.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let n=0;n<t;){const r=jD(e,n);if(r>8&&109===e[n+4]&&111===e[n+5]&&111===e[n+6]&&102===e[n+7])return!0;n=r>1?n+r:t}return!1}(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=rL(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},n=KD(e,["moof"]);if(n.length<2)return t.remainder=e,t;const r=n[n.length-1];return t.valid=e.slice(0,r.byteOffset-8),t.remainder=e.slice(r.byteOffset-8),t}(n);this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array}else r.samples=n;const s=this.extractID3Track(r,t);return i.samples=iL(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=iL(e,t),{videoTrack:t,audioTrack:OO(),id3Track:r,textTrack:OO()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=KD(e.samples,["emsg"]);r&&r.forEach(e=>{const r=function(e){const t=e[0];let n="",r="",i=0,s=0,a=0,o=0,l=0,c=0;if(0===t){for(;"\0"!==HD(e.subarray(c,c+1));)n+=HD(e.subarray(c,c+1)),c+=1;for(n+=HD(e.subarray(c,c+1)),c+=1;"\0"!==HD(e.subarray(c,c+1));)r+=HD(e.subarray(c,c+1)),c+=1;r+=HD(e.subarray(c,c+1)),c+=1,i=jD(e,12),s=jD(e,16),o=jD(e,20),l=jD(e,24),c=28}else if(1===t){c+=4,i=jD(e,c),c+=4;const t=jD(e,c);c+=4;const s=jD(e,c);for(c+=4,a=2**32*t+s,KP(a)||(a=Number.MAX_SAFE_INTEGER,gD.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=jD(e,c),c+=4,l=jD(e,c),c+=4;"\0"!==HD(e.subarray(c,c+1));)n+=HD(e.subarray(c,c+1)),c+=1;for(n+=HD(e.subarray(c,c+1)),c+=1;"\0"!==HD(e.subarray(c,c+1));)r+=HD(e.subarray(c,c+1)),c+=1;r+=HD(e.subarray(c,c+1)),c+=1}return{schemeIdUri:n,value:r,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(ZO.test(r.schemeIdUri)){const e=eU(r,t);let i=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;i<=.001&&(i=Number.POSITIVE_INFINITY);const s=r.payload;n.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:FO.emsg,duration:i})}else if(this.config.enableEmsgKLVMetadata&&r.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=eU(r,t);n.samples.push({data:r.payload,len:r.payload.byteLength,dts:e,pts:e,type:FO.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends uD{constructor(e,t,n,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:i,video:s}=this.initData=XD(e);if(t)!function(e,t){if(!e||!t)return;const n=t.keyId;n&&t.isCommonEncryption&&KD(e,["moov","trak"]).forEach(e=>{const t=KD(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let r=KD(t,["enca"]);const i=r.length>0;i||(r=KD(t,["encv"])),r.forEach(e=>{KD(i?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{const t=nL(e);if(t){const e=t.subarray(8,24);e.some(e=>0!==e)||(gD.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${ED(e)} -> ${ED(n)}`),t.set(n,8))}})})})}(e,t);else{const e=i||s;null!=e&&e.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${e.codec}")!`)}i&&(n=MU(i,PD,this)),s&&(r=MU(s,DD,this));const a={};i&&s?a.audiovideo={container:"video/mp4",codec:n+","+r,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:e,id:"main"}:i?a.audio={container:"audio/mp4",codec:n,encrypted:i.encrypted,initSegment:e,id:"audio"}:s?a.video={container:"video/mp4",codec:r,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,r,i,s){var a,o;let{initPTS:l,lastEndTime:c}=this;const u={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};YP(c)||(c=this.lastEndTime=i||0);const h=t.samples;if(!h.length)return u;const d={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(h),f=this.initData),null==(o=f)||!o.length)return this.warn("Failed to generate initSegment."),u;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(e,t,n){const r={},i=KD(e,["moof","traf"]);for(let e=0;e<i.length;e++){const s=i[e],a=KD(s,["tfhd"])[0],o=jD(a,4),l=t[o];if(!l)continue;r[o]||(r[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const c=r[o],u=KD(s,["tfdt"])[0];if(u){const e=u[0];let t=jD(u,4);1===e&&(t===zD?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=zD+1,t+=jD(u,8))),YP(t)&&(!YP(c.start)||t<c.start)&&(c.start=t)}const h=l.default,d=jD(a,0)|(null==h?void 0:h.flags);let f=(null==h?void 0:h.duration)||0;8&d&&(f=jD(a,2&d?12:8));const p=KD(s,["trun"]);let m=c.start||0,g=0,A=f;for(let e=0;e<p.length;e++){const t=p[e],n=jD(t,4),r=c.sampleCount;c.sampleCount+=n;const i=1&t[3],s=4&t[3],a=1&t[2],o=2&t[2],l=4&t[2],u=8&t[2];let h=8,d=n;for(i&&(h+=4),s&&n&&(1&t[h+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=r),h+=4,a?(A=jD(t,h),h+=4):A=f,o&&(h+=4),u&&(h+=4),m+=A,g+=A,d--);d--;)a?(A=jD(t,h),h+=4):A=f,o&&(h+=4),l&&(1&t[h+1]||void 0===c.keyFrameIndex&&(c.keyFrameIndex=c.sampleCount-(d+1),c.keyFrameStart=m),h+=4),u&&(h+=4),m+=A,g+=A;!g&&f&&(g+=f*n)}c.duration+=g}if(!Object.keys(r).some(e=>r[e].duration)){let t=1/0,n=0;const i=KD(e,["sidx"]);for(let e=0;e<i.length;e++){const r=qD(i[e]);if(null!=r&&r.references){t=Math.min(t,r.earliestPresentationTime/r.timescale);const e=r.references.reduce((e,t)=>e+t.info.duration||0,0);n=Math.max(n,e+r.earliestPresentationTime/r.timescale)}}n&&YP(n)&&Object.keys(r).forEach(e=>{r[e].duration||(r[e].duration=n*r[e].timescale-r[e].start)})}return r}(h,f,this),m=f.audio?p[f.audio.id]:null,g=f.video?p[f.video.id]:null,A=TU(g,1/0),v=TU(m,1/0),y=TU(g,0,!0),E=TU(m,0,!0);let _=i,x=0;const b=m&&(!g||!l&&v<A||l&&l.trackId===f.audio.id),S=b?m:g;if(S){const e=S.timescale,t=S.start-i*e,n=b?f.audio.id:f.video.id;_=S.start/e,x=b?E-v:y-A,!s&&l||!function(e,t,n,r){if(null===e)return!0;const i=Math.max(r,1),s=t-e.baseTime/e.timescale;return Math.abs(s-n)>i}(l,_,i,x)&&e===l.timescale||(l&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${i} ${t/e} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${_-i} (${t}/${e}) trackId: ${n}`),l=null,d.initPTS=t,d.timescale=e,d.trackId=n)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);l?(d.initPTS=l.baseTime,d.timescale=l.timescale,d.trackId=l.trackId):(d.timescale&&void 0!==d.trackId&&void 0!==d.initPTS||(this.warn("Could not set initPTS"),d.initPTS=_,d.timescale=1,d.trackId=-1),this.initPTS=l={baseTime:d.initPTS,timescale:d.timescale,trackId:d.trackId});const w=_-l.baseTime/l.timescale,C=w+x;x>0?this.lastEndTime=C:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const T=!!f.audio,M=!!f.video;let I="";T&&(I+="audio"),M&&(I+="video");const R={data1:h,startPTS:w,startDTS:w,endPTS:C,endDTS:C,type:I,hasAudio:T,hasVideo:M,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};u.audio=T&&!M?R:void 0,u.video=M?R:void 0;const B=null==g?void 0:g.sampleCount;if(B){const e=g.keyFrameIndex,t=-1!==e;R.nb=B,R.dropped=0===e||this.isVideoContiguous?0:t?e:B,R.independent=t,R.firstKeyFrame=e,t&&g.keyFrameStart&&(R.firstKeyFramePTS=(g.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(u.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),R.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${e}/${B} dropped: ${R.dropped} start: ${R.firstKeyFramePTS||"NA"}`)}return u.initSegment=d,u.id3=wU(n,i,l,l),r.samples.length&&(u.text=CU(r,i,l)),u}}},{demux:oU,remux:bU},{demux:class extends UO{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=vO(e,0);let r=(null==n?void 0:n.length)||0;if(qO(e,r))return!1;for(let n=e.length;r<n;r++)if(bO(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&yO(e,t)&&_O(e,t)<=e.length-t}(e,t)}appendFrame(e,t,n){SO(e,this.observer,t,n,e.manifestCodec);const r=CO(e,t,n,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:bU},{demux:class extends UO{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=vO(e,0);let n=(null==t?void 0:t.length)||0;if(t&&11===e[n]&&119===e[n+1]&&void 0!==kO(t)&&XO(e,n)<=16)return!1;for(let t=e.length;n<t;n++)if(qO(e,n))return gD.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return YO(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,n){if(null!==this.basePTS)return jO(e,t,n,this.basePTS,this.frameIndex)}},remux:bU}];IU.splice(2,0,{demux:$O,remux:bU});class RU{constructor(e,t,n,r,i,s){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=i,this.logger=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const i=n.transmuxing;i.executeStart=yU();let s=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;r&&(this.currentTransmuxState=r);const{contiguous:l,discontinuity:c,trackSwitch:u,accurateTimeOffset:h,timeOffset:d,initSegmentChange:f}=r||a,{audioCodec:p,videoCodec:m,defaultInitPts:g,duration:A,initSegmentData:v}=o,y=function(e,t){let n=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(n=t);return n}(s,t);if(y&&qk(y.method)){const e=this.getDecrypter(),t=Xk(y.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(s,y.key.buffer,y.iv.buffer,t).then(e=>{const t=this.push(e,null,n);return this.decryptionPromise=null,t}),this.decryptionPromise;{let r=e.softwareDecrypt(s,y.key.buffer,y.iv.buffer,t);if(n.part>-1){const t=e.flush();r=t?t.buffer:t}if(!r)return i.executeEnd=yU(),BU(n);s=new Uint8Array(r)}}const E=this.needsProbing(c,u);if(E){const e=this.configureTransmuxer(s);if(e)return this.logger.warn(`[transmuxer] ${e.message}`),this.observer.emit(JP.ERROR,JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),i.executeEnd=yU(),BU(n)}(c||u||f||E)&&this.resetInitSegment(v,p,m,A,t),(c||f||E)&&this.resetInitialTimestamp(g),l||this.resetContiguity();const _=this.transmux(s,y,d,h,n);this.asyncResult=PU(_);const x=this.currentTransmuxState;return x.contiguous=!0,x.discontinuity=!1,x.trackSwitch=!1,i.executeEnd=yU(),_}flush(e){const t=e.transmuxing;t.executeStart=yU();const{decrypter:n,currentTransmuxState:r,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const s=[],{timeOffset:a}=r;if(n){const t=n.flush();t&&s.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=yU();const n=[BU(e)];return this.asyncResult?Promise.resolve(n):n}const c=o.flush(a);return PU(c)?(this.asyncResult=!0,c.then(t=>(this.flushRemux(s,t,e),s))):(this.flushRemux(s,c,e),this.asyncResult?Promise.resolve(s):s)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:i,id3Track:s,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===rD.MAIN?"level":"track"} ${n.level}`);const c=this.remuxer.remux(r,i,s,a,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=yU()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,i){const{demuxer:s,remuxer:a}=this;s&&a&&(s.resetInitSegment(e,t,n,r),a.resetInitSegment(e,t,n,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,i){let s;return s=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,r,i):this.transmuxUnencrypted(e,n,r,i),s}transmuxUnencrypted(e,t,n,r){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,s,a,o,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,i){return this.demuxer.demuxSampleAes(e,t,n).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,r,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let i;for(let t=0,n=IU.length;t<n;t++){var s;if(null!=(s=IU[t].demux)&&s.probe(e,this.logger)){i=IU[t];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=i.remux,c=i.demux;o&&o instanceof l||(this.remuxer=new l(n,t,r,this.logger)),a&&a instanceof c||(this.demuxer=new c(n,t,r,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new wk(this.config)),e}}const BU=e=>({remuxResult:{},chunkMeta:e});function PU(e){return"then"in e&&e.then instanceof Function}class DU{constructor(e,t,n,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=i||null}}class LU{constructor(e,t,n,r,i,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=i,this.initSegmentChange=s}}let kU=0;class FU{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=kU++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,n=this.hls;if(n&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var r;const e=null==(r=this.workerContext)?void 0:r.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":n.logger[t.data.logType]&&n.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,n.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error(`${e.message}  (${e.filename}:${e.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(JP.ERROR,{type:XP.OTHER_ERROR,details:$P.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const s=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===JP.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new dO,this.observer.on(JP.FRAG_DECRYPTED,s),this.observer.on(JP.ERROR,s);const a=SL(i.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){const n=this.hls.logger;if(i.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{i.workerPath?(n.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=function(e){const t=pO[e];if(t)return t.clientCount++,t;const n=new self.URL(e,self.location.href).href,r={worker:new self.Worker(n),scriptURL:n,clientCount:1};return pO[e]=r,r}(i.workerPath)):(n.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=pO[fO];if(e)return e.clientCount++,e;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),n=self.URL.createObjectURL(t),r={worker:new self.Worker(n),objectURL:n,clientCount:1};return pO[fO]=r,r}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:GL(i)})}catch(r){n.warn(`Error setting up "${t}" Web Worker, fallback to inline`,r),this.terminateWorker(),this.error=null,this.transmuxer=new RU(this.observer,a,i,"",t,e.logger)}return}}this.transmuxer=new RU(this.observer,a,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=kU++;const t=this.hls.config,n=SL(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:GL(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=pO[e||fO];if(t&&1===t.clientCount--){const{worker:n,objectURL:r}=t;delete pO[e||fO],r&&self.URL.revokeObjectURL(r),n.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,i,s,a,o,l,c){var u,h;l.transmuxing.start=self.performance.now();const{instanceNo:d,transmuxer:f}=this,p=s?s.start:i.start,m=i.decryptdata,g=this.frag,A=!(g&&i.cc===g.cc),v=!(g&&l.level===g.level),y=g?l.sn-g.sn:-1,E=this.part?l.part-this.part.index:-1,_=0===y&&l.id>1&&l.id===(null==g?void 0:g.stats.chunkCount),x=!v&&(1===y||0===y&&(1===E||_&&E<=0)),b=self.performance.now();(v||y||0===i.stats.parsing.start)&&(i.stats.parsing.start=b),!s||!E&&x||(s.stats.parsing.start=b);const S=!(g&&(null==(u=i.initSegment)?void 0:u.url)===(null==(h=g.initSegment)?void 0:h.url)),w=new LU(A,x,o,v,p,S);if(!x||A||S){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===rD.MAIN?"level":"track"}: ${l.level} id: ${l.id}\n        discontinuity: ${A}\n        trackSwitch: ${v}\n        contiguous: ${x}\n        accurateTimeOffset: ${o}\n        timeOffset: ${p}\n        initSegmentChange: ${S}`);const e=new DU(n,r,t,a,c);this.configureTransmuxer(e)}if(this.frag=i,this.part=s,this.workerContext)this.workerContext.worker.postMessage({instanceNo:d,cmd:"demux",data:e,decryptdata:m,chunkMeta:l,state:w},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,m,l,w);PU(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const t=n.flush(e);PU(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class OU extends aO{constructor(e,t,n){super(e,t,n,"audio-stream-controller",rD.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.on(JP.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(JP.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(JP.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(JP.BUFFER_RESET,this.onBufferReset,this),e.on(JP.BUFFER_CREATED,this.onBufferCreated,this),e.on(JP.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(JP.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(JP.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(JP.FRAG_LOADING,this.onFragLoading,this),e.on(JP.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.off(JP.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(JP.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(JP.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(JP.BUFFER_RESET,this.onBufferReset,this),e.off(JP.BUFFER_CREATED,this.onBufferCreated,this),e.off(JP.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(JP.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(JP.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(JP.FRAG_LOADING,this.onFragLoading,this),e.off(JP.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:i,trackId:s}){if(n===rD.MAIN){const e=t.cc,n=this.fragCurrent;if(this.initPTS[e]={baseTime:r,timescale:i,trackId:s},this.log(`InitPTS for cc: ${e} found from main: ${r/i} (${r}/${i}) trackId: ${s}`),this.mainAnchor=t,this.state===iO){const n=this.waitingData;(!n&&!this.loadingParts||n&&n.frag.cc!==e)&&this.syncWithAnchor(t,null==n?void 0:n.frag)}else!this.hls.hasEnoughToStart&&n&&n.cc!==e?(n.abortRequests(),this.syncWithAnchor(t,n)):this.state===qF&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const r=(null==(n=this.mainFragLoading)?void 0:n.frag)||null;if(t&&(null==r?void 0:r.cc)===t.cc)return;const i=(r||e).cc,s=tk(this.getLevelDetails(),i,this.getLoadPosition());s&&(this.log(`Syncing with main frag at ${s.start} cc ${s.cc}`),this.startFragRequested=!1,this.nextLoadPosition=s.start,this.resetLoadingState(),this.state===qF&&this.doTickIdle())}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=KF);const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),n>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=qF):this.state=ZF,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case qF:this.doTickIdle();break;case ZF:{const{levels:e,trackId:t}=this,n=null==e?void 0:e[t],r=null==n?void 0:n.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=iO}break}case JF:this.checkRetryDate();break;case iO:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:r,complete:i}=e,s=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=$F;const e={frag:t,part:n,payload:r.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),i&&super._handleFragmentLoadComplete(e)}else s&&s.cc!==e.frag.cc&&this.syncWithAnchor(s,e.frag)}else this.state=qF}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:i}=this,s=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!s.startFragPrefetch)||null==n||!n[i])return;const a=n[i],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=ZF,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,PD,rD.AUDIO));const c=this.getFwdBufferInfo(l,rD.AUDIO);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o))return t.trigger(JP.BUFFER_EOS,{type:"audio"}),void(this.state=nO);const u=c.len,h=t.maxBufferLength,d=o.fragments,f=d[0].start,p=this.getLoadPosition(),m=this.flushing?p:c.end;if(this.switchingTrack&&r){const e=p;o.PTSKnown&&e<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=f+.05)}if(u>=h&&!this.switchingTrack&&m<d[d.length-1].start)return;let g=this.getNextFragment(m,o);if(g&&this.isLoopLoading(g,m)&&(g=this.getNextFragmentLoopLoading(g,o,c,rD.MAIN,h)),!g)return void(this.bufferFlushed=!0);let A=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&A&&FD(g)&&!g.endList&&(!o.live||!this.loadingParts&&m<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(A)===mk&&(this.mainFragLoading=A=null),A&&FD(A))){if(g.start>A.end){const e=this.fragmentTracker.getFragAtPos(m,rD.MAIN);e&&e.end>A.end&&(A=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(g.start>A.end)return}this.loadFragment(g,a,m)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(e=>new UL(e))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==KF&&(this.setInterval(100),this.state=qF,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(JP.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:i,id:s,groupId:a,track:o}=t;if(!r)return void this.warn(`Audio tracks reset while loading track ${s} "${o.name}" of "${a}"`);const l=this.mainDetails;if(!l||i.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==KF&&(this.state=ZF));this.cachedTrackLoadedData=null,this.log(`Audio track ${s} "${o.name}" of "${a}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const c=r[s];let u=0;if(i.live||null!=(n=c.details)&&n.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;var h;if(c.details)u=this.alignPlaylists(i,c.details,null==(h=this.levelLastLoaded)?void 0:h.details);i.alignedSliding||(HF(i,l),i.alignedSliding||VF(i,l),u=i.fragmentStart)}c.details=i,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,u),this.hls.trigger(JP.AUDIO_TRACK_UPDATED,{details:i,id:s,groupId:t.groupId}),this.state!==ZF||this.waitForCdnTuneIn(i)||(this.state=qF),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:i}=e,{config:s,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const u=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new FU(this.hls,rD.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[n.cc],f=null==(t=n.initSegment)?void 0:t.data;if(void 0!==d){const e=!1,t=r?r.index:-1,s=-1!==t,a=new Pk(n.level,n.sn,n.stats.chunkCount,i.byteLength,t,s);h.push(i,f,u,"",n,r,c.totalduration,e,a,d)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:e}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new lO,complete:!1};e.push(new Uint8Array(i)),this.state!==KF&&(this.state=iO)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===rD.MAIN&&FD(t.frag)&&(this.mainFragLoading=t,this.state===qF&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type===rD.AUDIO)if(this.fragContextChanged(n))this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if(FD(n)){this.fragPrevious=n;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(JP.AUDIO_TRACK_SWITCHED,cD({},e)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}else this.audioOnly||n.type!==rD.MAIN||n.elementaryStreams.video||n.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var n;if(t.fatal)this.state=rO;else switch(t.details){case $P.FRAG_GAP:case $P.FRAG_PARSING_ERROR:case $P.FRAG_DECRYPT_ERROR:case $P.FRAG_LOAD_ERROR:case $P.FRAG_LOAD_TIMEOUT:case $P.KEY_LOAD_ERROR:case $P.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(rD.AUDIO,t);break;case $P.AUDIO_TRACK_LOAD_ERROR:case $P.AUDIO_TRACK_LOAD_TIMEOUT:case $P.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ZF||(null==(n=t.context)?void 0:n.type)!==tD||(this.state=qF);break;case $P.BUFFER_ADD_CODEC_ERROR:case $P.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case $P.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case $P.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==DD&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==DD){this.flushing=!1,this.bufferFlushed=!0,this.state===nO&&(this.state=qF);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,rD.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:i,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:c}=a,{details:u}=c,{audio:h,text:d,id3:f,initSegment:p}=i;if(!this.fragContextChanged(o)&&u){if(this.state=eO,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const e=o.initSegment||o;if(this.unhandledEncryptionError(p,o))return;this._bufferInitSegment(c,p.tracks,e,s),r.trigger(JP.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:p.tracks})}if(h){const{startPTS:e,endPTS:t,startDTS:n,endDTS:r}=h;l&&(l.elementaryStreams[PD]={startPTS:e,endPTS:t,startDTS:n,endDTS:r}),o.setElementaryStreamInfo(PD,e,t,n,r),this.bufferFragmentData(h,o,l,s)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=oD({id:n,frag:o,details:u},f);r.trigger(JP.FRAG_PARSING_METADATA,e)}if(d){const e=oD({id:n,frag:o,details:u},d);r.trigger(JP.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,n,r){if(this.state!==eO)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const i=t.audio;i.id=rD.AUDIO;const s=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${s}/${i.codec}]`),s&&1===s.split(",").length&&(i.levelCodec=s),this.hls.trigger(JP.BUFFER_CODECS,t);const a=i.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:a};this.hls.trigger(JP.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);var i;if(this.switchingTrack||r===dk||r===pk)if(FD(e))if(null!=(i=t.details)&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=iO;const n=this.mainDetails;n&&n.fragmentStart!==t.details.fragmentStart&&VF(t.details,n)}else super.loadFragment(e,t,n);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:i,audioCodec:s,channels:a}=this.bufferedTrack;WL({name:t,lang:n,assocLang:r,characteristics:i,audioCodec:s,channels:a},e,YL)||(qL(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(JP.AUDIO_TRACK_SWITCHED,cD({},e))}}class UU extends uD{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=null==t?void 0:t.renditionReports;if(r){let i=-1;for(let n=0;n<r.length;n++){const s=r[n];let a;try{a=new self.URL(s.URI,t.url).href}catch(e){this.warn(`Could not construct new URL for Rendition Report: ${e}`),a=s.URI||""}if(a===e){i=n;break}a===e.substring(0,a.length)&&(i=n)}if(-1!==i){const e=r[i],s=parseInt(e["LAST-MSN"])||t.lastPartSn;let a=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=n&&FL(n);return new OL(s,a>=0?a:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}return e}playlistLoaded(e,t,n){const{details:r,stats:i}=t,s=self.performance.now(),a=i.loading.first?Math.max(0,s-i.loading.first):0;r.advancedDateTime=Date.now()-a;const o=this.hls.config.timelineOffset;if(o!==r.appliedTimelineOffset){const e=Math.max(o||0,0);r.appliedTimelineOffset=e,r.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(r.live||null!=n&&n.live){const o="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){IF(n,r,this);const e=r.playlistParsingError;if(e){this.warn(e);const n=this.hls;if(!n.config.ignorePlaylistParsingErrors){var l;const{networkDetails:s}=t;return void n.trigger(JP.ERROR,{type:XP.NETWORK_ERROR,details:$P.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=r.fragments[0])?void 0:l.type,networkDetails:s,stats:i})}r.playlistParsingError=null}}-1===r.requestScheduled&&(r.requestScheduled=i.loading.start);const c=this.hls.mainForwardBufferInfo,u=c?c.end-c.len:0,h=DF(r,1e3*(r.edge-u));if(r.requestScheduled+h<s?r.requestScheduled=s:r.requestScheduled+=h,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let d,f,p;if(r.canBlockReload&&r.endSN&&r.advanced){const e=this.hls.config.lowLatencyMode,i=r.lastPartSn,a=r.endSN,l=r.lastPartIndex,c=i===a;-1!==l?c?(f=a+1,p=e?0:l):(f=i,p=e?l+1:r.maxPartIndex):f=a+1;const u=r.age,h=u+r.ageHeader;let m=Math.min(h-r.partTarget,1.5*r.targetduration);if(m>0){if(h>3*r.targetduration)this.log(`Playlist last advanced ${u.toFixed(2)}s ago. Omitting segment and part directives.`),f=void 0,p=void 0;else if(null!=n&&n.tuneInGoal&&h-r.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${m} with playlist age: ${r.age}`),m=0;else{const e=Math.floor(m/r.targetduration);if(f+=e,void 0!==p){p+=Math.round(m%r.targetduration/r.partTarget)}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${u.toFixed(2)}s goal: ${m} skip sn ${e} to part ${p}`)}r.tuneInGoal=m}if(d=this.getDeliveryDirectives(r,t.deliveryDirectives,f,p),e||!c)return r.requestScheduled=s,void this.loadingPlaylist(o,d)}else(r.canBlockReload||r.canSkipUntil)&&(d=this.getDeliveryDirectives(r,t.deliveryDirectives,f,p));d&&void 0!==f&&r.canBlockReload&&(r.requestScheduled=i.loading.first+Math.max(h-2*a,h/2)),this.scheduleLoading(o,d,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r)return void this.loadingPlaylist(e,t);const i=self.performance.now(),s=r.requestScheduled;if(i>=s)return void this.loadingPlaylist(e,t);const a=s-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,r){let i=FL(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,i=kL.No),new OL(n,r,i)}checkRetry(e){const t=e.details,n=nk(e),r=e.errorAction,{action:i,retryCount:s=0,retryConfig:a}=r||{},o=!!r&&!!a&&(i===lk.RetryRequest||!r.resolved&&i===lk.SendAlternateToPenaltyBox);if(o){var l;if(s>=a.maxNumRetry)return!1;if(n&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=ik(a,s);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,r.resolved=!0}return o}}function NU(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!zU(e[n].attrs,t[n].attrs))return!1;return!0}function zU(e,t,n){const r=e["STABLE-RENDITION-ID"];return r&&!n?r===t["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>e[n]!==t[n])}function GU(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class QU extends UU{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.on(JP.LEVEL_LOADING,this.onLevelLoading,this),e.on(JP.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(JP.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(JP.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.off(JP.LEVEL_LOADING,this.onLevelLoading,this),e.off(JP.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(JP.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(JP.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:i}=t,s=this.tracksInGroup[n];if(!s||s.groupId!==r)return void this.warn(`Audio track with id:${n} and group:${r} not found in active group ${null==s?void 0:s.groupId}`);const a=s.details;s.details=t.details,this.log(`Audio track ${n} "${s.name}" lang:${s.lang} group:${r} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let i=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==r?void 0:r.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!i&&t){const n=jL(t,e,YL);if(n>-1)i=e[n];else{const e=jL(t,this.tracks);i=this.tracks[e]}}let r=this.findTrackId(i);-1===r&&i&&(r=this.findTrackId(null));const a={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==n?void 0:n.join(",")}`),this.hls.trigger(JP.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==r&&-1===o)this.setAudioTrack(r);else if(e.length&&-1===o){var s;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(s=this.groupIds)?void 0:s.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==tD||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&WL(e,r,YL))return r;const i=jL(e,this.tracksInGroup,YL);if(i>-1){const e=this.tracksInGroup[i];return this.setAudioTrack(i),e}if(r){let r=t.loadLevel;-1===r&&(r=t.firstAutoLevel);const i=function(e,t,n,r,i){const s=t[r],a=t.reduce((e,t,n)=>{const r=t.uri;return(e[r]||(e[r]=[])).push(n),e},{})[s.uri];a.length>1&&(r=Math.max.apply(Math,a));const o=s.videoRange,l=s.frameRate,c=s.codecSet.substring(0,4),u=KL(t,r,t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==c)return!1;const r=t.audioGroups,s=n.filter(e=>!r||-1!==r.indexOf(e.groupId));return jL(e,s,i)>-1});return u>-1?u:KL(t,r,t=>{const r=t.audioGroups,s=n.filter(e=>!r||-1!==r.indexOf(e.groupId));return jL(e,s,i)>-1})}(e,t.levels,n,r,YL);if(-1===i)return null;t.nextLoadLevel=i}if(e.channels||e.audioCodec){const t=jL(e,n);if(t>-1)return n[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],i=r.details&&!r.details.live;if(e===this.trackId&&r===n&&i)return;if(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(JP.AUDIO_TRACK_SWITCHING,cD({},r)),i)return;const s=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(s)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if((!this.selectDefaultTrack||r.default)&&(!e||WL(e,r,YL)))return n}if(e){const{name:n,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){if(WL({name:n,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o},t[e],YL))return e}for(let n=0;n<t.length;n++){const r=t[n];if(zU(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(zU(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&qL(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,i=this.getUrlWithDirectives(e.url,t),s=e.details,a=null==s?void 0:s.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${r}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${a&&s.live?" age "+a.toFixed(1)+(s.type&&" "+s.type||""):""} ${i}`),this.hls.trigger(JP.AUDIO_TRACK_LOADING,{url:i,id:n,groupId:r,deliveryDirectives:t||null,track:e})}}class HU{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(null===this.queues||null===this.tracks)return;const r=this.queues[t];r.push(e),1!==r.length||n||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=null==(t=e[0])?void 0:t.label;"async-blocker"!==n&&"async-blocker-prepend"!==n||(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(t){var n;if(r.onError(t),null===this.queues||null===this.tracks)return;const i=null==(n=this.tracks[e])?void 0:n.buffer;null!=i&&i.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(e){var t,n;return null!=(t=this.queues)&&t[e]||null!=(n=this.tracks)&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=null==(t=this.tracks)?void 0:t[e],r=null==n?void 0:n.buffer;return r?`SourceBuffer${r.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}const VU=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,jU="HlsJsTrackRemovedError";class WU extends Error{constructor(e){super(e),this.name=jU}}class YU extends uD{constructor(e,t){var n;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:n}=this;e&&this.log("Media source opened"),t&&n&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(JP.MEDIA_ATTACHED,{media:t,mediaSource:n}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=(n=AD(e.config.preferManagedMediaSource),"undefined"!=typeof self&&n===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.on(JP.BUFFER_RESET,this.onBufferReset,this),e.on(JP.BUFFER_APPENDING,this.onBufferAppending,this),e.on(JP.BUFFER_CODECS,this.onBufferCodecs,this),e.on(JP.BUFFER_EOS,this.onBufferEos,this),e.on(JP.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(JP.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(JP.FRAG_PARSED,this.onFragParsed,this),e.on(JP.FRAG_CHANGED,this.onFragChanged,this),e.on(JP.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.off(JP.BUFFER_RESET,this.onBufferReset,this),e.off(JP.BUFFER_APPENDING,this.onBufferAppending,this),e.off(JP.BUFFER_CODECS,this.onBufferCodecs,this),e.off(JP.BUFFER_EOS,this.onBufferEos,this),e.off(JP.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(JP.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(JP.FRAG_PARSED,this.onFragParsed,this),e.off(JP.FRAG_CHANGED,this.onFragChanged,this),e.off(JP.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn(`Transfering MediaSource with${t?" operations in queue":""}${e?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?oD(n,r.tracks):this.sourceBuffers.forEach(e=>{const[t]=e;t&&(n[t]=oD({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),null!=(n=this.transferData)&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const r=AD(this.appendSource);if(r){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const i=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(i),e)this._objectUrl=n.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(i);if(this.appendSource)try{n.removeAttribute("src");const t=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||t&&i instanceof t,KU(n),function(e,t){const n=self.document.createElement("source");n.type="video/mp4",n.src=t,e.appendChild(n)}(n,e),n.load()}catch(t){n.src=e}else n.src=e}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${(null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${null==(n=e.constructor)?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,i=r?Object.keys(r):null,s=i?i.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&i&&s){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${GL(n,(e,t)=>"initSegment"===e?void 0:t)};\ntransfer tracks: ${GL(r,(e,t)=>"initSegment"===e?void 0:t)}}`),!vD(r,n)){t.mediaSource=null,t.tracks=void 0;const i=e.currentTime,s=this.details,a=Math.max(i,(null==s?void 0:s.fragments[0].start)||0);return a-i>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${i} -> ${a}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(n)}") start time: ${a} currentTime: ${i}`),this.onMediaDetaching(JP.MEDIA_DETACHING,{}),this.onMediaAttaching(JP.MEDIA_ATTACHING,t),void(e.currentTime=a))}this.transferData=void 0,i.forEach(e=>{const t=e,n=r[t];if(n){const e=n.buffer;if(e){const r=this.fragmentTracker,i=n.id;if(r.hasFragments(i)||r.hasParts(i)){const n=Lk.getBuffered(e);r.detectEvictedFragments(t,n,i,null,!0)}const s=qU(t),a=[t,e];this.sourceBuffers[s]=a,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,n)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:i,_objectUrl:s}=this;if(i){if(this.log("media source "+(n?"transferring":"detaching")),n)this.sourceBuffers.forEach(([e])=>{e&&this.removeBuffer(e)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===i.readyState;try{const t=i.sourceBuffers;for(let n=t.length;n--;)e&&t[n].abort(),i.removeSourceBuffer(t[n]);e&&i.endOfStream()}catch(e){this.warn(`onMediaDetaching: ${e.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(s&&self.URL.revokeObjectURL(s),this.mediaSrc===s?(r.removeAttribute("src"),this.appendSource&&KU(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(JP.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;null!=(r=this.mediaSource)&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(t){this.warn(`onBufferReset ${e}`,t)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[qU(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new HU(this.tracks)}onBufferCodecs(e,t){const n=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const i="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),s=!i&&this.sourceBufferCount&&this.media&&r.some(e=>!n[e]);i||s?this.warn(`Unsupported transition between "${Object.keys(n)}" and "${r}" SourceBuffers`):(r.forEach(e=>{var r,i;const s=t[e],{id:a,codec:o,levelCodec:l,container:c,metadata:u,supplemental:h}=s;let d=n[e];const f=null==(r=this.transferData)||null==(r=r.tracks)?void 0:r[e],p=null!=f&&f.buffer?f:d,m=(null==p?void 0:p.pendingCodec)||(null==p?void 0:p.codec),g=null==p?void 0:p.levelCodec;d||(d=n[e]={buffer:void 0,listeners:[],codec:o,supplemental:h,container:c,levelCodec:l,metadata:u,id:a});const A=_L(m,g),v=null==A?void 0:A.replace(VU,"$1");let y=_L(o,l);const E=null==(i=y)?void 0:i.replace(VU,"$1");y&&A&&v!==E&&("audio"===e.slice(0,5)&&(y=EL(y,this.appendSource)),this.log(`switching codec ${m} to ${y}`),y!==(d.pendingCodec||d.codec)&&(d.pendingCodec=y),d.container=c,this.appendChangeType(e,c,y))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r=`${t};codecs=${n}`,i={label:`change-type=${r}`,execute:()=>{const i=this.tracks[e];if(i){const s=i.buffer;null!=s&&s.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),s.changeType(r),i.codec=n,i.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(n,rD.MAIN))?void 0:t.gap))return;const i={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>r||null!=t&&t.buffer&&Lk.isBuffered(t.buffer,r)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(r,rD.MAIN))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:i,frag:e},this.append(i,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:i,parent:s,frag:a,part:o,chunkMeta:l,offset:c}=t,u=l.buffering[i],{sn:h,cc:d}=a,f=self.performance.now();u.start=f;const p=a.stats.buffering,m=o?o.stats.buffering:null;0===p.start&&(p.start=f),m&&0===m.start&&(m.start=f);const g=n.audio;let A=!1;"audio"===i&&"audio/mpeg"===(null==g?void 0:g.container)&&(A=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const v=n.video,y=null==v?void 0:v.buffer;if(y&&"initSegment"!==h){const e=o||a,t=this.blockedAudioAppend;if("audio"!==i||"main"===s||this.blockedAudioAppend||v.ending||v.ended){if("video"===i){const n=e.end;if(t){const e=t.frag.start;(n>e||n<this.lastVideoAppendEnd||Lk.isBuffered(y,e))&&this.unblockAudio()}this.lastVideoAppendEnd=n}}else{const t=e.start+.05*e.duration,n=y.buffered,r=this.currentOp("video");n.length||r?!r&&!Lk.isBuffered(y,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const E=(o||a).start,_={label:`append-${i}`,execute:()=>{var e;u.executeStart=self.performance.now();const t=null==(e=this.tracks[i])?void 0:e.buffer;t&&(A?this.updateTimestampOffset(t,E,.1,i,h,d):void 0!==c&&YP(c)&&this.updateTimestampOffset(t,c,1e-6,i,h,d)),this.appendExecutor(r,i)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();u.executeEnd=u.end=e,0===p.first&&(p.first=e),m&&0===m.first&&(m.first=e);const t={};this.sourceBuffers.forEach(([e,n])=>{e&&(t[e]=Lk.getBuffered(n))}),this.appendErrors[i]=0,"audio"===i||"video"===i?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(JP.BUFFER_APPENDED,{type:i,frag:a,part:o,chunkMeta:l,parent:a.type,timeRanges:t})},onError:e=>{var t;const n={type:XP.MEDIA_ERROR,parent:a.type,details:$P.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:o,chunkMeta:l,error:e,err:e,fatal:!1},r=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)n.details=$P.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!r)n.errorAction=hk(!0);else if(e.name===jU&&0===this.sourceBufferCount)n.errorAction=hk(!0);else{const e=++this.appendErrors[i];this.warn(`Failed ${e}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${r||"no media error"})`),(e>=this.hls.config.appendErrorMaxRetry||r)&&(n.fatal=!0)}this.hls.trigger(JP.ERROR,n)}};this.append(_,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(JP.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:i}=t;n?this.append(this.getFlushOp(n,r,i),n):this.sourceBuffers.forEach(([e])=>{e&&this.append(this.getFlushOp(e,r,i),e)})}onFragParsed(e,t){const{frag:n,part:r}=t,i=[],s=r?r.elementaryStreams:n.elementaryStreams;s[LD]?i.push("audiovideo"):(s[PD]&&i.push("audio"),s[DD]&&i.push("video"));0===i.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(()=>{const e=self.performance.now();n.stats.buffering.end=e,r&&(r.stats.buffering.end=e);const t=r?r.stats:n.stats;this.hls.trigger(JP.FRAG_BUFFERED,{frag:n,part:r,stats:t,id:n.type})},i).catch(e=>{this.warn(`Fragment buffered callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([e])=>{if(e){const n=this.tracks[e];t.type&&t.type!==e||(n.ending=!0,n.ended||(n.ended=!0,this.log(`${e} buffer reached EOS`)))}});const r=!1!==(null==(n=this.overrides)?void 0:n.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t;return e&&!(null!=(t=this.tracks[e])&&t.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(JP.BUFFERED_TO_END,void 0)):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})):(this.tracksEnded(),this.hls.trigger(JP.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(null!==e){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===$P.BUFFER_APPEND_ERROR&&t.frag){var n;const e=null==(n=t.errorAction)?void 0:n.nextAutoLevel;YP(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||null===t)return;if(!this.sourceBufferCount)return;const r=e.config,i=n.currentTime,s=t.levelTargetDuration,a=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(YP(a)&&a>=0){const e=Math.max(a,s),t=Math.floor(i/s)*s-e;this.flushBackBuffer(i,s,t)}const o=r.frontBufferFlushThreshold;if(YP(o)&&o>0){const e=Math.max(r.maxBufferLength,o),t=Math.max(e,s),n=Math.floor(i/s)*s+t;this.flushFrontBuffer(i,s,n)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([e,t])=>{if(t){const i=Lk.getBuffered(t);if(i.length>0&&n>i.start(0)){var r;this.hls.trigger(JP.BACK_BUFFER_REACHED,{bufferEnd:n});const t=this.tracks[e];if(null!=(r=this.details)&&r.live)this.hls.trigger(JP.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(null!=t&&t.ended)return void this.log(`Cannot flush ${e} back buffer while SourceBuffer is in ended state`);this.hls.trigger(JP.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:e})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([t,r])=>{if(r){const i=Lk.getBuffered(r),s=i.length;if(s<2)return;const a=i.start(s-1),o=i.end(s-1);if(n>a||e>=a&&e<=o)return;this.hls.trigger(JP.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:t})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||"open"!==(null==n?void 0:n.readyState))return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,r)}}return{duration:1/0}}const i=null==(e=this.overrides)?void 0:e.duration;if(i)return YP(i)?{duration:i}:null;const s=this.media.duration;return r>(YP(n.duration)?n.duration:0)&&r>s||!YP(s)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:n}){const r=this.mediaSource;this.media&&r&&"open"===r.readyState&&(r.duration!==e&&(YP(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),void 0!==t&&void 0!==n&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${n}.`),r.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${GL(n)}`),this.tracksReady){var r;const e=null==(r=this.transferData)?void 0:r.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const r=this.tracks[t];e[t]={buffer:n,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(JP.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([e])=>{this.executeNext(e)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const s=i,a=e[s];if(this.isPending(a)){const e=this.getTrackCodec(a,s),i=`${a.container};codecs=${e}`;a.codec=e,this.log(`creating sourceBuffer(${i})${this.currentOp(s)?" Queued":""} ${GL(a)}`);try{const e=n.addSourceBuffer(i),r=qU(s),o=[s,e];t[r]=o,a.buffer=e}catch(e){var r;return this.error(`error while trying to add sourceBuffer: ${e.message}`),this.shiftAndExecuteNext(s),null==(r=this.operationQueue)||r.removeBlockers(),delete this.tracks[s],void this.hls.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:s,mimeType:i,parent:a.id})}this.trackSourceBuffer(s,a)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&("video"===t||"audiovideo"===t)&&fL(n,"video")&&(r=function(e,t){const n=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)dL(t[e],"video")||n.push(t[e])}return t&&n.push(t),n.join(",")}(r,n));const i=_L(r,e.levelCodec);return i?"audio"===t.slice(0,5)?EL(i,this.appendSource):i:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{const n=t.removedRanges;null!=n&&n.length&&this.hls.trigger(JP.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;const n=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==n?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(n=this.mediaSource)?void 0:n.readyState}`);this.error(`${r}`,t),this.hls.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const i=this.currentOp(e);i&&i.onError(r)}updateTimestampOffset(e,t,n,r,i,s){const a=t-e.timestampOffset;Math.abs(a)>=n&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${s})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:i}=this,s=this.tracks[e],a=null==s?void 0:s.buffer;if(!r||!i||!a)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(e);const o=YP(r.duration)?r.duration:1/0,l=YP(i.duration)?i.duration:1/0,c=Math.max(0,t),u=Math.min(n,o,l);u>c&&(!s.ending||s.ended)?(s.ended=!1,this.log(`Removing [${c},${u}] from the ${e} SourceBuffer`),a.remove(c,u)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=null==n?void 0:n.buffer;if(!r)throw new WU(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,r=t.map(e=>this.appendBlocker(e));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(t=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;n&&!n.updating&&this.shiftAndExecuteNext(e)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const i=r.buffer;if(!i)return;const s=n.bind(this,e);r.listeners.push({event:t,listener:s}),i.addEventListener(t,s)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(e=>{n.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}}function KU(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function qU(e){return"audio"===e?1:0}class XU{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(JP.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.on(JP.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(JP.BUFFER_CODECS,this.onBufferCodecs,this),e.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(JP.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.off(JP.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(JP.BUFFER_CODECS,this.onBufferCodecs,this),e.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&YP(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((t,n)=>this.isLevelAllowed(t)&&n<=e);return this.clientRect=null,XU.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,n){if(null==e||!e.length)return-1;const r=(e,t)=>!t||(e.width!==t.width||e.height!==t.height);let i=e.length-1;const s=Math.max(t,n);for(let t=0;t<e.length;t+=1){const n=e[t];if((n.width>=s||n.height>=s)&&r(n,e[t+1])){i=t;break}}return i}}const $U={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},JU={HLS:"h"};class ZU{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof ZU?e:new ZU(e))),this.value=e,this.params=t}}function eN(e,t,n,r){return new Error(`failed to ${e} "${i=t,Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":"object"==typeof i?JSON.stringify(i):String(i)}" as ${n}`,{cause:r});var i}function tN(e,t,n){return eN("serialize",e,t,n)}class nN{constructor(e){this.description=e}}const rN="Bare Item";function iN(e){if(!1===ArrayBuffer.isView(e))throw tN(e,"Byte Sequence");return`:${t=e,btoa(String.fromCharCode(...t))}:`;var t}function sN(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw tN(e,"Integer");return e.toString()}function aN(e,t){if(e<0)return-aN(-e,t);const n=Math.pow(10,t);if(Math.abs(e*n%1-.5)<Number.EPSILON){const t=Math.floor(e*n);return(t%2==0?t:t+1)/n}return Math.round(e*n)/n}function oN(e){const t=aN(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw tN(e,"Decimal");const n=t.toString();return n.includes(".")?n:`${n}.0`}const lN=/[\x00-\x1f\x7f]+/;function cN(e){const t=(n=e).description||n.toString().slice(7,-1);var n;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw tN(t,"Token");return t}function uN(e){switch(typeof e){case"number":if(!YP(e))throw tN(e,rN);return Number.isInteger(e)?sN(e):oN(e);case"string":return function(e){if(lN.test(e))throw tN(e,"String");return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return cN(e);case"boolean":return function(e){if("boolean"!=typeof e)throw tN(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return`@${sN(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return iN(e);if(e instanceof nN)return cN(e);default:throw tN(e,rN)}}function hN(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw tN(e,"Key");return e}function dN(e){return null==e?"":Object.entries(e).map(([e,t])=>!0===t?`;${hN(e)}`:`;${hN(e)}=${uN(t)}`).join("")}function fN(e){return e instanceof ZU?`${uN(e.value)}${dN(e.params)}`:uN(e)}function pN(e,t={whitespace:!0}){if("object"!=typeof e||null==e)throw tN(e,"Dict");const n=e instanceof Map?e.entries():Object.entries(e),r=(null==t?void 0:t.whitespace)?" ":"";return Array.from(n).map(([e,t])=>{t instanceof ZU==!1&&(t=new ZU(t));let n=hN(e);var r;return!0===t.value?n+=dN(t.params):(n+="=",Array.isArray(t.value)?n+=`(${(r=t).value.map(fN).join(" ")})${dN(r.params)}`:n+=fN(t)),n}).join(`,${r}`)}function mN(e,t){return pN(e,t)}const gN="CMCD-Object",AN="CMCD-Request",vN="CMCD-Session",yN="CMCD-Status",EN={br:gN,ab:gN,d:gN,ot:gN,tb:gN,tpb:gN,lb:gN,tab:gN,lab:gN,url:gN,pb:AN,bl:AN,tbl:AN,dl:AN,ltc:AN,mtp:AN,nor:AN,nrr:AN,rc:AN,sn:AN,sta:AN,su:AN,ttfb:AN,ttfbb:AN,ttlb:AN,cmsdd:AN,cmsds:AN,smrt:AN,df:AN,cs:AN,ts:AN,cid:vN,pr:vN,sf:vN,sid:vN,st:vN,v:vN,msd:vN,bs:yN,bsd:yN,cdn:yN,rtp:yN,bg:yN,pt:yN,ec:yN,e:yN},_N=AN;function xN(e,t){const n={};if(!e)return n;const r=Object.keys(e),i=t?(s=t,Object.keys(s).reduce((e,t)=>{var n;return null===(n=s[t])||void 0===n||n.forEach(n=>e[n]=t),e},{})):{};var s;return r.reduce((t,n)=>{var r;const s=EN[n]||i[n]||_N;return(null!==(r=t[s])&&void 0!==r?r:t[s]={})[n]=e[n],t},n)}const bN="event";const SN=e=>Math.round(e),wN=(e,t)=>Array.isArray(e)?e.map(e=>wN(e,t)):e instanceof ZU&&"string"==typeof e.value?new ZU(wN(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){const n=new URL(e),r=new URL(t);if(n.origin!==r.origin)return e;const i=n.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")+n.search+n.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),CN=e=>100*SN(e/100),TN={br:SN,d:SN,bl:CN,dl:CN,mtp:CN,nor:(e,t)=>{let n=e;return t.version>=2&&(e instanceof ZU&&"string"==typeof e.value?n=new ZU([e]):"string"==typeof e&&(n=[e])),wN(n,t)},rtp:CN,tb:SN},MN="request",IN="response",RN=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],BN=["e"],PN=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function DN(e){return PN.test(e)}const LN=["d","dl","nor","ot","rtp","su"];const kN=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const FN=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function ON(e){return FN.includes(e)||DN(e)}const UN={[IN]:function(e){return RN.includes(e)||LN.includes(e)||kN.includes(e)||DN(e)},[bN]:function(e){return RN.includes(e)||BN.includes(e)||DN(e)},[MN]:function(e){return RN.includes(e)||LN.includes(e)||DN(e)}};function NN(e,t={}){const n={};if(null==e||"object"!=typeof e)return n;const r=t.version||e.v||1,i=t.reportingMode||MN,s=1===r?ON:UN[i];let a=Object.keys(e).filter(s);const o=t.filter;"function"==typeof o&&(a=a.filter(o));const l=i===IN||i===bN;l&&!a.includes("ts")&&a.push("ts"),r>1&&!a.includes("v")&&a.push("v");const c=oD({},TN,t.formatters),u={version:r,reportingMode:i,baseUrl:t.baseUrl};return a.sort().forEach(t=>{let i=e[t];const s=c[t];if("function"==typeof s&&(i=s(i,u)),"v"===t){if(1===r)return;i=r}"pr"==t&&1===i||(l&&"ts"===t&&!YP(i)&&(i=Date.now()),function(e){return"number"==typeof e?YP(e):null!=e&&""!==e&&!1!==e}(i)&&(function(e){return["ot","sf","st","e","sta"].includes(e)}(t)&&"string"==typeof i&&(i=new nN(i)),n[t]=i))}),n}function zN(e,t,n){return oD(e,function(e,t={}){const n={};if(!e)return n;const r=xN(NN(e,t),null==t?void 0:t.customHeaderMap);return Object.entries(r).reduce((e,[t,n])=>{const r=mN(n,{whitespace:!1});return r&&(e[t]=r),e},n)}(t,n))}function GN(e,t={}){if(!e)return"";const n=function(e,t={}){return e?mN(NN(e,t),{whitespace:!1}):""}(e,t);return encodeURIComponent(n)}const QN=/CMCD=[^&#]+/;function HN(e,t,n){const r=function(e,t={}){return e?`CMCD=${GN(e,t)}`:""}(t,n);if(!r)return e;if(QN.test(e))return e.replace(QN,r);const i=e.includes("?")?"&":"?";return`${e}${i}${r}`}class VN{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:$U.MANIFEST,su:!this.initialized})}catch(e){this.hls.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{const{frag:t,part:n}=e,r=this.hls.levels[t.level],i=this.getObjectType(t),s={d:1e3*(n||t).duration,ot:i};i!==$U.VIDEO&&i!==$U.AUDIO&&i!=$U.MUXED||(s.br=r.bitrate/1e3,s.tb=this.getTopBandwidth(i)/1e3,s.bl=this.getBufferLength(i));const a=n?this.getNextPart(n):this.getNextFrag(t);null!=a&&a.url&&a.url!==t.url&&(s.nor=a.url),this.apply(e,s)}catch(e){this.hls.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;null!=n&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(JP.MEDIA_DETACHED,this.onMediaDetached,this),e.on(JP.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(JP.MEDIA_DETACHED,this.onMediaDetached,this),e.off(JP.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:JU.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){oD(t,this.createData());const n=t.ot===$U.INIT||t.ot===$U.VIDEO||t.ot===$U.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((e,n)=>(r.includes(n)&&(e[n]=t[n]),e),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),zN(e.headers,t,i)):e.url=HN(e.url,t,i)}getNextFrag(e){var t;const n=null==(t=this.hls.levels[e.level])?void 0:t.details;if(n){const t=e.sn-n.startSN;return n.fragments[t+1]}}getNextPart(e){var t;const{index:n,fragment:r}=e,i=null==(t=this.hls.levels[r.level])||null==(t=t.details)?void 0:t.partList;if(i){const{sn:e}=r;for(let t=i.length-1;t>=0;t--){const r=i[t];if(r.index===n&&r.fragment.sn===e)return i[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?$U.TIMED_TEXT:"initSegment"===e.sn?$U.INIT:"audio"===t?$U.AUDIO:"main"===t?this.hls.audioTracks.length?$U.VIDEO:$U.MUXED:void 0}getTopBandwidth(e){let t,n=0;const r=this.hls;if(e===$U.AUDIO)t=r.audioTracks;else{const e=r.maxAutoLevel,n=e>-1?e+1:r.levels.length;t=r.levels.slice(0,n)}return t.forEach(e=>{e.bitrate>n&&(n=e.bitrate)}),n>0?n:NaN}getBufferLength(e){const t=this.media,n=e===$U.AUDIO?this.audioBuffer:this.videoBuffer;if(!n||!t)return NaN;return 1e3*Lk.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,r){t(e),this.loader.load(e,n,r)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,r){t(e),this.loader.load(e,n,r)}}}}class jN extends uD{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.on(JP.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.off(JP.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((null==n?void 0:n.action)===lk.SendAlternateToPenaltyBox&&n.flags===ck.MoveAllAlternatesMatchingHost){const e=this.levels;let r=this._pathwayPriority,i=this.pathwayId;if(t.context){const{groupId:n,pathwayId:r,type:s}=t.context;n&&e?i=this.getPathwayForGroupId(n,s,i):r&&(i=r)}i in this.penalizedPathways||(this.penalizedPathways[i]=performance.now()),!r&&e&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==i),t.details!==$P.BUFFER_APPEND_ERROR||t.fatal?n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${i} levels: ${e?e.length:e} priorities: ${GL(r)} penalized: ${GL(this.penalizedPathways)}`):n.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(e=>{r-n[e]>3e5&&delete n[e]});for(let r=0;r<e.length;r++){const i=e[r];if(i in n)continue;if(i===this.pathwayId)return;const s=this.hls.nextLoadLevel,a=this.hls.levels[s];if(t=this.getLevelsForPathway(i),t.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,OF(t),this.hls.trigger(JP.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[s];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=s);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let n=0;n<r.length;n++)if(t===tD&&r[n].hasAudioGroup(e)||t===nD&&r[n].hasSubtitleGroup(e))return r[n].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(e=>{const{ID:i,"BASE-ID":s,"URI-REPLACEMENT":a}=e;if(t.some(e=>e.pathwayId===i))return;const o=this.getLevelsForPathway(s).map(e=>{const t=new Qk(e.attrs);t["PATHWAY-ID"]=i;const s=t.AUDIO&&`${t.AUDIO}_clone_${i}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${i}`;s&&(n[t.AUDIO]=s,t.AUDIO=s),o&&(r[t.SUBTITLES]=o,t.SUBTITLES=o);const l=YN(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),c=new UL({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let t=1;t<e.audioGroups.length;t++)c.addGroupId("audio",`${e.audioGroups[t]}_clone_${i}`);if(e.subtitleGroups)for(let t=1;t<e.subtitleGroups.length;t++)c.addGroupId("text",`${e.subtitleGroups[t]}_clone_${i}`);return c});t.push(...o),WN(this.audioTracks,n,a,i),WN(this.subtitleTracks,r,a,i)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;let r;this.loader&&this.loader.destroy(),this.loader=new n(t);try{r=new self.URL(e)}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==r.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+e)}const i={responseType:"json",url:r.href},s=t.steeringManifestLoadPolicy.default,a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,n,i)=>{this.log(`Loaded steering manifest: "${r}"`);const s=e.data;if(1!==(null==s?void 0:s.VERSION))return void this.log(`Steering VERSION ${s.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=s;if(a)try{this.uri=new self.URL(a,r).href}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||n.url),o&&this.clonePathways(o);const c={steeringManifest:s,url:r.toString()};this.hls.trigger(JP.STEERING_MANIFEST_LOADED,c),l&&this.updatePathwayPriority(l)},onError:(e,t,n,r)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let i=1e3*this.timeToLoad;if(429===e.code){const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(i=1e3*parseFloat(t))}return void this.log(`Steering manifest ${t.url} rate limited`)}this.scheduleRefresh(this.uri||t.url,i)},onTimeout:(e,t,n)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(i,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const n=null==(t=this.hls)?void 0:t.media;!n||n.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}}function WN(e,t,n,r){e&&Object.keys(t).forEach(i=>{const s=e.filter(e=>e.groupId===i).map(e=>{const s=oD({},e);return s.details=void 0,s.attrs=new Qk(s.attrs),s.url=s.attrs.URI=YN(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),s.groupId=s.attrs["GROUP-ID"]=t[i],s.attrs["PATHWAY-ID"]=r,s});e.push(...s)})}function YN(e,t,n,r){const{HOST:i,PARAMS:s,[n]:a}=r;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return i&&!o&&(l.host=i),s&&Object.keys(s).sort().forEach(e=>{e&&l.searchParams.set(e,s[e])}),l.href}class KN extends uD{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=KN.CDMCleanupPromise?[KN.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:t,initData:n}=e,r=`"${e.type}" event: init data type: "${t}"`;if(this.debug(r),null!==n){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=sF(this.config));const t=e.map(iF).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(i=>{const s=rF(i);if("sinf"!==t||s!==tF.FAIRPLAY)return void this.log(`Ignoring "${e.type}" event with init data type: "${t}" for selected key-system ${s}`);let a;try{const e=HD(new Uint8Array(n)),t=nL($k(JSON.parse(e).sinf));if(!t)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(t.subarray(8,24))}catch(e){return void this.warn(`${r} Failed to parse sinf: ${e}`)}const o=ED(a),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let u=l[o];for(let e=0;e<c.length;e++){const r=c[e],i=r.decryptdata;if(!i.keyId)continue;const s=ED(i.keyId);if(o===s||-1!==i.uri.replace(/-/g,"").indexOf(o)){if(u=l[s],!u)continue;if(i.pssh)break;delete l[s],i.pssh=new Uint8Array(n),i.keyId=a,u=l[o]=u.then(()=>this.generateRequestWithPreferredKeySession(r,t,n,"encrypted-event-key-match")),u.catch(e=>this.handleError(e));break}}u||this.handleError(new Error(`Key ID ${o} not encountered in playlist. Key-system sessions ${c.length}.`))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(JP.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(JP.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(JP.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(JP.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(JP.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(JP.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(JP.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(JP.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=null==t?void 0:t[e];return r?r.licenseUrl:e===tF.WIDEVINE&&n?n:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=null==t?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(e,t,n)=>!!e&&n.indexOf(e)===t,r=t.map(e=>e.audioCodec).filter(n),i=t.map(e=>e.videoCodec).filter(n);return r.length+i.length===0&&i.push("avc1.42e01e"),new Promise((t,n)=>{const s=e=>{const a=e.shift();this.getMediaKeysPromise(a,r,i).then(e=>t({keySystem:a,mediaKeys:e})).catch(t=>{e.length?s(e):n(t instanceof qN?t:new qN({type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};s(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!=typeof n){let e=`Configured requestMediaKeySystemAccess is not a function ${n}`;return null===aF&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return n(e,t)}getMediaKeysPromise(e,t,n){var r;const i=function(e,t,n,r){let i;switch(e){case tF.FAIRPLAY:i=["cenc","sinf"];break;case tF.WIDEVINE:case tF.PLAYREADY:i=["cenc"];break;case tF.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,n,r){return[{initDataTypes:e,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:`audio/mp4; codecs=${e}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:n.map(e=>({contentType:`video/mp4; codecs=${e}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}(i,t,n,r)}(e,t,n,this.config.drmSystemOptions||{});let s=this.keySystemAccessPromises[e],a=null==(r=s)?void 0:r.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${GL(i)}`),a=this.requestMediaKeySystemAccess(e,i);const t=s=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)}),a.then(n=>{this.log(`Access for key-system "${n.keySystem}" obtained`);const r=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const i=t.mediaKeys=n.createMediaKeys().then(n=>(this.log(`Media-keys created for "${e}"`),t.hasMediaKeys=!0,r.then(t=>t?this.setMediaKeysServerCertificate(n,e,t):n)));return i.catch(t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)}),i})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${ED(e.keyId||[])}`);const r=n.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),i="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return ED(e.keyId)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${ED(e.decryptdata.keyId||[])}\n      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>iF(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:e,mediaKeys:t})=>this.attemptSetMediaKeys(e,t))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:e})=>{const r=iF(e);r?t(r):n(new Error(`Unable to find format for key-system "${e}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=sF(this.config),n=e.map(rF).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(n)}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),r=this.bannedKeyIds[n];if(r){const n=XN(r,t);return this.handleError(n,e.frag),Promise.reject(n)}const i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const s=this.keyIdToKeySessionPromise[n];if(!s){const r=this.getKeySystemForKeyPromise(t).then(({keySystem:n,mediaKeys:r})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(n,r).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:n,mediaKeys:r,decryptdata:t}))))).then(e=>{const n=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",n,"playlist-key")});return r.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[n]=r,r}return s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){this.hls&&(this.error(e.message),e instanceof qN?(t&&(e.data.frag=t),this.hls.trigger(JP.ERROR,e.data)):this.hls.trigger(JP.ERROR,{type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const t=rF(e.keyFormat),n=t?[t]:sF(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=sF(this.config)),0===e.length)throw new qN({type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${GL({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(n).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===n.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,n,r){var i;const s=null==(i=this.config.drmSystems)||null==(i=i[e.keySystem])?void 0:i.generateRequest;if(s)try{const r=s.call(this.hls,t,n,e);if(!r)throw new Error("Invalid response from configured generateRequest filter");t=r.initDataType,n=r.initData?r.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(e){if(this.warn(e.message),this.hls&&this.hls.config.debug)throw e}if(null===n)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const a=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${a} (init data type: ${t} length: ${n.byteLength})`);const o=new dO,l=e._onmessage=t=>{const n=e.mediaKeysSession;if(!n)return void o.emit("error",new Error("invalid state"));const{messageType:r,message:i}=t;this.log(`"${r}" message event for session "${n.sessionId}" message size: ${i.byteLength}`),"license-request"===r||"license-renewal"===r?this.renewLicense(e,i).catch(e=>{o.eventNames().length?o.emit("error",e):this.handleError(e)}):"license-release"===r?e.keySystem===tF.FAIRPLAY&&(this.updateKeySession(e,Jk("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${r}"`)},c=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void o.emit("error",new Error("invalid state"));const n=e.keyStatus;this.onKeyStatusChange(e);const r=e.keyStatus;r!==n&&(o.emit("keyStatus",r,e),"expired"===r&&(this.log(`${e.keySystem} expired for key ${a}`),this.renewKeySession(e)))};jF(e.mediaKeysSession,"message",l),jF(e.mediaKeysSession,"keystatuseschange",c);const u=new Promise((e,t)=>{o.on("error",t),o.on("keyStatus",(n,{decryptdata:r})=>{n.startsWith("usable")?e():"internal-error"===n||"output-restricted"===n?t(XN(n,r)):"expired"===n?t(new Error(`key expired while generating request (keyId: ${a})`)):this.warn(`unhandled key status change "${n}" (keyId: ${a})`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a}`)}).catch(t=>{throw new qN({type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${t}`)}).then(()=>u).catch(t=>{throw o.removeAllListeners(),this.removeSession(e),t}).then(()=>(o.removeAllListeners(),e))}onKeyStatusChange(e){const t=ED(new Uint8Array(e.decryptdata.keyId||[]));e.mediaKeysSession.keyStatuses.forEach((n,r)=>{if("string"==typeof r&&"object"==typeof n){const e=r;r=n,n=e}const i=ED("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r));"internal-error"===n&&(this.bannedKeyIds[i]=n);const s=i===t;this.log(`${s?"":"un"}matched key status change "${n}" for keyStatuses keyId: ${i} session keyId: ${t} uri: ${e.decryptdata.uri}`),s&&(e.keyStatus=n)})}fetchServerCertificate(e){const t=this.config,n=new(0,t.loader)(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((i,s)=>{const a={responseType:"arraybuffer",url:r},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{i(e.data)},onError:(t,n,i,o)=>{s(new qN({type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:cD({url:a.url,data:void 0},t)},`"${e}" certificate request failed (${r}). Status: ${t.code} (${t.text})`))},onTimeout:(t,n,i)=>{s(new qN({type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:a.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(e,t,n)=>{s(new Error("aborted"))}};n.load(a,l,c)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,i)=>{e.setServerCertificate(n).then(i=>{this.log(`setServerCertificate ${i?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),r(e)}).catch(e=>{i(new qN({type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new qN({type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=(new DOMParser).parseFromString(n,"application/xml"),i=r.querySelectorAll("HttpHeader");if(i.length>0){let t;for(let n=0,r=i.length;n<r;n++){var s,a;t=i[n];const r=null==(s=t.querySelector("name"))?void 0:s.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;r&&o&&e.setRequestHeader(r,o)}}const o=r.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return Jk(atob(l))}setupLicenseXHR(e,t,n,r){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,n,r)}).catch(s=>{if(!n.decryptdata)throw s;return e.open("POST",t,!0),i.call(this.hls,e,t,n,r)}).then(n=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:n||r}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,i)=>{const s=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${s}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const n=this.config.licenseResponseCallback;if(n)try{t=n.call(this.hls,a,s,e)}catch(e){this.error(e)}r(t)}else{const o=n.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)i(new qN({type:XP.KEY_SYSTEM_ERROR,details:$P.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:s,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${s}). Status: ${a.status} (${a.statusText})`));else{const n=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${n} attempts left`),this.requestLicense(e,t).then(r,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,s,e,t).then(({xhr:t,licenseChallenge:n})=>{e.keySystem==tF.PLAYREADY&&(n=this.unpackPlayReadyKeyMessage(t,n)),t.send(n)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,jF(n,"encrypted",this.onMediaEncrypted),jF(n,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(WF(e,"encrypted",this.onMediaEncrypted),WF(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,cF.clearKeyUriToKeyIdMap();const r=n.length;KN.CDMCleanupPromise=Promise.all(n.map(e=>this.removeSession(e)).concat(null==t||null==(e=t.setMediaKeys(null))?void 0:e.catch(e=>{this.log(`Could not clear media keys: ${e}`),this.hls&&this.hls.trigger(JP.ERROR,{type:XP.OTHER_ERROR,details:$P.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${e}`)})}))).catch(e=>{this.log(`Could not close sessions and clear media keys: ${e}`),this.hls&&this.hls.trigger(JP.ERROR,{type:XP.OTHER_ERROR,details:$P.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${e}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${ED((null==r?void 0:r.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{drmSystemOptions:s}=this.config,a=function(e){var t;return!(!e||"persistent-license"!==e.sessionType&&(null==(t=e.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(s)?new Promise((e,n)=>{self.setTimeout(()=>n(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(n)}):Promise.resolve();return a.catch(e=>{this.log(`Could not remove session: ${e}`),this.hls&&this.hls.trigger(JP.ERROR,{type:XP.OTHER_ERROR,details:$P.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${e}`)})}).then(()=>t.close()).catch(e=>{this.log(`Could not close session: ${e}`),this.hls&&this.hls.trigger(JP.ERROR,{type:XP.OTHER_ERROR,details:$P.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${e}`)})})}}}KN.CDMCleanupPromise=void 0;class qN extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function XN(e,t){const n="output-restricted"===e,r=n?$P.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:$P.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new qN({type:XP.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:t},n?"HDCP level output restricted":`key status changed to "${e}"`)}class $N{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const e=r-this.lastTime,i=n-this.lastDroppedFrames,s=t-this.lastDecodedFrames,a=1e3*i/e,o=this.hls;if(o.trigger(JP.FPS_DROP,{currentDropped:i,currentDecoded:s,totalDroppedFrames:n}),a>0&&i>o.config.fpsDroppedMonitoringThreshold*s){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(JP.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function JN(e,t){let n;try{n=new Event("addtrack")}catch(e){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function ZN(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(n){gD.debug(`[texttrack-utils]: ${n}`);try{const n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(e){gD.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===n&&(e.mode=n)}function ez(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues)for(let n=e.cues.length;n--;)t&&e.cues[n].removeEventListener("enter",t),e.removeCue(e.cues[n]);"disabled"===n&&(e.mode=n)}function tz(e,t,n,r){const i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0){const i=function(e,t,n){const r=[],i=function(e,t){if(t<=e[0].startTime)return 0;const n=e.length-1;if(t>e[n].endTime)return-1;let r,i=0,s=n;for(;i<=s;)if(r=Math.floor((s+i)/2),t<e[r].startTime)s=r-1;else{if(!(t>e[r].startTime&&i<n))return r;i=r+1}return e[i].startTime-t<t-e[s].startTime?i:s}(e,t);if(i>-1)for(let s=i,a=e.length;s<a;s++){const i=e[s];if(i.startTime>=t&&i.endTime<=n)r.push(i);else if(i.startTime>n)return r}return r}(e.cues,t,n);for(let t=0;t<i.length;t++)r&&!r(i[t])||e.removeCue(i[t])}"disabled"===i&&(e.mode=i)}function nz(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];"subtitles"!==r.kind&&"captions"!==r.kind||!r.label||t.push(e[n])}return t}class rz extends UU{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=nz(this.media.textTracks);for(let n=0;n<t.length;n++)if("hidden"===t[n].mode)e=t[n];else if("showing"===t[n].mode){e=t[n];break}const n=this.findTrackForTextTrack(e);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.on(JP.LEVEL_LOADING,this.onLevelLoading,this),e.on(JP.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(JP.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(JP.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.off(JP.LEVEL_LOADING,this.onLevelLoading,this),e.off(JP.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(JP.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(JP.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;nz(n.textTracks).forEach(e=>{ez(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:i}=t,s=this.tracksInGroup[n];if(!s||s.groupId!==r)return void this.warn(`Subtitle track with id:${n} and group:${r} not found in active group ${null==s?void 0:s.groupId}`);const a=s.details;s.details=t.details,this.log(`Subtitle track ${n} "${s.name}" lang:${s.lang} group:${r} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let i=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==r?void 0:r.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!i&&t){this.selectDefaultTrack=!1;const n=jL(t,e);if(n>-1)i=e[n];else{const e=jL(t,this.tracks);i=this.tracks[e]}}let r=this.findTrackId(i);-1===r&&i&&(r=this.findTrackId(null));const s={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==n?void 0:n.join(",")}" group-id`),this.hls.trigger(JP.SUBTITLE_TRACKS_UPDATED,s),-1!==r&&-1===this.trackId&&this.setSubtitleTrack(r)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const i=t[r];if((!n||i.default)&&(n||e)&&(!e||WL(i,e)))return r}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(zU(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(zU(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){if(GU(t[n],e))return n}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==nD||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&WL(e,n))return n;const r=jL(e,this.tracksInGroup);if(r>-1){const e=this.tracksInGroup[r];return this.setSubtitleTrack(r),e}if(n)return null;{const n=jL(e,t);if(n>-1)return t[n]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,i=this.getUrlWithDirectives(e.url,t),s=e.details,a=null==s?void 0:s.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${r}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${a&&s.live?" age "+a.toFixed(1)+(s.type&&" "+s.type||""):""} ${i}`),this.hls.trigger(JP.SUBTITLE_TRACK_LOADING,{url:i,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=nz(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(e=>GU(n,e))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==r&&(e.mode="disabled")}),r){const e=this.subtitleDisplay?"showing":"hidden";r.mode!==e&&(r.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!YP(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r)return void this.hls.trigger(JP.SUBTITLE_TRACK_SWITCH,{id:e});const i=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&i)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:s,groupId:a="",name:o,type:l,url:c}=r;this.hls.trigger(JP.SUBTITLE_TRACK_SWITCH,{id:s,groupId:a,name:o,type:l,url:c});const u=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(u)}}function iz(e){let t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}const sz=.025;let az=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function oz(e,t,n){return`${e.identifier}-${n+1}-${iz(t)}`}class lz{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;if(e<=0||isNaN(n))return!1;if(0===n)return!0;return((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return cz(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-cz(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=YP(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return cz(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<sz))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?az.Range:az.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return`["${(e=this).identifier}" ${e.cue.pre?"<pre>":e.cue.post?"<post>":""}${e.timelineStart.toFixed(2)}-${e.resumeTime.toFixed(2)}]`;var e}}function cz(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<sz)?t.start:t.start+t.duration}function uz(e,t,n){const r=new self.URL(e,n);return"data:"!==r.protocol&&r.searchParams.set("_HLS_primary_id",t),r}function hz(e,t){for(;null!=(n=e.assetList[++t])&&n.error;)var n;return t}function dz(e){const t=e.timelineStart,n=e.duration||0;return`["${e.identifier}" ${t.toFixed(2)}-${(t+n).toFixed(2)}]`}class fz{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(JP.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=n,this.assetItem=r;const s=()=>{this.hasDetails=!0};i.once(JP.LEVEL_LOADED,s),i.once(JP.AUDIO_TRACK_LOADED,s),i.once(JP.SUBTITLE_TRACK_LOADED,s),i.on(JP.MEDIA_ATTACHING,(e,{media:t})=>{this.removeMediaListeners(),this.mediaAttached=t;this.interstitial.playoutLimit&&(t.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(JP.BUFFER_APPENDED,()=>{const e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,i.trigger(JP.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=uz(t,e.config.primarySessionId||"").href}catch(e){}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,i=Lk.bufferInfo(e,r,0);return this.getAssetTime(i.end)>=n-.02}reachedPlayout(e){const t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Lk.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var r;null==(r=this.hls)||r.on(e,t)}once(e,t,n){var r;null==(r=this.hls)||r.once(e,t)}off(e,t,n){var r;null==(r=this.hls)||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${dz(this.assetItem)} ${null==(e=this.hls)?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}class pz extends uD{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(void 0===t&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&null!=(i=r[n])&&i.event;){var i;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let i=n[r];if(t&&"primary"!==t&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const e=n[r].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if((null==(n=t[r].event)?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let e=0;e<r;e++){const i=n[e];if(!i.error){const n=i.timelineStart;if(t===n||t>n&&(t<n+(i.duration||0)||e===r-1))return e}}return 0}get assetIdAtEnd(){var e;const t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){const e=t.assetList,n=e[e.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,i=this.events,s=this.parseDateRanges(r,{url:n.url},t),a=Object.keys(r),o=i?i.filter(e=>!a.includes(e.identifier)):[];s.length&&s.sort((e,t)=>{const n=e.cue.pre,r=e.cue.post,i=t.cue.pre,s=t.cue.post;if(n&&!i)return-1;if(i&&!n)return 1;if(r&&!s)return 1;if(s&&!r)return-1;if(!(n||i||r||s)){const n=e.startTime,r=t.startTime;if(n!==r)return n-r}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=s,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e,t=[],n=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const i=this.items,s=this.parseSchedule(r,e),a=n||t.length||(null==i?void 0:i.length)!==s.length||s.some((e,t)=>Math.abs(e.playout.start-i[t].playout.start)>.005||Math.abs(e.playout.end-i[t].playout.end)>.005);a&&(this.items=s,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,n){const r=[],i=Object.keys(e);for(let s=0;s<i.length;s++){const a=i[s],o=e[a];if(o.isInterstitial){let e=this.eventMap[a];e?e.setDateRange(o):(e=new lz(o,t),this.eventMap[a]=e,!1===n&&(e.appendInPlace=n)),r.push(e)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,i=r.live?1/0:r.edge;let s=0;if((e=e.filter(e=>!(e.error||e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let r=0,o=0;if(e.forEach((t,a)=>{const l=t.cue.pre,c=t.cue.post,u=e[a-1]||null,h=t.appendInPlace,d=c?i:t.startOffset,f=t.duration,p=t.timelineOccupancy===az.Range?f:0,m=t.resumptionOffset,g=(null==u?void 0:u.startTime)===d,A=d+t.cumulativeDuration;let v=h?A+f:d+m;if(l||!c&&d<=0){const e=o;o+=p,t.timelineStart=A;const r=s;s+=f,n.push({event:t,start:A,end:v,playout:{start:r,end:s},integrated:{start:e,end:o}})}else{if(!(d<=i))return;{if(!g){const i=d-r;if(i>.033){const l=r,c=o;o+=i;const u=s;s+=i;const h={previousEvent:e[a-1]||null,nextEvent:t,start:l,end:l+i,playout:{start:u,end:s},integrated:{start:c,end:o}};n.push(h)}else i>0&&u&&(u.cumulativeDuration+=i,n[n.length-1].end=d)}c&&(v=A),t.timelineStart=A;const i=o;o+=p;const l=s;s+=f,n.push({event:t,start:A,end:v,playout:{start:l,end:s},integrated:{start:i,end:o}})}}const y=t.resumeTime;r=c||y>i?i:y}),r<i){var a;const e=r,t=o,l=i-r;o+=l;const c=s;s+=l,n.push({previousEvent:(null==(a=n[n.length-1])?void 0:a.event)||null,nextEvent:null,start:r,end:e+l,playout:{start:c,end:s},integrated:{start:t,end:o}})}this.setDurations(i,s,o)}else{const e=0;n.push({previousEvent:null,nextEvent:null,start:e,end:i,playout:{start:e,end:i},integrated:{start:e,end:i}}),this.setDurations(i,i,i)}return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let i=0,s=-1;e.forEach((a,o)=>{const l=a.cue.pre,c=a.cue.post,u=l?0:c?r:a.startTime;this.updateAssetDurations(a);if(s===u?a.cumulativeDuration=i:(i=0,s=u),!c&&a.snapOptions.in&&(a.resumeAnchor=JL(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)}if(!a.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`))}const h=YP(a.resumeOffset)?a.resumeOffset:a.duration;i+=h})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;if(Math.abs(n-r)>sz)return this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${r}`),!1;return!Object.keys(t).some(r=>{const i=t[r].details,s=i.edge;if(n>=s)return this.log(`"${e.identifier}" resumption ${n} past ${r} playlist end ${s}`),!1;const a=JL(null,i.fragments,n);if(!a)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${r} playlist (${i.fragStart}-${i.fragmentEnd})`),!0;const o="audio"===r?.175:0;return!(Math.abs(a.start-n)<sz+o||Math.abs(a.end-n)<sz+o)&&(this.log(`"${e.identifier}" resumption ${n} not aligned with ${r} fragment bounds (${a.start}-${a.end} sn: ${a.sn} cc: ${a.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,i=!1;for(let s=0;s<e.assetList.length;s++){const a=e.assetList[s],o=t+n;a.startOffset=n,a.timelineStart=o,r||(r=null===a.duration),i||(i=!!a.error);n+=a.error?0:a.duration||0}e.duration=r&&!i?Math.max(n,e.duration):n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function mz(e){return`[${e.event?'"'+e.event.identifier+'"':"primary"}: ${e.start.toFixed(2)}-${e.end.toFixed(2)}]`}class gz{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=uz(n,this.hls.sessionId,e.baseUrl)}catch(t){const r=this.assignAssetListError(e,$P.ASSET_LIST_LOAD_ERROR,t,n);return void this.hls.trigger(JP.ERROR,r)}t&&"data:"!==r.protocol&&r.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,s=new(0,i.loader)(i),a={responseType:"json",url:r.href},o=i.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,n,r,i)=>{const s=t.data,a=null==s?void 0:s.ASSETS;if(!Array.isArray(a)){const t=this.assignAssetListError(e,$P.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),r.url,n,i);return void this.hls.trigger(JP.ERROR,t)}e.assetListResponse=s,this.hls.trigger(JP.ASSET_LIST_LOADED,{event:e,assetListResponse:s,networkDetails:i})},onError:(t,n,r,i)=>{const s=this.assignAssetListError(e,$P.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${t.code} ${t.text} (${n.url})`),n.url,i,r);this.hls.trigger(JP.ERROR,s)},onTimeout:(t,n,r)=>{const i=this.assignAssetListError(e,$P.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${n.url})`),n.url,t,r);this.hls.trigger(JP.ERROR,i)}};return s.load(a,l,c),this.hls.trigger(JP.ASSET_LIST_LOADING,{event:e}),s}assignAssetListError(e,t,n,r,i,s){return e.error=n,{type:XP.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:s,stats:i}}}function Az(e){null==e||e.play().catch(()=>{})}function vz(e,t){return`[${e}] Advancing timeline position to ${t}`}class yz extends aO{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",rD.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.on(JP.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(JP.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(JP.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(JP.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(JP.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.off(JP.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(JP.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(JP.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(JP.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(JP.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=qF,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(this.fragContextChanged(n)||(FD(n)&&(this.fragPrevious=n),this.state=qF),!r)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let s;const a=n.start;for(let e=0;e<i.length;e++)if(a>=i[e].start&&a<=i[e].end){s=i[e];break}const o=n.start+n.duration;s?s.end=o:(s={start:a,end:o},i.push(s)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(0===n&&r!==Number.POSITIVE_INFINITY){const e=r-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let n=0;n<t.length;)if(t[n].end<=e)t.shift();else{if(!(t[n].start<e))break;t[n].start=e,n++}}),this.fragmentTracker.removeFragmentsInRange(n,e,rD.SUBTITLE)}}onError(e,t){const n=t.frag;(null==n?void 0:n.type)===rD.SUBTITLE&&(t.details===$P.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==KF&&(this.state=qF))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&NU(this.levels,t)?this.levels=t.map(e=>new UL(e)):(this.tracksBuffered=[],this.levels=t.map(e=>{const t=new UL(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,rD.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==KF&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:i}=this,{details:s,id:a}=t;if(!i)return void this.warn(`Subtitle tracks were reset while loading level ${a}`);const o=i[a];if(a>=i.length||!o)return;this.log(`Subtitle track ${a} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(s.live||null!=(n=o.details)&&n.live){if(s.deltaUpdateFailed)return;const e=this.mainDetails;if(!e)return void(this.startFragRequested=!1);const t=e.fragments[0];var c;if(o.details)l=this.alignPlaylists(s,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&t&&(l=t.start,PF(s,l));else s.hasProgramDateTime&&e.hasProgramDateTime?(VF(s,e),l=s.fragmentStart):t&&(l=t.start,PF(s,l));e&&!this.startFragRequested&&this.setStartPosition(e,l)}if(o.details=s,this.levelLastLoaded=o,a===r&&(this.hls.trigger(JP.SUBTITLE_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===qF)){JL(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&null!=r&&r.key&&r.iv&&qk(r.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,Xk(r.method)).catch(e=>{throw i.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(n=>{const r=performance.now();i.trigger(JP.FRAG_DECRYPTED,{frag:t,payload:n,stats:{tstart:e,tdecrypt:r}})}).catch(e=>{this.warn(`${e.name}: ${e.message}`),this.state=qF})}}doTick(){if(this.media){if(this.state===qF){const{currentTrackId:e,levels:t}=this,n=null==t?void 0:t[e];if(!n||!t.length||!n.details)return;if(this.waitForLive(n))return;const{config:r}=this,i=this.getLoadPosition(),s=Lk.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,r.maxBufferHole),{end:a,len:o}=s,l=n.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,u=c.length,h=l.edge;let d=null;const f=this.fragPrevious;if(a<h){const e=r.maxFragLookUpTolerance,t=a>h-e?0:e;d=JL(f,c,Math.max(c[0].start,a),t),!d&&f&&f.start<c[0].start&&(d=c[0])}else d=c[u-1];if(d=this.filterReplacedPrimary(d,n.details),!d)return;const p=c[d.sn-l.startSN-1];if(p&&p.cc===d.cc&&this.fragmentTracker.getState(p)===dk&&(d=p),this.fragmentTracker.getState(d)===dk){const e=this.mapToInitFragWhenRequired(d);e&&this.loadFragment(e,n,a)}}}else this.state=qF}loadFragment(e,t,n){FD(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Ez(this.tracksBuffered[this.currentTrackId]||[])}}class Ez{constructor(e){this.buffered=void 0;const t=(t,n,r)=>{if((n>>>=0)>r-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${r})`);return e[n][t]};this.buffered={get length(){return e.length},end:n=>t("end",n,e.length),start:n=>t("start",n,e.length)}}}const _z={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},xz=e=>String.fromCharCode(_z[e]||e),bz=15,Sz=100,wz={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Cz={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Tz={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Mz={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Iz=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Rz{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n="function"==typeof t?t():t;gD.log(`${this.time} [${e}] ${n}`)}}}const Bz=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class Pz{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Dz{constructor(){this.uchar=" ",this.penState=new Pz}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Lz{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Pz,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<Sz;e++)this.chars.push(new Dz);this.logger=e}equals(e){for(let t=0;t<Sz;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Sz;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Sz;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Sz&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Sz)}moveCursor(e){const t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=xz(e);this.pos>=Sz?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Sz;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Sz;n++){const r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class kz{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<bz;t++)this.rows.push(new Lz(e));this.logger=e}reset(){for(let e=0;e<bz;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let n=0;n<bz;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<bz;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<bz;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+GL(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<bz;e++)this.rows[e].clear();const e=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const r=n.rows[e].cueStartTime,i=this.logger.time;if(null!==r&&null!==i&&r<i)for(let r=0;r<this.nrRollUpRows;r++)this.rows[t-this.nrRollUpRows+r+1].copy(n.rows[e+r])}}this.currRow=t;const n=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,r=Math.max(t-1,0);n.setCursor(e.indent),e.color=n.chars[r].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+GL(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let n=0;n<bz;n++){const i=this.rows[n].getTextString();i&&(r=n+1,e?t.push("Row "+r+": '"+i+"'"):t.push(i.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}getTextAndFormat(){return this.rows}}class Fz{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new kz(n),this.nonDisplayedMemory=new kz(n),this.lastOutputScreen=new kz(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+GL(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Oz{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const r=this.logger=new Rz;this.channels=[null,new Fz(e,t,r),new Fz(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let e=0;e<t.length;e+=2){const n=127&t[e],r=127&t[e+1];let i=!1,s=null;if(0===n&&0===r)continue;this.logger.log(3,()=>"["+Bz([t[e],t[e+1]])+"] -> ("+Bz([n,r])+")");const a=this.cmdHistory;if(n>=16&&n<=31){if(Nz(n,r,a)){Uz(null,null,a),this.logger.log(3,()=>"Repeated command ("+Bz([n,r])+") is dropped");continue}Uz(n,r,this.cmdHistory),i=this.parseCmd(n,r),i||(i=this.parseMidrow(n,r)),i||(i=this.parsePAC(n,r)),i||(i=this.parseBackgroundAttributes(n,r))}else Uz(null,null,a);if(!i&&(s=this.parseChars(n,r),s)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(s)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||s||this.logger.log(2,()=>"Couldn't parse cleaned data "+Bz([n,r])+" orig: "+Bz([t[e],t[e+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const n=20===e||21===e||23===e?1:2,r=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let n=0;if((17===e||25===e)&&t>=32&&t<=47){if(n=17===e?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return!!r&&(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Bz([e,t])+")"),!0)}return!1}parsePAC(e,t){let n;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const r=e<=23?1:2;n=t>=64&&t<=95?1===r?wz[e]:Tz[e]:1===r?Cz[e]:Mz[e];const i=this.channels[r];return!!i&&(i.setPAC(this.interpretPAC(n,t)),this.currentChannel=r,!0)}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=!(1&~n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}parseChars(e,t){let n,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){let e;e=17===i?t+80:18===i?t+112:t+144,this.logger.log(2,()=>"Special char '"+xz(e)+"' in channel "+n),r=[e]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+Bz(r).join(",")),r}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let n;const r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=Iz[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));const i=e<=23?1:2;return this.channels[i].setBkgData(r),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Uz(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Uz(e,t,n){n.a=e,n.b=t}function Nz(e,t,n){return n.a===e&&n.b===t}var zz=function(){if(null!=eF&&eF.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const n=t.toLowerCase();return!!~e.indexOf(n)&&n}function r(e){return n(t,e)}function i(e,...t){let n=1;for(;n<arguments.length;n++){const t=arguments[n];for(const n in t)e[n]=t[n]}return e}function s(t,s,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",u=!1,h=t,d=s,f=a,p=null,m="",g=!0,A="auto",v="start",y=50,E="middle",_=50,x="middle";Object.defineProperty(o,"id",i({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},l,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(o,"startTime",i({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},l,{get:function(){return m},set:function(t){const r=function(t){return n(e,t)}(t);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");m=r,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},l,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},l,{get:function(){return A},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");A=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},l,{get:function(){return v},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},l,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},l,{get:function(){return E},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},l,{get:function(){return x},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");x=t,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}();class Gz{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Qz(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(r||0)}const n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}class Hz{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Vz(e,t,n,r){const i=r?e.split(r):[e];for(const e in i){if("string"!=typeof i[e])continue;const r=i[e].split(n);if(2!==r.length)continue;t(r[0],r[1])}}const jz=new zz(0,0,""),Wz="middle"===jz.align?"middle":"center";function Yz(e,t,n){const r=e;function i(){const t=Qz(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=i(),s(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.slice(3),s(),t.endTime=i(),s(),function(e,t){const r=new Hz;Vz(e,function(e,t){let i;switch(e){case"region":for(let i=n.length-1;i>=0;i--)if(n[i].id===t){r.set(e,n[i].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),r.integer(e,i[0]),r.percent(e,i[0])&&r.set("snapToLines",!1),r.alt(e,i[0],["auto"]),2===i.length&&r.alt("lineAlign",i[1],["start",Wz,"end"]);break;case"position":i=t.split(","),r.percent(e,i[0]),2===i.length&&r.alt("positionAlign",i[1],["start",Wz,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",Wz,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");let i=r.get("line","auto");"auto"===i&&-1===jz.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",Wz);let s=r.get("position","auto");"auto"===s&&50===jz.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(e,t)}function Kz(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class qz{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Gz,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function n(){let e=t.buffer,n=0;for(e=Kz(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;const r=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),r}function r(e){Vz(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=n();const r=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==r||!r[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let i=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(i?i=!1:e=n(),t.state){case"HEADER":/:/.test(e)?r(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new zz(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Yz(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==e.indexOf("--\x3e");if(!e||n&&(i=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Xz=/\r\n|\n\r|\n|\r/g,$z=function(e,t,n=0){return e.slice(n,n+t.length)===t};function Jz(e,t,n){return iz(e.toString())+iz(t.toString())+iz(n)}function Zz(e,t,n,r,i,s,a){const o=new qz,l=yD(new Uint8Array(e)).trim().replace(Xz,"\n").split("\n"),c=[],u=t?function(e,t=1){return AU(e,9e4,1/t)}(t.baseTime,t.timescale):0;let h,d="00:00.000",f=0,p=0,m=!0;o.oncue=function(e){const s=n[r];let a=n.ccOffset;const o=(f-u)/9e4;if(null!=s&&s.new&&(void 0!==p?a=n.ccOffset=s.start:function(e,t,n){let r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;null!=(s=i)&&s.new;){var s;e.ccOffset+=r.start-i.start,r.new=!1,r=i,i=e[r.prevCC]}e.presentationOffset=n}(n,r,o)),o){if(!t)return void(h=new Error("Missing initPTS for VTT MPEGTS"));a=o-n.presentationOffset}const l=e.endTime-e.startTime,d=SU(9e4*(e.startTime+a-p),9e4*i)/9e4;e.startTime=Math.max(d,0),e.endTime=Math.max(d+l,0);const m=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(m)),e.id||(e.id=Jz(e.startTime,e.endTime,m)),e.endTime>0&&c.push(e)},o.onparsingerror=function(e){h=e},o.onflush=function(){h?a(h):s(c)},l.forEach(e=>{if(m){if($z(e,"X-TIMESTAMP-MAP=")){m=!1,e.slice(16).split(",").forEach(e=>{$z(e,"LOCAL:")?d=e.slice(6):$z(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{p=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(YP(t)&&YP(n)&&YP(r)&&YP(i)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=6e4*r,t+=36e5*i,t}(d)/1e3}catch(e){h=e}return}""===e&&(m=!1)}o.parse(e+"\n")}),o.flush()}const eG="stpp.ttml.im1t",tG=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,nG=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,rG={left:"start",center:"center",right:"end",start:"start",end:"end"};function iG(e,t,n,r){const i=KD(new Uint8Array(e),["mdat"]);if(0===i.length)return void r(new Error("Could not parse IMSC1 mdat"));const s=i.map(e=>yD(e)),a=function(e,t,n=1,r=!1){return AU(e,t,1/n,r)}(t.baseTime,1,t.timescale);try{s.forEach(e=>n(function(e,t){const n=(new DOMParser).parseFromString(e,"text/xml"),r=n.getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},s=Object.keys(i).reduce((e,t)=>(e[t]=r.getAttribute(`ttp:${t}`)||i[t],e),{}),a="preserve"!==r.getAttribute("xml:space"),o=aG(sG(r,"styling","style")),l=aG(sG(r,"layout","region")),c=sG(r,"body","[begin]");return[].map.call(c,e=>{const n=oG(e,a);if(!n||!e.hasAttribute("begin"))return null;const r=uG(e.getAttribute("begin"),s),i=uG(e.getAttribute("dur"),s);let c=uG(e.getAttribute("end"),s);if(null===r)throw cG(e);if(null===c){if(null===i)throw cG(e);c=r+i}const u=new zz(r-t,c-t,n);u.id=Jz(u.startTime,u.endTime,u.text);const h=function(e,t,n){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&n.hasOwnProperty(a)&&(i=n[a]);return s.reduce((n,s)=>{const a=lG(t,r,s)||lG(e,r,s)||lG(i,r,s);return a&&(n[s]=a),n},{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:d}=h;if(d){const e=rG[d];e&&(u.lineAlign=e),u.align=d}return oD(u,h),u}).filter(e=>null!==e)}(e,a)))}catch(e){r(e)}}function sG(e,t,n){const r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function aG(e){return e.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function oG(e,t){return[].slice.call(e.childNodes).reduce((e,n,r)=>{var i;return"br"===n.nodeName&&r?e+"\n":null!=(i=n.childNodes)&&i.length?oG(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent},"")}function lG(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function cG(e){return new Error(`Could not parse ttml timestamp ${e}`)}function uG(e,t){if(!e)return null;let n=Qz(e);return null===n&&(tG.test(e)?n=function(e,t){const n=tG.exec(e),r=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/t.frameRate}(e,t):nG.test(e)&&(n=function(e,t){const n=nG.exec(e),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),n}class hG{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class dG{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(JP.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(JP.FRAG_LOADING,this.onFragLoading,this),e.on(JP.FRAG_LOADED,this.onFragLoaded,this),e.on(JP.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(JP.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(JP.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(JP.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(JP.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(JP.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(JP.FRAG_LOADING,this.onFragLoading,this),e.off(JP.FRAG_LOADED,this.onFragLoaded,this),e.off(JP.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(JP.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(JP.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(JP.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(JP.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new hG(this,"textTrack1"),t=new hG(this,"textTrack2"),n=new hG(this,"textTrack3"),r=new hG(this,"textTrack4");this.cea608Parser1=new Oz(1,e,t),this.cea608Parser2=new Oz(3,n,r)}addCues(e,t,n,r,i){let s=!1;for(let e=i.length;e--;){const r=i[e],a=mG(r[0],r[1],t,n);if(a>=0&&(r[0]=Math.min(r[0],t),r[1]=Math.max(r[1],n),s=!0,a/(n-t)>.5))return}if(s||i.push([t,n]),this.config.renderTextTracksNatively){const i=this.captionsTracks[e];this.Cues.newCue(i,t,n,r)}else{const i=this.Cues.newCue(null,t,n,r);this.hls.trigger(JP.CUES_PARSED,{type:"captions",cues:i,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:i,trackId:s}){const{unparsedVttFrags:a}=this;n===rD.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:i,trackId:s}),a.length&&(this.unparsedVttFrags=[],a.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(JP.FRAG_LOADED,e):this.hls.trigger(JP.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const i=n.textTracks[r];if(pG(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:i,languageCode:s}=t[e],a=this.getExistingTrack(i,s);if(a)n[e]=a,ez(n[e]),JN(n[e],r);else{const t=this.createTextTrack("captions",i,s);t&&(t[e]=!0,n[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(JP.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(e=>{ez(r[e]),delete r[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let e=0;e<t.length;e++)ez(t[e])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(e=>e.textCodec===eG);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(NU(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const e=this.media,t=e?nz(e.textTracks):null;if(this.tracks.forEach((e,n)=>{let r;if(t){let n=null;for(let r=0;r<t.length;r++)if(t[r]&&pG(t[r],e)){n=t[r],t[r]=null;break}n&&(r=n)}if(r)ez(r);else{const t=fG(e);r=this.createTextTrack(t,e.name,e.lang),r&&(r.mode="disabled")}r&&this.textTracks.push(r)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(JP.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const n=`textTrack${t[1]}`,r=this.captionsProperties[n];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===rD.MAIN){var n,r;const{cea608Parser1:e,cea608Parser2:i,lastSn:s}=this,{cc:a,sn:o}=t.frag,l=null!=(n=null==(r=t.part)?void 0:r.index)?n:-1;e&&i&&(o!==s+1||o===s&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),i.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===rD.SUBTITLE)if(r.byteLength){const e=n.decryptdata,i="stats"in t;if(null==e||!e.encrypted||i){const e=this.tracks[n.level],i=this.vttCCs;i[n.cc]||(i[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),e&&e.textCodec===eG?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(JP.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;iG(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),n.trigger(JP.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{n.logger.log(`Failed to parse IMSC1: ${t}`),n.trigger(JP.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:i,unparsedVttFrags:s}=this,a=i.length-1;if(!i[n.cc]&&-1===a)return void s.push(e);const o=this.hls;Zz(null!=(t=n.initSegment)&&t.data?rL(n.initSegment.data,new Uint8Array(r)).buffer:r,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,e=>{this._appendCues(e,n.level),o.trigger(JP.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},t=>{const i="Missing initPTS for VTT MPEGTS"===t.message;i?s.push(e):this._fallbackToIMSC1(n,r),o.logger.log(`Failed to parse VTT cue: ${t}`),i&&a>n.cc||o.trigger(JP.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||iG(t,this.initPTS[e.cc],()=>{n.textCodec=eG,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach(e=>ZN(n,e))}else{const r=this.tracks[t];if(!r)return;const i=r.default?"default":"subtitles"+t;n.trigger(JP.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===rD.SUBTITLE&&this.onFragLoaded(JP.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(n.type!==rD.MAIN||"NONE"!==this.closedCaptionsForLevel(n))for(let e=0;e<r.length;e++){const t=r[e].bytes;if(t){this.cea608Parser1||this.initCea608Parsers();const n=this.extractCea608Data(t);this.cea608Parser1.addData(r[e].pts,n[0]),this.cea608Parser2.addData(r[e].pts,n[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:r,type:i}){const{media:s}=this;if(s&&!(s.currentTime<n)){if(!i||"video"===i){const{captionsTracks:e}=this;Object.keys(e).forEach(r=>tz(e[r],t,n))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==r){const{textTracks:e}=this;Object.keys(e).forEach(n=>tz(e[n],t,r))}}}extractCea608Data(e){const t=[[],[]],n=31&e[0];let r=2;for(let i=0;i<n;i++){const n=e[r++],i=127&e[r++],s=127&e[r++];if(0===i&&0===s)continue;if(!!(4&n)){const e=3&n;0!==e&&1!==e||(t[e].push(i),t[e].push(s))}}return t}}function fG(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function pG(e,t){return!!e&&e.kind===fG(t)&&GU(t,e)}function mG(e,t,n,r){return Math.min(t,r)-Math.max(e,n)}const gG=/\s/,AG={newCue(e,t,n,r){const i=[];let s,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let d=0;d<r.rows.length;d++)if(s=r.rows[d],o=!0,l=0,c="",!s.isEmpty()){var h;for(let e=0;e<s.chars.length;e++)gG.test(s.chars[e].uchar)&&o?l++:(c+=s.chars[e].uchar,o=!1);s.cueStartTime=t,t===n&&(n+=1e-4),l>=16?l--:l++;const r=Kz(c.trim()),f=Jz(t,n,r);null!=e&&null!=(h=e.cues)&&h.getCueById(f)||(a=new u(t,n,r),a.id=f,a.line=d+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(a))}return e&&i.length&&(i.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),i.forEach(t=>ZN(e,t))),i}};function vG(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}const yG=/(\d+)-(\d+)\/(\d+)/;class EG{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||_G,this.controller=new self.AbortController,this.stats=new BD}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const i=function(e,t){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(oD({},e.headers))};e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return n}(e,this.controller.signal),s="arraybuffer"===e.responseType,a=s?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=o&&YP(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout);(PU(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(n=>{var i;this.response=this.loader=n;const a=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},l-(a-r.loading.start)),!n.ok){const{status:e,statusText:t}=n;throw new xG(t||"fetch, bad network response",e,n)}r.loading.first=a,r.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=yG.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(YP(e))return e}const n=e.get("Content-Length");if(n)return parseInt(n)}(n.headers)||r.total;const o=null==(i=this.callbacks)?void 0:i.onProgress;return o&&YP(t.highWaterMark)?this.loadProgressively(n,r,e,t.highWaterMark,o):s?n.arrayBuffer():"json"===e.responseType?n.json():n.text()}).then(n=>{var i,s;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=n[a];l&&(r.loaded=r.total=l);const c={url:o.url,data:n,code:o.status},u=null==(i=this.callbacks)?void 0:i.onProgress;u&&!YP(t.highWaterMark)&&u(r,e,n,o),null==(s=this.callbacks)||s.onSuccess(c,r,e,o)}).catch(t=>{var n;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const i=t&&t.code||0,s=t?t.message:null;null==(n=this.callbacks)||n.onError({code:i,text:s},e,t?t.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,r=0,i){const s=new lO,a=e.body.getReader(),o=()=>a.read().then(a=>{if(a.done)return s.dataLength&&i(t,n,s.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return t.loaded+=c,c<r||s.dataLength?(s.push(l),s.dataLength>=r&&i(t,n,s.flush().buffer,e)):i(t,n,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function _G(e,t){return new self.Request(e.url,t)}class xG extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const bG=/^age:\s*[\d.]+\s*$/im;class SG{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new BD,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return i(n,t.url)}).catch(e=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",t.url,!0),i(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(e=>{var i;null==(i=this.callbacks)||i.onError({code:n.status,text:e.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:s}=n.loadPolicy;if(r)for(const t in r)e.setRequestHeader(t,r[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=i&&YP(i)?i:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,i=this.config;if(!n.aborted&&r>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const r=t.status,l="text"===t.responseType?t.responseText:null;if(r>=200&&r<300){const i=null!=l?l:t.response;if(null!=i){var s,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const o="arraybuffer"===t.responseType?i.byteLength:i.length;n.loaded=n.total=o,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first);const l=null==(s=this.callbacks)?void 0:s.onProgress;l&&l(n,e,i,t);const c={url:t.responseURL,data:i,code:r};return void(null==(a=this.callbacks)||a.onSuccess(c,n,e,t))}}const c=i.loadPolicy.errorRetry;var o;if(ak(c,n.retry,!1,{url:e.url,data:void 0,code:r}))this.retry(c);else gD.error(`${r} while loading ${e.url}`),null==(o=this.callbacks)||o.onError({code:r,text:t.statusText},e,t,n)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(ak(e,this.stats.retry,!0))this.retry(e);else{var t;gD.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=ik(e,n.retry),n.retry++,gD.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&bG.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const wG=cD(cD({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:SG,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:XL,bufferController:YU,capLevelController:XU,errorController:uk,fpsController:$N,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:aF,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:AG,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:yz,subtitleTrackController:rz,timelineController:dG,audioStreamController:OU,audioTrackController:QU,emeController:KN,cmcdController:VN,contentSteeringController:jN,interstitialsController:class extends uD{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled||!this.schedule)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const n=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const r=this.playingItem;if(!r)return void this.checkBuffer();if(n){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(!0)}if(this.checkBuffer(),n&&e<r.start||e>=r.end){var i;const t=this.findItemIndex(r);let s=this.schedule.findItemIndexAtTime(e);if(-1===s&&(s=t+(n?-1:1),this.log(`seeked ${n?"back ":""}to position not covered by schedule ${e} (resolving from ${t} to ${s})`)),!this.isInterstitial(r)&&null!=(i=this.media)&&i.paused&&(this.shouldPlay=!1),!n&&s>t){const e=this.schedule.findJumpRestrictedIndex(t+1,s);if(e>t)return void this.setSchedulePosition(e)}return void this.setSchedulePosition(s)}const s=this.playingAsset;if(!s){if(this.playingLastItem&&this.isInterstitial(r)){const t=r.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const a=s.timelineStart,o=s.duration||0;var l;(n&&e<a||e>=a+o)&&(null!=(l=r.event)&&l.appendInPlace&&(this.clearInterstitial(r.event,r),this.flushFrontBuffer(e)),this.setScheduleToAssetAtTime(e,s))},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const n=this.playingAsset;if(!n)return;e>=n.timelineStart+(n.duration||0)&&this.setScheduleToAssetAtTime(e,n)},this.onScheduleUpdate=(e,t)=>{const n=this.schedule;if(!n)return;const r=this.playingItem,i=n.events||[],s=n.items||[],a=n.durations,o=e.map(e=>e.identifier),l=!(!i.length&&!o.length);(l||t)&&this.log(`INTERSTITIALS_UPDATED (${i.length}): ${i}\nSchedule: ${s.map(e=>mz(e))} pos: ${this.timelinePos}`),o.length&&this.log(`Removed events ${o}`);let c=null,u=null;r&&(c=this.updateItem(r,this.timelinePos),this.itemsMatch(r,c)?this.playingItem=c:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const h=this.bufferingItem;if(h&&(u=this.updateItem(h,this.bufferedPos),this.itemsMatch(h,u)?this.bufferingItem=u:h.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(h.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){const t=e.assetItem.timelineStart,n=e.timelineOffset-t;if(n)try{e.timelineOffset=t}catch(r){Math.abs(n)>sz&&this.warn(`${r} ("${e.assetId}" ${e.timelineOffset}->${t})`)}}}),l||t){if(this.hls.trigger(JP.INTERSTITIALS_UPDATED,{events:i.slice(0),schedule:s.slice(0),durations:a,removedIds:o}),this.isInterstitial(r)&&o.includes(r.event.identifier))return this.warn(`Interstitial "${r.event.identifier}" removed while playing`),void this.primaryFallback(r.event);r&&this.trimInPlace(c,r),h&&u!==c&&this.trimInPlace(u,h),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new gz(e),this.schedule=new pz(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(JP.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(JP.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(JP.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(JP.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(JP.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(JP.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(JP.BUFFER_APPENDED,this.onBufferAppended,this),e.on(JP.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(JP.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(JP.MEDIA_ENDED,this.onMediaEnded,this),e.on(JP.ERROR,this.onError,this),e.on(JP.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(JP.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(JP.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(JP.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(JP.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(JP.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(JP.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(JP.BUFFER_CODECS,this.onBufferCodecs,this),e.off(JP.BUFFER_APPENDED,this.onBufferAppended,this),e.off(JP.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(JP.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(JP.MEDIA_ENDED,this.onMediaEnded,this),e.off(JP.ERROR,this.onError,this),e.off(JP.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){WF(e,"play",this.onPlay),WF(e,"pause",this.onPause),WF(e,"seeking",this.onSeeking),WF(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;jF(n,"seeking",this.onSeeking),jF(n,"timeupdate",this.onTimeupdate),jF(n,"play",this.onPlay),jF(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,null===n)this.checkStart();else if(!r){this.clearScheduleState();const e=this.findItemIndex(n);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.log(`Removing schedule state for detachedData and ${e}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=t=>t?e.getAssetPlayer(t.identifier):t,r=(t,r,s,a,o)=>{if(t){let l=t[r].start;const c=t.event;if(c){if("playout"===r||c.timelineOccupancy!==az.Point){const e=n(s);(null==e?void 0:e.interstitial)===c&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===a?i():e[a])-t.start}return l}return 0},i=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?s("primary"):Math.max(t,0)},s=t=>{var n,r;return null!=(n=e.primaryDetails)&&n.live?e.primaryDetails.edge:(null==(r=e.schedule)?void 0:r.durations[t])||0},a=(t,i)=>{var s,a;const o=e.effectivePlayingItem;if(null!=o&&null!=(s=o.event)&&s.restrictions.skip||!e.schedule)return;e.log(`seek to ${t} "${i}"`);const l=e.effectivePlayingItem,c=e.schedule.findItemIndexAtTime(t,i),u=null==(a=e.schedule.items)?void 0:a[c],h=e.getBufferingPlayer(),d=null==h?void 0:h.interstitial,f=null==d?void 0:d.appendInPlace,p=l&&e.itemsMatch(l,u);if(l&&(f||p)){const s=n(e.playingAsset),a=(null==s?void 0:s.media)||e.primaryMedia;if(a){const n="primary"===i?a.currentTime:r(l,i,e.playingAsset,"timelinePos","currentTime"),o=t-n,c=(f?n:a.currentTime)+o;if(c>=0&&(!s||f||c<=s.duration))return void(a.currentTime=c)}}if(u){let n=t;if("primary"!==i){const e=t-u[i].start;n=u.start+e}const r=!e.isInterstitial(u);if(e.isInterstitial(l)&&!l.event.appendInPlace||!r&&!u.event.appendInPlace){if(l){const s=e.findItemIndex(l);if(c>s){const t=e.schedule.findJumpRestrictedIndex(s+1,c);if(t>s)return void e.setSchedulePosition(t)}let a=0;if(r)e.timelinePos=n,e.checkBuffer();else{const e=u.event.assetList,n=t-(u[i]||u).start;for(let t=e.length;t--;){const r=e[t];if(r.duration&&n>=r.startOffset&&n<r.startOffset+r.duration){a=t;break}}}e.setSchedulePosition(c,a)}}else{const t=e.media||(f?null==h?void 0:h.media:null);t&&(t.currentTime=n)}}},o=()=>{const n=e.effectivePlayingItem;if(e.isInterstitial(n))return n;const r=t();return e.isInterstitial(r)?r:null},l={get bufferedEnd(){const n=t(),i=e.bufferingItem;var s;return i&&i===n&&(r(i,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-i.playout.start||(null==(s=e.bufferingAsset)?void 0:s.startOffset))||0},get currentTime(){const t=o(),n=e.effectivePlayingItem;return n&&n===t?r(n,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-n.playout.start:0},set currentTime(t){const n=o(),r=e.effectivePlayingItem;r&&r===n&&a(t+r.playout.start,"playout")},get duration(){const e=o();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const n=null==(t=o())?void 0:t.event.assetList;return n?n.map(t=>e.getAssetPlayer(t.identifier)):[]},get playingIndex(){var t;const n=null==(t=o())?void 0:t.event;return n&&e.effectivePlayingAsset?n.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var t;return(null==(t=e.schedule)||null==(t=t.events)?void 0:t.slice(0))||[]},get schedule(){var t;return(null==(t=e.schedule)||null==(t=t.items)?void 0:t.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const n=t();return e.findItemIndex(n)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return i()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){a(e,"primary")},get duration(){return s("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){a(e,"integrated")},get duration(){return s("integrated")},get seekableStart(){var t;return((t,n)=>{var r;if(0!==t&&"primary"!==n&&null!=(r=e.schedule)&&r.length){var i;const r=e.schedule.findItemIndexAtTime(t),s=null==(i=e.schedule.items)?void 0:i[r];if(s)return t+(s[n].start-s.start)}return t})((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,n=null==t?void 0:t.event;if(n&&!n.restrictions.skip){const r=e.findItemIndex(t);if(n.appendInPlace){const e=t.playout.start+t.event.duration;a(e+.001,"playout")}else e.advanceAfterAssetEnded(n,r,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&n)&&this.findItemIndex(t)===n.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(r=this.primaryMedia);const i=null==(t=r)?void 0:t.currentTime;return void 0!==i&&YP(i)?i:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r)return void(this.detachedData={media:r});const n=e.transferMedia();this.log(`transfer MediaSource from ${e} ${GL(n)}`),this.detachedData=n}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let i=null;const s=this.hls,a=e!==s,o=a&&e.interstitial.appendInPlace,l=null==(n=this.detachedData)?void 0:n.mediaSource;let c;if(s.media)o&&(i=s.transferMedia(),this.detachedData=i),c="Primary";else if(l){const e=this.getBufferingPlayer();e?(i=e.transferMedia(),c=`${e}`):c="detached MediaSource"}else c="detached media";if(!i)if(l)i=this.detachedData,this.log(`using detachedData: MediaSource ${GL(i)}`);else if(!this.detachedData||s.media===t){const e=this.playerQueue;e.length>1&&e.forEach(e=>{if(a&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${t}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}const u=i&&"mediaSource"in i&&"closed"!==(null==(r=i.mediaSource)?void 0:r.readyState),h=u&&i?i:t;this.log(`${u?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const d=this.schedule;if(h===i&&d){const t=a&&e.assetId===d.assetIdAtEnd;h.overrides={duration:d.duration,endOfStream:!a||t,cueRemoval:!a}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(-1===n){const n=this.hls.startPosition;if(this.log(vz("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const n=e.findEventIndex(t[0].identifier);this.setSchedulePosition(n)}else if(n>=0||!this.primaryLive){const t=this.timelinePos=n>0?n:0,r=e.findItemIndexAtTime(t);this.setSchedulePosition(r)}}else if(r&&!this.playingItem){const t=e.findItemIndex(r);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){const n=e.event,r=n.findAssetIndex(t),i=hz(n,r);if(n.isAssetPastPlayoutLimit(i)){if(this.schedule){var s;const t=null==(s=this.schedule.items)?void 0:s[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,i)}advanceAfterAssetEnded(e,t,n){const r=hz(e,n);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const n=this.schedule.items;if(n){const r=t+1;if(r>=n.length)return void this.setSchedulePosition(-1);const i=e.resumeTime;this.timelinePos<i&&(this.log(vz("advanceAfterAssetEnded",i)),this.timelinePos=i,e.appendInPlace&&this.advanceInPlace(i),this.checkBuffer(this.bufferedPos<i)),this.setSchedulePosition(r)}}}else{if(e.appendInPlace){const t=e.assetList[r];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const r=t.parentIdentifier,i=n.getEvent(r);if(i){const t=n.findEventIndex(r),s=n.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,t,s-1)}}setSchedulePosition(e,t){var n;const r=null==(n=this.schedule)?void 0:n.items;if(!r||this.playbackDisabled)return;const i=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i?mz(i):i}) pos: ${this.timelinePos}`);const s=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(s)){const n=s.event,c=this.playingAsset,u=null==c?void 0:c.identifier,h=u?this.getAssetPlayer(u):null;if(h&&u&&(!this.eventItemsMatch(s,i)||void 0!==t&&u!==n.assetList[t].identifier)){var o;const t=n.findAssetIndex(c);if(this.log(`INTERSTITIAL_ASSET_ENDED ${t+1}/${n.assetList.length} ${dz(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(JP.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:n,schedule:r.slice(0),scheduleIndex:e,player:h}),s!==this.playingItem)return void(this.itemsMatch(s,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(n,this.findItemIndex(this.playingItem),t));this.retreiveMediaSource(u,i),!h.media||null!=(o=this.detachedData)&&o.mediaSource||h.detachMedia()}if(!this.eventItemsMatch(s,i)&&(this.endedItem=s,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${n} ${mz(s)}`),n.hasPlayed=!0,this.hls.trigger(JP.INTERSTITIAL_ENDED,{event:n,schedule:r.slice(0),scheduleIndex:e}),n.cue.once)){var l;this.updateSchedule();const e=null==(l=this.schedule)?void 0:l.items;if(i&&e){const n=this.findItemIndex(i);this.advanceSchedule(n,e,t,s,a)}return}}this.advanceSchedule(e,r,t,s,a)}advanceSchedule(e,t,n,r,i){const s=this.schedule;if(!s)return;const a=t[e]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{const n=t.interstitial,r=s.findEventIndex(n.identifier);(r<e||r>e+1)&&this.clearInterstitial(n,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const i=a.event;if(void 0===n){const t=hz(i,(n=s.findAssetIndex(i,this.timelinePos))-1);if(i.isAssetPastPlayoutLimit(t)||i.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(i,e,n);n=t}const l=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let c=this.preloadAssets(i,n);if(this.eventItemsMatch(a,l||r)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${mz(a)} ${i.appendInPlace?"append in place":""}`),this.hls.trigger(JP.INTERSTITIAL_STARTED,{event:i,schedule:t.slice(0),scheduleIndex:e})),!i.assetListLoaded)return void this.log(`Waiting for ASSET-LIST to complete loading ${i}`);if(i.assetListLoader&&(i.assetListLoader.destroy(),i.assetListLoader=void 0),!o)return void this.log(`Waiting for attachMedia to start Interstitial ${i}`);this.waitingItem=this.endedItem=null,this.playingItem=a;const u=i.assetList[n];if(!u)return void this.advanceAfterAssetEnded(i,e,n||0);if(c||(c=this.getAssetPlayer(u.identifier)),null===c||c.destroyed){const e=i.assetList.length;this.warn(`asset ${n+1}/${e} player destroyed ${i}`),c=this.createAssetPlayer(i,u,n),c.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&i.appendInPlace&&this.isAssetBuffered(u))return;this.startAssetPlayer(c,n,t,e,o),this.shouldPlay&&Az(c.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&Az(this.hls.media)):i&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(s.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,n){var r,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${mz(e)}`),null==(r=this.detachedData)||!r.mediaSource){let n=this.timelinePos;(n<e.start||n>=e.end)&&(n=this.getPrimaryResumption(e,t),this.log(vz("resumePrimary",n)),this.timelinePos=n),this.attachPrimary(n,e)}if(!n)return;const s=null==(i=this.schedule)?void 0:i.items;s&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${mz(e)}`),this.hls.trigger(JP.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(n<e.fragmentStart||n>e.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return Lk.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(vz("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs(((null==(n=r.mainForwardBufferInfo)?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(JP.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(JP.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;const n=this.hls.levels[t.level],r=cD(cD({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r)return void(this.altSelection=cD(cD({},this.altSelection),{},{audio:n}));const i=cD(cD({},r),{},{audio:n});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r)return void(this.altSelection=cD(cD({},this.altSelection),{},{subtitles:n}));const i=cD(cD({},r),{},{subtitles:n});this.mediaSelection=i}onAudioTrackSwitching(e,t){const n=VL(t);this.playerQueue.forEach(({hls:e})=>e&&(e.setAudioOption(t)||e.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=VL(t);this.playerQueue.forEach(({hls:e})=>e&&(e.setSubtitleOption(t)||-1!==t.id&&e.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const r=t[e];if(r.cue.post){var n;const e=this.schedule.findEventIndex(r.identifier),t=null==(n=this.schedule.items)?void 0:n[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const r=null==(n=this.schedule)?void 0:n.items;if(e&&r){return r[this.findItemIndex(e,t)]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,n)=>{e.event.isAssetPastPlayoutLimit(n)&&this.clearAssetPlayer(t.identifier,null)});const n=e.end+.25,r=Lk.bufferInfo(this.primaryMedia,n,0);if(r.end>n||(r.nextStart||0)>n){this.log(`trim buffered interstitial ${mz(e)} (was ${mz(t)})`);const r=!0;this.attachPrimary(n,null,r),this.flushFrontBuffer(n)}}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===(null==(n=t.event)?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&(null==(t=this.schedule)||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=null==(t=this.schedule)?void 0:t.items;if(!n)return;const r=Lk.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,n,e)}updateBufferedPos(e,t,n){const r=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(1===t.length&&this.itemsMatch(t[0],i))return void(this.bufferedPos=e);const s=this.playingItem,a=this.findItemIndex(s);let o=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const n=this.findItemIndex(i),r=Math.min(n+1,t.length-1),s=t[r];if((-1===o&&i&&e>=i.end||null!=(l=s.event)&&l.appendInPlace&&e+.01>=s.start)&&(o=r),this.isInterstitial(i)){const e=i.event;if(r-a>1&&!1===e.appendInPlace)return;if(0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>n&&o>a)this.bufferedToItem(s);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&s.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(s)&&this.preloadAssets(s.event,0)}}else n&&s&&!this.itemsMatch(s,i)&&(o===a?this.bufferedToItem(s):o===a+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{const n=this.getAssetPlayer(e.identifier);return!(null!=n&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:r,events:i}=n;if(!r||!i)return t;const s=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const o=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${mz(e)}`+(t?` (${o.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(s){const t=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,n)=>{const r=this.getAssetPlayer(e.identifier);r&&(n===t&&r.loadSource(),r.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(JP.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==n){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=0===n.assetList.length&&!n.assetListLoader,i=n.cue.once;if(r||!i){const e=this.preloadAssets(n,t);if(null!=e&&e.interstitial.appendInPlace){const t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,i=0===r&&!e.assetListLoader,s=e.cue.once;if(i){const i=e.timelineStart;if(e.appendInPlace){var a;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(a=t.nextEvent)?void 0:a.identifier)!==e.identifier||this.flushFrontBuffer(i+.25)}let s,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-i;e>0&&(s=Math.round(1e3*e)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:r} ${e}${s?` live-start: ${o} start-offset: ${s}`:""}`),n)return this.createAsset(e,0,0,i,e.duration,n);const l=this.assetListLoader.loadAssetList(e,s);l&&(e.assetListLoader=l)}else if(!s&&r){for(let n=t;n<r;n++){const t=e.assetList[n],r=this.getAssetPlayerQueueIndex(t.identifier);-1!==r&&!this.playerQueue[r].destroyed||t.error||this.createAssetPlayer(e,t,n)}const n=e.assetList[t];if(n){const e=this.getAssetPlayer(n.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`);Object.keys(t).forEach(t=>{this.hls.trigger(JP.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n];return null}createAsset(e,t,n,r,i,s){const a={parentIdentifier:e.identifier,identifier:oz(e,s,t),duration:i,startOffset:n,timelineStart:r,uri:s};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){const r=this.hls,i=r.userConfig;let s=i.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(s||a)&&(s=oD({},s),a.videoCodec&&(s.videoCodec=a.videoCodec),a.videoRange&&(s.allowedVideoRanges=[a.videoRange]));const o=r.audioTracks[r.audioTrack],l=r.subtitleTracks[r.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const n=t.duration;n&&e<n&&(c=e)}}const u=t.identifier,h=cD(cD({},i),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:u,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:s,audioPreference:o||i.audioPreference,subtitlePreference:l||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const d=h.cmcd;null!=d&&d.sessionId&&d.contentId&&(h.cmcd=oD({},d,{contentId:iz(t.uri)})),this.getAssetPlayer(u)&&this.warn(`Duplicate date range identifier ${e} and asset ${u}`);const f=new fz(this.HlsPlayerClass,h,e,t);this.playerQueue.push(f),e.assetList[n]=t;let p=!0;const m=r=>{if(r.live){var i;const t=new Error(`Interstitials MUST be VOD assets ${e}`),r={fatal:!0,type:XP.OTHER_ERROR,details:$P.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},s=(null==(i=this.schedule)?void 0:i.findEventIndex(e.identifier))||-1;return void this.handleAssetItemError(r,e,s,n,t.message)}const s=r.edge-r.fragmentStart,a=t.duration;(p||null===a||s>a)&&(p=!1,this.log(`Interstitial asset "${u}" duration change ${a} > ${s}`),t.duration=s,this.updateSchedule())};f.on(JP.LEVEL_UPDATED,(e,{details:t})=>m(t)),f.on(JP.LEVEL_PTS_UPDATED,(e,{details:t})=>m(t)),f.on(JP.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const g=(e,t)=>{const n=this.getAssetPlayer(u);if(n&&t.tracks){n.off(JP.BUFFER_CODECS,g),n.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===n.assetItem&&e&&!n.media&&this.bufferAssetPlayer(n,e)}};f.on(JP.BUFFER_CODECS,g);f.on(JP.BUFFERED_TO_END,()=>{var n;const r=this.getAssetPlayer(u);if(this.log(`buffered to end of asset ${r}`),!r||!this.schedule)return;const i=this.schedule.findEventIndex(e.identifier),s=null==(n=this.schedule.items)?void 0:n[i];this.isInterstitial(s)&&this.advanceAssetBuffering(s,t)});const A=t=>()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;this.shouldPlay=!0;const n=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,t)};return f.once(JP.MEDIA_ENDED,A(n)),f.once(JP.PLAYOUT_LIMIT_REACHED,A(1/0)),f.on(JP.ERROR,(t,r)=>{if(!this.schedule)return;const i=this.getAssetPlayer(u);if(r.details===$P.BUFFER_STALLED_ERROR)return null!=i&&i.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${r.error} ${e}`)}),f.on(JP.DESTROYING,()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;const t=new Error(`Asset player destroyed unexpectedly ${u}`),r={fatal:!0,type:XP.OTHER_ERROR,details:$P.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(r,e,this.schedule.findEventIndex(e.identifier),n,t.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${dz(t)}`),this.hls.trigger(JP.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:f}),f}clearInterstitial(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(-1!==n){const e=this.playerQueue[n];this.log(`clear ${e} toSegment: ${t?mz(t):t}`),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(n,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,i){const{interstitial:s,assetItem:a,assetId:o}=e,l=s.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,n[r]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${dz(a)}`),this.hls.trigger(JP.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:s,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var n,r;if(!this.schedule)return;const{interstitial:i,assetItem:s}=e,a=this.schedule.findEventIndex(i.identifier),o=null==(n=this.schedule.items)?void 0:n[a];if(!o)return;e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=s;const l=this.getBufferingPlayer();if(l===e)return;const c=i.appendInPlace;if(c&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const u=(null==l?void 0:l.tracks)||(null==(r=this.detachedData)?void 0:r.tracks)||this.requiredTracks;if(c&&s!==this.playingAsset){if(!e.tracks)return void this.log(`Waiting for track info before buffering ${e}`);if(u&&!vD(u,e.tracks)){const t=new Error(`Asset ${dz(s)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(u)}')`),n={fatal:!0,type:XP.OTHER_ERROR,details:$P.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},r=i.findAssetIndex(s);return void this.handleAssetItemError(n,i,a,r,t.message)}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const r=n.currentTime,i=t.findAssetIndex(e,r),s=e.assetList[i];if(s){const a=this.getAssetPlayer(s.identifier);if(a){const o=a.currentTime||r-s.timelineStart,l=a.duration-o;if(this.warn(`Stalled at ${o} of ${o+l} in ${a} ${e} (media.currentTime: ${r})`),o&&(l/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const n=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,r,i){if(e.details===$P.BUFFER_STALLED_ERROR)return;const s=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${s?dz(s):s} ${e.error}`),!this.schedule)return;const a=(null==s?void 0:s.identifier)||"",o=this.getAssetPlayerQueueIndex(a),l=this.playerQueue[o]||null,c=this.schedule.items,u=oD({},e,{fatal:!1,errorAction:hk(!0),asset:s,assetListIndex:r,event:t,schedule:c,scheduleIndex:n,player:l});if(this.hls.trigger(JP.INTERSTITIAL_ASSET_ERROR,u),!e.fatal)return;const h=this.playingAsset,d=this.bufferingAsset,f=new Error(i);if(s&&(this.clearAssetPlayer(a,null),s.error=f),t.assetList.some(e=>!e.error))for(let e=r;e<t.assetList.length;e++)this.resetAssetPlayer(t.assetList[e].identifier);else t.error=f;this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===a?this.advanceAfterAssetEnded(t,n,r):d&&d.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,d)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${mz(n)} error: ${e.error}`);let r=this.timelinePos;-1===r&&(r=this.hls.startPosition);const i=this.updateItem(n,r);if(this.itemsMatch(n,i)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const s=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(s)}else this.checkStart()}onAssetListLoaded(e,t){var n,r;const i=t.event,s=i.identifier,a=t.assetListResponse.ASSETS;if(null==(n=this.schedule)||!n.hasEvent(s))return;const o=i.timelineStart,l=i.duration;let c=0;a.forEach((e,t)=>{const n=parseFloat(e.DURATION);this.createAsset(i,t,c,o+c,n,e.URI),c+=n}),i.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${l}) ${i}`);const u=this.waitingItem,h=(null==u?void 0:u.event.identifier)===s;this.updateSchedule();const d=null==(r=this.bufferingItem)?void 0:r.event;if(h){var f;const e=this.schedule.findEventIndex(s),t=null==(f=this.schedule.items)?void 0:f[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.updateSchedule(!0),void this.primaryFallback(i)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==d?void 0:d.identifier)===s){const e=i.assetList[0];if(e){const t=this.getAssetPlayer(e.identifier);if(d.appendInPlace){const e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case $P.ASSET_LIST_PARSING_ERROR:case $P.ASSET_LIST_LOAD_ERROR:case $P.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case $P.BUFFER_STALLED_ERROR:{const e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function CG(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(CG):Object.keys(e).reduce((t,n)=>(t[n]=CG(e[n]),t),{}):e}class TG extends Bk{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(JP.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(JP.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(JP.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const n=this.media=t.media;jF(n,"playing",this.onMediaPlaying),jF(n,"waiting",this.onMediaWaiting),jF(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(WF(n,"playing",this.onMediaPlaying),WF(n,"waiting",this.onMediaWaiting),WF(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const i=null==(n=this.hls)?void 0:n.config;if(!i)return;const s=this.media;if(!s)return;const{seeking:a}=s,o=this.seeking&&!a,l=!this.seeking&&a,c=s.paused&&!a||s.ended||0===s.playbackRate;if(this.seeking=a,e!==t)return t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(l||o)return void(o&&this.stallResolved(e));if(c)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&s.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(JP.MEDIA_ENDED,{stalled:!1})));if(!Lk.getBuffered(s).length)return void(this.nudgeRetry=0);const u=Lk.bufferInfo(s,e,0),h=u.nextStart||0,d=this.fragmentTracker;if(a&&d&&this.hls){const t=MG(this.hls.inFlightFragments,e),n=u.len>2,r=!h||t||h-e>2&&!d.getPartialFragment(e);if(n||r)return;this.moved=!1}const f=null==(r=this.hls)?void 0:r.latestLevelDetails;if(!this.moved&&null!==this.stalled&&d){if(!(u.len>0)&&!h)return;const t=Math.max(h,u.start||0)-e,n=!(null==f||!f.live)?2*f.targetduration:2,r=RG(e,d);if(t>0&&(t<=n||r))return void(s.paused||this._trySkipBufferHole(r))}const p=i.detectStallWithCurrentTimeMs,m=self.performance.now(),g=this.waiting;let A=this.stalled;if(null===A){if(!(g>0&&m-g<p))return void(this.stalled=m);A=this.stalled=g}const v=m-A;if(!a&&(v>=p||g)&&this.hls){var y;if("ended"===(null==(y=this.mediaSource)?void 0:y.readyState)&&(null==f||!f.live)&&Math.abs(e-((null==f?void 0:f.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(JP.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(u),!this.media||!this.hls)return}const E=Lk.bufferInfo(s,e,i.maxBufferHole);this._tryFixBufferStall(E,v,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(JP.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(n=this.buffered.audio)&&n.length&&r&&r.length>1&&e>r.end(0)){const n=Lk.bufferedInfo(Lk.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const n=Lk.timeRangesToArray(r),i=Lk.bufferedInfo(n,t,0).bufferedIndex;if(i>-1&&i<n.length-1){const t=Lk.bufferedInfo(n,e,0).bufferedIndex,r=n[i].end,s=n[i+1].start;if((-1===t||t>i)&&s-r<1&&e-r<2){const n=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${r} -> ${s} buffered index: ${t}`);this.warn(n.message),this.media.currentTime+=1e-6;let i=RG(e,this.fragmentTracker);i&&"fragment"in i?i=i.fragment:i||(i=void 0);const a=Lk.bufferInfo(this.media,e,0);this.hls.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,frag:i,buffer:a.len,bufferInfo:a})}}}}}_tryFixBufferStall(e,t,n){var r,i;const{fragmentTracker:s,media:a}=this,o=null==(r=this.hls)?void 0:r.config;if(!a||!s||!o)return;const l=null==(i=this.hls)?void 0:i.latestLevelDetails,c=RG(n,s);if(c||null!=l&&l.live&&n<l.fragmentStart){if(this._trySkipBufferHole(c)||!this.media)return}const u=e.buffered,h=this.adjacentTraversal(e,n);(u&&u.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-n<o.maxBufferHole||h))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,r=e.nextStart;if(n&&r){const e=n.getFragAtPos(t,rD.MAIN),i=n.getFragAtPos(r,rD.MAIN);if(e&&i)return i.sn-e.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:i}=this;if(!r&&null!==i&&n&&t){this.stallReported=!0;const r=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${GL(e)})`);this.warn(r.message),t.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,i=null==(t=this.hls)?void 0:t.config;if(!r||!n||!i)return 0;const s=r.currentTime,a=Lk.bufferInfo(r,s,0),o=s<a.start?a.start:a.nextStart;if(o&&this.hls){const t=a.len<=i.maxBufferHole,c=a.len>0&&a.len<1&&r.readyState<3,u=o-s;if(u>0&&(t||c)){if(u>i.maxBufferHole){let t=!1;if(0===s){const e=n.getAppendedFrag(0,rD.MAIN);e&&o<e.end&&(t=!0)}if(!t&&e){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(MG(this.hls.inFlightFragments,o))return 0;let t=!1,r=e.end;for(;r<o;){const e=RG(r,n);if(!e){t=!0;break}r+=e.duration}if(t)return 0}}const t=Math.max(o+.05,s+.1);if(this.warn(`skipping hole, adjusting currentTime from ${s} to ${t}`),this.moved=!0,r.currentTime=t,null==e||!e.gap){const n=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${t}`),r={type:XP.MEDIA_ERROR,details:$P.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?r.part=e:r.frag=e),this.hls.trigger(JP.ERROR,r)}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,i=null==t?void 0:t.config;if(!n||!i)return 0;const s=n.currentTime;if(this.nudgeRetry++,r<i.nudgeMaxRetry){const a=s+(r+1)*i.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${s} to ${a}`);this.warn(o.message),n.currentTime=a,t.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const n=new Error(`Playhead still not moving while enough data buffered @${s} after ${i.nudgeMaxRetry} nudges`);this.error(n.message),t.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.BUFFER_STALLED_ERROR,error:n,fatal:!0,buffer:e.len,bufferInfo:e})}}}function MG(e,t){const n=IG(e.main);if(n&&n.start<=t)return n;const r=IG(e.audio);return r&&r.start<=t?r:null}function IG(e){if(!e)return null;switch(e.state){case qF:case KF:case nO:case rO:return null}return e.frag}function RG(e,t){return t.getAppendedFrag(e,rD.MAIN)||t.getPartialFragment(e)}function BG(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function PG(e,t,n,r,i){let s=new e(t,n,"");try{s.value=r,i&&(s.type=i)}catch(a){s=new e(t,n,GL(i?cD({type:i},r):r))}return s}const DG=(()=>{const e=BG();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class LG{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(JP.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(JP.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(JP.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(JP.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(JP.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(JP.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(JP.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(JP.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,!1===(null==(n=t.overrides)?void 0:n.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var e;const t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&ez(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if("metadata"===n.kind&&"id3"===n.label)return JN(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:r}=this.hls.config;if(!n&&!r)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=BG();if(s)for(let e=0;e<i.length;e++){const t=i[e].type;if(t===FO.emsg&&!n||!r)continue;const a=PO(i[e].data),o=i[e].pts;let l=o+i[e].duration;l>DG&&(l=DG);l-o<=0&&(l=o+.25);for(let e=0;e<a.length;e++){const n=a[e];if(!DO(n)){this.updateId3CueEnds(o,t);const e=PG(s,o,l,n,t);e&&this.id3Track.addCue(e)}}}}updateId3CueEnds(e,t){var n;const r=null==(n=this.id3Track)?void 0:n.cues;if(r)for(let n=r.length;n--;){const i=r[n];i.type===t&&i.startTime<e&&i.endTime===DG&&(i.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:r}){const{id3Track:i,hls:s}=this;if(!s)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=s;if(i&&(a||o)){let e;e="audio"===r?e=>e.type===FO.audioId3&&o:"video"===r?e=>e.type===FO.emsg&&a:e=>e.type===FO.audioId3&&o||e.type===FO.emsg&&a,tz(i,t,n,e)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:r,enableDateRangeMetadataCues:i,interstitialsController:s}=this.hls.config;if(!i)return;const a=BG();if(n&&r&&!s){const{fragmentStart:t,fragmentEnd:r}=e;let i=this.assetCue;i?(i.startTime=t,i.endTime=r):a&&(i=this.assetCue=PG(a,t,r,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),i&&(i.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(i),i.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:l}=e,c=Object.keys(l);let u=this.dateRangeCuesAppended;var h;if(o&&t)if(null!=(h=o.cues)&&h.length){const e=Object.keys(u).filter(e=>!c.includes(e));for(let t=e.length;t--;){var d;const n=e[t],r=null==(d=u[n])?void 0:d.cues;delete u[n],r&&Object.keys(r).forEach(e=>{const t=r[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(t)}catch(e){}}})}}else u=this.dateRangeCuesAppended={};const f=e.fragments[e.fragments.length-1];if(0!==c.length&&YP(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<c.length;e++){const t=c[e],n=l[t],r=n.startTime,i=u[t],o=(null==i?void 0:i.cues)||{};let h=(null==i?void 0:i.durationKnown)||!1,d=DG;const{duration:f,endDate:p}=n;if(p&&null!==f)d=r+f,h=!0;else if(n.endOnNext&&!h){const e=c.reduce((e,t)=>{if(t!==n.id){const r=l[t];if(r.class===n.class&&r.startDate>n.startDate&&(!e||n.startDate<e.startDate))return r}return e},null);e&&(d=e.startTime,h=!0)}const m=Object.keys(n.attr);for(let e=0;e<m.length;e++){const l=m[e];if(!Hk(l))continue;const c=o[l];if(c)!h||null!=i&&i.durationKnown?Math.abs(c.startTime-r)>.01&&(c.startTime=r,c.endTime=d):c.endTime=d;else if(a){let e=n.attr[l];Vk(l)&&(e=_D(e));const i=PG(a,r,d,{key:l,data:e},FO.dateRange);i&&(i.id=t,this.id3Track.addCue(i),o[l]=i,s&&("X-ASSET-LIST"!==l&&"X-ASSET-URL"!==l||i.addEventListener("enter",this.onEventCueEnter)))}}u[t]={cues:o,dateRange:n,durationKnown:h}}}}}class kG{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:i}=this.config;if(!r||1===i||!t.live)return;const s=this.targetLatency;if(null===s)return;const a=n-s;if(a<Math.min(this.maxLatency,s+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,i)),n=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,r=Math.min(t,Math.max(1,n));this.changeMediaPlaybackRate(e,r)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:i,liveSyncDurationCount:s,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&n||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==i?i:s*r);const c=r;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const n=this.levelDetails;if(null===n)return null;const r=n.edge,i=e-t-this.edgeStalled,s=r-n.totalduration,a=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(s,i),a)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(JP.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(JP.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(JP.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(JP.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===$P.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(n=this.levelDetails)&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&(null==(n=this.hls)||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(r=this.targetLatency)?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class FG extends UU{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.on(JP.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(JP.FRAG_BUFFERED,this.onFragBuffered,this),e.on(JP.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.off(JP.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(JP.FRAG_BUFFERED,this.onFragBuffered,this),e.off(JP.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],i={},s={};let a=!1,o=!1,l=!1;t.levels.forEach(e=>{const t=e.attrs;let{audioCodec:c,videoCodec:u}=e;c&&(e.audioCodec=c=EL(c,n)||void 0),u&&(u=e.videoCodec=function(e){const t=e.split(",");for(let e=0;e<t.length;e++){const n=t[e].split(".");n.length>2&&"avc1"===n[0]&&(t[e]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return t.join(",")}(u));const{width:h,height:d,unknownCodecs:f}=e;let p=f?f.length:0;if(f)for(let t=p;t--;){const n=f[t];this.isAudioSupported(n)?(e.audioCodec=c=c?`${c},${n}`:n,p--,hL.audio[c.substring(0,4)]=2):this.isVideoSupported(n)&&(e.videoCodec=u=u?`${u},${n}`:n,p--,hL.video[u.substring(0,4)]=2)}if(a||(a=!(!h||!d)),o||(o=!!u),l||(l=!!c),p||c&&!this.isAudioSupported(c)||u&&!this.isVideoSupported(u))return void this.log(`Some or all CODECS not supported "${t.CODECS}"`);const{CODECS:m,"FRAME-RATE":g,"HDCP-LEVEL":A,"PATHWAY-ID":v,RESOLUTION:y,"VIDEO-RANGE":E}=t,_=`${`${v||"."}-`}${e.bitrate}-${y}-${g}-${m}-${E}-${A}`;if(i[_])if(i[_].uri===e.url||e.attrs["PATHWAY-ID"])i[_].addGroupId("audio",t.AUDIO),i[_].addGroupId("text",t.SUBTITLES);else{const t=s[_]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const n=this.createLevel(e);i[_]=n,r.push(n)}else{const t=this.createLevel(e);i[_]=t,s[_]=1,r.push(t)}}),this.filterAndSortMediaOptions(r,t,a,o,l)}createLevel(e){const t=new UL(e),n=e.supplemental;if(null!=n&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const e=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(e.message),t.supportedResult=ML(e,[])}return t}isAudioSupported(e){return fL(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return fL(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,i){let s=[],a=[],o=e;if((n||r)&&i&&(o=o.filter(({videoCodec:e,videoRange:t,width:n,height:r})=>{return(!!e||!(!n||!r))&&(!!(i=t)&&LL.indexOf(i)>-1);var i})),0===o.length)return void Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",n=e;t.levels.length&&(n=`one or more CODECS in variant not supported: ${GL(t.levels.map(e=>e.attrs.CODECS).filter((e,t,n)=>n.indexOf(e)===t))}`,this.warn(n),e+=` (${n})`);const r=new Error(e);this.hls.trigger(JP.ERROR,{type:XP.MEDIA_ERROR,details:$P.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:r,reason:n})}});t.audioTracks&&(s=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec)),OG(s)),t.subtitles&&(a=t.subtitles,OG(a));const l=o.slice(0);o.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return LL.indexOf(e.videoRange)-LL.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const n=gL(e.videoCodec),r=gL(t.videoCodec);if(n!==r)return r-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const n=AL(e.codecSet),r=AL(t.codecSet);if(n!==r)return r-n}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let c=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let e=0;e<l.length;e++)if(l[e].pathwayId===o[0].pathwayId){c=l[e];break}this._levels=o;for(let e=0;e<o.length;e++)if(o[e]===c){var u;this._firstLevel=e;const t=c.bitrate,n=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${t}`),void 0===(null==(u=this.hls.userConfig)?void 0:u.abrEwmaDefaultEstimate)){const e=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);e>n&&n===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=e)}break}const h=i&&!r,d=this.hls.config,f=!(!d.audioStreamController||!d.audioTrackController),p={levels:o,audioTracks:s,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:r,altAudio:f&&!h&&s.some(e=>!!e.url)};this.hls.trigger(JP.MANIFEST_PARSED,p)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const n=new Error("invalid level idx"),r=e<0;if(this.hls.trigger(JP.ERROR,{type:XP.OTHER_ERROR,details:$P.LEVEL_SWITCH_ERROR,level:e,fatal:r,error:n,reason:n.message}),r)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,i=r?r.attrs["PATHWAY-ID"]:void 0,s=t[e],a=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,n===e&&r&&i===a)return;this.log(`Switching to level ${e} (${s.height?s.height+"p ":""}${s.videoRange?s.videoRange+" ":""}${s.codecSet?s.codecSet+" ":""}@${s.bitrate})${a?" with Pathway "+a:""} from level ${n}${i?" with Pathway "+i:""}`);const o={level:e,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(JP.LEVEL_SWITCHING,o);const l=s.details;if(!l||l.live){const e=this.switchParams(s.uri,null==r?void 0:r.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);this.steering.pathwayPriority=n}}onError(e,t){!t.fatal&&t.context&&t.context.type===eD&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===rD.MAIN){const e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const n=this._levels[t.level];null!=n&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:i}=t,s=t.levelInfo;var a;if(!s)return this.warn(`Invalid level index ${r}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(i.deltaUpdateFailed=!0));if(s===this.currentLevel||t.withoutMultiVariant){0===s.fragmentError&&(s.loadError=0);let e=s.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(r,t,e)}else null!=(n=t.deliveryDirectives)&&n.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],s=e.details,a=null==s?void 0:s.age;this.log(`Loading level index ${r}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${a&&s.live?" age "+a.toFixed(1)+(s.type&&" "+s.type||""):""} ${n}`),this.hls.trigger(JP.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const n=this._levels.filter((t,n)=>n!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));OF(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(JP.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(JP.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function OG(e){const t={};e.forEach(e=>{const n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}function UG(){return self.SourceBuffer||self.WebKitSourceBuffer}function NG(){if(!AD())return!1;const e=UG();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}function zG(){if(!NG())return!1;const e=AD();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(mL(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(mL(t,"audio"))))}class GG extends aO{constructor(e,t,n){super(e,t,n,"stream-controller",rD.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!YP(t))return;if(this.log(`Media seeked to ${t.toFixed(3)}`),!this.getBufferedFrag(t))return;const n=this.getFwdBufferInfoAtPos(e,t,rD.MAIN,0);null!==n&&0!==n.len?this.tick():this.warn(`Main forward buffer length at ${t} on "seeked" event ${n?n.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.on(JP.LEVEL_LOADING,this.onLevelLoading,this),e.on(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.on(JP.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(JP.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(JP.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(JP.BUFFER_CREATED,this.onBufferCreated,this),e.on(JP.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(JP.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(JP.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(JP.MANIFEST_PARSED,this.onManifestParsed,this),e.off(JP.LEVEL_LOADED,this.onLevelLoaded,this),e.off(JP.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(JP.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(JP.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(JP.BUFFER_CREATED,this.onBufferCreated,this),e.off(JP.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(JP.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(JP.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=r.startLevel;-1===e&&(r.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=r.firstAutoLevel),r.nextLoadLevel=e,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&-1===e&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=qF,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=KF}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case sO:{const{levels:e,level:t}=this,n=null==e?void 0:e[t],r=null==n?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=qF;break}if(this.hls.nextLoadLevel!==this.level){this.state=qF;break}break}case JF:this.checkRetryDate()}this.state===qF&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(null===t||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==n||!n[i])return;const s=n[i],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(JP.BUFFER_EOS,e),void(this.state=nO)}if(!this.buffering)return;e.loadLevel!==i&&-1===e.manualLevel&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const l=s.details;if(!l||this.state===sO||this.waitForLive(s))return this.level=i,this.state=sO,void(this.startFragRequested=!1);const c=a.len,u=this.getMaxBufferLength(s.maxBitrate);if(c>=u)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:a.end;let d=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&d&&FD(d)&&this.fragmentTracker.getState(d)!==mk){var f;const e=(null!=(f=this.backtrackFragment)?f:d).sn-l.startSN,t=l.fragments[e-1];t&&d.cc===t.cc&&(d=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(d&&this.isLoopLoading(d,h)){if(!d.gap){const e=this.audioOnly&&!this.altAudio?PD:DD,t=(e===DD?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,rD.MAIN)}d=this.getNextFragmentLoopLoading(d,l,a,rD.MAIN,u)}d&&(!d.initSegment||d.initSegment.data||this.bitrateTest||(d=d.initSegment),this.loadFragment(d,s,h))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===dk||r===pk?FD(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,rD.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const i=this.getLevelDetails();if(null!=i&&i.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*i.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],r=this.fragLastKbps;n=r&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*r)+1:0}else n=0;const s=this.getBufferedFrag(t.currentTime+n);if(s){const e=this.followingBufferedFrag(s);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,n=e.duration,r=Math.max(s.end,t+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case XF:case $F:case JF:case eO:case tO:this.state=qF}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;jF(n,"playing",this.onMediaPlaying),jF(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(WF(n,"playing",this.onMediaPlaying),WF(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(JP.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;for(let e=0;e<t.levels.length;e++){const i=t.levels[e].audioCodec;i&&(n=n||-1!==i.indexOf("mp4a.40.2"),r=r||-1!==i.indexOf("mp4a.40.5"))}this.audioCodecSwitch=n&&r&&!function(){var e;const t=UG();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==qF)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=sO)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:i}=this,s=t.level,a=t.details,o=a.totalduration;if(!r)return void this.warn(`Levels were reset while loading level ${s}`);this.log(`Level ${s} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${o}`);const l=t.levelInfo,c=this.fragCurrent;!c||this.state!==$F&&this.state!==JF||c.level!==t.level&&c.loader&&this.abortCurrentFrag();let u=0;if(a.live||null!=(n=l.details)&&n.live){var h;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,l.details,null==(h=this.levelLastLoaded)?void 0:h.details)}if(l.details=a,this.levelLastLoaded=l,i||this.setStartPosition(a,u),this.hls.trigger(JP.LEVEL_UPDATED,{details:a,level:s}),this.state===sO){if(this.waitForCdnTuneIn(a))return;this.state=qF}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,i=this.getLoadPosition(),s=e.fragmentStart,a=e.edge,o=i>=s-t.maxFragLookUpTolerance&&i<=a;if(null!==r&&n.duration>r&&(i<r||!o)){const s=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&n.readyState<4||i<a-s)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),"buffered"===this.config.liveSyncMode){var l;const e=Lk.bufferInfo(n,r,0);if(null==(l=e.buffered)||!l.length)return void(n.currentTime=r);if(e.start<=i)return void(n.currentTime=r);const{nextStart:t}=Lk.bufferedInfo(e.buffered,i,0);t&&(n.currentTime=t)}else n.currentTime=r}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:i}=e,{levels:s}=this;if(!s)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const a=s[n.level];if(!a)return void this.warn(`Level ${n.level} not found on progress`);const o=a.details;if(!o)return this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),void this.fragmentTracker.removeFragment(n);const l=a.videoCodec,c=o.PTSKnown||!o.live,u=null==(t=n.initSegment)?void 0:t.data,h=this._getAudioCodec(a),d=this.transmuxer=this.transmuxer||new FU(this.hls,rD.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=r?r.index:-1,p=-1!==f,m=new Pk(n.level,n.sn,n.stats.chunkCount,i.byteLength,f,p),g=this.initPTS[n.cc];d.push(i,u,h,l,n,r,o.totalduration,c,m,g)}onAudioTrackSwitching(e,t){const n=this.hls,r=2===this.altAudio;if(qL(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r)return this.fragmentTracker.removeAllFragments(),n.once(JP.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(JP.AUDIO_TRACK_SWITCHED,t)}),void n.trigger(JP.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});n.trigger(JP.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=qL(t.url,this.hls);if(n){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,i,s=!1;for(const e in n){const t=n[e];if("main"===t.id){if(i=e,r=t,"video"===e){const t=n[e];t&&(this.videoBuffer=t.buffer)}}else s=!0}s&&r?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,i=n.type===rD.MAIN;if(i){if(this.fragContextChanged(n))return this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===tO&&(this.state=qF));const e=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),FD(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const s=this.media;s&&(!this._hasEnoughToStart&&Lk.getBuffered(s).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal)this.state=rO;else switch(t.details){case $P.FRAG_GAP:case $P.FRAG_PARSING_ERROR:case $P.FRAG_DECRYPT_ERROR:case $P.FRAG_LOAD_ERROR:case $P.FRAG_LOAD_TIMEOUT:case $P.KEY_LOAD_ERROR:case $P.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(rD.MAIN,t);break;case $P.LEVEL_LOAD_ERROR:case $P.LEVEL_LOAD_TIMEOUT:case $P.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==sO||(null==(n=t.context)?void 0:n.type)!==eD||(this.state=qF);break;case $P.BUFFER_ADD_CODEC_ERROR:case $P.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case $P.BUFFER_FULL_ERROR:if("main"!==t.parent)return;if(this.reduceLengthAndFlushBuffer(t)){!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case $P.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=qF,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==PD||!this.altAudio){const e=(t===DD?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,t,rD.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log(`could not seek to ${n}, already seeking at ${t}`);const r=this.timelineOffset;r&&n&&(n+=r);const i=this.getLevelDetails(),s=Lk.getBuffered(e),a=s.length?s.start(0):0,o=a-n,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==i?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${o} to match buffer start`),n+=o,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${a}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{const{hls:n}=this,r=null==e?void 0:e.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=qF,this.startFragRequested=!1,this.bitrateTest=!1;const i=r.stats;i.parsing.start=i.parsing.end=i.buffering.start=i.buffering.end=self.performance.now(),n.trigger(JP.FRAG_LOADED,e),r.bitrateTest=!1}).catch(t=>{this.state!==KF&&this.state!==rO&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:i}=e,s=this.getCurrentContext(i);if(!s)return void this.resetWhenMissingContext(i);const{frag:a,part:o,level:l}=s,{video:c,text:u,id3:h,initSegment:d}=r,{details:f}=l,p=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=eO,d){const e=d.tracks;if(e){const r=a.initSegment||a;if(this.unhandledEncryptionError(d,a))return;this._bufferInitSegment(l,e,r,i),n.trigger(JP.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:t,tracks:e})}const r=d.initPTS,s=d.timescale,o=this.initPTS[a.cc];if(YP(r)&&(!o||o.baseTime!==r||o.timescale!==s)){const e=d.trackId;this.initPTS[a.cc]={baseTime:r,timescale:s,trackId:e},n.trigger(JP.INIT_PTS_FOUND,{frag:a,id:t,initPTS:r,timescale:s,trackId:e})}}if(c&&f){p&&"audiovideo"===c.type&&this.logMuxedErr(a);const e=f.fragments[a.sn-1-f.startSN],t=a.sn===f.startSN,n=!e||a.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:r,startDTS:s,endDTS:l}=c;if(o)o.elementaryStreams[c.type]={startPTS:e,endPTS:r,startDTS:s,endDTS:l};else if(c.firstKeyFrame&&c.independent&&1===i.id&&!n&&(this.couldBacktrack=!0),c.dropped&&c.independent){const i=this.getMainFwdBufferInfo(),s=(i?i.end:this.getLoadPosition())+this.config.maxBufferHole,o=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&s<o-this.config.maxBufferHole&&!n)return void this.backtrack(a);n&&(a.gap=!0),a.setElementaryStreamInfo(c.type,a.start,r,a.start,l,!0)}else t&&e-(f.appliedTimelineOffset||0)>2&&(a.gap=!0);a.setElementaryStreamInfo(c.type,e,r,s,l),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,o,i,t||n)}else{if(!t&&!n)return void this.backtrack(a);a.gap=!0}}if(p){const{startPTS:e,endPTS:t,startDTS:n,endDTS:r}=p;o&&(o.elementaryStreams[PD]={startPTS:e,endPTS:t,startDTS:n,endDTS:r}),a.setElementaryStreamInfo(PD,e,t,n,r),this.bufferFragmentData(p,a,o,i)}if(f&&null!=h&&h.samples.length){const e={id:t,frag:a,details:f,samples:h.samples};n.trigger(JP.FRAG_PARSING_METADATA,e)}if(f&&u){const e={id:t,frag:a,details:f,samples:u.samples};n.trigger(JP.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn(`${FD(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,r){if(this.state!==eO)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:i,video:s,audiovideo:a}=t;if(i){const n=e.audioCodec;let r=_L(i.codec,n);"mp4a"===r&&(r="mp4a.40.5");const s=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){r&&(r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=i.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===s.indexOf("firefox")&&(r="mp4a.40.5")}r&&-1!==r.indexOf("mp4a.40.5")&&-1!==s.indexOf("android")&&"audio/mpeg"!==i.container&&(r="mp4a.40.2",this.log(`Android: force audio codec to ${r}`)),n&&n!==r&&this.log(`Swapping manifest audio codec "${n}" for "${r}"`),i.levelCodec=r,i.id=rD.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${r||""}/${n||""}/${i.codec}]`),delete t.audiovideo}if(s){s.levelCodec=e.videoCodec,s.id=rD.MAIN;const n=s.codec;if(4===(null==n?void 0:n.length))switch(n){case"hvc1":case"hev1":s.codec="hvc1.1.6.L120.90";break;case"av01":s.codec="av01.0.04M.08";break;case"avc1":s.codec="avc1.42e01e"}this.log(`Init video buffer, container:${s.container}, codecs[level/parsed]=[${e.videoCodec||""}/${n}]${s.codec!==n?" parsed-corrected="+s.codec:""}${s.supplemental?" supplemental="+s.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(JP.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{const i=t[e].initSegment;null!=i&&i.byteLength&&this.hls.trigger(JP.BUFFER_APPENDING,{type:e,data:i,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,rD.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=null==e?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=qF}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const n=e.currentTime;if(Lk.isBuffered(e,n)?t=this.getAppendedFrag(n):Lk.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,n=t.level;e&&t.sn===e.sn&&e.level===n||(this.fragPlaying=t,this.hls.trigger(JP.FRAG_CHANGED,{frag:t}),e&&e.level===n||this.hls.trigger(JP.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return YP(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(YP(t)){const e=this.getLevelDetails(),n=this.currentFrag||(e?JL(null,e.fragments,t):null);if(n){const e=n.programDateTime;if(null!==e){const r=e+1e3*(t-n.start);return new Date(r)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class QG extends uD{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[n].loader;if(r){var t;if(e&&e!==(null==(t=r.context)?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=$P.KEY_LOAD_ERROR,n,r,i){return new Rk({type:XP.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:n,networkDetails:r})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,i=t.length;r<i;r++){const s=t[r];if(e.cc<=s.cc&&(!FD(e)||!FD(s)||e.sn<s.sn)||!n&&r==i-1)return this.emeController.selectKeySystemFormat(s).then(e=>{if(!this.emeController)return;s.setKeyFormat(e);const t=rF(e);return t?this.emeController.getKeySystemAccess([t]):void 0})}if(this.config.requireKeySystemAccessOnStart){const e=sF(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const n=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,$P.KEY_LOAD_ERROR,n))}const s=i.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,$P.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${s}"`)));const a=HG(i);let o=this.keyIdToKeyInfo[a];if(null!=(n=o)&&n.decryptdata.key)return i.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(null!=(r=o)&&r.keyLoadPromise){var l;switch(null==(l=o.mediaKeySessionContext)?void 0:l.keyStatus){case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>{const{keyInfo:n}=t;return i.key=n.decryptdata.key,{frag:e,keyInfo:n}})}}switch(this.log(`Loading key ${ED(i.keyId||[])} from ${e.type} ${e.level}`),o=this.keyIdToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,$P.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(n);return(e.keyLoadPromise=r.then(t=>(e.mediaKeySessionContext=t,n))).catch(n=>{throw e.keyLoadPromise=null,n.data&&(n.data.frag=t),n})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=new(0,n.loader)(n);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((i,s)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=n.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{const{frag:a,keyInfo:o,url:l}=n,c=HG(o.decryptdata)||l;if(!a.decryptdata||o!==this.keyIdToKeyInfo[c])return s(this.createKeyLoadError(a,$P.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,i({frag:a,keyInfo:o})},onError:(e,n,r,i)=>{this.resetLoader(n),s(this.createKeyLoadError(t,$P.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),r,cD({url:a.url,data:void 0},e)))},onTimeout:(e,n,r)=>{this.resetLoader(n),s(this.createKeyLoadError(t,$P.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:(e,n,r)=>{this.resetLoader(n),s(this.createKeyLoadError(t,$P.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};r.load(a,l,c)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,i=n.loader;t.keyLoader===i&&(t.keyLoader=null,n.loader=null);const s=HG(n.decryptdata)||r;delete this.keyIdToKeyInfo[s],i&&i.destroy()}}function HG(e){const t=e.keyId;return t?ED(t):e.uri}function VG(e){const{type:t}=e;switch(t){case tD:return rD.AUDIO;case nD:return rD.SUBTITLE;default:return rD.MAIN}}function jG(e,t){let n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}class WG{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.on(JP.LEVEL_LOADING,this.onLevelLoading,this),e.on(JP.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(JP.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(JP.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(JP.MANIFEST_LOADING,this.onManifestLoading,this),e.off(JP.LEVEL_LOADING,this.onLevelLoading,this),e.off(JP.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(JP.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(JP.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return this.loaders[e.type]=i,i}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ZP,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:i,url:s,deliveryDirectives:a,levelInfo:o}=t;this.load({id:n,level:r,pathwayId:i,responseType:"text",type:eD,url:s,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:i,deliveryDirectives:s,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:tD,url:i,deliveryDirectives:s,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:i,deliveryDirectives:s,track:a}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:nD,url:i,deliveryDirectives:s,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[eD];if(n){const e=n.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(n.abort(),delete this.loaders[eD])}}load(e){var t;const n=this.hls.config;let r,i=this.getInternalLoader(e);if(i){const t=this.hls.logger,n=i.context;if(n&&n.levelOrTrack===e.levelOrTrack&&(n.url===e.url||n.deliveryDirectives&&!e.deliveryDirectives))return void(n.url===e.url?t.log(`[playlist-loader]: ignore ${e.url} ongoing request`):t.log(`[playlist-loader]: ignore ${e.url} in favor of ${n.url}`));t.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}if(r=e.type===ZP?n.manifestLoadPolicy.default:oD({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),YP(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===eD&&null!==e.level?t=this.hls.levels[e.level].details:e.type===tD&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===nD&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,n=t.targetduration;if(e&&n){const t=1e3*Math.max(3*e,.8*n);r=oD({},r,{maxTimeToFirstByteMs:Math.min(t,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,r.maxTimeToFirstByteMs)})}}}const s=r.errorRetry||r.timeoutRetry||{},a={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},o={onSuccess:(e,t,n,r)=>{const i=this.getInternalLoader(n);this.resetInternalLoader(n.type);const s=e.data;0===s.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),mF.isMediaPlaylist(s)||n.type!==ZP?this.handleTrackOrLevelPlaylist(e,t,n,r||null,i):this.handleMasterPlaylist(e,t,n,r)):this.handleManifestParsingError(e,n,new Error("no EXTM3U delimiter"),r||null,t)},onError:(e,t,n,r)=>{this.handleNetworkError(t,n,!1,e,r)},onTimeout:(e,t,n)=>{this.handleNetworkError(t,n,!0,void 0,e)}};i.load(e,a,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const i=this.hls,s=e.data,a=jG(e,n),o=mF.parseMasterPlaylist(s,a);if(o.playlistParsingError)return void this.handleManifestParsingError(e,n,o.playlistParsingError,r,t);const{contentSteering:l,levels:c,sessionData:u,sessionKeys:h,startTimeOffset:d,variableList:f}=o;this.variableList=f;const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":g}=mF.parseMasterPlaylistMedia(s,a,o);if(p.length){p.some(e=>!e.url)||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Qk({}),bitrate:0,url:""}))}i.trigger(JP.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:m,captions:g,contentSteering:l,url:a,stats:t,networkDetails:r,sessionData:u,sessionKeys:h,startTimeOffset:d,variableList:f})}handleTrackOrLevelPlaylist(e,t,n,r,i){const s=this.hls,{id:a,level:o,type:l}=n,c=jG(e,n),u=YP(o)?o:YP(a)?a:0,h=VG(n),d=mF.parseLevelPlaylist(e.data,c,u,h,0,this.variableList);if(l===ZP){const e={attrs:new Qk({}),bitrate:0,details:d,name:"",url:c};d.requestScheduled=t.loading.start+DF(d,0),s.trigger(JP.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=d,this.handlePlaylistLoaded(d,e,t,n,r,i)}handleManifestParsingError(e,t,n,r,i){this.hls.trigger(JP.ERROR,{type:XP.NETWORK_ERROR,details:$P.MANIFEST_PARSING_ERROR,fatal:t.type===ZP,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:i})}handleNetworkError(e,t,n=!1,r,i){let s=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===eD?s+=`: ${e.level} id: ${e.id}`:e.type!==tD&&e.type!==nD||(s+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(s);this.hls.logger.warn(`[playlist-loader]: ${s}`);let o=$P.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case ZP:o=n?$P.MANIFEST_LOAD_TIMEOUT:$P.MANIFEST_LOAD_ERROR,l=!0;break;case eD:o=n?$P.LEVEL_LOAD_TIMEOUT:$P.LEVEL_LOAD_ERROR,l=!1;break;case tD:o=n?$P.AUDIO_TRACK_LOAD_TIMEOUT:$P.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case nD:o=n?$P.SUBTITLE_TRACK_LOAD_TIMEOUT:$P.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const u={type:XP.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:i};if(r){const n=(null==t?void 0:t.url)||e.url;u.response=cD({url:n,data:void 0},r)}this.hls.trigger(JP.ERROR,u)}handlePlaylistLoaded(e,t,n,r,i,s){const a=this.hls,{type:o,level:l,id:c,groupId:u,deliveryDirectives:h}=r,d=jG(t,r),f=VG(r),p="number"==typeof r.level&&f===rD.MAIN?l:void 0;if(!e.fragments.length){const s=e.playlistParsingError=new Error("No Segments found in Playlist");return void a.trigger(JP.ERROR,{type:XP.NETWORK_ERROR,details:$P.LEVEL_EMPTY_ERROR,fatal:!1,url:d,error:s,reason:s.message,response:t,context:r,level:p,parent:f,networkDetails:i,stats:n})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const m=e.playlistParsingError;if(m){if(this.hls.logger.warn(`${m} ${e.url}`),!a.config.ignorePlaylistParsingErrors)return void a.trigger(JP.ERROR,{type:XP.NETWORK_ERROR,details:$P.LEVEL_PARSING_ERROR,fatal:!1,url:d,error:m,reason:m.message,response:t,context:r,level:p,parent:f,networkDetails:i,stats:n});e.playlistParsingError=null}switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case ZP:case eD:a.trigger(JP.LEVEL_LOADED,{details:e,levelInfo:r.levelOrTrack||a.levels[0],level:p||0,id:c||0,stats:n,networkDetails:i,deliveryDirectives:h,withoutMultiVariant:o===ZP});break;case tD:a.trigger(JP.AUDIO_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:c||0,groupId:u||"",stats:n,networkDetails:i,deliveryDirectives:h});break;case nD:a.trigger(JP.SUBTITLE_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:c||0,groupId:u||"",stats:n,networkDetails:i,deliveryDirectives:h})}}}class YG{static get version(){return fO}static isMSESupported(){return NG()}static isSupported(){return zG()}static getMediaSource(){return AD()}static get Events(){return JP}static get MetadataSchema(){return FO}static get ErrorTypes(){return XP}static get ErrorDetails(){return $P}static get DefaultConfig(){return YG.defaultConfig?YG.defaultConfig:wG}static set DefaultConfig(e){YG.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new dO,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,n){const r=fD();if("object"==typeof console&&!0===e||"object"==typeof e){const i=["debug","log","info","warn","error"];i.forEach(t=>{r[t]=pD(t,e,n)});try{r.log(`Debug logs enabled for "${t}" in hls.js version 1.6.11`)}catch(e){return fD()}i.forEach(t=>{mD[t]=pD(t,e)})}else oD(mD,r);return r}(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=function(e,t,n){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=CG(e),i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{const s=`${"level"===e?"playlist":e}LoadPolicy`,a=void 0===t[s],o=[];i.forEach(n=>{const i=`${e}Loading${n}`,l=t[i];if(void 0!==l&&a){o.push(i);const e=r[s].default;switch(t[s]={default:e},n){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&n.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${s}": ${GL(t[s])}`)}),cD(cD({},r),t)}(YG.DefaultConfig,e,t);this.userConfig=e,n.progressive&&function(e,t){const n=e.loader;n!==EG&&n!==SG?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):vG()&&(e.loader=EG,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}(n,t);const{abrController:r,bufferController:i,capLevelController:s,errorController:a,fpsController:o}=n,l=new a(this),c=this.abrController=new r(this),u=new gk(this),h=n.interstitialsController,d=h?this.interstitialsController=new h(this,YG):null,f=this.bufferController=new i(this,u),p=this.capLevelController=new s(this),m=new o(this),g=new WG(this),A=n.contentSteeringController,v=A?new A(this):null,y=this.levelController=new FG(this,v),E=new LG(this),_=new QG(this.config,this.logger),x=this.streamController=new GG(this,u,_),b=this.gapController=new TG(this,u);p.setStreamController(x),m.setStreamController(x);const S=[g,y,x];d&&S.splice(1,0,d),v&&S.splice(1,0,v),this.networkControllers=S;const w=[c,f,b,p,m,E,u];this.audioTrackController=this.createController(n.audioTrackController,S);const C=n.audioStreamController;C&&S.push(this.audioStreamController=new C(this,u,_)),this.subtitleTrackController=this.createController(n.subtitleTrackController,S);const T=n.subtitleStreamController;T&&S.push(this.subtititleStreamController=new T(this,u,_)),this.createController(n.timelineController,w),_.emeController=this.emeController=this.createController(n.emeController,w),this.cmcdController=this.createController(n.cmcdController,w),this.latencyController=this.createController(kG,w),this.coreComponents=w,S.push(l);const M=l.onErrorOut;"function"==typeof M&&this.on(JP.ERROR,M,l),this.on(JP.MANIFEST_LOADED,g.onManifestLoaded,g)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,r){this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;const n=e===JP.ERROR;this.trigger(JP.ERROR,{type:XP.OTHER_ERROR,details:$P.INTERNAL_EXCEPTION,fatal:n,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(JP.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error(`attachMedia failed: invalid argument (${e})`);return void this.trigger(JP.ERROR,{type:XP.OTHER_ERROR,details:$P.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(JP.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(JP.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(JP.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=RD.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(JP.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),this.started&&this.networkControllers);n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[rD.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[rD.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[rD.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();const n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return n}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return DL.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(r=-1===t&&null!=e&&e.length?e.length-1:t,n)for(let t=r;t--;){const r=e[t].attrs["HDCP-LEVEL"];if(r&&r<=n)return t}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){return RL(e,HL(t),navigator.mediaCapabilities)}}YG.defaultConfig=void 0;var KG=Object.freeze({__proto__:null,AbrController:XL,AttrList:Qk,AudioStreamController:OU,AudioTrackController:QU,BasePlaylistController:UU,BaseSegment:kD,BaseStreamController:aO,BufferController:YU,CMCDController:VN,CapLevelController:XU,ChunkMetadata:Pk,ContentSteeringController:jN,Cues:AG,DateRange:jk,EMEController:KN,ErrorActionFlags:ck,ErrorController:uk,ErrorDetails:$P,ErrorTypes:XP,Events:JP,FPSController:$N,FetchLoader:EG,Fragment:OD,Hls:YG,HlsSkip:kL,HlsUrlParameters:OL,KeySystemFormats:nF,KeySystems:tF,Level:UL,LevelDetails:Wk,LevelKey:cF,LoadStats:BD,M3U8Parser:mF,MetadataSchema:FO,NetworkErrorAction:lk,Part:UD,PlaylistLevelType:rD,SubtitleStreamController:yz,SubtitleTrackController:rz,TimelineController:dG,XhrLoader:SG,default:YG,fetchSupported:vG,getMediaSource:AD,isMSESupported:NG,isSupported:zG,requestMediaKeySystemAccess:aF});const qG=((e,t)=>"undefined"!=typeof window&&"function"==typeof(null==(e=window.document)?void 0:e.createElement)&&"string"==typeof(null==(t=window.navigator)?void 0:t.userAgent))();let XG=null;async function $G(...e){var t;null!==(t=XG)&&void 0!==t||(XG=await Promise.resolve().then(function(){return KG}));const n=XG.default;return n.isSupported()?new n(...e):null}function JG(e,{unsuspend:t="loadedmetadata",start:n=!0,hls:i={},crossOrigin:a="anonymous",muted:o=!0,loop:l=!0,playsInline:c=!0,onVideoFrame:u,...h}={}){const d=zp(e=>e.gl),f=r(null),p=ff(()=>new Promise(async n=>{let r,s;"string"==typeof e?r=e:s=e;const u=Object.assign(document.createElement("video"),{src:r,srcObject:s,crossOrigin:a,loop:l,muted:o,playsInline:c,...h});if(r&&qG&&r.endsWith(".m3u8")){const e=f.current=await $G(i);e&&(e.on(JP.MEDIA_ATTACHED,()=>{e.loadSource(r)}),e.attachMedia(u))}const p=new nc(u);"colorSpace"in p?p.colorSpace=d.outputColorSpace:p.encoding=d.outputEncoding,u.addEventListener(t,()=>n(p))}),[e]),m=p.source.data;return eQ(m,u),s(()=>(n&&p.image.play(),()=>{f.current&&(f.current.destroy(),f.current=null)}),[p,n]),p}const ZG=c(({children:t,src:n,...r},i)=>{const a=JG(n,r);return s(()=>()=>{a.dispose()},[a]),f(i,()=>a,[a]),e.createElement(e.Fragment,null,null==t?void 0:t(a))}),eQ=(e,t)=>{s(()=>{if(!t)return;if(!e.requestVideoFrameCallback)return;let n;const r=(...i)=>{t(...i),n=e.requestVideoFrameCallback(r)};return e.requestVideoFrameCallback(r),()=>e.cancelVideoFrameCallback(n)},[e,t])},tQ=(e,t)=>{if(Array.isArray(e))return e[0];return e[null!=t?t:Object.keys(e)[0]][0]},nQ=e=>{for(let t=3;t<e.length;t+=4)if(0!==e[t])return!1;return!0};function rQ(t,n,r,i,s,a){const l=e.useRef(zp(e=>e.viewport)),c=e.useRef(null),u=e.useRef(0),h=e.useRef(t),d=e.useRef(n),f=e.useRef(r),[p,m]=o(null),[g,A]=e.useState(new Cn),v=e.useMemo(()=>new ph,[]),[y,E]=o(null),_=e.useCallback((e,t,n)=>{const r=t*(l.current.aspect>e/t?l.current.width/e:l.current.height/t),i=e*(l.current.aspect>e/t?l.current.width/e:l.current.height/t)*n,s=r*n;let a=Math.min(1,i),o=Math.min(1,s);return i>1&&(a=1,o=s/i*1),new Dn(a,o,1)},[]),x=e.useCallback((e,t)=>{if(e.image){const n=document.createElement("canvas"),r=n.getContext("2d",a);if(!r)throw new Error("Failed to get 2d context");n.width=e.image.width,n.height=e.image.height,r.drawImage(e.image,0,0);const i=e.image.width,s=e.image.height,o=Math.round(Math.sqrt(t*(i/s))),l=Math.round(t/o),c=i/o,u=s/l,h=[];for(let e=0;e<l;e++)for(let n=0;n<o;n++){if(e*o+n>=t){h.push({row:e,col:n});continue}const i=r.getImageData(n*c,e*u,c,u).data;nQ(i)&&h.push({row:e,col:n})}return{rows:l,columns:o,frameWidth:c,frameHeight:u,emptyFrames:h}}return{rows:0,columns:0,frameWidth:0,frameHeight:0,emptyFrames:[]}},[a]),b=e.useCallback(e=>{const t=e=>{let t=null;for(const n of e){const{w:e,h:r}=n.frame,i=e*r;(!t||i>t.area)&&(t={w:e,h:r,area:i})}const n=e.map(e=>{const{w:n,h:r}=e.frame,i=n*r,s=t?i===t.area?1:Math.sqrt(i/t.area):1;return{...e,scaleRatio:s}});return n};if(Array.isArray(e))return t(e);{const n={};for(const r in e)n[r]=t(e[r]);return n}},[]),S=e.useCallback(()=>{const e={},t=c.current,n=f.current;if(t){if(n&&Array.isArray(t.frames)){for(let r=0;r<n.length;r++){e[n[r]]=[];for(const i of t.frames){const t=i.frame,s=i.sourceSize.w,a=i.sourceSize.h;"string"==typeof i.filename&&-1!==i.filename.toLowerCase().indexOf(n[r].toLowerCase())&&e[n[r]].push({...i,frame:t,sourceSize:{w:s,h:a}})}}for(const t in e){const n=b(e[t]);Array.isArray(n)&&(e[t]=n)}return e}if(n&&"object"==typeof t.frames){for(let r=0;r<n.length;r++){e[n[r]]=[];for(const i in t.frames){const s=t.frames[i],a=s.frame,o=s.sourceSize.w,l=s.sourceSize.h;"string"==typeof i&&-1!==i.toLowerCase().indexOf(n[r].toLowerCase())&&e[n[r]].push({...s,frame:a,sourceSize:{w:o,h:l}})}}for(const t in e){const n=b(e[t]);Array.isArray(n)&&(e[t]=n)}return e}{let e=[];return null!=t&&t.frames&&(e=Array.isArray(t.frames)?t.frames.map(e=>({...e,x:e.frame.x,y:e.frame.y,w:e.frame.w,h:e.frame.h})):Object.values(t.frames).flat().map(e=>({...e,x:e.frame.x,y:e.frame.y,w:e.frame.w,h:e.frame.h}))),b(e)}}return[]},[b,c]),w=e.useCallback((e,t)=>{let n=new Dn(1,1,1);if(null===e){if(t&&i){const e=t.image.width,r=t.image.height;u.current=i;const{rows:s,columns:a,frameWidth:o,frameHeight:l,emptyFrames:h}=x(t,i),d={frames:[],meta:{version:"1.0",size:{w:e,h:r},rows:s,columns:a,frameWidth:o,frameHeight:l,scale:"1"}};for(let e=0;e<s;e++)for(let t=0;t<a;t++){(null!=h?h:[]).some(n=>n.row===e&&n.col===t)||Array.isArray(d.frames)&&d.frames.push({frame:{x:t*o,y:e*l,w:o,h:l},scaleRatio:1,rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:o,h:l},sourceSize:{w:o,h:l}})}n=_(o,l,.1),c.current=d}c.current&&c.current.frames&&(c.current.frames=b(c.current.frames))}else if(t){c.current=e,c.current.frames=S(),u.current=Array.isArray(e.frames)?e.frames.length:Object.keys(e.frames).length;const{w:t,h:r}=tQ(e.frames).sourceSize;n=_(t,r,.1)}m(c.current),"encoding"in t?t.encoding=3001:"colorSpace"in t&&(t.colorSpace=gt),A(t),E({spriteTexture:t,spriteData:c.current,aspect:n})},[x,i,S,_,b]),C=e.useCallback((e,t,n)=>{const r=fetch(e).then(e=>e.json()),i=new Promise(e=>{v.load(t,e)});Promise.all([r,i]).then(e=>{n(e[0],e[1])})},[v]),T=e.useCallback(e=>{if(!e&&!h.current)throw new Error("Either textureUrl or input must be provided");const t=null!=e?e:h.current;if(!t)throw new Error("A valid texture URL must be provided");v.load(t,e=>w(null,e))},[v,w]),M=e.useCallback((e,t)=>{t&&e?C(t,e,w):T(e)},[C,T,w]);return e.useLayoutEffect(()=>{d.current&&h.current?C(d.current,h.current,w):h.current&&T();const e=h.current;return()=>{e&&jp.clear(ph,e)}},[C,T,w]),e.useLayoutEffect(()=>{null==s||s(g,null!=p?p:null)},[g,p,s]),{spriteObj:y,loadJsonAndTexture:M}}function iQ(t,n,...r){const i=e.useRef(),s=zp(e=>e.scene);return e.useLayoutEffect(()=>{let e;if(t&&null!=t&&t.current&&n&&(i.current=e=new n(t.current,...r)),e)return e.traverse(e=>e.raycast=()=>null),s.add(e),()=>{i.current=void 0,s.remove(e),null==e.dispose||e.dispose()}},[s,n,t,...r]),Gp(()=>{var e;null==(e=i.current)||null==e.update||e.update()}),i}rQ.preload=e=>jp.preload(ph,e),rQ.clear=e=>jp.clear(ph,e);const sQ=({type:t,args:n=[]})=>{const r=e.useRef(null),i=e.useRef(null);return e.useLayoutEffect(()=>{i.current=r.current.parent}),iQ(i,t,...n),e.createElement("object3D",{ref:r})};var aQ,oQ={exports:{}};var lQ=(aQ||(aQ=1,oQ.exports=function(){var e=function(){function t(e){return i.appendChild(e.dom),e}function n(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),n(++r%i.children.length)},!1);var s=(performance||Date).now(),a=s,o=0,l=t(new e.Panel("FPS","#0ff","#002")),c=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(c.update(e-s,200),e>a+1e3&&(l.update(1e3*o/(e-a),100),a=e,o=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:i,setMode:n}};return e.Panel=function(e,t,n){var r=1/0,i=0,s=Math.round,a=s(window.devicePixelRatio||1),o=80*a,l=48*a,c=3*a,u=2*a,h=3*a,d=15*a,f=74*a,p=30*a,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,o,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(h,d,f,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,f,p),{dom:m,update:function(l,A){r=Math.min(r,l),i=Math.max(i,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,o,d),g.fillStyle=t,g.fillText(s(l)+" "+e+" ("+s(r)+"-"+s(i)+")",c,u),g.drawImage(m,h+a,d,f-a,p,h,d,f-a,p),g.fillRect(h+f-a,d,a,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+f-a,d,a,s((1-l/A)*p))}}},e}()),oQ.exports),cQ=Jd(lQ);function uQ(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function hQ({showPanel:t=0,className:n,parent:r}){const i=function(t,n=[],r){const[i,s]=e.useState();return e.useLayoutEffect(()=>{const e=t();return s(e),uQ(r,e),()=>uQ(r,null)},n),i}(()=>new cQ,[]);return e.useEffect(()=>{if(i){const e=r&&r.current||document.body;i.showPanel(t),null==e||e.appendChild(i.dom);const s=(null!=n?n:"").split(" ").filter(e=>e);s.length&&i.dom.classList.add(...s);const a=Rp(()=>i.begin()),o=Bp(()=>i.end());return()=>{s.length&&i.dom.classList.remove(...s),null==e||e.removeChild(i.dom),a(),o()}}},[r,i,n,t]),null}const dQ=class e{constructor({trackGPU:t=!1,logsPerSecond:n=30,samplesLog:r=60,samplesGraph:i=10,precision:s=2,minimal:a=!1,horizontal:o=!0,mode:l=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frames=0,this.renderCount=0,this.isRunningCPUProfiling=!1,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.handleClick=e=>{e.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)},this.mode=l,this.horizontal=o,this.minimal=a,this.trackGPU=t,this.samplesLog=r,this.samplesGraph=i,this.precision=s,this.logsPerSecond=n,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.fpsPanel=this.addPanel(new e.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new e.Panel("CPU","#0f0","#020"),1),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`\n      position: fixed;\n      top: 0;\n      left: 0;\n      opacity: 0.9;\n      z-index: 10000;\n      ${this.minimal?"cursor: pointer;":""}\n    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){e&&(this.handleThreeRenderer(e)||await this.handleWebGPURenderer(e)||this.initializeWebGL(e))}handleThreeRenderer(e){return!(!e.isWebGLRenderer||this.threeRendererPatched)&&(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0)}async handleWebGPURenderer(e){return!!e.isWebGPURenderer&&(this.trackGPU&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=e.info,!0)}initializeWebGPUPanels(){this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new e.Panel("CPT","#e1e1e1","#212121"),3)}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else{if(!(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas))return!1;if(this.gl=e.getContext("webgl2"),!this.gl)return!1}return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2)))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),this.gl&&this.ext&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}update(){this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu)}resetCounters(){this.renderCount=0,0===this.totalCpuDuration&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++){this.dom.children[t].style.display=t===e?"block":"none"}this.mode=e}processGpuQueries(){this.gl&&this.ext&&(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){const n=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(n&&!r){const n=1e-6*this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT);this.totalGpuDuration+=n,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}endInternal(){this.frames++;const e=(performance||Date).now(),t=e-this.prevTime;if(e>=this.prevCpuTime+1e3/this.logsPerSecond){const n=Math.round(1e3*this.frames/t);this.addToAverage(n,this.averageFps),this.updatePanel(this.fpsPanel,this.averageFps,0),this.updatePanel(this.msPanel,this.averageCpu,this.precision),this.updatePanel(this.gpuPanel,this.averageGpu,this.precision),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.frames=0,this.prevCpuTime=e,this.prevTime=e}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,n){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);const r=performance.measure(n,e,t);this.totalCpuDuration+=r.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t,n=2){if(t.logs.length>0){let r=0,i=.01;for(let e=0;e<t.logs.length;e++)r+=t.logs[e],t.logs[e]>i&&(i=t.logs[e]);let s=0,a=.01;for(let e=0;e<t.graph.length;e++)s+=t.graph[e],t.graph[e]>a&&(a=t.graph[e]);e&&e.update(r/Math.min(t.logs.length,this.samplesLog),s/Math.min(t.graph.length,this.samplesGraph),i,a,n)}}get domElement(){return this.dom}patchThreeRenderer(e){const t=e.render,n=this;e.render=function(e,r){n.begin(),t.call(this,e,r),n.end()},this.threeRendererPatched=!0}};dQ.Panel=class{constructor(e,t,n){this.name=e,this.fg=t,this.bg=n,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){if(!this.context)throw new Error("No context");const e=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT);let t;const n=this.fg;switch(this.fg.toLowerCase()){case"#0ff":t="#006666";break;case"#0f0":t="#006600";break;case"#ff0":t="#666600";break;case"#e1e1e1":t="#666666";break;default:t=this.bg}return e.addColorStop(0,t),e.addColorStop(1,n),e}initializeCanvas(){this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.fg,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,n,r,i=0){if(!this.context||!this.gradient)return;const s=Math.min(1/0,e),a=Math.max(n,e);r=Math.max(r,t),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(i)} ${this.name} (${s.toFixed(i)}-${parseFloat(a.toFixed(i))})`,this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT);const o=this.GRAPH_HEIGHT-(1-t/r)*this.GRAPH_HEIGHT;o>0&&(this.context.globalAlpha=1,this.context.fillStyle=this.gradient,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y+this.GRAPH_HEIGHT-o,this.PR,o))}};let fQ=dQ;const pQ=e.forwardRef(function({className:t,parent:n,id:r,clearStatsGlStyle:i,...s},a){const o=zp(e=>e.gl),l=e.useMemo(()=>{const e=new fQ({...s});return e.init(o),e},[o]);return e.useImperativeHandle(a,()=>l.domElement,[l]),e.useEffect(()=>{if(l){const e=n&&n.current||document.body;null==e||e.appendChild(l.domElement),l.domElement.querySelectorAll("canvas").forEach(e=>{e.style.removeProperty("position")}),r&&(l.domElement.id=r),i&&l.domElement.removeAttribute("style"),l.domElement.removeAttribute("style");const s=(null!=t?t:"").split(" ").filter(e=>e);s.length&&l.domElement.classList.add(...s);const a=Bp(()=>l.update());return()=>{s.length&&l.domElement.classList.remove(...s),null==e||e.removeChild(l.domElement),a()}}},[n,l,t,r,i]),null});function mQ({size:t=256,frames:n=1/0}={}){const r=zp(e=>e.viewport.dpr),{width:i,height:s}=zp(e=>e.size),a=t||i*r,o=t||s*r,l=e.useMemo(()=>{const e=new Oo(a,o);return e.format=Ee,e.type=he,{depthTexture:e}},[a,o]);let c=0;const u=WR(a,o,l);return Gp(e=>{(n===1/0||c<n)&&(e.gl.setRenderTarget(u),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),c++)}),u.depthTexture}function gQ(e,t,n=1){const r=zp(e=>e.viewport),i=t*(r.aspect>e/t?r.width/e:r.height/t);return[e*(r.aspect>e/t?r.width/e:r.height/t)*n,i*n,1]}function AQ(t,n){const r=zp(e=>e.pointer),[i]=e.useState(()=>{const e=new Ed;return n&&Xp(e,n,{}),function(n,i){e.setFromCamera(r,t instanceof Wi?t:t.current);const s=this.constructor.prototype.raycast.bind(this);s&&s(e,i)}});return i}function vQ(e,t,n,r){return new(n||(n=Promise))(function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const yQ=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function EQ(e){return e.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const _Q="undefined"==typeof window,xQ=(()=>{if(_Q)return;const{userAgent:e,platform:t,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(e),i="iPad"===t||"MacIntel"===t&&n>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(e)||r||i,isSafari12:/Version\/12.+Safari/.test(e),isFirefox:/Firefox/.test(e)}})();class bQ extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const SQ=[],wQ=[];function CQ(e,t){if(e===t)return 0;const n=e;e.length>t.length&&(e=t,t=n);let r=e.length,i=t.length;for(;r>0&&e.charCodeAt(~-r)===t.charCodeAt(~-i);)r--,i--;let s,a=0;for(;a<r&&e.charCodeAt(a)===t.charCodeAt(a);)a++;if(r-=a,i-=a,0===r)return i;let o,l,c=0,u=0,h=0;for(;u<r;)wQ[u]=e.charCodeAt(a+u),SQ[u]=++u;for(;h<i;)for(s=t.charCodeAt(a+h),o=h++,c=h,u=0;u<r;u++)l=s===wQ[u]?o:o+1,o=SQ[u],c=SQ[u]=o>c?l>c?c+1:l:l>o?o+1:l;return c}function TQ(e){return null!=e}const MQ=({mobileTiers:e=[0,15,30,60],desktopTiers:t=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>vQ(void 0,void 0,void 0,function*(){const a={};if(_Q)return{tier:0,type:"SSR"};const{isIpad:o=!!(null==xQ?void 0:xQ.isIpad),isMobile:l=!!(null==xQ?void 0:xQ.isMobile),screenSize:c=window.screen,loadBenchmarks:u=e=>vQ(void 0,void 0,void 0,function*(){const t=yield fetch(`${s}/${e}`).then(e=>e.json());if(parseInt(t.shift().split(".")[0],10)<4)throw new bQ("Detect GPU benchmark data is out of date. Please update to version 4x");return t})}=n;let{renderer:h}=n;const d=(e,t,n,r,i)=>({device:i,fps:r,gpu:n,isMobile:l,tier:e,type:t});let f,p="";if(h)h=EQ(h),f=[h];else{const e=r||function(e,t=!1){const n={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete n.powerPreference;const r=window.document.createElement("canvas"),i=r.getContext("webgl",n)||r.getContext("experimental-webgl",n);return null!=i?i:void 0}(null==xQ?void 0:xQ.isSafari12,i);if(!e)return d(0,"WEBGL_UNSUPPORTED");const t=(null==xQ?void 0:xQ.isFirefox)?null:e.getExtension("WEBGL_debug_renderer_info");if(h=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):e.getParameter(e.RENDERER),!h)return d(1,"FALLBACK");p=h,h=EQ(h),f=function(e,t,n){return"apple gpu"===t?function(e,t,n){if(!n)return[t];const r=function(e){const t=e.createShader(35633),n=e.createShader(35632),r=e.createProgram();if(!(n&&t&&r))return;e.shaderSource(t,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),e.shaderSource(n,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),e.compileShader(t),e.compileShader(n),e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),e.detachShader(r,t),e.detachShader(r,n),e.deleteShader(t),e.deleteShader(n),e.useProgram(r);const i=e.createBuffer();e.bindBuffer(34962,i),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const s=e.getAttribLocation(r,"aPosition");e.vertexAttribPointer(s,3,5126,!1,0,0),e.enableVertexAttribArray(s),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);const a=new Uint8Array(4);return e.readPixels(0,0,1,1,6408,5121,a),e.deleteProgram(r),e.deleteBuffer(i),a.join("")}(e),i="801621810",s="8016218135",a="80162181161",o=(null==xQ?void 0:xQ.isIpad)?[["a7",a,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",a,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let l;return"80162181255"===r?l=o.filter(([,,e])=>e>=14):(l=o.filter(([,e])=>e===r),l.length||(l=o)),l.map(([e])=>`apple ${e} gpu`)}(e,t,n):[t]}(e,h,l)}const m=(yield Promise.all(f.map(function(e){var t;return vQ(this,void 0,void 0,function*(){const n=(e=>{const t=l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const n of t)if(e.includes(n))return n})(e);if(!n)return;const r=`${l?"m":"d"}-${n}${o?"-ipad":""}.json`,i=a[r]=null!==(t=a[r])&&void 0!==t?t:u(r);let s;try{s=yield i}catch(n){if(n instanceof bQ)throw n;return}const h=function(e){var t;const n=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==n?void 0:n.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""}(e);let d=s.filter(([,e])=>e===h);d.length||(d=s.filter(([t])=>t.includes(e)));const f=d.length;if(0===f)return;const p=e.split(/[.,()\[\]/\s]/g).sort().filter((e,t,n)=>0===t||e!==n[t-1]).join(" ");let m,[g,,,,A]=f>1?d.map(e=>[e,CQ(p,e[2])]).sort(([,e],[,t])=>e-t)[0][0]:d[0],v=Number.MAX_VALUE;const{devicePixelRatio:y}=window,E=c.width*y*c.height*y;for(const e of A){const[t,n]=e,r=t*n,i=Math.abs(E-r);i<v&&(v=i,m=e)}if(!m)return;const[,,_,x]=m;return[v,_,g,x]})}))).filter(TQ).sort(([e=Number.MAX_VALUE,t],[n=Number.MAX_VALUE,r])=>e===n?t-r:e-n);if(!m.length){const e=yQ.find(e=>h.includes(e));return e?d(0,"BLOCKLISTED",e):d(1,"FALLBACK",`${h} (${p})`)}const[,g,A,v]=m[0];if(-1===g)return d(0,"BLOCKLISTED",A,g,v);const y=l?e:t;let E=0;for(let e=0;e<y.length;e++)g>=y[e]&&(E=e);return d(E,"BENCHMARK",A,g,v)}),IQ=e=>ff(()=>MQ(e),["useDetectGPU"]);function RQ({children:t,...n}){const r=IQ(n);return e.createElement(e.Fragment,null,null==t?void 0:t(r))}const BQ=1.25,PQ=32,DQ=65535,LQ=Math.pow(2,-24),kQ=Symbol("SKIP_GENERATION");function FQ(e){return e.index?e.index.count:e.attributes.position.count}function OQ(e){return FQ(e)/3}function UQ(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}function NQ(e,t){const n=OQ(e),r=t||e.drawRange,i=r.start/3,s=(r.start+r.count)/3,a=Math.max(0,i),o=Math.min(n,s)-a;return[{offset:Math.floor(a),count:Math.floor(o)}]}function zQ(e,t){if(!e.groups||!e.groups.length)return NQ(e,t);const n=[],r=new Set,i=t||e.drawRange,s=i.start/3,a=(i.start+i.count)/3;for(const t of e.groups){const e=t.start/3,n=(t.start+t.count)/3;r.add(Math.max(s,e)),r.add(Math.min(a,n))}const o=Array.from(r.values()).sort((e,t)=>e-t);for(let e=0;e<o.length-1;e++){const t=o[e],r=o[e+1];n.push({offset:Math.floor(t),count:Math.floor(r-t)})}return n}function GQ(e,t,n,r,i){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,f=1/0,p=-1/0,m=-1/0,g=-1/0;for(let r=6*t,i=6*(t+n);r<i;r+=6){const t=e[r+0],n=e[r+1],i=t-n,A=t+n;i<s&&(s=i),A>l&&(l=A),t<h&&(h=t),t>p&&(p=t);const v=e[r+2],y=e[r+3],E=v-y,_=v+y;E<a&&(a=E),_>c&&(c=_),v<d&&(d=v),v>m&&(m=v);const x=e[r+4],b=e[r+5],S=x-b,w=x+b;S<o&&(o=S),w>u&&(u=w),x<f&&(f=x),x>g&&(g=x)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=c,r[5]=u,i[0]=h,i[1]=d,i[2]=f,i[3]=p,i[4]=m,i[5]=g}function QQ(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function HQ(e){let t=-1,n=-1/0;for(let r=0;r<3;r++){const i=e[r+3]-e[r];i>n&&(n=i,t=r)}return t}function VQ(e,t){t.set(e)}function jQ(e,t,n){let r,i;for(let s=0;s<3;s++){const a=s+3;r=e[s],i=t[s],n[s]=r<i?r:i,r=e[a],i=t[a],n[a]=r>i?r:i}}function WQ(e,t,n){for(let r=0;r<3;r++){const i=t[e+2*r],s=t[e+2*r+1],a=i-s,o=i+s;a<n[r]&&(n[r]=a),o>n[r+3]&&(n[r+3]=o)}}function YQ(e){const t=e[3]-e[0],n=e[4]-e[1],r=e[5]-e[2];return 2*(t*n+n*r+r*t)}const KQ=32,qQ=(e,t)=>e.candidate-t.candidate,XQ=new Array(KQ).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),$Q=new Float32Array(6);class JQ{constructor(){this.boundingData=new Float32Array(6)}}function ZQ(e,t,n,r,i,s){let a=r,o=r+i-1;const l=s.pos,c=2*s.axis;for(;;){for(;a<=o&&n[6*a+c]<l;)a++;for(;a<=o&&n[6*o+c]>=l;)o--;if(!(a<o))return a;for(let e=0;e<3;e++){let n=t[3*a+e];t[3*a+e]=t[3*o+e],t[3*o+e]=n}for(let e=0;e<6;e++){let t=n[6*a+e];n[6*a+e]=n[6*o+e],n[6*o+e]=t}a++,o--}}function eH(e,t,n,r,i,s){let a=r,o=r+i-1;const l=s.pos,c=2*s.axis;for(;;){for(;a<=o&&n[6*a+c]<l;)a++;for(;a<=o&&n[6*o+c]>=l;)o--;if(!(a<o))return a;{let t=e[a];e[a]=e[o],e[o]=t;for(let e=0;e<6;e++){let t=n[6*a+e];n[6*a+e]=n[6*o+e],n[6*o+e]=t}a++,o--}}}function tH(e,t){return 65535===t[e+15]}function nH(e,t){return t[e+6]}function rH(e,t){return t[e+14]}function iH(e){return e+8}function sH(e,t){return t[e+6]}function aH(e,t){return t[e+7]}function oH(e){return e}let lH,cH,uH,hH;const dH=Math.pow(2,32);function fH(e){return"count"in e?1:1+fH(e.left)+fH(e.right)}function pH(e,t,n){return lH=new Float32Array(n),cH=new Uint32Array(n),uH=new Uint16Array(n),hH=new Uint8Array(n),mH(e,t)}function mH(e,t){const n=e/4,r=e/2,i="count"in t,s=t.boundingData;for(let e=0;e<6;e++)lH[n+e]=s[e];if(i){if(t.buffer){const r=t.buffer;hH.set(new Uint8Array(r),e);for(let t=e,i=e+r.byteLength;t<i;t+=PQ){tH(t/2,uH)||(cH[t/4+6]+=n)}return e+r.byteLength}{const i=t.offset,s=t.count;return cH[n+6]=i,uH[r+14]=s,uH[r+15]=DQ,e+PQ}}{const r=t.left,i=t.right,s=t.splitAxis;let a;if(a=mH(e+PQ,r),a/4>dH)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return cH[n+6]=a/4,a=mH(a,i),cH[n+7]=s,a}}function gH(e,t,n,r,i){const{maxDepth:s,verbose:a,maxLeafTris:o,strategy:l,onProgress:c,indirect:u}=i,h=e._indirectBuffer,d=e.geometry,f=d.index?d.index.array:null,p=u?eH:ZQ,m=OQ(d),g=new Float32Array(6);let A=!1;const v=new JQ;return GQ(t,n,r,v.boundingData,g),function e(n,r,i,a=null,c=0){!A&&c>=s&&(A=!0);if(i<=o||c>=s)return y(r+i),n.offset=r,n.count=i,n;const u=function(e,t,n,r,i,s){let a=-1,o=0;if(0===s)a=HQ(t),-1!==a&&(o=(t[a]+t[a+3])/2);else if(1===s)a=HQ(e),-1!==a&&(o=function(e,t,n,r){let i=0;for(let s=t,a=t+n;s<a;s++)i+=e[6*s+2*r];return i/n}(n,r,i,a));else if(2===s){const s=YQ(e);let l=BQ*i;const c=6*r,u=6*(r+i);for(let e=0;e<3;e++){const r=t[e],h=(t[e+3]-r)/KQ;if(i<8){const t=[...XQ];t.length=i;let r=0;for(let i=c;i<u;i+=6,r++){const s=t[r];s.candidate=n[i+2*e],s.count=0;const{bounds:a,leftCacheBounds:o,rightCacheBounds:l}=s;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0;WQ(i,n,a)}t.sort(qQ);let h=i;for(let e=0;e<h;e++){const n=t[e];for(;e+1<h&&t[e+1].candidate===n.candidate;)t.splice(e+1,1),h--}for(let r=c;r<u;r+=6){const i=n[r+2*e];for(let e=0;e<h;e++){const s=t[e];i>=s.candidate?WQ(r,n,s.rightCacheBounds):(WQ(r,n,s.leftCacheBounds),s.count++)}}for(let n=0;n<h;n++){const r=t[n],c=r.count,u=i-r.count,h=r.leftCacheBounds,d=r.rightCacheBounds;let f=0;0!==c&&(f=YQ(h)/s);let p=0;0!==u&&(p=YQ(d)/s);const m=1+BQ*(f*c+p*u);m<l&&(a=e,l=m,o=r.candidate)}}else{for(let e=0;e<KQ;e++){const t=XQ[e];t.count=0,t.candidate=r+h+e*h;const n=t.bounds;for(let e=0;e<3;e++)n[e]=1/0,n[e+3]=-1/0}for(let t=c;t<u;t+=6){let i=~~((n[t+2*e]-r)/h);i>=KQ&&(i=31);const s=XQ[i];s.count++,WQ(t,n,s.bounds)}const t=XQ[31];VQ(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=XQ[e],n=XQ[e+1];jQ(t.bounds,n.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let t=0;t<31;t++){const n=XQ[t],r=n.count,c=n.bounds,u=XQ[t+1].rightCacheBounds;0!==r&&(0===d?VQ(c,$Q):jQ(c,$Q,$Q)),d+=r;let h=0,f=0;0!==d&&(h=YQ($Q)/s);const p=i-d;0!==p&&(f=YQ(u)/s);const m=1+BQ*(h*d+f*p);m<l&&(a=e,l=m,o=n.candidate)}}}}return{axis:a,pos:o}}(n.boundingData,a,t,r,i,l);if(-1===u.axis)return y(r+i),n.offset=r,n.count=i,n;const d=p(h,f,t,r,i,u);if(d===r||d===r+i)y(r+i),n.offset=r,n.count=i;else{n.splitAxis=u.axis;const s=new JQ,a=r,o=d-r;n.left=s,GQ(t,a,o,s.boundingData,g),e(s,a,o,g,c+1);const l=new JQ,h=d,f=i-o;n.right=l,GQ(t,h,f,l.boundingData,g),e(l,h,f,g,c+1)}return n}(v,n,r,g),v;function y(e){c&&c(e/m)}}function AH(e,t){const n=e.geometry;t.indirect&&(e._indirectBuffer=function(e,t){const n=(e.index?e.index.count:e.attributes.position.count)/3,r=n>65536,i=r?4:2,s=t?new SharedArrayBuffer(n*i):new ArrayBuffer(n*i),a=r?new Uint32Array(s):new Uint16Array(s);for(let e=0,t=a.length;e<t;e++)a[e]=e;return a}(n,t.useSharedArrayBuffer),function(e,t){const n=OQ(e),r=zQ(e,t).sort((e,t)=>e.offset-t.offset),i=r[r.length-1];i.count=Math.min(n-i.offset,i.count);let s=0;return r.forEach(({count:e})=>s+=e),n!==s}(n,t.range)&&t.verbose),e._indirectBuffer||function(e,t){if(!e.index){const n=e.attributes.position.count,r=UQ(n,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new ci(r,1));for(let e=0;e<n;e++)r[e]=e}}(n,t);const r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=function(e,t=null,n=null,r=null){const i=e.attributes.position,s=e.index?e.index.array:null,a=OQ(e),o=i.normalized;let l;null===t?(l=new Float32Array(6*a*4),n=0,r=a):(l=t,n=n||0,r=r||a);const c=i.array,u=i.offset||0;let h=3;i.isInterleavedBufferAttribute&&(h=i.data.stride);const d=["getX","getY","getZ"];for(let e=n;e<n+r;e++){const t=3*e,n=6*e;let r=t+0,a=t+1,f=t+2;s&&(r=s[r],a=s[a],f=s[f]),o||(r=r*h+u,a=a*h+u,f=f*h+u);for(let e=0;e<3;e++){let t,s,u;o?(t=i[d[e]](r),s=i[d[e]](a),u=i[d[e]](f)):(t=c[r+e],s=c[a+e],u=c[f+e]);let h=t;s<h&&(h=s),u<h&&(h=u);let p=t;s>p&&(p=s),u>p&&(p=u);const m=(p-h)/2,g=2*e;l[n+g+0]=h+m,l[n+g+1]=m+(Math.abs(h)+m)*LQ}}return l}(n),s=t.indirect?NQ(n,t.range):zQ(n,t.range);e._roots=s.map(n=>{const s=gH(e,i,n.offset,n.count,t),a=fH(s),o=new r(PQ*a);return pH(0,s,o),o})}class vH{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let i=0,s=e.length;i<s;i++){const s=e[i][t];n=s<n?s:n,r=s>r?s:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let i=0,s=t.length;i<s;i++){const s=t[i],a=e.dot(s);n=a<n?a:n,r=a>r?a:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}vH.prototype.setFromBox=function(){const e=new Dn;return function(t,n){const r=n.min,i=n.max;let s=1/0,a=-1/0;for(let n=0;n<=1;n++)for(let o=0;o<=1;o++)for(let l=0;l<=1;l++){e.x=r.x*n+i.x*(1-n),e.y=r.y*o+i.y*(1-o),e.z=r.z*l+i.z*(1-l);const c=t.dot(e);s=Math.min(c,s),a=Math.max(c,a)}this.min=s,this.max=a}}(),function(){const e=new vH}();const yH=function(){const e=new Dn,t=new Dn,n=new Dn;return function(r,i,s){const a=r.start,o=e,l=i.start,c=t;n.subVectors(a,l),e.subVectors(r.end,r.start),t.subVectors(i.end,i.start);const u=n.dot(c),h=c.dot(o),d=c.dot(c),f=n.dot(o),p=o.dot(o)*d-h*h;let m,g;m=0!==p?(u*h-f*d)/p:0,g=(u+m*h)/d,s.x=m,s.y=g}}(),EH=function(){const e=new nn,t=new Dn,n=new Dn;return function(r,i,s,a){yH(r,i,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1)return r.at(o,s),void i.at(l,a);if(o>=0&&o<=1)return l<0?i.at(0,a):i.at(1,a),void r.closestPointToPoint(a,!0,s);if(l>=0&&l<=1)return o<0?r.at(0,s):r.at(1,s),void i.closestPointToPoint(s,!0,a);{let e,c;e=o<0?r.start:r.end,c=l<0?i.start:i.end;const u=t,h=n;return r.closestPointToPoint(c,!0,t),i.closestPointToPoint(e,!0,n),u.distanceToSquared(c)<=h.distanceToSquared(e)?(s.copy(u),void a.copy(c)):(s.copy(e),void a.copy(h))}}}(),_H=function(){const e=new Dn,t=new Dn,n=new ts,r=new Md;return function(i,s){const{radius:a,center:o}=i,{a:l,b:c,c:u}=s;r.start=l,r.end=c;if(r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)return!0;r.start=l,r.end=u;if(r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)return!0;r.start=c,r.end=u;if(r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)return!0;const h=s.getPlane(n);if(Math.abs(h.distanceToPoint(o))<=a){const e=h.projectPoint(o,t);if(s.containsPoint(e))return!0}return!1}}();function xH(e){return Math.abs(e)<1e-15}class bH extends Wr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new Dn),this.satBounds=new Array(4).fill().map(()=>new vH),this.points=[this.a,this.b,this.c],this.sphere=new er,this.plane=new ts,this.needsUpdate=!0}intersectsSphere(e){return _H(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,i=this.satAxes,s=this.satBounds,a=i[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);const l=i[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,r);const u=i[2],h=s[2];u.subVectors(t,n),h.setFromPoints(u,r);const d=i[3],f=s[3];d.subVectors(n,e),f.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}bH.prototype.closestPointToSegment=function(){const e=new Dn,t=new Dn,n=new Md;return function(r,i=null,s=null){const{start:a,end:o}=r,l=this.points;let c,u=1/0;for(let a=0;a<3;a++){const o=(a+1)%3;n.start.copy(l[a]),n.end.copy(l[o]),EH(n,r,e,t),c=e.distanceToSquared(t),c<u&&(u=c,i&&i.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,i&&i.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,i&&i.copy(e),s&&s.copy(o)),Math.sqrt(u)}}(),bH.prototype.intersectsTriangle=function(){const e=new bH,t=new Array(3),n=new Array(3),r=new vH,i=new vH,s=new Dn,a=new Dn,o=new Dn,l=new Dn,c=new Dn,u=new Md,h=new Md,d=new Md,f=new Dn;function p(e,t,n){const r=e.points;let i=0,s=-1;for(let e=0;e<3;e++){const{start:o,end:l}=u;o.copy(r[e]),l.copy(r[(e+1)%3]),u.delta(a);const c=xH(t.distanceToPoint(o));if(xH(t.normal.dot(a))&&c){n.copy(u),i=2;break}const h=t.intersectLine(u,f);if(!h&&c&&f.copy(o),(h||c)&&!xH(f.distanceTo(l))){if(i<=1){(1===i?n.start:n.end).copy(f),c&&(s=i)}else if(i>=2){(1===s?n.start:n.end).copy(f),i=2;break}if(i++,2===i&&-1===s)break}}return i}return function(a,u=null,f=!1){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(e.copy(a),e.update(),a=e);const m=this.plane,g=a.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){const e=this.satBounds,o=this.satAxes;n[0]=a.a,n[1]=a.b,n[2]=a.c;for(let t=0;t<4;t++){const i=e[t],s=o[t];if(r.setFromPoints(s,n),i.isSeparated(r))return!1}const l=a.satBounds,c=a.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){const n=l[e],i=c[e];if(r.setFromPoints(i,t),n.isSeparated(r))return!1}for(let e=0;e<4;e++){const a=o[e];for(let e=0;e<4;e++){const o=c[e];if(s.crossVectors(a,o),r.setFromPoints(s,t),i.setFromPoints(s,n),r.isSeparated(i))return!1}}return u&&(u.start.set(0,0,0),u.end.set(0,0,0)),!0}{const e=p(this,g,h);if(1===e&&a.containsPoint(h.end))return u&&(u.start.copy(h.end),u.end.copy(h.end)),!0;if(2!==e)return!1;const t=p(a,m,d);if(1===t&&this.containsPoint(d.end))return u&&(u.start.copy(d.end),u.end.copy(d.end)),!0;if(2!==t)return!1;if(h.delta(o),d.delta(l),o.dot(l)<0){let e=d.start;d.start=d.end,d.end=e}const n=h.start.dot(o),r=h.end.dot(o),i=d.start.dot(o),s=d.end.dot(o);return(n===s||i===r||r<i!==n<s)&&(u&&(c.subVectors(h.start,d.start),c.dot(o)>0?u.start.copy(h.start):u.start.copy(d.start),c.subVectors(h.end,d.end),c.dot(o)<0?u.end.copy(h.end):u.end.copy(d.end)),!0)}}}(),bH.prototype.distanceToPoint=function(){const e=new Dn;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),bH.prototype.distanceToTriangle=function(){const e=new Dn,t=new Dn,n=["a","b","c"],r=new Md,i=new Md;return function(s,a=null,o=null){const l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let t=0;t<3;t++){let r;const i=n[t],l=s[i];this.closestPointToPoint(l,e),r=l.distanceToSquared(e),r<c&&(c=r,a&&a.copy(e),o&&o.copy(l));const u=this[i];s.closestPointToPoint(u,e),r=u.distanceToSquared(e),r<c&&(c=r,a&&a.copy(u),o&&o.copy(e))}for(let l=0;l<3;l++){const u=n[l],h=n[(l+1)%3];r.set(this[u],this[h]);for(let l=0;l<3;l++){const u=n[l],h=n[(l+1)%3];i.set(s[u],s[h]),EH(r,i,e,t);const d=e.distanceToSquared(t);d<c&&(c=d,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();class SH{constructor(e,t,n){this.isOrientedBox=!0,this.min=new Dn,this.max=new Dn,this.matrix=new cr,this.invMatrix=new cr,this.points=new Array(8).fill().map(()=>new Dn),this.satAxes=new Array(3).fill().map(()=>new Dn),this.satBounds=new Array(3).fill().map(()=>new vH),this.alignedSatBounds=new Array(3).fill().map(()=>new vH),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}SH.prototype.update=function(){const e=this.matrix,t=this.min,n=this.max,r=this.points;for(let i=0;i<=1;i++)for(let s=0;s<=1;s++)for(let a=0;a<=1;a++){const o=r[1*i|2*s|4*a];o.x=i?n.x:t.x,o.y=s?n.y:t.y,o.z=a?n.z:t.z,o.applyMatrix4(e)}const i=this.satBounds,s=this.satAxes,a=r[0];for(let e=0;e<3;e++){const t=s[e],n=i[e],o=r[1<<e];t.subVectors(a,o),n.setFromPoints(t,r)}const o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},SH.prototype.intersectsBox=function(){const e=new vH;return function(t){this.needsUpdate&&this.update();const n=t.min,r=t.max,i=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=n.x,e.max=r.x,a[0].isSeparated(e))return!1;if(e.min=n.y,e.max=r.y,a[1].isSeparated(e))return!1;if(e.min=n.z,e.max=r.z,a[2].isSeparated(e))return!1;for(let n=0;n<3;n++){const r=s[n],a=i[n];if(e.setFromBox(r,t),a.isSeparated(e))return!1}return!0}}(),SH.prototype.intersectsTriangle=function(){const e=new bH,t=new Array(3),n=new vH,r=new vH,i=new Dn;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);const a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let e=0;e<3;e++){const r=a[e],i=o[e];if(n.setFromPoints(i,t),r.isSeparated(n))return!1}const l=s.satBounds,c=s.satAxes,u=this.points;for(let e=0;e<3;e++){const t=l[e],r=c[e];if(n.setFromPoints(r,u),t.isSeparated(n))return!1}for(let e=0;e<3;e++){const s=o[e];for(let e=0;e<4;e++){const a=c[e];if(i.crossVectors(s,a),n.setFromPoints(i,t),r.setFromPoints(i,u),n.isSeparated(r))return!1}}return!0}}(),SH.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},SH.prototype.distanceToPoint=function(){const e=new Dn;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),SH.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map(()=>new Md),n=new Array(12).fill().map(()=>new Md),r=new Dn,i=new Dn;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(i),this.closestPointToPoint(i,r),s.closestPointToPoint(r,i),o&&o.copy(r),l&&l.copy(i)),0;const c=a*a,u=s.min,h=s.max,d=this.points;let f=1/0;for(let e=0;e<8;e++){const t=d[e];i.copy(t).clamp(u,h);const n=t.distanceToSquared(i);if(n<f&&(f=n,o&&o.copy(t),l&&l.copy(i),n<c))return Math.sqrt(n)}let p=0;for(let r=0;r<3;r++)for(let i=0;i<=1;i++)for(let s=0;s<=1;s++){const a=(r+1)%3,o=(r+2)%3,l=1<<r|i<<a|s<<o,c=d[i<<a|s<<o],f=d[l];t[p].set(c,f);const m=e[r],g=e[a],A=e[o],v=n[p],y=v.start,E=v.end;y[m]=u[m],y[g]=i?u[g]:h[g],y[A]=s?u[A]:h[g],E[m]=h[m],E[g]=i?u[g]:h[g],E[A]=s?u[A]:h[g],p++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){i.x=e?h.x:u.x,i.y=t?h.y:u.y,i.z=n?h.z:u.z,this.closestPointToPoint(i,r);const s=i.distanceToSquared(r);if(s<f&&(f=s,o&&o.copy(r),l&&l.copy(i),s<c))return Math.sqrt(s)}for(let e=0;e<12;e++){const s=t[e];for(let e=0;e<12;e++){const t=n[e];EH(s,t,r,i);const a=r.distanceToSquared(i);if(a<f&&(f=a,o&&o.copy(r),l&&l.copy(i),a<c))return Math.sqrt(a)}}return Math.sqrt(f)}}();class wH{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class CH extends wH{constructor(){super(()=>new bH)}}const TH=new CH;const MH=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=n=>{t&&e.push(t),t=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}};let IH,RH;const BH=[],PH=new wH(()=>new Fn);function DH(e,t,n,r,i,s){IH=PH.getPrimitive(),RH=PH.getPrimitive(),BH.push(IH,RH),MH.setBuffer(e._roots[t]);const a=LH(0,e.geometry,n,r,i,s);MH.clearBuffer(),PH.releasePrimitive(IH),PH.releasePrimitive(RH),BH.pop(),BH.pop();const o=BH.length;return o>0&&(RH=BH[o-1],IH=BH[o-2]),a}function LH(e,t,n,r,i=null,s=0,a=0){const{float32Array:o,uint16Array:l,uint32Array:c}=MH;let u=2*e;if(tH(u,l)){const h=nH(e,c),d=rH(u,l);return QQ(e,o,IH),r(h,d,!1,a,s+e,IH)}{const f=iH(e),p=sH(e,c);let m,g,A,v,y=f,E=p;if(i&&(A=IH,v=RH,QQ(y,o,A),QQ(E,o,v),m=i(A),g=i(v),g<m)){y=p,E=f;const T=m;m=g,g=T,A=v}A||(A=IH,QQ(y,o,A));const _=n(A,tH(2*y,l),m,a+1,s+y);let x;if(2===_){const M=w(y);x=r(M,C(y)-M,!0,a+1,s+y,A)}else x=_&&LH(y,t,n,r,i,s,a+1);if(x)return!0;v=RH,QQ(E,o,v);const b=n(v,tH(2*E,l),g,a+1,s+E);let S;if(2===b){const I=w(E);S=r(I,C(E)-I,!0,a+1,s+E,v)}else S=b&&LH(E,t,n,r,i,s,a+1);return!!S;function w(e){const{uint16Array:t,uint32Array:n}=MH;let r=2*e;for(;!tH(r,t);)r=2*(e=iH(e));return nH(e,n)}function C(e){const{uint16Array:t,uint32Array:n}=MH;let r=2*e;for(;!tH(r,t);)r=2*(e=sH(e,n));return nH(e,n)+rH(r,t)}}}const kH=new Dn,FH=new Dn;const OH=new Dn,UH=new Dn,NH=new Dn,zH=new nn,GH=new nn,QH=new nn,HH=new Dn,VH=new Dn,jH=new Dn,WH=new Dn;function YH(e,t,n,r,i,s,a){const o=3*r;let l=o+0,c=o+1,u=o+2;const h=e.index;e.index&&(l=h.getX(l),c=h.getX(c),u=h.getX(u));const{position:d,normal:f,uv:p,uv1:m}=e.attributes,g=function(e,t,n,r,i,s,a,o,l,c,u){OH.fromBufferAttribute(t,s),UH.fromBufferAttribute(t,a),NH.fromBufferAttribute(t,o);const h=function(e,t,n,r,i,s,a,o){let l;if(l=1===s?e.intersectTriangle(r,n,t,!0,i):e.intersectTriangle(t,n,r,2!==s,i),null===l)return null;const c=e.origin.distanceTo(i);return c<a||c>o?null:{distance:c,point:i.clone()}}(e,OH,UH,NH,WH,l,c,u);if(h){r&&(zH.fromBufferAttribute(r,s),GH.fromBufferAttribute(r,a),QH.fromBufferAttribute(r,o),h.uv=Wr.getInterpolation(WH,OH,UH,NH,zH,GH,QH,new nn)),i&&(zH.fromBufferAttribute(i,s),GH.fromBufferAttribute(i,a),QH.fromBufferAttribute(i,o),h.uv1=Wr.getInterpolation(WH,OH,UH,NH,zH,GH,QH,new nn)),n&&(HH.fromBufferAttribute(n,s),VH.fromBufferAttribute(n,a),jH.fromBufferAttribute(n,o),h.normal=Wr.getInterpolation(WH,OH,UH,NH,HH,VH,jH,new Dn),h.normal.dot(e.direction)>0&&h.normal.multiplyScalar(-1));const t={a:s,b:a,c:o,normal:new Dn,materialIndex:0};Wr.getNormal(OH,UH,NH,t.normal),h.face=t,h.faceIndex=s}return h}(n,d,f,p,m,l,c,u,t,s,a);return g?(g.faceIndex=r,i&&i.push(g),g):null}function KH(e,t,n,r){const i=e.a,s=e.b,a=e.c;let o=t,l=t+1,c=t+2;n&&(o=n.getX(o),l=n.getX(l),c=n.getX(c)),i.x=r.getX(o),i.y=r.getY(o),i.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function qH(e,t,n,r,i,s,a){const{geometry:o}=n,{index:l}=o,c=o.attributes.position;for(let n=e,o=t+e;n<o;n++){let e;if(e=n,KH(a,3*e,l,c),a.needsUpdate=!0,r(a,e,i,s))return!0}return!1}function XH(e,t=null){t&&Array.isArray(t)&&(t=new Set(t));const n=e.geometry,r=n.index?n.index.array:null,i=n.attributes.position;let s,a,o,l,c=0;const u=e._roots;for(let e=0,t=u.length;e<t;e++)s=u[e],a=new Uint32Array(s),o=new Uint16Array(s),l=new Float32Array(s),h(0,c),c+=s.byteLength;function h(e,n,s=!1){const c=2*e;if(o[c+15]===DQ){const t=a[e+6];let n=1/0,s=1/0,u=1/0,h=-1/0,d=-1/0,f=-1/0;for(let e=3*t,a=3*(t+o[c+14]);e<a;e++){let t=r[e];const a=i.getX(t),o=i.getY(t),l=i.getZ(t);a<n&&(n=a),a>h&&(h=a),o<s&&(s=o),o>d&&(d=o),l<u&&(u=l),l>f&&(f=l)}return(l[e+0]!==n||l[e+1]!==s||l[e+2]!==u||l[e+3]!==h||l[e+4]!==d||l[e+5]!==f)&&(l[e+0]=n,l[e+1]=s,l[e+2]=u,l[e+3]=h,l[e+4]=d,l[e+5]=f,!0)}{const r=e+8,i=a[e+6],o=r+n,c=i+n;let u=s,d=!1,f=!1;t?u||(d=t.has(o),f=t.has(c),u=!d&&!f):(d=!0,f=!0);const p=u||f;let m=!1;(u||d)&&(m=h(r,n,u));let g=!1;p&&(g=h(i,n,u));const A=m||g;if(A)for(let t=0;t<3;t++){const n=r+t,s=i+t,a=l[n],o=l[n+3],c=l[s],u=l[s+3];l[e+t]=a<c?a:c,l[e+t+3]=o>u?o:u}return A}}}function $H(e,t,n,r,i){let s,a,o,l,c,u;const h=1/n.direction.x,d=1/n.direction.y,f=1/n.direction.z,p=n.origin.x,m=n.origin.y,g=n.origin.z;let A=t[e],v=t[e+3],y=t[e+1],E=t[e+3+1],_=t[e+2],x=t[e+3+2];return h>=0?(s=(A-p)*h,a=(v-p)*h):(s=(v-p)*h,a=(A-p)*h),d>=0?(o=(y-m)*d,l=(E-m)*d):(o=(E-m)*d,l=(y-m)*d),!(s>l||o>a)&&((o>s||isNaN(s))&&(s=o),(l<a||isNaN(a))&&(a=l),f>=0?(c=(_-g)*f,u=(x-g)*f):(c=(x-g)*f,u=(_-g)*f),!(s>u||c>a)&&((c>s||s!=s)&&(s=c),(u<a||a!=a)&&(a=u),s<=i&&a>=r))}function JH(e,t,n,r,i,s,a){const{geometry:o}=n,{index:l}=o,c=o.attributes.position;for(let o=e,u=t+e;o<u;o++){let e;if(e=n.resolveTriangleIndex(o),KH(a,3*e,l,c),a.needsUpdate=!0,r(a,e,i,s))return!0}return!1}function ZH(e,t,n,r,i,s,a){MH.setBuffer(e._roots[t]),eV(0,e,n,r,i,s,a),MH.clearBuffer()}function eV(e,t,n,r,i,s,a){const{float32Array:o,uint16Array:l,uint32Array:c}=MH,u=2*e;if(tH(u,l)){!function(e,t,n,r,i,s,a,o){const{geometry:l,_indirectBuffer:c}=e;for(let e=r,c=r+i;e<c;e++)YH(l,t,n,e,s,a,o)}(t,n,r,nH(e,c),rH(u,l),i,s,a)}else{const l=iH(e);$H(l,o,r,s,a)&&eV(l,t,n,r,i,s,a);const u=sH(e,c);$H(u,o,r,s,a)&&eV(u,t,n,r,i,s,a)}}const tV=["x","y","z"];function nV(e,t,n,r,i,s){MH.setBuffer(e._roots[t]);const a=rV(0,e,n,r,i,s);return MH.clearBuffer(),a}function rV(e,t,n,r,i,s){const{float32Array:a,uint16Array:o,uint32Array:l}=MH;let c=2*e;if(tH(c,o)){return function(e,t,n,r,i,s,a){const{geometry:o,_indirectBuffer:l}=e;let c=1/0,u=null;for(let e=r,l=r+i;e<l;e++){let r;r=YH(o,t,n,e,null,s,a),r&&r.distance<c&&(u=r,c=r.distance)}return u}(t,n,r,nH(e,l),rH(c,o),i,s)}{const o=aH(e,l),c=tV[o],u=r.direction[c]>=0;let h,d;u?(h=iH(e),d=sH(e,l)):(h=sH(e,l),d=iH(e));const f=$H(h,a,r,i,s)?rV(h,t,n,r,i,s):null;if(f){const e=f.point[c];if(u?e<=a[d+o]:e>=a[d+o+3])return f}const p=$H(d,a,r,i,s)?rV(d,t,n,r,i,s):null;return f&&p?f.distance<=p.distance?f:p:f||p||null}}const iV=new Fn,sV=new bH,aV=new bH,oV=new cr,lV=new SH,cV=new SH;function uV(e,t,n,r){MH.setBuffer(e._roots[t]);const i=hV(0,e,n,r);return MH.clearBuffer(),i}function hV(e,t,n,r,i=null){const{float32Array:s,uint16Array:a,uint32Array:o}=MH;let l=2*e;null===i&&(n.boundingBox||n.computeBoundingBox(),lV.set(n.boundingBox.min,n.boundingBox.max,r),i=lV);if(!tH(l,a)){const a=e+8,l=o[e+6];QQ(a,s,iV);if(i.intersectsBox(iV)&&hV(a,t,n,r,i))return!0;QQ(l,s,iV);return!!(i.intersectsBox(iV)&&hV(l,t,n,r,i))}{const i=t.geometry,c=i.index,u=i.attributes.position,h=n.index,d=n.attributes.position,f=nH(e,o),p=rH(l,a);if(oV.copy(r).invert(),n.boundsTree){QQ(e,s,cV),cV.matrix.copy(oV),cV.needsUpdate=!0;const t=n.boundsTree.shapecast({intersectsBounds:e=>cV.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let t=3*f,n=3*(p+f);t<n;t+=3)if(KH(aV,t,c,u),aV.needsUpdate=!0,e.intersectsTriangle(aV))return!0;return!1}});return t}for(let e=3*f,t=3*(p+f);e<t;e+=3){KH(sV,e,c,u),sV.a.applyMatrix4(oV),sV.b.applyMatrix4(oV),sV.c.applyMatrix4(oV),sV.needsUpdate=!0;for(let e=0,t=h.count;e<t;e+=3)if(KH(aV,e,h,d),aV.needsUpdate=!0,sV.intersectsTriangle(aV))return!0}}}const dV=new cr,fV=new SH,pV=new SH,mV=new Dn,gV=new Dn,AV=new Dn,vV=new Dn;function yV(e,t,n,r={},i={},s=0,a=1/0){t.boundingBox||t.computeBoundingBox(),fV.set(t.boundingBox.min,t.boundingBox.max,n),fV.needsUpdate=!0;const o=e.geometry,l=o.attributes.position,c=o.index,u=t.attributes.position,h=t.index,d=TH.getPrimitive(),f=TH.getPrimitive();let p=mV,m=gV,g=null,A=null;i&&(g=AV,A=vV);let v=1/0,y=null,E=null;return dV.copy(n).invert(),pV.matrix.copy(dV),e.shapecast({boundsTraverseOrder:e=>fV.distanceToBox(e),intersectsBounds:(e,t,n)=>n<v&&n<a&&(t&&(pV.min.copy(e.min),pV.max.copy(e.max),pV.needsUpdate=!0),!0),intersectsRange:(e,r)=>{if(t.boundsTree){return t.boundsTree.shapecast({boundsTraverseOrder:e=>pV.distanceToBox(e),intersectsBounds:(e,t,n)=>n<v&&n<a,intersectsRange:(t,i)=>{for(let a=t,o=t+i;a<o;a++){KH(f,3*a,h,u),f.a.applyMatrix4(n),f.b.applyMatrix4(n),f.c.applyMatrix4(n),f.needsUpdate=!0;for(let t=e,n=e+r;t<n;t++){KH(d,3*t,c,l),d.needsUpdate=!0;const e=d.distanceToTriangle(f,p,g);if(e<v&&(m.copy(p),A&&A.copy(g),v=e,y=t,E=a),e<s)return!0}}}})}for(let i=0,a=OQ(t);i<a;i++){KH(f,3*i,h,u),f.a.applyMatrix4(n),f.b.applyMatrix4(n),f.c.applyMatrix4(n),f.needsUpdate=!0;for(let t=e,n=e+r;t<n;t++){KH(d,3*t,c,l),d.needsUpdate=!0;const e=d.distanceToTriangle(f,p,g);if(e<v&&(m.copy(p),A&&A.copy(g),v=e,y=t,E=i),e<s)return!0}}}}),TH.releasePrimitive(d),TH.releasePrimitive(f),v===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=v,r.faceIndex=y,i&&(i.point?i.point.copy(A):i.point=A.clone(),i.point.applyMatrix4(dV),m.applyMatrix4(dV),i.distance=m.sub(i.point).length(),i.faceIndex=E),r)}function EV(e,t=null){t&&Array.isArray(t)&&(t=new Set(t));const n=e.geometry,r=n.index?n.index.array:null,i=n.attributes.position;let s,a,o,l,c=0;const u=e._roots;for(let e=0,t=u.length;e<t;e++)s=u[e],a=new Uint32Array(s),o=new Uint16Array(s),l=new Float32Array(s),h(0,c),c+=s.byteLength;function h(n,s,c=!1){const u=2*n;if(o[u+15]===DQ){const t=a[n+6];let s=1/0,c=1/0,h=1/0,d=-1/0,f=-1/0,p=-1/0;for(let n=t,a=t+o[u+14];n<a;n++){const t=3*e.resolveTriangleIndex(n);for(let e=0;e<3;e++){let n=t+e;n=r?r[n]:n;const a=i.getX(n),o=i.getY(n),l=i.getZ(n);a<s&&(s=a),a>d&&(d=a),o<c&&(c=o),o>f&&(f=o),l<h&&(h=l),l>p&&(p=l)}}return(l[n+0]!==s||l[n+1]!==c||l[n+2]!==h||l[n+3]!==d||l[n+4]!==f||l[n+5]!==p)&&(l[n+0]=s,l[n+1]=c,l[n+2]=h,l[n+3]=d,l[n+4]=f,l[n+5]=p,!0)}{const e=n+8,r=a[n+6],i=e+s,o=r+s;let u=c,d=!1,f=!1;t?u||(d=t.has(i),f=t.has(o),u=!d&&!f):(d=!0,f=!0);const p=u||f;let m=!1;(u||d)&&(m=h(e,s,u));let g=!1;p&&(g=h(r,s,u));const A=m||g;if(A)for(let t=0;t<3;t++){const i=e+t,s=r+t,a=l[i],o=l[i+3],c=l[s],u=l[s+3];l[n+t]=a<c?a:c,l[n+t+3]=o>u?o:u}return A}}}function _V(e,t,n,r,i,s,a){MH.setBuffer(e._roots[t]),xV(0,e,n,r,i,s,a),MH.clearBuffer()}function xV(e,t,n,r,i,s,a){const{float32Array:o,uint16Array:l,uint32Array:c}=MH,u=2*e;if(tH(u,l)){!function(e,t,n,r,i,s,a,o){const{geometry:l,_indirectBuffer:c}=e;for(let e=r,u=r+i;e<u;e++)YH(l,t,n,c?c[e]:e,s,a,o)}(t,n,r,nH(e,c),rH(u,l),i,s,a)}else{const l=iH(e);$H(l,o,r,s,a)&&xV(l,t,n,r,i,s,a);const u=sH(e,c);$H(u,o,r,s,a)&&xV(u,t,n,r,i,s,a)}}const bV=["x","y","z"];function SV(e,t,n,r,i,s){MH.setBuffer(e._roots[t]);const a=wV(0,e,n,r,i,s);return MH.clearBuffer(),a}function wV(e,t,n,r,i,s){const{float32Array:a,uint16Array:o,uint32Array:l}=MH;let c=2*e;if(tH(c,o)){return function(e,t,n,r,i,s,a){const{geometry:o,_indirectBuffer:l}=e;let c=1/0,u=null;for(let e=r,h=r+i;e<h;e++){let r;r=YH(o,t,n,l?l[e]:e,null,s,a),r&&r.distance<c&&(u=r,c=r.distance)}return u}(t,n,r,nH(e,l),rH(c,o),i,s)}{const o=aH(e,l),c=bV[o],u=r.direction[c]>=0;let h,d;u?(h=iH(e),d=sH(e,l)):(h=sH(e,l),d=iH(e));const f=$H(h,a,r,i,s)?wV(h,t,n,r,i,s):null;if(f){const e=f.point[c];if(u?e<=a[d+o]:e>=a[d+o+3])return f}const p=$H(d,a,r,i,s)?wV(d,t,n,r,i,s):null;return f&&p?f.distance<=p.distance?f:p:f||p||null}}const CV=new Fn,TV=new bH,MV=new bH,IV=new cr,RV=new SH,BV=new SH;function PV(e,t,n,r){MH.setBuffer(e._roots[t]);const i=DV(0,e,n,r);return MH.clearBuffer(),i}function DV(e,t,n,r,i=null){const{float32Array:s,uint16Array:a,uint32Array:o}=MH;let l=2*e;null===i&&(n.boundingBox||n.computeBoundingBox(),RV.set(n.boundingBox.min,n.boundingBox.max,r),i=RV);if(!tH(l,a)){const a=e+8,l=o[e+6];QQ(a,s,CV);if(i.intersectsBox(CV)&&DV(a,t,n,r,i))return!0;QQ(l,s,CV);return!!(i.intersectsBox(CV)&&DV(l,t,n,r,i))}{const i=t.geometry,c=i.index,u=i.attributes.position,h=n.index,d=n.attributes.position,f=nH(e,o),p=rH(l,a);if(IV.copy(r).invert(),n.boundsTree){QQ(e,s,BV),BV.matrix.copy(IV),BV.needsUpdate=!0;const i=n.boundsTree.shapecast({intersectsBounds:e=>BV.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let n=f,r=p+f;n<r;n++)if(KH(MV,3*t.resolveTriangleIndex(n),c,u),MV.needsUpdate=!0,e.intersectsTriangle(MV))return!0;return!1}});return i}for(let e=f,n=p+f;e<n;e++){const n=t.resolveTriangleIndex(e);KH(TV,3*n,c,u),TV.a.applyMatrix4(IV),TV.b.applyMatrix4(IV),TV.c.applyMatrix4(IV),TV.needsUpdate=!0;for(let e=0,t=h.count;e<t;e+=3)if(KH(MV,e,h,d),MV.needsUpdate=!0,TV.intersectsTriangle(MV))return!0}}}const LV=new cr,kV=new SH,FV=new SH,OV=new Dn,UV=new Dn,NV=new Dn,zV=new Dn;function GV(e,t,n,r={},i={},s=0,a=1/0){t.boundingBox||t.computeBoundingBox(),kV.set(t.boundingBox.min,t.boundingBox.max,n),kV.needsUpdate=!0;const o=e.geometry,l=o.attributes.position,c=o.index,u=t.attributes.position,h=t.index,d=TH.getPrimitive(),f=TH.getPrimitive();let p=OV,m=UV,g=null,A=null;i&&(g=NV,A=zV);let v=1/0,y=null,E=null;return LV.copy(n).invert(),FV.matrix.copy(LV),e.shapecast({boundsTraverseOrder:e=>kV.distanceToBox(e),intersectsBounds:(e,t,n)=>n<v&&n<a&&(t&&(FV.min.copy(e.min),FV.max.copy(e.max),FV.needsUpdate=!0),!0),intersectsRange:(r,i)=>{if(t.boundsTree){const o=t.boundsTree;return o.shapecast({boundsTraverseOrder:e=>FV.distanceToBox(e),intersectsBounds:(e,t,n)=>n<v&&n<a,intersectsRange:(t,a)=>{for(let _=t,x=t+a;_<x;_++){const t=o.resolveTriangleIndex(_);KH(f,3*t,h,u),f.a.applyMatrix4(n),f.b.applyMatrix4(n),f.c.applyMatrix4(n),f.needsUpdate=!0;for(let t=r,n=r+i;t<n;t++){const n=e.resolveTriangleIndex(t);KH(d,3*n,c,l),d.needsUpdate=!0;const r=d.distanceToTriangle(f,p,g);if(r<v&&(m.copy(p),A&&A.copy(g),v=r,y=t,E=_),r<s)return!0}}}})}for(let a=0,o=OQ(t);a<o;a++){KH(f,3*a,h,u),f.a.applyMatrix4(n),f.b.applyMatrix4(n),f.c.applyMatrix4(n),f.needsUpdate=!0;for(let t=r,n=r+i;t<n;t++){const n=e.resolveTriangleIndex(t);KH(d,3*n,c,l),d.needsUpdate=!0;const r=d.distanceToTriangle(f,p,g);if(r<v&&(m.copy(p),A&&A.copy(g),v=r,y=t,E=a),r<s)return!0}}}}),TH.releasePrimitive(d),TH.releasePrimitive(f),v===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=v,r.faceIndex=y,i&&(i.point?i.point.copy(A):i.point=A.clone(),i.point.applyMatrix4(LV),m.applyMatrix4(LV),i.distance=m.sub(i.point).length(),i.faceIndex=E),r)}const QV=new MH.constructor,HV=new MH.constructor,VV=new wH(()=>new Fn),jV=new Fn,WV=new Fn,YV=new Fn,KV=new Fn;let qV=!1;function XV(e,t,n,r,i,s=0,a=0,o=0,l=0,c=null,u=!1){let h,d;u?(h=HV,d=QV):(h=QV,d=HV);const f=h.float32Array,p=h.uint32Array,m=h.uint16Array,g=d.float32Array,A=d.uint32Array,v=d.uint16Array,y=2*t,E=tH(2*e,m),_=tH(y,v);let x=!1;if(_&&E)x=u?i(nH(t,A),rH(2*t,v),nH(e,p),rH(2*e,m),l,a+t,o,s+e):i(nH(e,p),rH(2*e,m),nH(t,A),rH(2*t,v),o,s+e,l,a+t);else if(_){const c=VV.getPrimitive();QQ(t,g,c),c.applyMatrix4(n);const h=iH(e),d=sH(e,p);QQ(h,f,jV),QQ(d,f,WV);const m=c.intersectsBox(jV),A=c.intersectsBox(WV);x=m&&XV(t,h,r,n,i,a,s,l,o+1,c,!u)||A&&XV(t,d,r,n,i,a,s,l,o+1,c,!u),VV.releasePrimitive(c)}else{const h=iH(t),d=sH(t,A);QQ(h,g,YV),QQ(d,g,KV);const m=c.intersectsBox(YV),v=c.intersectsBox(KV);if(m&&v)x=XV(e,h,n,r,i,s,a,o,l+1,c,u)||XV(e,d,n,r,i,s,a,o,l+1,c,u);else if(m)if(E)x=XV(e,h,n,r,i,s,a,o,l+1,c,u);else{const t=VV.getPrimitive();t.copy(YV).applyMatrix4(n);const c=iH(e),d=sH(e,p);QQ(c,f,jV),QQ(d,f,WV);const m=t.intersectsBox(jV),g=t.intersectsBox(WV);x=m&&XV(h,c,r,n,i,a,s,l,o+1,t,!u)||g&&XV(h,d,r,n,i,a,s,l,o+1,t,!u),VV.releasePrimitive(t)}else if(v)if(E)x=XV(e,d,n,r,i,s,a,o,l+1,c,u);else{const t=VV.getPrimitive();t.copy(KV).applyMatrix4(n);const c=iH(e),h=sH(e,p);QQ(c,f,jV),QQ(h,f,WV);const m=t.intersectsBox(jV),g=t.intersectsBox(WV);x=m&&XV(d,c,r,n,i,a,s,l,o+1,t,!u)||g&&XV(d,h,r,n,i,a,s,l,o+1,t,!u),VV.releasePrimitive(t)}}return x}const $V=new SH,JV=new Fn,ZV={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class ej{static serialize(e,t={}){t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,i=e._indirectBuffer,s=n.getIndex();let a;return a=t.cloneBuffers?{roots:r.map(e=>e.slice()),index:s?s.array.slice():null,indirectBuffer:i?i.slice():null}:{roots:r,index:s?s.array:null,indirectBuffer:i},a}static deserialize(e,t,n={}){n={setIndex:!0,indirect:Boolean(e.indirectBuffer),...n};const{index:r,roots:i,indirectBuffer:s}=e,a=new ej(t,{...n,[kQ]:!0});if(a._roots=i,a._indirectBuffer=s||null,n.setIndex){const n=t.getIndex();if(null===n){const n=new ci(e.index,1,!1);t.setIndex(n)}else n.array!==r&&(n.array.set(r),n.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({...ZV,[kQ]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[kQ]||(AH(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Fn))),this.resolveTriangleIndex=t.indirect?e=>this._indirectBuffer[e]:e=>e}refit(e=null){return(this.indirect?EV:XH)(this,e)}traverse(e,t=0){const n=this._roots[t],r=new Uint32Array(n),i=new Uint16Array(n);!function t(s,a=0){const o=2*s,l=i[o+15]===DQ;if(l){const t=r[s+6],c=i[o+14];e(a,l,new Float32Array(n,4*s,6),t,c)}else{const i=s+8,o=r[s+6],c=r[s+7];e(a,l,new Float32Array(n,4*s,6),c)||(t(i,a+1),t(o,a+1))}}(0)}raycast(e,t=0,n=0,r=1/0){const i=this._roots,s=this.geometry,a=[],o=t.isMaterial,l=Array.isArray(t),c=s.groups,u=o?t.side:t,h=this.indirect?_V:ZH;for(let s=0,o=i.length;s<o;s++){const i=l?t[c[s].materialIndex].side:u,o=a.length;if(h(this,s,i,e,a,n,r),l){const e=c[s].materialIndex;for(let t=o,n=a.length;t<n;t++)a[t].face.materialIndex=e}}return a}raycastFirst(e,t=0,n=0,r=1/0){const i=this._roots,s=this.geometry,a=t.isMaterial,o=Array.isArray(t);let l=null;const c=s.groups,u=a?t.side:t,h=this.indirect?SV:nV;for(let s=0,a=i.length;s<a;s++){const i=h(this,s,o?t[c[s].materialIndex].side:u,e,n,r);null!=i&&(null==l||i.distance<l.distance)&&(l=i,o&&(i.face.materialIndex=c[s].materialIndex))}return l}intersectsGeometry(e,t){let n=!1;const r=this._roots,i=this.indirect?PV:uV;for(let s=0,a=r.length;s<a&&(n=i(this,s,e,t),!n);s++);return n}shapecast(e){const t=TH.getPrimitive(),n=this.indirect?JH:qH;let{boundsTraverseOrder:r,intersectsBounds:i,intersectsRange:s,intersectsTriangle:a}=e;if(s&&a){const e=s;s=(r,i,s,o,l)=>!!e(r,i,s,o,l)||n(r,i,this,a,s,o,t)}else s||(s=a?(e,r,i,s)=>n(e,r,this,a,i,s,t):(e,t,n)=>n);let o=!1,l=0;const c=this._roots;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(o=DH(this,e,i,s,r,l),o)break;l+=t.byteLength}return TH.releasePrimitive(t),o}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:i}=n;const s=TH.getPrimitive(),a=this.geometry.index,o=this.geometry.attributes.position,l=this.indirect?e=>{const t=this.resolveTriangleIndex(e);KH(s,3*t,a,o)}:e=>{KH(s,3*e,a,o)},c=TH.getPrimitive(),u=e.geometry.index,h=e.geometry.attributes.position,d=e.indirect?t=>{const n=e.resolveTriangleIndex(t);KH(c,3*n,u,h)}:e=>{KH(c,3*e,u,h)};if(i){const e=(e,n,r,a,o,u,h,f)=>{for(let p=r,m=r+a;p<m;p++){d(p),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let t=e,r=e+n;t<r;t++)if(l(t),s.needsUpdate=!0,i(s,c,t,p,o,u,h,f))return!0}return!1};if(r){const t=r;r=function(n,r,i,s,a,o,l,c){return!!t(n,r,i,s,a,o,l,c)||e(n,r,i,s,a,o,l,c)}}else r=e}return function(e,t,n,r){if(qV)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");qV=!0;const i=e._roots,s=t._roots;let a,o=0,l=0;const c=(new cr).copy(n).invert();for(let e=0,t=i.length;e<t;e++){QV.setBuffer(i[e]),l=0;const t=VV.getPrimitive();QQ(oH(0),QV.float32Array,t),t.applyMatrix4(c);for(let e=0,i=s.length;e<i&&(HV.setBuffer(s[e]),a=XV(0,0,n,c,r,o,l,0,0,t),HV.clearBuffer(),l+=s[e].length,!a);e++);if(VV.releasePrimitive(t),QV.clearBuffer(),o+=i[e].length,a)break}return qV=!1,a}(this,e,t,r)}intersectsBox(e,t){return $V.set(e.min,e.max,t),$V.needsUpdate=!0,this.shapecast({intersectsBounds:e=>$V.intersectsBox(e),intersectsTriangle:e=>$V.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},i=0,s=1/0){return(this.indirect?GV:yV)(this,e,t,n,r,i,s)}closestPointToPoint(e,t={},n=0,r=1/0){return function(e,t,n={},r=0,i=1/0){const s=r*r,a=i*i;let o=1/0,l=null;if(e.shapecast({boundsTraverseOrder:e=>(kH.copy(t).clamp(e.min,e.max),kH.distanceToSquared(t)),intersectsBounds:(e,t,n)=>n<o&&n<a,intersectsTriangle:(e,n)=>{e.closestPointToPoint(t,kH);const r=t.distanceToSquared(kH);return r<o&&(FH.copy(kH),o=r,l=n),r<s}}),o===1/0)return null;const c=Math.sqrt(o);return n.point?n.point.copy(FH):n.point=FH.clone(),n.distance=c,n.faceIndex=l,n}(this,e,t,n,r)}getBoundingBox(e){e.makeEmpty();return this._roots.forEach(t=>{QQ(0,new Float32Array(t),JV),e.union(JV)}),e}}function tj(e,t,n){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(n.ray.origin),e.object=t,e)}const nj=new lr,rj=new Dn,ij=new cr,sj=Ui.prototype.raycast,aj=null,oj=new Dn,lj=new Ui,cj=[];function uj(e,t){this.isBatchedMesh?hj.call(this,e,t):dj.call(this,e,t)}function hj(e,t){if(this.boundsTrees){const n=this.boundsTrees,r=this._drawInfo,i=this._drawRanges,s=this.matrixWorld;lj.material=this.material,lj.geometry=this.geometry;const a=lj.geometry.boundsTree,o=lj.geometry.drawRange;null===lj.geometry.boundingSphere&&(lj.geometry.boundingSphere=new er);for(let a=0,o=r.length;a<o;a++){if(!this.getVisibleAt(a))continue;const o=r[a].geometryIndex;if(lj.geometry.boundsTree=n[o],this.getMatrixAt(a,lj.matrixWorld).premultiply(s),!lj.geometry.boundsTree){this.getBoundingBoxAt(o,lj.geometry.boundingBox),this.getBoundingSphereAt(o,lj.geometry.boundingSphere);const e=i[o];lj.geometry.setDrawRange(e.start,e.count)}lj.raycast(e,cj);for(let e=0,n=cj.length;e<n;e++){const n=cj[e];n.object=this,n.batchId=a,t.push(n)}cj.length=0}lj.geometry.boundsTree=a,lj.geometry.drawRange=o,lj.material=null,lj.geometry=null}else aj.call(this,e,t)}function dj(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;ij.copy(this.matrixWorld).invert(),nj.copy(e.ray).applyMatrix4(ij),oj.setFromMatrixScale(this.matrixWorld),rj.copy(nj.direction).multiply(oj);const n=rj.length(),r=e.near/n,i=e.far/n,s=this.geometry.boundsTree;if(!0===e.firstHitOnly){const n=tj(s.raycastFirst(nj,this.material,r,i),this,e);n&&t.push(n)}else{const n=s.raycast(nj,this.material,r,i);for(let r=0,i=n.length;r<i;r++){const i=tj(n[r],this,e);i&&t.push(i)}}}else sj.call(this,e,t)}function fj(e={}){return this.boundsTree=new ej(this,e),this.boundsTree}function pj(){this.boundsTree=null}function mj(e){switch(e){case 1:return be;case 2:return we;case 3:case 4:return Ce}}class gj extends wl{constructor(){super(),this.minFilter=te,this.magFilter=te,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const t=this.overrideItemSize,n=e.itemSize,r=e.count;if(null!==t){if(n*r%t!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=t,e.count=r*n/t}const i=e.itemSize,s=e.count,a=e.normalized,o=e.array.constructor,l=o.BYTES_PER_ELEMENT;let c,u,h,d,f=this._forcedType,p=i;if(null===f)switch(o){case Float32Array:f=pe;break;case Uint8Array:case Uint16Array:case Uint32Array:f=fe;break;case Int8Array:case Int16Array:case Int32Array:f=de}let m=function(e){switch(e){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw new Error}(i);switch(f){case pe:h=1,u=function(e){switch(e){case 1:return xe;case 2:return Se;case 3:case 4:return ye}}(i),a&&1===l?(d=o,m+="8",o===Uint8Array?c=le:(c=ce,m+="_SNORM")):(d=Float32Array,m+="32F",c=pe);break;case de:m+=8*l+"I",h=a?Math.pow(2,8*o.BYTES_PER_ELEMENT-1):1,u=mj(i),1===l?(d=Int8Array,c=ce):2===l?(d=Int16Array,c=ue):(d=Int32Array,c=de);break;case fe:m+=8*l+"UI",h=a?Math.pow(2,8*o.BYTES_PER_ELEMENT-1):1,u=mj(i),1===l?(d=Uint8Array,c=le):2===l?(d=Uint16Array,c=he):(d=Uint32Array,c=fe)}3!==p||u!==ye&&u!==Ce||(p=4);const g=Math.ceil(Math.sqrt(s))||1,A=new d(p*g*g),v=e.normalized;e.normalized=!1;for(let t=0;t<s;t++){const n=p*t;A[n]=e.getX(t)/h,i>=2&&(A[n+1]=e.getY(t)/h),i>=3&&(A[n+2]=e.getZ(t)/h,4===p&&(A[n+3]=1)),i>=4&&(A[n+3]=e.getW(t)/h)}e.normalized=v,this.internalFormat=m,this.format=u,this.type=c,this.image.width=g,this.image.height=g,this.image.data=A,this.needsUpdate=!0,this.dispose(),e.itemSize=n,e.count=r}}class Aj extends gj{constructor(){super(),this._forcedType=fe}}class vj extends gj{constructor(){super(),this._forcedType=pe}}class yj{constructor(){this.index=new Aj,this.position=new vj,this.bvhBounds=new wl,this.bvhContents=new wl,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:t}=e;if(function(e,t,n){const r=e._roots;if(1!==r.length)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const i=r[0],s=new Uint16Array(i),a=new Uint32Array(i),o=new Float32Array(i),l=i.byteLength/PQ,c=2*Math.ceil(Math.sqrt(l/2)),u=new Float32Array(4*c*c),h=Math.ceil(Math.sqrt(l)),d=new Uint32Array(2*h*h);for(let e=0;e<l;e++){const t=e*PQ/4,n=2*t,r=oH(t);for(let t=0;t<3;t++)u[8*e+0+t]=o[r+0+t],u[8*e+4+t]=o[r+3+t];if(tH(n,s)){const r=rH(n,s),i=nH(t,a),o=4294901760|r;d[2*e+0]=o,d[2*e+1]=i}else{const n=4*sH(t,a)/PQ,r=aH(t,a);d[2*e+0]=r,d[2*e+1]=n}}t.image.data=u,t.image.width=c,t.image.height=c,t.format=ye,t.type=pe,t.internalFormat="RGBA32F",t.minFilter=te,t.magFilter=te,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose(),n.image.data=d,n.image.width=h,n.image.height=h,n.format=we,n.type=fe,n.internalFormat="RG32UI",n.minFilter=te,n.magFilter=te,n.generateMipmaps=!1,n.needsUpdate=!0,n.dispose()}(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){const n=e._indirectBuffer;if(null===this._cachedIndexAttr||this._cachedIndexAttr.count!==n.length)if(t.index)this._cachedIndexAttr=t.index.clone();else{const e=UQ(FQ(t));this._cachedIndexAttr=new ci(e,1,!1)}!function(e,t,n){const r=n.array,i=e.index?e.index.array:null;for(let e=0,n=t.length;e<n;e++){const n=3*e,s=3*t[e];for(let e=0;e<3;e++)r[n+e]=i?i[s+e]:s+e}}(t,n,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){const{index:e,position:t,bvhBounds:n,bvhContents:r}=this;e&&e.dispose(),t&&t.dispose(),n&&n.dispose(),r&&r.dispose()}}const Ej=e=>e.isMesh;function _j(t,n){n={strategy:2,verbose:!1,setBoundingBox:!0,maxDepth:40,maxLeafTris:10,indirect:!1,...n},e.useEffect(()=>{if(t.current){t.current.raycast=uj;const e=t.current.geometry;return e.computeBoundsTree=fj,e.disposeBoundsTree=pj,e.computeBoundsTree(n),()=>{e.boundsTree&&e.disposeBoundsTree()}}},[t,JSON.stringify(n)])}const xj=e.forwardRef(({enabled:t=!0,firstHitOnly:n=!1,children:r,strategy:i=2,verbose:s=!1,setBoundingBox:a=!0,maxDepth:o=40,maxLeafTris:l=10,indirect:c=!1,...u},h)=>{const d=e.useRef(null),f=zp(e=>e.raycaster);return e.useImperativeHandle(h,()=>d.current,[]),e.useEffect(()=>{if(t){const e={strategy:i,verbose:s,setBoundingBox:a,maxDepth:o,maxLeafTris:l,indirect:c},t=d.current;return f.firstHitOnly=n,t.traverse(t=>{Ej(t)&&!t.geometry.boundsTree&&t.raycast===Ui.prototype.raycast&&(t.raycast=uj,t.geometry.computeBoundsTree=fj,t.geometry.disposeBoundsTree=pj,t.geometry.computeBoundsTree(e))}),()=>{delete f.firstHitOnly,t.traverse(e=>{Ej(e)&&e.geometry.boundsTree&&(e.geometry.disposeBoundsTree(),e.raycast=Ui.prototype.raycast)})}}},[]),e.createElement("group",Lm({ref:d},u),r)});function bj(...t){const n=e.useRef([]);return n.current=t.map(t=>e.useContext(t)),e.useMemo(()=>({children:r})=>t.reduceRight((t,r,i)=>e.createElement(r.Provider,{value:n.current[i],children:t}),r),[])}function Sj(t,n){const r=e.useRef(),[i]=e.useState(()=>n?n instanceof Lr?{current:n}:n:r),[s]=e.useState(()=>new gd(void 0));e.useLayoutEffect(()=>{n&&(i.current=n instanceof Lr?n:n.current),s._root=i.current});const a=e.useRef({}),o=e.useMemo(()=>{const e={};return t.forEach(t=>Object.defineProperty(e,t.name,{enumerable:!0,get(){if(i.current)return a.current[t.name]||(a.current[t.name]=s.clipAction(t,i.current))},configurable:!0})),{ref:i,clips:t,actions:e,names:t.map(e=>e.name),mixer:s}},[t]);return Gp((e,t)=>s.update(t)),e.useEffect(()=>{const e=i.current;return()=>{a.current={},s.stopAllAction(),Object.values(o.actions).forEach(t=>{e&&s.uncacheAction(t,e)})}},[t]),o}function wj(t){const n=e.useRef(null),r=e.useRef(!1),i=e.useRef(!1),s=e.useRef(t);return e.useLayoutEffect(()=>{s.current=t},[t]),e.useEffect(()=>{const e=n.current;if(e){const t=Rp(()=>(r.current=!1,!0)),n=e.onBeforeRender;e.onBeforeRender=()=>r.current=!0;const a=Bp(()=>(r.current!==i.current&&(null==s.current||s.current(i.current=r.current)),!0));return()=>{e.onBeforeRender=n,t(),a()}}},[]),n}function Cj(t=new Dn,n=new Dn){const[r]=e.useState(()=>({position:new Dn,size:new Dn}));Xp(r,{position:t,size:n});const i=e.useRef(null),s=e.useMemo(()=>({ref:i,onBeforeCompile:e=>function(e,t,n){e.defines.BOX_PROJECTED_ENV_MAP=!0,e.uniforms.envMapPosition={value:t},e.uniforms.envMapSize={value:n},e.vertexShader=`\n  varying vec3 vWorldPosition;\n  ${e.vertexShader.replace("#include <worldpos_vertex>","\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n  #ifdef BOX_PROJECTED_ENV_MAP\n    vWorldPosition = worldPosition.xyz;\n  #endif\n#endif\n")}`,e.fragmentShader=`\n    \n#ifdef BOX_PROJECTED_ENV_MAP\n  uniform vec3 envMapSize;\n  uniform vec3 envMapPosition;\n  varying vec3 vWorldPosition;\n    \n  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {\n    vec3 nDir = normalize( v );\n    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbminmax;\n    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;\n    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;\n    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;\n    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );\n    vec3 boxIntersection = vWorldPosition + nDir * correction;    \n    return boxIntersection - cubePos;\n  }\n#endif\n\n    ${e.fragmentShader.replace("#include <envmap_physical_pars_fragment>",ls.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n         \n#ifdef BOX_PROJECTED_ENV_MAP\n  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );\n#endif\n\n         ").replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );","reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n         \n#ifdef BOX_PROJECTED_ENV_MAP\n  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );\n#endif\n\n        ")}`}(e,r.position,r.size),customProgramCacheKey:()=>JSON.stringify(r.position.toArray())+JSON.stringify(r.size.toArray())}),[...r.position.toArray(),...r.size.toArray()]);return e.useLayoutEffect(()=>{i.current.needsUpdate=!0},[r]),s}const Tj=new Fn,Mj=new Dn,Ij=({anchor:t,...n})=>{const r=e.useRef(null),i=e.useRef(null);return e.useEffect(()=>{var e;null!=(e=r.current)&&null!=(e=e.parent)&&e.parent&&(i.current=r.current.parent,r.current.parent.parent.add(r.current))},[]),Gp(()=>{i.current&&(Tj.setFromObject(i.current),Tj.getSize(Mj),r.current.position.set(i.current.position.x+Mj.x*(Array.isArray(t)?t[0]:t.x)/2,i.current.position.y+Mj.y*(Array.isArray(t)?t[1]:t.y)/2,i.current.position.z+Mj.z*(Array.isArray(t)?t[2]:t.z)/2))}),e.createElement("group",Lm({ref:r},n))};const Rj=e=>Math.sqrt(1-Math.pow(e-1,2));class Bj{constructor({size:e=256,maxAge:t=750,radius:n=.3,intensity:r=.2,interpolate:i=0,smoothing:s=0,minForce:a=.3,blend:o="screen",ease:l=Rj}={}){this.size=e,this.maxAge=t,this.radius=n,this.intensity=r,this.ease=l,this.interpolate=i,this.smoothing=s,this.minForce=a,this.blend=o,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size;const e=this.canvas.getContext("2d");if(null===e)throw new Error("2D not available");this.ctx=e,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new Cn(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(e){this.clear(),this.trail.forEach((t,n)=>{t.age+=1e3*e,t.age>this.maxAge&&this.trail.splice(n,1)}),this.trail.length||(this.force=0),this.trail.forEach(e=>{this.drawTouch(e)}),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(e){const t=this.trail[this.trail.length-1];if(t){const n=t.x-e.x,r=t.y-e.y,i=n*n+r*r,s=Math.max(this.minForce,Math.min(1e4*i,1));if(this.force=function(e,t,n=.9){return t*n+e*(1-n)}(s,this.force,this.smoothing),this.interpolate){const e=Math.ceil(i/Math.pow(.5*this.radius/this.interpolate,2));if(e>1)for(let i=1;i<e;i++)this.trail.push({x:t.x-n/e*i,y:t.y-r/e*i,age:0,force:s})}}this.trail.push({x:e.x,y:e.y,age:0,force:this.force})}drawTouch(e){const t={x:e.x*this.size,y:(1-e.y)*this.size};let n=1;n=e.age<.3*this.maxAge?this.ease(e.age/(.3*this.maxAge)):this.ease(1-(e.age-.3*this.maxAge)/(.7*this.maxAge)),n*=e.force,this.ctx.globalCompositeOperation=this.blend;const r=this.size*this.radius*n,i=this.ctx.createRadialGradient(t.x,t.y,Math.max(0,.25*r),t.x,t.y,Math.max(0,r));i.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),i.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.arc(t.x,t.y,Math.max(0,r),0,2*Math.PI),this.ctx.fill()}}function Pj(e={}){const{size:t,maxAge:n,radius:r,intensity:i,interpolate:s,smoothing:a,minForce:o,blend:c,ease:h}=e,d=l(()=>new Bj(e),[t,n,r,i,s,a,o,c,h]);Gp((e,t)=>{d.update(t)});const f=u(e=>d.addTouch(e.uv),[d]);return[d.texture,f]}const Dj=({children:t,...n})=>{const r=Pj(n);return e.createElement(e.Fragment,null,null==t?void 0:t(r))},Lj=e.forwardRef(function({children:t,disable:n,disableX:r,disableY:i,disableZ:s,left:a,right:o,top:l,bottom:c,front:u,back:h,onCentered:d,precise:f=!0,cacheKey:p=0,...m},g){const A=e.useRef(null),v=e.useRef(null),y=e.useRef(null);return e.useLayoutEffect(()=>{v.current.matrixWorld.identity();const e=(new Fn).setFromObject(y.current,f),t=new Dn,p=new er,m=e.max.x-e.min.x,g=e.max.y-e.min.y,E=e.max.z-e.min.z;e.getCenter(t),e.getBoundingSphere(p);const _=l?g/2:c?-g/2:0,x=a?-m/2:o?m/2:0,b=u?E/2:h?-E/2:0;v.current.position.set(n||r?0:-t.x+x,n||i?0:-t.y+_,n||s?0:-t.z+b),void 0!==d&&d({parent:A.current.parent,container:A.current,width:m,height:g,depth:E,boundingBox:e,boundingSphere:p,center:t,verticalAlignment:_,horizontalAlignment:x,depthAlignment:b})},[p,d,l,a,u,n,r,i,s,f,o,c,h]),e.useImperativeHandle(g,()=>A.current,[]),e.createElement("group",Lm({ref:A},m),e.createElement("group",{ref:v},e.createElement("group",{ref:y},t)))}),kj=e.forwardRef(({font:t,color:n="#cbcbcb",bevelSize:r=.04,debug:i=!1,children:s,...a},o)=>{const[l,c]=e.useState(0),u=e.useCallback((e=1)=>c(l+e),[l]),h=e.useCallback((e=1)=>c(l-e),[l]),d=e.useMemo(()=>({incr:u,decr:h}),[u,h]);return e.useImperativeHandle(o,()=>d,[d]),e.createElement("group",a,e.createElement(e.Suspense,{fallback:null},e.createElement(Lj,{top:!0,cacheKey:JSON.stringify({counter:l,font:t})},e.createElement(XI,{bevelEnabled:!0,bevelSize:r,font:t},i?e.createElement("meshNormalMaterial",{wireframe:!0}):e.createElement("meshStandardMaterial",{color:n}),l))),s)});var Fj,Oj={exports:{}},Uj={exports:{}},Nj={};var zj,Gj,Qj,Hj,Vj,jj,Wj,Yj,Kj,qj,Xj,$j,Jj,Zj,eW,tW={};function nW(){return Gj||(Gj=1,"production"===process.env.NODE_ENV?Uj.exports=function(){if(Fj)return Nj;Fj=1;var e="function"==typeof Symbol&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,s=e?Symbol.for("react.profiler"):60114,a=e?Symbol.for("react.provider"):60109,o=e?Symbol.for("react.context"):60110,l=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,h=e?Symbol.for("react.suspense"):60113,d=e?Symbol.for("react.suspense_list"):60120,f=e?Symbol.for("react.memo"):60115,p=e?Symbol.for("react.lazy"):60116,m=e?Symbol.for("react.block"):60121,g=e?Symbol.for("react.fundamental"):60117,A=e?Symbol.for("react.responder"):60118,v=e?Symbol.for("react.scope"):60119;function y(e){if("object"==typeof e&&null!==e){var d=e.$$typeof;switch(d){case t:switch(e=e.type){case l:case c:case r:case s:case i:case h:return e;default:switch(e=e&&e.$$typeof){case o:case u:case p:case f:case a:return e;default:return d}}case n:return d}}}function E(e){return y(e)===c}return Nj.AsyncMode=l,Nj.ConcurrentMode=c,Nj.ContextConsumer=o,Nj.ContextProvider=a,Nj.Element=t,Nj.ForwardRef=u,Nj.Fragment=r,Nj.Lazy=p,Nj.Memo=f,Nj.Portal=n,Nj.Profiler=s,Nj.StrictMode=i,Nj.Suspense=h,Nj.isAsyncMode=function(e){return E(e)||y(e)===l},Nj.isConcurrentMode=E,Nj.isContextConsumer=function(e){return y(e)===o},Nj.isContextProvider=function(e){return y(e)===a},Nj.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},Nj.isForwardRef=function(e){return y(e)===u},Nj.isFragment=function(e){return y(e)===r},Nj.isLazy=function(e){return y(e)===p},Nj.isMemo=function(e){return y(e)===f},Nj.isPortal=function(e){return y(e)===n},Nj.isProfiler=function(e){return y(e)===s},Nj.isStrictMode=function(e){return y(e)===i},Nj.isSuspense=function(e){return y(e)===h},Nj.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===c||e===s||e===i||e===h||e===d||"object"==typeof e&&null!==e&&(e.$$typeof===p||e.$$typeof===f||e.$$typeof===a||e.$$typeof===o||e.$$typeof===u||e.$$typeof===g||e.$$typeof===A||e.$$typeof===v||e.$$typeof===m)},Nj.typeOf=y,Nj}():Uj.exports=(zj||(zj=1,"production"!==process.env.NODE_ENV&&function(){var e="function"==typeof Symbol&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,s=e?Symbol.for("react.profiler"):60114,a=e?Symbol.for("react.provider"):60109,o=e?Symbol.for("react.context"):60110,l=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,h=e?Symbol.for("react.suspense"):60113,d=e?Symbol.for("react.suspense_list"):60120,f=e?Symbol.for("react.memo"):60115,p=e?Symbol.for("react.lazy"):60116,m=e?Symbol.for("react.block"):60121,g=e?Symbol.for("react.fundamental"):60117,A=e?Symbol.for("react.responder"):60118,v=e?Symbol.for("react.scope"):60119;function y(e){if("object"==typeof e&&null!==e){var d=e.$$typeof;switch(d){case t:var m=e.type;switch(m){case l:case c:case r:case s:case i:case h:return m;default:var g=m&&m.$$typeof;switch(g){case o:case u:case p:case f:case a:return g;default:return d}}case n:return d}}}var E=l,_=c,x=o,b=a,S=t,w=u,C=r,T=p,M=f,I=n,R=s,B=i,P=h,D=!1;function L(e){return y(e)===c}tW.AsyncMode=E,tW.ConcurrentMode=_,tW.ContextConsumer=x,tW.ContextProvider=b,tW.Element=S,tW.ForwardRef=w,tW.Fragment=C,tW.Lazy=T,tW.Memo=M,tW.Portal=I,tW.Profiler=R,tW.StrictMode=B,tW.Suspense=P,tW.isAsyncMode=function(e){return D||(D=!0),L(e)||y(e)===l},tW.isConcurrentMode=L,tW.isContextConsumer=function(e){return y(e)===o},tW.isContextProvider=function(e){return y(e)===a},tW.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},tW.isForwardRef=function(e){return y(e)===u},tW.isFragment=function(e){return y(e)===r},tW.isLazy=function(e){return y(e)===p},tW.isMemo=function(e){return y(e)===f},tW.isPortal=function(e){return y(e)===n},tW.isProfiler=function(e){return y(e)===s},tW.isStrictMode=function(e){return y(e)===i},tW.isSuspense=function(e){return y(e)===h},tW.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===c||e===s||e===i||e===h||e===d||"object"==typeof e&&null!==e&&(e.$$typeof===p||e.$$typeof===f||e.$$typeof===a||e.$$typeof===o||e.$$typeof===u||e.$$typeof===g||e.$$typeof===A||e.$$typeof===v||e.$$typeof===m)},tW.typeOf=y}()),tW)),Uj.exports}function rW(){if(Hj)return Qj;Hj=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;return Qj=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==r.join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(e){i[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(r,i){for(var s,a,o=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(r),l=1;l<arguments.length;l++){for(var c in s=Object(arguments[l]))t.call(s,c)&&(o[c]=s[c]);if(e){a=e(s);for(var u=0;u<a.length;u++)n.call(s,a[u])&&(o[a[u]]=s[a[u]])}}return o},Qj}function iW(){if(jj)return Vj;jj=1;return Vj="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function sW(){return Yj?Wj:(Yj=1,Wj=Function.call.bind(Object.prototype.hasOwnProperty))}function aW(){if(qj)return Kj;qj=1;var e=function(){};if("production"!==process.env.NODE_ENV){var t=iW(),n={},r=sW();e=function(e){var t="Warning: "+e;try{throw new Error(t)}catch(e){}}}function i(i,s,a,o,l){if("production"!==process.env.NODE_ENV)for(var c in i)if(r(i,c)){var u;try{if("function"!=typeof i[c]){var h=Error((o||"React class")+": "+a+" type `"+c+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof i[c]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw h.name="Invariant Violation",h}u=i[c](s,c,o,a,null,t)}catch(e){u=e}if(!u||u instanceof Error||e((o||"React class")+": type specification of "+a+" `"+c+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof u+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),u instanceof Error&&!(u.message in n)){n[u.message]=!0;var d=l?l():"";e("Failed "+a+" type: "+u.message+(null!=d?d:""))}}}return i.resetWarningCache=function(){"production"!==process.env.NODE_ENV&&(n={})},Kj=i}function oW(){if($j)return Xj;$j=1;var e=nW(),t=rW(),n=iW(),r=sW(),i=aW(),s=function(){};function a(){return null}return"production"!==process.env.NODE_ENV&&(s=function(e){var t="Warning: "+e;try{throw new Error(t)}catch(e){}}),Xj=function(o,l){var c="function"==typeof Symbol&&Symbol.iterator;var u="<<anonymous>>",h={array:m("array"),bigint:m("bigint"),bool:m("boolean"),func:m("function"),number:m("number"),object:m("object"),string:m("string"),symbol:m("symbol"),any:p(a),arrayOf:function(e){return p(function(t,r,i,s,a){if("function"!=typeof e)return new f("Property `"+a+"` of component `"+i+"` has invalid PropType notation inside arrayOf.");var o=t[r];if(!Array.isArray(o))return new f("Invalid "+s+" `"+a+"` of type `"+v(o)+"` supplied to `"+i+"`, expected an array.");for(var l=0;l<o.length;l++){var c=e(o,l,i,s,a+"["+l+"]",n);if(c instanceof Error)return c}return null})},element:p(function(e,t,n,r,i){var s=e[t];return o(s)?null:new f("Invalid "+r+" `"+i+"` of type `"+v(s)+"` supplied to `"+n+"`, expected a single ReactElement.")}),elementType:p(function(t,n,r,i,s){var a=t[n];return e.isValidElementType(a)?null:new f("Invalid "+i+" `"+s+"` of type `"+v(a)+"` supplied to `"+r+"`, expected a single ReactElement type.")}),instanceOf:function(e){return p(function(t,n,r,i,s){if(!(t[n]instanceof e)){var a=e.name||u;return new f("Invalid "+i+" `"+s+"` of type `"+(((o=t[n]).constructor&&o.constructor.name?o.constructor.name:u)+"` supplied to `")+r+"`, expected instance of `"+a+"`.")}var o;return null})},node:p(function(e,t,n,r,i){return A(e[t])?null:new f("Invalid "+r+" `"+i+"` supplied to `"+n+"`, expected a ReactNode.")}),objectOf:function(e){return p(function(t,i,s,a,o){if("function"!=typeof e)return new f("Property `"+o+"` of component `"+s+"` has invalid PropType notation inside objectOf.");var l=t[i],c=v(l);if("object"!==c)return new f("Invalid "+a+" `"+o+"` of type `"+c+"` supplied to `"+s+"`, expected an object.");for(var u in l)if(r(l,u)){var h=e(l,u,s,a,o+"."+u,n);if(h instanceof Error)return h}return null})},oneOf:function(e){if(!Array.isArray(e))return"production"!==process.env.NODE_ENV&&s(arguments.length>1?"Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).":"Invalid argument supplied to oneOf, expected an array."),a;return p(function(t,n,r,i,s){for(var a=t[n],o=0;o<e.length;o++)if(d(a,e[o]))return null;var l=JSON.stringify(e,function(e,t){return"symbol"===y(t)?String(t):t});return new f("Invalid "+i+" `"+s+"` of value `"+String(a)+"` supplied to `"+r+"`, expected one of "+l+".")})},oneOfType:function(e){if(!Array.isArray(e))return"production"!==process.env.NODE_ENV&&s("Invalid argument supplied to oneOfType, expected an instance of array."),a;for(var t=0;t<e.length;t++){var i=e[t];if("function"!=typeof i)return s("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+E(i)+" at index "+t+"."),a}return p(function(t,i,s,a,o){for(var l=[],c=0;c<e.length;c++){var u=(0,e[c])(t,i,s,a,o,n);if(null==u)return null;u.data&&r(u.data,"expectedType")&&l.push(u.data.expectedType)}return new f("Invalid "+a+" `"+o+"` supplied to `"+s+"`"+(l.length>0?", expected one of type ["+l.join(", ")+"]":"")+".")})},shape:function(e){return p(function(t,r,i,s,a){var o=t[r],l=v(o);if("object"!==l)return new f("Invalid "+s+" `"+a+"` of type `"+l+"` supplied to `"+i+"`, expected `object`.");for(var c in e){var u=e[c];if("function"!=typeof u)return g(i,s,a,c,y(u));var h=u(o,c,i,s,a+"."+c,n);if(h)return h}return null})},exact:function(e){return p(function(i,s,a,o,l){var c=i[s],u=v(c);if("object"!==u)return new f("Invalid "+o+" `"+l+"` of type `"+u+"` supplied to `"+a+"`, expected `object`.");var h=t({},i[s],e);for(var d in h){var p=e[d];if(r(e,d)&&"function"!=typeof p)return g(a,o,l,d,y(p));if(!p)return new f("Invalid "+o+" `"+l+"` key `"+d+"` supplied to `"+a+"`.\nBad object: "+JSON.stringify(i[s],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var m=p(c,d,a,o,l+"."+d,n);if(m)return m}return null})}};function d(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function f(e,t){this.message=e,this.data=t&&"object"==typeof t?t:{},this.stack=""}function p(e){if("production"!==process.env.NODE_ENV)var t={},r=0;function i(i,a,o,c,h,d,p){if(c=c||u,d=d||o,p!==n){if(l){var m=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw m.name="Invariant Violation",m}if("production"!==process.env.NODE_ENV&&"undefined"!=typeof console){var g=c+":"+o;!t[g]&&r<3&&(s("You are manually calling a React.PropTypes validation function for the `"+d+"` prop on `"+c+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),t[g]=!0,r++)}}return null==a[o]?i?null===a[o]?new f("The "+h+" `"+d+"` is marked as required in `"+c+"`, but its value is `null`."):new f("The "+h+" `"+d+"` is marked as required in `"+c+"`, but its value is `undefined`."):null:e(a,o,c,h,d)}var a=i.bind(null,!1);return a.isRequired=i.bind(null,!0),a}function m(e){return p(function(t,n,r,i,s,a){var o=t[n];return v(o)!==e?new f("Invalid "+i+" `"+s+"` of type `"+y(o)+"` supplied to `"+r+"`, expected `"+e+"`.",{expectedType:e}):null})}function g(e,t,n,r,i){return new f((e||"React class")+": "+t+" type `"+n+"."+r+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+i+"`.")}function A(e){switch(typeof e){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(A);if(null===e||o(e))return!0;var t=function(e){var t=e&&(c&&e[c]||e["@@iterator"]);if("function"==typeof t)return t}(e);if(!t)return!1;var n,r=t.call(e);if(t!==e.entries){for(;!(n=r.next()).done;)if(!A(n.value))return!1}else for(;!(n=r.next()).done;){var i=n.value;if(i&&!A(i[1]))return!1}return!0;default:return!1}}function v(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||!!t&&("Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol)}(t,e)?"symbol":t}function y(e){if(null==e)return""+e;var t=v(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function E(e){var t=y(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return f.prototype=Error.prototype,h.checkPropTypes=i,h.resetWarningCache=i.resetWarningCache,h.PropTypes=h,h},Xj}function lW(){if(Zj)return Jj;Zj=1;var e=iW();function t(){}function n(){}return n.resetWarningCache=t,Jj=function(){function r(t,n,r,i,s,a){if(a!==e){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function i(){return r}r.isRequired=r;var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:t};return s.PropTypes=s,s},Jj}function cW(){if(eW)return Oj.exports;if(eW=1,"production"!==process.env.NODE_ENV){var e=nW();Oj.exports=oW()(e.isElement,true)}else Oj.exports=lW()();return Oj.exports}var uW=Jd(cW());function hW(e){return dW(e.children,e.components)}function dW(e,t,n){if(n=n||[],!t[0])return e(n);function r(r){return dW(e,t.slice(1),n.concat([r]))}return"function"==typeof t[0]?t[0]({results:n,render:r}):p(t[0],{children:r})}hW.propTypes={children:uW.func.isRequired,components:uW.arrayOf(uW.oneOfType([uW.element,uW.func])).isRequired};const fW=(e,t)=>{"updateRanges"in e?e.updateRanges[0]=t:e.updateRange=t};const pW=new cr,mW=new cr,gW=[],AW=new Ui;class vW extends Lo{constructor(){super(),this.color=new $r("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){const n=this.instance.current;if(!n)return;if(!n.geometry||!n.material)return;AW.geometry=n.geometry;const r=n.matrixWorld,i=n.userData.instances.indexOf(this.instanceKey);if(!(-1===i||i>n.count)){n.getMatrixAt(i,pW),mW.multiplyMatrices(r,pW),AW.matrixWorld=mW,n.material instanceof ei?AW.material.side=n.material.side:AW.material.side=n.material[0].side,AW.raycast(e,gW);for(let e=0,n=gW.length;e<n;e++){const n=gW[e];n.instanceId=i,n.object=this,t.push(n)}gW.length=0}}}const yW=e.createContext(null),EW=new cr,_W=new cr,xW=new cr,bW=new Dn,SW=new Pn,wW=new Dn,CW=e.forwardRef(({context:t,children:n,...r},i)=>{e.useMemo(()=>Hf({PositionMesh:vW}),[]);const s=e.useRef();e.useImperativeHandle(i,()=>s.current,[]);const{subscribe:a,getParent:o}=e.useContext(t||yW);return e.useLayoutEffect(()=>a(s),[]),e.createElement("positionMesh",Lm({instance:o(),instanceKey:s,ref:s},r),n)}),TW=e.forwardRef(({context:t,children:n,range:r,limit:i=1e3,frames:s=1/0,...a},o)=>{const[{localContext:l,instance:c}]=e.useState(()=>{const t=e.createContext(null);return{localContext:t,instance:e.forwardRef((n,r)=>e.createElement(CW,Lm({context:t},n,{ref:r})))}}),u=e.useRef(null);e.useImperativeHandle(o,()=>u.current,[]);const[h,d]=e.useState([]),[[f,p]]=e.useState(()=>{const e=new Float32Array(16*i);for(let t=0;t<i;t++)xW.identity().toArray(e,16*t);return[e,new Float32Array([...new Array(3*i)].map(()=>1))]});e.useEffect(()=>{u.current.instanceMatrix.needsUpdate=!0});let m=0,g=0;const A=e.useRef([]);e.useLayoutEffect(()=>{A.current=Object.entries(u.current.geometry.attributes).filter(([e,t])=>t.isInstancedBufferAttribute)}),Gp(()=>{if(s===1/0||m<s){u.current.updateMatrix(),u.current.updateMatrixWorld(),EW.copy(u.current.matrixWorld).invert(),g=Math.min(i,void 0!==r?r:i,h.length),u.current.count=g,fW(u.current.instanceMatrix,{offset:0,count:16*g}),fW(u.current.instanceColor,{offset:0,count:3*g});for(let e=0;e<h.length;e++){const t=h[e].current;t.matrixWorld.decompose(bW,SW,wW),_W.compose(bW,SW,wW).premultiply(EW),_W.toArray(f,16*e),u.current.instanceMatrix.needsUpdate=!0,t.color.toArray(p,3*e),u.current.instanceColor.needsUpdate=!0}m++}});const v=e.useMemo(()=>({getParent:()=>u,subscribe:e=>(d(t=>[...t,e]),()=>d(t=>t.filter(t=>t.current!==e.current)))}),[]);return e.createElement("instancedMesh",Lm({userData:{instances:h,limit:i,frames:s},matrixAutoUpdate:!1,ref:u,args:[null,null,0],raycast:()=>null},a),e.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:f.length/16,array:f,itemSize:16,usage:Ft}),e.createElement("instancedBufferAttribute",{attach:"instanceColor",count:p.length/3,array:p,itemSize:3,usage:Ft}),"function"==typeof n?e.createElement(l.Provider,{value:v},n(c)):t?e.createElement(t.Provider,{value:v},n):e.createElement(yW.Provider,{value:v},n))}),MW=e.forwardRef(function({meshes:t,children:n,...r},i){const s=Array.isArray(t);if(!s)for(const e of Object.keys(t))t[e].isMesh||delete t[e];return e.createElement("group",{ref:i},e.createElement(hW,{components:(s?t:Object.values(t)).map(({geometry:t,material:n})=>e.createElement(TW,Lm({key:t.uuid,geometry:t,material:n},r)))},e=>s?n(...e):n(Object.keys(t).filter(e=>t[e].isMesh).reduce((t,n,r)=>({...t,[n]:e[r]}),{}))))});function IW(){const t=e.createContext(null);return[e.forwardRef((n,r)=>e.createElement(TW,Lm({ref:r,context:t},n))),e.forwardRef((n,r)=>e.createElement(CW,Lm({ref:r,context:t},n)))]}const RW=e.forwardRef(({name:t,defaultValue:n,normalized:r,usage:i=35048},s)=>{const a=e.useRef(null);e.useImperativeHandle(s,()=>a.current,[]),e.useLayoutEffect(()=>{const e=a.current.__r3f.parent;e.geometry.attributes[t]=a.current;const r=Array.isArray(n)?n:[n],i=Array.from({length:e.userData.limit},()=>r).flat();return a.current.array=new Float32Array(i),a.current.itemSize=r.length,a.current.count=i.length/a.current.itemSize,()=>{delete e.geometry.attributes[t]}},[t]);let o=0;return Gp(()=>{const e=a.current.__r3f.parent;if(e.userData.frames===1/0||o<e.userData.frames){for(let n=0;n<e.userData.instances.length;n++){const r=e.userData.instances[n].current[t];void 0!==r&&(a.current.set(Array.isArray(r)?r:"function"==typeof r.toArray?r.toArray():[r],n*a.current.itemSize),a.current.needsUpdate=!0)}o++}}),e.createElement("instancedBufferAttribute",{ref:a,usage:i,normalized:r})}),BW=e.createContext(null);function PW(){return e.useContext(BW)}const DW=new os(1,1),LW=e.forwardRef(({startFrame:t=0,endFrame:n,fps:r=30,frameName:i="",textureDataURL:s,textureImageURL:a,loop:o=!1,numberOfFrames:l=1,autoPlay:c=!0,animationNames:u,onStart:h,onEnd:d,onLoopEnd:f,onFrame:p,play:m,pause:g=!1,flipX:A=!1,alphaTest:v=0,children:y,asSprite:E=!1,offset:_,playBackwards:x=!1,resetOnEnd:b=!1,maxItems:S=1,instanceItems:w=[[0,0,0]],spriteDataset:C,canvasRenderingContext2DSettings:T,roundFramePosition:M=!1,meshProps:I={},...R},B)=>{const P=e.useRef(new Lo),D=e.useRef(null),L=e.useRef(null),k=e.useRef(null),F=e.useRef(window.performance.now()),O=e.useRef(t),U=e.useRef(i),N=r>0?1e3/r:0,[z,G]=e.useState(new Cn),Q=e.useRef(0),[H,V]=e.useState(new Dn(1,1,1)),j=A?-1:1,W=e.useRef(g),Y=e.useRef(_),K=e.useRef(!1),{spriteObj:q,loadJsonAndTexture:X}=rQ(null,null,u,l,void 0,T),$=e.useRef(i),Z=e.useCallback((e,t)=>{if(null===t)l&&(Q.current=l,x&&(O.current=l-1),D.current=t);else{var n,r;D.current=t,D.current&&Array.isArray(D.current.frames)?Q.current=D.current.frames.length:D.current&&"object"==typeof D.current&&$.current?Q.current=D.current.frames[$.current].length:Q.current=0,x&&(O.current=Q.current-1);const{w:i,h:s}=tQ(null!==(n=null==(r=D.current)?void 0:r.frames)&&void 0!==n?n:[],$.current).sourceSize,a=ne(i,s);V(a),L.current&&(L.current.map=e)}G(e)},[l,x]),ee=e.useCallback(()=>{if(!D.current)return;const{meta:{size:e},frames:t}=D.current,{w:n,h:r}=Array.isArray(t)?t[0].sourceSize:i&&t[i]?t[i][0].sourceSize:{w:0,h:0};L.current&&L.current.map&&(L.current.map.wrapS=L.current.map.wrapT=J,L.current.map.center.set(0,0),L.current.map.repeat.set(1*j/(e.w/n),1/(e.h/r)));const s=1/((e.h-1)/r);L.current&&L.current.map&&(L.current.map.offset.x=0,L.current.map.offset.y=1-s),h&&h({currentFrameName:null!=i?i:"",currentFrame:O.current})},[j,i,h]),te=e.useMemo(()=>({current:Y.current,offset:Y.current,imageUrl:a,hasEnded:!1,ref:B}),[a,B]);e.useImperativeHandle(B,()=>P.current,[]),e.useLayoutEffect(()=>{Y.current=_},[_]);const ne=(e,t)=>{var n;const r=new Dn,i=t/e;return r.set(1,i,1),null==(n=k.current)||n.scale.copy(r),r};e.useEffect(()=>{var e;C?Z(null==C||null==(e=C.spriteTexture)?void 0:e.clone(),C.spriteData):a&&s&&X(a,s)},[X,C,s,a,Z]),e.useEffect(()=>{var e;q&&Z(null==q||null==(e=q.spriteTexture)?void 0:e.clone(),null==q?void 0:q.spriteData)},[q,Z]),e.useEffect(()=>{var e;(te.hasEnded=!1,D.current&&!0===x)?O.current=(null!==(e=D.current.frames.length)&&void 0!==e?e:0)-1:O.current=0},[x,te]),e.useLayoutEffect(()=>{ee()},[z,A,ee]),e.useEffect(()=>{c&&(W.current=!1)},[c]),e.useLayoutEffect(()=>{if(U.current!==i&&i&&(O.current=0,U.current=i,te.hasEnded=!1,N<=0&&(O.current=n||t||0),D.current)){const{w:e,h:t}=tQ(D.current.frames,i).sourceSize,n=ne(e,t);V(n)}},[i,N,te,n,t]);const re=(e,t,n,r)=>{var i=void 0===_?te.current:_;const s=O.current;let a=0,o=0;ne(e,t);const l=M?Math.round((n.w-1)/e):(n.w-1)/e,c=M?Math.round((n.h-1)/t):(n.h-1)/t;if(!r[s])return;const{frame:{x:u,y:h},sourceSize:{w:d,h:f}}=r[s],p=1/l,m=1/c;if(L.current&&L.current.map&&(a=j>0?p*(u/d):p*(u/d)-L.current.map.repeat.x,o=Math.abs(1-m)-m*(h/f),L.current.map.offset.x=a,L.current.map.offset.y=o),null!=i){let e=Math.floor(i*r.length);e=Math.max(0,Math.min(e,r.length-1)),isNaN(e)&&(e=0),O.current=e}else x?O.current-=1:O.current+=1};return Gp((e,r)=>{var s,a;null!=(s=D.current)&&s.frames&&null!=(a=L.current)&&a.map&&(W.current||te.hasEnded||!c&&!m||((()=>{if(null===(e=D.current)||!("meta"in e)||!("frames"in e))return;var e;const{meta:{size:r},frames:s}=D.current,{w:a,h:l}=tQ(s,i).sourceSize,c=Array.isArray(s)?s:i?s[i]:[],u=n||c.length-1;var p=void 0===_?te.current:_;if(N<=0)return O.current=n||t||0,void re(a,l,r,c);const m=window.performance.now(),g=m-F.current;if(!(g<=N)){var A=x?O.current<0:O.current>u,v=x?O.current===u:0===O.current,y=x?O.current<0:O.current>=u;if(A){if(O.current=o&&null!=t?t:0,x&&(O.current=u),o?null==f||f({currentFrameName:null!=i?i:"",currentFrame:O.current}):(null==d||d({currentFrameName:null!=i?i:"",currentFrame:O.current}),te.hasEnded=!b,b&&(W.current=!0)),!o)return}else v&&(null==h||h({currentFrameName:null!=i?i:"",currentFrame:O.current}));void 0!==p&&y?!1===K.current&&(null==d||d({currentFrameName:null!=i?i:"",currentFrame:O.current}),K.current=!0):K.current=!1,g<=N||(F.current=m-g%N,re(a,l,r,c))}})(),null==p||p({currentFrameName:U.current,currentFrame:O.current})))}),e.createElement("group",Lm({},R,{ref:P,scale:function(e=new Dn(1,1,1),t=1){return"number"==typeof t?e.multiplyScalar(t):Array.isArray(t)?e.multiply(new Dn(...t)):t instanceof Dn?e.multiply(t):void 0}(H,R.scale)}),e.createElement(BW.Provider,{value:te},E&&e.createElement(pM,null,e.createElement("mesh",Lm({ref:k,scale:1,geometry:DW},I),e.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:2,ref:L,map:z,transparent:!0,alphaTest:null!=v?v:0}))),!E&&e.createElement(TW,Lm({geometry:DW,limit:null!=S?S:1},I),e.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:2,ref:L,map:z,transparent:!0,alphaTest:null!=v?v:0}),(null!=w?w:[0]).map((t,n)=>e.createElement(CW,Lm({key:n,ref:1===(null==w?void 0:w.length)?k:null,position:t,scale:1},I)))),y))}),kW=e.forwardRef(({children:t,curve:n},r)=>{const[i]=e.useState(()=>new jo),[s,a]=e.useState(),o=e.useRef(null);return e.useLayoutEffect(()=>{o.current=new kx(i.children[0]),a(o.current.object3D)},[t]),e.useEffect(()=>{var e;n&&(null==(e=o.current)||e.updateCurve(0,n))},[n]),e.useImperativeHandle(r,()=>o.current),e.createElement(e.Fragment,null,rm(t,i),s&&e.createElement("primitive",{object:s}))});class FW extends Bu{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`\n      uniform float time;\n      uniform float radius;\n      uniform float distort;\n      #define GLSLIFY 1\nvec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n        float updateTime = time / 50.0;\n        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));\n        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));\n        ")}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}const OW=e.forwardRef(({speed:t=1,...n},r)=>{const[i]=e.useState(()=>new FW);return Gp(e=>i&&(i.time=e.clock.elapsedTime*t)),e.createElement("primitive",Lm({object:i,ref:r,attach:"material"},n))});class UW extends Ru{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`\n      uniform float time;\n      uniform float factor;\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","float theta = sin( time + position.y ) / 2.0 * factor;\n        float c = cos( theta );\n        float s = sin( theta );\n        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );\n        vec3 transformed = vec3( position ) * m;\n        vNormal = vNormal * m;")}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}const NW=e.forwardRef(({speed:t=1,...n},r)=>{const[i]=e.useState(()=>new UW);return Gp(e=>i&&(i.time=e.clock.elapsedTime*t)),e.createElement("primitive",Lm({object:i,ref:r,attach:"material"},n))});class zW extends ji{constructor(e=new nn){super({uniforms:{inputBuffer:new Ad(null),depthBuffer:new Ad(null),resolution:new Ad(new nn),texelSize:new Ad(new nn),halfTexelSize:new Ad(new nn),kernel:new Ad(0),scale:new Ad(1),cameraNear:new Ad(0),cameraFar:new Ad(1),minDepthThreshold:new Ad(0),maxDepthThreshold:new Ad(1),depthScale:new Ad(0),depthToBlurRatioBias:new Ad(.25)},fragmentShader:`#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n          #include <tonemapping_fragment>\n          #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n        }`,vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:0,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class GW{constructor({gl:e,resolution:t,width:n=500,height:r=500,minDepthThreshold:i=0,maxDepthThreshold:s=1,depthScale:a=0,depthToBlurRatioBias:o=.25}){this.renderToScreen=!1,this.renderTargetA=new In(t,t,{minFilter:ie,magFilter:ie,stencilBuffer:!1,depthBuffer:!1,type:me}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new zW,this.convolutionMaterial.setTexelSize(1/n,1/r),this.convolutionMaterial.setResolution(new nn(n,r)),this.scene=new jo,this.camera=new Wi,this.convolutionMaterial.uniforms.minDepthThreshold.value=i,this.convolutionMaterial.uniforms.maxDepthThreshold.value=s,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=o,this.convolutionMaterial.defines.USE_DEPTH=a>0;const l=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),c=new Float32Array([0,0,2,0,0,2]),u=new Ei;u.setAttribute("position",new ci(l,3)),u.setAttribute("uv",new ci(c,2)),this.screen=new Ui(u,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,n){const r=this.scene,i=this.camera,s=this.renderTargetA,a=this.renderTargetB;let o=this.convolutionMaterial,l=o.uniforms;l.depthBuffer.value=t.depthTexture;const c=o.kernel;let u,h,d,f=t;for(h=0,d=c.length-1;h<d;++h)u=1&h?a:s,l.kernel.value=c[h],l.inputBuffer.value=f.texture,e.setRenderTarget(u),e.render(r,i),f=u;l.kernel.value=c[h],l.inputBuffer.value=f.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(r,i)}}class QW extends Ru{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;\n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;\n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n\n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n\n      vec4 merge = base;\n\n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n\n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n\n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);\n      ")}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}const HW=e.forwardRef(({mixBlur:t=0,mixStrength:n=1,resolution:r=256,blur:i=[0,0],minDepthThreshold:s=.9,maxDepthThreshold:a=1,depthScale:o=0,depthToBlurRatioBias:l=.25,mirror:c=0,distortion:u=1,mixContrast:h=1,distortionMap:d,reflectorOffset:f=0,...p},m)=>{Hf({MeshReflectorMaterialImpl:QW});const g=zp(({gl:e})=>e),A=zp(({camera:e})=>e),v=zp(({scene:e})=>e),y=(i=Array.isArray(i)?i:[i,i])[0]+i[1]>0,E=e.useRef(null);e.useImperativeHandle(m,()=>E.current,[]);const[_]=e.useState(()=>new ts),[x]=e.useState(()=>new Dn),[b]=e.useState(()=>new Dn),[S]=e.useState(()=>new Dn),[w]=e.useState(()=>new cr),[C]=e.useState(()=>new Dn(0,0,-1)),[T]=e.useState(()=>new Tn),[M]=e.useState(()=>new Dn),[I]=e.useState(()=>new Dn),[R]=e.useState(()=>new Tn),[B]=e.useState(()=>new cr),[P]=e.useState(()=>new Yi),D=e.useCallback(()=>{var e;const t=E.current.parent||(null==(e=E.current)?void 0:e.__r3f.parent);if(!t)return;if(b.setFromMatrixPosition(t.matrixWorld),S.setFromMatrixPosition(A.matrixWorld),w.extractRotation(t.matrixWorld),x.set(0,0,1),x.applyMatrix4(w),b.addScaledVector(x,f),M.subVectors(b,S),M.dot(x)>0)return;M.reflect(x).negate(),M.add(b),w.extractRotation(A.matrixWorld),C.set(0,0,-1),C.applyMatrix4(w),C.add(S),I.subVectors(b,C),I.reflect(x).negate(),I.add(b),P.position.copy(M),P.up.set(0,1,0),P.up.applyMatrix4(w),P.up.reflect(x),P.lookAt(I),P.far=A.far,P.updateMatrixWorld(),P.projectionMatrix.copy(A.projectionMatrix),B.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),B.multiply(P.projectionMatrix),B.multiply(P.matrixWorldInverse),B.multiply(t.matrixWorld),_.setFromNormalAndCoplanarPoint(x,b),_.applyMatrix4(P.matrixWorldInverse),T.set(_.normal.x,_.normal.y,_.normal.z,_.constant);const n=P.projectionMatrix;R.x=(Math.sign(T.x)+n.elements[8])/n.elements[0],R.y=(Math.sign(T.y)+n.elements[9])/n.elements[5],R.z=-1,R.w=(1+n.elements[10])/n.elements[14],T.multiplyScalar(2/T.dot(R)),n.elements[2]=T.x,n.elements[6]=T.y,n.elements[10]=T.z+1,n.elements[14]=T.w},[A,f]),[L,k,F,O]=e.useMemo(()=>{const e={minFilter:ie,magFilter:ie,type:me},f=new In(r,r,e);f.depthBuffer=!0,f.depthTexture=new Oo(r,r),f.depthTexture.format=Ee,f.depthTexture.type=he;const p=new In(r,r,e);return[f,p,new GW({gl:g,resolution:r,width:i[0],height:i[1],minDepthThreshold:s,maxDepthThreshold:a,depthScale:o,depthToBlurRatioBias:l}),{mirror:c,textureMatrix:B,mixBlur:t,tDiffuse:f.texture,tDepth:f.depthTexture,tDiffuseBlur:p.texture,hasBlur:y,mixStrength:n,minDepthThreshold:s,maxDepthThreshold:a,depthScale:o,depthToBlurRatioBias:l,distortion:u,distortionMap:d,mixContrast:h,"defines-USE_BLUR":y?"":void 0,"defines-USE_DEPTH":o>0?"":void 0,"defines-USE_DISTORTION":d?"":void 0}]},[g,i,B,r,c,y,t,n,s,a,o,l,u,d,h]);return Gp(()=>{var e;const t=E.current.parent||(null==(e=E.current)?void 0:e.__r3f.parent);if(!t)return;t.visible=!1;const n=g.xr.enabled,r=g.shadowMap.autoUpdate;D(),g.xr.enabled=!1,g.shadowMap.autoUpdate=!1,g.setRenderTarget(L),g.state.buffers.depth.setMask(!0),g.autoClear||g.clear(),g.render(v,P),y&&F.render(g,L,k),g.xr.enabled=n,g.shadowMap.autoUpdate=r,t.visible=!0,g.setRenderTarget(null)}),e.createElement("meshReflectorMaterialImpl",Lm({attach:"material",key:"key"+O["defines-USE_BLUR"]+O["defines-USE_DEPTH"]+O["defines-USE_DISTORTION"],ref:E},O,p))}),VW=tR({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new yj,color:new $r("white"),opacity:1,resolution:new nn,viewMatrixInverse:new cr,projectionMatrixInverse:new cr},"\n  uniform mat4 viewMatrixInverse;\n\n  varying vec3 vWorldPosition;\n  varying vec3 vNormal;\n  varying mat4 vModelMatrixInverse;\n\n  #include <color_pars_vertex>\n\n  void main() {\n    #include <color_vertex>\n\n    vec4 transformedNormal = vec4(normal, 0.0);\n    vec4 transformedPosition = vec4(position, 1.0);\n    #ifdef USE_INSTANCING\n      transformedNormal = instanceMatrix * transformedNormal;\n      transformedPosition = instanceMatrix * transformedPosition;\n    #endif\n\n    #ifdef USE_INSTANCING\n      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);\n    #else\n      vModelMatrixInverse = inverse(modelMatrix);\n    #endif\n\n    vWorldPosition = (modelMatrix * transformedPosition).xyz;\n    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;\n  }",`\n  #define ENVMAP_TYPE_CUBE_UV\n  precision highp isampler2D;\n  precision highp usampler2D;\n  varying vec3 vWorldPosition;\n  varying vec3 vNormal;\n  varying mat4 vModelMatrixInverse;\n\n  #include <color_pars_fragment>\n\n  #ifdef ENVMAP_TYPE_CUBEM\n    uniform samplerCube envMap;\n  #else\n    uniform sampler2D envMap;\n  #endif\n\n  uniform float bounces;\n  \nstruct BVH {\n\n\tusampler2D index;\n\tsampler2D position;\n\n\tsampler2D bvhBounds;\n\tusampler2D bvhContents;\n\n};\n\n  \n\t\n\n// A stack of uint32 indices can can store the indices for\n// a perfectly balanced tree with a depth up to 31. Lower stack\n// depth gets higher performance.\n//\n// However not all trees are balanced. Best value to set this to\n// is the trees max depth.\n#ifndef BVH_STACK_DEPTH\n#define BVH_STACK_DEPTH 60\n#endif\n\n#ifndef INFINITY\n#define INFINITY 1e20\n#endif\n\n// Utilities\nuvec4 uTexelFetch1D( usampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nivec4 iTexelFetch1D( isampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 texelFetch1D( sampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {\n\n\treturn\n\t\tbarycoord.x * texelFetch1D( tex, faceIndices.x ) +\n\t\tbarycoord.y * texelFetch1D( tex, faceIndices.y ) +\n\t\tbarycoord.z * texelFetch1D( tex, faceIndices.z );\n\n}\n\nvoid ndcToCameraRay(\n\tvec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,\n\tout vec3 rayOrigin, out vec3 rayDirection\n) {\n\n\t// get camera look direction and near plane for camera clipping\n\tvec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );\n\tvec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );\n\tfloat near = abs( nearVector.z / nearVector.w );\n\n\t// get the camera direction and position from camera matrices\n\tvec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );\n\tdirection /= direction.w;\n\tdirection = cameraWorld * direction - origin;\n\n\t// slide the origin along the ray until it sits at the near clip plane position\n\torigin.xyz += direction.xyz * near / dot( direction, lookDirection );\n\n\trayOrigin = origin.xyz;\n\trayDirection = direction.xyz;\n\n}\n\n\t\n\n#ifndef TRI_INTERSECT_EPSILON\n#define TRI_INTERSECT_EPSILON 1e-5\n#endif\n\n// Raycasting\nbool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {\n\n\t// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/\n\t// https://tavianator.com/2011/ray_box.html\n\tvec3 invDir = 1.0 / rayDirection;\n\n\t// find intersection distances for each plane\n\tvec3 tMinPlane = invDir * ( boundsMin - rayOrigin );\n\tvec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );\n\n\t// get the min and max distances from each intersection\n\tvec3 tMinHit = min( tMaxPlane, tMinPlane );\n\tvec3 tMaxHit = max( tMaxPlane, tMinPlane );\n\n\t// get the furthest hit distance\n\tvec2 t = max( tMinHit.xx, tMinHit.yz );\n\tfloat t0 = max( t.x, t.y );\n\n\t// get the minimum hit distance\n\tt = min( tMaxHit.xx, tMaxHit.yz );\n\tfloat t1 = min( t.x, t.y );\n\n\t// set distance to 0.0 if the ray starts inside the box\n\tdist = max( t0, 0.0 );\n\n\treturn t1 >= dist;\n\n}\n\nbool intersectsTriangle(\n\tvec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,\n\tout vec3 barycoord, out vec3 norm, out float dist, out float side\n) {\n\n\t// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d\n\tvec3 edge1 = b - a;\n\tvec3 edge2 = c - a;\n\tnorm = cross( edge1, edge2 );\n\n\tfloat det = - dot( rayDirection, norm );\n\tfloat invdet = 1.0 / det;\n\n\tvec3 AO = rayOrigin - a;\n\tvec3 DAO = cross( AO, rayDirection );\n\n\tvec4 uvt;\n\tuvt.x = dot( edge2, DAO ) * invdet;\n\tuvt.y = - dot( edge1, DAO ) * invdet;\n\tuvt.z = dot( AO, norm ) * invdet;\n\tuvt.w = 1.0 - uvt.x - uvt.y;\n\n\t// set the hit information\n\tbarycoord = uvt.wxy; // arranged in A, B, C order\n\tdist = uvt.z;\n\tside = sign( det );\n\tnorm = side * normalize( norm );\n\n\t// add an epsilon to avoid misses between triangles\n\tuvt += vec4( TRI_INTERSECT_EPSILON );\n\n\treturn all( greaterThanEqual( uvt, vec4( 0.0 ) ) );\n\n}\n\nbool intersectTriangles(\n\t// geometry info and triangle range\n\tsampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,\n\n\t// ray\n\tvec3 rayOrigin, vec3 rayDirection,\n\n\t// outputs\n\tinout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,\n\tinout float side, inout float dist\n) {\n\n\tbool found = false;\n\tvec3 localBarycoord, localNormal;\n\tfloat localDist, localSide;\n\tfor ( uint i = offset, l = offset + count; i < l; i ++ ) {\n\n\t\tuvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;\n\t\tvec3 a = texelFetch1D( positionAttr, indices.x ).rgb;\n\t\tvec3 b = texelFetch1D( positionAttr, indices.y ).rgb;\n\t\tvec3 c = texelFetch1D( positionAttr, indices.z ).rgb;\n\n\t\tif (\n\t\t\tintersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )\n\t\t\t&& localDist < minDistance\n\t\t) {\n\n\t\t\tfound = true;\n\t\t\tminDistance = localDist;\n\n\t\t\tfaceIndices = uvec4( indices.xyz, i );\n\t\t\tfaceNormal = localNormal;\n\n\t\t\tside = localSide;\n\t\t\tbarycoord = localBarycoord;\n\t\t\tdist = localDist;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n\nbool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {\n\n\tuint cni2 = currNodeIndex * 2u;\n\tvec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;\n\tvec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;\n\treturn intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );\n\n}\n\n// use a macro to hide the fact that we need to expand the struct into separate fields\n#define\tbvhIntersectFirstHit(\t\tbvh,\t\trayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\t)\t_bvhIntersectFirstHit(\t\tbvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,\t\trayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\t)\n\nbool _bvhIntersectFirstHit(\n\t// bvh info\n\tsampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,\n\n\t// ray\n\tvec3 rayOrigin, vec3 rayDirection,\n\n\t// output variables split into separate variables due to output precision\n\tinout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,\n\tinout float side, inout float dist\n) {\n\n\t// stack needs to be twice as long as the deepest tree we expect because\n\t// we push both the left and right child onto the stack every traversal\n\tint ptr = 0;\n\tuint stack[ BVH_STACK_DEPTH ];\n\tstack[ 0 ] = 0u;\n\n\tfloat triangleDistance = INFINITY;\n\tbool found = false;\n\twhile ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {\n\n\t\tuint currNodeIndex = stack[ ptr ];\n\t\tptr --;\n\n\t\t// check if we intersect the current bounds\n\t\tfloat boundsHitDistance;\n\t\tif (\n\t\t\t! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )\n\t\t\t|| boundsHitDistance > triangleDistance\n\t\t) {\n\n\t\t\tcontinue;\n\n\t\t}\n\n\t\tuvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;\n\t\tbool isLeaf = bool( boundsInfo.x & 0xffff0000u );\n\n\t\tif ( isLeaf ) {\n\n\t\t\tuint count = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint offset = boundsInfo.y;\n\n\t\t\tfound = intersectTriangles(\n\t\t\t\tbvh_position, bvh_index, offset, count,\n\t\t\t\trayOrigin, rayDirection, triangleDistance,\n\t\t\t\tfaceIndices, faceNormal, barycoord, side, dist\n\t\t\t) || found;\n\n\t\t} else {\n\n\t\t\tuint leftIndex = currNodeIndex + 1u;\n\t\t\tuint splitAxis = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint rightIndex = boundsInfo.y;\n\n\t\t\tbool leftToRight = rayDirection[ splitAxis ] >= 0.0;\n\t\t\tuint c1 = leftToRight ? leftIndex : rightIndex;\n\t\t\tuint c2 = leftToRight ? rightIndex : leftIndex;\n\n\t\t\t// set c2 in the stack so we traverse it later. We need to keep track of a pointer in\n\t\t\t// the stack while we traverse. The second pointer added is the one that will be\n\t\t\t// traversed first\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c2;\n\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c1;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n\n\n  uniform BVH bvh;\n  uniform float ior;\n  uniform bool correctMips;\n  uniform vec2 resolution;\n  uniform float fresnel;\n  uniform mat4 modelMatrix;\n  uniform mat4 projectionMatrixInverse;\n  uniform mat4 viewMatrixInverse;\n  uniform float aberrationStrength;\n  uniform vec3 color;\n  uniform float opacity;\n\n  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {\n    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );\n  }\n\n  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {\n    vec3 rayOrigin = ro;\n    vec3 rayDirection = rd;\n    rayDirection = refract(rayDirection, normal, 1.0 / ior);\n    rayOrigin = vWorldPosition + rayDirection * 0.001;\n    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;\n    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);\n    for(float i = 0.0; i < bounces; i++) {\n      uvec4 faceIndices = uvec4( 0u );\n      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );\n      vec3 barycoord = vec3( 0.0 );\n      float side = 1.0;\n      float dist = 0.0;\n      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );\n      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);\n      vec3 tempDir = refract(rayDirection, faceNormal, ior);\n      if (length(tempDir) != 0.0) {\n        rayDirection = tempDir;\n        break;\n      }\n      rayDirection = reflect(rayDirection, faceNormal);\n      rayOrigin = hitPos + rayDirection * 0.01;\n    }\n    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);\n    return rayDirection;\n  }\n\n  #include <common>\n  #include <cube_uv_reflection_fragment>\n\n  #ifdef ENVMAP_TYPE_CUBEM\n    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {\n      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));\n    }\n  #else\n    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {\n      vec2 uvv = equirectUv( rayDirection );\n      vec2 smoothUv = equirectUv( directionCamPerfect );\n      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));\n    }\n  #endif\n\n  void main() {\n    vec2 uv = gl_FragCoord.xy / resolution;\n    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;\n    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;\n    directionCamPerfect = normalize(directionCamPerfect);\n    vec3 normal = vNormal;\n    vec3 rayOrigin = cameraPosition;\n    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);\n\n    vec4 diffuseColor = vec4(color, opacity);\n    #include <color_fragment>\n\n    #ifdef CHROMATIC_ABERRATIONS\n      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);\n      #ifdef FAST_CHROMA\n        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));\n        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));\n      #else\n        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);\n        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);\n      #endif\n      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;\n      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;\n      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;\n      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);\n    #else\n      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);\n      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;\n    #endif\n\n    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);\n    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;\n    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);\n\n    #include <tonemapping_fragment>\n    #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n  }`);function jW({aberrationStrength:t=0,fastChroma:n=!0,envMap:i,...s}){Hf({MeshRefractionMaterial:VW});const o=r(),{size:c}=zp(),u=l(()=>{var e,r;const s={},a=(o=i)&&o.isCubeTexture;var o;const l=(null!==(e=a?null==(r=i.image[0])?void 0:r.width:i.image.width)&&void 0!==e?e:1024)/4,c=Math.floor(Math.log2(l)),u=Math.pow(2,c),h=3*Math.max(u,112),d=4*u;return a&&(s.ENVMAP_TYPE_CUBEM=""),s.CUBEUV_TEXEL_WIDTH=""+1/h,s.CUBEUV_TEXEL_HEIGHT=""+1/d,s.CUBEUV_MAX_MIP=`${c}.0`,t>0&&(s.CHROMATIC_ABERRATIONS=""),n&&(s.FAST_CHROMA=""),s},[t,n]);return a(()=>{var e;const t=null==(e=o.current)||null==(e=e.__r3f)||null==(e=e.parent)?void 0:e.geometry;t&&(o.current.bvh=new yj,o.current.bvh.updateFrom(new ej(t.clone().toNonIndexed(),{strategy:2})))},[]),Gp(({camera:e})=>{o.current.viewMatrixInverse=e.matrixWorld,o.current.projectionMatrixInverse=e.projectionMatrixInverse}),e.createElement("meshRefractionMaterial",Lm({key:JSON.stringify(u),defines:u,ref:o,resolution:[c.width,c.height],aberrationStrength:t,envMap:i},s))}const WW=tR({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class YW extends Bu{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new $r("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=n=>{n.uniforms={...n.uniforms,...this.uniforms},this.anisotropy>0&&(n.defines.USE_ANISOTROPY=""),t?n.defines.USE_SAMPLER="":n.defines.USE_TRANSMISSION="",n.fragmentShader="\n      uniform float chromaticAberration;         \n      uniform float anisotropicBlur;      \n      uniform float time;\n      uniform float distortion;\n      uniform float distortionScale;\n      uniform float temporalDistortion;\n      uniform sampler2D buffer;\n\n      vec3 random3(vec3 c) {\n        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n        vec3 r;\n        r.z = fract(512.0*j);\n        j *= .125;\n        r.x = fract(512.0*j);\n        j *= .125;\n        r.y = fract(512.0*j);\n        return r-0.5;\n      }\n\n      uint hash( uint x ) {\n        x += ( x << 10u );\n        x ^= ( x >>  6u );\n        x += ( x <<  3u );\n        x ^= ( x >> 11u );\n        x += ( x << 15u );\n        return x;\n      }\n\n      // Compound versions of the hashing algorithm I whipped together.\n      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }\n      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }\n      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }\n\n      // Construct a float with half-open range [0:1] using low 23 bits.\n      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.\n      float floatConstruct( uint m ) {\n        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask\n        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32\n        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)\n        m |= ieeeOne;                          // Add fractional part to 1.0\n        float  f = uintBitsToFloat( m );       // Range [1:2]\n        return f - 1.0;                        // Range [0:1]\n      }\n\n      // Pseudo-random value in half-open range [0:1].\n      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }\n      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }\n      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }\n      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }\n      float rand(float seed) {\n        float result = randomBase(vec3(gl_FragCoord.xy, seed));\n        return result;\n      }\n\n      const float F3 =  0.3333333;\n      const float G3 =  0.1666667;\n\n      float snoise(vec3 p) {\n        vec3 s = floor(p + dot(p, vec3(F3)));\n        vec3 x = p - s + dot(s, vec3(G3));\n        vec3 e = step(vec3(0.0), x - x.yzx);\n        vec3 i1 = e*(1.0 - e.zxy);\n        vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n        vec3 x1 = x - i1 + G3;\n        vec3 x2 = x - i2 + 2.0*G3;\n        vec3 x3 = x - 1.0 + 3.0*G3;\n        vec4 w, d;\n        w.x = dot(x, x);\n        w.y = dot(x1, x1);\n        w.z = dot(x2, x2);\n        w.w = dot(x3, x3);\n        w = max(0.6 - w, 0.0);\n        d.x = dot(random3(s), x);\n        d.y = dot(random3(s + i1), x1);\n        d.z = dot(random3(s + i2), x2);\n        d.w = dot(random3(s + 1.0), x3);\n        w *= w;\n        w *= w;\n        d *= w;\n        return dot(d, vec4(52.0));\n      }\n\n      float snoiseFractal(vec3 m) {\n        return 0.5333333* snoise(m)\n              +0.2666667* snoise(2.0*m)\n              +0.1333333* snoise(4.0*m)\n              +0.0666667* snoise(8.0*m);\n      }\n"+n.fragmentShader,n.fragmentShader=n.fragmentShader.replace("#include <transmission_pars_fragment>","\n        #ifdef USE_TRANSMISSION\n          // Transmission code is based on glTF-Sampler-Viewer\n          // https://github.com/KhronosGroup/glTF-Sample-Viewer\n          uniform float _transmission;\n          uniform float thickness;\n          uniform float attenuationDistance;\n          uniform vec3 attenuationColor;\n          #ifdef USE_TRANSMISSIONMAP\n            uniform sampler2D transmissionMap;\n          #endif\n          #ifdef USE_THICKNESSMAP\n            uniform sampler2D thicknessMap;\n          #endif\n          uniform vec2 transmissionSamplerSize;\n          uniform sampler2D transmissionSamplerMap;\n          uniform mat4 modelMatrix;\n          uniform mat4 projectionMatrix;\n          varying vec3 vWorldPosition;\n          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n            // Direction of refracted light.\n            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n            // Compute rotation-independant scaling of the model matrix.\n            vec3 modelScale;\n            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n            // The thickness is specified in local space.\n            return normalize( refractionVector ) * thickness * modelScale;\n          }\n          float applyIorToRoughness( const in float roughness, const in float ior ) {\n            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n            // an IOR of 1.5 results in the default amount of microfacet refraction.\n            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n          }\n          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            \n            #ifdef USE_SAMPLER\n              #ifdef texture2DLodEXT\n                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);\n              #else\n                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);\n              #endif\n            #else\n              return texture2D(buffer, fragCoord.xy);\n            #endif\n          }\n          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n            if ( isinf( attenuationDistance ) ) {\n              // Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.\n              return radiance;\n            } else {\n              // Compute light attenuation using Beer's law.\n              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law\n              return transmittance * radiance;\n            }\n          }\n          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n            const in vec3 attenuationColor, const in float attenuationDistance ) {\n            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n            vec3 refractedRayExit = position + transmissionRay;\n            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n            vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n            refractionCoords += 1.0;\n            refractionCoords /= 2.0;\n            // Sample framebuffer to get pixel the refracted ray hits.\n            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n            // Get the specular component.\n            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n          }\n        #endif\n"),n.fragmentShader=n.fragmentShader.replace("#include <transmission_fragment>",`  \n        // Improve the refraction to use the world pos\n        material.transmission = _transmission;\n        material.transmissionAlpha = 1.0;\n        material.thickness = thickness;\n        material.attenuationDistance = attenuationDistance;\n        material.attenuationColor = attenuationColor;\n        #ifdef USE_TRANSMISSIONMAP\n          material.transmission *= texture2D( transmissionMap, vUv ).r;\n        #endif\n        #ifdef USE_THICKNESSMAP\n          material.thickness *= texture2D( thicknessMap, vUv ).g;\n        #endif\n        \n        vec3 pos = vWorldPosition;\n        float runningSeed = 0.0;\n        vec3 v = normalize( cameraPosition - pos );\n        vec3 n = inverseTransformDirection( normal, viewMatrix );\n        vec3 transmission = vec3(0.0);\n        float transmissionR, transmissionB, transmissionG;\n        float randomCoords = rand(runningSeed++);\n        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);\n        vec3 distortionNormal = vec3(0.0);\n        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;\n        if (distortion > 0.0) {\n          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));\n        }\n        for (float i = 0.0; i < ${e}.0; i ++) {\n          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);\n          transmissionR = getIBLVolumeRefraction(\n            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),\n            material.attenuationColor, material.attenuationDistance\n          ).r;\n          transmissionG = getIBLVolumeRefraction(\n            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),\n            material.attenuationColor, material.attenuationDistance\n          ).g;\n          transmissionB = getIBLVolumeRefraction(\n            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),\n            material.attenuationColor, material.attenuationDistance\n          ).b;\n          transmission.r += transmissionR;\n          transmission.g += transmissionG;\n          transmission.b += transmissionB;\n        }\n        transmission /= ${e}.0;\n        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n`)},Object.keys(this.uniforms).forEach(e=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))}}const KW=e.forwardRef(({buffer:t,transmissionSampler:n=!1,backside:r=!1,side:i=0,transmission:s=1,thickness:a=0,backsideThickness:o=0,backsideEnvMapIntensity:l=1,samples:c=10,resolution:u,backsideResolution:h,background:d,anisotropy:f,anisotropicBlur:p,...m},g)=>{Hf({MeshTransmissionMaterial:YW});const A=e.useRef(null),[v]=e.useState(()=>new WW),y=WR(h||u),E=WR(u);let _,x,b,S;return Gp(e=>{A.current.time=e.clock.elapsedTime,A.current.buffer!==E.texture||n||(S=A.current.__r3f.parent,S&&(b=e.gl.toneMapping,_=e.scene.background,x=A.current.envMapIntensity,e.gl.toneMapping=0,d&&(e.scene.background=d),S.material=v,r&&(e.gl.setRenderTarget(y),e.gl.render(e.scene,e.camera),S.material=A.current,S.material.buffer=y.texture,S.material.thickness=o,S.material.side=1,S.material.envMapIntensity=l),e.gl.setRenderTarget(E),e.gl.render(e.scene,e.camera),S.material=A.current,S.material.thickness=a,S.material.side=i,S.material.buffer=E.texture,S.material.envMapIntensity=x,e.scene.background=_,e.gl.setRenderTarget(null),e.gl.toneMapping=b))}),e.useImperativeHandle(g,()=>A.current,[]),e.createElement("meshTransmissionMaterial",Lm({args:[c,n],ref:A},m,{buffer:t||E.texture,_transmission:s,anisotropicBlur:null!=p?p:f,transmission:n?s:0,thickness:a,side:i}))}),qW=e.forwardRef((t,n)=>(Hf({DiscardMaterialImpl:WW}),e.createElement("discardMaterialImpl",Lm({ref:n},t))));function XW(t){const n=e.useRef(null);return e.useLayoutEffect(()=>{var e;const t=null==(e=n.current)?void 0:e.parent,r=null==t?void 0:t.geometry;if(r){const e=t.material;t.material=n.current.__r3f.objects;const i=[...r.groups];return r.clearGroups(),t.material.forEach((e,n)=>{n<t.material.length-1&&(e.depthWrite=!1),r.addGroup(0,1/0,n)}),()=>{t.material=e,r.groups=i}}}),e.createElement("group",Lm({ref:n},t))}const $W=sR>=154?"opaque_fragment":"output_fragment";class JW extends ql{constructor(e){super(e),this.onBeforeCompile=(e,t)=>{const{isWebGL2:n}=t.capabilities;e.fragmentShader=e.fragmentShader.replace(`#include <${$W}>`,`\n        ${n?`#include <${$W}>`:`#extension GL_OES_standard_derivatives : enable\n#include <${$W}>`}\n      vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n      float r = dot(cxy, cxy);\n      float delta = fwidth(r);     \n      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );\n      #include <tonemapping_fragment>\n      #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n      `)}}}const ZW=e.forwardRef((t,n)=>{const[r]=e.useState(()=>new JW(null));return e.createElement("primitive",Lm({},t,{object:r,ref:n,attach:"material"}))});function eY(e,t,n){t.traverse(t=>{t.material&&(e.properties.remove(t.material),null==t.material.dispose||t.material.dispose())}),e.info.programs.length=0,e.compile(t,n)}function tY({focus:t=0,samples:n=10,size:r=25}){const i=zp(e=>e.gl),s=zp(e=>e.scene),a=zp(e=>e.camera);return e.useEffect(()=>{const e=ls.shadowmap_pars_fragment;return ls.shadowmap_pars_fragment=ls.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+(({focus:e=0,size:t=25,samples:n=10}={})=>`\n#define PENUMBRA_FILTER_SIZE float(${t})\n#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))\nvec3 randRGB(vec2 uv) {\n  return vec3(\n    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),\n    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),\n    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)\n  );\n}\n\nvec3 lowPassRandRGB(vec2 uv) {\n  // 3x3 convolution (average)\n  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9\n  vec3 result = vec3(0);\n  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));\n  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));\n  result *= 0.111111111; // 1.0 / 9.0\n  return result;\n}\nvec3 highPassRandRGB(vec2 uv) {\n  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal\n  // hp(x) = x - lp(x)\n  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;\n}\n\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\nfloat penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation\n  return (zReceiver - zBlocker) / zBlocker;\n}\nfloat findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {\n  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);\n  float blockerDepthSum = float(${e});\n  float blockers = 0.0;\n\n  int j = 0;\n  vec2 offset = vec2(0.);\n  float depth = 0.;\n\n  #pragma unroll_loop_start\n  for(int i = 0; i < ${n}; i ++) {\n    offset = (vogelDiskSample(j, ${n}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;\n    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));\n    if (depth < compare) {\n      blockerDepthSum += depth;\n      blockers++;\n    }\n    j++;\n  }\n  #pragma unroll_loop_end\n\n  if (blockers > 0.0) {\n    return blockerDepthSum / blockers;\n  }\n  return -1.0;\n}\n\n        \nfloat vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {\n  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);\n  float shadow = 0.0f;\n  int j = 0;\n  vec2 vogelSample = vec2(0.0);\n  vec2 offset = vec2(0.0);\n  #pragma unroll_loop_start\n  for (int i = 0; i < ${n}; i++) {\n    vogelSample = vogelDiskSample(j, ${n}, angle) * texelSize;\n    offset = vogelSample * (1.0 + filterRadius * float(${t}));\n    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    j++;\n  }\n  #pragma unroll_loop_end\n  return shadow * 1.0 / ${n}.0;\n}\n\nfloat PCSS (sampler2D shadowMap, vec4 coords) {\n  vec2 uv = coords.xy;\n  float zReceiver = coords.z; // Assumed to be eye-space z in this code\n  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;\n  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);\n  if (avgBlockerDepth == -1.0) {\n    return 1.0;\n  }\n  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);\n  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);\n}`)({size:r,samples:n,focus:t})).replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),eY(i,s,a),()=>{ls.shadowmap_pars_fragment=e,eY(i,s,a)}},[t,r,n]),null}function nY(t,n){const r=t+"Geometry";return e.forwardRef(({args:t,children:i,...s},a)=>{const o=e.useRef(null);return e.useImperativeHandle(a,()=>o.current),e.useLayoutEffect(()=>{null==n||n(o.current)}),e.createElement("mesh",Lm({ref:o},s),e.createElement(r,{attach:"geometry",args:t}),i)})}const rY=nY("box"),iY=nY("circle"),sY=nY("cone"),aY=nY("cylinder"),oY=nY("sphere"),lY=nY("plane"),cY=nY("tube"),uY=nY("torus"),hY=nY("torusKnot"),dY=nY("tetrahedron"),fY=nY("ring"),pY=nY("polyhedron"),mY=nY("icosahedron"),gY=nY("octahedron"),AY=nY("dodecahedron"),vY=nY("extrude"),yY=nY("lathe"),EY=nY("capsule"),_Y=nY("shape",({geometry:e})=>{const t=e.attributes.position,n=(new Fn).setFromBufferAttribute(t),r=new Dn;n.getSize(r);const i=[];let s=0,a=0,o=0,l=0;for(let e=0;e<t.count;e++)s=t.getX(e),a=t.getY(e),o=(s-n.min.x)/r.x,l=(a-n.min.y)/r.y,i.push(o,l);e.setAttribute("uv",new di(i,2))}),xY=1e-5;const bY=e.forwardRef(function({args:[t=1,n=1,r=1]=[],radius:i=.05,steps:s=1,smoothness:a=4,bevelSegments:o=4,creaseAngle:l=.4,children:c,...u},h){const d=e.useMemo(()=>function(e,t,n){const r=new Nc,i=n-xY;return r.absarc(xY,xY,xY,-Math.PI/2,-Math.PI,!0),r.absarc(xY,t-2*i,xY,Math.PI,Math.PI/2,!0),r.absarc(e-2*i,t-2*i,xY,Math.PI/2,0,!0),r.absarc(e-2*i,xY,xY,0,-Math.PI/2,!0),r}(t,n,i),[t,n,i]),f=e.useMemo(()=>({depth:r-2*i,bevelEnabled:!0,bevelSegments:2*o,steps:s,bevelSize:i-xY,bevelThickness:i,curveSegments:a}),[r,i,a]),p=e.useRef(null);return e.useLayoutEffect(()=>{p.current&&(p.current.center(),Ox(p.current,l))},[d,f]),e.createElement("mesh",Lm({ref:h},u),e.createElement("extrudeGeometry",{ref:p,args:[d,f]}),c)});function SY(){const e=new Ei,t=new Float32Array([-1,-1,3,-1,-1,3]);return e.boundingSphere=new er,e.boundingSphere.set(new Dn,1/0),e.setAttribute("position",new ci(t,2)),e}const wY=e.forwardRef(function({children:t,...n},r){const i=e.useMemo(SY,[]);return e.createElement("mesh",Lm({ref:r,geometry:i,frustumCulled:!1},n),t)}),CY=e.forwardRef(({children:t,width:n,height:r,depth:i,box3:s,precise:a=!0,...o},l)=>{const c=e.useRef(null),u=e.useRef(null),h=e.useRef(null);return e.useLayoutEffect(()=>{u.current.matrixWorld.identity();let e=s||(new Fn).setFromObject(h.current,a);const t=e.max.x-e.min.x,o=e.max.y-e.min.y,l=e.max.z-e.min.z;let c=Math.max(t,o,l);n&&(c=t),r&&(c=o),i&&(c=l),u.current.scale.setScalar(1/c)},[n,r,i,s,a]),e.useImperativeHandle(l,()=>c.current,[]),e.createElement("group",Lm({ref:c},o),e.createElement("group",{ref:u},e.createElement("group",{ref:h},t)))});var TY=function(e){return e[e.NONE=0]="NONE",e[e.START=1]="START",e[e.ACTIVE=2]="ACTIVE",e}(TY||{});const MY=e=>e&&e.isOrthographicCamera,IY=e=>1-Math.exp(-5*e)+.007*e,RY=e.createContext(null);function BY({children:t,maxDuration:n=1,margin:r=1.2,observe:i,fit:s,clip:a,interpolateFunc:o=IY,onFit:l}){const c=e.useRef(null),{camera:u,size:h,invalidate:d}=zp(),f=zp(e=>e.controls),p=e.useRef(l);p.current=l;const m=e.useRef({camPos:new Dn,camRot:new Pn,camZoom:1}),g=e.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),A=e.useRef(TY.NONE),v=e.useRef(0),[y]=e.useState(()=>new Fn),E=e.useMemo(()=>{function e(){const e=y.getSize(new Dn),t=y.getCenter(new Dn),n=Math.max(e.x,e.y,e.z),i=MY(u)?4*n:n/(2*Math.atan(Math.PI*u.fov/360)),s=MY(u)?4*n:i/u.aspect,a=r*Math.max(i,s);return{box:y,size:e,center:t,distance:a}}return{getSize:e,refresh(e){if((t=e)&&t.isBox3)y.copy(e);else{const t=e||c.current;if(!t)return this;t.updateWorldMatrix(!0,!0),y.setFromObject(t)}var t;if(y.isEmpty()){const e=u.position.length()||10;y.setFromCenterAndSize(new Dn,new Dn(e,e,e))}return m.current.camPos.copy(u.position),m.current.camRot.copy(u.quaternion),MY(u)&&(m.current.camZoom=u.zoom),g.current.camPos=void 0,g.current.camRot=void 0,g.current.camZoom=void 0,g.current.camUp=void 0,g.current.target=void 0,this},reset(){const{center:t,distance:n}=e(),r=u.position.clone().sub(t).normalize();g.current.camPos=t.clone().addScaledVector(r,n),g.current.target=t.clone();const i=(new cr).lookAt(g.current.camPos,g.current.target,u.up);return g.current.camRot=(new Pn).setFromRotationMatrix(i),A.current=TY.START,v.current=0,this},moveTo(e){return g.current.camPos=Array.isArray(e)?new Dn(...e):e.clone(),A.current=TY.START,v.current=0,this},lookAt({target:e,up:t}){g.current.target=Array.isArray(e)?new Dn(...e):e.clone(),g.current.camUp=t?Array.isArray(t)?new Dn(...t):t.clone():u.up.clone();const n=(new cr).lookAt(g.current.camPos||u.position,g.current.target,g.current.camUp);return g.current.camRot=(new Pn).setFromRotationMatrix(n),A.current=TY.START,v.current=0,this},to({position:e,target:t}){return this.moveTo(e).lookAt({target:t})},fit(){if(!MY(u))return this.reset();let e=0,t=0;const n=[new Dn(y.min.x,y.min.y,y.min.z),new Dn(y.min.x,y.max.y,y.min.z),new Dn(y.min.x,y.min.y,y.max.z),new Dn(y.min.x,y.max.y,y.max.z),new Dn(y.max.x,y.max.y,y.max.z),new Dn(y.max.x,y.max.y,y.min.z),new Dn(y.max.x,y.min.y,y.max.z),new Dn(y.max.x,y.min.y,y.min.z)],i=g.current.camPos||u.position,s=g.current.target||(null==f?void 0:f.target),a=g.current.camUp||u.up,o=s?(new cr).lookAt(i,s,a).setPosition(i).invert():u.matrixWorldInverse;for(const r of n)r.applyMatrix4(o),e=Math.max(e,Math.abs(r.y)),t=Math.max(t,Math.abs(r.x));e*=2,t*=2;const l=(u.top-u.bottom)/e,c=(u.right-u.left)/t;return g.current.camZoom=Math.min(l,c)/r,A.current=TY.START,v.current=0,p.current&&p.current(this.getSize()),this},clip(){const{distance:t}=e();return u.near=t/100,u.far=100*t,u.updateProjectionMatrix(),f&&(f.maxDistance=10*t,f.update()),d(),this}}},[y,u,f,r,d]);e.useLayoutEffect(()=>{if(f){const e=()=>{if(f&&g.current.target&&A.current!==TY.NONE){const e=(new Dn).setFromMatrixColumn(u.matrix,2),t=m.current.camPos.distanceTo(f.target),n=(g.current.camPos||m.current.camPos).distanceTo(g.current.target),r=(1-v.current)*t+v.current*n;f.target.copy(u.position).addScaledVector(e,-r),f.update()}A.current=TY.NONE};return f.addEventListener("start",e),()=>f.removeEventListener("start",e)}},[f]);const _=e.useRef(0);return e.useLayoutEffect(()=>{(i||0===_.current++)&&(E.refresh(),s&&E.reset().fit(),a&&E.clip())},[h,a,s,i,u,f]),Gp((e,t)=>{if(A.current===TY.START)A.current=TY.ACTIVE,d();else if(A.current===TY.ACTIVE){if(v.current+=t/n,v.current>=1)g.current.camPos&&u.position.copy(g.current.camPos),g.current.camRot&&u.quaternion.copy(g.current.camRot),g.current.camUp&&u.up.copy(g.current.camUp),g.current.camZoom&&MY(u)&&(u.zoom=g.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix(),f&&g.current.target&&(f.target.copy(g.current.target),f.update()),A.current=TY.NONE;else{const e=o(v.current);g.current.camPos&&u.position.lerpVectors(m.current.camPos,g.current.camPos,e),g.current.camRot&&u.quaternion.slerpQuaternions(m.current.camRot,g.current.camRot,e),g.current.camUp&&u.up.set(0,1,0).applyQuaternion(u.quaternion),g.current.camZoom&&MY(u)&&(u.zoom=(1-e)*m.current.camZoom+e*g.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix()}d()}}),e.createElement("group",{ref:c},e.createElement(RY.Provider,{value:E},t))}function PY(){return e.useContext(RY)}const DY=e.forwardRef(({intensity:t=1,decay:n,decayRate:r=.65,maxYaw:i=.1,maxPitch:s=.1,maxRoll:a=.1,yawFrequency:o=.1,pitchFrequency:l=.1,rollFrequency:c=.1},u)=>{const h=zp(e=>e.camera),d=zp(e=>e.controls),f=e.useRef(t),p=e.useRef(h.rotation.clone()),[m]=e.useState(()=>new gb),[g]=e.useState(()=>new gb),[A]=e.useState(()=>new gb),v=()=>{(f.current<0||f.current>1)&&(f.current=f.current<0?0:1)};return e.useImperativeHandle(u,()=>({getIntensity:()=>f.current,setIntensity:e=>{f.current=e,v()}}),[]),e.useEffect(()=>{if(d){const e=()=>{p.current=h.rotation.clone()};return d.addEventListener("change",e),e(),()=>{d.removeEventListener("change",e)}}},[h,d]),Gp((e,t)=>{const u=Math.pow(f.current,2),d=i*u*m.noise(e.clock.elapsedTime*o,1),y=s*u*g.noise(e.clock.elapsedTime*l,1),E=a*u*A.noise(e.clock.elapsedTime*c,1);h.rotation.set(p.current.x+y,p.current.y+d,p.current.z+E),n&&f.current>0&&(f.current-=r*t,v())}),null}),LY=e.forwardRef(({children:t,enabled:n=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:s=1,floatingRange:a=[-.1,.1],autoInvalidate:o=!1,...l},c)=>{const u=e.useRef(null);e.useImperativeHandle(c,()=>u.current,[]);const h=e.useRef(1e4*Math.random());return Gp(e=>{var t,l;if(!n||0===r)return;o&&e.invalidate();const c=h.current+e.clock.elapsedTime;u.current.rotation.x=Math.cos(c/4*r)/8*i,u.current.rotation.y=Math.sin(c/4*r)/8*i,u.current.rotation.z=Math.sin(c/4*r)/20*i;let d=Math.sin(c/4*r)/10;d=tn.mapLinear(d,-.1,.1,null!==(t=null==a?void 0:a[0])&&void 0!==t?t:-.1,null!==(l=null==a?void 0:a[1])&&void 0!==l?l:.1),u.current.position.y=d*s,u.current.updateMatrix()}),e.createElement("group",l,e.createElement("group",{ref:u,matrixAutoUpdate:!1},t))}),kY=(e,t,n)=>{let r;switch(e){case le:r=new Uint8ClampedArray(t*n*4);break;case me:r=new Uint16Array(t*n*4);break;case fe:r=new Uint32Array(t*n*4);break;case ce:r=new Int8Array(t*n*4);break;case ue:r=new Int16Array(t*n*4);break;case de:r=new Int32Array(t*n*4);break;case pe:r=new Float32Array(t*n*4);break;default:throw new Error("Unsupported data type")}return r};let FY;class OY{constructor(e){var t,n,r,i,s,a,o,l,c,u,h,d,f,p,m,g;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const A={format:ye,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:void 0!==(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)?null===(n=e.renderTargetOptions)||void 0===n?void 0:n.anisotropy:1,generateMipmaps:void 0!==(null===(r=e.renderTargetOptions)||void 0===r?void 0:r.generateMipmaps)&&(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.generateMipmaps),magFilter:void 0!==(null===(s=e.renderTargetOptions)||void 0===s?void 0:s.magFilter)?null===(a=e.renderTargetOptions)||void 0===a?void 0:a.magFilter:ie,minFilter:void 0!==(null===(o=e.renderTargetOptions)||void 0===o?void 0:o.minFilter)?null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter:ie,samples:void 0!==(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples)?null===(u=e.renderTargetOptions)||void 0===u?void 0:u.samples:void 0,wrapS:void 0!==(null===(h=e.renderTargetOptions)||void 0===h?void 0:h.wrapS)?null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapS:Z,wrapT:void 0!==(null===(f=e.renderTargetOptions)||void 0===f?void 0:f.wrapT)?null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapT:Z};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=OY.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new jo,this._camera=new vs,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,n,r)=>{if(void 0!==FY)return FY;const i=new In(1,1,r);t.setRenderTarget(i);const s=new Ui(new os,new ti({color:16777215}));t.render(s,n),t.setRenderTarget(null);const a=kY(e,i.width,i.height);return t.readRenderTargetPixels(i,0,0,i.width,i.height,a),i.dispose(),s.geometry.dispose(),s.material.dispose(),FY=0!==a[0],FY})(this._type,this._renderer,this._camera,A)){let e;if(this._type===me)e=this._renderer.extensions.has("EXT_color_buffer_float")?pe:void 0;void 0!==e?this._type=e:this._supportsReadPixels=!1}this._quad=new Ui(new os,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new In(this.width,this.height,A),this._renderTarget.texture.mapping=void 0!==(null===(m=e.renderTargetOptions)||void 0===m?void 0:m.mapping)?null===(g=e.renderTargetOptions)||void 0===g?void 0:g.mapping:W}static instantiateRenderer(){const e=new Go;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=kY(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new wl(this.toArray(),this.width,this.height,ye,this._type,(null==e?void 0:e.mapping)||W,(null==e?void 0:e.wrapS)||Z,(null==e?void 0:e.wrapT)||Z,(null==e?void 0:e.magFilter)||ie,(null==e?void 0:e.minFilter)||ie,(null==e?void 0:e.anisotropy)||1,At);return t.generateMipmaps=void 0!==(null==e?void 0:e.generateMipmaps)&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof ji&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof Cn&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof Cn&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class UY extends ji{constructor({gamma:e,offsetHdr:t,offsetSdr:n,gainMapMin:r,gainMapMax:i,maxDisplayBoost:s,hdrCapacityMin:a,hdrCapacityMax:o,sdr:l,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n",uniforms:{sdr:{value:l},gainMap:{value:c},gamma:{value:new Dn(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:(new Dn).fromArray(t)},offsetSdr:{value:(new Dn).fromArray(n)},gainMapMin:{value:(new Dn).fromArray(r)},gainMapMax:{value:(new Dn).fromArray(i)},weightFactor:{value:(Math.log2(s)-a)/(o-a)}},blending:0,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=s,this._hdrCapacityMin=a,this._hdrCapacityMax=o,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class NY extends Error{}class zY extends Error{}const GY=(e,t,n)=>{const r=new RegExp(`${t}="([^"]*)"`,"i").exec(e);if(r)return r[1];const i=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(i){const e=i[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map(e=>e.replace(/<\/?rdf:li>/g,"")):i[1].trim()}if(void 0!==n)return n;throw new Error(`Can't find ${t} in gainmap metadata`)};class QY{constructor(e){this.options={debug:!(!e||void 0===e.debug)&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,n)=>{this.options.debug;const r=new DataView(e.buffer);if(65496!==r.getUint16(0))return void n(new Error("Not a valid jpeg"));const i=r.byteLength;let s,a=2,o=0;for(;a<i;){if(++o>250)return void n(new Error(`Found no marker after ${o} loops 😵`));if(255!==r.getUint8(a))return void n(new Error(`Not a valid marker at offset 0x${a.toString(16)}, found: 0x${r.getUint8(a).toString(16)}`));if(s=r.getUint8(a+1),226===s){const e=a+4;if(1297106432===r.getUint32(e)){const i=e+4;let s;if(18761===r.getUint16(i))s=!1;else{if(19789!==r.getUint16(i))return void n(new Error("No valid endianness marker found in TIFF header"));s=!0}if(42!==r.getUint16(i+2,!s))return void n(new Error("Not valid TIFF data! (no 0x002A marker)"));const a=r.getUint32(i+4,!s);if(a<8)return void n(new Error("Not valid TIFF data! (First offset less than 8)"));const o=i+a,l=r.getUint16(o,!s),c=o+2;let u=0;for(let e=c;e<c+12*l;e+=12)45057===r.getUint16(e,!s)&&(u=r.getUint32(e+8,!s));const h=o+2+12*l+4,d=[];for(let e=h;e<h+16*u;e+=16){const t={MPType:r.getUint32(e,!s),size:r.getUint32(e+4,!s),dataOffset:r.getUint32(e+8,!s),dependantImages:r.getUint32(e+12,!s),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=i+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,d.push(t)}if(this.options.extractNonFII&&d.length){const e=new Blob([r]),n=[];for(const t of d){if(t.isFII&&!this.options.extractFII)continue;const r=e.slice(t.start,t.end+1,"image/jpeg");n.push(r)}t(n)}}}a+=2+r.getUint16(a+2)}})}}const HY=async e=>{const t=(e=>{let t;t="undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):e.toString();let n=t.indexOf("<x:xmpmeta");for(;-1!==n;){const e=t.indexOf("x:xmpmeta>",n),r=t.slice(n,e+10);try{const e=GY(r,"hdrgm:GainMapMin","0"),t=GY(r,"hdrgm:GainMapMax"),n=GY(r,"hdrgm:Gamma","1"),i=GY(r,"hdrgm:OffsetSDR","0.015625"),s=GY(r,"hdrgm:OffsetHDR","0.015625"),a=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(r),o=a?a[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(r);if(!l)throw new Error("Incomplete gainmap metadata");const c=l[1];return{gainMapMin:Array.isArray(e)?e.map(e=>parseFloat(e)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map(e=>parseFloat(e)):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(n)?n.map(e=>parseFloat(e)):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetSdr:Array.isArray(i)?i.map(e=>parseFloat(e)):[parseFloat(i),parseFloat(i),parseFloat(i)],offsetHdr:Array.isArray(s)?s.map(e=>parseFloat(e)):[parseFloat(s),parseFloat(s),parseFloat(s)],hdrCapacityMin:parseFloat(o),hdrCapacityMax:parseFloat(c)}}catch(e){}n=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new zY("Gain map XMP metadata not found");const n=new QY({extractFII:!0,extractNonFII:!0}),r=await n.extract(e);if(2!==r.length)throw new NY("Gain map recovery image not found");return{sdr:new Uint8Array(await r[0].arrayBuffer()),gainMap:new Uint8Array(await r[1].arrayBuffer()),metadata:t}},VY=e=>new Promise((t,n)=>{const r=document.createElement("img");r.onload=()=>{t(r)},r.onerror=e=>{n(e)},r.src=URL.createObjectURL(e)});class jY extends oh{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new sh}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer;const e=new UY({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Cn,sdr:new Cn});return new OY({width:16,height:16,type:me,colorSpace:At,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,n,r){const i=r?new Blob([r],{type:"image/jpeg"}):void 0,s=new Blob([n],{type:"image/jpeg"});let a,o,l=!1;if("undefined"==typeof createImageBitmap){const e=await Promise.all([i?VY(i):Promise.resolve(void 0),VY(s)]);o=e[0],a=e[1],l=!0}else{const e=await Promise.all([i?createImageBitmap(i,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:"flipY"})]);o=e[0],a=e[1]}const c=new Cn(o||new ImageData(2,2),W,Z,Z,ie,oe,ye,le,1,At);c.flipY=l,c.needsUpdate=!0;const u=new Cn(a,W,Z,Z,ie,oe,ye,le,1,gt);u.flipY=l,u.needsUpdate=!0,e.width=a.width,e.height=a.height,e.material.gainMap=c,e.material.sdr=u,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class WY extends jY{load([e,t,n],r,i,s){const a=this.prepareQuadRenderer();let o,l,c;const u=async()=>{if(o&&l&&c){try{await this.render(a,c,o,l)}catch(r){return this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),"function"==typeof s&&s(r),void a.disposeOnDemandRenderer()}"function"==typeof r&&r(a),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),a.disposeOnDemandRenderer()}};let h=!0,d=0,f=0,p=!0,m=0,g=0,A=!0,v=0,y=0;const E=()=>{if("function"==typeof i){i(new ProgressEvent("progress",{lengthComputable:h&&p&&A,loaded:f+g+y,total:d+m+v}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const _=new uh(this._internalLoadingManager);_.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setPath(this.path),_.setWithCredentials(this.withCredentials),_.load(e,async e=>{if("string"==typeof e)throw new Error("Invalid sdr buffer");o=e,await u()},e=>{h=e.lengthComputable,f=e.loaded,d=e.total,E()},t=>{this.manager.itemError(e),"function"==typeof s&&s(t)});const x=new uh(this._internalLoadingManager);x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(t,async e=>{if("string"==typeof e)throw new Error("Invalid gainmap buffer");l=e,await u()},e=>{p=e.lengthComputable,g=e.loaded,m=e.total,E()},e=>{this.manager.itemError(t),"function"==typeof s&&s(e)});const b=new uh(this._internalLoadingManager);return b.setRequestHeader(this.requestHeader),b.setPath(this.path),b.setWithCredentials(this.withCredentials),b.load(n,async e=>{if("string"!=typeof e)throw new Error("Invalid metadata string");c=JSON.parse(e),await u()},e=>{A=e.lengthComputable,y=e.loaded,v=e.total,E()},e=>{this.manager.itemError(n),"function"==typeof s&&s(e)}),a}}class YY extends jY{load(e,t,n,r){const i=this.prepareQuadRenderer(),s=new uh(this._internalLoadingManager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(this.withCredentials),this.manager.itemStart(e),s.load(e,async n=>{if("string"==typeof n)throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const s=new Uint8Array(n);let a,o,l;try{const e=await HY(s);a=e.sdr,o=e.gainMap,l=e.metadata}catch(e){if(!(e instanceof zY||e instanceof NY))throw e;l={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},a=s}try{await this.render(i,l,a,o)}catch(t){return this.manager.itemError(e),"function"==typeof r&&r(t),void i.disposeOnDemandRenderer()}"function"==typeof t&&t(i),this.manager.itemEnd(e),i.disposeOnDemandRenderer()},n,t=>{this.manager.itemError(e),"function"==typeof r&&r(t)}),i}}const KY={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},qY="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",XY=e=>Array.isArray(e),$Y=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function JY({files:e=$Y,path:t="",preset:n,encoding:r,extensions:i}={}){let s=null,o=!1;n&&(tK(n),e=KY[n],t=qY),o=XY(e);const{extension:l,isCubemap:c}=nK(e);if(s=rK(l),!s)throw new Error("useEnvironment: Unrecognized file extension: "+e);const u=zp(e=>e.gl);a(()=>{"webp"!==l&&"jpg"!==l&&"jpeg"!==l||u.domElement.addEventListener("webglcontextlost",function(){jp.clear(s,o?[e]:e)},{once:!0})},[e,u.domElement]);const h=jp(s,o?[e]:e,e=>{"webp"!==l&&"jpg"!==l&&"jpeg"!==l||e.setRenderer(u),null==e.setPath||e.setPath(t),i&&i(e)});let d=o?h[0]:h;var f;"jpg"!==l&&"jpeg"!==l&&"webp"!==l||(d=null==(f=d.renderTarget)?void 0:f.texture);return d.mapping=c?Y:q,"colorSpace"in d?d.colorSpace=(null!=r?r:c)?"srgb":"srgb-linear":d.encoding=(null!=r?r:c)?3001:3e3,d}const ZY={files:$Y,path:"",preset:void 0,extensions:void 0};JY.preload=e=>{const t={...ZY,...e};let{files:n,path:r=""}=t;const{preset:i,extensions:s}=t;i&&(tK(i),n=KY[i],r=qY);const{extension:a}=nK(n);if("webp"===a||"jpg"===a||"jpeg"===a)throw new Error("useEnvironment: Preloading gainmaps is not supported");const o=rK(a);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+n);jp.preload(o,XY(n)?[n]:n,e=>{null==e.setPath||e.setPath(r),s&&s(e)})};const eK={files:$Y,preset:void 0};function tK(e){if(!(e in KY))throw new Error("Preset must be one of: "+Object.keys(KY).join(", "))}function nK(e){var t;const n=XY(e)&&6===e.length,r=XY(e)&&3===e.length&&e.some(e=>e.endsWith("json")),i=XY(e)?e[0]:e;return{extension:n?"cube":r?"webp":i.startsWith("data:application/exr")?"exr":i.startsWith("data:application/hdr")?"hdr":i.startsWith("data:image/jpeg")?"jpg":null==(t=i.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:n,isGainmap:r}}function rK(e){return"cube"===e?dh:"hdr"===e?IT:"exr"===e?BT:"jpg"===e||"jpeg"===e?YY:"webp"===e?WY:null}JY.clear=e=>{const t={...eK,...e};let{files:n}=t;const{preset:r}=t;r&&(tK(r),n=KY[r]);const{extension:i}=nK(n),s=rK(i);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+n);jp.clear(s,XY(n)?[n]:n)};function iK(e,t,n,r,i={}){var s,a,o,l;i={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...i};const c=(e=>{return(t=e).current&&t.current.isScene?e.current:e;var t})(t||n),u=c.background,h=c.environment,d={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:null!==(s=null==(a=c.backgroundRotation)||null==a.clone?void 0:a.clone())&&void 0!==s?s:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:null!==(o=null==(l=c.environmentRotation)||null==l.clone?void 0:l.clone())&&void 0!==o?o:[0,0,0]};return"only"!==e&&(c.environment=r),e&&(c.background=r),Xp(c,i),()=>{"only"!==e&&(c.environment=h),e&&(c.background=u),Xp(c,d)}}function sK({scene:t,background:n=!1,map:r,...i}){const s=zp(e=>e.scene);return e.useLayoutEffect(()=>{if(r)return iK(n,t,s,r,i)}),null}function aK({background:t=!1,scene:n,blur:r,backgroundBlurriness:i,backgroundIntensity:s,backgroundRotation:a,environmentIntensity:o,environmentRotation:l,...c}){const u=JY(c),h=zp(e=>e.scene);return e.useLayoutEffect(()=>iK(t,n,h,u,{backgroundBlurriness:null!=r?r:i,backgroundIntensity:s,backgroundRotation:a,environmentIntensity:o,environmentRotation:l})),e.useEffect(()=>()=>{u.dispose()},[u]),null}function oK({children:t,near:n=.1,far:r=1e3,resolution:i=256,frames:s=1,map:a,background:o=!1,blur:l,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:d,environmentRotation:f,scene:p,files:m,path:g,preset:A,extensions:v}){const y=zp(e=>e.gl),E=zp(e=>e.scene),_=e.useRef(null),[x]=e.useState(()=>new jo),b=e.useMemo(()=>{const e=new $i(i);return e.texture.type=me,e},[i]);e.useEffect(()=>()=>{b.dispose()},[b]),e.useLayoutEffect(()=>{if(1===s){const e=y.autoClear;y.autoClear=!0,_.current.update(y,x),y.autoClear=e}return iK(o,p,E,b.texture,{backgroundBlurriness:null!=l?l:c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:d,environmentRotation:f})},[t,x,b.texture,p,E,o,s,y]);let S=1;return Gp(()=>{if(s===1/0||S<s){const e=y.autoClear;y.autoClear=!0,_.current.update(y,x),y.autoClear=e,S++}}),e.createElement(e.Fragment,null,rm(e.createElement(e.Fragment,null,t,e.createElement("cubeCamera",{ref:_,args:[n,r,b]}),m||A?e.createElement(aK,{background:!0,files:m,preset:A,path:g,extensions:v}):a?e.createElement(sK,{background:!0,map:a,extensions:v}):null),x))}function lK(t){var n,r,i,s;const a=JY(t),o=t.map||a;e.useMemo(()=>Hf({GroundProjectedEnvImpl:Eb}),[]),e.useEffect(()=>()=>{a.dispose()},[a]);const l=e.useMemo(()=>[o],[o]),c=null==(n=t.ground)?void 0:n.height,u=null==(r=t.ground)?void 0:r.radius,h=null!==(i=null==(s=t.ground)?void 0:s.scale)&&void 0!==i?i:1e3;return e.createElement(e.Fragment,null,e.createElement(sK,Lm({},t,{map:o})),e.createElement("groundProjectedEnvImpl",{args:l,scale:h,height:c,radius:u}))}function cK(t){return t.ground?e.createElement(lK,t):t.map?e.createElement(sK,t):t.children?e.createElement(oK,t):e.createElement(aK,t)}const uK=e.forwardRef(({scale:t=10,frames:n=1/0,opacity:r=1,width:i=1,height:s=1,blur:a=1,near:o=0,far:l=10,resolution:c=512,smooth:u=!0,color:h="#000000",depthWrite:d=!1,renderOrder:f,...p},m)=>{const g=e.useRef(null),A=zp(e=>e.scene),v=zp(e=>e.gl),y=e.useRef(null);i*=Array.isArray(t)?t[0]:t||1,s*=Array.isArray(t)?t[1]:t||1;const[E,_,x,b,S,w,C]=e.useMemo(()=>{const e=new In(c,c),t=new In(c,c);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;const n=new os(i,s).rotateX(Math.PI/2),r=new Ui(n),a=new To;a.depthTest=a.depthWrite=!1,a.onBeforeCompile=e=>{e.uniforms={...e.uniforms,ucolor:{value:new $r(h)}},e.fragmentShader=e.fragmentShader.replace("void main() {","uniform vec3 ucolor;\n           void main() {\n          "),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const o=new ji(Yw),l=new ji(Kw);return l.depthTest=o.depthTest=!1,[e,n,a,r,o,l,t]},[c,i,s,t,h]),T=e=>{b.visible=!0,b.material=S,S.uniforms.tDiffuse.value=E.texture,S.uniforms.h.value=1*e/256,v.setRenderTarget(C),v.render(b,y.current),b.material=w,w.uniforms.tDiffuse.value=C.texture,w.uniforms.v.value=1*e/256,v.setRenderTarget(E),v.render(b,y.current),b.visible=!1};let M,I,R=0;return Gp(()=>{y.current&&(n===1/0||R<n)&&(R++,M=A.background,I=A.overrideMaterial,g.current.visible=!1,A.background=null,A.overrideMaterial=x,v.setRenderTarget(E),v.render(A,y.current),T(a),u&&T(.4*a),v.setRenderTarget(null),g.current.visible=!0,A.overrideMaterial=I,A.background=M)}),e.useImperativeHandle(m,()=>g.current,[]),e.createElement("group",Lm({"rotation-x":Math.PI/2},p,{ref:g}),e.createElement("mesh",{renderOrder:f,geometry:_,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},e.createElement("meshBasicMaterial",{transparent:!0,map:E.texture,opacity:r,depthWrite:d})),e.createElement("orthographicCamera",{ref:y,args:[-i/2,i/2,s/2,-s/2,o,l]}))});const hK=e.createContext(null),dK=tR({color:new $r,blend:2,alphaTest:.75,opacity:0,map:null},"varying vec2 vUv;\n   void main() {\n     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n     vUv = uv;\n   }",`varying vec2 vUv;\n   uniform sampler2D map;\n   uniform vec3 color;\n   uniform float opacity;\n   uniform float alphaTest;\n   uniform float blend;\n   void main() {\n     vec4 sampledDiffuseColor = texture2D(map, vUv);\n     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);\n     #include <tonemapping_fragment>\n     #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n   }`),fK=e.forwardRef(({children:t,temporal:n,frames:r=40,limit:i=1/0,blend:s=20,scale:a=10,opacity:o=1,alphaTest:l=.75,color:c="black",colorBlend:u=2,resolution:h=1024,toneMapped:d=!0,...f},p)=>{Hf({SoftShadowMaterial:dK});const m=zp(e=>e.gl),g=zp(e=>e.scene),A=zp(e=>e.camera),v=zp(e=>e.invalidate),y=e.useRef(null),E=e.useRef(null),[_]=e.useState(()=>new mK(m,g,h));e.useLayoutEffect(()=>{_.configure(y.current)},[]);const x=e.useMemo(()=>({lights:new Map,temporal:!!n,frames:Math.max(2,r),blend:Math.max(2,r===1/0?s:r),count:0,getMesh:()=>y.current,reset:()=>{_.clear();const e=y.current.material;e.opacity=0,e.alphaTest=0,x.count=0},update:(e=1)=>{const t=y.current.material;x.temporal?(t.opacity=Math.min(o,t.opacity+o/x.blend),t.alphaTest=Math.min(l,t.alphaTest+l/x.blend)):(t.opacity=o,t.alphaTest=l),E.current.visible=!0,_.prepare();for(let t=0;t<e;t++)x.lights.forEach(e=>e.update()),_.update(A,x.blend);E.current.visible=!1,_.finish()}}),[_,A,g,n,r,s,o,l]);return e.useLayoutEffect(()=>{x.reset(),x.temporal||x.frames===1/0||x.update(x.blend)}),e.useImperativeHandle(p,()=>x,[x]),Gp(()=>{(x.temporal||x.frames===1/0)&&x.count<x.frames&&x.count<i&&(v(),x.update(),x.count++)}),e.createElement("group",f,e.createElement("group",{traverse:()=>null,ref:E},e.createElement(hK.Provider,{value:x},t)),e.createElement("mesh",{receiveShadow:!0,ref:y,scale:a,rotation:[-Math.PI/2,0,0]},e.createElement("planeGeometry",null),e.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:d,color:c,blend:u,map:_.progressiveLightMap2.texture})))}),pK=e.forwardRef(({castShadow:t=!0,bias:n=.001,mapSize:r=512,size:i=5,near:s=.5,far:a=500,frames:o=1,position:l=[0,0,0],radius:c=1,amount:u=8,intensity:h=(sR>=155?Math.PI:1),ambient:d=.5,...f},p)=>{const m=e.useRef(null),g=new Dn(...l).length(),A=e.useContext(hK),v=e.useCallback(()=>{let e;if(m.current)for(let t=0;t<m.current.children.length;t++)if(e=m.current.children[t],Math.random()>d)e.position.set(l[0]+tn.randFloatSpread(c),l[1]+tn.randFloatSpread(c),l[2]+tn.randFloatSpread(c));else{let t=Math.acos(2*Math.random()-1)-Math.PI/2,n=2*Math.PI*Math.random();e.position.set(Math.cos(t)*Math.cos(n)*g,Math.abs(Math.cos(t)*Math.sin(n)*g),Math.sin(t)*g)}},[c,d,g,...l]),y=e.useMemo(()=>({update:v}),[v]);return e.useImperativeHandle(p,()=>y,[y]),e.useLayoutEffect(()=>{var e;const t=m.current;return A&&(null==(e=A.lights)||e.set(t.uuid,y)),()=>{var e;null==A||null==(e=A.lights)||e.delete(t.uuid)}},[A,y]),e.createElement("group",Lm({ref:m},f),Array.from({length:u},(o,l)=>e.createElement("directionalLight",{key:l,castShadow:t,"shadow-bias":n,"shadow-mapSize":[r,r],intensity:h/u},e.createElement("orthographicCamera",{attach:"shadow-camera",args:[-i,i,i,-i,s,a]}))))});class mK{constructor(e,t,n=1024){this.renderer=e,this.res=n,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new $r,this.clearAlpha=0;const r={type:me,magFilter:te,minFilter:te};this.progressiveLightMap1=new In(this.res,this.res,r),this.progressiveLightMap2=new In(this.res,this.res,r),this.discardMat=new WW,this.targetMat=new ku({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=e=>{e.vertexShader="varying vec2 vUv;\n"+e.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const t=e.fragmentShader.indexOf("void main() {");e.fragmentShader="varying vec2 vUv;\n"+e.fragmentShader.slice(0,t)+"uniform sampler2D previousShadowMap;\n\tuniform float averagingWindow;\n"+e.fragmentShader.slice(t-1,-1)+"\nvec3 texelOld = texture2D(previousShadowMap, vUv).rgb;\n        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);\n      }",e.uniforms.previousShadowMap=this.previousShadowMap,e.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{!function(e){return!!e.geometry}(e)?function(e){return e.isLight}(e)&&this.lights.push({object:e,intensity:e.intensity}):this.meshes.push({object:e,material:e.material})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;const n=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,i=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(n),this.previousShadowMap.value=r.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=i}}const gK={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function AK({radius:t,adjustCamera:n}){const r=PY();return e.useEffect(()=>{n&&r.refresh().clip().fit()},[t,n]),null}function vK({children:t,center:n,adjustCamera:r=!0,intensity:i=.5,shadows:s="contact",environment:a="city",preset:o="rembrandt",...l}){var c,u,h,d,f,p,m,g;const A="string"==typeof o?gK[o]:o,[{radius:v,height:y},E]=e.useState({radius:0,width:0,height:0,depth:0}),_=null!==(c=null==s?void 0:s.bias)&&void 0!==c?c:-1e-4,x=null!==(u=null==s?void 0:s.normalBias)&&void 0!==u?u:0,b=null!==(h=null==s?void 0:s.size)&&void 0!==h?h:1024,S=null!==(d=null==s?void 0:s.offset)&&void 0!==d?d:0,w="contact"===s||"contact"===(null==s?void 0:s.type),C="accumulative"===s||"accumulative"===(null==s?void 0:s.type),T={..."object"==typeof s?s:{}},M=a?"string"==typeof a?{preset:a}:a:null,I=e.useCallback(e=>{const{width:t,height:r,depth:i,boundingSphere:s}=e;E({radius:s.radius,width:t,height:r,depth:i}),null!=n&&n.onCentered&&n.onCentered(e)},[]);return e.createElement(e.Fragment,null,e.createElement("ambientLight",{intensity:i/3}),e.createElement("spotLight",{penumbra:1,position:[A.main[0]*v,A.main[1]*v,A.main[2]*v],intensity:2*i,castShadow:!!s,"shadow-bias":_,"shadow-normalBias":x,"shadow-mapSize":b}),e.createElement("pointLight",{position:[A.fill[0]*v,A.fill[1]*v,A.fill[2]*v],intensity:i}),e.createElement(BY,Lm({fit:!!r,clip:!!r,margin:Number(r),observe:!0},l),e.createElement(AK,{radius:v,adjustCamera:r}),e.createElement(Lj,Lm({},n,{position:[0,S/2,0],onCentered:I}),t)),e.createElement("group",{position:[0,-y/2-S/2,0]},w&&e.createElement(uK,Lm({scale:4*v,far:v,blur:2},T)),C&&e.createElement(fK,Lm({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:4*v},T),e.createElement(pK,{amount:null!==(f=T.amount)&&void 0!==f?f:8,radius:null!==(p=T.radius)&&void 0!==p?p:v,ambient:null!==(m=T.ambient)&&void 0!==m?m:.5,intensity:null!==(g=T.intensity)&&void 0!==g?g:1,position:[A.main[0]*v,A.main[1]*v,A.main[2]*v],size:4*v,bias:-_,mapSize:b}))),a&&e.createElement(cK,M))}const yK=e=>0===e?0:Math.pow(2,10*e-10);function EK({children:t,floor:n=.25,segments:r=20,receiveShadow:i,...s}){const a=e.useRef(null);return e.useLayoutEffect(()=>{let e=0;const t=r/r/2,i=a.current.attributes.position;for(let s=0;s<r+1;s++)for(let a=0;a<r+1;a++)i.setXYZ(e++,s/r-t+(0===s?-n:0),a/r-t,yK(s/r));i.needsUpdate=!0,a.current.computeVertexNormals()},[r,n]),e.createElement("group",s,e.createElement("mesh",{receiveShadow:i,rotation:[-Math.PI/2,0,Math.PI/2]},e.createElement("planeGeometry",{ref:a,args:[1,1,r,r]}),t))}const _K=e.forwardRef(({fog:t=!1,renderOrder:n,depthWrite:r=!1,colorStop:i=0,color:s="black",opacity:a=.5,...o},l)=>{const c=e.useMemo(()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const t=e.getContext("2d"),n=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);return n.addColorStop(i,new $r(s).getStyle()),n.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=n,t.fillRect(0,0,e.width,e.height),e},[s,i]);return e.createElement("mesh",Lm({renderOrder:n,ref:l,"rotation-x":-Math.PI/2},o),e.createElement("planeGeometry",null),e.createElement("meshBasicMaterial",{transparent:!0,opacity:a,fog:t,depthWrite:r,side:2},e.createElement("canvasTexture",{attach:"map",args:[c]})))});function xK(e=0){const t={value:new cr};return Object.assign(new Lu({side:e}),{viewMatrix:t,onBeforeCompile:e=>{e.uniforms.viewMatrix=t,e.fragmentShader="vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n           return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n         }\n"+e.fragmentShader.replace("#include <normal_fragment_maps>","#include <normal_fragment_maps>\n           normal = inverseTransformDirection( normal, viewMatrix );\n")}})}const bK=tR({causticsTexture:null,causticsTextureB:null,color:new $r,lightProjMatrix:new cr,lightViewMatrix:new cr},"varying vec3 vWorldPosition;\n   void main() {\n     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n     vec4 worldPosition = modelMatrix * vec4(position, 1.);\n     vWorldPosition = worldPosition.xyz;\n   }",`varying vec3 vWorldPosition;\n  uniform vec3 color;\n  uniform sampler2D causticsTexture;\n  uniform sampler2D causticsTextureB;\n  uniform mat4 lightProjMatrix;\n  uniform mat4 lightViewMatrix;\n   void main() {\n    // Apply caustics\n    vec4 lightSpacePos = lightProjMatrix * lightViewMatrix * vec4(vWorldPosition, 1.0);\n    lightSpacePos.xyz /= lightSpacePos.w;\n    lightSpacePos.xyz = lightSpacePos.xyz * 0.5 + 0.5;\n    vec3 front = texture2D(causticsTexture, lightSpacePos.xy).rgb;\n    vec3 back = texture2D(causticsTextureB, lightSpacePos.xy).rgb;\n    gl_FragColor = vec4((front + back) * color, 1.0);\n    #include <tonemapping_fragment>\n    #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n   }`),SK=tR({cameraMatrixWorld:new cr,cameraProjectionMatrixInv:new cr,normalTexture:null,depthTexture:null,lightDir:new Dn(0,1,0),lightPlaneNormal:new Dn(0,1,0),lightPlaneConstant:0,near:.1,far:100,modelMatrix:new cr,worldRadius:1/40,ior:1.1,bounces:0,resolution:1024,size:10,intensity:.5},"\n  varying vec2 vUv;\n  void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }","\n  uniform mat4 cameraMatrixWorld;\n  uniform mat4 cameraProjectionMatrixInv;\n  uniform vec3 lightDir;\n  uniform vec3 lightPlaneNormal;\n  uniform float lightPlaneConstant;\n  uniform float near;\n  uniform float far;\n  uniform float time;\n  uniform float worldRadius;\n  uniform float resolution;\n  uniform float size;\n  uniform float intensity;\n  uniform float ior;\n  precision highp isampler2D;\n  precision highp usampler2D;\n  uniform sampler2D normalTexture;\n  uniform sampler2D depthTexture;\n  uniform float bounces;\n  varying vec2 vUv;\n  vec3 WorldPosFromDepth(float depth, vec2 coord) {\n    float z = depth * 2.0 - 1.0;\n    vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);\n    vec4 viewSpacePosition = cameraProjectionMatrixInv * clipSpacePosition;\n    // Perspective division\n    viewSpacePosition /= viewSpacePosition.w;\n    vec4 worldSpacePosition = cameraMatrixWorld * viewSpacePosition;\n    return worldSpacePosition.xyz;\n  }\n  float sdPlane( vec3 p, vec3 n, float h ) {\n    // n must be normalized\n    return dot(p,n) + h;\n  }\n  float planeIntersect( vec3 ro, vec3 rd, vec4 p ) {\n    return -(dot(ro,p.xyz)+p.w)/dot(rd,p.xyz);\n  }\n  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 pos, vec3 normal, float ior, out vec3 rayOrigin, out vec3 rayDirection) {\n    rayOrigin = ro;\n    rayDirection = rd;\n    rayDirection = refract(rayDirection, normal, 1.0 / ior);\n    rayOrigin = pos + rayDirection * 0.1;\n    return rayDirection;\n  }\n  void main() {\n    // Each sample consists of random offset in the x and y direction\n    float caustic = 0.0;\n    float causticTexelSize = (1.0 / resolution) * size * 2.0;\n    float texelsNeeded = worldRadius / causticTexelSize;\n    float sampleRadius = texelsNeeded / resolution;\n    float sum = 0.0;\n    if (texture2D(depthTexture, vUv).x == 1.0) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    vec2 offset1 = vec2(-0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);\n    vec2 offset2 = vec2(-0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);\n    vec2 offset3 = vec2(0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);\n    vec2 offset4 = vec2(0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);\n    vec2 uv1 = vUv + offset1 * sampleRadius;\n    vec2 uv2 = vUv + offset2 * sampleRadius;\n    vec2 uv3 = vUv + offset3 * sampleRadius;\n    vec2 uv4 = vUv + offset4 * sampleRadius;\n    vec3 normal1 = texture2D(normalTexture, uv1, -10.0).rgb * 2.0 - 1.0;\n    vec3 normal2 = texture2D(normalTexture, uv2, -10.0).rgb * 2.0 - 1.0;\n    vec3 normal3 = texture2D(normalTexture, uv3, -10.0).rgb * 2.0 - 1.0;\n    vec3 normal4 = texture2D(normalTexture, uv4, -10.0).rgb * 2.0 - 1.0;\n    float depth1 = texture2D(depthTexture, uv1, -10.0).x;\n    float depth2 = texture2D(depthTexture, uv2, -10.0).x;\n    float depth3 = texture2D(depthTexture, uv3, -10.0).x;\n    float depth4 = texture2D(depthTexture, uv4, -10.0).x;\n    // Sanity check the depths\n    if (depth1 == 1.0 || depth2 == 1.0 || depth3 == 1.0 || depth4 == 1.0) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n      return;\n    }\n    vec3 pos1 = WorldPosFromDepth(depth1, uv1);\n    vec3 pos2 = WorldPosFromDepth(depth2, uv2);\n    vec3 pos3 = WorldPosFromDepth(depth3, uv3);\n    vec3 pos4 = WorldPosFromDepth(depth4, uv4);\n    vec3 originPos1 = WorldPosFromDepth(0.0, uv1);\n    vec3 originPos2 = WorldPosFromDepth(0.0, uv2);\n    vec3 originPos3 = WorldPosFromDepth(0.0, uv3);\n    vec3 originPos4 = WorldPosFromDepth(0.0, uv4);\n    vec3 endPos1, endPos2, endPos3, endPos4;\n    vec3 endDir1, endDir2, endDir3, endDir4;\n    totalInternalReflection(originPos1, lightDir, pos1, normal1, ior, endPos1, endDir1);\n    totalInternalReflection(originPos2, lightDir, pos2, normal2, ior, endPos2, endDir2);\n    totalInternalReflection(originPos3, lightDir, pos3, normal3, ior, endPos3, endDir3);\n    totalInternalReflection(originPos4, lightDir, pos4, normal4, ior, endPos4, endDir4);\n    float lightPosArea = length(cross(originPos2 - originPos1, originPos3 - originPos1)) + length(cross(originPos3 - originPos1, originPos4 - originPos1));\n    float t1 = planeIntersect(endPos1, endDir1, vec4(lightPlaneNormal, lightPlaneConstant));\n    float t2 = planeIntersect(endPos2, endDir2, vec4(lightPlaneNormal, lightPlaneConstant));\n    float t3 = planeIntersect(endPos3, endDir3, vec4(lightPlaneNormal, lightPlaneConstant));\n    float t4 = planeIntersect(endPos4, endDir4, vec4(lightPlaneNormal, lightPlaneConstant));\n    vec3 finalPos1 = endPos1 + endDir1 * t1;\n    vec3 finalPos2 = endPos2 + endDir2 * t2;\n    vec3 finalPos3 = endPos3 + endDir3 * t3;\n    vec3 finalPos4 = endPos4 + endDir4 * t4;\n    float finalArea = length(cross(finalPos2 - finalPos1, finalPos3 - finalPos1)) + length(cross(finalPos3 - finalPos1, finalPos4 - finalPos1));\n    caustic += intensity * (lightPosArea / finalArea);\n    // Calculate the area of the triangle in light spaces\n    gl_FragColor = vec4(vec3(max(caustic, 0.0)), 1.0);\n  }"),wK={depth:!0,minFilter:ie,magFilter:ie,type:le},CK={minFilter:ae,magFilter:ie,type:pe,generateMipmaps:!0},TK=e.forwardRef(({debug:t,children:n,frames:r=1,ior:i=1.1,color:s="white",causticsOnly:a=!1,backside:o=!1,backsideIOR:l=1.1,worldRadius:c=.3125,intensity:u=.05,resolution:h=2024,lightSource:d=[5,5,5],...f},p)=>{Hf({CausticsProjectionMaterial:bK});const m=e.useRef(null),g=e.useRef(null),A=e.useRef(null),v=e.useRef(null),y=zp(e=>e.gl),E=iQ(t&&g,Vd),_=WR(h,h,wK),x=WR(h,h,wK),b=WR(h,h,CK),S=WR(h,h,CK),[w]=e.useState(()=>xK()),[C]=e.useState(()=>xK(1)),[T]=e.useState(()=>new SK),[M]=e.useState(()=>new TS(T));e.useLayoutEffect(()=>{m.current.updateWorldMatrix(!1,!0)});let I=0;const B=new Dn,P=new is,L=new cr,k=new ts,F=new Dn,O=new Dn,U=new Fn,N=new Dn,z=[],G=[],Q=[],H=[],V=new Dn;for(let e=0;e<8;e++)z.push(new Dn),G.push(new Dn),Q.push(new Dn),H.push(new Dn);return Gp(()=>{if(r===1/0||I++<r){var e,n;Array.isArray(d)?F.fromArray(d).normalize():F.copy(m.current.worldToLocal(d.current.getWorldPosition(B)).normalize()),O.copy(F).multiplyScalar(-1),null==(e=A.current.parent)||e.matrixWorld.identity(),U.setFromObject(A.current,!0),z[0].set(U.min.x,U.min.y,U.min.z),z[1].set(U.min.x,U.min.y,U.max.z),z[2].set(U.min.x,U.max.y,U.min.z),z[3].set(U.min.x,U.max.y,U.max.z),z[4].set(U.max.x,U.min.y,U.min.z),z[5].set(U.max.x,U.min.y,U.max.z),z[6].set(U.max.x,U.max.y,U.min.z),z[7].set(U.max.x,U.max.y,U.max.z);for(let e=0;e<8;e++)G[e].copy(z[e]);U.getCenter(N),z.map(e=>e.sub(N));const r=k.set(O,0);z.map((e,t)=>r.projectPoint(e,Q[t]));const s=Q.reduce((e,t)=>e.add(t),B.set(0,0,0)).divideScalar(Q.length),f=Q.map(e=>e.distanceTo(s)).reduce((e,t)=>Math.max(e,t)),p=z.map(e=>e.dot(F)).reduce((e,t)=>Math.max(e,t));g.current.position.copy(V.copy(F).multiplyScalar(p).add(N)),g.current.lookAt(A.current.localToWorld(N));const I=L.lookAt(g.current.position,N,B.set(0,1,0));g.current.left=-f,g.current.right=f,g.current.top=f,g.current.bottom=-f;const R=B.set(0,f,0).applyMatrix4(I),D=(g.current.position.y+R.y)/F.y;g.current.near=.1,g.current.far=D,g.current.updateProjectionMatrix(),g.current.updateMatrixWorld();const j=G.map((e,t)=>e.add(H[t].copy(F).multiplyScalar(-e.y/F.y))),W=j.reduce((e,t)=>e.add(t),B.set(0,0,0)).divideScalar(j.length),Y=2*j.map(e=>Math.hypot(e.x-W.x,e.z-W.z)).reduce((e,t)=>Math.max(e,t));v.current.scale.setScalar(Y),v.current.position.copy(W),t&&(null==(n=E.current)||n.update()),C.viewMatrix.value=w.viewMatrix.value=g.current.matrixWorldInverse;const K=P.setFromProjectionMatrix(L.multiplyMatrices(g.current.projectionMatrix,g.current.matrixWorldInverse)).planes[4];T.cameraMatrixWorld=g.current.matrixWorld,T.cameraProjectionMatrixInv=g.current.projectionMatrixInverse,T.lightDir=O,T.lightPlaneNormal=K.normal,T.lightPlaneConstant=K.constant,T.near=g.current.near,T.far=g.current.far,T.resolution=h,T.size=f,T.intensity=u,T.worldRadius=c,A.current.visible=!0,y.setRenderTarget(_),y.clear(),A.current.overrideMaterial=w,y.render(A.current,g.current),y.setRenderTarget(x),y.clear(),o&&(A.current.overrideMaterial=C,y.render(A.current,g.current)),A.current.overrideMaterial=null,T.ior=i,v.current.material.lightProjMatrix=g.current.projectionMatrix,v.current.material.lightViewMatrix=g.current.matrixWorldInverse,T.normalTexture=_.texture,T.depthTexture=_.depthTexture,y.setRenderTarget(b),y.clear(),M.render(y),T.ior=l,T.normalTexture=x.texture,T.depthTexture=x.depthTexture,y.setRenderTarget(S),y.clear(),o&&M.render(y),y.setRenderTarget(null),a&&(A.current.visible=!1)}}),e.useImperativeHandle(p,()=>m.current,[]),e.createElement("group",Lm({ref:m},f),e.createElement("scene",{ref:A},e.createElement("orthographicCamera",{ref:g,up:[0,1,0]}),n),e.createElement("mesh",{renderOrder:2,ref:v,"rotation-x":-Math.PI/2},e.createElement("planeGeometry",null),e.createElement("causticsProjectionMaterial",{transparent:!0,color:s,causticsTexture:b.texture,causticsTextureB:S.texture,blending:5,blendSrc:R,blendDst:D,depthWrite:!1}),t&&e.createElement(hR,null,e.createElement("lineBasicMaterial",{color:"#ffff00",toneMapped:!1}))))}),MK=e.forwardRef(({mixBlur:t=0,mixStrength:n=.5,resolution:r=256,blur:i=[0,0],args:s=[1,1],minDepthThreshold:a=.9,maxDepthThreshold:o=1,depthScale:l=0,depthToBlurRatioBias:c=.25,mirror:u=0,children:h,debug:d=0,distortion:f=1,mixContrast:p=1,distortionMap:m,...g},A)=>{Hf({MeshReflectorMaterial:QW}),e.useEffect(()=>{},[]);const v=zp(({gl:e})=>e),y=zp(({camera:e})=>e),E=zp(({scene:e})=>e),_=(i=Array.isArray(i)?i:[i,i])[0]+i[1]>0,x=e.useRef(null);e.useImperativeHandle(A,()=>x.current,[]);const[b]=e.useState(()=>new ts),[S]=e.useState(()=>new Dn),[w]=e.useState(()=>new Dn),[C]=e.useState(()=>new Dn),[T]=e.useState(()=>new cr),[M]=e.useState(()=>new Dn(0,0,-1)),[I]=e.useState(()=>new Tn),[R]=e.useState(()=>new Dn),[B]=e.useState(()=>new Dn),[P]=e.useState(()=>new Tn),[D]=e.useState(()=>new cr),[L]=e.useState(()=>new Yi),k=e.useCallback(()=>{if(w.setFromMatrixPosition(x.current.matrixWorld),C.setFromMatrixPosition(y.matrixWorld),T.extractRotation(x.current.matrixWorld),S.set(0,0,1),S.applyMatrix4(T),R.subVectors(w,C),R.dot(S)>0)return;R.reflect(S).negate(),R.add(w),T.extractRotation(y.matrixWorld),M.set(0,0,-1),M.applyMatrix4(T),M.add(C),B.subVectors(w,M),B.reflect(S).negate(),B.add(w),L.position.copy(R),L.up.set(0,1,0),L.up.applyMatrix4(T),L.up.reflect(S),L.lookAt(B),L.far=y.far,L.updateMatrixWorld(),L.projectionMatrix.copy(y.projectionMatrix),D.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),D.multiply(L.projectionMatrix),D.multiply(L.matrixWorldInverse),D.multiply(x.current.matrixWorld),b.setFromNormalAndCoplanarPoint(S,w),b.applyMatrix4(L.matrixWorldInverse),I.set(b.normal.x,b.normal.y,b.normal.z,b.constant);const e=L.projectionMatrix;P.x=(Math.sign(I.x)+e.elements[8])/e.elements[0],P.y=(Math.sign(I.y)+e.elements[9])/e.elements[5],P.z=-1,P.w=(1+e.elements[10])/e.elements[14],I.multiplyScalar(2/I.dot(P)),e.elements[2]=I.x,e.elements[6]=I.y,e.elements[10]=I.z+1,e.elements[14]=I.w},[]),[F,O,U,N]=e.useMemo(()=>{const e={type:me,minFilter:ie,magFilter:ie},s=new In(r,r,e);s.depthBuffer=!0,s.depthTexture=new Oo(r,r),s.depthTexture.format=Ee,s.depthTexture.type=he;const h=new In(r,r,e);return[s,h,new GW({gl:v,resolution:r,width:i[0],height:i[1],minDepthThreshold:a,maxDepthThreshold:o,depthScale:l,depthToBlurRatioBias:c}),{mirror:u,textureMatrix:D,mixBlur:t,tDiffuse:s.texture,tDepth:s.depthTexture,tDiffuseBlur:h.texture,hasBlur:_,mixStrength:n,minDepthThreshold:a,maxDepthThreshold:o,depthScale:l,depthToBlurRatioBias:c,transparent:!0,debug:d,distortion:f,distortionMap:m,mixContrast:p,"defines-USE_BLUR":_?"":void 0,"defines-USE_DEPTH":l>0?"":void 0,"defines-USE_DISTORTION":m?"":void 0}]},[v,i,D,r,u,_,t,n,a,o,l,c,d,f,m,p]);return Gp(()=>{if(null==x||!x.current)return;x.current.visible=!1;const e=v.xr.enabled,t=v.shadowMap.autoUpdate;k(),v.xr.enabled=!1,v.shadowMap.autoUpdate=!1,v.setRenderTarget(F),v.state.buffers.depth.setMask(!0),v.autoClear||v.clear(),v.render(E,L),_&&U.render(v,F,O),v.xr.enabled=e,v.shadowMap.autoUpdate=t,x.current.visible=!0,v.setRenderTarget(null)}),e.createElement("mesh",Lm({ref:x},g),e.createElement("planeGeometry",{args:s}),h?h("meshReflectorMaterial",N):e.createElement("meshReflectorMaterial",N))});class IK extends ji{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new Dn(0,0,0)},lightColor:{value:new $r("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new nn(0,0)}},transparent:!0,depthWrite:!1,vertexShader:"\n        varying vec3 vNormal;\n        varying float vViewZ;\n        varying float vIntensity;\n        uniform vec3 spotPosition;\n        uniform float attenuation;\n\n        #include <common>\n        #include <logdepthbuf_pars_vertex>\n\n        void main() {\n          // compute intensity\n          vNormal = normalize(normalMatrix * normal);\n          vec4 worldPosition = modelMatrix * vec4(position, 1);\n          vec4 viewPosition = viewMatrix * worldPosition;\n          vViewZ = viewPosition.z;\n\n          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);\n\n          gl_Position = projectionMatrix * viewPosition;\n\n          #include <logdepthbuf_vertex>\n        }\n      ",fragmentShader:`\n        varying vec3 vNormal;\n        varying float vViewZ;\n        varying float vIntensity;\n\n        uniform vec3 lightColor;\n        uniform float anglePower;\n        uniform sampler2D depth;\n        uniform vec2 resolution;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float opacity;\n\n        #include <packing>\n        #include <logdepthbuf_pars_fragment>\n\n        float readDepth(sampler2D depthSampler, vec2 uv) {\n          float fragCoordZ = texture(depthSampler, uv).r;\n\n          // https://github.com/mrdoob/three.js/issues/23072\n          #ifdef USE_LOGDEPTHBUF\n            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));\n          #else\n            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\n          #endif\n\n          return viewZ;\n        }\n\n        void main() {\n          #include <logdepthbuf_fragment>\n\n          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));\n          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);\n          float intensity = vIntensity * angleIntensity;\n\n          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry\n          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;\n          if (isSoft) {\n            vec2 uv = gl_FragCoord.xy / resolution;\n            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));\n          }\n\n          gl_FragColor = vec4(lightColor, intensity * opacity);\n\n          #include <tonemapping_fragment>\n          #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n        }\n      `})}}function RK({opacity:t=1,radiusTop:n,radiusBottom:r,depthBuffer:i,color:s="white",distance:a=5,angle:o=.15,attenuation:l=5,anglePower:c=5}){const u=e.useRef(null),h=zp(e=>e.size),d=zp(e=>e.camera),f=zp(e=>e.viewport.dpr),[p]=e.useState(()=>new IK),[m]=e.useState(()=>new Dn);n=void 0===n?.1:n,r=void 0===r?7*o:r,Gp(()=>{p.uniforms.spotPosition.value.copy(u.current.getWorldPosition(m)),u.current.lookAt(u.current.parent.target.getWorldPosition(m))});const g=e.useMemo(()=>{const e=new Rc(n,r,a,128,64,!0);return e.applyMatrix4((new cr).makeTranslation(0,-a/2,0)),e.applyMatrix4((new cr).makeRotationX(-Math.PI/2)),e},[a,n,r]);return e.createElement(e.Fragment,null,e.createElement("mesh",{ref:u,geometry:g,raycast:()=>null},e.createElement("primitive",{object:p,attach:"material","uniforms-opacity-value":t,"uniforms-lightColor-value":s,"uniforms-attenuation-value":l,"uniforms-anglePower-value":c,"uniforms-depth-value":i,"uniforms-cameraNear-value":d.near,"uniforms-cameraFar-value":d.far,"uniforms-resolution-value":i?[h.width*f,h.height*f]:[0,0]})))}function BK(t,n,r,i,s){const[[a,o]]=e.useState(()=>[new Dn,new Dn]);e.useLayoutEffect(()=>{if(!(null==(e=t.current)?void 0:e.isSpotLight))throw new Error("SpotlightShadow must be a child of a SpotLight");var e;t.current.shadow.mapSize.set(r,i),t.current.shadow.needsUpdate=!0},[t,r,i]),Gp(()=>{if(!t.current)return;const e=t.current.position,r=t.current.target.position;o.copy(r).sub(e);var i=o.length();o.normalize().multiplyScalar(i*s),a.copy(e).add(o),n.current.position.copy(a),n.current.lookAt(t.current.target.position)})}function PK({distance:t=.4,alphaTest:n=.5,map:r,shader:i="#define GLSLIFY 1\nvarying vec2 vUv;uniform sampler2D uShadowMap;uniform float uTime;void main(){vec3 color=texture2D(uShadowMap,vUv).xyz;gl_FragColor=vec4(color,1.);}",width:s=512,height:a=512,scale:o=1,children:l,...c}){const u=e.useRef(null),h=c.spotlightRef,d=c.debug;BK(h,u,s,a,t);const f=e.useMemo(()=>new In(s,a,{format:ye,stencilBuffer:!1}),[s,a]),p=e.useRef({uShadowMap:{value:r},uTime:{value:0}});e.useEffect(()=>{p.current.uShadowMap.value=r},[r]);const m=e.useMemo(()=>new TS(new ji({uniforms:p.current,vertexShader:"\n          varying vec2 vUv;\n\n          void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          }\n          ",fragmentShader:i})),[i]);return e.useEffect(()=>()=>{m.material.dispose(),m.dispose()},[m]),e.useEffect(()=>()=>f.dispose(),[f]),Gp(({gl:e},t)=>{p.current.uTime.value+=t,e.setRenderTarget(f),m.render(e),e.setRenderTarget(null)}),e.createElement(e.Fragment,null,e.createElement("mesh",{ref:u,scale:o,castShadow:!0},e.createElement("planeGeometry",null),e.createElement("meshBasicMaterial",{transparent:!0,side:2,alphaTest:n,alphaMap:f.texture,"alphaMap-wrapS":J,"alphaMap-wrapT":J,opacity:d?1:0},l)))}function DK({distance:t=.4,alphaTest:n=.5,map:r,width:i=512,height:s=512,scale:a,children:o,...l}){const c=e.useRef(null),u=l.spotlightRef,h=l.debug;return BK(u,c,i,s,t),e.createElement(e.Fragment,null,e.createElement("mesh",{ref:c,scale:a,castShadow:!0},e.createElement("planeGeometry",null),e.createElement("meshBasicMaterial",{transparent:!0,side:2,alphaTest:n,alphaMap:r,"alphaMap-wrapS":J,"alphaMap-wrapT":J,opacity:h?1:0},o)))}function LK(t){return t.shader?e.createElement(PK,t):e.createElement(DK,t)}const kK=e.forwardRef(({opacity:t=1,radiusTop:n,radiusBottom:r,depthBuffer:i,color:s="white",distance:a=5,angle:o=.15,attenuation:l=5,anglePower:c=5,volumetric:u=!0,debug:h=!1,children:d,...f},p)=>{const m=e.useRef(null);return e.useImperativeHandle(p,()=>m.current,[]),e.createElement("group",null,h&&m.current&&e.createElement("spotLightHelper",{args:[m.current]}),e.createElement("spotLight",Lm({ref:m,angle:o,color:s,distance:a,castShadow:!0},f),u&&e.createElement(RK,{debug:h,opacity:t,radiusTop:n,radiusBottom:r,depthBuffer:i,color:s,distance:a,angle:o,attenuation:l,anglePower:c})),d&&e.cloneElement(d,{spotlightRef:m,debug:h}))}),FK=e.forwardRef(({light:t,args:n,map:r,toneMapped:i=!1,color:s="white",form:a="rect",intensity:o=1,scale:l=1,target:c=[0,0,0],children:u,...h},d)=>{const f=e.useRef(null);return e.useImperativeHandle(d,()=>f.current,[]),e.useLayoutEffect(()=>{u||h.material||(Xp(f.current.material,{color:s}),f.current.material.color.multiplyScalar(o))},[s,o,u,h.material]),e.useLayoutEffect(()=>{h.rotation||f.current.quaternion.identity(),c&&!h.rotation&&("boolean"==typeof c?f.current.lookAt(0,0,0):f.current.lookAt(Array.isArray(c)?new Dn(...c):c))},[c,h.rotation]),l=Array.isArray(l)&&2===l.length?[l[0],l[1],1]:l,e.createElement("mesh",Lm({ref:f,scale:l},h),"circle"===a?e.createElement("ringGeometry",{args:n||[0,.5,64]}):"ring"===a?e.createElement("ringGeometry",{args:n||[.25,.5,64]}):"rect"===a||"plane"===a?e.createElement("planeGeometry",{args:n||[1,1]}):"box"===a?e.createElement("boxGeometry",{args:n||[1,1,1]}):e.createElement(a,{args:n}),u||e.createElement("meshBasicMaterial",{toneMapped:i,map:r,side:2}),t&&e.createElement("pointLight",Lm({castShadow:!0},t)))});function OK(e,t,n=new Dn){const r=Math.PI*(e-.5),i=2*Math.PI*(t-.5);return n.x=Math.cos(i),n.y=Math.sin(r),n.z=Math.sin(i),n}const UK=e.forwardRef(({inclination:t=.6,azimuth:n=.1,distance:r=1e3,mieCoefficient:i=.005,mieDirectionalG:s=.8,rayleigh:a=.5,turbidity:o=10,sunPosition:l=OK(t,n),...c},u)=>{const h=e.useMemo(()=>(new Dn).setScalar(r),[r]),[d]=e.useState(()=>new yb);return e.createElement("primitive",Lm({object:d,ref:u,"material-uniforms-mieCoefficient-value":i,"material-uniforms-mieDirectionalG-value":s,"material-uniforms-rayleigh-value":a,"material-uniforms-sunPosition-value":l,"material-uniforms-turbidity-value":o,scale:h},c))});class NK extends ji{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:"\n      uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:`\n      uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n      }`})}}const zK=e=>(new Dn).setFromSpherical(new bd(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),GK=e.forwardRef(({radius:t=100,depth:n=50,count:r=5e3,saturation:i=0,factor:s=4,fade:a=!1,speed:o=1},l)=>{const c=e.useRef(),[u,h,d]=e.useMemo(()=>{const e=[],a=[],o=Array.from({length:r},()=>(.5+.5*Math.random())*s),l=new $r;let c=t+n;const u=n/r;for(let t=0;t<r;t++)c-=u*Math.random(),e.push(...zK(c).toArray()),l.setHSL(t/r,i,.9),a.push(l.r,l.g,l.b);return[new Float32Array(e),new Float32Array(a),new Float32Array(o)]},[r,n,s,t,i]);Gp(e=>c.current&&(c.current.uniforms.time.value=e.clock.elapsedTime*o));const[f]=e.useState(()=>new NK);return e.createElement("points",{ref:l},e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",args:[u,3]}),e.createElement("bufferAttribute",{attach:"attributes-color",args:[h,3]}),e.createElement("bufferAttribute",{attach:"attributes-size",args:[d,1]})),e.createElement("primitive",{ref:c,object:f,attach:"material",blending:2,"uniforms-fade-value":a,depthWrite:!1,transparent:!0,vertexColors:!0}))}),QK=new cr,HK=new Dn,VK=new Pn,jK=new Dn,WK=new Pn,YK=new Dn,KK=e.createContext(null),qK=e.forwardRef(({children:t,material:n=ku,texture:r="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",range:i,limit:s=200,frustumCulled:a,...o},l)=>{var c,u;const h=e.useMemo(()=>class extends n{constructor(){super();const e=parseInt(E.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=t=>{t.vertexShader="attribute float cloudOpacity;\n               varying float vOpacity;\n              "+t.vertexShader.replace("#include <fog_vertex>","#include <fog_vertex>\n                 vOpacity = cloudOpacity;\n                "),t.fragmentShader="varying float vOpacity;\n              "+t.fragmentShader.replace(`#include <${e}>`,`#include <${e}>\n                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);\n                `)}}},[n]);Hf({CloudMaterial:h});const d=e.useRef(null),f=e.useRef([]),p=e.useMemo(()=>new Float32Array(Array.from({length:s},()=>1)),[s]),m=e.useMemo(()=>new Float32Array(Array.from({length:s},()=>[1,1,1]).flat()),[s]),g=rR(r);let A,v=0,y=0;const _=new Pn,x=new Dn(0,0,1),b=new Dn;Gp((e,t)=>{for(v=e.clock.elapsedTime,QK.copy(d.current.matrixWorld).invert(),e.camera.matrixWorld.decompose(jK,WK,YK),y=0;y<f.current.length;y++)A=f.current[y],A.ref.current.matrixWorld.decompose(HK,VK,YK),HK.add(b.copy(A.position).applyQuaternion(VK).multiply(YK)),VK.copy(WK).multiply(_.setFromAxisAngle(x,A.rotation+=t*A.rotationFactor)),YK.multiplyScalar(A.volume+(1+Math.sin(v*A.density*A.speed))/2*A.growth),A.matrix.compose(HK,VK,YK).premultiply(QK),A.dist=HK.distanceTo(jK);for(f.current.sort((e,t)=>t.dist-e.dist),y=0;y<f.current.length;y++)A=f.current[y],p[y]=A.opacity*(A.dist<A.fade-1?A.dist/A.fade:1),d.current.setMatrixAt(y,A.matrix),d.current.setColorAt(y,A.color);d.current.geometry.attributes.cloudOpacity.needsUpdate=!0,d.current.instanceMatrix.needsUpdate=!0,d.current.instanceColor&&(d.current.instanceColor.needsUpdate=!0)}),e.useLayoutEffect(()=>{const e=Math.min(s,void 0!==i?i:s,f.current.length);d.current.count=e,fW(d.current.instanceMatrix,{offset:0,count:16*e}),d.current.instanceColor&&fW(d.current.instanceColor,{offset:0,count:3*e}),fW(d.current.geometry.attributes.cloudOpacity,{offset:0,count:e})});let S=[null!==(c=g.image.width)&&void 0!==c?c:1,null!==(u=g.image.height)&&void 0!==u?u:1];const w=Math.max(S[0],S[1]);return S=[S[0]/w,S[1]/w],e.createElement("group",Lm({ref:l},o),e.createElement(KK.Provider,{value:f},t,e.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:d,args:[null,null,s],frustumCulled:a},e.createElement("instancedBufferAttribute",{usage:Ft,attach:"instanceColor",args:[m,3]}),e.createElement("planeGeometry",{args:[...S]},e.createElement("instancedBufferAttribute",{usage:Ft,attach:"attributes-cloudOpacity",args:[p,1]})),e.createElement("cloudMaterial",{key:n.name,map:g,transparent:!0,depthWrite:!1}))))}),XK=e.forwardRef(({opacity:t=1,speed:n=0,bounds:r=[5,1,1],segments:i=20,color:s="#ffffff",fade:a=10,volume:o=6,smallestVolume:l=.25,distribute:c=null,growth:u=4,concentrate:h="inside",seed:d=Math.random(),...f},p)=>{function m(){const e=1e4*Math.sin(d++);return e-Math.floor(e)}const g=e.useContext(KK),A=e.useRef(null),v=e.useId(),y=e.useMemo(()=>[...new Array(i)].map((e,t)=>({segments:i,bounds:new Dn(1,1,1),position:new Dn,uuid:v,index:t,ref:A,dist:0,matrix:new cr,color:new $r,rotation:t*(Math.PI/i)})),[i,v]);return e.useLayoutEffect(()=>{y.forEach((e,d)=>{Xp(e,{volume:o,color:s,speed:n,growth:u,opacity:t,fade:a,bounds:r,density:Math.max(.5,m()),rotationFactor:Math.max(.2,.5*m())*n});const f=null==c?void 0:c(e,d);var p;(f||i>1)&&e.position.copy(e.bounds).multiply(null!==(p=null==f?void 0:f.point)&&void 0!==p?p:{x:2*m()-1,y:2*m()-1,z:2*m()-1});const g=Math.abs(e.position.x),A=Math.abs(e.position.y),v=Math.abs(e.position.z),y=Math.max(g,A,v);e.length=1,g===y&&(e.length-=g/e.bounds.x),A===y&&(e.length-=A/e.bounds.y),v===y&&(e.length-=v/e.bounds.z),e.volume=(void 0!==(null==f?void 0:f.volume)?f.volume:Math.max(Math.max(0,l),"random"===h?m():"inside"===h?e.length:1-e.length))*o})},[h,r,a,s,t,u,o,d,i,n]),e.useLayoutEffect(()=>{const e=y;return g.current=[...g.current,...e],()=>{g.current=g.current.filter(e=>e.uuid!==v)}},[y]),e.useImperativeHandle(p,()=>A.current,[]),e.createElement("group",Lm({ref:A},f))}),$K=e.forwardRef((t,n)=>e.useContext(KK)?e.createElement(XK,Lm({ref:n},t)):e.createElement(qK,null,e.createElement(XK,Lm({ref:n},t))));class JK extends ji{constructor(){super({uniforms:{time:{value:0},pixelRatio:{value:1}},vertexShader:"\n        uniform float pixelRatio;\n        uniform float time;\n        attribute float size;  \n        attribute float speed;  \n        attribute float opacity;\n        attribute vec3 noise;\n        attribute vec3 color;\n        varying vec3 vColor;\n        varying float vOpacity;\n\n        void main() {\n          vec4 modelPosition = modelMatrix * vec4(position, 1.0);\n          modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;\n          modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;\n          modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;\n          vec4 viewPosition = viewMatrix * modelPosition;\n          vec4 projectionPostion = projectionMatrix * viewPosition;\n          gl_Position = projectionPostion;\n          gl_PointSize = size * 25. * pixelRatio;\n          gl_PointSize *= (1.0 / - viewPosition.z);\n          vColor = color;\n          vOpacity = opacity;\n        }\n      ",fragmentShader:`\n        varying vec3 vColor;\n        varying float vOpacity;\n        void main() {\n          float distanceToCenter = distance(gl_PointCoord, vec2(0.5));\n          float strength = 0.05 / distanceToCenter - 0.1;\n          gl_FragColor = vec4(vColor, strength * vOpacity);\n          #include <tonemapping_fragment>\n          #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n        }\n      `})}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}get pixelRatio(){return this.uniforms.pixelRatio.value}set pixelRatio(e){this.uniforms.pixelRatio.value=e}}const ZK=e=>e&&e.constructor===Float32Array,eq=e=>e instanceof nn||e instanceof Dn||e instanceof Tn,tq=e=>Array.isArray(e)?e:eq(e)?e.toArray():[e,e,e];function nq(t,n,r){return e.useMemo(()=>{if(void 0!==n){if(ZK(n))return n;if(n instanceof $r){const e=Array.from({length:3*t},()=>(e=>[e.r,e.g,e.b])(n)).flat();return Float32Array.from(e)}if(eq(n)||Array.isArray(n)){const e=Array.from({length:3*t},()=>tq(n)).flat();return Float32Array.from(e)}return Float32Array.from({length:t},()=>n)}return Float32Array.from({length:t},r)},[n])}const rq=e.forwardRef(({noise:t=1,count:n=100,speed:r=1,opacity:i=1,scale:s=1,size:a,color:o,children:l,...c},u)=>{e.useMemo(()=>Hf({SparklesImplMaterial:JK}),[]);const h=e.useRef(null),d=zp(e=>e.viewport.dpr),f=tq(s),p=e.useMemo(()=>Float32Array.from(Array.from({length:n},()=>f.map(tn.randFloatSpread)).flat()),[n,...f]),m=nq(n,a,Math.random),g=nq(n,i),A=nq(n,r),v=nq(3*n,t),y=nq(void 0===o?3*n:n,ZK(o)?o:new $r(o),()=>1);return Gp(e=>{h.current&&h.current.material&&(h.current.material.time=e.clock.elapsedTime)}),e.useImperativeHandle(u,()=>h.current,[]),e.createElement("points",Lm({key:`particle-${n}-${JSON.stringify(s)}`},c,{ref:h}),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",args:[p,3]}),e.createElement("bufferAttribute",{attach:"attributes-size",args:[m,1]}),e.createElement("bufferAttribute",{attach:"attributes-opacity",args:[g,1]}),e.createElement("bufferAttribute",{attach:"attributes-speed",args:[A,1]}),e.createElement("bufferAttribute",{attach:"attributes-color",args:[y,3]}),e.createElement("bufferAttribute",{attach:"attributes-noise",args:[v,3]})),l||e.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:d,depthWrite:!1}))});function iq(t=0,n=1024,r){const i=ff(()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json").then(e=>e.json()),["matcapList"]),s=i[0],a=e.useMemo(()=>Object.keys(i).length,[]),o=`${e.useMemo(()=>"string"==typeof t?t:"number"==typeof t?i[t]:null,[t])||s}${function(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}(n)}.png`,l=`https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d/${n}/${o}`;return[rR(l,r),l,a]}const sq=({children:t,id:n,format:r,onLoad:i})=>{const s=iq(n,r,i);return e.createElement(e.Fragment,null,null==t?void 0:t(s))};function aq(t=0,n={},r){const{repeat:i=[1,1],anisotropy:s=1,offset:a=[0,0]}=n,o=ff(()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json").then(e=>e.json()),["normalsList"]),l=e.useMemo(()=>Object.keys(o).length,[]),c=o[0],u=`https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb/normals/${o[t]||c}`,h=rR(u,r);return e.useLayoutEffect(()=>{h&&(h.wrapS=h.wrapT=J,h.repeat=new nn(i[0],i[1]),h.offset=new nn(a[0],a[1]),h.anisotropy=s)},[h,s,i,a]),[h,u,l]}const oq=({children:t,id:n,onLoad:r,...i})=>{const s=aq(n,i,r);return e.createElement(e.Fragment,null,null==t?void 0:t(s))},lq={uniforms:{strokeOpacity:1,fillOpacity:.25,fillMix:0,thickness:.05,colorBackfaces:!1,dashInvert:!0,dash:!1,dashRepeats:4,dashLength:.5,squeeze:!1,squeezeMin:.2,squeezeMax:1,stroke:new $r("#ff0000"),backfaceStroke:new $r("#0000ff"),fill:new $r("#00ff00")},vertex:"\n\t  attribute vec3 barycentric;\n\t\n\t\tvarying vec3 v_edges_Barycentric;\n\t\tvarying vec3 v_edges_Position;\n\n\t\tvoid initWireframe() {\n\t\t\tv_edges_Barycentric = barycentric;\n\t\t\tv_edges_Position = position.xyz;\n\t\t}\n\t  ",fragment:"\n\t\t#ifndef PI\n\t  \t#define PI 3.1415926535897932384626433832795\n\t\t#endif\n  \n\t  varying vec3 v_edges_Barycentric;\n\t  varying vec3 v_edges_Position;\n  \n\t  uniform float strokeOpacity;\n\t  uniform float fillOpacity;\n\t  uniform float fillMix;\n\t  uniform float thickness;\n\t  uniform bool colorBackfaces;\n  \n\t  // Dash\n\t  uniform bool dashInvert;\n\t  uniform bool dash;\n\t  uniform bool dashOnly;\n\t  uniform float dashRepeats;\n\t  uniform float dashLength;\n  \n\t  // Squeeze\n\t  uniform bool squeeze;\n\t  uniform float squeezeMin;\n\t  uniform float squeezeMax;\n  \n\t  // Colors\n\t  uniform vec3 stroke;\n\t  uniform vec3 backfaceStroke;\n\t  uniform vec3 fill;\n  \n\t  // This is like\n\t  float wireframe_aastep(float threshold, float dist) {\n\t\t  float afwidth = fwidth(dist) * 0.5;\n\t\t  return smoothstep(threshold - afwidth, threshold + afwidth, dist);\n\t  }\n  \n\t  float wireframe_map(float value, float min1, float max1, float min2, float max2) {\n\t\t  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n\t  }\n  \n\t  float getWireframe() {\n\t\t\tvec3 barycentric = v_edges_Barycentric;\n\t\t\n\t\t\t// Distance from center of each triangle to its edges.\n\t\t\tfloat d = min(min(barycentric.x, barycentric.y), barycentric.z);\n\n\t\t\t// for dashed rendering, we can use this to get the 0 .. 1 value of the line length\n\t\t\tfloat positionAlong = max(barycentric.x, barycentric.y);\n\t\t\tif (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {\n\t\t\t\tpositionAlong = 1.0 - positionAlong;\n\t\t\t}\n\n\t\t\t// the thickness of the stroke\n\t\t\tfloat computedThickness = wireframe_map(thickness, 0.0, 1.0, 0.0, 0.34);\n\n\t\t\t// if we want to shrink the thickness toward the center of the line segment\n\t\t\tif (squeeze) {\n\t\t\t\tcomputedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));\n\t\t\t}\n\n\t\t\t// Create dash pattern\n\t\t\tif (dash) {\n\t\t\t\t// here we offset the stroke position depending on whether it\n\t\t\t\t// should overlap or not\n\t\t\t\tfloat offset = 1.0 / dashRepeats * dashLength / 2.0;\n\t\t\t\tif (!dashInvert) {\n\t\t\t\t\toffset += 1.0 / dashRepeats / 2.0;\n\t\t\t\t}\n\n\t\t\t\t// if we should animate the dash or not\n\t\t\t\t// if (dashAnimate) {\n\t\t\t\t// \toffset += time * 0.22;\n\t\t\t\t// }\n\n\t\t\t\t// create the repeating dash pattern\n\t\t\t\tfloat pattern = fract((positionAlong + offset) * dashRepeats);\n\t\t\t\tcomputedThickness *= 1.0 - wireframe_aastep(dashLength, pattern);\n\t\t\t}\n\n\t\t\t// compute the anti-aliased stroke edge  \n\t\t\tfloat edge = 1.0 - wireframe_aastep(computedThickness, d);\n\n\t\t\treturn edge;\n\t  }\n\t  "},cq=tR(lq.uniforms,lq.vertex+"\n  \tvoid main() {\n\t\tinitWireframe();\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t}\n  ",lq.fragment+"\n  void main () {\n\t\t// Compute color\n\n\t\tfloat edge = getWireframe();\n\t\tvec4 colorStroke = vec4(stroke, edge);\n\n\t\t#ifdef FLIP_SIDED\n\t\t\tcolorStroke.rgb = backfaceStroke;\n\t\t#endif\n    \n\t\tvec4 colorFill = vec4(fill, fillOpacity);\n\t\tvec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);\n\n\t\tgl_FragColor = outColor;\n\t}\n  ");function uq(e){return void 0!==(null==e?void 0:e.current)}function hq(e){return"WireframeGeometry"===e.type}function dq(e){const t=null!=(n=e)&&n.current?e.current:e;var n;if(function(e){return!(null==e||!e.isBufferGeometry)}(t))return t;{if(hq(t))throw new Error("Wireframe: WireframeGeometry is not supported.");const e=t.parent;if(function(e){return!(null==e||!e.geometry)}(e)){if(hq(e.geometry))throw new Error("Wireframe: WireframeGeometry is not supported.");return e.geometry}}}function fq(e,t){if(e.index){const t=e.toNonIndexed();e.copy(t),e.setIndex(null)}const n=function(e,t){const n=e.getAttribute("position").count,r=[];for(let e=0;e<n;e++){const n=t?1:0;e%2==0?r.push(0,0,1,0,1,0,1,0,n):r.push(0,1,0,0,0,1,1,0,n)}return new ci(Float32Array.from(r),3)}(e,t);e.setAttribute("barycentric",n)}function pq({geometry:t,simplify:n=!1,...r}){Hf({MeshWireframeMaterial:cq});const[i,s]=e.useState(null);e.useLayoutEffect(()=>{const e=dq(t);if(!e)throw new Error("Wireframe: geometry prop must be a BufferGeometry or a ref to a BufferGeometry.");fq(e,n),uq(t)&&s(e)},[n,t]);const a=uq(t)?i:t;return e.createElement(e.Fragment,null,a&&e.createElement("mesh",{geometry:a},e.createElement("meshWireframeMaterial",Lm({attach:"material",transparent:!0,side:2,polygonOffset:!0,polygonOffsetFactor:-4},r,{extensions:{derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1}}))))}function mq({simplify:t=!1,...n}){const r=e.useRef(null),i=e.useMemo(()=>function(){const e={};for(const t in lq.uniforms)e[t]={value:lq.uniforms[t]};return e}(),[lq.uniforms]);return function(t,n){e.useEffect(()=>{var e;t.fillOpacity.value=null!==(e=n.fillOpacity)&&void 0!==e?e:t.fillOpacity.value},[n.fillOpacity]),e.useEffect(()=>{var e;t.fillMix.value=null!==(e=n.fillMix)&&void 0!==e?e:t.fillMix.value},[n.fillMix]),e.useEffect(()=>{var e;t.strokeOpacity.value=null!==(e=n.strokeOpacity)&&void 0!==e?e:t.strokeOpacity.value},[n.strokeOpacity]),e.useEffect(()=>{var e;t.thickness.value=null!==(e=n.thickness)&&void 0!==e?e:t.thickness.value},[n.thickness]),e.useEffect(()=>{t.colorBackfaces.value=!!n.colorBackfaces},[n.colorBackfaces]),e.useEffect(()=>{t.dash.value=!!n.dash},[n.dash]),e.useEffect(()=>{t.dashInvert.value=!!n.dashInvert},[n.dashInvert]),e.useEffect(()=>{var e;t.dashRepeats.value=null!==(e=n.dashRepeats)&&void 0!==e?e:t.dashRepeats.value},[n.dashRepeats]),e.useEffect(()=>{var e;t.dashLength.value=null!==(e=n.dashLength)&&void 0!==e?e:t.dashLength.value},[n.dashLength]),e.useEffect(()=>{t.squeeze.value=!!n.squeeze},[n.squeeze]),e.useEffect(()=>{var e;t.squeezeMin.value=null!==(e=n.squeezeMin)&&void 0!==e?e:t.squeezeMin.value},[n.squeezeMin]),e.useEffect(()=>{var e;t.squeezeMax.value=null!==(e=n.squeezeMax)&&void 0!==e?e:t.squeezeMax.value},[n.squeezeMax]),e.useEffect(()=>{t.stroke.value=n.stroke?new $r(n.stroke):t.stroke.value},[n.stroke]),e.useEffect(()=>{t.fill.value=n.fill?new $r(n.fill):t.fill.value},[n.fill]),e.useEffect(()=>{t.backfaceStroke.value=n.backfaceStroke?new $r(n.backfaceStroke):t.backfaceStroke.value},[n.backfaceStroke])}(i,n),e.useLayoutEffect(()=>{const e=dq(r);if(!e)throw new Error("Wireframe: Must be a child of a Mesh, Line or Points object or specify a geometry prop.");const n=e.clone();return fq(e,t),()=>{e.copy(n),n.dispose()}},[t]),e.useLayoutEffect(()=>{const e=r.current.parent,t=e.material.clone();return function(e,t){e.onBeforeCompile=e=>{e.uniforms={...e.uniforms,...t},e.vertexShader=e.vertexShader.replace("void main() {",`\n\t\t  ${lq.vertex}\n\t\t  void main() {\n\t\t\tinitWireframe();\n\t\t`),e.fragmentShader=e.fragmentShader.replace("void main() {",`\n\t\t  ${lq.fragment}\n\t\t  void main() {\n\t\t`),e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>","\n\t\t  #include <color_fragment>\n\t\t\t  float edge = getWireframe();\n\t\t  vec4 colorStroke = vec4(stroke, edge);\n\t\t  #ifdef FLIP_SIDED\n\t\t\tcolorStroke.rgb = backfaceStroke;\n\t\t  #endif\n\t\t  vec4 colorFill = vec4(mix(diffuseColor.rgb, fill, fillMix), mix(diffuseColor.a, fillOpacity, fillMix));\n\t\t  vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);\n\n\t\t  diffuseColor.rgb = outColor.rgb;\n\t\t  diffuseColor.a *= outColor.a;\n\t\t")},e.side=2,e.transparent=!0}(e.material,i),()=>{e.material.dispose(),e.material=t}},[]),e.createElement("object3D",{ref:r})}function gq({geometry:t,...n}){return t?e.createElement(pq,Lm({geometry:t},n)):e.createElement(mq,n)}function Aq({opacity:t,alphaMap:n}){const r=e.useRef(null),i=e.useRef(null),s=e.useRef({value:1}),a=e.useRef({value:null}),o=e.useRef({value:!1});return e.useLayoutEffect(()=>{r.current.onBeforeCompile=i.current.onBeforeCompile=e=>{const t=e.fragmentShader.indexOf("void main");let n,r="",i=t;for(;"\n"!==n&&i<t+100;)n=e.fragmentShader.charAt(i),r+=n,i++;r=r.trim(),e.vertexShader=e.vertexShader.replace("void main() {","\n        varying vec2 custom_vUv;\n\n        void main() {\n          custom_vUv = uv;\n          \n        "),e.fragmentShader=e.fragmentShader.replace(r,"\n          uniform float uShadowOpacity;\n          uniform sampler2D uAlphaMap;\n          uniform bool uHasAlphaMap;\n\n          varying vec2 custom_vUv;\n  \n          float bayerDither2x2( vec2 v ) {\n            return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );\n          }\n    \n          float bayerDither4x4( vec2 v ) {\n            vec2 P1 = mod( v, 2.0 );\n            vec2 P2 = mod( floor( 0.5  * v ), 2.0 );\n            return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );\n          }\n  \n          void main() {\n            float alpha = \n              uHasAlphaMap ? \n                uShadowOpacity * texture2D(uAlphaMap, custom_vUv).x\n              : uShadowOpacity;\n\n            if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;\n            \n          "),e.uniforms.uShadowOpacity=s.current,e.uniforms.uAlphaMap=a.current,e.uniforms.uHasAlphaMap=o.current}},[]),Gp(()=>{var e;const i=null==(e=r.current.__r3f)?void 0:e.parent;if(i){const e=i.material;e&&(s.current.value=null!=t?t:e.opacity,!1===n?(a.current.value=null,o.current.value=!1):(a.current.value=n||e.alphaMap,o.current.value=!!a.current.value))}}),e.createElement(e.Fragment,null,e.createElement("meshDepthMaterial",{ref:r,attach:"customDepthMaterial",depthPacking:pt}),e.createElement("meshDistanceMaterial",{ref:i,attach:"customDistanceMaterial"}))}const vq=new cr,yq=new lr,Eq=new er,_q=new Dn;class xq extends Lo{constructor(){super(),this.size=0,this.color=new $r("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){var n,r;const i=this.instance.current;if(!i||!i.geometry)return;const s=i.userData.instances.indexOf(this.instanceKey);if(-1===s||s>i.geometry.drawRange.count)return;const a=null!==(n=null==(r=e.params.Points)?void 0:r.threshold)&&void 0!==n?n:1;if(Eq.set(this.getWorldPosition(_q),a),!1===e.ray.intersectsSphere(Eq))return;vq.copy(i.matrixWorld).invert(),yq.copy(e.ray).applyMatrix4(vq);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=yq.distanceSqToPoint(this.position);if(c<l){const n=new Dn;yq.closestPointToPoint(this.position,n),n.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(n);if(r<e.near||r>e.far)return;t.push({distance:r,distanceToRay:Math.sqrt(c),point:n,index:s,face:null,object:this})}}}let bq,Sq;const wq=e.createContext(null),Cq=new cr,Tq=new Dn,Mq=e.forwardRef(({children:t,range:n,limit:r=1e3,...i},s)=>{const a=e.useRef(null);e.useImperativeHandle(s,()=>a.current,[]);const[o,l]=e.useState([]),[[c,u,h]]=e.useState(()=>[new Float32Array(3*r),Float32Array.from({length:3*r},()=>1),Float32Array.from({length:r},()=>1)]);e.useEffect(()=>{a.current.geometry.attributes.position.needsUpdate=!0}),Gp(()=>{for(a.current.updateMatrix(),a.current.updateMatrixWorld(),Cq.copy(a.current.matrixWorld).invert(),a.current.geometry.drawRange.count=Math.min(r,void 0!==n?n:r,o.length),bq=0;bq<o.length;bq++)Sq=o[bq].current,Sq.getWorldPosition(Tq).applyMatrix4(Cq),Tq.toArray(c,3*bq),a.current.geometry.attributes.position.needsUpdate=!0,Sq.matrixWorldNeedsUpdate=!0,Sq.color.toArray(u,3*bq),a.current.geometry.attributes.color.needsUpdate=!0,h.set([Sq.size],bq),a.current.geometry.attributes.size.needsUpdate=!0});const d=e.useMemo(()=>({getParent:()=>a,subscribe:e=>(l(t=>[...t,e]),()=>l(t=>t.filter(t=>t.current!==e.current)))}),[]);return e.createElement("points",Lm({userData:{instances:o},matrixAutoUpdate:!1,ref:a,raycast:()=>null},i),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:c.length/3,array:c,itemSize:3,usage:Ft}),e.createElement("bufferAttribute",{attach:"attributes-color",count:u.length/3,array:u,itemSize:3,usage:Ft}),e.createElement("bufferAttribute",{attach:"attributes-size",count:h.length,array:h,itemSize:1,usage:Ft})),e.createElement(wq.Provider,{value:d},t))}),Iq=e.forwardRef(({children:t,...n},r)=>{e.useMemo(()=>Hf({PositionPoint:xq}),[]);const i=e.useRef(null);e.useImperativeHandle(r,()=>i.current,[]);const{subscribe:s,getParent:a}=e.useContext(wq);return e.useLayoutEffect(()=>s(i),[]),e.createElement("positionPoint",Lm({instance:a(),instanceKey:i,ref:i},n),t)}),Rq=e.forwardRef(({children:t,positions:n,colors:r,sizes:i,stride:s=3,...a},o)=>{const l=e.useRef(null);return e.useImperativeHandle(o,()=>l.current,[]),Gp(()=>{const e=l.current.geometry.attributes;e.position.needsUpdate=!0,r&&(e.color.needsUpdate=!0),i&&(e.size.needsUpdate=!0)}),e.createElement("points",Lm({ref:l},a),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:n.length/s,array:n,itemSize:s,usage:Ft}),r&&e.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/s,array:r,itemSize:3,usage:Ft}),i&&e.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:Ft})),t)}),Bq=e.forwardRef((t,n)=>t.positions instanceof Float32Array?e.createElement(Rq,Lm({},t,{ref:n})):e.createElement(Mq,Lm({},t,{ref:n}))),Pq=e.createContext(null),Dq=e.forwardRef((t,n)=>{e.useMemo(()=>Hf({SegmentObject:Lq}),[]);const{limit:r=1e3,lineWidth:i=1,children:s,...a}=t,[o,l]=e.useState([]),[c]=e.useState(()=>new sM),[u]=e.useState(()=>new zT),[h]=e.useState(()=>new UT),[d]=e.useState(()=>new nn(512,512)),[f]=e.useState(()=>Array(6*r).fill(0)),[p]=e.useState(()=>Array(6*r).fill(0)),m=e.useMemo(()=>({subscribe:e=>(l(t=>[...t,e]),()=>l(t=>t.filter(t=>t.current!==e.current)))}),[]);return Gp(()=>{for(let t=0;t<r;t++){var e;const n=null==(e=o[t])?void 0:e.current;n&&(f[6*t+0]=n.start.x,f[6*t+1]=n.start.y,f[6*t+2]=n.start.z,f[6*t+3]=n.end.x,f[6*t+4]=n.end.y,f[6*t+5]=n.end.z,p[6*t+0]=n.color.r,p[6*t+1]=n.color.g,p[6*t+2]=n.color.b,p[6*t+3]=n.color.r,p[6*t+4]=n.color.g,p[6*t+5]=n.color.b)}h.setColors(p),h.setPositions(f),c.computeLineDistances()}),e.createElement("primitive",{object:c,ref:n},e.createElement("primitive",{object:h,attach:"geometry"}),e.createElement("primitive",Lm({object:u,attach:"material",vertexColors:!0,resolution:d,linewidth:i},a)),e.createElement(Pq.Provider,{value:m},s))});class Lq{constructor(){this.color=new $r("white"),this.start=new Dn(0,0,0),this.end=new Dn(0,0,0)}}const kq=e=>e instanceof Dn?e:new Dn(..."number"==typeof e?[e,e,e]:e),Fq=e.forwardRef(({color:t,start:n,end:r},i)=>{const s=e.useContext(Pq);if(!s)throw"Segment must used inside Segments component.";const a=e.useRef(null);return e.useImperativeHandle(i,()=>a.current,[]),e.useLayoutEffect(()=>s.subscribe(a),[]),e.createElement("segmentObject",{ref:a,color:t,start:kq(n),end:kq(r)})}),Oq=e.forwardRef(({children:t,hysteresis:n=0,distances:r,...i},s)=>{const a=e.useRef(null);return e.useImperativeHandle(s,()=>a.current,[]),e.useLayoutEffect(()=>{const{current:e}=a;e.levels.length=0,e.children.forEach((t,i)=>e.levels.push({object:t,hysteresis:n,distance:r[i]}))}),Gp(e=>{var t;return null==(t=a.current)?void 0:t.update(e.camera)}),e.createElement("lOD",Lm({ref:a},i),t)});function Uq({all:t,scene:n,camera:r}){const i=zp(({gl:e})=>e),s=zp(({camera:e})=>e),a=zp(({scene:e})=>e);return e.useLayoutEffect(()=>{const e=[];t&&(n||a).traverse(t=>{!1===t.visible&&(e.push(t),t.visible=!0)}),i.compile(n||a,r||s);const o=new $i(128);new qi(.01,1e5,o).update(i,n||a),o.dispose(),e.forEach(e=>e.visible=!1)},[]),null}function Nq(){const e=zp(e=>e.gl);return s(()=>(e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0,()=>{e.shadowMap.autoUpdate=e.shadowMap.needsUpdate=!0}),[e.shadowMap]),null}const zq=new cr,Gq=new lr,Qq=new er,Hq=new Dn;function Vq(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),Qq.copy(n.boundingSphere),Qq.applyMatrix4(i),!1!==e.ray.intersectsSphere(Qq)&&(zq.copy(i).invert(),Gq.copy(e.ray).applyMatrix4(zq),null!==n.boundingBox&&null===Gq.intersectBox(n.boundingBox,Hq)||t.push({distance:Hq.distanceTo(e.ray.origin),point:Hq.clone(),object:this})))}function jq({pixelated:t}){const n=zp(e=>e.gl),r=zp(e=>e.internal.active),i=zp(e=>e.performance.current),s=zp(e=>e.viewport.initialDpr),a=zp(e=>e.setDpr);return e.useEffect(()=>{const e=n.domElement;return()=>{r&&a(s),t&&e&&(e.style.imageRendering="auto")}},[]),e.useEffect(()=>{a(i*s),t&&n.domElement&&(n.domElement.style.imageRendering=1===i?"auto":"pixelated")},[i]),null}function Wq(){const t=zp(e=>e.get),n=zp(e=>e.setEvents),r=zp(e=>e.performance.current);return e.useEffect(()=>{const e=t().events.enabled;return()=>n({enabled:e})},[]),e.useEffect(()=>n({enabled:1===r}),[r]),null}const Yq=m(null);function Kq({iterations:t=10,ms:n=250,threshold:r=.75,step:i=.1,factor:s=.5,flipflops:a=1/0,bounds:l=e=>e>100?[60,100]:[40,60],onIncline:c,onDecline:u,onChange:h,onFallback:d,children:f}){const p=Math.pow(10,0),[m,g]=o(()=>({fps:0,index:0,factor:s,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:e=>{const t=Symbol();return m.subscriptions.set(t,e.current),()=>{m.subscriptions.delete(t)}}}));let A=0;return Gp(()=>{const{frames:e,averages:s}=m;if(!m.fallback&&s.length<t){e.push(performance.now());const o=e[e.length-1]-e[0];if(o>=n){if(m.fps=Math.round(e.length/o*1e3*p)/p,m.refreshrate=Math.max(m.refreshrate,m.fps),s[m.index++%t]=m.fps,s.length===t){const[e,n]=l(m.refreshrate),o=s.filter(e=>e>=n),f=s.filter(t=>t<e);o.length>t*r&&(m.factor=Math.min(1,m.factor+i),m.flipped++,c&&c(m),m.subscriptions.forEach(e=>e.onIncline&&e.onIncline(m))),f.length>t*r&&(m.factor=Math.max(0,m.factor-i),m.flipped++,u&&u(m),m.subscriptions.forEach(e=>e.onDecline&&e.onDecline(m))),A!==m.factor&&(A=m.factor,h&&h(m),m.subscriptions.forEach(e=>e.onChange&&e.onChange(m))),m.flipped>a&&!m.fallback&&(m.fallback=!0,d&&d(m),m.subscriptions.forEach(e=>e.onFallback&&e.onFallback(m))),m.averages=[]}m.frames=[]}}}),e.createElement(Yq.Provider,{value:m},f)}function qq({onIncline:e,onDecline:t,onChange:n,onFallback:i}){const s=h(Yq),o=r({onIncline:e,onDecline:t,onChange:n,onFallback:i});a(()=>{o.current.onIncline=e,o.current.onDecline=t,o.current.onChange=n,o.current.onFallback=i},[e,t,n,i]),a(()=>s.subscribe(o),[s])}const Xq=e.forwardRef(({children:t,compute:n,width:r,height:i,samples:s=8,renderPriority:a=0,eventPriority:o=0,frames:l=1/0,stencilBuffer:c=!1,depthBuffer:u=!0,generateMipmaps:h=!1,...d},f)=>{const{size:p,viewport:m}=zp(),g=WR((r||p.width)*m.dpr,(i||p.height)*m.dpr,{samples:s,stencilBuffer:c,depthBuffer:u,generateMipmaps:h}),[A]=e.useState(()=>new jo),v=e.useCallback((e,t,n)=>{var r,i;let s=null==(r=g.texture)?void 0:r.__r3f.parent;for(;s&&!(s instanceof Lr);)s=s.__r3f.parent;if(!s)return!1;n.raycaster.camera||n.events.compute(e,n,null==(i=n.previousRoot)?void 0:i.getState());const[a]=n.raycaster.intersectObject(s);if(!a)return!1;const o=a.uv;if(!o)return!1;t.raycaster.setFromCamera(t.pointer.set(2*o.x-1,2*o.y-1),t.camera)},[]);return e.useImperativeHandle(f,()=>g.texture,[g]),e.createElement(e.Fragment,null,rm(e.createElement($q,{renderPriority:a,frames:l,fbo:g},t,e.createElement("group",{onPointerOver:()=>null})),A,{events:{compute:n||v,priority:o}}),e.createElement("primitive",Lm({object:g.texture},d)))});function $q({frames:t,renderPriority:n,children:r,fbo:i}){let s,a,o,l,c=0;return Gp(e=>{(t===1/0||c<t)&&(s=e.gl.autoClear,a=e.gl.xr.enabled,o=e.gl.getRenderTarget(),l=e.gl.xr.isPresenting,e.gl.autoClear=!0,e.gl.xr.enabled=!1,e.gl.xr.isPresenting=!1,e.gl.setRenderTarget(i),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(o),e.gl.autoClear=s,e.gl.xr.enabled=a,e.gl.xr.isPresenting=l,c++)},n),e.createElement(e.Fragment,null,r)}const Jq=e.forwardRef(({children:t,compute:n,renderPriority:r=-1,eventPriority:i=0,frames:s=1/0,stencilBuffer:a=!1,depthBuffer:o=!0,generateMipmaps:l=!1,resolution:c=896,near:u=.1,far:h=1e3,flip:d=!1,position:f,rotation:p,scale:m,quaternion:g,matrix:A,matrixAutoUpdate:v,...y},E)=>{const{size:_,viewport:x}=zp(),b=e.useRef(null),S=e.useMemo(()=>{const e=new $i(Math.max((c||_.width)*x.dpr,(c||_.height)*x.dpr),{stencilBuffer:a,depthBuffer:o,generateMipmaps:l});return e.texture.isRenderTargetTexture=!d,e.texture.flipY=!0,e.texture.type=me,e},[c,d]);e.useEffect(()=>()=>S.dispose(),[S]);const[w]=e.useState(()=>new jo);return e.useImperativeHandle(E,()=>({scene:w,fbo:S,camera:b.current}),[S]),e.createElement(e.Fragment,null,rm(e.createElement(Zq,{renderPriority:r,frames:s,camera:b},t,e.createElement("group",{onPointerOver:()=>null})),w,{events:{compute:n,priority:i}}),e.createElement("primitive",Lm({object:S.texture},y)),e.createElement("cubeCamera",{ref:b,args:[u,h,S],position:f,rotation:p,scale:m,quaternion:g,matrix:A,matrixAutoUpdate:v}))});function Zq({frames:t,renderPriority:n,children:r,camera:i}){let s=0;return Gp(e=>{(t===1/0||s<t)&&(i.current.update(e.gl,e.scene),s++)},n),e.createElement(e.Fragment,null,r)}const eX=e.forwardRef(({id:t=1,colorWrite:n=!1,depthWrite:r=!1,...i},s)=>{const a=e.useRef(null),o=e.useMemo(()=>({colorWrite:n,depthWrite:r,stencilWrite:!0,stencilRef:t,stencilFunc:Ct,stencilFail:wt,stencilZFail:wt,stencilZPass:wt}),[t,n,r]);return e.useLayoutEffect(()=>{Object.assign(a.current.material,o)}),e.useImperativeHandle(s,()=>a.current,[]),e.createElement("mesh",Lm({ref:a,renderOrder:-t},i))});function tX(e,t=!1){return{stencilWrite:!0,stencilRef:e,stencilFunc:t?517:514,stencilFail:St,stencilZFail:St,stencilZPass:St}}function nX({renderPriority:t=1,zoom:n=0,segments:r=64,children:i,resolution:s=896,...a}){const o=e.useRef(null),l=e.useRef(null),{width:c,height:u}=zp(e=>e.size),[h]=e.useState(()=>new vs);e.useLayoutEffect(()=>{h.position.set(0,0,100),h.zoom=100,h.left=c/-2,h.right=c/2,h.top=u/2,h.bottom=u/-2,h.updateProjectionMatrix()},[c,u]);const d=Math.sqrt(c*c+u*u)/100*(.5+n/2),f=new Dn,p=new er(new Dn,d),m=new rn,g=e.useCallback((e,t,n)=>{t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,h),t.raycaster.ray.intersectSphere(p,f)&&(f.normalize(),m.getNormalMatrix(l.current.camera.matrixWorld),l.current.camera.getWorldPosition(t.raycaster.ray.origin),t.raycaster.ray.direction.set(0,0,1).reflect(f),t.raycaster.ray.direction.x*=-1,t.raycaster.ray.direction.applyNormalMatrix(m).multiplyScalar(-1))},[]);return Gp(e=>{t&&e.gl.render(o.current,h)},t),e.createElement(e.Fragment,null,e.createElement("mesh",Lm({ref:o},a,{scale:d}),e.createElement("sphereGeometry",{args:[1,r,r]}),e.createElement("meshBasicMaterial",null,e.createElement(Jq,{compute:g,attach:"envMap",flip:!0,resolution:s,ref:l},i,e.createElement(rX,{api:l})))))}function rX({api:e}){const t=new Dn,n=new Pn,r=new Dn,i=new yr(0,Math.PI,0);return Gp(s=>{s.camera.matrixWorld.decompose(t,n,r),e.current.camera.position.copy(t),e.current.camera.quaternion.setFromEuler(i).premultiply(n)}),null}const iX=tR({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new nn},"varying vec2 vUv;\n   void main() {\n     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n     vUv = uv;\n   }",`uniform sampler2D sdf;\n   uniform sampler2D map;\n   uniform float blur;\n   uniform float size;\n   uniform float time;\n   uniform vec2 resolution;\n   varying vec2 vUv;\n   #include <packing>\n   void main() {\n     vec2 uv = gl_FragCoord.xy / resolution.xy;\n     vec4 t = texture2D(map, uv);\n     float k = blur;\n     float d = texture2D(sdf, vUv).r/size;\n     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));\n     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);\n     #include <tonemapping_fragment>\n     #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n   }`),sX=e.forwardRef(({children:t,events:n,blur:r=0,eventPriority:i=0,renderPriority:s=0,worldUnits:a=!1,resolution:o=512,...l},c)=>{Hf({PortalMaterialImpl:iX});const u=e.useRef(null),{scene:h,gl:d,size:f,viewport:p,setEvents:m}=zp(),g=WR(o,o),[A,v]=e.useState(0);Gp(()=>{const e=u.current.blend>0?Math.max(1,s):0;A!==e&&v(e)}),e.useEffect(()=>{void 0!==n&&m({enabled:!n})},[n]);const[y,E]=e.useState(!0),_=wj(E);e.useLayoutEffect(()=>{var e;_.current=null==(e=u.current)?void 0:e.__r3f.parent},[]),e.useLayoutEffect(()=>{if(_.current&&r&&null===u.current.sdf){const e=new Ui(_.current.geometry,new ti),t=(new Fn).setFromBufferAttribute(e.geometry.attributes.position),n=new vs(t.min.x*(1+2/o),t.max.x*(1+2/o),t.max.y*(1+2/o),t.min.y*(1+2/o),.1,1e3);n.position.set(0,0,1),n.lookAt(0,0,0),d.setRenderTarget(g),d.render(e,n);const r=oX(o,o,d)(g.texture),i=new Float32Array(o*o);d.readRenderTargetPixels(r,0,0,o,o,i);let s=1/0;for(let e=0;e<i.length;e++)i[e]<s&&(s=i[e]);s=-s,u.current.size=s,u.current.sdf=r.texture,d.setRenderTarget(null)}},[o,r]),e.useImperativeHandle(c,()=>u.current);const x=e.useCallback((e,t,n)=>{var r;if(!_.current)return!1;if(t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera),0===(null==(r=u.current)?void 0:r.blend)){const[e]=t.raycaster.intersectObject(_.current);if(!e)return t.raycaster.camera=void 0,!1}},[]);return e.createElement("portalMaterialImpl",Lm({ref:u,blur:r,blend:0,resolution:[f.width*p.dpr,f.height*p.dpr],attach:"material"},l),e.createElement(Xq,{attach:"map",frames:y?1/0:0,eventPriority:i,renderPriority:s,compute:x},t,e.createElement(aX,{events:n,rootScene:h,priority:A,material:u,worldUnits:a})))});function aX({events:t,rootScene:n,material:r,priority:i,worldUnits:s}){const a=zp(e=>e.scene),o=zp(e=>e.setEvents),l=WR(),c=WR();e.useLayoutEffect(()=>{a.matrixAutoUpdate=!1},[]),e.useEffect(()=>{void 0!==t&&o({enabled:t})},[t]);const[u,h]=e.useMemo(()=>{const e={value:0};return[new TS(new ji({uniforms:{a:{value:l.texture},b:{value:c.texture},blend:e},vertexShader:"\n          varying vec2 vUv;\n          void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n          }",fragmentShader:`\n          uniform sampler2D a;\n          uniform sampler2D b;\n          uniform float blend;\n          varying vec2 vUv;\n          #include <packing>\n          void main() {\n            vec4 ta = texture2D(a, vUv);\n            vec4 tb = texture2D(b, vUv);\n            gl_FragColor = mix(tb, ta, blend);\n            #include <tonemapping_fragment>\n            #include <${sR>=154?"colorspace_fragment":"encodings_fragment"}>\n          }`})),e]},[]);return Gp(e=>{var t;let o=null==r||null==(t=r.current)?void 0:t.__r3f.parent;if(o){var d,f,p,m;if(s)a.matrixWorld.identity();else i&&1===(null==(d=r.current)?void 0:d.blend)&&o.updateWorldMatrix(!0,!1),a.matrixWorld.copy(o.matrixWorld);if(i)(null==(f=r.current)?void 0:f.blend)>0&&(null==(p=r.current)?void 0:p.blend)<1?(h.value=r.current.blend,e.gl.setRenderTarget(l),e.gl.render(a,e.camera),e.gl.setRenderTarget(c),e.gl.render(n,e.camera),e.gl.setRenderTarget(null),u.render(e.gl)):1===(null==(m=r.current)?void 0:m.blend)&&e.gl.render(a,e.camera)}},i),e.createElement(e.Fragment,null)}const oX=(e,t,n)=>{let r=new In(e,t,{minFilter:ae,magFilter:ie,type:pe,format:xe,generateMipmaps:!0}),i=new In(e,t,{minFilter:te,magFilter:te}),s=new In(e,t,{minFilter:te,magFilter:te}),a=new In(e,t,{minFilter:te,magFilter:te}),o=new In(e,t,{minFilter:te,magFilter:te}),l=new In(e,t,{minFilter:te,magFilter:te,type:pe,format:xe}),c=new In(e,t,{minFilter:te,magFilter:te,type:pe,format:xe});const u=new TS(new ji({uniforms:{tex:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D tex;\n        varying vec2 vUv;\n        #include <packing>\n        void main() {\n          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));\n        }"})),h=new TS(new ji({uniforms:{tex:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D tex;\n        varying vec2 vUv;\n        #include <packing>\n        void main() {\n          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));\n        }"})),d=new TS(new ji({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:`\n        varying vec2 vUv;\n        uniform sampler2D tex;\n        uniform float offset;\n        uniform float level;\n        uniform float maxSteps;\n        #include <packing>\n        void main() {\n          float closestDist = 9999999.9;\n          vec2 closestPos = vec2(0.0);\n          for (float x = -1.0; x <= 1.0; x += 1.0) {\n            for (float y = -1.0; y <= 1.0; y += 1.0) {\n              vec2 voffset = vUv;\n              voffset += vec2(x, y) * vec2(${1/e}, ${1/t}) * offset;\n              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));\n              float dist = distance(pos.xy, vUv);\n              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {\n                closestDist = dist;\n                closestPos = pos;\n              }\n            }\n          }\n          gl_FragColor = pack2HalfToRGBA(closestPos);\n        }`})),f=new TS(new ji({uniforms:{tex:{value:null},size:{value:new nn(e,t)}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        varying vec2 vUv;\n        uniform sampler2D tex;\n        uniform vec2 size;\n        #include <packing>\n        void main() {\n          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);\n        }"})),p=new TS(new ji({uniforms:{inside:{value:c.texture},outside:{value:l.texture},tex:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        varying vec2 vUv;\n        uniform sampler2D inside;\n        uniform sampler2D outside;\n        uniform sampler2D tex;\n        #include <packing>\n        void main() {\n          float i = texture2D(inside, vUv).x;\n          float o =texture2D(outside, vUv).x;\n          if (texture2D(tex, vUv).x == 0.0) {\n            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);\n          } else {\n            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);\n          }\n        }"}));return m=>{let g=r;m.minFilter=te,m.magFilter=te,u.material.uniforms.tex.value=m,n.setRenderTarget(i),u.render(n);const A=Math.ceil(Math.log(Math.max(e,t))/Math.log(2));let v=i,y=null;for(let e=0;e<A;e++){const t=Math.pow(2,A-e-1);y=v===i?a:i,d.material.uniforms.level.value=e,d.material.uniforms.maxSteps.value=A,d.material.uniforms.offset.value=t,d.material.uniforms.tex.value=v.texture,n.setRenderTarget(y),d.render(n),v=y}n.setRenderTarget(l),f.material.uniforms.tex.value=y.texture,f.render(n),h.material.uniforms.tex.value=m,n.setRenderTarget(s),h.render(n),v=s;for(let e=0;e<A;e++){const t=Math.pow(2,A-e-1);y=v===s?o:s,d.material.uniforms.level.value=e,d.material.uniforms.maxSteps.value=A,d.material.uniforms.offset.value=t,d.material.uniforms.tex.value=v.texture,n.setRenderTarget(y),d.render(n),v=y}return n.setRenderTarget(c),f.material.uniforms.tex.value=y.texture,f.render(n),n.setRenderTarget(g),p.material.uniforms.tex.value=m,p.render(n),n.setRenderTarget(null),g}},lX=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,s={setState:r,getState:i,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{import.meta.env&&import.meta.env.MODE,n.clear()}},a=t=e(r,i,s);return s};var cX,uX={exports:{}},hX={},dX={exports:{}},fX={};var pX,mX,gX,AX={};function vX(){return mX||(mX=1,"production"===process.env.NODE_ENV?dX.exports=function(){if(cX)return fX;cX=1;var e=t,n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=e.useState,i=e.useEffect,s=e.useLayoutEffect,a=e.useDebugValue;function o(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),l=r({inst:{value:n,getSnapshot:t}}),c=l[0].inst,u=l[1];return s(function(){c.value=n,c.getSnapshot=t,o(c)&&u({inst:c})},[e,n,t]),i(function(){return o(c)&&u({inst:c}),e(function(){o(c)&&u({inst:c})})},[e]),a(n),n};return fX.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:l,fX}():dX.exports=(pX||(pX=1,"production"!==process.env.NODE_ENV&&function(){function e(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!r(e,n)}catch(e){return!0}}"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var n=t,r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=n.useState,s=n.useEffect,a=n.useLayoutEffect,o=n.useDebugValue,l=!1,c=!1,u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(t,u){l||void 0===n.startTransition||(l=!0);var h=u();if(!c){var d=u();r(h,d)||(c=!0)}var f=(d=i({inst:{value:h,getSnapshot:u}}))[0].inst,p=d[1];return a(function(){f.value=h,f.getSnapshot=u,e(f)&&p({inst:f})},[t,h,u]),s(function(){return e(f)&&p({inst:f}),t(function(){e(f)&&p({inst:f})})},[t]),o(h),h};AX.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:u,"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),AX)),dX.exports}var yX,EX,_X={};var xX=(EX||(EX=1,"production"===process.env.NODE_ENV?uX.exports=function(){if(gX)return hX;gX=1;var e=t,n=vX(),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=n.useSyncExternalStore,s=e.useRef,a=e.useEffect,o=e.useMemo,l=e.useDebugValue;return hX.useSyncExternalStoreWithSelector=function(e,t,n,c,u){var h=s(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;h=o(function(){function e(e){if(!a){if(a=!0,i=e,e=c(e),void 0!==u&&d.hasValue){var t=d.value;if(u(t,e))return s=t}return s=e}if(t=s,r(i,e))return t;var n=c(e);return void 0!==u&&u(t,n)?(i=e,t):(i=e,s=n)}var i,s,a=!1,o=void 0===n?null:n;return[function(){return e(t())},null===o?void 0:function(){return e(o())}]},[t,n,c,u]);var f=i(e,h[0],h[1]);return a(function(){d.hasValue=!0,d.value=f},[f]),l(f),f},hX}():uX.exports=(yX||(yX=1,"production"!==process.env.NODE_ENV&&function(){"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var e=t,n=vX(),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=n.useSyncExternalStore,s=e.useRef,a=e.useEffect,o=e.useMemo,l=e.useDebugValue;_X.useSyncExternalStoreWithSelector=function(e,t,n,c,u){var h=s(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;h=o(function(){function e(e){if(!a){if(a=!0,i=e,e=c(e),void 0!==u&&d.hasValue){var t=d.value;if(u(t,e))return s=t}return s=e}if(t=s,r(i,e))return t;var n=c(e);return void 0!==u&&u(t,n)?(i=e,t):(i=e,s=n)}var i,s,a=!1,o=void 0===n?null:n;return[function(){return e(t())},null===o?void 0:function(){return e(o())}]},[t,n,c,u]);var f=i(e,h[0],h[1]);return a(function(){d.hasValue=!0,d.value=f},[f]),l(f),f},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),_X)),uX.exports),bX=Jd(xX);const{useDebugValue:SX}=t,{useSyncExternalStoreWithSelector:wX}=bX;let CX=!1;const TX=e=>e;const MX=e=>{import.meta.env&&import.meta.env.MODE;const t="function"==typeof e?(e=>e?lX(e):lX)(e):e,n=(e,n)=>function(e,t=TX,n){"production"!==(import.meta.env?import.meta.env.MODE:void 0)&&n&&!CX&&(CX=!0);const r=wX(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return SX(r),r}(t,e,n);return Object.assign(n,t),n};var IX,RX;const BX="undefined"!=typeof window&&(null!=(IX=window.document)&&IX.createElement||"ReactNative"===(null==(RX=window.navigator)?void 0:RX.product))?t.useLayoutEffect:t.useEffect;function PX(){const e=(n=e=>({current:new Array,version:0,set:e}))?MX(n):MX;var n;return{In:({children:t})=>{const n=e(e=>e.set),r=e(e=>e.version);return BX(()=>{n(e=>({version:e.version+1}))},[]),BX(()=>(n(({current:e})=>({current:[...e,t]})),()=>n(({current:e})=>({current:e.filter(e=>e!==t)}))),[t,r]),null},Out:()=>{const n=e(e=>e.current);return t.createElement(t.Fragment,null,n)}}}const DX=new $r,LX=PX();function kX(e){return"top"in e}function FX(e,t){const{right:n,top:r,left:i,bottom:s,width:a,height:o}=t,l=t.bottom<0||r>e.height||n<0||t.left>e.width;if(kX(e)){const t=e.top+e.height-s;return{position:{width:a,height:o,left:i-e.left,top:r,bottom:t,right:n},isOffscreen:l}}return{position:{width:a,height:o,top:r,left:i,bottom:e.height-s,right:n},isOffscreen:l}}function OX(e,{left:t,bottom:n,width:r,height:i}){let s;const a=r/i;var o;return(o=e.camera)&&o.isOrthographicCamera?e.camera.manual?e.camera.updateProjectionMatrix():e.camera.left===r/-2&&e.camera.right===r/2&&e.camera.top===i/2&&e.camera.bottom===i/-2||(Object.assign(e.camera,{left:r/-2,right:r/2,top:i/2,bottom:i/-2}),e.camera.updateProjectionMatrix()):e.camera.aspect!==a&&(e.camera.aspect=a,e.camera.updateProjectionMatrix()),s=e.gl.autoClear,e.gl.autoClear=!1,e.gl.setViewport(t,n,r,i),e.gl.setScissor(t,n,r,i),e.gl.setScissorTest(!0),s}function UX(e,t){e.gl.setScissorTest(!1),e.gl.autoClear=t}function NX(e){e.gl.getClearColor(DX),e.gl.setClearColor(DX,e.gl.getClearAlpha()),e.gl.clear(!0,!0)}function zX({visible:t=!0,canvasSize:n,scene:r,index:i,children:s,frames:a,rect:o,track:l}){const c=zp(),[u,h]=e.useState(!1);let d=0;return Gp(e=>{var i;(a===1/0||d<=a)&&(l&&(o.current=null==(i=l.current)?void 0:i.getBoundingClientRect()),d++);if(o.current){const{position:i,isOffscreen:a}=FX(n,o.current);if(u!==a&&h(a),t&&!u&&o.current){const t=OX(e,i);e.gl.render(s?e.scene:r,e.camera),UX(e,t)}}},i),e.useLayoutEffect(()=>{const e=o.current;if(e&&(!t||!u)){const{position:t}=FX(n,e),r=OX(c,t);NX(c),UX(c,r)}},[t,u]),e.useEffect(()=>{if(!l)return;const e=o.current,t=c.get().events.connected;return c.setEvents({connected:l.current}),()=>{if(e){const{position:t}=FX(n,e),r=OX(c,t);NX(c),UX(c,r)}c.setEvents({connected:t})}},[l]),e.useEffect(()=>{kX(n)},[]),e.createElement(e.Fragment,null,s,e.createElement("group",{onPointerOver:()=>null}))}const GX=e.forwardRef(({track:t,visible:n=!0,index:r=1,id:i,style:s,className:a,frames:o=1/0,children:l,...c},u)=>{var h,d,f,p;const m=e.useRef(null),{size:g,scene:A}=zp(),[v]=e.useState(()=>new jo),[y,E]=e.useReducer(()=>!0,!1),_=e.useCallback((e,n)=>{if(m.current&&t&&t.current&&e.target===t.current){const{width:t,height:r,left:i,top:s}=m.current,a=e.clientX-i,o=e.clientY-s;n.pointer.set(a/t*2-1,-o/r*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)}},[m,t]);return e.useEffect(()=>{var e;t&&(m.current=null==(e=t.current)?void 0:e.getBoundingClientRect()),E()},[t]),e.createElement("group",Lm({ref:u},c),y&&rm(e.createElement(zX,{visible:n,canvasSize:g,frames:o,scene:A,track:t,rect:m,index:r},l),v,{events:{compute:_,priority:r},size:{width:null==(h=m.current)?void 0:h.width,height:null==(d=m.current)?void 0:d.height,top:null==(f=m.current)?void 0:f.top,left:null==(p=m.current)?void 0:p.left}}))}),QX=e.forwardRef(({as:t="div",id:n,visible:r,className:i,style:s,index:a=1,track:o,frames:l=1/0,children:c,...u},h)=>{const d=e.useId(),f=e.useRef(null);return e.useImperativeHandle(h,()=>f.current),e.createElement(e.Fragment,null,e.createElement(t,Lm({ref:f,id:n,className:i,style:s},u)),e.createElement(LX.In,null,e.createElement(GX,{visible:r,key:d,track:f,frames:l,index:a},c)))}),HX=(()=>{const t=e.forwardRef((t,n)=>e.useContext(Sp)?e.createElement(GX,Lm({ref:n},t)):e.createElement(QX,Lm({ref:n},t)));return t.Port=()=>e.createElement(LX.Out,null),t})(),VX=e.createContext(null),jX=new Dn,WX=new Dn,YX=new Dn(0,1,0),KX=new cr,qX=({direction:t,axis:n})=>{const{translation:r,translationLimits:i,annotations:s,annotationsClass:a,depthTest:o,scale:l,lineWidth:c,fixed:u,axisColors:h,hoveredColor:d,opacity:f,onDragStart:p,onDrag:m,onDragEnd:g,userData:A}=e.useContext(VX),v=zp(e=>e.controls),y=e.useRef(null),E=e.useRef(null),_=e.useRef(null),x=e.useRef(0),[b,S]=e.useState(!1),w=e.useCallback(e=>{s&&(y.current.innerText=`${r.current[n].toFixed(2)}`,y.current.style.display="block"),e.stopPropagation();const i=(new cr).extractRotation(E.current.matrixWorld),a=e.point.clone(),o=(new Dn).setFromMatrixPosition(E.current.matrixWorld),l=t.clone().applyMatrix4(i).normalize();_.current={clickPoint:a,dir:l},x.current=r.current[n],p({component:"Arrow",axis:n,origin:o,directions:[l]}),v&&(v.enabled=!1),e.target.setPointerCapture(e.pointerId)},[s,t,v,p,r,n]),C=e.useCallback(e=>{if(e.stopPropagation(),b||S(!0),_.current){const{clickPoint:t,dir:a}=_.current,[o,l]=(null==i?void 0:i[n])||[void 0,void 0];let c=((e,t,n,r)=>{const i=t.dot(t),s=t.dot(e)-t.dot(n),a=t.dot(r);return 0===a?-s/i:(jX.copy(r).multiplyScalar(i/a).sub(t),WX.copy(r).multiplyScalar(s/a).add(n).sub(e),-jX.dot(WX)/jX.dot(jX))})(t,a,e.ray.origin,e.ray.direction);void 0!==o&&(c=Math.max(c,o-x.current)),void 0!==l&&(c=Math.min(c,l-x.current)),r.current[n]=x.current+c,s&&(y.current.innerText=`${r.current[n].toFixed(2)}`),KX.makeTranslation(a.x*c,a.y*c,a.z*c),m(KX)}},[s,m,b,r,i,n]),T=e.useCallback(e=>{s&&(y.current.style.display="none"),e.stopPropagation(),_.current=null,g(),v&&(v.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[s,v,g]),M=e.useCallback(e=>{e.stopPropagation(),S(!1)},[]),{cylinderLength:I,coneWidth:R,coneLength:B,matrixL:P}=e.useMemo(()=>{const e=u?c/l*1.6:l/20,n=u?.2:l/5,r=u?1-n:l-n,i=(new Pn).setFromUnitVectors(YX,t.clone().normalize());return{cylinderLength:r,coneWidth:e,coneLength:n,matrixL:(new cr).makeRotationFromQuaternion(i)}},[t,l,c,u]),D=b?d:h[n];return e.createElement("group",{ref:E},e.createElement("group",{matrix:P,matrixAutoUpdate:!1,onPointerDown:w,onPointerMove:C,onPointerUp:T,onPointerOut:M},s&&e.createElement(Km,{position:[0,-B,0]},e.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:y})),e.createElement("mesh",{visible:!1,position:[0,(I+B)/2,0],userData:A},e.createElement("cylinderGeometry",{args:[1.4*R,1.4*R,I+B,8,1]})),e.createElement(bM,{transparent:!0,raycast:()=>null,depthTest:o,points:[0,0,0,0,I,0],lineWidth:c,side:2,color:D,opacity:f,polygonOffset:!0,renderOrder:1,polygonOffsetFactor:-10,fog:!1}),e.createElement("mesh",{raycast:()=>null,position:[0,I+B/2,0],renderOrder:500},e.createElement("coneGeometry",{args:[R,B,24,1]}),e.createElement("meshBasicMaterial",{transparent:!0,depthTest:o,color:D,opacity:f,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))))},XX=new Dn,$X=new Dn,JX=e=>180*e/Math.PI,ZX=e=>{let t=((e,t)=>{let n=Math.floor(e/t);return n=n<0?n+1:n,e-n*t})(e,2*Math.PI);return Math.abs(t)<1e-6?0:(t<0&&(t+=2*Math.PI),t)},e$=new cr,t$=new Dn,n$=new lr,r$=new Dn,i$=({dir1:t,dir2:n,axis:r})=>{const{rotationLimits:i,annotations:s,annotationsClass:a,depthTest:o,scale:l,lineWidth:c,fixed:u,axisColors:h,hoveredColor:d,opacity:f,onDragStart:p,onDrag:m,onDragEnd:g,userData:A}=e.useContext(VX),v=zp(e=>e.controls),y=e.useRef(null),E=e.useRef(null),_=e.useRef(0),x=e.useRef(0),b=e.useRef(null),[S,w]=e.useState(!1),C=e.useCallback(e=>{s&&(y.current.innerText=`${JX(x.current).toFixed(0)}º`,y.current.style.display="block"),e.stopPropagation();const t=e.point.clone(),n=(new Dn).setFromMatrixPosition(E.current.matrixWorld),i=(new Dn).setFromMatrixColumn(E.current.matrixWorld,0).normalize(),a=(new Dn).setFromMatrixColumn(E.current.matrixWorld,1).normalize(),o=(new Dn).setFromMatrixColumn(E.current.matrixWorld,2).normalize(),l=(new ts).setFromNormalAndCoplanarPoint(o,n);b.current={clickPoint:t,origin:n,e1:i,e2:a,normal:o,plane:l},p({component:"Rotator",axis:r,origin:n,directions:[i,a,o]}),v&&(v.enabled=!1),e.target.setPointerCapture(e.pointerId)},[s,v,p,r]),T=e.useCallback(e=>{if(e.stopPropagation(),S||w(!0),b.current){const{clickPoint:t,origin:n,e1:a,e2:o,normal:l,plane:c}=b.current,[u,h]=(null==i?void 0:i[r])||[void 0,void 0];n$.copy(e.ray),n$.intersectPlane(c,r$),n$.direction.negate(),n$.intersectPlane(c,r$);let d=((e,t,n,r,i)=>{XX.copy(e).sub(n),$X.copy(t).sub(n);const s=r.dot(r),a=i.dot(i),o=XX.dot(r)/s,l=XX.dot(i)/a,c=$X.dot(r)/s,u=$X.dot(i)/a,h=Math.atan2(l,o);return Math.atan2(u,c)-h})(t,r$,n,a,o),f=JX(d);e.shiftKey&&(f=10*Math.round(f/10),d=(e=>e*Math.PI/180)(f)),void 0!==u&&void 0!==h&&h-u<2*Math.PI?(d=ZX(d),d=d>Math.PI?d-2*Math.PI:d,d=tn.clamp(d,u-_.current,h-_.current),x.current=_.current+d):(x.current=ZX(_.current+d),x.current=x.current>Math.PI?x.current-2*Math.PI:x.current),s&&(f=JX(x.current),y.current.innerText=`${f.toFixed(0)}º`),e$.makeRotationAxis(l,d),t$.copy(n).applyMatrix4(e$).sub(n).negate(),e$.setPosition(t$),m(e$)}},[s,m,S,i,r]),M=e.useCallback(e=>{s&&(y.current.style.display="none"),e.stopPropagation(),_.current=x.current,b.current=null,g(),v&&(v.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[s,v,g]),I=e.useCallback(e=>{e.stopPropagation(),w(!1)},[]),R=e.useMemo(()=>{const e=t.clone().normalize(),r=n.clone().normalize();return(new cr).makeBasis(e,r,e.clone().cross(r))},[t,n]),B=u?.65:.65*l,P=e.useMemo(()=>{const e=[];for(let t=0;t<=32;t++){const n=t*(Math.PI/2)/32;e.push(new Dn(Math.cos(n)*B,Math.sin(n)*B,0))}return e},[B]);return e.createElement("group",{ref:E,onPointerDown:C,onPointerMove:T,onPointerUp:M,onPointerOut:I,matrix:R,matrixAutoUpdate:!1},s&&e.createElement(Km,{position:[B,B,0]},e.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:y})),e.createElement(bM,{points:P,lineWidth:4*c,visible:!1,userData:A}),e.createElement(bM,{transparent:!0,raycast:()=>null,depthTest:o,points:P,lineWidth:c,side:2,color:S?d:h[r],opacity:f,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))},s$=new lr,a$=new Dn,o$=new cr,l$=({dir1:t,dir2:n,axis:r})=>{const{translation:i,translationLimits:s,annotations:a,annotationsClass:o,depthTest:l,scale:c,lineWidth:u,fixed:h,axisColors:d,hoveredColor:f,opacity:p,onDragStart:m,onDrag:g,onDragEnd:A,userData:v}=e.useContext(VX),y=zp(e=>e.controls),E=e.useRef(null),_=e.useRef(null),x=e.useRef(null),b=e.useRef(0),S=e.useRef(0),[w,C]=e.useState(!1),T=e.useCallback(e=>{a&&(E.current.innerText=`${i.current[(r+1)%3].toFixed(2)}, ${i.current[(r+2)%3].toFixed(2)}`,E.current.style.display="block"),e.stopPropagation();const t=e.point.clone(),n=(new Dn).setFromMatrixPosition(_.current.matrixWorld),s=(new Dn).setFromMatrixColumn(_.current.matrixWorld,0).normalize(),o=(new Dn).setFromMatrixColumn(_.current.matrixWorld,1).normalize(),l=(new Dn).setFromMatrixColumn(_.current.matrixWorld,2).normalize(),c=(new ts).setFromNormalAndCoplanarPoint(l,n);x.current={clickPoint:t,e1:s,e2:o,plane:c},b.current=i.current[(r+1)%3],S.current=i.current[(r+2)%3],m({component:"Slider",axis:r,origin:n,directions:[s,o,l]}),y&&(y.enabled=!1),e.target.setPointerCapture(e.pointerId)},[a,y,m,r]),M=e.useCallback(e=>{if(e.stopPropagation(),w||C(!0),x.current){const{clickPoint:t,e1:n,e2:o,plane:l}=x.current,[c,u]=(null==s?void 0:s[(r+1)%3])||[void 0,void 0],[h,d]=(null==s?void 0:s[(r+2)%3])||[void 0,void 0];s$.copy(e.ray),s$.intersectPlane(l,a$),s$.direction.negate(),s$.intersectPlane(l,a$),a$.sub(t);let[f,p]=((e,t,n)=>{const r=Math.abs(e.x)>=Math.abs(e.y)&&Math.abs(e.x)>=Math.abs(e.z)?0:Math.abs(e.y)>=Math.abs(e.x)&&Math.abs(e.y)>=Math.abs(e.z)?1:2,i=[0,1,2].sort((e,n)=>Math.abs(t.getComponent(n))-Math.abs(t.getComponent(e))),s=r===i[0]?i[1]:i[0],a=e.getComponent(r),o=e.getComponent(s),l=t.getComponent(r),c=t.getComponent(s),u=n.getComponent(r),h=(n.getComponent(s)-u*(o/a))/(c-l*(o/a));return[(u-h*l)/a,h]})(n,o,a$);void 0!==c&&(f=Math.max(f,c-b.current)),void 0!==u&&(f=Math.min(f,u-b.current)),void 0!==h&&(p=Math.max(p,h-S.current)),void 0!==d&&(p=Math.min(p,d-S.current)),i.current[(r+1)%3]=b.current+f,i.current[(r+2)%3]=S.current+p,a&&(E.current.innerText=`${i.current[(r+1)%3].toFixed(2)}, ${i.current[(r+2)%3].toFixed(2)}`),o$.makeTranslation(f*n.x+p*o.x,f*n.y+p*o.y,f*n.z+p*o.z),g(o$)}},[a,g,w,i,s,r]),I=e.useCallback(e=>{a&&(E.current.style.display="none"),e.stopPropagation(),x.current=null,A(),y&&(y.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[a,y,A]),R=e.useCallback(e=>{e.stopPropagation(),C(!1)},[]),B=e.useMemo(()=>{const e=t.clone().normalize(),r=n.clone().normalize();return(new cr).makeBasis(e,r,e.clone().cross(r))},[t,n]),P=h?1/7:c/7,D=h?.225:.225*c,L=w?f:d[r],k=e.useMemo(()=>[new Dn(0,0,0),new Dn(0,D,0),new Dn(D,D,0),new Dn(D,0,0),new Dn(0,0,0)],[D]);return e.createElement("group",{ref:_,matrix:B,matrixAutoUpdate:!1},a&&e.createElement(Km,{position:[0,0,0]},e.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:o,ref:E})),e.createElement("group",{position:[1.7*P,1.7*P,0]},e.createElement("mesh",{visible:!0,onPointerDown:T,onPointerMove:M,onPointerUp:I,onPointerOut:R,scale:D,userData:v},e.createElement("planeGeometry",null),e.createElement("meshBasicMaterial",{transparent:!0,depthTest:l,color:L,polygonOffset:!0,polygonOffsetFactor:-10,side:2,fog:!1})),e.createElement(bM,{position:[-D/2,-D/2,0],transparent:!0,depthTest:l,points:k,lineWidth:u,color:L,opacity:p,polygonOffset:!0,polygonOffsetFactor:-10,userData:v,fog:!1})))},c$=new Dn,u$=new Dn,h$=new Dn(0,1,0),d$=new Dn,f$=new cr,p$=({direction:t,axis:n})=>{const{scaleLimits:r,annotations:i,annotationsClass:s,depthTest:a,scale:o,lineWidth:l,fixed:c,axisColors:u,hoveredColor:h,opacity:d,onDragStart:f,onDrag:p,onDragEnd:m,userData:g}=e.useContext(VX),A=zp(e=>e.size),v=zp(e=>e.controls),y=e.useRef(null),E=e.useRef(null),_=e.useRef(null),x=e.useRef(1),b=e.useRef(1),S=e.useRef(null),[w,C]=e.useState(!1),T=c?1.2:1.2*o,M=e.useCallback(e=>{i&&(y.current.innerText=`${b.current.toFixed(2)}`,y.current.style.display="block"),e.stopPropagation();const r=(new cr).extractRotation(E.current.matrixWorld),s=e.point.clone(),a=(new Dn).setFromMatrixPosition(E.current.matrixWorld),l=t.clone().applyMatrix4(r).normalize(),u=E.current.matrixWorld.clone(),h=u.clone().invert(),d=c?1/EM(E.current.getWorldPosition(c$),o,e.camera,A):1;S.current={clickPoint:s,dir:l,mPLG:u,mPLGInv:h,offsetMultiplier:d},f({component:"Sphere",axis:n,origin:a,directions:[l]}),v&&(v.enabled=!1),e.target.setPointerCapture(e.pointerId)},[i,v,t,f,n,c,o,A]),I=e.useCallback(e=>{if(e.stopPropagation(),w||C(!0),S.current){const{clickPoint:t,dir:s,mPLG:a,mPLGInv:l,offsetMultiplier:u}=S.current,[h,d]=(null==r?void 0:r[n])||[1e-5,void 0],f=((e,t,n,r)=>{const i=t.dot(t),s=t.dot(e)-t.dot(n),a=t.dot(r);return 0===a?-s/i:(c$.copy(r).multiplyScalar(i/a).sub(t),u$.copy(r).multiplyScalar(s/a).add(n).sub(e),-c$.dot(u$)/c$.dot(c$))})(t,s,e.ray.origin,e.ray.direction),m=f*u,g=c?m:m/o;let A=Math.pow(2,.2*g);e.shiftKey&&(A=Math.round(10*A)/10),A=Math.max(A,h/x.current),void 0!==d&&(A=Math.min(A,d/x.current)),b.current=x.current*A,_.current.position.set(0,T+m,0),i&&(y.current.innerText=`${b.current.toFixed(2)}`),d$.set(1,1,1),d$.setComponent(n,A),f$.makeScale(d$.x,d$.y,d$.z).premultiply(a).multiply(l),p(f$)}},[i,T,p,w,r,n]),R=e.useCallback(e=>{i&&(y.current.style.display="none"),e.stopPropagation(),x.current=b.current,S.current=null,_.current.position.set(0,T,0),m(),v&&(v.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[i,v,m,T]),B=e.useCallback(e=>{e.stopPropagation(),C(!1)},[]),{radius:P,matrixL:D}=e.useMemo(()=>{const e=c?l/o*1.8:o/22.5,n=(new Pn).setFromUnitVectors(h$,t.clone().normalize());return{radius:e,matrixL:(new cr).makeRotationFromQuaternion(n)}},[t,o,l,c]),L=w?h:u[n];return e.createElement("group",{ref:E},e.createElement("group",{matrix:D,matrixAutoUpdate:!1,onPointerDown:M,onPointerMove:I,onPointerUp:R,onPointerOut:B},i&&e.createElement(Km,{position:[0,T/2,0]},e.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:s,ref:y})),e.createElement("mesh",{ref:_,position:[0,T,0],renderOrder:500,userData:g},e.createElement("sphereGeometry",{args:[P,12,12]}),e.createElement("meshBasicMaterial",{transparent:!0,depthTest:a,color:L,opacity:d,polygonOffset:!0,polygonOffsetFactor:-10}))))},m$=new cr,g$=new cr,A$=new cr,v$=new cr,y$=new cr,E$=new cr,_$=new cr,x$=new cr,b$=new cr,S$=new Fn,w$=new Fn,C$=new Dn,T$=new Dn,M$=new Dn,I$=new Dn,R$=new Dn,B$=new Dn(1,0,0),P$=new Dn(0,1,0),D$=new Dn(0,0,1),L$=e.forwardRef(({enabled:t=!0,matrix:n,onDragStart:r,onDrag:i,onDragEnd:s,autoTransform:a=!0,anchor:o,disableAxes:l=!1,disableSliders:c=!1,disableRotations:u=!1,disableScaling:h=!1,activeAxes:d=[!0,!0,!0],offset:f=[0,0,0],rotation:p=[0,0,0],scale:m=1,lineWidth:g=4,fixed:A=!1,translationLimits:v,rotationLimits:y,scaleLimits:E,depthTest:_=!0,axisColors:x=["#ff2060","#20df80","#2080ff"],hoveredColor:b="#ffff40",annotations:S=!1,annotationsClass:w,opacity:C=1,visible:T=!0,userData:M,children:I,...R},B)=>{const P=zp(e=>e.invalidate),D=e.useRef(null),L=e.useRef(null),k=e.useRef(null),F=e.useRef(null),O=e.useRef([0,0,0]),U=e.useRef(new Dn(1,1,1)),N=e.useRef(new Dn(1,1,1));e.useLayoutEffect(()=>{o&&(F.current.updateWorldMatrix(!0,!0),v$.copy(F.current.matrixWorld).invert(),S$.makeEmpty(),F.current.traverse(e=>{e.geometry&&(e.geometry.boundingBox||e.geometry.computeBoundingBox(),E$.copy(e.matrixWorld).premultiply(v$),w$.copy(e.geometry.boundingBox),w$.applyMatrix4(E$),S$.union(w$))}),C$.copy(S$.max).add(S$.min).multiplyScalar(.5),T$.copy(S$.max).sub(S$.min).multiplyScalar(.5),M$.copy(T$).multiply(new Dn(...o)).add(C$),I$.set(...f).add(M$),k.current.position.copy(I$),P())});const z=e.useMemo(()=>({onDragStart:e=>{m$.copy(L.current.matrix),g$.copy(L.current.matrixWorld),r&&r(e),P()},onDrag:e=>{A$.copy(D.current.matrixWorld),v$.copy(A$).invert(),y$.copy(g$).premultiply(e),E$.copy(y$).premultiply(v$),_$.copy(m$).invert(),x$.copy(E$).multiply(_$),a&&L.current.matrix.copy(E$),i&&i(E$,x$,y$,e),P()},onDragEnd:()=>{s&&s(),P()},translation:O,translationLimits:v,rotationLimits:y,axisColors:x,hoveredColor:b,opacity:C,scale:m,lineWidth:g,fixed:A,depthTest:_,userData:M,annotations:S,annotationsClass:w}),[r,i,s,O,v,y,E,_,m,g,A,...x,b,C,M,a,S,w]),G=new Dn;return Gp(e=>{if(A){const t=EM(k.current.getWorldPosition(G),m,e.camera,e.size);U.current.setScalar(t)}n&&n instanceof cr&&(L.current.matrix=n),L.current.updateWorldMatrix(!0,!0),b$.makeRotationFromEuler(k.current.rotation).setPosition(k.current.position).premultiply(L.current.matrixWorld),N.current.setFromMatrixScale(b$),R$.copy(U.current).divide(N.current),(Math.abs(k.current.scale.x-R$.x)>1e-4||Math.abs(k.current.scale.y-R$.y)>1e-4||Math.abs(k.current.scale.z-R$.z)>1e-4)&&(k.current.scale.copy(R$),e.invalidate())}),e.useImperativeHandle(B,()=>L.current,[]),e.createElement(VX.Provider,{value:z},e.createElement("group",{ref:D},e.createElement("group",Lm({ref:L,matrix:n,matrixAutoUpdate:!1},R),e.createElement("group",{visible:T,ref:k,position:f,rotation:p},t&&e.createElement(e.Fragment,null,!l&&d[0]&&e.createElement(qX,{axis:0,direction:B$}),!l&&d[1]&&e.createElement(qX,{axis:1,direction:P$}),!l&&d[2]&&e.createElement(qX,{axis:2,direction:D$}),!c&&d[0]&&d[1]&&e.createElement(l$,{axis:2,dir1:B$,dir2:P$}),!c&&d[0]&&d[2]&&e.createElement(l$,{axis:1,dir1:D$,dir2:B$}),!c&&d[2]&&d[1]&&e.createElement(l$,{axis:0,dir1:P$,dir2:D$}),!u&&d[0]&&d[1]&&e.createElement(i$,{axis:2,dir1:B$,dir2:P$}),!u&&d[0]&&d[2]&&e.createElement(i$,{axis:1,dir1:D$,dir2:B$}),!u&&d[2]&&d[1]&&e.createElement(i$,{axis:0,dir1:P$,dir2:D$}),!h&&d[0]&&e.createElement(p$,{axis:0,direction:B$}),!h&&d[1]&&e.createElement(p$,{axis:1,direction:P$}),!h&&d[2]&&e.createElement(p$,{axis:2,direction:D$}))),e.createElement("group",{ref:F},I))))}),k$=c(({options:t={video:!0},...n},r)=>{const i=ff(()=>navigator.mediaDevices.getDisplayMedia(t),[]);return s(()=>()=>{null==i||i.getTracks().forEach(e=>e.stop()),mf([])},[i]),e.createElement(ZG,Lm({ref:r},n,{src:i}))}),F$=c(({constraints:t={audio:!1,video:{facingMode:"user"}},...n},r)=>{const i=ff(()=>navigator.mediaDevices.getUserMedia(t),[]);return s(()=>()=>{null==i||i.getTracks().forEach(e=>e.stop()),mf([])},[i]),e.createElement(ZG,Lm({ref:r},n,{src:i}))}),O$=new Dn(0,0,-1),U$=function(){const e=new Dn,t=new Dn,n=new Dn,r=new Dn,i=new Dn;return function(s,a,o,l){return e.copy(s),t.copy(a),n.copy(o),r.copy(t).sub(e),i.copy(n).sub(e),l.crossVectors(i,r).normalize()}}();const N$=e.forwardRef(({points:t=Q$.SAMPLE_FACELANDMARKER_RESULT.faceLandmarks[0],face:n,facialTransformationMatrix:r,faceBlendshapes:i,offset:s,offsetScalar:a=80,width:o,height:l,depth:c=1,verticalTri:u=[159,386,152],origin:h,eyes:d=!0,eyesAsOrigin:f=!1,debug:p=!1,children:m,...g},A)=>{var v;n&&(t=n.keypoints);const y=e.useRef(null),E=e.useRef(null),_=e.useRef(null),x=e.useRef(null),b=e.useRef(null),S=e.useRef(null),w=e.useRef(null),[C]=e.useState(()=>new Dn),[T]=e.useState(()=>new Lr),[M]=e.useState(()=>new Pn),[I]=e.useState(()=>new Dn),{invalidate:R}=zp();e.useEffect(()=>{var e;null==(e=b.current)||e.geometry.setIndex(Q$.TRIANGULATION)},[]);const[B]=e.useState(()=>new Dn);e.useEffect(()=>{var e,n;const m=null==(e=b.current)?void 0:e.geometry;if(!m)return;var g,A;(m.setFromPoints(t),m.setDrawRange(0,Q$.TRIANGULATION.length),r)?(T.matrix.fromArray(r.data),T.matrix.decompose(T.position,T.quaternion,T.scale),T.rotation.y*=-1,T.rotation.z*=-1,M.setFromEuler(T.rotation),s?(T.position.y*=-1,T.position.z*=-1,null==(g=y.current)||g.position.copy(T.position.divideScalar(a))):null==(A=y.current)||A.position.set(0,0,0)):(U$(t[u[0]],t[u[1]],t[u[2]],C),M.setFromUnitVectors(O$,C));const v=M.clone().invert();if(m.computeBoundingBox(),p&&R(),m.center(),m.applyQuaternion(v),null==(n=x.current)||n.setRotationFromQuaternion(M),d)if(i){if(S.current&&w.current&&_.current)if(f){const e=S.current._computeSphere(m),t=w.current._computeSphere(m),n=function(e,t){return e.clone().add(t).multiplyScalar(.5)}(e.center,t.center);h=n.negate(),S.current._update(m,i,e),w.current._update(m,i,t)}else S.current._update(m,i),w.current._update(m,i)}else;if(_.current){if(void 0!==h)if("number"==typeof h){const e=m.getAttribute("position");I.set(-e.getX(h),-e.getY(h),-e.getZ(h))}else h.isVector3&&I.copy(h);else I.setScalar(0);_.current.position.copy(I)}if(E.current){let e=1;(o||l||c)&&(m.boundingBox.getSize(B),o&&(e=o/B.x),l&&(e=l/B.y),c&&(e=c/B.z)),E.current.scale.setScalar(1!==e?e:1)}m.computeVertexNormals(),m.attributes.position.needsUpdate=!0},[t,r,i,T,s,a,o,l,c,u,h,d,p,R,C,M,B,I]);const P=e.useMemo(()=>({outerRef:x,meshRef:b,eyeRightRef:S,eyeLeftRef:w}),[]);e.useImperativeHandle(A,()=>P,[P]);const[D]=e.useState(()=>new Dn),L=null==(v=b.current)?void 0:v.geometry.boundingBox,k=(null==L?void 0:L.getSize(D).z)||1;return e.createElement("group",g,e.createElement("group",{ref:y},e.createElement("group",{ref:x},e.createElement("group",{ref:E},p?e.createElement(e.Fragment,null,e.createElement("axesHelper",{args:[k]}),e.createElement(bM,{points:[[0,0,0],[0,0,-k]],color:65535})):null,e.createElement("group",{ref:_},d&&i&&e.createElement("group",{name:"eyes"},e.createElement(G$,{side:"left",ref:S,debug:p}),e.createElement(G$,{side:"right",ref:w,debug:p})),e.createElement("mesh",{ref:b,name:"face"},m,p?e.createElement(e.Fragment,null,L&&e.createElement("box3Helper",{args:[L]})):null))))))}),z$={contourLandmarks:{right:[33,133,159,145,153],left:[263,362,386,374,380]},blendshapes:{right:[14,16,18,12],left:[13,15,17,11]},color:{right:"red",left:"#00ff00"},fov:{horizontal:100,vertical:90}},G$=e.forwardRef(({side:t,debug:n=!0},r)=>{const i=e.useRef(null),s=e.useRef(null),[a]=e.useState(()=>new er),o=e.useCallback(e=>{const n=e.getAttribute("position"),r=z$.contourLandmarks[t].map(e=>new Dn(n.getX(e),n.getY(e),n.getZ(e)));return a.center.set(0,0,0),r.forEach(e=>a.center.add(e)),a.center.divideScalar(r.length),a.radius=r[0].sub(r[1]).length()/2,a},[a,t]),[l]=e.useState(()=>new yr),c=e.useCallback((e,n,r)=>{var a;i.current&&(null!==(a=r)&&void 0!==a||(r=o(e)),i.current.position.copy(r.center),i.current.scale.setScalar(r.radius));if(n&&s.current){const e=z$.blendshapes[t],r=n.categories[e[0]].score,i=n.categories[e[1]].score,a=n.categories[e[2]].score,o=n.categories[e[3]].score,c=.5*(z$.fov.horizontal*tn.DEG2RAD)*(o-a),u=.5*(z$.fov.vertical*tn.DEG2RAD)*(r-i)*("left"===t?1:-1);l.set(c,u,0),s.current.setRotationFromEuler(l)}},[o,t,l]),u=e.useMemo(()=>({eyeMeshRef:i,irisDirRef:s,_computeSphere:o,_update:c}),[o,c]);e.useImperativeHandle(r,()=>u,[u]);const h=z$.color[t];return e.createElement("group",null,e.createElement("group",{ref:i},n&&e.createElement("axesHelper",null),e.createElement("group",{ref:s},e.createElement(e.Fragment,null,n&&e.createElement(bM,{points:[[0,0,0],[0,0,-2]],lineWidth:1,color:h})))))}),Q$={TRIANGULATION:[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],SAMPLE_FACE:{keypoints:[{x:356.2804412841797,y:295.1960563659668,z:-23.786449432373047,name:"lips"},{x:354.8859405517578,y:264.69520568847656,z:-36.718435287475586},{x:355.2180862426758,y:275.3360366821289,z:-21.183712482452393},{x:347.349853515625,y:242.4400234222412,z:-25.093655586242676},{x:354.40135955810547,y:256.67933464050293,z:-38.23572635650635},{x:353.7689971923828,y:247.54886627197266,z:-34.5475435256958},{x:352.1288299560547,y:227.34312057495117,z:-13.095386028289795},{x:303.5013198852539,y:234.67002868652344,z:12.500141859054565,name:"rightEye"},{x:351.09378814697266,y:211.87547206878662,z:-6.413471698760986},{x:350.7115936279297,y:202.1251630783081,z:-6.413471698760986},{x:348.33667755126953,y:168.7741756439209,z:6.483500003814697,name:"faceOval"},{x:356.4806365966797,y:299.2995357513428,z:-23.144519329071045},{x:356.5511703491211,y:302.66146659851074,z:-21.020312309265137},{x:356.6239547729492,y:304.1536331176758,z:-18.137459754943848,name:"lips"},{x:356.5807342529297,y:305.1840591430664,z:-18.767719268798828,name:"lips"},{x:356.8241500854492,y:308.25711250305176,z:-20.16829490661621},{x:357.113037109375,y:312.26277351379395,z:-22.10575819015503},{x:357.34962463378906,y:317.1123218536377,z:-21.837315559387207,name:"lips"},{x:357.6658630371094,y:325.51036834716797,z:-16.27002477645874},{x:355.0201416015625,y:269.36279296875,z:-33.73054027557373},{x:348.5237503051758,y:270.33411026000977,z:-24.93025302886963},{x:279.97331619262695,y:213.24176788330078,z:47.759642601013184,name:"faceOval"},{x:322.66529083251953,y:238.5027265548706,z:5.535193085670471},{x:316.0983657836914,y:239.94489669799805,z:5.777376294136047},{x:309.9431610107422,y:240.24518966674805,z:7.510589361190796},{x:301.31994247436523,y:237.86138534545898,z:13.118728399276733},{x:328.14266204833984,y:235.80496788024902,z:6.646900177001953},{x:313.7326431274414,y:222.11161136627197,z:3.9887237548828125},{x:320.45196533203125,y:221.87729358673096,z:4.601476192474365},{x:307.35679626464844,y:223.63793849945068,z:5.932023525238037},{x:303.0031204223633,y:226.3743782043457,z:8.479321002960205},{x:296.80023193359375,y:242.94299125671387,z:15.931552648544312},{x:332.2352981567383,y:340.77341079711914,z:-10.165848731994629},{x:301.38587951660156,y:233.46447944641113,z:14.764405488967896,name:"rightEye"},{x:279.0147018432617,y:244.37155723571777,z:45.77549457550049},{x:289.60548400878906,y:239.1807460784912,z:23.191204071044922},{x:320.32257080078125,y:267.1292781829834,z:-4.954537749290466},{x:347.64583587646484,y:294.4955062866211,z:-23.062820434570312,name:"lips"},{x:349.28138732910156,y:303.1095886230469,z:-20.238323211669922},{x:338.9453125,y:298.19186210632324,z:-19.456336498260498,name:"lips"},{x:333.36788177490234,y:302.6706790924072,z:-14.776077270507812,name:"lips"},{x:342.89188385009766,y:304.3561363220215,z:-17.752301692962646},{x:337.7375030517578,y:306.0098361968994,z:-13.410515785217285},{x:325.6159210205078,y:316.22995376586914,z:-6.681914925575256},{x:349.0104675292969,y:264.9818515777588,z:-36.274919509887695},{x:347.7138900756836,y:257.5664806365967,z:-37.67549514770508},{x:291.79357528686523,y:218.88171672821045,z:11.578094959259033,name:"rightEyebrow"},{x:332.2689437866211,y:247.56946563720703,z:-3.3730539679527283},{x:332.0074462890625,y:267.1201229095459,z:-19.969879388809204},{x:331.27952575683594,y:263.6967658996582,z:-17.47218608856201},{x:301.04373931884766,y:269.56552505493164,z:3.61815482378006},{x:347.4863815307617,y:249.0706443786621,z:-32.633421421051025},{x:307.26118087768555,y:208.2646894454956,z:1.1591226607561111,name:"rightEyebrow"},{x:297.91919708251953,y:212.22604751586914,z:5.914516448974609,name:"rightEyebrow"},{x:285.1651382446289,y:197.98450469970703,z:36.391637325286865,name:"faceOval"},{x:337.04097747802734,y:211.25229835510254,z:-4.548954665660858},{x:326.5912628173828,y:223.16698551177979,z:6.670243740081787},{x:320.05664825439453,y:309.5834255218506,z:-4.055835008621216},{x:289.6866226196289,y:314.617395401001,z:53.875489234924316,name:"faceOval"},{x:337.4256896972656,y:270.8755302429199,z:-17.67060160636902},{x:343.69922637939453,y:273.0000400543213,z:-18.756048679351807},{x:327.4242401123047,y:309.22399520874023,z:-4.703601002693176,name:"lips"},{x:330.37220001220703,y:308.3323001861572,z:-6.442649960517883},{x:293.87027740478516,y:207.7961826324463,z:9.821539521217346,name:"rightEyebrow"},{x:332.11437225341797,y:271.22812271118164,z:-16.64351224899292},{x:320.1197814941406,y:207.40366458892822,z:-2.48164564371109,name:"rightEyebrow"},{x:318.59575271606445,y:201.07443809509277,z:-3.110446035861969,name:"rightEyebrow"},{x:310.72303771972656,y:175.75075149536133,z:13.328815698623657,name:"faceOval"},{x:289.67578887939453,y:202.29835510253906,z:21.370456218719482},{x:315.30879974365234,y:187.35260009765625,z:5.0304025411605835},{x:287.8936767578125,y:216.54793739318848,z:17.81065821647644,name:"rightEyebrow"},{x:283.9391899108887,y:215.01142501831055,z:32.04984903335571},{x:348.35330963134766,y:299.4155788421631,z:-22.47924566268921},{x:341.1790466308594,y:301.8221855163574,z:-18.977805376052856},{x:335.69713592529297,y:304.4266891479492,z:-14.682706594467163},{x:339.4615173339844,y:272.3654365539551,z:-16.38674020767212},{x:328.99600982666016,y:308.86685371398926,z:-5.616893768310547},{x:332.00313568115234,y:309.1875743865967,z:-10.335084199905396},{x:331.0068130493164,y:307.9274368286133,z:-6.681914925575256,name:"lips"},{x:341.13792419433594,y:266.4876937866211,z:-26.56425952911377},{x:339.02950286865234,y:305.6663703918457,z:-12.33674168586731,name:"lips"},{x:344.22935485839844,y:304.9452781677246,z:-15.161235332489014,name:"lips"},{x:350.1844024658203,y:304.374303817749,z:-17.5305438041687,name:"lips"},{x:348.52630615234375,y:325.9562301635742,z:-16.164982318878174},{x:348.6581802368164,y:317.1624183654785,z:-21.510512828826904,name:"lips"},{x:348.9766311645508,y:312.1923065185547,z:-21.708929538726807},{x:349.2427444458008,y:308.0660820007324,z:-19.643079042434692},{x:349.67491149902344,y:305.42747497558594,z:-18.16080331802368,name:"lips"},{x:337.95589447021484,y:306.6535949707031,z:-12.803598642349243,name:"lips"},{x:337.06878662109375,y:307.63169288635254,z:-14.274203777313232},{x:335.77449798583984,y:309.8449516296387,z:-15.698124170303345},{x:334.6099090576172,y:312.7997016906738,z:-14.764405488967896,name:"lips"},{x:327.2330856323242,y:293.80866050720215,z:-11.864047050476074},{x:280.97679138183594,y:279.79928970336914,z:68.90834331512451,name:"faceOval"},{x:355.13843536376953,y:271.7875671386719,z:-25.350427627563477},{x:334.7235870361328,y:307.4656391143799,z:-9.302158951759338,name:"lips"},{x:333.5293960571289,y:307.89782524108887,z:-10.200862884521484},{x:346.29688262939453,y:276.4256286621094,z:-19.748122692108154},{x:335.16246795654297,y:276.22097969055176,z:-12.313398122787476},{x:345.09132385253906,y:274.7082996368408,z:-19.304605722427368},{x:325.4267883300781,y:252.95130729675293,z:-1.6661019623279572},{x:315.347843170166,y:259.05200958251953,z:-.25604281574487686},{x:330.44933319091797,y:267.7570152282715,z:-14.017432928085327},{x:294.96768951416016,y:185.26001930236816,z:23.903164863586426,name:"faceOval"},{x:299.63531494140625,y:192.7913761138916,z:12.640198469161987},{x:304.5452117919922,y:202.4142837524414,z:3.244667649269104,name:"rightEyebrow"},{x:331.6915512084961,y:320.0467872619629,z:-10.632705688476562},{x:334.5911407470703,y:201.27566814422607,z:-6.133356094360352,name:"rightEyebrow"},{x:331.4815902709961,y:185.44180870056152,z:.6627205014228821},{x:328.05816650390625,y:170.8385467529297,z:7.358860373497009,name:"faceOval"},{x:304.49764251708984,y:239.76297855377197,z:10.387605428695679},{x:290.6382179260254,y:248.85257720947266,z:19.03616428375244},{x:331.5682601928711,y:233.20727348327637,z:7.837390303611755},{x:295.5115509033203,y:228.9834451675415,z:14.41426157951355},{x:336.94332122802734,y:241.8259334564209,z:-5.27842104434967},{x:336.2792205810547,y:262.7049922943115,z:-26.12074375152588},{x:284.4102478027344,y:255.3262710571289,z:25.467140674591064},{x:295.1420593261719,y:253.02655220031738,z:12.430112361907959},{x:303.5196113586426,y:254.20703887939453,z:6.139191389083862},{x:315.73450088500977,y:251.64799690246582,z:3.3788898587226868},{x:324.69661712646484,y:247.56494522094727,z:2.3328344523906708},{x:331.57970428466797,y:243.02241325378418,z:1.1423448473215103},{x:345.6210708618164,y:229.9976634979248,z:-10.825285911560059},{x:286.26644134521484,y:270.37991523742676,z:21.708929538726807},{x:290.2525520324707,y:228.4921360015869,z:17.71728754043579},{x:351.65367126464844,y:269.3400764465332,z:-33.450424671173096},{x:333.1378936767578,y:253.88388633728027,z:-7.230473756790161},{x:277.8318977355957,y:246.95331573486328,z:68.20805549621582,name:"faceOval"},{x:336.6680908203125,y:238.10003757476807,z:.7688578963279724},{x:329.95800018310547,y:269.18323516845703,z:-7.207130789756775},{x:299.17491912841797,y:234.13324356079102,z:15.95489501953125},{x:335.61729431152344,y:258.71752738952637,z:-23.016133308410645},{x:284.1079330444336,y:297.0343494415283,z:63.25934886932373,name:"faceOval"},{x:331.44542694091797,y:230.6892442703247,z:9.92658257484436,name:"rightEye"},{x:341.41536712646484,y:253.01264762878418,z:-29.038610458374023},{x:303.5472869873047,y:327.5896739959717,z:16.725212335586548},{x:304.7756576538086,y:337.4389457702637,z:27.38126277923584,name:"faceOval"},{x:280.80501556396484,y:275.32050132751465,z:45.0752067565918},{x:295.43582916259766,y:318.4501647949219,z:26.2608003616333},{x:281.4303207397461,y:228.7355661392212,z:40.94350814819336},{x:331.2549591064453,y:349.4216537475586,z:-7.376367449760437},{x:352.4247741699219,y:271.7330074310303,z:-24.953596591949463},{x:327.5672912597656,y:260.41900634765625,z:-5.456410646438599},{x:284.5432472229004,y:241.7647933959961,z:29.668869972229004},{x:310,y:235.66174507141113,z:8.502663969993591,name:"rightEye"},{x:315.7071113586426,y:235.7572603225708,z:6.938687562942505,name:"rightEye"},{x:330.41088104248047,y:311.04143142700195,z:-9.325502514839172,name:"lips"},{x:288.5377502441406,y:285.31983375549316,z:21.837315559387207},{x:344.55039978027344,y:359.4300842285156,z:-6.705257892608643,name:"faceOval"},{x:323.41880798339844,y:351.67362213134766,z:7.802375555038452,name:"faceOval"},{x:314.64088439941406,y:346.11894607543945,z:16.36339783668518,name:"faceOval"},{x:349.4945526123047,y:184.8434829711914,z:-.21847527474164963},{x:359.24694061279297,y:359.8348903656006,z:-8.403456211090088,name:"faceOval"},{x:321.26182556152344,y:234.64492321014404,z:6.90950870513916,name:"rightEye"},{x:326.318359375,y:232.90250301361084,z:8.029969334602356,name:"rightEye"},{x:329.6211624145508,y:231.6195774078369,z:9.722331762313843,name:"rightEye"},{x:285.9398078918457,y:228.2351303100586,z:24.650139808654785},{x:325.79288482666016,y:227.88007736206055,z:7.469738721847534,name:"rightEye"},{x:320.1699447631836,y:227.5934886932373,z:6.168370842933655,name:"rightEye"},{x:314.85408782958984,y:227.85282611846924,z:6.2675780057907104,name:"rightEye"},{x:309.3084907531738,y:229.1516876220703,z:7.7031683921813965,name:"rightEye"},{x:305.5621337890625,y:230.92366218566895,z:9.722331762313843,name:"rightEye"},{x:277.8681945800781,y:228.5354232788086,z:59.71122741699219,name:"faceOval"},{x:306.1444664001465,y:235.1954698562622,z:10.603528022766113,name:"rightEye"},{x:355.4478454589844,y:281.96210861206055,z:-20.565123558044434},{x:333.02661895751953,y:288.0105400085449,z:-14.72939133644104},{x:337.15728759765625,y:269.2059516906738,z:-19.8414945602417},{x:345.9898376464844,y:283.5453128814697,z:-20.4834246635437},{x:351.48963928222656,y:219.98916149139404,z:-7.0378947257995605},{x:312.39574432373047,y:336.50628089904785,z:8.671900033950806},{x:321.32152557373047,y:343.1755256652832,z:.9067271649837494},{x:343.78379821777344,y:353.2975959777832,z:-14.355905055999756},{x:296.8791389465332,y:327.91497230529785,z:41.01353645324707,name:"faceOval"},{x:329.6939468383789,y:229.27897453308105,z:8.934508562088013,name:"rightEye"},{x:341.6905212402344,y:241.4073657989502,z:-14.589333534240723},{x:359.03079986572266,y:353.48859786987305,z:-15.803166627883911},{x:333.1861877441406,y:356.43213272094727,z:-1.0234417766332626,name:"faceOval"},{x:283.97483825683594,y:291.4318656921387,z:41.94725513458252},{x:343.33770751953125,y:305.830135345459,z:-15.756480693817139,name:"lips"},{x:342.40283966064453,y:307.7453899383545,z:-17.4021577835083},{x:341.53621673583984,y:311.0595703125,z:-19.047834873199463},{x:340.9107208251953,y:315.4837703704834,z:-18.5576331615448,name:"lips"},{x:339.1478729248047,y:323.42233657836914,z:-14.367576837539673},{x:333.3201599121094,y:307.4406337738037,z:-9.617288708686829},{x:331.2411117553711,y:306.9811820983887,z:-9.669809937477112},{x:329.23255920410156,y:306.0508346557617,z:-9.582273960113525,name:"lips"},{x:322.4586486816406,y:301.33323669433594,z:-7.720675468444824},{x:297.1712112426758,y:286.9552803039551,z:8.240055441856384},{x:341.3060760498047,y:235.4432201385498,z:-7.504753470420837},{x:336.9318389892578,y:224.3451976776123,z:5.829898118972778},{x:332.65323638916016,y:226.70403957366943,z:8.105834126472473},{x:334.67357635498047,y:306.4397621154785,z:-8.981193900108337,name:"lips"},{x:297.4601936340332,y:306.29210472106934,z:15.476365089416504},{x:342.9119110107422,y:222.37077713012695,z:-2.754466235637665},{x:335.4629898071289,y:332.20250129699707,z:-11.823196411132812},{x:353.2412338256836,y:240.56339263916016,z:-27.147831916809082},{x:346.3080596923828,y:236.41446590423584,z:-18.452589511871338},{x:352.6475143432617,y:234.1420555114746,z:-19.748122692108154},{x:337.3209762573242,y:253.39937210083008,z:-16.024924516677856},{x:358.6122131347656,y:344.90861892700195,z:-18.592647314071655},{x:358.1117248535156,y:334.64990615844727,z:-17.49552845954895},{x:346.4450454711914,y:335.0321102142334,z:-16.32838249206543},{x:319.17640686035156,y:320.2833938598633,z:-3.276764452457428},{x:325.2540588378906,y:276.2369728088379,z:-6.460157036781311},{x:326.7214584350586,y:327.3939514160156,z:-7.417217493057251},{x:310.7190132141113,y:277.2265148162842,z:-3.5452082753181458},{x:319.78355407714844,y:284.8238182067871,z:-6.4543211460113525},{x:305.773983001709,y:290.83580017089844,z:.06907138042151928},{x:344.4001770019531,y:344.85408782958984,z:-16.946970224380493},{x:333.1879425048828,y:258.74256134033203,z:-11.90489649772644},{x:313.80598068237305,y:327.08919525146484,z:2.2277912497520447},{x:322.9637908935547,y:334.6819496154785,z:-3.3643004298210144},{x:313.4055519104004,y:311.2166690826416,z:-1.1175429821014404},{x:291.0865783691406,y:298.2831001281738,z:22.467575073242188},{x:305.6580924987793,y:313.3707904815674,z:5.561453700065613},{x:288.23760986328125,y:305.9941864013672,z:36.765122413635254},{x:315.10692596435547,y:296.26991271972656,z:-4.604393839836121},{x:337.50518798828125,y:247.5944423675537,z:-10.597691535949707},{x:338.8450622558594,y:265.47778129577637,z:-27.778091430664062},{x:334.25254821777344,y:269.0671920776367,z:-20.938611030578613},{x:341.64512634277344,y:259.6387195587158,z:-32.189905643463135},{x:331.44081115722656,y:219.0976095199585,z:4.207563698291779},{x:320.56339263916016,y:216.49658203125,z:2.930997312068939},{x:311.21912002563477,y:216.57853603363037,z:2.9674705862998962},{x:303.46256256103516,y:218.54614734649658,z:5.357203483581543},{x:297.99999237060547,y:222.505202293396,z:9.325502514839172},{x:294.93839263916016,y:236.39654159545898,z:18.534289598464966},{x:278.87489318847656,y:259.7095584869385,z:45.68212032318115},{x:300.3782653808594,y:245.38593292236328,z:12.278382778167725},{x:307.06348419189453,y:246.36857986450195,z:8.164191246032715},{x:315.5229187011719,y:245.3949737548828,z:5.503097176551819},{x:323.71395111083984,y:242.75178909301758,z:4.6335723996162415},{x:330.2785873413086,y:239.34658527374268,z:4.937030673027039},{x:334.6982192993164,y:236.0460376739502,z:4.823233783245087},{x:279.3412208557129,y:263.5196113586426,z:70.91583728790283,name:"faceOval"},{x:334.65972900390625,y:271.6648578643799,z:-17.775644063949585},{x:342.05677032470703,y:246.99846267700195,z:-20.84523916244507},{x:344.0357971191406,y:264.5701503753662,z:-32.936880588531494},{x:348.25531005859375,y:268.6645030975342,z:-30.695960521697998},{x:344.12227630615234,y:266.34212493896484,z:-29.808926582336426},{x:337.12318420410156,y:274.2556858062744,z:-15.768152475357056},{x:349.49047088623047,y:269.071683883667,z:-32.51670837402344},{x:350.1683044433594,y:271.4691352844238,z:-24.93025302886963},{x:333.9634704589844,y:230.56639194488525,z:8.89949381351471},{x:338.2147979736328,y:231.4807891845703,z:4.6715047955513},{x:340.4712677001953,y:231.74463272094727,z:-.34996166825294495},{x:303.28975677490234,y:232.24980354309082,z:11.916568279266357,name:"rightEye"},{x:299.4649124145508,y:229.53842639923096,z:12.325069904327393},{x:359.09618377685547,y:241.77349090576172,z:-24.650139808654785},{x:399.46216583251953,y:229.89503860473633,z:15.919880867004395,name:"leftEye"},{x:361.38919830322266,y:269.6129894256592,z:-24.510080814361572},{x:416.9973373413086,y:206.0895538330078,z:53.26857566833496,name:"faceOval"},{x:381.32179260253906,y:235.5476474761963,z:7.6214683055877686},{x:387.8068542480469,y:236.25958442687988,z:8.345099091529846},{x:393.95751953125,y:235.8660364151001,z:10.475142002105713},{x:401.84600830078125,y:232.77019500732422,z:16.760226488113403},{x:375.70568084716797,y:233.48456382751465,z:8.234220147132874},{x:388.17752838134766,y:218.94717693328857,z:6.810300946235657},{x:381.64928436279297,y:219.2656660079956,z:6.711093783378601},{x:394.4760513305664,y:219.66821193695068,z:9.173773527145386},{x:398.8843536376953,y:221.8837022781372,z:12.03328251838684},{x:406.5454864501953,y:237.12156772613525,z:19.7131085395813},{x:383.87447357177734,y:337.6932907104492,z:-8.631049990653992},{x:401.2682342529297,y:228.5916566848755,z:18.359217643737793,name:"leftEye"},{x:422.0449447631836,y:236.73934936523438,z:51.16771221160889},{x:412.69153594970703,y:232.80198097229004,z:27.52131938934326},{x:387.3497772216797,y:263.298397064209,z:-2.8609684109687805},{x:364.5124053955078,y:293.39221000671387,z:-22.397546768188477,name:"lips"},{x:363.62987518310547,y:302.1291446685791,z:-19.643079042434692},{x:373.2334518432617,y:295.8647060394287,z:-18.125789165496826,name:"lips"},{x:378.83365631103516,y:299.5177745819092,z:-13.153743743896484,name:"lips"},{x:369.91477966308594,y:302.5704002380371,z:-16.65518283843994},{x:374.9167251586914,y:303.5416603088379,z:-11.963253021240234},{x:387.58888244628906,y:312.2716999053955,z:-4.680258631706238},{x:360.6635284423828,y:264.31986808776855,z:-35.94811677932739},{x:361.04564666748047,y:256.8225860595703,z:-37.278664112091064},{x:408.3855438232422,y:213.52088928222656,z:15.756480693817139,name:"leftEyebrow"},{x:373.2946014404297,y:245.38101196289062,z:-1.9316278398036957},{x:376.83860778808594,y:264.3721103668213,z:-18.510947227478027},{x:376.9546127319336,y:261.0010528564453,z:-15.989909172058105},{x:406.1498260498047,y:263.5030174255371,z:7.072908878326416},{x:360.07205963134766,y:248.3631706237793,z:-32.16656446456909},{x:393.11119079589844,y:205.10473251342773,z:3.7786373496055603,name:"leftEyebrow"},{x:402.12791442871094,y:207.89000988006592,z:9.383859634399414,name:"leftEyebrow"},{x:410.8693313598633,y:191.6182279586792,z:41.27030849456787,name:"faceOval"},{x:364.9509811401367,y:210.40483474731445,z:-3.758212625980377},{x:375.94444274902344,y:221.1331844329834,z:8.368442058563232},{x:392.1904754638672,y:305.0360298156738,z:-1.752179116010666},{x:419.50225830078125,y:307.25592613220215,z:58.96425247192383,name:"faceOval"},{x:372.0027160644531,y:268.7212657928467,z:-16.631840467453003},{x:366.1614227294922,y:271.6237449645996,z:-18.219159841537476},{x:385.00938415527344,y:305.3863334655762,z:-2.567722797393799},{x:381.99771881103516,y:304.9723720550537,z:-4.575215280056},{x:405.078125,y:203.21216583251953,z:13.713973760604858,name:"leftEyebrow"},{x:377.13207244873047,y:268.4710121154785,z:-15.266278982162476},{x:380.9713363647461,y:205.36980628967285,z:-.7250899076461792,name:"leftEyebrow"},{x:381.7788314819336,y:198.9268398284912,z:-1.184653863310814,name:"leftEyebrow"},{x:385.5204772949219,y:172.1484375,z:16.04826807975769,name:"faceOval"},{x:407.94189453125,y:196.76236152648926,z:25.723915100097656},{x:383.03890228271484,y:184.5157527923584,z:7.393874526023865},{x:411.61781311035156,y:210.79241752624512,z:22.315845489501953,name:"leftEyebrow"},{x:414.30870056152344,y:208.4643030166626,z:37.021894454956055},{x:364.28722381591797,y:298.35777282714844,z:-21.86065673828125},{x:371.3682556152344,y:299.78848457336426,z:-17.834001779556274},{x:376.88201904296875,y:301.6696071624756,z:-13.153743743896484},{x:370.2193832397461,y:270.49095153808594,z:-15.569736957550049},{x:383.5081100463867,y:305.2726364135742,z:-3.673594295978546},{x:380.73760986328125,y:305.96869468688965,z:-8.660228252410889},{x:381.2334442138672,y:304.63574409484863,z:-4.820316135883331,name:"lips"},{x:368.1698989868164,y:264.8884963989258,z:-25.653886795043945},{x:373.5087203979492,y:303.4233856201172,z:-10.95950722694397,name:"lips"},{x:368.4544372558594,y:303.29601287841797,z:-14.169161319732666,name:"lips"},{x:362.76554107666016,y:303.5735607147217,z:-16.911956071853638,name:"lips"},{x:366.60980224609375,y:324.8870658874512,z:-15.616422891616821},{x:365.7067108154297,y:315.95678329467773,z:-20.903596878051758,name:"lips"},{x:365.0083923339844,y:311.2232208251953,z:-21.066999435424805},{x:364.1508102416992,y:307.0583438873291,z:-18.907777070999146},{x:363.37512969970703,y:304.5721435546875,z:-17.42550015449524,name:"lips"},{x:374.580078125,y:304.3059539794922,z:-11.40302300453186,name:"lips"},{x:375.55362701416016,y:305.0998020172119,z:-12.861957550048828},{x:377.2437286376953,y:307.1674346923828,z:-14.215847253799438},{x:378.68587493896484,y:309.9015712738037,z:-13.223772048950195,name:"lips"},{x:383.8992691040039,y:290.29629707336426,z:-9.97326910495758},{x:423.3871841430664,y:271.91688537597656,z:74.37058925628662,name:"faceOval"},{x:377.68043518066406,y:304.62209701538086,z:-7.603961229324341,name:"lips"},{x:379.00428771972656,y:304.9314594268799,z:-8.57852816581726},{x:364.00279998779297,y:275.2813911437988,z:-19.25792098045349},{x:374.68231201171875,y:273.82555961608887,z:-11.28047227859497},{x:365.0354766845703,y:273.4548568725586,z:-18.791062831878662},{x:380.61901092529297,y:249.8848056793213,z:.15501167625188828},{x:391.14158630371094,y:254.7934627532959,z:2.0906515419483185},{x:378.1761169433594,y:264.9612236022949,z:-12.605184316635132},{x:400.9540557861328,y:179.99592304229736,z:27.82477855682373,name:"faceOval"},{x:398.0038833618164,y:188.50656509399414,z:16.094952821731567},{x:394.8717498779297,y:199.0359592437744,z:6.226727366447449,name:"leftEyebrow"},{x:382.10926055908203,y:316.83926582336426,z:-8.946179747581482},{x:366.51588439941406,y:200.32583713531494,z:-5.24632453918457,name:"leftEyebrow"},{x:367.4893569946289,y:183.87210845947266,z:1.9039081037044525},{x:368.6243438720703,y:168.8127565383911,z:8.736093044281006,name:"faceOval"},{x:398.96175384521484,y:234.9675178527832,z:13.713973760604858},{x:412.9645538330078,y:242.23042488098145,z:23.272905349731445},{x:372.05257415771484,y:231.41919136047363,z:9.226294755935669},{x:406.0722351074219,y:223.58965873718262,z:18.370890617370605},{x:368.27442169189453,y:240.2039337158203,z:-4.166713654994965},{x:372.3575210571289,y:260.66442489624023,z:-24.976940155029297},{x:419.2244338989258,y:247.9079246520996,z:30.299127101898193},{x:409.43885803222656,y:246.60913467407227,z:16.398411989212036},{x:401.69139862060547,y:248.76328468322754,z:9.395531415939331},{x:389.7608184814453,y:247.56915092468262,z:5.841569304466248},{x:380.5461883544922,y:244.55984115600586,z:4.263003468513489},{x:373.25817108154297,y:240.80214500427246,z:2.5356262922286987},{x:358.77086639404297,y:229.35615062713623,z:-10.387605428695679},{x:419.5793914794922,y:262.8478717803955,z:26.5175724029541},{x:410.8808898925781,y:222.51372814178467,z:22.199130058288574},{x:358.45714569091797,y:268.91467094421387,z:-33.17030906677246},{x:373.4129333496094,y:251.6385841369629,z:-5.771540403366089},{x:422.5408172607422,y:239.23919677734375,z:74.04378890991211,name:"faceOval"},{x:367.8171920776367,y:236.58040523529053,z:1.820748895406723},{x:378.51959228515625,y:266.2532329559326,z:-5.74819803237915},{x:403.3472442626953,y:229.05112266540527,z:19.689764976501465},{x:372.34840393066406,y:256.6451168060303,z:-21.872329711914062},{x:422.54566192626953,y:289.1587829589844,z:68.67491245269775,name:"faceOval"},{x:371.9297409057617,y:228.90116214752197,z:11.432201862335205,name:"leftEye"},{x:366.21360778808594,y:251.6158962249756,z:-28.19826364517212},{x:409.1571807861328,y:321.3156223297119,z:20.2266526222229},{x:408.52943420410156,y:331.44238471984863,z:31.09278917312622,name:"faceOval"},{x:424.2788314819336,y:267.1992301940918,z:50.467424392700195},{x:415.60352325439453,y:311.6528606414795,z:30.579242706298828},{x:418.12793731689453,y:221.59927368164062,z:46.26569747924805},{x:385.68286895751953,y:346.0184955596924,z:-5.70151150226593},{x:357.82936096191406,y:271.3758373260498,z:-24.836881160736084},{x:379.588623046875,y:257.5071716308594,z:-3.755294680595398},{x:417.4592590332031,y:234.71948146820068,z:34.5475435256958},{x:393.4684371948242,y:231.58967971801758,z:11.408859491348267,name:"leftEye"},{x:387.8864288330078,y:232.14245796203613,z:9.51808214187622,name:"leftEye"},{x:382.4981689453125,y:307.5654888153076,z:-7.522260546684265,name:"lips"},{x:419.00169372558594,y:277.8332805633545,z:26.424202919006348},{x:373.62953186035156,y:357.6375102996826,z:-5.75986921787262,name:"faceOval"},{x:392.8708267211914,y:347.72446632385254,z:10.154176950454712,name:"faceOval"},{x:400.3953552246094,y:341.0005187988281,z:19.39797878265381,name:"faceOval"},{x:382.25440979003906,y:231.66935920715332,z:8.998700976371765,name:"leftEye"},{x:377.14550018310547,y:230.4228687286377,z:9.804032444953918,name:"leftEye"},{x:373.8358688354492,y:229.64950561523438,z:11.292144060134888,name:"leftEye"},{x:414.5794677734375,y:221.67891025543213,z:29.412097930908203},{x:377.00672149658203,y:225.66201210021973,z:9.360517263412476,name:"leftEye"},{x:382.29530334472656,y:224.8431158065796,z:8.32175612449646,name:"leftEye"},{x:387.5133514404297,y:224.49507236480713,z:8.917000889778137,name:"leftEye"},{x:393.15906524658203,y:225.24795055389404,z:10.737749338150024,name:"leftEye"},{x:397.05554962158203,y:226.55359268188477,z:13.002015352249146,name:"leftEye"},{x:420.5299377441406,y:221.014666557312,z:65.40690422058105,name:"faceOval"},{x:397.06920623779297,y:230.6661558151245,z:13.807345628738403,name:"leftEye"},{x:377.94647216796875,y:285.1647090911865,z:-13.305472135543823},{x:372.1118927001953,y:267.1267318725586,z:-18.83774757385254},{x:364.9968719482422,y:282.24411964416504,z:-19.818150997161865},{x:401.973876953125,y:331.20131492614746,z:11.566424369812012},{x:394.3083190917969,y:338.86693954467773,z:3.142542541027069},{x:373.9820861816406,y:351.4504623413086,z:-13.50388765335083},{x:414.3888854980469,y:321.24735832214355,z:45.51872253417969,name:"faceOval"},{x:373.44234466552734,y:227.33163356781006,z:10.626870393753052,name:"leftEye"},{x:364.0731430053711,y:240.31539916992188,z:-13.807345628738403},{x:384.2658233642578,y:353.3793067932129,z:.7385850697755814,name:"faceOval"},{x:423.20526123046875,y:283.5176181793213,z:47.152724266052246},{x:369.42798614501953,y:304.0898895263672,z:-14.647691249847412,name:"lips"},{x:370.63812255859375,y:305.90051651000977,z:-16.211668252944946},{x:371.91192626953125,y:309.0167713165283,z:-17.84567356109619},{x:373.0583953857422,y:313.3545398712158,z:-17.378815412521362,name:"lips"},{x:375.39905548095703,y:321.09289169311523,z:-13.118728399276733},{x:379.2567825317383,y:304.3582534790039,z:-7.924926280975342},{x:381.18797302246094,y:303.7031364440918,z:-7.843226194381714},{x:383.0918502807617,y:302.4884605407715,z:-7.6506465673446655,name:"lips"},{x:389.09461975097656,y:297.1475315093994,z:-5.5497825145721436},{x:411.6408920288086,y:280.24898529052734,z:12.02161192893982},{x:363.3110809326172,y:234.27620887756348,z:-6.775286793708801},{x:366.0474395751953,y:223.29872131347656,z:6.827808618545532},{x:370.34427642822266,y:225.1457118988037,z:9.558931589126587},{x:377.5371551513672,y:303.60079765319824,z:-7.358860373497009,name:"lips"},{x:412.9557800292969,y:299.53579902648926,z:19.39797878265381},{x:360.0810241699219,y:221.72012329101562,z:-2.153385728597641},{x:379.82784271240234,y:329.47723388671875,z:-10.48097848892212},{x:359.08477783203125,y:235.7911491394043,z:-18.079102039337158},{x:369.6688461303711,y:251.5407943725586,z:-14.962821006774902},{x:369.5555114746094,y:333.5307312011719,z:-15.67478060722351},{x:394.0193176269531,y:315.6973171234131,z:-.9920747578144073},{x:383.78997802734375,y:272.7268695831299,z:-4.689012169837952},{x:387.67765045166016,y:323.6722755432129,z:-5.640236139297485},{x:397.8769302368164,y:272.1331214904785,z:-.9395531564950943},{x:389.87476348876953,y:280.5630111694336,z:-4.29218202829361},{x:403.83888244628906,y:285.1167869567871,z:3.0229100584983826},{x:372.5467300415039,y:343.1070327758789,z:-16.153310537338257},{x:374.1112518310547,y:256.3721466064453,z:-10.574349164962769},{x:399.73785400390625,y:321.77515983581543,z:4.849494695663452},{x:392.03365325927734,y:330.56447982788086,z:-1.3407598435878754},{x:398.59134674072266,y:305.93902587890625,z:1.517290621995926},{x:417.95997619628906,y:290.9716987609863,z:26.89105987548828},{x:406.04541778564453,y:307.35154151916504,z:8.666064143180847},{x:420.75328826904297,y:298.40752601623535,z:41.78385257720947},{x:395.4522705078125,y:291.4153575897217,z:-2.1752697229385376},{x:368.6452102661133,y:245.8882999420166,z:-9.453888535499573},{x:370.34900665283203,y:263.56690406799316,z:-26.75100326538086},{x:374.98477935791016,y:266.6126346588135,z:-19.77146625518799},{x:366.99840545654297,y:258.12140464782715,z:-31.372904777526855},{x:371.00616455078125,y:217.63479709625244,z:5.60522198677063},{x:381.30577087402344,y:214.14087295532227,z:4.983716309070587},{x:390.1496124267578,y:213.38221549987793,z:5.593550801277161},{x:397.7696990966797,y:214.3659782409668,z:8.57852816581726},{x:403.1652069091797,y:217.65509605407715,z:13.013685941696167},{x:407.3551940917969,y:230.72525024414062,z:22.444231510162354},{x:424.0876770019531,y:251.7839241027832,z:51.16771221160889},{x:403.50196838378906,y:239.88757610321045,z:15.803166627883911},{x:397.31719970703125,y:241.49806022644043,z:11.233787536621094},{x:388.99425506591797,y:241.4366912841797,z:7.948269248008728},{x:380.7804489135742,y:239.78078842163086,z:6.600214838981628},{x:374.01336669921875,y:237.11946487426758,z:6.349278092384338},{x:369.39125061035156,y:234.35351371765137,z:5.987462401390076},{x:422.9730987548828,y:255.76455116271973,z:76.61150932312012,name:"faceOval"},{x:374.73915100097656,y:269.24214363098145,z:-16.608498096466064},{x:364.61681365966797,y:245.71088790893555,z:-20.02823829650879},{x:365.3834533691406,y:263.34174156188965,z:-32.32996463775635},{x:361.58252716064453,y:267.8273677825928,z:-30.345816612243652},{x:365.37208557128906,y:265.0249671936035,z:-29.178667068481445},{x:372.72605895996094,y:272.05135345458984,z:-14.834434986114502},{x:360.48614501953125,y:268.34827423095703,z:-32.189905643463135},{x:359.9516296386719,y:270.8049201965332,z:-24.650139808654785},{x:369.5049285888672,y:229.01945114135742,z:10.107489824295044},{x:365.5447769165039,y:230.24096488952637,z:5.593550801277161},{x:363.50669860839844,y:230.6208372116089,z:.43622106313705444},{x:399.3529510498047,y:227.65677452087402,z:15.35965085029602,name:"leftEye"},{x:402.5693130493164,y:224.60190296173096,z:15.931552648544312}],box:{xMin:277.8318977355957,yMin:168.7741756439209,xMax:424.2788314819336,yMax:359.8348903656006,width:146.4469337463379,height:191.0607147216797}},SAMPLE_FACELANDMARKER_RESULT:{faceLandmarks:[[{x:.5760777592658997,y:.8639070391654968,z:-.030997956171631813},{x:.572094738483429,y:.7886289358139038,z:-.07189624011516571},{x:.5723551511764526,y:.8075382709503174,z:-.03578168898820877},{x:.5548420548439026,y:.7188365459442139,z:-.057787876576185226},{x:.5706077814102173,y:.7674974799156189,z:-.07740399986505508},{x:.5681378245353699,y:.7387768030166626,z:-.07356284558773041},{x:.5621535181999207,y:.6681165099143982,z:-.04189874976873398},{x:.46613582968711853,y:.6679812073707581,z:.011289681307971478},{x:.5579932928085327,y:.6174106597900391,z:-.03502821549773216},{x:.5563451647758484,y:.5905600190162659,z:-.03928658738732338},{x:.5487832427024841,y:.4900572597980499,z:-.029898937791585922},{x:.5765544176101685,y:.8692144751548767,z:-.02831427752971649},{x:.5771114230155945,y:.873644232749939,z:-.02345779910683632},{x:.5771905779838562,y:.877016007900238,z:-.016658689826726913},{x:.5778058767318726,y:.8770116567611694,z:-.014505492523312569},{x:.5783766508102417,y:.8835000991821289,z:-.015996402129530907},{x:.5792440176010132,y:.8913810849189758,z:-.01924579218029976},{x:.5796768069267273,y:.8996334671974182,z:-.018261712044477463},{x:.5817288160324097,y:.9255813956260681,z:-.007126849144697189},{x:.5726592540740967,y:.7992473244667053,z:-.0643521398305893},{x:.5579419136047363,y:.7996989488601685,z:-.04566684365272522},{x:.4216199815273285,y:.5958762764930725,z:.06776496022939682},{x:.5052269697189331,y:.6796539425849915,z:-.0010737782577052712},{x:.49243026971817017,y:.6838865876197815,z:-.0005227324436418712},{x:.4796970784664154,y:.6856290102005005,z:.002684245817363262},{x:.4618356227874756,y:.6764569878578186,z:.013439622707664967},{x:.5160380601882935,y:.6737282276153564,z:-17607348127057776e-21},{x:.48070961236953735,y:.6255870461463928,z:-.008339674212038517},{x:.49719780683517456,y:.6256808042526245,z:-.008027955889701843},{x:.46674346923828125,y:.6317623853683472,z:-.004460199736058712},{x:.4582492709159851,y:.641118049621582,z:.0011905613355338573},{x:.45408669114112854,y:.6911458969116211,z:.020514748990535736},{x:.535312294960022,y:.9619986414909363,z:.012499462813138962},{x:.4608460068702698,y:.6628725528717041,z:.01517564244568348},{x:.4206731915473938,y:.6828458309173584,z:.07848648726940155},{x:.4390624463558197,y:.6796106696128845,z:.03283142298460007},{x:.5029968619346619,y:.7701570391654968,z:-.009734481573104858},{x:.5595027208328247,y:.8607323169708252,z:-.030043255537748337},{x:.5621269941329956,y:.8738374710083008,z:-.021709579974412918},{x:.5451499819755554,y:.865527331829071,z:-.022014077752828598},{x:.5351184010505676,y:.8705098032951355,z:-.011602800339460373},{x:.5495014190673828,y:.8744956254959106,z:-.016490943729877472},{x:.5395170450210571,y:.8759440779685974,z:-.007333362940698862},{x:.5183624029159546,y:.8959754705429077,z:.010520773939788342},{x:.5604349374771118,y:.7895449995994568,z:-.07082037627696991},{x:.557381272315979,y:.7687489986419678,z:-.07590588927268982},{x:.4432901442050934,y:.6308897733688354,z:.0027153254486620426},{x:.5258325338363647,y:.7151225805282593,z:-.014676518738269806},{x:.5271827578544617,y:.7833116054534912,z:-.037643320858478546},{x:.5257382988929749,y:.7717816233634949,z:-.03401920944452286},{x:.46516409516334534,y:.7705106735229492,z:.0065747760236263275},{x:.5558893084526062,y:.7420997619628906,z:-.0694495290517807},{x:.4720408320426941,y:.6066038608551025,z:-.021204356104135513},{x:.45432573556900024,y:.6158540844917297,z:-.011054684408009052},{x:.4305151402950287,y:.5608053803443909,z:.0396830290555954},{x:.5310865640640259,y:.6157484650611877,z:-.03081176057457924},{x:.5114666223526001,y:.6329749226570129,z:-.00335998204536736},{x:.506435751914978,y:.8786543607711792,z:.012980876490473747},{x:.4480472207069397,y:.8640613555908203,z:.12569651007652283},{x:.5372058153152466,y:.7942581176757812,z:-.03168361634016037},{x:.5488379597663879,y:.8001630306243896,z:-.03280917927622795},{x:.5213388204574585,y:.8794381618499756,z:.011892606504261494},{x:.5242055654525757,y:.8789222240447998,z:.008370225317776203},{x:.4477175176143646,y:.6039950251579285,z:-.0050799972377717495},{x:.526964008808136,y:.7916748523712158,z:-.02968614175915718},{x:.4971255660057068,y:.6050706505775452,z:-.028175678104162216},{x:.4938119053840637,y:.5882453918457031,z:-.03210941329598427},{x:.4757143557071686,y:.5094879865646362,z:-.01300730835646391},{x:.43947282433509827,y:.5816648006439209,z:.01415177434682846},{x:.485664039850235,y:.5477864146232605,z:-.023685332387685776},{x:.43635931611061096,y:.6226438283920288,z:.013606148771941662},{x:.42910251021385193,y:.6102726459503174,z:.03926564007997513},{x:.5605402588844299,y:.8680099248886108,z:-.027318159118294716},{x:.5474816560745239,y:.8702861070632935,z:-.019686367362737656},{x:.5373021364212036,y:.8728838562965393,z:-.010484928265213966},{x:.540735125541687,y:.7979167103767395,z:-.029073253273963928},{x:.5228585004806519,y:.87913578748703,z:.009915109723806381},{x:.530497670173645,y:.8815253973007202,z:.0020524784922599792},{x:.5259912610054016,y:.8790552616119385,z:.007895970717072487},{x:.5433906316757202,y:.7882310748100281,z:-.05121905356645584},{x:.541388213634491,y:.8777219653129578,z:-.00466804439201951},{x:.5515822172164917,y:.8767023086547852,z:-.010475946590304375},{x:.5637003779411316,y:.877059817314148,z:-.015273625031113625},{x:.5640299320220947,y:.9263423085212708,z:-.00658724969252944},{x:.5642300248146057,y:.8993074893951416,z:-.017653480172157288},{x:.5637336373329163,y:.8910360932350159,z:-.01852807030081749},{x:.5637134313583374,y:.8837276697158813,z:-.01482592523097992},{x:.564205527305603,y:.8768964409828186,z:-.01331155002117157},{x:.5419867634773254,y:.8778373599052429,z:-.0037720394320786},{x:.5404468774795532,y:.880696177482605,z:-.005610354244709015},{x:.5392338633537292,y:.8845721483230591,z:-.007352025713771582},{x:.538469672203064,y:.8891173601150513,z:-.005154991988092661},{x:.5189250111579895,y:.8452741503715515,z:-.009755070321261883},{x:.4258975088596344,y:.7662280797958374,z:.1387351155281067},{x:.5725725293159485,y:.8041572570800781,z:-.04583907872438431},{x:.5342061519622803,y:.8785833120346069,z:.002659974154084921},{x:.5324031114578247,y:.8804071545600891,z:.0017832003068178892},{x:.5538818836212158,y:.8078407645225525,z:-.03254539892077446},{x:.5325431823730469,y:.8026832938194275,z:-.019140373915433884},{x:.5514076948165894,y:.8043903112411499,z:-.03313535451889038},{x:.5131856203079224,y:.7284771800041199,z:-.009399853646755219},{x:.49331504106521606,y:.7443980574607849,z:-.005225230939686298},{x:.5239617824554443,y:.7807451486587524,z:-.025881027802824974},{x:.4473606050014496,y:.5315827131271362,z:.011164786294102669},{x:.45718759298324585,y:.5604941248893738,z:-.005943301599472761},{x:.4670005738735199,y:.5909327268600464,z:-.019681761041283607},{x:.5311570167541504,y:.9076261520385742,z:.00389476353302598},{x:.5249923467636108,y:.5893563628196716,z:-.037981919944286346},{x:.5166932344436646,y:.5429551005363464,z:-.03319704160094261},{x:.5085030198097229,y:.49676206707954407,z:-.02691275253891945},{x:.4687720239162445,y:.6834565997123718,z:.008113506250083447},{x:.4426414966583252,y:.7069531679153442,z:.028577271848917007},{x:.5230373740196228,y:.6675713658332825,z:.001773772411979735},{x:.4481240212917328,y:.6527872085571289,z:.012414850294589996},{x:.5339856743812561,y:.7012367844581604,z:-.020220188423991203},{x:.5347223281860352,y:.7761190533638,z:-.05141595005989075},{x:.4315067231655121,y:.7211957573890686,z:.04381405934691429},{x:.45203351974487305,y:.7206180095672607,z:.017288070172071457},{x:.46892452239990234,y:.7265436053276062,z:.005602988880127668},{x:.49314674735069275,y:.7202282547950745,z:-.0006408205372281373},{x:.5104925632476807,y:.7091827392578125,z:-.00362918758764863},{x:.5232142210006714,y:.698553740978241,z:-.00787867046892643},{x:.5497883558273315,y:.6743605136871338,z:-.036349106580019},{x:.43658503890037537,y:.7627100348472595,z:.042555369436740875},{x:.4397648870944977,y:.6528646349906921,z:.017956094816327095},{x:.5653332471847534,y:.7992802858352661,z:-.06365057826042175},{x:.5285563468933105,y:.736810564994812,z:-.018836988136172295},{x:.4180678725242615,y:.6792560815811157,z:.12284679710865021},{x:.5328429937362671,y:.6865872144699097,z:-.010484723374247551},{x:.5230283141136169,y:.7809416055679321,z:-.011922398582100868},{x:.4551771283149719,y:.6650775074958801,z:.01774493046104908},{x:.5337203741073608,y:.7618928551673889,z:-.04697106033563614},{x:.43463975191116333,y:.8133478164672852,z:.1354849934577942},{x:.5225707292556763,y:.6605283617973328,z:.004980515688657761},{x:.5441933870315552,y:.7497199773788452,z:-.06091512367129326},{x:.4774007797241211,y:.9159183502197266,z:.059622734785079956},{x:.48068761825561523,y:.9364941716194153,z:.08404944837093353},{x:.4268292486667633,y:.7657528519630432,z:.09051097184419632},{x:.46051913499832153,y:.8880485892295837,z:.0738474428653717},{x:.4243420660495758,y:.6434382200241089,z:.06230505183339119},{x:.5342157483100891,y:.9835634231567383,z:.021662971004843712},{x:.5668109655380249,y:.8042187094688416,z:-.044937074184417725},{x:.5176341533660889,y:.7530587315559387,z:-.012967454269528389},{x:.430206298828125,y:.6835605502128601,z:.04612284153699875},{x:.4794231951236725,y:.6732114553451538,z:.003970044665038586},{x:.49073347449302673,y:.6722435355186462,z:.0008692514384165406},{x:.5294116139411926,y:.884677529335022,z:.004413890186697245},{x:.4430122375488281,y:.80235356092453,z:.04987282305955887},{x:.5603825449943542,y:1.0092442035675049,z:.026417359709739685},{x:.5186598300933838,y:.9828659892082214,z:.0513598807156086},{x:.5010536909103394,y:.9640932679176331,z:.06591596454381943},{x:.5524769425392151,y:.539441704750061,z:-.035816047340631485},{x:.5879997611045837,y:1.0091472864151,z:.02285068854689598},{x:.5016193985939026,y:.6684437990188599,z:.00028415941051207483},{x:.511952817440033,y:.6642197370529175,z:.0021144719794392586},{x:.5194343328475952,y:.6623469591140747,z:.004674181342124939},{x:.4321230351924896,y:.6496355533599854,z:.03124697133898735},{x:.508686363697052,y:.6479565501213074,z:-.00044765998609364033},{x:.4963986277580261,y:.6431032419204712,z:-.0032507688738405704},{x:.4845542013645172,y:.6430778503417969,z:-.002903624437749386},{x:.4733612537384033,y:.647506833076477,z:.00023347247042693198},{x:.4668654501438141,y:.653346598148346,z:.004762572236359119},{x:.41815051436424255,y:.633708119392395,z:.09809435904026031},{x:.47159942984580994,y:.6711485385894775,z:.007849935442209244},{x:.5734396576881409,y:.8256140351295471,z:-.03155219927430153},{x:.5306524038314819,y:.8337990641593933,z:-.018351426348090172},{x:.5371729135513306,y:.7910830974578857,z:-.037286680191755295},{x:.5549534559249878,y:.8275275826454163,z:-.030664825811982155},{x:.5597432255744934,y:.6418541669845581,z:-.03318847343325615},{x:.4958484172821045,y:.9429569244384766,z:.048340678215026855},{x:.5140507817268372,y:.9634028077125549,z:.03589847311377525},{x:.5587693452835083,y:.9951097369194031,z:.00908728688955307},{x:.46411189436912537,y:.9051855206489563,z:.10601935535669327},{x:.5181609392166138,y:.6554316878318787,z:.002546071307733655},{x:.5436590909957886,y:.7085841298103333,z:-.03844436630606651},{x:.5872187614440918,y:.9960382580757141,z:.0063423276878893375},{x:.5379653573036194,y:.9989125728607178,z:.03636329993605614},{x:.4350326955318451,y:.8088565468788147,z:.09147704392671585},{x:.5523084998130798,y:.8773422837257385,z:-.009068487212061882},{x:.5510149598121643,y:.8816931843757629,z:-.011043853126466274},{x:.5503793954849243,y:.88776695728302,z:-.01348799467086792},{x:.5501549243927002,y:.8954370617866516,z:-.012142189778387547},{x:.546072781085968,y:.9192524552345276,z:-.003157563041895628},{x:.5314661860466003,y:.8771666884422302,z:.0005075141089037061},{x:.5293324589729309,y:.8762547969818115,z:.00039177737198770046},{x:.5275698900222778,y:.8750609755516052,z:47732755774632096e-21},{x:.5104271173477173,y:.8607332110404968,z:.0012934643309563398},{x:.45938700437545776,y:.8134918212890625,z:.023569690063595772},{x:.5418947339057922,y:.6864100694656372,z:-.027333909645676613},{x:.531914234161377,y:.6456130743026733,z:-.005434140563011169},{x:.523697018623352,y:.647885262966156,z:-.0002466466394253075},{x:.5338191390037537,y:.8783687353134155,z:.002268768846988678},{x:.46226605772972107,y:.8610277771949768,z:.04718952998518944},{x:.5434442758560181,y:.6456181406974792,z:-.02327350154519081},{x:.5399754643440247,y:.940219521522522,z:.005075343884527683},{x:.5661457777023315,y:.71457839012146,z:-.06242101639509201},{x:.5523148775100708,y:.6974870562553406,z:-.04863070324063301},{x:.5639959573745728,y:.6923378109931946,z:-.05180761218070984},{x:.5367592573165894,y:.7423217296600342,z:-.03623027727007866},{x:.5853689908981323,y:.9752064943313599,z:-.002361974213272333},{x:.5835235118865967,y:.9493685960769653,z:-.003941743168979883},{x:.5615018606185913,y:.949194610118866,z:-.0015953965485095978},{x:.5068561434745789,y:.9048219323158264,z:.01862684078514576},{x:.5134067535400391,y:.7971825003623962,z:-.008485661819577217},{x:.5223897099494934,y:.925589919090271,z:.01249657291918993},{x:.48500555753707886,y:.7959478497505188,z:-.0032065745908766985},{x:.5037734508514404,y:.8184596300125122,z:-.004932103678584099},{x:.4766361117362976,y:.828806459903717,z:.01027688942849636},{x:.5589827299118042,y:.974656343460083,z:.0009666886180639267},{x:.5294582843780518,y:.7541216611862183,z:-.025603046640753746},{x:.4973002076148987,y:.9208990931510925,z:.031931452453136444},{x:.5163551568984985,y:.9432790875434875,z:.024321340024471283},{x:.49399662017822266,y:.8814862370491028,z:.018687399104237556},{x:.44948166608810425,y:.836137592792511,z:.05702034756541252},{x:.47898444533348083,y:.8836610913276672,z:.03150695189833641},{x:.4454479217529297,y:.8499438166618347,z:.08868525922298431},{x:.49572959542274475,y:.8452823758125305,z:.0036111653316766024},{x:.5362502336502075,y:.7222585678100586,z:-.027912352234125137},{x:.5393770337104797,y:.7850722074508667,z:-.05415399745106697},{x:.531399667263031,y:.7898418307304382,z:-.03883346915245056},{x:.5451627373695374,y:.7717036604881287,z:-.06480253487825394},{x:.5206395983695984,y:.6287745833396912,z:-.010521138086915016},{x:.4974782466888428,y:.6191938519477844,z:-.014098240062594414},{x:.4774145185947418,y:.6193130612373352,z:-.013643337413668633},{x:.4616098403930664,y:.6259890198707581,z:-.008448202162981033},{x:.4516478478908539,y:.6368461847305298,z:9050309745362028e-20},{x:.4485096037387848,y:.6719120740890503,z:.022984720766544342},{x:.42177659273147583,y:.7240667343139648,z:.08511673659086227},{x:.4616215229034424,y:.6988231539726257,z:.014238474890589714},{x:.4755798876285553,y:.7034608721733093,z:.00625590980052948},{x:.4924992024898529,y:.7005885243415833,z:.0009391739731654525},{x:.5082254409790039,y:.693384051322937,z:-.0009464038303121924},{x:.5203112959861755,y:.6849707961082458,z:-.0022114769089967012},{x:.52867591381073,y:.6779075860977173,z:-.002962538506835699},{x:.4213953912258148,y:.7219811677932739,z:.1350894570350647},{x:.5320829749107361,y:.794858992099762,z:-.03181503340601921},{x:.5452795028686523,y:.7286570072174072,z:-.04771539941430092},{x:.5496407747268677,y:.7866933345794678,z:-.06452003121376038},{x:.557040274143219,y:.7962084412574768,z:-.05837344378232956},{x:.549176812171936,y:.7895247936248779,z:-.057761140167713165},{x:.5362890362739563,y:.8005836606025696,z:-.026903774589300156},{x:.560200035572052,y:.7983731031417847,z:-.06172555685043335},{x:.5616944432258606,y:.8022753596305847,z:-.045200999826192856},{x:.5273328423500061,y:.6611284017562866,z:.0029021520167589188},{x:.534850537776947,y:.6660012006759644,z:-.005215510260313749},{x:.5394860506057739,y:.6701375246047974,z:-.014931917190551758},{x:.4634307324886322,y:.658291757106781,z:.009295716881752014},{x:.4538393020629883,y:.6519932150840759,z:.00930330716073513},{x:.5776031613349915,y:.7159298658370972,z:-.057365912944078445},{x:.6504855155944824,y:.6461779475212097,z:.014184834435582161},{x:.5860154032707214,y:.7962266206741333,z:-.04522843658924103},{x:.6842049360275269,y:.5631637573242188,z:.07207967340946198},{x:.6152560710906982,y:.6674962639808655,z:.0007529259892180562},{x:.6280948519706726,y:.6684326529502869,z:.0016892586136236787},{x:.6408625245094299,y:.6663892269134521,z:.005331226624548435},{x:.6557814478874207,y:.6534678936004639,z:.01646413467824459},{x:.6035663485527039,y:.6639701724052429,z:.0013799630105495453},{x:.6329053044319153,y:.608010470867157,z:-.006195899099111557},{x:.6167260408401489,y:.6117533445358276,z:-.006319951266050339},{x:.6471013426780701,y:.6112449765205383,z:-.0017843559617176652},{x:.6560901999473572,y:.6185776591300964,z:.004047257360070944},{x:.6666946411132812,y:.6651176810264587,z:.023647578433156013},{x:.6311345100402832,y:.9495396018028259,z:.014004078693687916},{x:.6544655561447144,y:.6397901773452759,z:.01809609681367874},{x:.6965808868408203,y:.6482675075531006,z:.08304904401302338},{x:.679817259311676,y:.650188148021698,z:.03632688894867897},{x:.6336516737937927,y:.7541458010673523,z:-.007742783520370722},{x:.5921701192855835,y:.8567668199539185,z:-.029399123042821884},{x:.591663658618927,y:.870215654373169,z:-.02103729173541069},{x:.6068367958068848,y:.8584195375442505,z:-.020668085664510727},{x:.6176617741584778,y:.860965371131897,z:-.009790095500648022},{x:.6040634512901306,y:.8686612844467163,z:-.015289564616978168},{x:.6143736839294434,y:.8671170473098755,z:-.005712216719985008},{x:.6373105049133301,y:.8815656900405884,z:.012672550976276398},{x:.5832505822181702,y:.7866312861442566,z:-.07051534950733185},{x:.5836675763130188,y:.7658692598342896,z:-.07566110789775848},{x:.6709531545639038,y:.604898989200592,z:.005951565690338612},{x:.6029891967773438,y:.705652117729187,z:-.013388276100158691},{x:.6131622195243835,y:.7728396058082581,z:-.036248479038476944},{x:.6123163104057312,y:.7612020373344421,z:-.03264721855521202},{x:.6696187853813171,y:.744706928730011,z:.009673702530562878},{x:.5803102254867554,y:.7385968565940857,z:-.0689152330160141},{x:.6404349207878113,y:.5877999663352966,z:-.01929756999015808},{x:.6588467955589294,y:.5929454565048218,z:-.008487257175147533},{x:.6720337867736816,y:.530631422996521,z:.043437421321868896},{x:.584305465221405,y:.6099005341529846,z:-.030301367864012718},{x:.6034283638000488,y:.6217452883720398,z:-.001970183802768588},{x:.6460927724838257,y:.8608663082122803,z:.015541625209152699},{x:.6957815289497375,y:.8326103091239929,z:.13015234470367432},{x:.6043362617492676,y:.7861682772636414,z:-.030476901680231094},{x:.594293475151062,y:.7942103147506714,z:-.032218821346759796},{x:.6324057579040527,y:.8665139675140381,z:.014255806803703308},{x:.6296147704124451,y:.8667733669281006,z:.010388285852968693},{x:.663644552230835,y:.5798642635345459,z:-.0022301070857793093},{x:.6140630841255188,y:.7809288501739502,z:-.02835679054260254},{x:.615908145904541,y:.5921698212623596,z:-.026804860681295395},{x:.617181122303009,y:.5748661756515503,z:-.03060605563223362},{x:.6222207546234131,y:.49137672781944275,z:-.011151673272252083},{x:.6669357419013977,y:.5541607141494751,z:.017466170713305473},{x:.6182981729507446,y:.5320425629615784,z:-.021793590858578682},{x:.6760554313659668,y:.595052182674408,z:.017115700989961624},{x:.6801463961601257,y:.5800720453262329,z:.043127160519361496},{x:.5922210812568665,y:.8644017577171326,z:-.02662893570959568},{x:.6054555177688599,y:.8637874722480774,z:-.018363753333687782},{x:.6161889433860779,y:.8641164898872375,z:-.008808949030935764},{x:.6017249822616577,y:.7901403307914734,z:-.028126630932092667},{x:.631446123123169,y:.8664817810058594,z:.012112865224480629},{x:.6249198913574219,y:.8716511130332947,z:.003882825840264559},{x:.6281915903091431,y:.867301881313324,z:.009891441091895103},{x:.5986843109130859,y:.7813931703567505,z:-.050227612257003784},{x:.6126407384872437,y:.869275689125061,z:-.0031255714129656553},{x:.6027271151542664,y:.8711842894554138,z:-.009324162267148495},{x:.59088134765625,y:.8742044568061829,z:-.014608660712838173},{x:.5984604358673096,y:.9216185212135315,z:-.005981989670544863},{x:.5950398445129395,y:.8964707255363464,z:-.01703473925590515},{x:.5941568613052368,y:.8882410526275635,z:-.017784785479307175},{x:.5928806662559509,y:.8803883194923401,z:-.014153128489851952},{x:.5909661054611206,y:.8748103976249695,z:-.012609979137778282},{x:.6128016710281372,y:.8702545762062073,z:-.0022550546564161777},{x:.6150846481323242,y:.8726804256439209,z:-.00414019962772727},{x:.6173093914985657,y:.8770190477371216,z:-.005970994010567665},{x:.619335412979126,y:.8814800977706909,z:-.0036864024586975574},{x:.6292637586593628,y:.8314558267593384,z:-.007714875973761082},{x:.702275276184082,y:.7320667505264282,z:.1433621346950531},{x:.6204835176467896,y:.8689177632331848,z:.0044869170524179935},{x:.6223508715629578,y:.8704851269721985,z:.00352082890458405},{x:.590448260307312,y:.8029727935791016,z:-.03200828656554222},{x:.6097423434257507,y:.7933741211891174,z:-.018042555078864098},{x:.59229576587677,y:.7993767261505127,z:-.032564569264650345},{x:.6171364188194275,y:.7153720259666443,z:-.007672437466681004},{x:.6389747858047485,y:.726390540599823,z:-.002999067772179842},{x:.6151940226554871,y:.769412100315094,z:-.024427521973848343},{x:.6526776552200317,y:.505868136882782,z:.01412637997418642},{x:.6475822329521179,y:.5375454425811768,z:-.0033899128902703524},{x:.6433356404304504,y:.5714520215988159,z:-.017428796738386154},{x:.626949667930603,y:.8962116837501526,z:.005602736957371235},{x:.5868416428565979,y:.5829002261161804,z:-.03727729618549347},{x:.5877229571342468,y:.5345035791397095,z:-.032396964728832245},{x:.5887066125869751,y:.48655083775520325,z:-.025856535881757736},{x:.6507197618484497,y:.6612282991409302,z:.011114613153040409},{x:.6803066730499268,y:.677992045879364,z:.032125361263751984},{x:.5963194370269775,y:.6598632335662842,z:.002976928371936083},{x:.667536199092865,y:.6274255514144897,z:.015618261881172657},{x:.5930740833282471,y:.6940041780471802,z:-.019217798486351967},{x:.6053346395492554,y:.7676517963409424,z:-.050308309495449066},{x:.6934473514556885,y:.6884298920631409,z:.04794462397694588},{x:.6738007664680481,y:.6934011578559875,z:.020697161555290222},{x:.6588084697723389,y:.7033141851425171,z:.008462334051728249},{x:.6346072554588318,y:.7029502391815186,z:.001542167621664703},{x:.6157816648483276,y:.6966525912284851,z:-.002009218093007803},{x:.6015574336051941,y:.688928484916687,z:-.006588225718587637},{x:.5746836066246033,y:.6711069345474243,z:-.03597589209675789},{x:.6947521567344666,y:.7309479117393494,z:.046707939356565475},{x:.6759101152420044,y:.6249120831489563,z:.021654341369867325},{x:.5794773101806641,y:.7971615195274353,z:-.06339326500892639},{x:.6041849851608276,y:.727514922618866,z:-.017512541264295578},{x:.6968844532966614,y:.6440950036048889,z:.12727996706962585},{x:.5910853147506714,y:.679325520992279,z:-.009497715160250664},{x:.6157375574111938,y:.7695677280426025,z:-.010624290443956852},{x:.6606494784355164,y:.6410489678382874,z:.0208158977329731},{x:.6040687561035156,y:.7531470656394958,z:-.045887019485235214},{x:.7012156248092651,y:.780247151851654,z:.14028730988502502},{x:.595149576663971,y:.6527782678604126,z:.006308757700026035},{x:.5925500392913818,y:.7436665892601013,z:-.060151755809783936},{x:.6780198812484741,y:.8905693888664246,z:.0626060739159584},{x:.676746666431427,y:.9113880395889282,z:.08726003766059875},{x:.7030686140060425,y:.7312687635421753,z:.09529774636030197},{x:.688987135887146,y:.8588417172431946,z:.07752864807844162},{x:.6883691549301147,y:.6109960675239563,z:.06669612973928452},{x:.6358906030654907,y:.9702065587043762,z:.023120900616049767},{x:.5781539678573608,y:.8023634552955627,z:-.044763918966054916},{x:.6170316934585571,y:.7408350706100464,z:-.011375460773706436},{x:.688542366027832,y:.6516284346580505,z:.050206027925014496},{x:.6385149359703064,y:.6540714502334595,z:.006462941411882639},{x:.6279382109642029,y:.6563615798950195,z:.003062846139073372},{x:.6268895268440247,y:.8736732006072998,z:.00627936702221632},{x:.6944946050643921,y:.7709181308746338,z:.053824134171009064},{x:.614617109298706,y:1.0022112131118774,z:.02719894051551819},{x:.6493719220161438,y:.9665167927742004,z:.053563784807920456},{x:.6624587178230286,y:.943530797958374,z:.068605437874794},{x:.6162528991699219,y:.6558693051338196,z:.002187855076044798},{x:.6058168411254883,y:.654328465461731,z:.0036193584091961384},{x:.5987918972969055,y:.6536934971809387,z:.006134530063718557},{x:.6831037402153015,y:.6195642948150635,z:.03511790186166763},{x:.6062582731246948,y:.6356398463249207,z:.001280312892049551},{x:.6174948811531067,y:.62776118516922,z:-.0013642468256875873},{x:.6297246217727661,y:.6253792643547058,z:-.0007034156005829573},{x:.6407091617584229,y:.627578616142273,z:.0028144705574959517},{x:.6479622721672058,y:.6322650909423828,z:.00750273372977972},{x:.6915091276168823,y:.5990704298019409,z:.10270945727825165},{x:.6457163095474243,y:.6504453420639038,z:.010696077719330788},{x:.6164222955703735,y:.8231936097145081,z:-.016772059723734856},{x:.6042401194572449,y:.7830976843833923,z:-.03630910441279411},{x:.5922216773033142,y:.8228387236595154,z:-.029992375522851944},{x:.6646111011505127,y:.92097008228302,z:.050967294722795486},{x:.651232898235321,y:.9460107088088989,z:.038000158965587616},{x:.6140977144241333,y:.9882472157478333,z:.009882091544568539},{x:.6870781183242798,y:.8768675327301025,z:.10980932414531708},{x:.5986856818199158,y:.6456438899040222,z:.003999010659754276},{x:.585981547832489,y:.7034481763839722,z:-.0377722829580307},{x:.6342031359672546,y:.9867448806762695,z:.03786521404981613},{x:.7013950943946838,y:.776049017906189,z:.09598205983638763},{x:.6030206680297852,y:.8719133138656616,z:-.007931148633360863},{x:.6050592064857483,y:.8767156004905701,z:-.009791925549507141},{x:.6073468923568726,y:.8831382393836975,z:-.012361008673906326},{x:.6087977290153503,y:.890143632888794,z:-.01098148338496685},{x:.6147705316543579,y:.9110084772109985,z:-.0018823575228452682},{x:.622577965259552,y:.8670604825019836,z:.002609190298244357},{x:.6241236329078674,y:.8651344180107117,z:.0025534380692988634},{x:.6257084608078003,y:.8638408184051514,z:.0023300074972212315},{x:.639931321144104,y:.8449671268463135,z:.0038123116828501225},{x:.6810906529426575,y:.7856625318527222,z:.02717764675617218},{x:.583532452583313,y:.6811994910240173,z:-.026588857173919678},{x:.5855660438537598,y:.6393819451332092,z:-.004512844607234001},{x:.5932201743125916,y:.6398029327392578,z:.0008020466193556786},{x:.6200879812240601,y:.8683351874351501,z:.00417016725987196},{x:.6842559576034546,y:.8330534100532532,z:.050836317241191864},{x:.5754412412643433,y:.6418221592903137,z:-.022838059812784195},{x:.6232790350914001,y:.9295297265052795,z:.006339520215988159},{x:.5764067769050598,y:.694546639919281,z:-.04825803264975548},{x:.59778892993927,y:.7343927621841431,z:-.035004377365112305},{x:.6042810678482056,y:.9441440105438232,z:-.0010970570147037506},{x:.6496372222900391,y:.8869078159332275,z:.021036235615611076},{x:.6274012327194214,y:.7830310463905334,z:-.006658440921455622},{x:.637792706489563,y:.9104999899864197,z:.014290250837802887},{x:.6549934148788452,y:.7748609185218811,z:-.0006672973395325243},{x:.6404005289077759,y:.801220715045929,z:-.0026642554439604282},{x:.6671456694602966,y:.8045546412467957,z:.013180811889469624},{x:.6107483506202698,y:.9680658578872681,z:.001778992242179811},{x:.6060343980789185,y:.744587242603302,z:-.024382334202528},{x:.6602751612663269,y:.8998945355415344,z:.0344940721988678},{x:.6463775038719177,y:.9262562394142151,z:.02617623284459114},{x:.6579852104187012,y:.8602304458618164,z:.021586716175079346},{x:.6926165223121643,y:.8053340315818787,z:.061075080186128616},{x:.6724731922149658,y:.8594399690628052,z:.03457934781908989},{x:.6975721716880798,y:.8183245062828064,z:.09300774335861206},{x:.6512877941131592,y:.8258221745491028,z:.006324059329926968},{x:.594887375831604,y:.7148372530937195,z:-.026898479089140892},{x:.6017440557479858,y:.7773507833480835,z:-.05312420800328255},{x:.6096571683883667,y:.7806998491287231,z:-.037646256387233734},{x:.5952993035316467,y:.7654367685317993,z:-.06398405134677887},{x:.5950021147727966,y:.6201304793357849,z:-.009297547861933708},{x:.6165438890457153,y:.6052900552749634,z:-.012455573305487633},{x:.6362661719322205,y:.6015968918800354,z:-.011649220250546932},{x:.6522727608680725,y:.6046400666236877,z:-.005903332494199276},{x:.6625409722328186,y:.6128141283988953,z:.0030042496509850025},{x:.6688099503517151,y:.6457712054252625,z:.026322703808546066},{x:.7013440728187561,y:.6893666386604309,z:.08984331786632538},{x:.6608623266220093,y:.6749406456947327,z:.0172116681933403},{x:.6482325196266174,y:.6823726296424866,z:.008881398476660252},{x:.6313265562057495,y:.6842025518417358,z:.0031308617908507586},{x:.6147016286849976,y:.6809731721878052,z:.0007630771724507213},{x:.6018834114074707,y:.6755372285842896,z:-.0008834321051836014},{x:.5925027132034302,y:.670681357383728,z:-.001968748401850462},{x:.700127363204956,y:.6871103644371033,z:.13980500400066376},{x:.6095665693283081,y:.7853189706802368,z:-.03074747882783413},{x:.5880423784255981,y:.7229287028312683,z:-.04691500961780548},{x:.5930182337760925,y:.7811514139175415,z:-.06398335844278336},{x:.5867722034454346,y:.7922660112380981,z:-.05794971063733101},{x:.5933279991149902,y:.7842848896980286,z:-.05714067071676254},{x:.6063535809516907,y:.7920218706130981,z:-.02590685710310936},{x:.5839452743530273,y:.794978141784668,z:-.0615212507545948},{x:.5828126072883606,y:.8000800013542175,z:-.0449722595512867},{x:.5909603834152222,y:.6541213393211365,z:.003991890233010054},{x:.5852181911468506,y:.6602938771247864,z:-.004428438376635313},{x:.5825737714767456,y:.6651063561439514,z:-.014345290139317513},{x:.6517343521118164,y:.6362385153770447,z:.012151890434324741},{x:.6615052819252014,y:.6281577944755554,z:.0123682152479887},{x:.4856873154640198,y:.6568945646286011,z:.000720038078725338},{x:.49988406896591187,y:.6547410488128662,z:.0006949726957827806},{x:.48438939452171326,y:.6392973065376282,z:.000705525919329375},{x:.47143134474754333,y:.6589511632919312,z:.0006980331381782889},{x:.48704618215560913,y:.6752797961235046,z:.0006921177846379578},{x:.6243702173233032,y:.640461802482605,z:-6592126737814397e-20},{x:.6390967965126038,y:.6385173797607422,z:-.00016105435497593135},{x:.6230536699295044,y:.6224825382232666,z:-.00016136496560648084},{x:.6095397472381592,y:.641917884349823,z:-.0001803556369850412},{x:.6250996589660645,y:.6586247682571411,z:-.0001785515050869435}]],faceBlendshapes:[{categories:[{index:0,score:5187174338061595e-21,categoryName:"_neutral",displayName:""},{index:1,score:.24521504342556,categoryName:"browDownLeft",displayName:""},{index:2,score:.1987743377685547,categoryName:"browDownRight",displayName:""},{index:3,score:.013400448486208916,categoryName:"browInnerUp",displayName:""},{index:4,score:.012361560948193073,categoryName:"browOuterUpLeft",displayName:""},{index:5,score:.019305096939206123,categoryName:"browOuterUpRight",displayName:""},{index:6,score:28426356948330067e-21,categoryName:"cheekPuff",displayName:""},{index:7,score:3.4500112633395474e-7,categoryName:"cheekSquintLeft",displayName:""},{index:8,score:4.83789051486383e-7,categoryName:"cheekSquintRight",displayName:""},{index:9,score:.07650448381900787,categoryName:"eyeBlinkLeft",displayName:""},{index:10,score:.05070012807846069,categoryName:"eyeBlinkRight",displayName:""},{index:11,score:.13978900015354156,categoryName:"eyeLookDownLeft",displayName:""},{index:12,score:.14198613166809082,categoryName:"eyeLookDownRight",displayName:""},{index:13,score:.2177766114473343,categoryName:"eyeLookInLeft",displayName:""},{index:14,score:.014739357866346836,categoryName:"eyeLookInRight",displayName:""},{index:15,score:.02361512929201126,categoryName:"eyeLookOutLeft",displayName:""},{index:16,score:.19679604470729828,categoryName:"eyeLookOutRight",displayName:""},{index:17,score:.04874616861343384,categoryName:"eyeLookUpLeft",displayName:""},{index:18,score:.049392376095056534,categoryName:"eyeLookUpRight",displayName:""},{index:19,score:.34944331645965576,categoryName:"eyeSquintLeft",displayName:""},{index:20,score:.2939716875553131,categoryName:"eyeSquintRight",displayName:""},{index:21,score:.005955042317509651,categoryName:"eyeWideLeft",displayName:""},{index:22,score:.006776117719709873,categoryName:"eyeWideRight",displayName:""},{index:23,score:16942436559475027e-21,categoryName:"jawForward",displayName:""},{index:24,score:.0045165494084358215,categoryName:"jawLeft",displayName:""},{index:25,score:.07803940027952194,categoryName:"jawOpen",displayName:""},{index:26,score:2090057751047425e-20,categoryName:"jawRight",displayName:""},{index:27,score:.06032035872340202,categoryName:"mouthClose",displayName:""},{index:28,score:.00228882092051208,categoryName:"mouthDimpleLeft",displayName:""},{index:29,score:.00781762320548296,categoryName:"mouthDimpleRight",displayName:""},{index:30,score:.0017093931091949344,categoryName:"mouthFrownLeft",displayName:""},{index:31,score:.0019319106359034777,categoryName:"mouthFrownRight",displayName:""},{index:32,score:8485237776767462e-20,categoryName:"mouthFunnel",displayName:""},{index:33,score:.0009051355300471187,categoryName:"mouthLeft",displayName:""},{index:34,score:.0003630454302765429,categoryName:"mouthLowerDownLeft",displayName:""},{index:35,score:.00017601238505449146,categoryName:"mouthLowerDownRight",displayName:""},{index:36,score:.12865161895751953,categoryName:"mouthPressLeft",displayName:""},{index:37,score:.20137207210063934,categoryName:"mouthPressRight",displayName:""},{index:38,score:.0022203284315764904,categoryName:"mouthPucker",displayName:""},{index:39,score:.0009096377179957926,categoryName:"mouthRight",displayName:""},{index:40,score:.34189721941947937,categoryName:"mouthRollLower",displayName:""},{index:41,score:.11409689486026764,categoryName:"mouthRollUpper",displayName:""},{index:42,score:.17172536253929138,categoryName:"mouthShrugLower",displayName:""},{index:43,score:.004038424696773291,categoryName:"mouthShrugUpper",displayName:""},{index:44,score:.00023205230536404997,categoryName:"mouthSmileLeft",displayName:""},{index:45,score:.00019313619122840464,categoryName:"mouthSmileRight",displayName:""},{index:46,score:.0018571305554360151,categoryName:"mouthStretchLeft",displayName:""},{index:47,score:.0023813238367438316,categoryName:"mouthStretchRight",displayName:""},{index:48,score:24323100660694763e-21,categoryName:"mouthUpperUpLeft",displayName:""},{index:49,score:3161552012898028e-20,categoryName:"mouthUpperUpRight",displayName:""},{index:50,score:1.08198406678639e-7,categoryName:"noseSneerLeft",displayName:""},{index:51,score:12652527630052646e-22,categoryName:"noseSneerRight",displayName:""}],headIndex:-1,headName:""}],facialTransformationMatrixes:[{rows:4,columns:4,data:[.9947517514228821,.10230544209480286,.0013679931871592999,0,-.10230997204780579,.9947447776794434,.003816320328041911,0,-.000970348424743861,-.0039362297393381596,.9999914169311523,0,2.8888821601867676,-7.808934211730957,-30.52109146118164,1]}]}},H$=m({}),V$={basePath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.17/wasm",options:{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}},j$=c(({basePath:t=V$.basePath,options:n=V$.options,children:r},i)=>{const a=JSON.stringify(n),o=ff(async()=>{const{FilesetResolver:e,FaceLandmarker:r}=await Promise.resolve().then(function(){return G8}),i=await e.forVisionTasks(t);return r.createFromOptions(i,n)},[t,a]);return s(()=>()=>{null==o||o.close(),mf([t,a])},[o,t,a]),f(i,()=>o,[o]),e.createElement(H$.Provider,{value:o},r)});function W$(){return h(H$)}function Y$(e,t){return e.clone().add(t).multiplyScalar(.5)}function K$(e,t,n){const r=e.localToWorld(t);return n.worldToLocal(r)}const q$=m({}),X$=c(({camera:t,videoTexture:n={start:!0},manualDetect:i=!1,faceLandmarkerResult:a,manualUpdate:c=!1,makeDefault:h,smoothTime:d=.25,offset:p=!0,offsetScalar:m=80,eyes:A=!1,eyesAsOrigin:v=!0,depth:y=.15,debug:E=!1,facemesh:_},x)=>{var b,S;const w=zp(e=>e.scene),C=zp(e=>e.camera),T=zp(e=>e.set),M=zp(e=>e.get),I=t||C,R=r(null),[B]=o(()=>new Lr),[P]=o(()=>new Dn),[D]=o(()=>new Dn),[L]=o(()=>new Dn),[k]=o(()=>new Dn),F=u(()=>{B.parent=I.parent;const e=R.current;if(e){const{outerRef:t,eyeRightRef:n,eyeLeftRef:r}=e;if(n.current&&r.current){const{irisDirRef:e}=n.current,{irisDirRef:i}=r.current;e.current&&i.current&&t.current&&(P.copy(K$(e.current,new Dn(0,0,0),t.current)),D.copy(K$(i.current,new Dn(0,0,0),t.current)),B.position.copy(K$(t.current,Y$(P,D),I.parent||w)),L.copy(K$(e.current,new Dn(0,0,1),t.current)),k.copy(K$(i.current,new Dn(0,0,1),t.current)),B.lookAt(t.current.localToWorld(Y$(L,k))))}else t.current&&(B.position.copy(K$(t.current,new Dn(0,0,0),I.parent||w)),B.lookAt(t.current.localToWorld(new Dn(0,0,1))))}return B},[I,D,k,P,L,w,B]),[O]=o(()=>new Lr),U=u(function(e,t){if(I){var n;if(null!==(n=t)&&void 0!==n||(t=F()),d>0){const n=1e-9;Jv.damp3(O.position,t.position,d,e,void 0,void 0,n),Jv.dampE(O.rotation,t.rotation,d,e,void 0,void 0,n)}else O.position.copy(t.position),O.rotation.copy(t.rotation);I.position.copy(O.position),I.rotation.copy(O.rotation)}},[I,F,d,O.position,O.rotation]);Gp((e,t)=>{c||U(t)});const N=r(null),[z,G]=o(),Q=W$(),H=u((e,t)=>{const n=N.current;if(!n)return;const r=n.source.data,i=null==Q?void 0:Q.detectForVideo(r,e);G(i)},[Q]),V=l(()=>Object.assign(Object.create(Gt.prototype),{computeTarget:F,update:U,facemeshApiRef:R}),[F,U]);f(x,()=>V,[V]),s(()=>{if(h){const e=M().controls;return T({controls:V}),()=>T({controls:e})}},[h,V,M,T]);const j=null!=a?a:z,W=null==j?void 0:j.faceLandmarks[0],Y=null==j||null==(b=j.facialTransformationMatrixes)?void 0:b[0],K=null==j||null==(S=j.faceBlendshapes)?void 0:S[0],q={onVideoFrame:H,...n};return e.createElement(q$.Provider,{value:V},!i&&e.createElement(g,{fallback:null},"src"in q?e.createElement(ZG,Lm({ref:N},q)):e.createElement(F$,Lm({ref:N},q))),e.createElement(N$,Lm({ref:R,children:e.createElement("meshNormalMaterial",{side:2})},_,{points:W,depth:y,facialTransformationMatrix:Y,faceBlendshapes:K,eyes:A,eyesAsOrigin:v,offset:p,offsetScalar:m,debug:E,"rotation-z":Math.PI,visible:E})))}),$$=()=>h(q$);const J$={THREE:$d,...Dm,...Object.freeze({__proto__:null,Html:Km,CycleRaycast:qm,useCursor:Xm,Loader:sg,DragControls:wA,Scroll:iy,ScrollControls:ty,useScroll:ey,PresentationControls:Sx,KeyboardControls:Tx,useKeyboardControls:Mx,Select:dM,useSelect:fM,Billboard:pM,ScreenSpace:mM,ScreenSizer:xM,QuadraticBezierLine:wM,CubicBezierLine:CM,CatmullRomLine:TM,Line:bM,PositionalAudio:MM,Text:jI,Text3D:XI,Effects:JI,isWebGL2Available:$I,GradientTexture:eR,GradientType:ZI,Image:uR,Edges:hR,Outlines:fR,Trail:bR,useTrail:xR,Sampler:wR,useSurfaceSampler:SR,ComputedAttribute:CR,Clone:TR,MarchingCube:RR,MarchingCubes:IR,MarchingPlane:BR,Decal:DR,Svg:LR,Gltf:NR,useGLTF:UR,AsciiRenderer:zR,Splat:jR,OrthographicCamera:KR,PerspectiveCamera:qR,CubeCamera:$R,useCubeCamera:XR,DeviceOrientationControls:JR,FlyControls:ZR,MapControls:eB,OrbitControls:tB,TrackballControls:nB,ArcballControls:rB,TransformControls:iB,PointerLockControls:sB,FirstPersonControls:aB,CameraControls:rP,MotionPathControls:oP,useMotion:sP,GizmoHelper:EP,useGizmoContext:hP,GizmoViewcube:LP,GizmoViewport:OP,Grid:NP,CubeTexture:GP,useCubeTexture:zP,Fbx:HP,useFBX:QP,Ktx2:WP,useKTX2:jP,Progress:rg,useProgress:ng,IsObject:nR,Texture:iR,useTexture:rR,VideoTexture:ZG,useVideoTexture:JG,useFont:KI,checkIfFrameIsEmpty:nQ,getFirstFrame:tQ,useSpriteLoader:rQ,Helper:sQ,useHelper:iQ,Stats:hQ,StatsGl:pQ,useDepthBuffer:mQ,useAspect:gQ,useCamera:AQ,DetectGPU:RQ,useDetectGPU:IQ,Bvh:xj,useBVH:_j,useContextBridge:bj,useAnimations:Sj,Fbo:YR,useFBO:WR,useIntersect:wj,useBoxProjectedEnv:Cj,BBAnchor:Ij,TrailTexture:Dj,useTrailTexture:Pj,Example:kj,SpriteAnimator:LW,useSpriteAnimator:PW,CurveModifier:kW,MeshDistortMaterial:OW,MeshWobbleMaterial:NW,MeshReflectorMaterial:HW,MeshRefractionMaterial:jW,MeshTransmissionMaterial:KW,MeshDiscardMaterial:qW,MultiMaterial:XW,PointMaterial:ZW,PointMaterialImpl:JW,shaderMaterial:tR,SoftShadows:tY,Box:rY,Capsule:EY,Circle:iY,Cone:sY,Cylinder:aY,Dodecahedron:AY,Extrude:vY,Icosahedron:mY,Lathe:yY,Octahedron:gY,Plane:lY,Polyhedron:pY,Ring:fY,Shape:_Y,Sphere:oY,Tetrahedron:dY,Torus:uY,TorusKnot:hY,Tube:cY,RoundedBox:bY,ScreenQuad:wY,Center:Lj,Resize:CY,Bounds:BY,useBounds:PY,CameraShake:DY,Float:LY,Stage:vK,Backdrop:EK,Shadow:_K,Caustics:TK,ContactShadows:uK,AccumulativeShadows:fK,RandomizedLight:pK,accumulativeContext:hK,Reflector:MK,SpotLight:kK,SpotLightShadow:LK,Environment:cK,EnvironmentCube:aK,EnvironmentMap:sK,EnvironmentPortal:oK,Lightformer:FK,Sky:UK,calcPosFromAngles:OK,Stars:GK,Cloud:$K,CloudInstance:XK,Clouds:qK,Sparkles:rq,useEnvironment:JY,MatcapTexture:sq,useMatcapTexture:iq,NormalTexture:oq,useNormalTexture:aq,Wireframe:gq,ShadowAlpha:Aq,Point:Iq,Points:Bq,PointsBuffer:Rq,PositionPoint:xq,Instance:CW,InstancedAttribute:RW,Instances:TW,Merged:MW,PositionMesh:vW,createInstances:IW,Segment:Fq,SegmentObject:Lq,Segments:Dq,Detailed:Oq,Preload:Uq,BakeShadows:Nq,meshBounds:Vq,AdaptiveDpr:jq,AdaptiveEvents:Wq,PerformanceMonitor:Kq,usePerformanceMonitor:qq,RenderTexture:Xq,RenderCubeTexture:Jq,Mask:eX,useMask:tX,Hud:cP,Fisheye:nX,MeshPortalMaterial:sX,calculateScaleFactor:EM,View:HX,PivotControls:L$,ScreenVideoTexture:k$,WebcamVideoTexture:F$,FaceControls:X$,useFaceControls:$$,FaceLandmarker:j$,FaceLandmarkerDefaults:V$,useFaceLandmarker:W$,Facemesh:N$,FacemeshDatas:Q$,FacemeshEye:G$,FacemeshEyeDefaults:z$})};"undefined"!=typeof window&&(window.My3D=J$);var Z$="undefined"!=typeof self?self:{};function eJ(e,t){e:{for(var n=["CLOSURE_FLAGS"],r=Z$,i=0;i<n.length;i++)if(null==(r=r[n[i]])){n=null;break e}n=r}return null!=(e=n&&n[e])?e:t}function tJ(){throw Error("Invalid UTF8")}function nJ(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}let rJ,iJ;const sJ="undefined"!=typeof TextDecoder;let aJ;const oJ="undefined"!=typeof TextEncoder;function lJ(e){if(oJ)e=(aJ||=new TextEncoder).encode(e);else{let n=0;const r=new Uint8Array(3*e.length);for(let i=0;i<e.length;i++){var t=e.charCodeAt(i);if(t<128)r[n++]=t;else{if(t<2048)r[n++]=t>>6|192;else{if(t>=55296&&t<=57343){if(t<=56319&&i<e.length){const s=e.charCodeAt(++i);if(s>=56320&&s<=57343){t=1024*(t-55296)+s-56320+65536,r[n++]=t>>18|240,r[n++]=t>>12&63|128,r[n++]=t>>6&63|128,r[n++]=63&t|128;continue}i--}t=65533}r[n++]=t>>12|224,r[n++]=t>>6&63|128}r[n++]=63&t|128}}e=n===r.length?r:r.subarray(0,n)}return e}var cJ,uJ=eJ(610401301,!1),hJ=eJ(653718497,eJ(1,!0)),dJ=eJ(660014094,!1);const fJ=Z$.navigator;function pJ(e){return!!uJ&&!!cJ&&cJ.brands.some(({brand:t})=>t&&-1!=t.indexOf(e))}function mJ(e){var t;return(t=Z$.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}function gJ(){return!!uJ&&!!cJ&&cJ.brands.length>0}function AJ(){return gJ()?pJ("Chromium"):(mJ("Chrome")||mJ("CriOS"))&&!(!gJ()&&mJ("Edge"))||mJ("Silk")}function vJ(e){return vJ[" "](e),e}cJ=fJ&&fJ.userAgentData||null,vJ[" "]=function(){};var yJ=!gJ()&&(mJ("Trident")||mJ("MSIE"));!mJ("Android")||AJ(),AJ(),mJ("Safari")&&(AJ()||!gJ()&&mJ("Coast")||!gJ()&&mJ("Opera")||!gJ()&&mJ("Edge")||(gJ()?pJ("Microsoft Edge"):mJ("Edg/"))||gJ()&&pJ("Opera"));var EJ={},_J=null;function xJ(){if(!_J){_J={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;n<5;n++){var r=e.concat(t[n].split(""));EJ[n]=r;for(var i=0;i<r.length;i++){var s=r[i];void 0===_J[s]&&(_J[s]=i)}}}}var bJ="undefined"!=typeof Uint8Array,SJ=!yJ&&"function"==typeof btoa;function wJ(e){if(!SJ){var t;void 0===t&&(t=0),xJ(),t=EJ[t];var n=Array(Math.floor(e.length/3)),r=t[64]||"";let l=0,c=0;for(;l<e.length-2;l+=3){var i=e[l],s=e[l+1],a=e[l+2],o=t[i>>2];i=t[(3&i)<<4|s>>4],s=t[(15&s)<<2|a>>6],a=t[63&a],n[c++]=o+i+s+a}switch(o=0,a=r,e.length-l){case 2:a=t[(15&(o=e[l+1]))<<2]||r;case 1:e=e[l],n[c]=t[e>>2]+t[(3&e)<<4|o>>4]+a+r}return n.join("")}for(t="",n=0,r=e.length-10240;n<r;)t+=String.fromCharCode.apply(null,e.subarray(n,n+=10240));return t+=String.fromCharCode.apply(null,n?e.subarray(n):e),btoa(t)}const CJ=/[-_.]/g,TJ={"-":"+",_:"/",".":"="};function MJ(e){return TJ[e]||""}function IJ(e){if(!SJ)return function(e){var t=e.length,n=3*t/4;n%3?n=Math.floor(n):-1!="=.".indexOf(e[t-1])&&(n=-1!="=.".indexOf(e[t-2])?n-2:n-1);var r=new Uint8Array(n),i=0;return function(e,t){function n(t){for(;r<e.length;){var n=e.charAt(r++),i=_J[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}xJ();for(var r=0;;){var i=n(-1),s=n(0),a=n(64),o=n(64);if(64===o&&-1===i)break;t(i<<2|s>>4),64!=a&&(t(s<<4&240|a>>2),64!=o&&t(a<<6&192|o))}}(e,function(e){r[i++]=e}),i!==n?r.subarray(0,i):r}(e);CJ.test(e)&&(e=e.replace(CJ,MJ)),e=atob(e);const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function RJ(e){return bJ&&null!=e&&e instanceof Uint8Array}var BJ={};let PJ;function DJ(e){if(e!==BJ)throw Error("illegal external caller")}function LJ(){return PJ||=new FJ(null,BJ)}function kJ(e){DJ(BJ);var t=e.ba;return null==(t=null==t||RJ(t)?t:"string"==typeof t?IJ(t):null)?t:e.ba=t}var FJ=class{constructor(e,t){if(DJ(t),this.ba=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}ua(){return new Uint8Array(kJ(this)||0)}};function OJ(e,t){e.__closure__error__context__984382||(e.__closure__error__context__984382={}),e.__closure__error__context__984382.severity=t}let UJ;function NJ(){const e=Error();OJ(e,"incident"),function(e){Z$.setTimeout(()=>{throw e},0)}(e)}function zJ(e){return OJ(e=Error(e),"warning"),e}function GJ(){return"function"==typeof BigInt}function QJ(e){return Array.prototype.slice.call(e)}var HJ="function"==typeof Symbol&&"symbol"==typeof Symbol();function VJ(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol():e}var jJ=VJ(),WJ=VJ("0di"),YJ=VJ("2ex"),KJ=VJ("1oa"),qJ=VJ("0dg"),XJ=HJ?(e,t)=>{e[jJ]|=t}:(e,t)=>{void 0!==e.G?e.G|=t:Object.defineProperties(e,{G:{value:t,configurable:!0,writable:!0,enumerable:!1}})},$J=HJ?(e,t)=>{e[jJ]&=~t}:(e,t)=>{void 0!==e.G&&(e.G&=~t)},JJ=HJ?e=>0|e[jJ]:e=>0|e.G,ZJ=HJ?e=>e[jJ]:e=>e.G,eZ=HJ?(e,t)=>{e[jJ]=t}:(e,t)=>{void 0!==e.G?e.G=t:Object.defineProperties(e,{G:{value:t,configurable:!0,writable:!0,enumerable:!1}})};function tZ(e){return XJ(e,34),e}function nZ(e,t){eZ(t,-14591&e)}function rZ(e,t){eZ(t,-14557&e|34)}var iZ,sZ={},aZ={};function oZ(e){return!(!e||"object"!=typeof e||e.La!==aZ)}function lZ(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&e.constructor===Object}function cZ(e,t,n){if(null!=e)if("string"==typeof e)e=e?new FJ(e,BJ):LJ();else if(e.constructor!==FJ)if(RJ(e))e=e.length?new FJ(n?e:new Uint8Array(e),BJ):LJ();else{if(!t)throw Error();e=void 0}return e}function uZ(e){return!(!Array.isArray(e)||e.length||!(1&JJ(e)))}const hZ=[];function dZ(e){if(2&e)throw Error()}eZ(hZ,55),iZ=Object.freeze(hZ);class fZ{constructor(e,t,n){this.l=0,this.g=e,this.h=t,this.m=n}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new fZ(this.g,this.h,this.m)}}let pZ;function mZ(e,t){(t=pZ?t[pZ]:void 0)&&(e[pZ]=QJ(t))}var gZ=Object.freeze({});Object.freeze({});var AZ=Object.freeze({});function vZ(e){return e.Sa=!0,e}var yZ=vZ(e=>"number"==typeof e),EZ=vZ(e=>"string"==typeof e),_Z=vZ(e=>"boolean"==typeof e),xZ="function"==typeof Z$.BigInt&&"bigint"==typeof Z$.BigInt(0),bZ=vZ(e=>xZ?e>=wZ&&e<=TZ:"-"===e[0]?MZ(e,SZ):MZ(e,CZ));const SZ=Number.MIN_SAFE_INTEGER.toString(),wZ=xZ?BigInt(Number.MIN_SAFE_INTEGER):void 0,CZ=Number.MAX_SAFE_INTEGER.toString(),TZ=xZ?BigInt(Number.MAX_SAFE_INTEGER):void 0;function MZ(e,t){if(e.length>t.length)return!1;if(e.length<t.length||e===t)return!0;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];if(r>i)return!1;if(r<i)return!0}}const IZ="function"==typeof Uint8Array.prototype.slice;let RZ,BZ=0,PZ=0;function DZ(e){const t=e>>>0;BZ=t,PZ=(e-t)/4294967296>>>0}function LZ(e){if(e<0){DZ(-e);const[t,n]=GZ(BZ,PZ);BZ=t>>>0,PZ=n>>>0}else DZ(e)}function kZ(e){const t=RZ||=new DataView(new ArrayBuffer(8));t.setFloat32(0,+e,!0),PZ=0,BZ=t.getUint32(0,!0)}function FZ(e,t){return 4294967296*t+(e>>>0)}function OZ(e,t){const n=2147483648&t;return n&&(t=~t>>>0,0==(e=1+~e>>>0)&&(t=t+1>>>0)),e=FZ(e,t),n?-e:e}function UZ(e,t){if(e>>>=0,(t>>>=0)<=2097151)var n=""+(4294967296*t+e);else GJ()?n=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(e=(16777215&e)+6777216*(n=16777215&(e>>>24|t<<8))+6710656*(t=t>>16&65535),n+=8147497*t,t*=2,e>=1e7&&(n+=e/1e7>>>0,e%=1e7),n>=1e7&&(t+=n/1e7>>>0,n%=1e7),n=t+NZ(n)+NZ(e));return n}function NZ(e){return e=String(e),"0000000".slice(e.length)+e}function zZ(e){if(e.length<16)LZ(Number(e));else if(GJ())e=BigInt(e),BZ=Number(e&BigInt(4294967295))>>>0,PZ=Number(e>>BigInt(32)&BigInt(4294967295));else{const t=+("-"===e[0]);PZ=BZ=0;const n=e.length;for(let r=t,i=(n-t)%6+t;i<=n;r=i,i+=6){const t=Number(e.slice(r,i));PZ*=1e6,BZ=1e6*BZ+t,BZ>=4294967296&&(PZ+=Math.trunc(BZ/4294967296),PZ>>>=0,BZ>>>=0)}if(t){const[e,t]=GZ(BZ,PZ);BZ=e,PZ=t}}}function GZ(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function QZ(e){return null==e||"number"==typeof e?e:"NaN"===e||"Infinity"===e||"-Infinity"===e?Number(e):void 0}function HZ(e){return null==e||"boolean"==typeof e?e:"number"==typeof e?!!e:void 0}const VZ=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function jZ(e){const t=typeof e;switch(t){case"bigint":return!0;case"number":return Number.isFinite(e)}return"string"===t&&VZ.test(e)}function WZ(e){if(null==e)return e;if("string"==typeof e){if(!e)return;e=+e}return"number"==typeof e&&Number.isFinite(e)?0|e:void 0}function YZ(e){if(null==e)return e;if("string"==typeof e){if(!e)return;e=+e}return"number"==typeof e&&Number.isFinite(e)?e>>>0:void 0}function KZ(e){return"-"!==e[0]&&(e.length<20||20===e.length&&Number(e.substring(0,6))<184467)}function qZ(e){return e=Math.trunc(e),Number.isSafeInteger(e)||(LZ(e),e=OZ(BZ,PZ)),e}function XZ(e){var t=Math.trunc(Number(e));if(Number.isSafeInteger(t))return String(t);if(-1!==(t=e.indexOf("."))&&(e=e.substring(0,t)),!("-"===e[0]?e.length<20||20===e.length&&Number(e.substring(0,7))>-922337:e.length<19||19===e.length&&Number(e.substring(0,6))<922337))if(zZ(e),e=BZ,2147483648&(t=PZ))if(GJ())e=""+(BigInt(0|t)<<BigInt(32)|BigInt(e>>>0));else{const[n,r]=GZ(e,t);e="-"+UZ(n,r)}else e=UZ(e,t);return e}function $Z(e){return null==e?e:"bigint"==typeof e?(bZ(e)?e=Number(e):(e=BigInt.asIntN(64,e),e=bZ(e)?Number(e):String(e)),e):jZ(e)?"number"==typeof e?qZ(e):XZ(e):void 0}function JZ(e){if("string"!=typeof e)throw Error();return e}function ZZ(e){if(null!=e&&"string"!=typeof e)throw Error();return e}function e0(e){return null==e||"string"==typeof e?e:void 0}function t0(e,t,n,r){if(null!=e&&"object"==typeof e&&e.Y===sZ)return e;if(!Array.isArray(e))return n?2&r?(e=t[WJ])?t=e:(tZ((e=new t).u),t=t[WJ]=e):t=new t:t=void 0,t;let i=n=JJ(e);return 0===i&&(i|=32&r),i|=2&r,i!==n&&eZ(e,i),new t(e)}function n0(e,t,n){if(t)e:{if(!jZ(t=e))throw zJ("int64");switch(typeof t){case"string":t=XZ(t);break e;case"bigint":if(e=t=BigInt.asIntN(64,t),EZ(e)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(e))throw Error(String(e))}else if(yZ(e)&&!Number.isSafeInteger(e))throw Error(String(e));t=xZ?BigInt(t):_Z(t)?t?"1":"0":EZ(t)?t.trim()||"0":String(t);break e;default:t=qZ(t)}}else t=$Z(e);return"string"==typeof(n=null==(e=t)?n?0:void 0:e)&&(t=+n,Number.isSafeInteger(t))?t:n}function r0(e){if(void 0===a0&&(a0="function"==typeof Proxy?p0(Proxy):null),!a0||!f0())return e;let t=i0?.get(e);return t||(Math.random()>.01?e:(function(e){if(void 0===l0){const e=new a0([],{});l0=1===Array.prototype.concat.call([],e).length}l0&&"function"==typeof Symbol&&Symbol.isConcatSpreadable&&(e[Symbol.isConcatSpreadable]=!0)}(e),t=new a0(e,{set:(e,t,n)=>(NJ(),e[t]=n,!0)}),function(e,t){(i0||=new o0).set(e,t),(s0||=new o0).set(t,e)}(e,t),t))}let i0,s0,a0,o0,l0,c0,u0,h0,d0;function f0(){return void 0===o0&&(o0="function"==typeof WeakMap?p0(WeakMap):null),o0}function p0(e){try{return-1!==e.toString().indexOf("[native code]")?e:null}catch{return null}}function m0(e,t,n){if(hJ&&f0()){if(c0?.get(t)?.get(e)){if(n)return}else if(Math.random()>.01)return;var r=e.length;n={length:r};for(var i=0;i<Math.min(r,10);i++){if(r<=10)var s=i;else{s=r/10;const e=Math.floor(i*s);s=e+Math.floor(Math.random()*(Math.floor((i+1)*s)-e))}n[s]=e[s]}A0(e,n)?((i=(r=c0||=new o0).get(t))||(i=new o0,r.set(t,i)),i.set(e,n)):(NJ(),y0(e,t))}}function g0(e,t){const n=c0?.get(t)?.get(e);n&&!A0(e,n)&&(NJ(),y0(e,t))}function A0(e,t){if(e.length!==t.length)return!1;for(const i in t){var n,r=Number(i);if((n=Number.isInteger(r))&&(n=e[r],r=t[r],n=!(Number.isNaN(n)?Number.isNaN(r):n===r)),n)return!1}return!0}function v0(e){if(e&&c0?.has(e)){var t=e.u;if(t)for(let n=0;n<t.length;n++){const r=t[n];if(n===t.length-1&&lZ(r))for(const t in r){const n=r[t];Array.isArray(n)&&g0(n,e)}else Array.isArray(r)&&g0(r,e)}}}function y0(e,t){c0?.get(t)?.delete(e)}function E0(e,t){return e=_0(e,t[0],t[1]),XJ(e,16384),e}function _0(e,t,n){if(null==e&&(e=u0),u0=void 0,null==e){var r=96;n?(e=[n],r|=512):e=[],t&&(r=-33521665&r|(1023&t)<<15)}else{if(!Array.isArray(e))throw Error("narr");if(2048&(r=JJ(e)))throw Error("farr");if(64&r)return e;if(r|=64,n&&(r|=512,n!==e[0]))throw Error("mid");e:{const i=(n=e).length;if(i){const e=i-1;if(lZ(n[e])){if((t=e-(+!!(512&(r|=256))-1))>=1024)throw Error("pvtlmt");r=-33521665&r|(1023&t)<<15;break e}}if(t){if((t=Math.max(t,i-(+!!(512&r)-1)))>1024)throw Error("spvt");r=-33521665&r|(1023&t)<<15}}}return eZ(e,r),e}const x0={};let b0=function(){try{return vJ(new class extends Map{constructor(){super()}}),!1}catch{return!0}}();class S0{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,t){return this.g.set(e,t),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}[Symbol.iterator](){return this.entries()}}const w0=b0?(Object.setPrototypeOf(S0.prototype,Map.prototype),Object.defineProperties(S0.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),S0):class extends Map{constructor(){super()}};function C0(e){return e}function T0(e){if(2&e.M)throw Error("Cannot mutate an immutable Map")}var M0=class extends w0{constructor(e,t,n=C0,r=C0){super();let i=JJ(e);i|=64,eZ(e,i),this.M=i,this.U=t,this.T=n,this.aa=this.U?I0:r;for(let s=0;s<e.length;s++){const a=e[s],o=n(a[0],!1,!0);let l=a[1];t?void 0===l&&(l=null):l=r(a[1],!1,!0,void 0,void 0,i),super.set(o,l)}}pa(e=R0){if(0!==this.size)return this.Z(e)}Z(e=R0){const t=[],n=super.entries();for(var r;!(r=n.next()).done;)(r=r.value)[0]=e(r[0]),r[1]=e(r[1]),t.push(r);return t}clear(){T0(this),super.clear()}delete(e){return T0(this),super.delete(this.T(e,!0,!1))}entries(){var e=this.oa();return new fZ(e,B0,this)}keys(){return this.Ka()}values(){var e=this.oa();return new fZ(e,M0.prototype.get,this)}forEach(e,t){super.forEach((n,r)=>{e.call(t,this.get(r),r,this)})}set(e,t){return T0(this),null==(e=this.T(e,!0,!1))?this:null==t?(super.delete(e),this):super.set(e,this.aa(t,!0,!0,this.U,!1,this.M))}Qa(e){const t=this.T(e[0],!1,!0);e=e[1],e=this.U?void 0===e?null:e:this.aa(e,!1,!0,void 0,!1,this.M),super.set(t,e)}has(e){return super.has(this.T(e,!1,!1))}get(e){e=this.T(e,!1,!1);const t=super.get(e);if(void 0!==t){var n=this.U;return n?((n=this.aa(t,!1,!0,n,this.va,this.M))!==t&&super.set(e,n),n):t}}oa(){return Array.from(super.keys())}Ka(){return super.keys()}[Symbol.iterator](){return this.entries()}};function I0(e,t,n,r,i,s){return e=t0(e,r,n,s),i&&(e=G0(e)),e}function R0(e){return e}function B0(e){return[e,this.get(e)]}let P0;function D0(){return P0||=new M0(tZ([]),void 0,void 0,void 0,x0)}function L0(e,t,n,r,i){if(null!=e){if(Array.isArray(e))e=uZ(e)?void 0:i&&2&JJ(e)?e:k0(e,t,n,void 0!==r,i);else if(lZ(e)){const s={};for(let a in e)s[a]=L0(e[a],t,n,r,i);e=s}else e=t(e,r);return e}}function k0(e,t,n,r,i){const s=r||n?JJ(e):0;r=r?!!(32&s):void 0;const a=QJ(e);for(let e=0;e<a.length;e++)a[e]=L0(a[e],t,n,r,i);return n&&(mZ(a,e),n(s,a)),a}function F0(e){return L0(e,O0,void 0,void 0,!1)}function O0(e){return e.Y===sZ?e.toJSON():e instanceof M0?e.pa(F0):function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return bZ(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(uZ(e))return}else{if(RJ(e))return wJ(e);if(e instanceof FJ){const t=e.ba;return null==t?"":"string"==typeof t?t:e.ba=wJ(t)}if(e instanceof M0)return e.pa()}}return e}(e)}function U0(e,t,n=rZ){if(null!=e){if(bJ&&e instanceof Uint8Array)return t?e:new Uint8Array(e);if(Array.isArray(e)){var r=JJ(e);return 2&r?e:(t&&=0===r||!!(32&r)&&!(64&r||!(16&r)),t?(eZ(e,-12293&r|34),e):k0(e,U0,4&r?rZ:n,!0,!0))}return e.Y===sZ?(n=e.u,e=2&(r=ZJ(n))?e:N0(e,n,r,!0)):e instanceof M0&&!(2&e.M)&&(n=tZ(e.Z(U0)),e=new M0(n,e.U,e.T,e.aa)),e}}function N0(e,t,n,r){return v0(e),e=e.constructor,u0=t=z0(t,n,r),t=new e(t),u0=void 0,t}function z0(e,t,n){const r=n||2&t?rZ:nZ,i=!!(32&t);return e=function(e,t,n){const r=QJ(e);var i=r.length;const s=256&t?r[i-1]:void 0;for(i+=s?-1:0,t=512&t?1:0;t<i;t++)r[t]=n(r[t]);if(s){t=r[t]={};for(const e in s)t[e]=n(s[e])}return mZ(r,e),r}(e,t,e=>U0(e,i,r)),XJ(e,32|(n?2:0)),e}function G0(e){const t=e.u,n=ZJ(t);return 2&n?N0(e,t,n,!1):e}function Q0(e,t,n,r){return!(4&t&&(null==n||(!r&&0===n&&(4096&t||8192&t)&&(e.constructor[qJ]=1+(0|e.constructor[qJ]))<5&&NJ(),0===n||n&t)))}function H0(e,t){return j0(e=e.u,ZJ(e),t)}function V0(e,t,n,r){if(!((t=r+(+!!(512&t)-1))<0||t>=e.length||t>=n))return e[t]}function j0(e,t,n,r){if(-1===n)return null;const i=t>>15&1023||536870912;if(!(n>=i)){var s=e.length;return r&&256&t&&null!=(r=e[s-1][n])?(V0(e,t,i,n)&&null!=YJ&&((t=(e=UJ??={})[YJ]||0)>=4||(e[YJ]=t+1,NJ())),r):V0(e,t,i,n)}return 256&t?e[e.length-1][n]:void 0}function W0(e,t,n){const r=e.u;let i=ZJ(r);return dZ(i),Y0(r,i,t,n),e}function Y0(e,t,n,r){const i=t>>15&1023||536870912;if(n>=i){let s,a=t;if(256&t)s=e[e.length-1];else{if(null==r)return a;s=e[i+(+!!(512&t)-1)]={},a|=256}return s[n]=r,n<i&&(e[n+(+!!(512&t)-1)]=void 0),a!==t&&eZ(e,a),a}return e[n+(+!!(512&t)-1)]=r,256&t&&n in(e=e[e.length-1])&&delete e[n],t}function K0(e,t,n,r,i){var s=2&t;i=j0(e,t,n,i),Array.isArray(i)||(i=iZ);const a=!(2&r);r=!(1&r);const o=!!(32&t);let l=JJ(i);return 0!==l||!o||s||a?1&l||(l|=1,eZ(i,l)):(l|=33,eZ(i,l)),s?(e=!1,2&l||(tZ(i),e=!!(4&l)),(r||e)&&Object.freeze(i)):(s=!!(2&l)||!!(2048&l),r&&s?(i=QJ(i),s=1,o&&!a&&(s|=32),eZ(i,s),Y0(e,t,n,i)):a&&32&l&&!s&&$J(i,32)),i}function q0(e,t){e=e.u;let n=ZJ(e);const r=j0(e,n,t),i=QZ(r);return null!=i&&i!==r&&Y0(e,n,t,i),i}function X0(e){e=e.u;let t=ZJ(e);const n=j0(e,t,1),r=cZ(n,!0,!!(34&t));return null!=r&&r!==n&&Y0(e,t,1,r),r}function $0(){return void 0===gZ?2:5}function J0(e,t,n,r,i,s){const a=e.u;let o=ZJ(a);r=2&o?1:r,s=!!s,i=Z0(a,o,t,i);var l=JJ(i),c=i;if(g0(c,e),2!==r&&1!==r||y0(c,e),Q0(e,l,void 0,s)){4&l&&(i=QJ(i),l=m1(l,o),o=Y0(a,o,t,i));let e=c=0;for(;c<i.length;c++){const t=n(i[c]);null!=t&&(i[e++]=t)}e<c&&(i.length=e),l=-4097&(l=e1(l,o))|20,eZ(i,l&=-8193),2&l&&Object.freeze(i)}let u;return 1===r||4===r&&32&l?t1(l)||(e=l,(l|=2)!==e&&eZ(i,l),Object.freeze(i)):(n=5===r&&(!!(32&l)||t1(l)||!!i0?.get(i)),(2===r||n)&&t1(l)&&(i=QJ(i),l=g1(l=m1(l,o),o,s),eZ(i,l),o=Y0(a,o,t,i)),t1(l)||(t=l,(l=g1(l,o,s))!==t&&eZ(i,l)),n?(u=r0(i),m0(i,e,!0)):2!==r||s||i0?.delete(i)),u||i}function Z0(e,t,n,r){return e=j0(e,t,n,r),Array.isArray(e)?e:iZ}function e1(e,t){return 0===e&&(e=m1(e,t)),1|e}function t1(e){return!!(2&e)&&!!(4&e)||!!(2048&e)}function n1(e){e=QJ(e);for(let t=0;t<e.length;t++){const n=e[t]=QJ(e[t]);Array.isArray(n[1])&&(n[1]=tZ(n[1]))}return e}function r1(e,t,n,r){e=e.u;let i=ZJ(e);dZ(i),Y0(e,i,t,("0"===r?0===Number(n):n===r)?void 0:n)}function i1(e,t){var n=p4;return o1(s1(e=e.u),e,ZJ(e),n)===t?t:-1}function s1(e){if(HJ)return e[KJ]??(e[KJ]=new Map);if(KJ in e)return e[KJ];const t=new Map;return Object.defineProperty(e,KJ,{value:t}),t}function a1(e,t,n,r){const i=s1(e),s=o1(i,e,t,n);return s!==r&&(s&&(t=Y0(e,t,s)),i.set(n,r)),t}function o1(e,t,n,r){let i=e.get(r);if(null!=i)return i;i=0;for(let e=0;e<r.length;e++){const s=r[e];null!=j0(t,n,s)&&(0!==i&&(n=Y0(t,n,i)),i=s)}return e.set(r,i),i}function l1(e,t,n,r){let i,s=ZJ(e);if(null!=(r=j0(e,s,n,r))&&r.Y===sZ)return(t=G0(r))!==r&&Y0(e,s,n,t),t.u;if(Array.isArray(r)){const e=JJ(r);i=2&e?z0(r,e,!1):r,i=E0(i,t)}else i=E0(void 0,t);return i!==r&&Y0(e,s,n,i),i}function c1(e,t,n,r){e=e.u;let i=ZJ(e);return(t=t0(r=j0(e,i,n,r),t,!1,i))!==r&&null!=t&&Y0(e,i,n,t),t}function u1(e,t,n,r=!1){if(null==(t=c1(e,t,n,r)))return t;if(e=e.u,!(2&(r=ZJ(e)))){const i=G0(t);i!==t&&Y0(e,r,n,t=i)}return t}function h1(e,t,n,r,i,s,a){const o=e.u;var l=!!(2&t);i=l?1:i,s=!!s,a&&=!l,l=Z0(o,t,r);var c=JJ(l),u=l;if(g0(u,e),2!==i&&1!==i||y0(u,e),!(u=!!(4&c))){var h=l,d=t;const e=!!(2&(c=e1(c,t)));e&&(d|=2);let r=!e,i=!0,s=0,a=0;for(;s<h.length;s++){const t=t0(h[s],n,!1,d);if(t instanceof n){if(!e){const e=!!(2&JJ(t.u));r&&=!e,i&&=e}h[a++]=t}}a<s&&(h.length=a),c|=4,c=i?16|c:-17&c,eZ(h,c=r?8|c:-9&c),e&&Object.freeze(h)}if(a&&!(8&c||!l.length&&(1===i||4===i&&32&c))){for(t1(c)?(l=QJ(l),c=m1(c,t),t=Y0(o,t,r,l)):y0(l,e),n=l,a=c,h=0;h<n.length;h++)(c=n[h])!==(d=G0(c))&&(n[h]=d);a|=8,a=n.length?-17&a:16|a,eZ(n,a),c=a}let f;return 1===i||4===i&&32&c?t1(c)||(e=c,(c|=!l.length||16&c&&(!u||32&c)?2:2048)!==e&&eZ(l,c),Object.freeze(l)):(u=5===i&&(!!(32&c)||t1(c)||!!i0?.get(l)),(2===i||u)&&t1(c)&&(l=QJ(l),c=g1(c=m1(c,t),t,s),eZ(l,c),t=Y0(o,t,r,l)),t1(c)||(r=c,(c=g1(c,t,s))!==r&&eZ(l,c)),u?(f=r0(l),m0(l,e,!0)):2!==i||s||i0?.delete(l)),f||l}function d1(e,t,n){const r=ZJ(e.u);return h1(e,r,t,n,$0(),!1,!(2&r))}function f1(e,t,n,r){return null==r&&(r=void 0),W0(e,n,r)}function p1(e,t,n,r){null==r&&(r=void 0);e:{e=e.u;let i=ZJ(e);if(dZ(i),null==r){const r=s1(e);if(o1(r,e,i,n)!==t)break e;r.set(n,0)}else i=a1(e,i,n,t);Y0(e,i,t,r)}}function m1(e,t){return-2049&(2&t?2|e:-3&e)|32}function g1(e,t,n){return 32&t&&n||(e&=-33),e}function A1(e,t,n,r){const i=ZJ(e.u);dZ(i),e=h1(e,i,n,t,2,!0),n=null!=r?r:new n,e.push(n),2&JJ(n.u)?$J(e,8):$J(e,16)}function v1(e,t){return e??t}function y1(e,t){return WZ(H0(e,t))}function E1(e,t){return v1(q0(e,t),0)}function _1(e,t){return v1(e0(H0(e,t)),"")}function x1(e,t,n){if(null!=n&&"boolean"!=typeof n)throw e=typeof n,Error(`Expected boolean but got ${"object"!=e?e:n?Array.isArray(n)?"array":e:"null"}: ${n}`);W0(e,t,n)}function b1(e,t,n){if(null!=n){if("number"!=typeof n)throw zJ("int32");if(!Number.isFinite(n))throw zJ("int32");n|=0}W0(e,t,n)}function S1(e,t,n){if(null!=n&&"number"!=typeof n)throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);W0(e,t,n)}function w1(e,t,n){{const o=e.u;let l=ZJ(o);if(dZ(l),null==n)Y0(o,l,t);else{n=s0?.get(n)||n;var r,i=JJ(n),s=i,a=!!(2&i)||Object.isFrozen(n);if((r=!a)&&(r=void 0===AZ||!1),Q0(e,i)){i=21,a&&(n=QJ(n),s=0,i=g1(i=m1(i,l),l,!0));for(let e=0;e<n.length;e++)n[e]=JZ(n[e])}r?(n=QJ(n),s=0,i=g1(i=m1(i,l),l,!0)):a||m0(n,e),i!==s&&eZ(n,i),Y0(o,l,t,n)}}}function C1(e,t,n){dZ(ZJ(e.u)),J0(e,t,e0,2,void 0,!0).push(JZ(n))}function T1(e,t){return Error(`Invalid wire type: ${e} (at position ${t})`)}function M1(){return Error("Failed to read varint, encoding is invalid.")}function I1(e,t){return Error(`Tried to read past the end of the data ${t} > ${e}`)}function R1(e){if("string"==typeof e)return{buffer:IJ(e),O:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),O:!1};if(e.constructor===Uint8Array)return{buffer:e,O:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),O:!1};if(e.constructor===FJ)return{buffer:kJ(e)||new Uint8Array(0),O:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),O:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function B1(e,t){let n,r=0,i=0,s=0;const a=e.h;let o=e.g;do{n=a[o++],r|=(127&n)<<s,s+=7}while(s<32&&128&n);for(s>32&&(i|=(127&n)>>4),s=3;s<32&&128&n;s+=7)n=a[o++],i|=(127&n)<<s;if(N1(e,o),n<128)return t(r>>>0,i>>>0);throw M1()}function P1(e){let t=0,n=e.g;const r=n+10,i=e.h;for(;n<r;){const r=i[n++];if(t|=r,!(128&r))return N1(e,n),!!(127&t)}throw M1()}function D1(e){const t=e.h;let n=e.g,r=t[n++],i=127&r;if(128&r&&(r=t[n++],i|=(127&r)<<7,128&r&&(r=t[n++],i|=(127&r)<<14,128&r&&(r=t[n++],i|=(127&r)<<21,128&r&&(r=t[n++],i|=r<<28,128&r&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++]&&128&t[n++])))))throw M1();return N1(e,n),i}function L1(e){return D1(e)>>>0}function k1(e){var t=e.h;const n=e.g,r=t[n],i=t[n+1],s=t[n+2];return t=t[n+3],N1(e,e.g+4),(r|i<<8|s<<16|t<<24)>>>0}function F1(e){var t=k1(e);e=2*(t>>31)+1;const n=t>>>23&255;return t&=8388607,255==n?t?NaN:e*(1/0):0==n?1401298464324817e-60*e*t:e*Math.pow(2,n-150)*(t+8388608)}function O1(e){return D1(e)}function U1(e,t,{ea:n=!1}={}){e.ea=n,t&&(t=R1(t),e.h=t.buffer,e.m=t.O,e.j=0,e.l=e.h.length,e.g=e.j)}function N1(e,t){if(e.g=t,t>e.l)throw I1(e.l,t)}function z1(e,t){if(t<0)throw Error(`Tried to read a negative byte length: ${t}`);const n=e.g,r=n+t;if(r>e.l)throw I1(t,e.l-n);return e.g=r,n}function G1(e,t){if(0==t)return LJ();var n=z1(e,t);return e.ea&&e.m?n=e.h.subarray(n,n+t):(e=e.h,n=n===(t=n+t)?new Uint8Array(0):IZ?e.slice(n,t):new Uint8Array(e.subarray(n,t))),0==n.length?LJ():new FJ(n,BJ)}M0.prototype.toJSON=void 0,M0.prototype.La=aZ;var Q1=[];function H1(e){var t=e.g;if(t.g==t.l)return!1;e.l=e.g.g;var n=L1(e.g);if(t=n>>>3,!((n&=7)>=0&&n<=5))throw T1(n,e.l);if(t<1)throw Error(`Invalid field number: ${t} (at position ${e.l})`);return e.m=t,e.h=n,!0}function V1(e){switch(e.h){case 0:0!=e.h?V1(e):P1(e.g);break;case 1:N1(e=e.g,e.g+8);break;case 2:if(2!=e.h)V1(e);else{var t=L1(e.g);N1(e=e.g,e.g+t)}break;case 5:N1(e=e.g,e.g+4);break;case 3:for(t=e.m;;){if(!H1(e))throw Error("Unmatched start-group tag: stream EOF");if(4==e.h){if(e.m!=t)throw Error("Unmatched end-group tag");break}V1(e)}break;default:throw T1(e.h,e.l)}}function j1(e,t,n){const r=e.g.l,i=L1(e.g),s=e.g.g+i;let a=s-r;if(a<=0&&(e.g.l=s,n(t,e,void 0,void 0,void 0),a=s-e.g.g),a)throw Error(`Message parsing ended unexpectedly. Expected to read ${i} bytes, instead read ${i-a} bytes, either the data ended unexpectedly or the message misreported its own length`);return e.g.g=s,e.g.l=r,t}function W1(e){var t=L1(e.g),n=z1(e=e.g,t);if(e=e.h,sJ){var r,i=e;(r=iJ)||(r=iJ=new TextDecoder("utf-8",{fatal:!0})),t=n+t,i=0===n&&t===i.length?i:i.subarray(n,t);try{var s=r.decode(i)}catch(e){if(void 0===rJ){try{r.decode(new Uint8Array([128]))}catch(e){}try{r.decode(new Uint8Array([97])),rJ=!0}catch(e){rJ=!1}}throw!rJ&&(iJ=void 0),e}}else{t=(s=n)+t,n=[];let o,l=null;for(;s<t;){var a=e[s++];a<128?n.push(a):a<224?s>=t?tJ():(o=e[s++],a<194||128!=(192&o)?(s--,tJ()):n.push((31&a)<<6|63&o)):a<240?s>=t-1?tJ():(o=e[s++],128!=(192&o)||224===a&&o<160||237===a&&o>=160||128!=(192&(r=e[s++]))?(s--,tJ()):n.push((15&a)<<12|(63&o)<<6|63&r)):a<=244?s>=t-2?tJ():(o=e[s++],128!=(192&o)||o-144+(a<<28)>>30||128!=(192&(r=e[s++]))||128!=(192&(i=e[s++]))?(s--,tJ()):(a=(7&a)<<18|(63&o)<<12|(63&r)<<6|63&i,a-=65536,n.push(55296+(a>>10&1023),56320+(1023&a)))):tJ(),n.length>=8192&&(l=nJ(l,n),n.length=0)}s=nJ(l,n)}return s}function Y1(e){const t=L1(e.g);return G1(e.g,t)}function K1(e,t,n){var r=L1(e.g);for(r=e.g.g+r;e.g.g<r;)n.push(t(e.g))}var q1=[];let X1;function $1(e,t,n){t.g?t.m(e,t.g,t.h,n,!0):t.m(e,t.h,n,!0)}var J1=class{constructor(e,t){this.u=_0(e,t)}toJSON(){return Z1(this)}l(){var e=p5;return e.g?e.l(this,e.g,e.h,!0):e.l(this,e.h,e.defaultValue,!0)}clone(){const e=this.u;return N0(this,e,ZJ(e),!1)}O(){return!!(2&JJ(this.u))}};function Z1(e){v0(e),e=X1?e.u:k0(e.u,O0,void 0,void 0,!1);{var t=!X1;let c=e.length;if(c){var n=e[c-1],r=lZ(n);r?c--:n=void 0;var i=e;if(r){e:{var s,a=n,o=!1;if(a)for(let e in a)isNaN(+e)?(s??={})[e]=a[e]:(r=a[e],Array.isArray(r)&&(uZ(r)||oZ(r)&&0===r.size)&&(r=null),null==r&&(o=!0),null!=r&&((s??={})[e]=r));if(o||(s=a),s)for(let e in s){o=s;break e}o=null}a=null==o?null!=n:o!==n}for(;c>0&&(null==(s=i[c-1])||uZ(s)||oZ(s)&&0===s.size);c--)var l=!0;(i!==e||a||l)&&(t?(l||a||o)&&(i.length=c):i=Array.prototype.slice.call(i,0,c),o&&i.push(o)),l=i}else l=e}return l}function e2(e){return e?/^\d+$/.test(e)?(zZ(e),new t2(BZ,PZ)):null:n2||=new t2(0,0)}J1.prototype.Y=sZ,J1.prototype.toString=function(){try{return X1=!0,Z1(this).toString()}finally{X1=!1}};var t2=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let n2;function r2(e){return e?/^-?\d+$/.test(e)?(zZ(e),new i2(BZ,PZ)):null:s2||=new i2(0,0)}var i2=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let s2;function a2(e,t,n){for(;n>0||t>127;)e.g.push(127&t|128),t=(t>>>7|n<<25)>>>0,n>>>=7;e.g.push(t)}function o2(e,t){for(;t>127;)e.g.push(127&t|128),t>>>=7;e.g.push(t)}function l2(e,t){if(t>=0)o2(e,t);else{for(let n=0;n<9;n++)e.g.push(127&t|128),t>>=7;e.g.push(1)}}function c2(e,t){e.g.push(t>>>0&255),e.g.push(t>>>8&255),e.g.push(t>>>16&255),e.g.push(t>>>24&255)}function u2(e,t){0!==t.length&&(e.l.push(t),e.h+=t.length)}function h2(e,t,n){o2(e.g,8*t+n)}function d2(e,t){return h2(e,t,2),t=e.g.end(),u2(e,t),t.push(e.h),t}function f2(e,t){var n=t.pop();for(n=e.h+e.g.length()-n;n>127;)t.push(127&n|128),n>>>=7,e.h++;t.push(n),e.h++}function p2(e,t,n){h2(e,t,2),o2(e.g,n.length),u2(e,e.g.end()),u2(e,n)}function m2(e,t,n,r){null!=n&&(t=d2(e,t),r(n,e),f2(e,t))}class g2{constructor(e,t,n){this.g=e,this.h=t,this.qa=n}}function A2(e){return Array.isArray(e)?e[0]instanceof g2?e:[h3,e]:[e,void 0]}function v2(e,t){if(Array.isArray(t)){var n=JJ(t);if(4&n)return t;for(var r=0,i=0;r<t.length;r++){const n=e(t[r]);null!=n&&(t[i++]=n)}return i<r&&(t.length=i),eZ(t,-12289&n|5),2&n&&Object.freeze(t),t}}const y2=Symbol();function E2(e){let t=e[y2];if(!t){const n=D2(e),r=n.h;t=r?(e,t)=>r(e,t,n):(e,t)=>{for(;H1(t)&&4!=t.h;){var r=t.m;let a=n[r];const o=!a;let l=!1;if(!a){var i=n.X;if(i){var s=i[r];s&&(l=i.P?.[r],(!dJ||l)&&(i=_2(s))&&(a=n[r]=i))}}a&&a(t,e,r)||(r=(i=t).l,V1(i),i.ja?i=void 0:(s=i.g.g-r,i.g.g=r,i=G1(i.g,s)),r=e,i&&(pZ||=Symbol(),(s=r[pZ])?s.push(i):r[pZ]=[i])),o&&a&&!l&&G2++<5&&NJ()}},e[y2]=t}return t}function _2(e){const t=(e=A2(e))[0].g;if(e=e[1]){const n=E2(e),r=D2(e).g;return(e,i,s)=>t(e,i,s,r,n)}return t}function x2(e,t,n){e[t]=n}function b2(e,t,n,r){var i=x2;t.g=function(e){switch(typeof e){case"boolean":return h0||=[0,void 0,!0];case"number":return e>0?void 0:0===e?d0||=[0,void 0]:[-e,void 0];case"string":return[0,e];case"object":return e}}(e[0]);let s=0;var a=e[++s];a&&a.constructor===Object&&(t.X=a,"function"==typeof(a=e[++s])&&(t.h=a,t.l=e[++s],a=e[++s]));const o={};for(;Array.isArray(a)&&"number"==typeof a[0]&&a[0]>0;){for(var l=0;l<a.length;l++)o[a[l]]=a;a=e[++s]}for(l=1;void 0!==a;){let h;"number"==typeof a&&(l+=a,a=e[++s]);var c=void 0;if(a instanceof g2?h=a:(h=d3,s--),h.qa){a=e[++s],c=e;var u=s;"function"==typeof a&&(a=a(),c[u]=a),c=a}for(u=l+1,"number"==typeof(a=e[++s])&&a<0&&(u-=a,a=e[++s]);l<u;l++){const e=o[l];i(t,l,c?r(h,c,e):n(h,e))}}return t}const S2=Symbol();function w2(e){let t=e[S2];if(!t){const n=I2(e);t=(e,t)=>k2(e,t,n),e[S2]=t}return t}const C2=Symbol();function T2(e){return e.h}function M2(e,t){let n,r;const i=e.h;return(e,s,a)=>i(e,s,a,r||=I2(t).g,n||=w2(t))}function I2(e){let t=e[C2];return t||b2(e,e[C2]={},T2,M2)}const R2=Symbol();function B2(e,t){const n=e.g;return t?(e,r,i)=>n(e,r,i,t):n}function P2(e,t,n){const r=e.g;let i,s;return(e,a,o)=>r(e,a,o,s||=D2(t).g,i||=E2(t),n)}function D2(e){let t=e[R2];return t||b2(e,e[R2]={},B2,P2)}function L2(e,t){var n=e[t];if(n)return n;if(n=e.X){var r=n[t];if(r){var i=(r=A2(r))[0].h;if(r=r[1],n=n.P?.[t],!dJ||n){if(r){const t=w2(r),s=I2(r).g;n=(n=e.l)?n(s,t):(e,n,r)=>i(e,n,r,s,t)}else n=i;return e[t]=n}}}}function k2(e,t,n){for(var r=ZJ(e),i=+!!(512&r)-1,s=e.length,a=512&r?1:0,o=s+(256&r?-1:0);a<o;a++){const r=e[a];if(null==r)continue;const s=a-i,o=L2(n,s);if(!o)continue;const l=n.X;l?.[s]&&!l?.P?.[s]&&G2++<5&&NJ(),o(t,r,s)}if(256&r){r=e[s-1];for(let e in r)i=+e,!Number.isNaN(i)&&null!=(s=r[e])&&(o=L2(n,i))&&((a=n.X)?.[i]&&!a?.P?.[i]&&G2++<5&&NJ(),o(t,s,i))}if(e=pZ?e[pZ]:void 0)for(u2(t,t.g.end()),n=0;n<e.length;n++)u2(t,kJ(e[n])||new Uint8Array(0))}function F2(e,t){return new g2(e,t,!1)}function O2(e,t){return new g2(e,t,!1)}function U2(e,t){return new g2(e,t,!0)}function N2(e,t,n){Y0(e,ZJ(e),t,n)}var z2=U2(function(e,t,n,r,i){return 2===e.h&&(e=j1(e,E0([void 0,void 0],r),i),dZ(r=ZJ(t)),(i=j0(t,r,n))instanceof M0?2&i.M?((i=i.Z()).push(e),Y0(t,r,n,i)):i.Qa(e):Array.isArray(i)?(2&JJ(i)&&Y0(t,r,n,i=n1(i)),i.push(e)):Y0(t,r,n,[e]),!0)},function(e,t,n,r,i){if(t instanceof M0)t.forEach((t,s)=>{m2(e,n,E0([s,t],r),i)});else if(Array.isArray(t))for(let s=0;s<t.length;s++){const a=t[s];Array.isArray(a)&&m2(e,n,E0(a,r),i)}});let G2=0;function Q2(e,t,n){if(t=function(e){if(null==e)return e;const t=typeof e;if("bigint"===t)return String(BigInt.asIntN(64,e));if(jZ(e)){if("string"===t)return XZ(e);if("number"===t)return qZ(e)}}(t),null!=t&&("string"==typeof t&&r2(t),null!=t))switch(h2(e,n,0),typeof t){case"number":e=e.g,LZ(t),a2(e,BZ,PZ);break;case"bigint":n=BigInt.asUintN(64,t),n=new i2(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),a2(e.g,n.h,n.g);break;default:n=r2(t),a2(e.g,n.h,n.g)}}function H2(e,t,n){null!=(t=WZ(t))&&null!=t&&(h2(e,n,0),l2(e.g,t))}function V2(e,t,n){null!=(t=HZ(t))&&(h2(e,n,0),e.g.g.push(t?1:0))}function j2(e,t,n){null!=(t=e0(t))&&p2(e,n,lJ(t))}function W2(e,t,n,r,i){t instanceof J1?(v0(t),t=t.u):t=Array.isArray(t)?E0(t,r):void 0,m2(e,n,t,i)}function Y2(e,t,n){null!=(t=null==t||"string"==typeof t||RJ(t)||t instanceof FJ?t:void 0)&&p2(e,n,R1(t).buffer)}function K2(e,t,n){return(5===e.h||2===e.h)&&(t=K0(t,ZJ(t),n,2,!1),2==e.h?K1(e,F1,t):t.push(F1(e.g)),!0)}var q2,X2=F2(function(e,t,n){if(1!==e.h)return!1;var r=e.g;e=k1(r);const i=k1(r);r=2*(i>>31)+1;const s=i>>>20&2047;return e=4294967296*(1048575&i)+e,N2(t,n,2047==s?e?NaN:r*(1/0):0==s?5e-324*r*e:r*Math.pow(2,s-1075)*(e+4503599627370496)),!0},function(e,t,n){null!=(t=QZ(t))&&(h2(e,n,1),e=e.g,(n=RZ||=new DataView(new ArrayBuffer(8))).setFloat64(0,+t,!0),BZ=n.getUint32(0,!0),PZ=n.getUint32(4,!0),c2(e,BZ),c2(e,PZ))}),$2=F2(function(e,t,n){return 5===e.h&&(N2(t,n,F1(e.g)),!0)},function(e,t,n){null!=(t=QZ(t))&&(h2(e,n,5),e=e.g,kZ(t),c2(e,BZ))}),J2=O2(K2,function(e,t,n){if(null!=(t=v2(QZ,t)))for(let a=0;a<t.length;a++){var r=e,i=n,s=t[a];null!=s&&(h2(r,i,5),r=r.g,kZ(s),c2(r,BZ))}}),Z2=O2(K2,function(e,t,n){if(null!=(t=v2(QZ,t))&&t.length){h2(e,n,2),o2(e.g,4*t.length);for(let r=0;r<t.length;r++)n=e.g,kZ(t[r]),c2(n,BZ)}}),e3=F2(function(e,t,n){return 0===e.h&&(N2(t,n,B1(e.g,OZ)),!0)},Q2),t3=F2(function(e,t,n){return 0===e.h&&(N2(t,n,0===(e=B1(e.g,OZ))?void 0:e),!0)},Q2),n3=F2(function(e,t,n){return 0===e.h&&(N2(t,n,B1(e.g,FZ)),!0)},function(e,t,n){if(null!=(t=function(e){if(null==e)return e;var t=typeof e;if("bigint"===t)return String(BigInt.asUintN(64,e));if(jZ(e)){if("string"===t)return t=Math.trunc(Number(e)),Number.isSafeInteger(t)&&t>=0?e=String(t):(-1!==(t=e.indexOf("."))&&(e=e.substring(0,t)),KZ(e)||(zZ(e),e=UZ(BZ,PZ))),e;if("number"===t)return(e=Math.trunc(e))>=0&&Number.isSafeInteger(e)?e:function(e){if(e<0){LZ(e);const t=UZ(BZ,PZ);return e=Number(t),Number.isSafeInteger(e)?e:t}return KZ(String(e))?e:(LZ(e),FZ(BZ,PZ))}(e)}}(t))&&("string"==typeof t&&e2(t),null!=t))switch(h2(e,n,0),typeof t){case"number":e=e.g,LZ(t),a2(e,BZ,PZ);break;case"bigint":n=BigInt.asUintN(64,t),n=new t2(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),a2(e.g,n.h,n.g);break;default:n=e2(t),a2(e.g,n.h,n.g)}}),r3=F2(function(e,t,n){return 0===e.h&&(N2(t,n,D1(e.g)),!0)},H2),i3=O2(function(e,t,n){return(0===e.h||2===e.h)&&(t=K0(t,ZJ(t),n,2,!1),2==e.h?K1(e,D1,t):t.push(D1(e.g)),!0)},function(e,t,n){if(null!=(t=v2(WZ,t))&&t.length){n=d2(e,n);for(let n=0;n<t.length;n++)l2(e.g,t[n]);f2(e,n)}}),s3=F2(function(e,t,n){return 0===e.h&&(N2(t,n,0===(e=D1(e.g))?void 0:e),!0)},H2),a3=F2(function(e,t,n){return 0===e.h&&(N2(t,n,P1(e.g)),!0)},V2),o3=F2(function(e,t,n){return 0===e.h&&(N2(t,n,!1===(e=P1(e.g))?void 0:e),!0)},V2),l3=O2(function(e,t,n){if(2!==e.h)return!1;e=W1(e);const r=ZJ(t);return dZ(r),K0(t,r,n,2).push(e),!0},function(e,t,n){if(null!=(t=v2(e0,t)))for(let a=0;a<t.length;a++){var r=e,i=n,s=t[a];null!=s&&p2(r,i,lJ(s))}}),c3=F2(function(e,t,n){return 2===e.h&&(N2(t,n,""===(e=W1(e))?void 0:e),!0)},j2),u3=F2(function(e,t,n){return 2===e.h&&(N2(t,n,W1(e)),!0)},j2),h3=U2(function(e,t,n,r,i){return 2===e.h&&(j1(e,l1(t,r,n,!0),i),!0)},W2),d3=U2(function(e,t,n,r,i){return 2===e.h&&(j1(e,l1(t,r,n),i),!0)},W2);q2=new g2(function(e,t,n,r,i){if(2!==e.h)return!1;r=E0(void 0,r);let s=ZJ(t);dZ(s);let a=K0(t,s,n,3);return s=ZJ(t),4&JJ(a)&&(a=QJ(a),eZ(a,-2079&JJ(a)|1),Y0(t,s,n,a)),a.push(r),j1(e,r,i),!0},function(e,t,n,r,i){if(Array.isArray(t))for(let s=0;s<t.length;s++)W2(e,t[s],n,r,i)},!0);var f3=U2(function(e,t,n,r,i,s){return 2===e.h&&(a1(t,ZJ(t),s,n),j1(e,t=l1(t,r,n),i),!0)},W2),p3=F2(function(e,t,n){return 2===e.h&&(N2(t,n,Y1(e)),!0)},Y2),m3=O2(function(e,t,n){return(0===e.h||2===e.h)&&(t=K0(t,ZJ(t),n,2,!1),2==e.h?K1(e,L1,t):t.push(L1(e.g)),!0)},function(e,t,n){if(null!=(t=v2(YZ,t)))for(let a=0;a<t.length;a++){var r=e,i=n,s=t[a];null!=s&&(h2(r,i,0),o2(r.g,s))}}),g3=F2(function(e,t,n){return 0===e.h&&(N2(t,n,D1(e.g)),!0)},function(e,t,n){null!=(t=WZ(t))&&(t=parseInt(t,10),h2(e,n,0),l2(e.g,t))});class A3{constructor(e,t){this.h=e,this.g=t,this.l=u1,this.m=f1,this.defaultValue=void 0}}function v3(e,t){return new A3(e,t)}function y3(e,t){return(n,r)=>{if(q1.length){const e=q1.pop();e.o(r),U1(e.g,n,r),n=e}else n=new class{constructor(e,t){if(Q1.length){const n=Q1.pop();U1(n,e,t),e=n}else e=new class{constructor(e,t){this.h=null,this.m=!1,this.g=this.l=this.j=0,U1(this,e,t)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ea=!1}}(e,t);this.g=e,this.l=this.g.g,this.h=this.m=-1,this.o(t)}o({ja:e=!1}={}){this.ja=e}}(n,r);try{const r=new e,s=r.u;E2(t)(s,n);var i=r}finally{n.g.clear(),n.m=-1,n.h=-1,q1.length<100&&q1.push(n)}return i}}function E3(e){return function(){v0(this);const t=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const e=this.g;return this.g=[],e}}}};k2(this.u,t,I2(e)),u2(t,t.g.end());const n=new Uint8Array(t.h),r=t.l,i=r.length;let s=0;for(let e=0;e<i;e++){const t=r[e];n.set(t,s),s+=t.length}return t.l=[n],n}}var _3=class extends J1{constructor(e){super(e)}},x3=[0,c3,F2(function(e,t,n){return 2===e.h&&(N2(t,n,(e=Y1(e))===LJ()?void 0:e),!0)},function(e,t,n){if(null!=t){if(t instanceof J1){const r=t.Ta;return void(r&&(t=r(t),null!=t&&p2(e,n,R1(t).buffer)))}if(Array.isArray(t))return}Y2(e,t,n)})],b3=[0,r3,g3,a3,-1,i3,g3,-1],S3=class extends J1{constructor(){super()}},w3=[0,a3,u3,a3,g3,-1,O2(function(e,t,n){return(0===e.h||2===e.h)&&(t=K0(t,ZJ(t),n,2,!1),2==e.h?K1(e,O1,t):t.push(D1(e.g)),!0)},function(e,t,n){if(null!=(t=v2(WZ,t))&&t.length){n=d2(e,n);for(let n=0;n<t.length;n++)l2(e.g,t[n]);f2(e,n)}}),u3,-1,[0,a3,-1],g3,a3,-1],C3=[0,u3,-2],T3=class extends J1{constructor(){super()}},M3=[0],I3=[0,r3,a3,1,a3,-3],R3=[0,u3,a3,-1,r3,[0,[1,2,3,4,5,6,7],f3,M3,f3,w3,f3,C3,f3,I3,f3,b3,f3,[0,u3,-2],f3,[0,u3,g3]],[0,u3],a3,[0,[1,3],[2,4],f3,[0,i3],-1,f3,[0,l3],-1,q2,[0,u3,-1]],u3],B3=class extends J1{constructor(e){super(e,2)}},P3={},D3=P3.P={};P3[336783863]=R3,D3[336783863]=1;var L3=[0,t3,-1,o3,-3,t3,i3,c3,s3,t3,-1,o3,s3,o3,-2,c3];function k3(e,t){r1(e,2,ZZ(t),"")}function F3(e,t){C1(e,3,t)}function O3(e,t){C1(e,4,t)}var U3=class extends J1{constructor(e){super(e,500)}o(e){return f1(this,0,7,e)}},N3=[-1,{P:{}}],z3=[0,u3,1,N3],G3=[0,u3,l3,N3];function Q3(e,t){A1(e,1,U3,t)}function H3(e,t){C1(e,10,t)}function V3(e,t){C1(e,15,t)}var j3=class extends J1{constructor(e){super(e,500)}o(e){return f1(this,0,1001,e)}},W3=[-500,q2,[-500,c3,-1,l3,-3,[-2,P3,a3],q2,x3,s3,-1,z3,G3,q2,[0,c3,o3],c3,L3,s3,l3,987,l3],4,q2,[-500,u3,-1,[-1,{P:{}}],998,u3],q2,[-500,u3,l3,-1,[-2,{P:{}},a3],997,l3,-1],s3,q2,[-500,u3,l3,N3,998,l3],l3,s3,z3,G3,q2,[0,c3,-1,N3],l3,-2,L3,c3,-1,o3,979,N3,q2,x3];j3.prototype.g=E3(W3);var Y3=y3(j3,W3),K3=class extends J1{constructor(e){super(e)}},q3=class extends J1{constructor(e){super(e)}g(){return d1(this,K3,1)}},X3=[0,q2,[0,r3,$2,u3,-1]],$3=y3(q3,X3),J3=class extends J1{constructor(e){super(e)}},Z3=class extends J1{constructor(e){super(e)}},e4=class extends J1{constructor(e){super(e)}h(){return u1(this,J3,2)}g(){return d1(this,Z3,5)}},t4=y3(class extends J1{constructor(e){super(e)}},[0,l3,i3,Z2,[0,g3,[0,r3,-3],[0,$2,-3],[0,r3,-1,[0,q2,[0,r3,-2]]],q2,[0,$2,-1,u3,$2]],u3,-1,e3,q2,[0,r3,$2],l3,e3]),n4=class extends J1{constructor(e){super(e)}},r4=y3(class extends J1{constructor(e){super(e)}},[0,q2,[0,$2,-4]]),i4=class extends J1{constructor(e){super(e)}},s4=y3(class extends J1{constructor(e){super(e)}},[0,q2,[0,$2,-4]]),a4=class extends J1{constructor(e){super(e)}},o4=[0,r3,-1,Z2,g3],l4=class extends J1{constructor(){super()}};l4.prototype.g=E3([0,$2,-4,e3]);var c4=class extends J1{constructor(e){super(e)}},u4=y3(class extends J1{constructor(e){super(e)}},[0,q2,[0,1,r3,u3,X3],e3]),h4=class extends J1{constructor(e){super(e)}},d4=class extends J1{constructor(e){super(e)}ra(){const e=X0(this);return null==e?LJ():e}},f4=class extends J1{constructor(e){super(e)}},p4=[1,2],m4=y3(class extends J1{constructor(e){super(e)}},[0,q2,[0,p4,f3,[0,Z2],f3,[0,p3],r3,u3],e3]),g4=class extends J1{constructor(e){super(e)}},A4=[0,u3,r3,$2,l3,-1],v4=class extends J1{constructor(e){super(e)}},y4=[0,a3,-1],E4=class extends J1{constructor(e){super(e)}},_4=[1,2,3,4,5],x4=class extends J1{constructor(e){super(e)}g(){return null!=X0(this)}h(){return null!=e0(H0(this,2))}},b4=class extends J1{constructor(e){super(e)}g(){return HZ(H0(this,2))??!1}},S4=[0,p3,u3,[0,r3,e3,-1],[0,n3,e3]],w4=[0,S4,a3,[0,_4,f3,I3,f3,w3,f3,b3,f3,M3,f3,C3],g3],C4=class extends J1{constructor(e){super(e)}},T4=[0,w4,$2,-1,r3],M4=v3(502141897,C4);P3[502141897]=T4,D3[502141897]=1;var I4=[0,S4];P3[512499200]=I4;var R4=[0,I4];P3[515723506]=R4;var B4=y3(class extends J1{constructor(e){super(e)}},[0,[0,g3,-1,J2,m3],o4]),P4=[0,w4];P3[508981768]=P4;var D4=class extends J1{constructor(e){super(e)}},L4=class extends J1{constructor(e){super(e)}},k4=[0,w4,$2,P4,a3],F4=[0,w4,T4,k4,$2,R4];P3[508968149]=k4;var O4=v3(508968150,L4);P3[508968150]=F4,D3[508968150]=1,D3[508968149]=1;var U4=class extends J1{constructor(e){super(e)}},N4=v3(513916220,U4);P3[513916220]=[0,w4,F4,r3],D3[513916220]=1;var z4=class extends J1{constructor(e){super(e)}h(){return u1(this,g4,2)}g(){W0(this,2)}},G4=[0,w4,A4];P3[478825465]=G4,D3[478825465]=1;var Q4=[0,w4];P3[478825422]=Q4;var H4=class extends J1{constructor(e){super(e)}},V4=class extends J1{constructor(e){super(e)}},j4=class extends J1{constructor(e){super(e)}},W4=class extends J1{constructor(e){super(e)}},Y4=class extends J1{constructor(e){super(e)}},K4=[0,w4,Q4,G4,-1],q4=[0,w4,$2,r3],X4=[0,w4,$2],$4=[0,w4,q4,X4,$2],J4=[0,w4,$4,K4];P3[463370452]=K4,P3[464864288]=q4,P3[474472470]=X4;var Z4=v3(462713202,W4);P3[462713202]=$4;var e5=v3(479097054,Y4);P3[479097054]=J4,D3[479097054]=1,D3[463370452]=1,D3[464864288]=1,D3[462713202]=1,D3[474472470]=1;var t5=class extends J1{constructor(e){super(e)}},n5=class extends J1{constructor(e){super(e)}},r5=class extends J1{constructor(e){super(e)}},i5=class extends J1{constructor(){super()}},s5=[0,w4,$2,-1,r3],a5=[0,w4,$2,a3];i5.prototype.g=E3([0,w4,X4,[0,w4],T4,k4,s5,a5]),P3[514774813]=s5,P3[518928384]=a5;var o5=class extends J1{constructor(e){super(e)}},l5=v3(456383383,o5);P3[456383383]=[0,w4,A4],D3[456383383]=1;var c5=class extends J1{constructor(e){super(e)}},u5=v3(476348187,c5);P3[476348187]=[0,w4,y4],D3[476348187]=1;var h5=class extends J1{constructor(e){super(e)}},d5=class extends J1{constructor(e){super(e)}},f5=[0,g3,-1],p5=v3(458105876,class extends J1{constructor(e){super(e)}g(){var e=this.u;const t=ZJ(e),n=2&t;return e=function(e,t,n){var r=d5;const i=2&t;let s=!1;if(null==n){if(i)return D0();n=[]}else if(n.constructor===M0){if(!(2&n.M)||i)return n;n=n.Z()}else Array.isArray(n)?s=!!(2&JJ(n)):n=[];if(i){if(!n.length)return D0();s||(s=!0,tZ(n))}else s&&(s=!1,n=n1(n));return s||(64&JJ(n)?$J(n,32):32&t&&XJ(n,32)),Y0(e,t,2,r=new M0(n,r,n0,void 0)),r}(e,t,j0(e,t,2)),!n&&d5&&(e.va=!0),e}});P3[458105876]=[0,f5,z2,[!0,e3,[0,u3,-1,l3]]],D3[458105876]=1;var m5=class extends J1{constructor(e){super(e)}},g5=v3(458105758,m5);P3[458105758]=[0,w4,u3,f5],D3[458105758]=1;var A5=class extends J1{constructor(e){super(e)}},v5=v3(443442058,A5);P3[443442058]=[0,w4,u3,r3,$2,l3,-1],D3[443442058]=1,D3[514774813]=1;var y5=class extends J1{constructor(e){super(e)}},E5=v3(516587230,y5);function _5(e,t){return t=t?t.clone():new g4,void 0!==e.displayNamesLocale?W0(t,1,ZZ(e.displayNamesLocale)):void 0===e.displayNamesLocale&&W0(t,1),void 0!==e.maxResults?b1(t,2,e.maxResults):"maxResults"in e&&W0(t,2),void 0!==e.scoreThreshold?S1(t,3,e.scoreThreshold):"scoreThreshold"in e&&W0(t,3),void 0!==e.categoryAllowlist?w1(t,4,e.categoryAllowlist):"categoryAllowlist"in e&&W0(t,4),void 0!==e.categoryDenylist?w1(t,5,e.categoryDenylist):"categoryDenylist"in e&&W0(t,5),t}function x5(e,t=-1,n=""){return{categories:e.map(e=>({index:v1(y1(e,1),0)??-1,score:E1(e,2)??0,categoryName:_1(e,3)??"",displayName:_1(e,4)??""})),headIndex:t,headName:n}}function b5(e){var t=J0(e,3,QZ,$0()),n=J0(e,2,WZ,$0()),r=J0(e,1,e0,$0()),i=J0(e,9,e0,$0());const s={categories:[],keypoints:[]};for(let e=0;e<t.length;e++)s.categories.push({score:t[e],index:n[e]??-1,categoryName:r[e]??"",displayName:i[e]??""});if((t=u1(e,e4,4)?.h())&&(s.boundingBox={originX:y1(t,1)??0,originY:y1(t,2)??0,width:y1(t,3)??0,height:y1(t,4)??0,angle:0}),u1(e,e4,4)?.g().length)for(const t of u1(e,e4,4).g())s.keypoints.push({x:q0(t,1)??0,y:q0(t,2)??0,score:q0(t,4)??0,label:e0(H0(t,3))??""});return s}function S5(e){const t=[];for(const n of d1(e,i4,1))t.push({x:E1(n,1)??0,y:E1(n,2)??0,z:E1(n,3)??0,visibility:E1(n,4)??0});return t}function w5(e){const t=[];for(const n of d1(e,n4,1))t.push({x:E1(n,1)??0,y:E1(n,2)??0,z:E1(n,3)??0,visibility:E1(n,4)??0});return t}function C5(e){return Array.from(e,e=>e>127?e-256:e)}function T5(e,t){if(e.length!==t.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${e.length} vs. ${t.length}).`);let n=0,r=0,i=0;for(let s=0;s<e.length;s++)n+=e[s]*t[s],r+=e[s]*e[s],i+=t[s]*t[s];if(r<=0||i<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(r*i)}let M5;P3[516587230]=[0,w4,s5,a5,$2],D3[516587230]=1,D3[518928384]=1;const I5=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function R5(){if(void 0===M5)try{await WebAssembly.instantiate(I5),M5=!0}catch{M5=!1}return M5}async function B5(e,t=""){const n=await R5()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${t}/${e}_${n}.js`,wasmBinaryPath:`${t}/${e}_${n}.wasm`}}var P5=class{};function D5(){var e=navigator;return!("undefined"==typeof OffscreenCanvas||function(e=navigator){return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")}(e)&&!((e=e.userAgent.match(/Version\/([\d]+).*Safari/))&&e.length>=1&&Number(e[1])>=17))}async function L5(e){if("function"!=typeof importScripts){const t=document.createElement("script");return t.src=e.toString(),t.crossOrigin="anonymous",new Promise((e,n)=>{t.addEventListener("load",()=>{e()},!1),t.addEventListener("error",e=>{n(e)},!1),document.body.appendChild(t)})}importScripts(e.toString())}function k5(e){return void 0!==e.videoWidth?[e.videoWidth,e.videoHeight]:void 0!==e.naturalWidth?[e.naturalWidth,e.naturalHeight]:void 0!==e.displayWidth?[e.displayWidth,e.displayHeight]:[e.width,e.height]}function F5(e,t,n){e.m,n(t=e.i.stringToNewUTF8(t)),e.i._free(t)}function O5(e,t,n){if(!e.i.canvas)throw Error("No OpenGL canvas configured.");if(n?e.i._bindTextureToStream(n):e.i._bindTextureToCanvas(),!(n=e.i.canvas.getContext("webgl2")||e.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");e.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),e.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[r,i]=k5(t);return!e.l||r===e.i.canvas.width&&i===e.i.canvas.height||(e.i.canvas.width=r,e.i.canvas.height=i),[r,i]}function U5(e,t,n){e.m;const r=new Uint32Array(t.length);for(let n=0;n<t.length;n++)r[n]=e.i.stringToNewUTF8(t[n]);t=e.i._malloc(4*r.length),e.i.HEAPU32.set(r,t>>2),n(t);for(const t of r)e.i._free(t);e.i._free(t)}function N5(e,t,n){e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=n}function z5(e,t,n){let r=[];e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=(e,t,i)=>{t?(n(r,i),r=[]):r.push(e)}}function G5(e,t){const n=u1(e.baseOptions,x4,1)||new x4;"string"==typeof t?(W0(n,2,ZZ(t)),W0(n,1)):t instanceof Uint8Array&&(W0(n,1,cZ(t,!1,!1)),W0(n,2)),f1(e.baseOptions,0,1,n)}function Q5(e){try{const t=e.H.length;if(1===t)throw Error(e.H[0].message);if(t>1)throw Error("Encountered multiple errors: "+e.H.map(e=>e.message).join(", "))}finally{e.H=[]}}function H5(e,t){e.B=Math.max(e.B,t)}function V5(e,t){e.A=new U3,k3(e.A,"PassThroughCalculator"),F3(e.A,"free_memory"),O3(e.A,"free_memory_unused_out"),H3(t,"free_memory"),Q3(t,e.A)}function j5(e,t){F3(e.A,t),O3(e.A,t+"_unused_out")}function W5(e){e.g.addBoolToStream(!0,"free_memory",e.B)}P5.forVisionTasks=function(e){return B5("vision",e)},P5.forTextTasks=function(e){return B5("text",e)},P5.forGenAiExperimentalTasks=function(e){return B5("genai_experimental",e)},P5.forGenAiTasks=function(e){return B5("genai",e)},P5.forAudioTasks=function(e){return B5("audio",e)},P5.isSimdSupported=function(){return R5()};var Y5=class{constructor(e){this.g=e,this.H=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(e,t=!0){if(t){const t=e.baseOptions||{};if(e.baseOptions?.modelAssetBuffer&&e.baseOptions?.modelAssetPath)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!(u1(this.baseOptions,x4,1)?.g()||u1(this.baseOptions,x4,1)?.h()||e.baseOptions?.modelAssetBuffer||e.baseOptions?.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(e,t){let n=u1(e.baseOptions,E4,3);if(!n){var r=n=new E4,i=new T3;p1(r,4,_4,i)}"delegate"in t&&("GPU"===t.delegate?(t=n,r=new S3,p1(t,2,_4,r)):(t=n,r=new T3,p1(t,4,_4,r))),f1(e.baseOptions,0,3,n)}(this,t),t.modelAssetPath)return fetch(t.modelAssetPath.toString()).then(e=>{if(e.ok)return e.arrayBuffer();throw Error(`Failed to fetch model: ${t.modelAssetPath} (${e.status})`)}).then(e=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(e),!0,!1,!1),G5(this,"/model.dat"),this.m(),this.J()});if(t.modelAssetBuffer instanceof Uint8Array)G5(this,t.modelAssetBuffer);else if(t.modelAssetBuffer)return async function(e){const t=[];for(var n=0;;){const{done:r,value:i}=await e.read();if(r)break;t.push(i),n+=i.length}if(0===t.length)return new Uint8Array(0);if(1===t.length)return t[0];e=new Uint8Array(n),n=0;for(const r of t)e.set(r,n),n+=r.length;return e}(t.modelAssetBuffer).then(e=>{G5(this,e),this.m(),this.J()})}return this.m(),this.J(),Promise.resolve()}J(){}ga(){let e;if(this.g.ga(t=>{e=Y3(t)}),!e)throw Error("Failed to retrieve CalculatorGraphConfig");return e}setGraph(e,t){this.g.attachErrorListener((e,t)=>{this.H.push(Error(t))}),this.g.Oa(),this.g.setGraph(e,t),this.A=void 0,Q5(this)}finishProcessing(){this.g.finishProcessing(),Q5(this)}close(){this.A=void 0,this.g.closeGraph()}};function K5(e,t){if(!e)throw Error(`Unable to obtain required WebGL resource: ${t}`);return e}Y5.prototype.close=Y5.prototype.close,function(e,t){e=e.split(".");var n,r=Z$;e[0]in r||void 0===r.execScript||r.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=t}("TaskRunner",Y5);class q5{constructor(e,t,n,r){this.g=e,this.h=t,this.m=n,this.l=r}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function X5(e,t,n){const r=e.g;if(n=K5(r.createShader(n),"Failed to create WebGL shader"),r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${r.getShaderInfoLog(n)}`);return r.attachShader(e.h,n),n}function $5(e,t){const n=e.g,r=K5(n.createVertexArray(),"Failed to create vertex array");n.bindVertexArray(r);const i=K5(n.createBuffer(),"Failed to create buffer");n.bindBuffer(n.ARRAY_BUFFER,i),n.enableVertexAttribArray(e.R),n.vertexAttribPointer(e.R,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=K5(n.createBuffer(),"Failed to create buffer");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(e.J),n.vertexAttribPointer(e.J,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new q5(n,r,i,s)}function J5(e,t){if(e.g){if(t!==e.g)throw Error("Cannot change GL context once initialized")}else e.g=t}function Z5(e,t,n,r){return J5(e,t),e.h||(e.m(),e.C()),n?(e.s||(e.s=$5(e,!0)),n=e.s):(e.v||(e.v=$5(e,!1)),n=e.v),t.useProgram(e.h),n.bind(),e.l(),e=r(),n.g.bindVertexArray(null),e}function e6(e,t,n){return J5(e,t),e=K5(t.createTexture(),"Failed to create texture"),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n??t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n??t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),e}function t6(e,t,n){J5(e,t),e.A||(e.A=K5(t.createFramebuffer(),"Failed to create framebuffe.")),t.bindFramebuffer(t.FRAMEBUFFER,e.A),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}function n6(e){e.g?.bindFramebuffer(e.g.FRAMEBUFFER,null)}var r6=class{H(){return"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D inputTexture;\n  void main() {\n    gl_FragColor = texture2D(inputTexture, vTex);\n  }\n "}m(){const e=this.g;if(this.h=K5(e.createProgram(),"Failed to create WebGL program"),this.da=X5(this,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",e.VERTEX_SHADER),this.ca=X5(this,this.H(),e.FRAGMENT_SHADER),e.linkProgram(this.h),!e.getProgramParameter(this.h,e.LINK_STATUS))throw Error(`Error during program linking: ${e.getProgramInfoLog(this.h)}`);this.R=e.getAttribLocation(this.h,"aVertex"),this.J=e.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const e=this.g;e.deleteProgram(this.h),e.deleteShader(this.da),e.deleteShader(this.ca)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}},i6=class extends r6{H(){return"\n  precision mediump float;\n  uniform sampler2D backgroundTexture;\n  uniform sampler2D maskTexture;\n  uniform sampler2D colorMappingTexture;\n  varying vec2 vTex;\n  void main() {\n    vec4 backgroundColor = texture2D(backgroundTexture, vTex);\n    float category = texture2D(maskTexture, vTex).r;\n    vec4 categoryColor = texture2D(colorMappingTexture, vec2(category, 0.0));\n    gl_FragColor = mix(backgroundColor, categoryColor, categoryColor.a);\n  }\n "}C(){const e=this.g;e.activeTexture(e.TEXTURE1),this.B=e6(this,e,e.LINEAR),e.activeTexture(e.TEXTURE2),this.j=e6(this,e,e.NEAREST)}m(){super.m();const e=this.g;this.L=K5(e.getUniformLocation(this.h,"backgroundTexture"),"Uniform location"),this.V=K5(e.getUniformLocation(this.h,"colorMappingTexture"),"Uniform location"),this.K=K5(e.getUniformLocation(this.h,"maskTexture"),"Uniform location")}l(){super.l();const e=this.g;e.uniform1i(this.K,0),e.uniform1i(this.L,1),e.uniform1i(this.V,2)}close(){this.B&&this.g.deleteTexture(this.B),this.j&&this.g.deleteTexture(this.j),super.close()}},s6=class extends r6{H(){return"\n  precision mediump float;\n  uniform sampler2D maskTexture;\n  uniform sampler2D defaultTexture;\n  uniform sampler2D overlayTexture;\n  varying vec2 vTex;\n  void main() {\n    float confidence = texture2D(maskTexture, vTex).r;\n    vec4 defaultColor = texture2D(defaultTexture, vTex);\n    vec4 overlayColor = texture2D(overlayTexture, vTex);\n    // Apply the alpha from the overlay and merge in the default color\n    overlayColor = mix(defaultColor, overlayColor, overlayColor.a);\n    gl_FragColor = mix(defaultColor, overlayColor, confidence);\n  }\n "}C(){const e=this.g;e.activeTexture(e.TEXTURE1),this.j=e6(this,e),e.activeTexture(e.TEXTURE2),this.B=e6(this,e)}m(){super.m();const e=this.g;this.K=K5(e.getUniformLocation(this.h,"defaultTexture"),"Uniform location"),this.L=K5(e.getUniformLocation(this.h,"overlayTexture"),"Uniform location"),this.I=K5(e.getUniformLocation(this.h,"maskTexture"),"Uniform location")}l(){super.l();const e=this.g;e.uniform1i(this.I,0),e.uniform1i(this.K,1),e.uniform1i(this.L,2)}close(){this.j&&this.g.deleteTexture(this.j),this.B&&this.g.deleteTexture(this.B),super.close()}};function a6(e,t){switch(t){case 0:return e.g.find(e=>e instanceof Uint8Array);case 1:return e.g.find(e=>e instanceof Float32Array);case 2:return e.g.find(e=>"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture);default:throw Error(`Type is not supported: ${t}`)}}function o6(e){var t=a6(e,1);if(!t){if(t=a6(e,0))t=new Float32Array(t).map(e=>e/255);else{t=new Float32Array(e.width*e.height);const r=c6(e);var n=h6(e);if(t6(n,r,l6(e)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in self.document){n=new Float32Array(e.width*e.height*4),r.readPixels(0,0,e.width,e.height,r.RGBA,r.FLOAT,n);for(let e=0,r=0;e<t.length;++e,r+=4)t[e]=n[r]}else r.readPixels(0,0,e.width,e.height,r.RED,r.FLOAT,t)}e.g.push(t)}return t}function l6(e){let t=a6(e,2);if(!t){const n=c6(e);t=d6(e);const r=o6(e),i=u6(e);n.texImage2D(n.TEXTURE_2D,0,i,e.width,e.height,0,n.RED,n.FLOAT,r),f6(e)}return t}function c6(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return e.h||(e.h=K5(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function u6(e){if(e=c6(e),!p6)if(e.getExtension("EXT_color_buffer_float")&&e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_float_blend"))p6=e.R32F;else{if(!e.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");p6=e.R16F}return p6}function h6(e){return e.l||(e.l=new r6),e.l}function d6(e){const t=c6(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let n=a6(e,2);return n||(n=e6(h6(e),t,e.m?t.LINEAR:t.NEAREST),e.g.push(n),e.j=!0),t.bindTexture(t.TEXTURE_2D,n),n}function f6(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}var p6,m6=class{constructor(e,t,n,r,i,s,a){this.g=e,this.m=t,this.j=n,this.canvas=r,this.l=i,this.width=s,this.height=a,this.j&&0}Ja(){return!!a6(this,0)}ma(){return!!a6(this,1)}S(){return!!a6(this,2)}la(){return(e=a6(this,0))||(e=o6(this),e=new Uint8Array(e.map(e=>255*e)),this.g.push(e)),e;var e}ka(){return o6(this)}N(){return l6(this)}clone(){const e=[];for(const t of this.g){let n;if(t instanceof Uint8Array)n=new Uint8Array(t);else if(t instanceof Float32Array)n=new Float32Array(t);else{if(!(t instanceof WebGLTexture))throw Error(`Type is not supported: ${t}`);{const e=c6(this),t=h6(this);e.activeTexture(e.TEXTURE1),n=e6(t,e,this.m?e.LINEAR:e.NEAREST),e.bindTexture(e.TEXTURE_2D,n);const r=u6(this);e.texImage2D(e.TEXTURE_2D,0,r,this.width,this.height,0,e.RED,e.FLOAT,null),e.bindTexture(e.TEXTURE_2D,null),t6(t,e,n),Z5(t,e,!1,()=>{d6(this),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),f6(this)}),n6(t),f6(this)}}e.push(n)}return new m6(e,this.m,this.S(),this.canvas,this.l,this.width,this.height)}close(){this.j&&c6(this).deleteTexture(a6(this,2))}};m6.prototype.close=m6.prototype.close,m6.prototype.clone=m6.prototype.clone,m6.prototype.getAsWebGLTexture=m6.prototype.N,m6.prototype.getAsFloat32Array=m6.prototype.ka,m6.prototype.getAsUint8Array=m6.prototype.la,m6.prototype.hasWebGLTexture=m6.prototype.S,m6.prototype.hasFloat32Array=m6.prototype.ma,m6.prototype.hasUint8Array=m6.prototype.Ja;const g6={color:"white",lineWidth:4,radius:6};function A6(e){return{...g6,fillColor:(e=e||{}).color,...e}}function v6(e,t){return e instanceof Function?e(t):e}function y6(e,t,n){return Math.max(Math.min(t,n),Math.min(Math.max(t,n),e))}function E6(e){if(!e.l)throw Error("CPU rendering requested but CanvasRenderingContext2D not provided.");return e.l}function _6(e){if(!e.j)throw Error("GPU rendering requested but WebGL2RenderingContext not provided.");return e.j}function x6(e,t,n){if(t.S())n(t.N());else{const r=t.ma()?t.ka():t.la();e.m=e.m??new r6;const i=_6(e);n((e=new m6([r],t.m,!1,i.canvas,e.m,t.width,t.height)).N()),e.close()}}function b6(e,t,n,r){const i=function(e){return e.g||(e.g=new i6),e.g}(e),s=_6(e),a=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n;Z5(i,s,!0,()=>{!function(e,t,n,r){const i=e.g;if(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,e.B),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,n),e.I&&function(e,t){if(e!==t)return!1;e=e.entries(),t=t.entries();for(const[r,i]of e){e=r;const s=i;var n=t.next();if(n.done)return!1;const[a,o]=n.value;if(n=o,e!==a||s[0]!==n[0]||s[1]!==n[1]||s[2]!==n[2]||s[3]!==n[3])return!1}return!!t.next().done}(e.I,r))i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,e.j);else{e.I=r;const t=Array(1024).fill(0);r.forEach((e,n)=>{if(4!==e.length)throw Error(`Color at index ${n} is not a four-channel value.`);t[4*n]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]}),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,e.j),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,256,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array(t))}}(i,t,a,r),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.drawArrays(s.TRIANGLE_FAN,0,4);const e=i.g;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,null)})}function S6(e,t,n,r){const i=_6(e),s=function(e){return e.h||(e.h=new s6),e.h}(e),a=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n,o=Array.isArray(r)?new ImageData(new Uint8ClampedArray(r),1,1):r;Z5(s,i,!0,()=>{var e=s.g;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,s.j),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,s.B),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,o),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.drawArrays(i.TRIANGLE_FAN,0,4),i.bindTexture(i.TEXTURE_2D,null),(e=s.g).activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,null)})}var w6=class{constructor(e,t){e instanceof CanvasRenderingContext2D||e instanceof OffscreenCanvasRenderingContext2D?(this.l=e,this.j=t):this.j=e}Ca(e,t){if(e){var n=E6(this);t=A6(t),n.save();var r=n.canvas,i=0;for(const s of e)n.fillStyle=v6(t.fillColor,{index:i,from:s}),n.strokeStyle=v6(t.color,{index:i,from:s}),n.lineWidth=v6(t.lineWidth,{index:i,from:s}),(e=new Path2D).arc(s.x*r.width,s.y*r.height,v6(t.radius,{index:i,from:s}),0,2*Math.PI),n.fill(e),n.stroke(e),++i;n.restore()}}Ba(e,t,n){if(e&&t){var r=E6(this);n=A6(n),r.save();var i=r.canvas,s=0;for(const a of t){r.beginPath(),t=e[a.start];const o=e[a.end];t&&o&&(r.strokeStyle=v6(n.color,{index:s,from:t,to:o}),r.lineWidth=v6(n.lineWidth,{index:s,from:t,to:o}),r.moveTo(t.x*i.width,t.y*i.height),r.lineTo(o.x*i.width,o.y*i.height)),++s,r.stroke()}r.restore()}}ya(e,t){const n=E6(this);t=A6(t),n.save(),n.beginPath(),n.lineWidth=v6(t.lineWidth,{}),n.strokeStyle=v6(t.color,{}),n.fillStyle=v6(t.fillColor,{}),n.moveTo(e.originX,e.originY),n.lineTo(e.originX+e.width,e.originY),n.lineTo(e.originX+e.width,e.originY+e.height),n.lineTo(e.originX,e.originY+e.height),n.lineTo(e.originX,e.originY),n.stroke(),n.fill(),n.restore()}za(e,t,n=[0,0,0,255]){this.l?function(e,t,n,r){const i=_6(e);x6(e,t,t=>{b6(e,t,n,r),(t=E6(e)).drawImage(i.canvas,0,0,t.canvas.width,t.canvas.height)})}(this,e,n,t):b6(this,e.N(),n,t)}Aa(e,t,n){this.l?function(e,t,n,r){const i=_6(e);x6(e,t,t=>{S6(e,t,n,r),(t=E6(e)).drawImage(i.canvas,0,0,t.canvas.width,t.canvas.height)})}(this,e,t,n):S6(this,e.N(),t,n)}close(){this.g?.close(),this.g=void 0,this.h?.close(),this.h=void 0,this.m?.close(),this.m=void 0}};function C6(e,t){switch(t){case 0:return e.g.find(e=>e instanceof ImageData);case 1:return e.g.find(e=>"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap);case 2:return e.g.find(e=>"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture);default:throw Error(`Type is not supported: ${t}`)}}function T6(e){var t=C6(e,0);if(!t){t=I6(e);const n=R6(e),r=new Uint8Array(e.width*e.height*4);t6(n,t,M6(e)),t.readPixels(0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,r),n6(n),t=new ImageData(new Uint8ClampedArray(r.buffer),e.width,e.height),e.g.push(t)}return t}function M6(e){let t=C6(e,2);if(!t){const n=I6(e);t=B6(e);const r=C6(e,1)||T6(e);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),P6(e)}return t}function I6(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when iniitializing the image.");return e.h||(e.h=K5(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function R6(e){return e.l||(e.l=new r6),e.l}function B6(e){const t=I6(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let n=C6(e,2);return n||(n=e6(R6(e),t),e.g.push(n),e.m=!0),t.bindTexture(t.TEXTURE_2D,n),n}function P6(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}function D6(e){const t=I6(e);return Z5(R6(e),t,!0,()=>function(e,t){const n=e.canvas;if(n.width===e.width&&n.height===e.height)return t();const r=n.width,i=n.height;return n.width=e.width,n.height=e.height,e=t(),n.width=r,n.height=i,e}(e,()=>{if(t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),!(e.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return e.canvas.transferToImageBitmap()}))}w6.prototype.close=w6.prototype.close,w6.prototype.drawConfidenceMask=w6.prototype.Aa,w6.prototype.drawCategoryMask=w6.prototype.za,w6.prototype.drawBoundingBox=w6.prototype.ya,w6.prototype.drawConnectors=w6.prototype.Ba,w6.prototype.drawLandmarks=w6.prototype.Ca,w6.lerp=function(e,t,n,r,i){return y6(r*(1-(e-t)/(n-t))+i*(1-(n-e)/(n-t)),r,i)},w6.clamp=y6;var L6=class{constructor(e,t,n,r,i,s,a){this.g=e,this.j=t,this.m=n,this.canvas=r,this.l=i,this.width=s,this.height=a,(this.j||this.m)&&0}Ia(){return!!C6(this,0)}na(){return!!C6(this,1)}S(){return!!C6(this,2)}Ga(){return T6(this)}Fa(){var e=C6(this,1);return e||(M6(this),B6(this),e=D6(this),P6(this),this.g.push(e),this.j=!0),e}N(){return M6(this)}clone(){const e=[];for(const t of this.g){let n;if(t instanceof ImageData)n=new ImageData(t.data,this.width,this.height);else if(t instanceof WebGLTexture){const e=I6(this),t=R6(this);e.activeTexture(e.TEXTURE1),n=e6(t,e),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null),t6(t,e,n),Z5(t,e,!1,()=>{B6(this),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),P6(this)}),n6(t),P6(this)}else{if(!(t instanceof ImageBitmap))throw Error(`Type is not supported: ${t}`);M6(this),B6(this),n=D6(this),P6(this)}e.push(n)}return new L6(e,this.na(),this.S(),this.canvas,this.l,this.width,this.height)}close(){this.j&&C6(this,1).close(),this.m&&I6(this).deleteTexture(C6(this,2))}};L6.prototype.close=L6.prototype.close,L6.prototype.clone=L6.prototype.clone,L6.prototype.getAsWebGLTexture=L6.prototype.N,L6.prototype.getAsImageBitmap=L6.prototype.Fa,L6.prototype.getAsImageData=L6.prototype.Ga,L6.prototype.hasWebGLTexture=L6.prototype.S,L6.prototype.hasImageBitmap=L6.prototype.na,L6.prototype.hasImageData=L6.prototype.Ia;function k6(...e){return e.map(([e,t])=>({start:e,end:t}))}const F6=function(e){return class extends e{Oa(){this.i._registerModelResourcesGraphService()}}}((O6=class{constructor(e,t){this.l=!0,this.i=e,this.g=null,this.h=0,this.m="function"==typeof this.i._addIntToInputStream,void 0!==t?this.i.canvas=t:D5()?this.i.canvas=new OffscreenCanvas(1,1):this.i.canvas=document.createElement("canvas")}async initializeGraph(e){const t=await(await fetch(e)).arrayBuffer();e=!(e.endsWith(".pbtxt")||e.endsWith(".textproto")),this.setGraph(new Uint8Array(t),e)}setGraphFromString(e){this.setGraph((new TextEncoder).encode(e),!1)}setGraph(e,t){const n=e.length,r=this.i._malloc(n);this.i.HEAPU8.set(e,r),t?this.i._changeBinaryGraph(n,r):this.i._changeTextGraph(n,r),this.i._free(r)}configureAudio(e,t,n,r,i){this.i._configureAudio,F5(this,r||"input_audio",r=>{F5(this,i=i||"audio_header",i=>{this.i._configureAudio(r,i,e,t,n)})})}setAutoResizeCanvas(e){this.l=e}setAutoRenderToScreen(e){this.i._setAutoRenderToScreen(e)}setGpuBufferVerticalFlip(e){this.i.gpuOriginForWebTexturesIsBottomLeft=e}ga(e){N5(this,"__graph_config__",t=>{e(t)}),F5(this,"__graph_config__",e=>{this.i._getGraphConfig(e,void 0)}),delete this.i.simpleListeners.__graph_config__}attachErrorListener(e){this.i.errorListener=e}attachEmptyPacketListener(e,t){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[e]=t}addAudioToStream(e,t,n){this.addAudioToStreamWithShape(e,0,0,t,n)}addAudioToStreamWithShape(e,t,n,r,i){const s=4*e.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(e,this.g/4),F5(this,r,e=>{this.i._addAudioToInputStream(this.g,t,n,e,i)})}addGpuBufferToStream(e,t,n){F5(this,t,t=>{const[r,i]=O5(this,e,t);this.i._addBoundTextureToStream(t,r,i,n)})}addBoolToStream(e,t,n){F5(this,t,t=>{this.i._addBoolToInputStream(e,t,n)})}addDoubleToStream(e,t,n){F5(this,t,t=>{this.i._addDoubleToInputStream(e,t,n)})}addFloatToStream(e,t,n){F5(this,t,t=>{this.i._addFloatToInputStream(e,t,n)})}addIntToStream(e,t,n){F5(this,t,t=>{this.i._addIntToInputStream(e,t,n)})}addUintToStream(e,t,n){F5(this,t,t=>{this.i._addUintToInputStream(e,t,n)})}addStringToStream(e,t,n){F5(this,t,t=>{F5(this,e,e=>{this.i._addStringToInputStream(e,t,n)})})}addStringRecordToStream(e,t,n){F5(this,t,t=>{U5(this,Object.keys(e),r=>{U5(this,Object.values(e),i=>{this.i._addFlatHashMapToInputStream(r,i,Object.keys(e).length,t,n)})})})}addProtoToStream(e,t,n,r){F5(this,n,n=>{F5(this,t,t=>{const i=this.i._malloc(e.length);this.i.HEAPU8.set(e,i),this.i._addProtoToInputStream(i,e.length,t,n,r),this.i._free(i)})})}addEmptyPacketToStream(e,t){F5(this,e,e=>{this.i._addEmptyPacketToInputStream(e,t)})}addBoolVectorToStream(e,t,n){F5(this,t,t=>{const r=this.i._allocateBoolVector(e.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const t of e)this.i._addBoolVectorEntry(r,t);this.i._addBoolVectorToInputStream(r,t,n)})}addDoubleVectorToStream(e,t,n){F5(this,t,t=>{const r=this.i._allocateDoubleVector(e.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const t of e)this.i._addDoubleVectorEntry(r,t);this.i._addDoubleVectorToInputStream(r,t,n)})}addFloatVectorToStream(e,t,n){F5(this,t,t=>{const r=this.i._allocateFloatVector(e.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const t of e)this.i._addFloatVectorEntry(r,t);this.i._addFloatVectorToInputStream(r,t,n)})}addIntVectorToStream(e,t,n){F5(this,t,t=>{const r=this.i._allocateIntVector(e.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const t of e)this.i._addIntVectorEntry(r,t);this.i._addIntVectorToInputStream(r,t,n)})}addUintVectorToStream(e,t,n){F5(this,t,t=>{const r=this.i._allocateUintVector(e.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const t of e)this.i._addUintVectorEntry(r,t);this.i._addUintVectorToInputStream(r,t,n)})}addStringVectorToStream(e,t,n){F5(this,t,t=>{const r=this.i._allocateStringVector(e.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const t of e)F5(this,t,e=>{this.i._addStringVectorEntry(r,e)});this.i._addStringVectorToInputStream(r,t,n)})}addBoolToInputSidePacket(e,t){F5(this,t,t=>{this.i._addBoolToInputSidePacket(e,t)})}addDoubleToInputSidePacket(e,t){F5(this,t,t=>{this.i._addDoubleToInputSidePacket(e,t)})}addFloatToInputSidePacket(e,t){F5(this,t,t=>{this.i._addFloatToInputSidePacket(e,t)})}addIntToInputSidePacket(e,t){F5(this,t,t=>{this.i._addIntToInputSidePacket(e,t)})}addUintToInputSidePacket(e,t){F5(this,t,t=>{this.i._addUintToInputSidePacket(e,t)})}addStringToInputSidePacket(e,t){F5(this,t,t=>{F5(this,e,e=>{this.i._addStringToInputSidePacket(e,t)})})}addProtoToInputSidePacket(e,t,n){F5(this,n,n=>{F5(this,t,t=>{const r=this.i._malloc(e.length);this.i.HEAPU8.set(e,r),this.i._addProtoToInputSidePacket(r,e.length,t,n),this.i._free(r)})})}addBoolVectorToInputSidePacket(e,t){F5(this,t,t=>{const n=this.i._allocateBoolVector(e.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(const t of e)this.i._addBoolVectorEntry(n,t);this.i._addBoolVectorToInputSidePacket(n,t)})}addDoubleVectorToInputSidePacket(e,t){F5(this,t,t=>{const n=this.i._allocateDoubleVector(e.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(const t of e)this.i._addDoubleVectorEntry(n,t);this.i._addDoubleVectorToInputSidePacket(n,t)})}addFloatVectorToInputSidePacket(e,t){F5(this,t,t=>{const n=this.i._allocateFloatVector(e.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(const t of e)this.i._addFloatVectorEntry(n,t);this.i._addFloatVectorToInputSidePacket(n,t)})}addIntVectorToInputSidePacket(e,t){F5(this,t,t=>{const n=this.i._allocateIntVector(e.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(const t of e)this.i._addIntVectorEntry(n,t);this.i._addIntVectorToInputSidePacket(n,t)})}addUintVectorToInputSidePacket(e,t){F5(this,t,t=>{const n=this.i._allocateUintVector(e.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(const t of e)this.i._addUintVectorEntry(n,t);this.i._addUintVectorToInputSidePacket(n,t)})}addStringVectorToInputSidePacket(e,t){F5(this,t,t=>{const n=this.i._allocateStringVector(e.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(const t of e)F5(this,t,e=>{this.i._addStringVectorEntry(n,e)});this.i._addStringVectorToInputSidePacket(n,t)})}attachBoolListener(e,t){N5(this,e,t),F5(this,e,e=>{this.i._attachBoolListener(e)})}attachBoolVectorListener(e,t){z5(this,e,t),F5(this,e,e=>{this.i._attachBoolVectorListener(e)})}attachIntListener(e,t){N5(this,e,t),F5(this,e,e=>{this.i._attachIntListener(e)})}attachIntVectorListener(e,t){z5(this,e,t),F5(this,e,e=>{this.i._attachIntVectorListener(e)})}attachUintListener(e,t){N5(this,e,t),F5(this,e,e=>{this.i._attachUintListener(e)})}attachUintVectorListener(e,t){z5(this,e,t),F5(this,e,e=>{this.i._attachUintVectorListener(e)})}attachDoubleListener(e,t){N5(this,e,t),F5(this,e,e=>{this.i._attachDoubleListener(e)})}attachDoubleVectorListener(e,t){z5(this,e,t),F5(this,e,e=>{this.i._attachDoubleVectorListener(e)})}attachFloatListener(e,t){N5(this,e,t),F5(this,e,e=>{this.i._attachFloatListener(e)})}attachFloatVectorListener(e,t){z5(this,e,t),F5(this,e,e=>{this.i._attachFloatVectorListener(e)})}attachStringListener(e,t){N5(this,e,t),F5(this,e,e=>{this.i._attachStringListener(e)})}attachStringVectorListener(e,t){z5(this,e,t),F5(this,e,e=>{this.i._attachStringVectorListener(e)})}attachProtoListener(e,t,n){N5(this,e,t),F5(this,e,e=>{this.i._attachProtoListener(e,n||!1)})}attachProtoVectorListener(e,t,n){z5(this,e,t),F5(this,e,e=>{this.i._attachProtoVectorListener(e,n||!1)})}attachAudioListener(e,t,n){this.i._attachAudioListener,N5(this,e,(e,n)=>{e=new Float32Array(e.buffer,e.byteOffset,e.length/4),t(e,n)}),F5(this,e,e=>{this.i._attachAudioListener(e,n||!1)})}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends O6{get ia(){return this.i}ta(e,t,n){F5(this,t,t=>{const[r,i]=O5(this,e,t);this.ia._addBoundTextureAsImageToStream(t,r,i,n)})}W(e,t){N5(this,e,t),F5(this,e,e=>{this.ia._attachImageListener(e)})}fa(e,t){z5(this,e,t),F5(this,e,e=>{this.ia._attachImageVectorListener(e)})}}));var O6,U6=class extends F6{};async function N6(e,t,n){return async function(e,t,n,r){return async function(e,t,n,r){return e=await(async(e,t,n,r,i)=>{if(t&&await L5(t),!self.ModuleFactory)throw Error("ModuleFactory not set.");if(n&&(await L5(n),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&i&&((t=self.Module).locateFile=i.locateFile,i.mainScriptUrlOrBlob&&(t.mainScriptUrlOrBlob=i.mainScriptUrlOrBlob)),i=await self.ModuleFactory(self.Module||i),self.ModuleFactory=self.Module=void 0,new e(i,r)})(e,n.wasmLoaderPath,n.assetLoaderPath,t,{locateFile:e=>e.endsWith(".wasm")?n.wasmBinaryPath.toString():n.assetBinaryPath&&e.endsWith(".data")?n.assetBinaryPath.toString():e}),await e.o(r),e}(e,t,n,r)}(e,n.canvas??(D5()?void 0:document.createElement("canvas")),t,n)}function z6(e,t,n,r){if(e.V){const s=new l4;if(n?.regionOfInterest){if(!e.sa)throw Error("This task doesn't support region-of-interest.");var i=n.regionOfInterest;if(i.left>=i.right||i.top>=i.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(i.left<0||i.top<0||i.right>1||i.bottom>1)throw Error("Expected RectF values to be in [0,1].");S1(s,1,(i.left+i.right)/2),S1(s,2,(i.top+i.bottom)/2),S1(s,4,i.right-i.left),S1(s,3,i.bottom-i.top)}else S1(s,1,.5),S1(s,2,.5),S1(s,4,1),S1(s,3,1);if(n?.rotationDegrees){if(n?.rotationDegrees%90!=0)throw Error("Expected rotation to be a multiple of 90°.");if(S1(s,5,-Math.PI*n.rotationDegrees/180),n?.rotationDegrees%180!=0){const[e,r]=k5(t);n=E1(s,3)*r/e,i=E1(s,4)*e/r,S1(s,4,n),S1(s,3,i)}}e.g.addProtoToStream(s.g(),"mediapipe.NormalizedRect",e.V,r)}e.g.ta(t,e.da,r??performance.now()),e.finishProcessing()}function G6(e,t,n){if(e.baseOptions?.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");z6(e,t,n,e.B+1)}function Q6(e,t,n,r){if(!e.baseOptions?.g())throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");z6(e,t,n,r)}function H6(e,t,n,r){var i=t.data;const s=t.width,a=s*(t=t.height);if((i instanceof Uint8Array||i instanceof Float32Array)&&i.length!==a)throw Error("Unsupported channel count: "+i.length/a);return e=new m6([i],n,!1,e.g.i.canvas,e.R,s,t),r?e.clone():e}var V6=class extends Y5{constructor(e,t,n,r){super(e),this.g=e,this.da=t,this.V=n,this.sa=r,this.R=new r6}l(e,t=!0){if("runningMode"in e&&x1(this.baseOptions,2,!!e.runningMode&&"IMAGE"!==e.runningMode),void 0!==e.canvas&&this.g.i.canvas!==e.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(e,t)}close(){this.R.close(),super.close()}};V6.prototype.close=V6.prototype.close;var j6=class extends V6{constructor(e,t){super(new U6(e,t),"image_in","norm_rect_in",!1),this.j={detections:[]},f1(e=this.h=new C4,0,1,t=new b4),S1(this.h,2,.5),S1(this.h,3,.3)}get baseOptions(){return u1(this.h,b4,1)}set baseOptions(e){f1(this.h,0,1,e)}o(e){return"minDetectionConfidence"in e&&S1(this.h,2,e.minDetectionConfidence??.5),"minSuppressionThreshold"in e&&S1(this.h,3,e.minSuppressionThreshold??.3),this.l(e)}D(e,t){return this.j={detections:[]},G6(this,e,t),this.j}F(e,t,n){return this.j={detections:[]},Q6(this,e,n,t),this.j}m(){var e=new j3;H3(e,"image_in"),H3(e,"norm_rect_in"),V3(e,"detections");const t=new B3;$1(t,M4,this.h);const n=new U3;k3(n,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),F3(n,"IMAGE:image_in"),F3(n,"NORM_RECT:norm_rect_in"),O3(n,"DETECTIONS:detections"),n.o(t),Q3(e,n),this.g.attachProtoVectorListener("detections",(e,t)=>{for(const t of e)e=t4(t),this.j.detections.push(b5(e));H5(this,t)}),this.g.attachEmptyPacketListener("detections",e=>{H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};j6.prototype.detectForVideo=j6.prototype.F,j6.prototype.detect=j6.prototype.D,j6.prototype.setOptions=j6.prototype.o,j6.createFromModelPath=async function(e,t){return N6(j6,e,{baseOptions:{modelAssetPath:t}})},j6.createFromModelBuffer=function(e,t){return N6(j6,e,{baseOptions:{modelAssetBuffer:t}})},j6.createFromOptions=function(e,t){return N6(j6,e,t)};var W6=k6([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),Y6=k6([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),K6=k6([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),q6=k6([474,475],[475,476],[476,477],[477,474]),X6=k6([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),$6=k6([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),J6=k6([469,470],[470,471],[471,472],[472,469]),Z6=k6([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),e8=[...W6,...Y6,...K6,...X6,...$6,...Z6],t8=k6([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function n8(e){e.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var r8=class extends V6{constructor(e,t){super(new U6(e,t),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,f1(e=this.h=new L4,0,1,t=new b4),this.v=new D4,f1(this.h,0,3,this.v),this.s=new C4,f1(this.h,0,2,this.s),b1(this.s,4,1),S1(this.s,2,.5),S1(this.v,2,.5),S1(this.h,4,.5)}get baseOptions(){return u1(this.h,b4,1)}set baseOptions(e){f1(this.h,0,1,e)}o(e){return"numFaces"in e&&b1(this.s,4,e.numFaces??1),"minFaceDetectionConfidence"in e&&S1(this.s,2,e.minFaceDetectionConfidence??.5),"minTrackingConfidence"in e&&S1(this.h,4,e.minTrackingConfidence??.5),"minFacePresenceConfidence"in e&&S1(this.v,2,e.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in e&&(this.outputFacialTransformationMatrixes=!!e.outputFacialTransformationMatrixes),this.l(e)}D(e,t){return n8(this),G6(this,e,t),this.j}F(e,t,n){return n8(this),Q6(this,e,n,t),this.j}m(){var e=new j3;H3(e,"image_in"),H3(e,"norm_rect"),V3(e,"face_landmarks");const t=new B3;$1(t,O4,this.h);const n=new U3;k3(n,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),F3(n,"IMAGE:image_in"),F3(n,"NORM_RECT:norm_rect"),O3(n,"NORM_LANDMARKS:face_landmarks"),n.o(t),Q3(e,n),this.g.attachProtoVectorListener("face_landmarks",(e,t)=>{for(const t of e)e=s4(t),this.j.faceLandmarks.push(S5(e));H5(this,t)}),this.g.attachEmptyPacketListener("face_landmarks",e=>{H5(this,e)}),this.outputFaceBlendshapes&&(V3(e,"blendshapes"),O3(n,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",(e,t)=>{if(this.outputFaceBlendshapes)for(const t of e)e=$3(t),this.j.faceBlendshapes.push(x5(e.g()??[]));H5(this,t)}),this.g.attachEmptyPacketListener("blendshapes",e=>{H5(this,e)})),this.outputFacialTransformationMatrixes&&(V3(e,"face_geometry"),O3(n,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",(e,t)=>{if(this.outputFacialTransformationMatrixes)for(const t of e)(e=u1(B4(t),a4,2))&&this.j.facialTransformationMatrixes.push({rows:v1(y1(e,1),0)??0,columns:v1(y1(e,2),0)??0,data:J0(e,3,QZ,$0()).slice()??[]});H5(this,t)}),this.g.attachEmptyPacketListener("face_geometry",e=>{H5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};r8.prototype.detectForVideo=r8.prototype.F,r8.prototype.detect=r8.prototype.D,r8.prototype.setOptions=r8.prototype.o,r8.createFromModelPath=function(e,t){return N6(r8,e,{baseOptions:{modelAssetPath:t}})},r8.createFromModelBuffer=function(e,t){return N6(r8,e,{baseOptions:{modelAssetBuffer:t}})},r8.createFromOptions=function(e,t){return N6(r8,e,t)},r8.FACE_LANDMARKS_LIPS=W6,r8.FACE_LANDMARKS_LEFT_EYE=Y6,r8.FACE_LANDMARKS_LEFT_EYEBROW=K6,r8.FACE_LANDMARKS_LEFT_IRIS=q6,r8.FACE_LANDMARKS_RIGHT_EYE=X6,r8.FACE_LANDMARKS_RIGHT_EYEBROW=$6,r8.FACE_LANDMARKS_RIGHT_IRIS=J6,r8.FACE_LANDMARKS_FACE_OVAL=Z6,r8.FACE_LANDMARKS_CONTOURS=e8,r8.FACE_LANDMARKS_TESSELATION=t8;var i8=class extends V6{constructor(e,t){super(new U6(e,t),"image_in","norm_rect",!0),f1(e=this.j=new U4,0,1,t=new b4)}get baseOptions(){return u1(this.j,b4,1)}set baseOptions(e){f1(this.j,0,1,e)}o(e){return super.l(e)}Ra(e,t,n){const r="function"!=typeof t?t:{};if(this.h="function"==typeof t?t:n,G6(this,e,r??{}),!this.h)return this.s}m(){var e=new j3;H3(e,"image_in"),H3(e,"norm_rect"),V3(e,"stylized_image");const t=new B3;$1(t,N4,this.j);const n=new U3;k3(n,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),F3(n,"IMAGE:image_in"),F3(n,"NORM_RECT:norm_rect"),O3(n,"STYLIZED_IMAGE:stylized_image"),n.o(t),Q3(e,n),this.g.W("stylized_image",(e,t)=>{var n=!this.h,r=e.data,i=e.width;const s=i*(e=e.height);if(r instanceof Uint8Array)if(r.length===3*s){const t=new Uint8ClampedArray(4*s);for(let e=0;e<s;++e)t[4*e]=r[3*e],t[4*e+1]=r[3*e+1],t[4*e+2]=r[3*e+2],t[4*e+3]=255;r=new ImageData(t,i,e)}else{if(r.length!==4*s)throw Error("Unsupported channel count: "+r.length/s);r=new ImageData(new Uint8ClampedArray(r.buffer,r.byteOffset,r.length),i,e)}else if(!(r instanceof WebGLTexture))throw Error(`Unsupported format: ${r.constructor.name}`);i=new L6([r],!1,!1,this.g.i.canvas,this.R,i,e),this.s=n=n?i.clone():i,this.h&&this.h(n),H5(this,t)}),this.g.attachEmptyPacketListener("stylized_image",e=>{this.s=null,this.h&&this.h(null),H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};i8.prototype.stylize=i8.prototype.Ra,i8.prototype.setOptions=i8.prototype.o,i8.createFromModelPath=function(e,t){return N6(i8,e,{baseOptions:{modelAssetPath:t}})},i8.createFromModelBuffer=function(e,t){return N6(i8,e,{baseOptions:{modelAssetBuffer:t}})},i8.createFromOptions=function(e,t){return N6(i8,e,t)};var s8=k6([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function a8(e){e.gestures=[],e.landmarks=[],e.worldLandmarks=[],e.handedness=[]}function o8(e){return 0===e.gestures.length?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:e.gestures,landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handedness:e.handedness,handednesses:e.handedness}}function l8(e,t=!0){const n=[];for(const i of e){var r=$3(i);e=[];for(const n of r.g())r=t&&null!=y1(n,1)?v1(y1(n,1),0):-1,e.push({score:E1(n,2)??0,index:r,categoryName:_1(n,3)??"",displayName:_1(n,4)??""});n.push(e)}return n}var c8=class extends V6{constructor(e,t){super(new U6(e,t),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],f1(e=this.j=new Y4,0,1,t=new b4),this.s=new W4,f1(this.j,0,2,this.s),this.C=new j4,f1(this.s,0,3,this.C),this.v=new V4,f1(this.s,0,2,this.v),this.h=new H4,f1(this.j,0,3,this.h),S1(this.v,2,.5),S1(this.s,4,.5),S1(this.C,2,.5)}get baseOptions(){return u1(this.j,b4,1)}set baseOptions(e){f1(this.j,0,1,e)}o(e){if(b1(this.v,3,e.numHands??1),"minHandDetectionConfidence"in e&&S1(this.v,2,e.minHandDetectionConfidence??.5),"minTrackingConfidence"in e&&S1(this.s,4,e.minTrackingConfidence??.5),"minHandPresenceConfidence"in e&&S1(this.C,2,e.minHandPresenceConfidence??.5),e.cannedGesturesClassifierOptions){var t=new z4,n=t,r=_5(e.cannedGesturesClassifierOptions,u1(this.h,z4,3)?.h());f1(n,0,2,r),f1(this.h,0,3,t)}else void 0===e.cannedGesturesClassifierOptions&&u1(this.h,z4,3)?.g();return e.customGesturesClassifierOptions?(f1(n=t=new z4,0,2,r=_5(e.customGesturesClassifierOptions,u1(this.h,z4,4)?.h())),f1(this.h,0,4,t)):void 0===e.customGesturesClassifierOptions&&u1(this.h,z4,4)?.g(),this.l(e)}Ma(e,t){return a8(this),G6(this,e,t),o8(this)}Na(e,t,n){return a8(this),Q6(this,e,n,t),o8(this)}m(){var e=new j3;H3(e,"image_in"),H3(e,"norm_rect"),V3(e,"hand_gestures"),V3(e,"hand_landmarks"),V3(e,"world_hand_landmarks"),V3(e,"handedness");const t=new B3;$1(t,e5,this.j);const n=new U3;k3(n,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),F3(n,"IMAGE:image_in"),F3(n,"NORM_RECT:norm_rect"),O3(n,"HAND_GESTURES:hand_gestures"),O3(n,"LANDMARKS:hand_landmarks"),O3(n,"WORLD_LANDMARKS:world_hand_landmarks"),O3(n,"HANDEDNESS:handedness"),n.o(t),Q3(e,n),this.g.attachProtoVectorListener("hand_landmarks",(e,t)=>{for(const t of e){e=s4(t);const n=[];for(const t of d1(e,i4,1))n.push({x:E1(t,1)??0,y:E1(t,2)??0,z:E1(t,3)??0,visibility:E1(t,4)??0});this.landmarks.push(n)}H5(this,t)}),this.g.attachEmptyPacketListener("hand_landmarks",e=>{H5(this,e)}),this.g.attachProtoVectorListener("world_hand_landmarks",(e,t)=>{for(const t of e){e=r4(t);const n=[];for(const t of d1(e,n4,1))n.push({x:E1(t,1)??0,y:E1(t,2)??0,z:E1(t,3)??0,visibility:E1(t,4)??0});this.worldLandmarks.push(n)}H5(this,t)}),this.g.attachEmptyPacketListener("world_hand_landmarks",e=>{H5(this,e)}),this.g.attachProtoVectorListener("hand_gestures",(e,t)=>{this.gestures.push(...l8(e,!1)),H5(this,t)}),this.g.attachEmptyPacketListener("hand_gestures",e=>{H5(this,e)}),this.g.attachProtoVectorListener("handedness",(e,t)=>{this.handedness.push(...l8(e)),H5(this,t)}),this.g.attachEmptyPacketListener("handedness",e=>{H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};function u8(e){return{landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handednesses:e.handedness,handedness:e.handedness}}c8.prototype.recognizeForVideo=c8.prototype.Na,c8.prototype.recognize=c8.prototype.Ma,c8.prototype.setOptions=c8.prototype.o,c8.createFromModelPath=function(e,t){return N6(c8,e,{baseOptions:{modelAssetPath:t}})},c8.createFromModelBuffer=function(e,t){return N6(c8,e,{baseOptions:{modelAssetBuffer:t}})},c8.createFromOptions=function(e,t){return N6(c8,e,t)},c8.HAND_CONNECTIONS=s8;var h8=class extends V6{constructor(e,t){super(new U6(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],f1(e=this.h=new W4,0,1,t=new b4),this.s=new j4,f1(this.h,0,3,this.s),this.j=new V4,f1(this.h,0,2,this.j),b1(this.j,3,1),S1(this.j,2,.5),S1(this.s,2,.5),S1(this.h,4,.5)}get baseOptions(){return u1(this.h,b4,1)}set baseOptions(e){f1(this.h,0,1,e)}o(e){return"numHands"in e&&b1(this.j,3,e.numHands??1),"minHandDetectionConfidence"in e&&S1(this.j,2,e.minHandDetectionConfidence??.5),"minTrackingConfidence"in e&&S1(this.h,4,e.minTrackingConfidence??.5),"minHandPresenceConfidence"in e&&S1(this.s,2,e.minHandPresenceConfidence??.5),this.l(e)}D(e,t){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],G6(this,e,t),u8(this)}F(e,t,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Q6(this,e,n,t),u8(this)}m(){var e=new j3;H3(e,"image_in"),H3(e,"norm_rect"),V3(e,"hand_landmarks"),V3(e,"world_hand_landmarks"),V3(e,"handedness");const t=new B3;$1(t,Z4,this.h);const n=new U3;k3(n,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),F3(n,"IMAGE:image_in"),F3(n,"NORM_RECT:norm_rect"),O3(n,"LANDMARKS:hand_landmarks"),O3(n,"WORLD_LANDMARKS:world_hand_landmarks"),O3(n,"HANDEDNESS:handedness"),n.o(t),Q3(e,n),this.g.attachProtoVectorListener("hand_landmarks",(e,t)=>{for(const t of e)e=s4(t),this.landmarks.push(S5(e));H5(this,t)}),this.g.attachEmptyPacketListener("hand_landmarks",e=>{H5(this,e)}),this.g.attachProtoVectorListener("world_hand_landmarks",(e,t)=>{for(const t of e)e=r4(t),this.worldLandmarks.push(w5(e));H5(this,t)}),this.g.attachEmptyPacketListener("world_hand_landmarks",e=>{H5(this,e)}),this.g.attachProtoVectorListener("handedness",(e,t)=>{var n=this.handedness,r=n.push;const i=[];for(const t of e){e=$3(t);const n=[];for(const t of e.g())n.push({score:E1(t,2)??0,index:v1(y1(t,1),0)??-1,categoryName:_1(t,3)??"",displayName:_1(t,4)??""});i.push(n)}r.call(n,...i),H5(this,t)}),this.g.attachEmptyPacketListener("handedness",e=>{H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};h8.prototype.detectForVideo=h8.prototype.F,h8.prototype.detect=h8.prototype.D,h8.prototype.setOptions=h8.prototype.o,h8.createFromModelPath=function(e,t){return N6(h8,e,{baseOptions:{modelAssetPath:t}})},h8.createFromModelBuffer=function(e,t){return N6(h8,e,{baseOptions:{modelAssetBuffer:t}})},h8.createFromOptions=function(e,t){return N6(h8,e,t)},h8.HAND_CONNECTIONS=s8;var d8=k6([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function f8(e){e.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function p8(e){try{if(!e.C)return e.h;e.C(e.h)}finally{W5(e)}}function m8(e,t){e=s4(e),t.push(S5(e))}var g8=class extends V6{constructor(e,t){super(new U6(e,t),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,f1(e=this.j=new i5,0,1,t=new b4),this.K=new j4,f1(this.j,0,2,this.K),this.ca=new t5,f1(this.j,0,3,this.ca),this.s=new C4,f1(this.j,0,4,this.s),this.I=new D4,f1(this.j,0,5,this.I),this.v=new n5,f1(this.j,0,6,this.v),this.L=new r5,f1(this.j,0,7,this.L),S1(this.s,2,.5),S1(this.s,3,.3),S1(this.I,2,.5),S1(this.v,2,.5),S1(this.v,3,.3),S1(this.L,2,.5),S1(this.K,2,.5)}get baseOptions(){return u1(this.j,b4,1)}set baseOptions(e){f1(this.j,0,1,e)}o(e){return"minFaceDetectionConfidence"in e&&S1(this.s,2,e.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in e&&S1(this.s,3,e.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in e&&S1(this.I,2,e.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"minPoseDetectionConfidence"in e&&S1(this.v,2,e.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in e&&S1(this.v,3,e.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in e&&S1(this.L,2,e.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in e&&(this.outputPoseSegmentationMasks=!!e.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in e&&S1(this.K,2,e.minHandLandmarksConfidence??.5),this.l(e)}D(e,t,n){const r="function"!=typeof t?t:{};return this.C="function"==typeof t?t:n,f8(this),G6(this,e,r),p8(this)}F(e,t,n,r){const i="function"!=typeof n?n:{};return this.C="function"==typeof n?n:r,f8(this),Q6(this,e,i,t),p8(this)}m(){var e=new j3;H3(e,"input_frames_image"),V3(e,"pose_landmarks"),V3(e,"pose_world_landmarks"),V3(e,"face_landmarks"),V3(e,"left_hand_landmarks"),V3(e,"left_hand_world_landmarks"),V3(e,"right_hand_landmarks"),V3(e,"right_hand_world_landmarks");const t=new B3,n=new _3;r1(n,1,ZZ("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(e,t){if(null!=t)if(Array.isArray(t))W0(e,2,k0(t,O0,void 0,void 0,!1));else{if(!("string"==typeof t||t instanceof FJ||RJ(t)))throw Error("invalid value in Any.value field: "+t+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");r1(e,2,cZ(t,!1,!1),LJ())}}(n,this.j.g());const r=new U3;k3(r,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),A1(r,8,_3,n),F3(r,"IMAGE:input_frames_image"),O3(r,"POSE_LANDMARKS:pose_landmarks"),O3(r,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),O3(r,"FACE_LANDMARKS:face_landmarks"),O3(r,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),O3(r,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),O3(r,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),O3(r,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),r.o(t),Q3(e,r),V5(this,e),this.g.attachProtoListener("pose_landmarks",(e,t)=>{m8(e,this.h.poseLandmarks),H5(this,t)}),this.g.attachEmptyPacketListener("pose_landmarks",e=>{H5(this,e)}),this.g.attachProtoListener("pose_world_landmarks",(e,t)=>{var n=this.h.poseWorldLandmarks;e=r4(e),n.push(w5(e)),H5(this,t)}),this.g.attachEmptyPacketListener("pose_world_landmarks",e=>{H5(this,e)}),this.outputPoseSegmentationMasks&&(O3(r,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),j5(this,"pose_segmentation_mask"),this.g.W("pose_segmentation_mask",(e,t)=>{this.h.poseSegmentationMasks=[H6(this,e,!0,!this.C)],H5(this,t)}),this.g.attachEmptyPacketListener("pose_segmentation_mask",e=>{this.h.poseSegmentationMasks=[],H5(this,e)})),this.g.attachProtoListener("face_landmarks",(e,t)=>{m8(e,this.h.faceLandmarks),H5(this,t)}),this.g.attachEmptyPacketListener("face_landmarks",e=>{H5(this,e)}),this.outputFaceBlendshapes&&(V3(e,"extra_blendshapes"),O3(r,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",(e,t)=>{var n=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(e=$3(e),n.push(x5(e.g()??[]))),H5(this,t)}),this.g.attachEmptyPacketListener("extra_blendshapes",e=>{H5(this,e)})),this.g.attachProtoListener("left_hand_landmarks",(e,t)=>{m8(e,this.h.leftHandLandmarks),H5(this,t)}),this.g.attachEmptyPacketListener("left_hand_landmarks",e=>{H5(this,e)}),this.g.attachProtoListener("left_hand_world_landmarks",(e,t)=>{var n=this.h.leftHandWorldLandmarks;e=r4(e),n.push(w5(e)),H5(this,t)}),this.g.attachEmptyPacketListener("left_hand_world_landmarks",e=>{H5(this,e)}),this.g.attachProtoListener("right_hand_landmarks",(e,t)=>{m8(e,this.h.rightHandLandmarks),H5(this,t)}),this.g.attachEmptyPacketListener("right_hand_landmarks",e=>{H5(this,e)}),this.g.attachProtoListener("right_hand_world_landmarks",(e,t)=>{var n=this.h.rightHandWorldLandmarks;e=r4(e),n.push(w5(e)),H5(this,t)}),this.g.attachEmptyPacketListener("right_hand_world_landmarks",e=>{H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};g8.prototype.detectForVideo=g8.prototype.F,g8.prototype.detect=g8.prototype.D,g8.prototype.setOptions=g8.prototype.o,g8.createFromModelPath=function(e,t){return N6(g8,e,{baseOptions:{modelAssetPath:t}})},g8.createFromModelBuffer=function(e,t){return N6(g8,e,{baseOptions:{modelAssetBuffer:t}})},g8.createFromOptions=function(e,t){return N6(g8,e,t)},g8.HAND_CONNECTIONS=s8,g8.POSE_CONNECTIONS=d8,g8.FACE_LANDMARKS_LIPS=W6,g8.FACE_LANDMARKS_LEFT_EYE=Y6,g8.FACE_LANDMARKS_LEFT_EYEBROW=K6,g8.FACE_LANDMARKS_LEFT_IRIS=q6,g8.FACE_LANDMARKS_RIGHT_EYE=X6,g8.FACE_LANDMARKS_RIGHT_EYEBROW=$6,g8.FACE_LANDMARKS_RIGHT_IRIS=J6,g8.FACE_LANDMARKS_FACE_OVAL=Z6,g8.FACE_LANDMARKS_CONTOURS=e8,g8.FACE_LANDMARKS_TESSELATION=t8;var A8=class extends V6{constructor(e,t){super(new U6(e,t),"input_image","norm_rect",!0),this.j={classifications:[]},f1(e=this.h=new o5,0,1,t=new b4)}get baseOptions(){return u1(this.h,b4,1)}set baseOptions(e){f1(this.h,0,1,e)}o(e){return f1(this.h,0,2,_5(e,u1(this.h,g4,2))),this.l(e)}wa(e,t){return this.j={classifications:[]},G6(this,e,t),this.j}xa(e,t,n){return this.j={classifications:[]},Q6(this,e,n,t),this.j}m(){var e=new j3;H3(e,"input_image"),H3(e,"norm_rect"),V3(e,"classifications");const t=new B3;$1(t,l5,this.h);const n=new U3;k3(n,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),F3(n,"IMAGE:input_image"),F3(n,"NORM_RECT:norm_rect"),O3(n,"CLASSIFICATIONS:classifications"),n.o(t),Q3(e,n),this.g.attachProtoListener("classifications",(e,t)=>{this.j=function(e){const t={classifications:d1(e,c4,1).map(e=>x5(u1(e,q3,4)?.g()??[],v1(y1(e,2),0),_1(e,3)))};return null!=$Z(H0(e,2))&&(t.timestampMs=v1($Z(H0(e,2)),0)),t}(u4(e)),H5(this,t)}),this.g.attachEmptyPacketListener("classifications",e=>{H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};A8.prototype.classifyForVideo=A8.prototype.xa,A8.prototype.classify=A8.prototype.wa,A8.prototype.setOptions=A8.prototype.o,A8.createFromModelPath=function(e,t){return N6(A8,e,{baseOptions:{modelAssetPath:t}})},A8.createFromModelBuffer=function(e,t){return N6(A8,e,{baseOptions:{modelAssetBuffer:t}})},A8.createFromOptions=function(e,t){return N6(A8,e,t)};var v8=class extends V6{constructor(e,t){super(new U6(e,t),"image_in","norm_rect",!0),this.h=new c5,this.embeddings={embeddings:[]},f1(e=this.h,0,1,t=new b4)}get baseOptions(){return u1(this.h,b4,1)}set baseOptions(e){f1(this.h,0,1,e)}o(e){var t=this.h,n=u1(this.h,v4,2);return n=n?n.clone():new v4,void 0!==e.l2Normalize?x1(n,1,e.l2Normalize):"l2Normalize"in e&&W0(n,1),void 0!==e.quantize?x1(n,2,e.quantize):"quantize"in e&&W0(n,2),f1(t,0,2,n),this.l(e)}Da(e,t){return G6(this,e,t),this.embeddings}Ea(e,t,n){return Q6(this,e,n,t),this.embeddings}m(){var e=new j3;H3(e,"image_in"),H3(e,"norm_rect"),V3(e,"embeddings_out");const t=new B3;$1(t,u5,this.h);const n=new U3;k3(n,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),F3(n,"IMAGE:image_in"),F3(n,"NORM_RECT:norm_rect"),O3(n,"EMBEDDINGS:embeddings_out"),n.o(t),Q3(e,n),this.g.attachProtoListener("embeddings_out",(e,t)=>{e=m4(e),this.embeddings=function(e){return{embeddings:d1(e,f4,1).map(e=>{const t={headIndex:v1(y1(e,3),0)??-1,headName:_1(e,4)??""};if(void 0!==c1(e,h4,i1(e,1)))e=J0(e=u1(e,h4,i1(e,1)),1,QZ,$0()),t.floatEmbedding=e.slice();else{const n=new Uint8Array(0);t.quantizedEmbedding=u1(e,d4,i1(e,2))?.ra()?.ua()??n}return t}),timestampMs:v1($Z(H0(e,2)),0)}}(e),H5(this,t)}),this.g.attachEmptyPacketListener("embeddings_out",e=>{H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};v8.cosineSimilarity=function(e,t){if(e.floatEmbedding&&t.floatEmbedding)e=T5(e.floatEmbedding,t.floatEmbedding);else{if(!e.quantizedEmbedding||!t.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");e=T5(C5(e.quantizedEmbedding),C5(t.quantizedEmbedding))}return e},v8.prototype.embedForVideo=v8.prototype.Ea,v8.prototype.embed=v8.prototype.Da,v8.prototype.setOptions=v8.prototype.o,v8.createFromModelPath=function(e,t){return N6(v8,e,{baseOptions:{modelAssetPath:t}})},v8.createFromModelBuffer=function(e,t){return N6(v8,e,{baseOptions:{modelAssetBuffer:t}})},v8.createFromOptions=function(e,t){return N6(v8,e,t)};var y8=class{constructor(e,t,n){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=n}close(){this.confidenceMasks?.forEach(e=>{e.close()}),this.categoryMask?.close()}};function E8(e){e.categoryMask=void 0,e.confidenceMasks=void 0,e.qualityScores=void 0}function _8(e){try{const t=new y8(e.confidenceMasks,e.categoryMask,e.qualityScores);if(!e.j)return t;e.j(t)}finally{W5(e)}}y8.prototype.close=y8.prototype.close;var x8=class extends V6{constructor(e,t){super(new U6(e,t),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new m5,this.v=new h5,f1(this.h,0,3,this.v),f1(e=this.h,0,1,t=new b4)}get baseOptions(){return u1(this.h,b4,1)}set baseOptions(e){f1(this.h,0,1,e)}o(e){return void 0!==e.displayNamesLocale?W0(this.h,2,ZZ(e.displayNamesLocale)):"displayNamesLocale"in e&&W0(this.h,2),"outputCategoryMask"in e&&(this.outputCategoryMask=e.outputCategoryMask??!1),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=e.outputConfidenceMasks??!0),super.l(e)}J(){!function(e){const t=d1(e.ga(),U3,1).filter(e=>_1(e,1).includes("mediapipe.tasks.TensorsToSegmentationCalculator"));if(e.s=[],t.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");1===t.length&&(u1(t[0],B3,7)?.l()?.g()??new Map).forEach((t,n)=>{e.s[Number(n)]=_1(t,1)})}(this)}ha(e,t,n){const r="function"!=typeof t?t:{};return this.j="function"==typeof t?t:n,E8(this),G6(this,e,r),_8(this)}Pa(e,t,n,r){const i="function"!=typeof n?n:{};return this.j="function"==typeof n?n:r,E8(this),Q6(this,e,i,t),_8(this)}Ha(){return this.s}m(){var e=new j3;H3(e,"image_in"),H3(e,"norm_rect");const t=new B3;$1(t,g5,this.h);const n=new U3;k3(n,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),F3(n,"IMAGE:image_in"),F3(n,"NORM_RECT:norm_rect"),n.o(t),Q3(e,n),V5(this,e),this.outputConfidenceMasks&&(V3(e,"confidence_masks"),O3(n,"CONFIDENCE_MASKS:confidence_masks"),j5(this,"confidence_masks"),this.g.fa("confidence_masks",(e,t)=>{this.confidenceMasks=e.map(e=>H6(this,e,!0,!this.j)),H5(this,t)}),this.g.attachEmptyPacketListener("confidence_masks",e=>{this.confidenceMasks=[],H5(this,e)})),this.outputCategoryMask&&(V3(e,"category_mask"),O3(n,"CATEGORY_MASK:category_mask"),j5(this,"category_mask"),this.g.W("category_mask",(e,t)=>{this.categoryMask=H6(this,e,!1,!this.j),H5(this,t)}),this.g.attachEmptyPacketListener("category_mask",e=>{this.categoryMask=void 0,H5(this,e)})),V3(e,"quality_scores"),O3(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(e,t)=>{this.qualityScores=e,H5(this,t)}),this.g.attachEmptyPacketListener("quality_scores",e=>{this.categoryMask=void 0,H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};x8.prototype.getLabels=x8.prototype.Ha,x8.prototype.segmentForVideo=x8.prototype.Pa,x8.prototype.segment=x8.prototype.ha,x8.prototype.setOptions=x8.prototype.o,x8.createFromModelPath=function(e,t){return N6(x8,e,{baseOptions:{modelAssetPath:t}})},x8.createFromModelBuffer=function(e,t){return N6(x8,e,{baseOptions:{modelAssetBuffer:t}})},x8.createFromOptions=function(e,t){return N6(x8,e,t)};var b8=class{constructor(e,t,n){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=n}close(){this.confidenceMasks?.forEach(e=>{e.close()}),this.categoryMask?.close()}};b8.prototype.close=b8.prototype.close;var S8=class extends J1{constructor(e){super(e)}},w8=[0,r3,-2],C8=[0,X2,-3,a3,X2,-1],T8=[0,C8],M8=[0,C8,r3,-1],I8=class extends J1{constructor(e){super(e)}},R8=[0,X2,-1,a3],B8=class extends J1{constructor(){super()}},P8=class extends J1{constructor(e){super(e)}},D8=[1,2,3,4,5,6,7,8,9,10,14,15],L8=class extends J1{constructor(){super()}};L8.prototype.g=E3([0,q2,[0,D8,f3,C8,f3,[0,C8,w8],f3,T8,f3,[0,T8,w8],f3,R8,f3,[0,X2,-3,a3,g3],f3,[0,X2,-3,a3],f3,[0,u3,X2,-2,a3,r3,a3,-1,2,X2,w8],f3,M8,f3,[0,M8,w8],X2,w8,u3,f3,[0,X2,-3,a3,w8,-1],f3,[0,q2,R8]],u3,[0,u3,r3,-1,a3]]);var k8=class extends V6{constructor(e,t){super(new U6(e,t),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new m5,this.s=new h5,f1(this.h,0,3,this.s),f1(e=this.h,0,1,t=new b4)}get baseOptions(){return u1(this.h,b4,1)}set baseOptions(e){f1(this.h,0,1,e)}o(e){return"outputCategoryMask"in e&&(this.outputCategoryMask=e.outputCategoryMask??!1),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=e.outputConfidenceMasks??!0),super.l(e)}ha(e,t,n,r){const i="function"!=typeof n?n:{};this.j="function"==typeof n?n:r,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.B+1,r=new L8;const s=new P8;var a=new S8;if(b1(a,1,255),f1(s,0,12,a),t.keypoint&&t.scribble)throw Error("Cannot provide both keypoint and scribble.");if(t.keypoint){var o=new I8;x1(o,3,!0),S1(o,1,t.keypoint.x),S1(o,2,t.keypoint.y),p1(s,5,D8,o)}else{if(!t.scribble)throw Error("Must provide either a keypoint or a scribble.");for(o of(a=new B8,t.scribble))x1(t=new I8,3,!0),S1(t,1,o.x),S1(t,2,o.y),A1(a,1,I8,t);p1(s,15,D8,a)}A1(r,1,P8,s),this.g.addProtoToStream(r.g(),"drishti.RenderData","roi_in",n),G6(this,e,i);e:{try{const e=new b8(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var l=e;break e}this.j(e)}finally{W5(this)}l=void 0}return l}m(){var e=new j3;H3(e,"image_in"),H3(e,"roi_in"),H3(e,"norm_rect_in");const t=new B3;$1(t,g5,this.h);const n=new U3;k3(n,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),F3(n,"IMAGE:image_in"),F3(n,"ROI:roi_in"),F3(n,"NORM_RECT:norm_rect_in"),n.o(t),Q3(e,n),V5(this,e),this.outputConfidenceMasks&&(V3(e,"confidence_masks"),O3(n,"CONFIDENCE_MASKS:confidence_masks"),j5(this,"confidence_masks"),this.g.fa("confidence_masks",(e,t)=>{this.confidenceMasks=e.map(e=>H6(this,e,!0,!this.j)),H5(this,t)}),this.g.attachEmptyPacketListener("confidence_masks",e=>{this.confidenceMasks=[],H5(this,e)})),this.outputCategoryMask&&(V3(e,"category_mask"),O3(n,"CATEGORY_MASK:category_mask"),j5(this,"category_mask"),this.g.W("category_mask",(e,t)=>{this.categoryMask=H6(this,e,!1,!this.j),H5(this,t)}),this.g.attachEmptyPacketListener("category_mask",e=>{this.categoryMask=void 0,H5(this,e)})),V3(e,"quality_scores"),O3(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(e,t)=>{this.qualityScores=e,H5(this,t)}),this.g.attachEmptyPacketListener("quality_scores",e=>{this.categoryMask=void 0,H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};k8.prototype.segment=k8.prototype.ha,k8.prototype.setOptions=k8.prototype.o,k8.createFromModelPath=function(e,t){return N6(k8,e,{baseOptions:{modelAssetPath:t}})},k8.createFromModelBuffer=function(e,t){return N6(k8,e,{baseOptions:{modelAssetBuffer:t}})},k8.createFromOptions=function(e,t){return N6(k8,e,t)};var F8=class extends V6{constructor(e,t){super(new U6(e,t),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},f1(e=this.h=new A5,0,1,t=new b4)}get baseOptions(){return u1(this.h,b4,1)}set baseOptions(e){f1(this.h,0,1,e)}o(e){return void 0!==e.displayNamesLocale?W0(this.h,2,ZZ(e.displayNamesLocale)):"displayNamesLocale"in e&&W0(this.h,2),void 0!==e.maxResults?b1(this.h,3,e.maxResults):"maxResults"in e&&W0(this.h,3),void 0!==e.scoreThreshold?S1(this.h,4,e.scoreThreshold):"scoreThreshold"in e&&W0(this.h,4),void 0!==e.categoryAllowlist?w1(this.h,5,e.categoryAllowlist):"categoryAllowlist"in e&&W0(this.h,5),void 0!==e.categoryDenylist?w1(this.h,6,e.categoryDenylist):"categoryDenylist"in e&&W0(this.h,6),this.l(e)}D(e,t){return this.j={detections:[]},G6(this,e,t),this.j}F(e,t,n){return this.j={detections:[]},Q6(this,e,n,t),this.j}m(){var e=new j3;H3(e,"input_frame_gpu"),H3(e,"norm_rect"),V3(e,"detections");const t=new B3;$1(t,v5,this.h);const n=new U3;k3(n,"mediapipe.tasks.vision.ObjectDetectorGraph"),F3(n,"IMAGE:input_frame_gpu"),F3(n,"NORM_RECT:norm_rect"),O3(n,"DETECTIONS:detections"),n.o(t),Q3(e,n),this.g.attachProtoVectorListener("detections",(e,t)=>{for(const t of e)e=t4(t),this.j.detections.push(b5(e));H5(this,t)}),this.g.attachEmptyPacketListener("detections",e=>{H5(this,e)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};F8.prototype.detectForVideo=F8.prototype.F,F8.prototype.detect=F8.prototype.D,F8.prototype.setOptions=F8.prototype.o,F8.createFromModelPath=async function(e,t){return N6(F8,e,{baseOptions:{modelAssetPath:t}})},F8.createFromModelBuffer=function(e,t){return N6(F8,e,{baseOptions:{modelAssetBuffer:t}})},F8.createFromOptions=function(e,t){return N6(F8,e,t)};var O8=class{constructor(e,t,n){this.landmarks=e,this.worldLandmarks=t,this.segmentationMasks=n}close(){this.segmentationMasks?.forEach(e=>{e.close()})}};function U8(e){e.landmarks=[],e.worldLandmarks=[],e.segmentationMasks=void 0}function N8(e){try{const t=new O8(e.landmarks,e.worldLandmarks,e.segmentationMasks);if(!e.s)return t;e.s(t)}finally{W5(e)}}O8.prototype.close=O8.prototype.close;var z8=class extends V6{constructor(e,t){super(new U6(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,f1(e=this.h=new y5,0,1,t=new b4),this.v=new r5,f1(this.h,0,3,this.v),this.j=new n5,f1(this.h,0,2,this.j),b1(this.j,4,1),S1(this.j,2,.5),S1(this.v,2,.5),S1(this.h,4,.5)}get baseOptions(){return u1(this.h,b4,1)}set baseOptions(e){f1(this.h,0,1,e)}o(e){return"numPoses"in e&&b1(this.j,4,e.numPoses??1),"minPoseDetectionConfidence"in e&&S1(this.j,2,e.minPoseDetectionConfidence??.5),"minTrackingConfidence"in e&&S1(this.h,4,e.minTrackingConfidence??.5),"minPosePresenceConfidence"in e&&S1(this.v,2,e.minPosePresenceConfidence??.5),"outputSegmentationMasks"in e&&(this.outputSegmentationMasks=e.outputSegmentationMasks??!1),this.l(e)}D(e,t,n){const r="function"!=typeof t?t:{};return this.s="function"==typeof t?t:n,U8(this),G6(this,e,r),N8(this)}F(e,t,n,r){const i="function"!=typeof n?n:{};return this.s="function"==typeof n?n:r,U8(this),Q6(this,e,i,t),N8(this)}m(){var e=new j3;H3(e,"image_in"),H3(e,"norm_rect"),V3(e,"normalized_landmarks"),V3(e,"world_landmarks"),V3(e,"segmentation_masks");const t=new B3;$1(t,E5,this.h);const n=new U3;k3(n,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),F3(n,"IMAGE:image_in"),F3(n,"NORM_RECT:norm_rect"),O3(n,"NORM_LANDMARKS:normalized_landmarks"),O3(n,"WORLD_LANDMARKS:world_landmarks"),n.o(t),Q3(e,n),V5(this,e),this.g.attachProtoVectorListener("normalized_landmarks",(e,t)=>{this.landmarks=[];for(const t of e)e=s4(t),this.landmarks.push(S5(e));H5(this,t)}),this.g.attachEmptyPacketListener("normalized_landmarks",e=>{this.landmarks=[],H5(this,e)}),this.g.attachProtoVectorListener("world_landmarks",(e,t)=>{this.worldLandmarks=[];for(const t of e)e=r4(t),this.worldLandmarks.push(w5(e));H5(this,t)}),this.g.attachEmptyPacketListener("world_landmarks",e=>{this.worldLandmarks=[],H5(this,e)}),this.outputSegmentationMasks&&(O3(n,"SEGMENTATION_MASK:segmentation_masks"),j5(this,"segmentation_masks"),this.g.fa("segmentation_masks",(e,t)=>{this.segmentationMasks=e.map(e=>H6(this,e,!0,!this.s)),H5(this,t)}),this.g.attachEmptyPacketListener("segmentation_masks",e=>{this.segmentationMasks=[],H5(this,e)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};z8.prototype.detectForVideo=z8.prototype.F,z8.prototype.detect=z8.prototype.D,z8.prototype.setOptions=z8.prototype.o,z8.createFromModelPath=function(e,t){return N6(z8,e,{baseOptions:{modelAssetPath:t}})},z8.createFromModelBuffer=function(e,t){return N6(z8,e,{baseOptions:{modelAssetBuffer:t}})},z8.createFromOptions=function(e,t){return N6(z8,e,t)},z8.POSE_CONNECTIONS=d8;var G8=Object.freeze({__proto__:null,DrawingUtils:w6,FaceDetector:j6,FaceLandmarker:r8,FaceStylizer:i8,FilesetResolver:P5,GestureRecognizer:c8,HandLandmarker:h8,HolisticLandmarker:g8,ImageClassifier:A8,ImageEmbedder:v8,ImageSegmenter:x8,ImageSegmenterResult:y8,InteractiveSegmenter:k8,InteractiveSegmenterResult:b8,MPImage:L6,MPMask:m6,ObjectDetector:F8,PoseLandmarker:z8,VisionTaskRunner:V6});export{fK as AccumulativeShadows,jq as AdaptiveDpr,Wq as AdaptiveEvents,rB as ArcballControls,zR as AsciiRenderer,Ij as BBAnchor,EK as Backdrop,Nq as BakeShadows,pM as Billboard,BY as Bounds,rY as Box,xj as Bvh,rP as CameraControls,DY as CameraShake,Pm as Canvas,EY as Capsule,TM as CatmullRomLine,TK as Caustics,Lj as Center,iY as Circle,TR as Clone,$K as Cloud,XK as CloudInstance,qK as Clouds,CR as ComputedAttribute,sY as Cone,uK as ContactShadows,$R as CubeCamera,GP as CubeTexture,CM as CubicBezierLine,kW as CurveModifier,qm as CycleRaycast,aY as Cylinder,DR as Decal,Oq as Detailed,RQ as DetectGPU,JR as DeviceOrientationControls,AY as Dodecahedron,wA as DragControls,hR as Edges,JI as Effects,cK as Environment,aK as EnvironmentCube,sK as EnvironmentMap,oK as EnvironmentPortal,kj as Example,vY as Extrude,X$ as FaceControls,j$ as FaceLandmarker,V$ as FaceLandmarkerDefaults,N$ as Facemesh,Q$ as FacemeshDatas,G$ as FacemeshEye,z$ as FacemeshEyeDefaults,YR as Fbo,HP as Fbx,aB as FirstPersonControls,nX as Fisheye,LY as Float,ZR as FlyControls,EP as GizmoHelper,LP as GizmoViewcube,OP as GizmoViewport,NR as Gltf,eR as GradientTexture,ZI as GradientType,NP as Grid,sQ as Helper,Km as Html,cP as Hud,mY as Icosahedron,uR as Image,CW as Instance,RW as InstancedAttribute,TW as Instances,nR as IsObject,Tx as KeyboardControls,WP as Ktx2,yY as Lathe,FK as Lightformer,bM as Line,sg as Loader,eB as MapControls,RR as MarchingCube,IR as MarchingCubes,BR as MarchingPlane,eX as Mask,sq as MatcapTexture,MW as Merged,qW as MeshDiscardMaterial,OW as MeshDistortMaterial,sX as MeshPortalMaterial,HW as MeshReflectorMaterial,jW as MeshRefractionMaterial,KW as MeshTransmissionMaterial,NW as MeshWobbleMaterial,oP as MotionPathControls,XW as MultiMaterial,oq as NormalTexture,gY as Octahedron,tB as OrbitControls,KR as OrthographicCamera,fR as Outlines,Kq as PerformanceMonitor,qR as PerspectiveCamera,L$ as PivotControls,lY as Plane,Iq as Point,ZW as PointMaterial,JW as PointMaterialImpl,sB as PointerLockControls,Bq as Points,Rq as PointsBuffer,pY as Polyhedron,vW as PositionMesh,xq as PositionPoint,MM as PositionalAudio,Uq as Preload,Sx as PresentationControls,rg as Progress,wM as QuadraticBezierLine,pK as RandomizedLight,Gf as ReactThreeFiber,MK as Reflector,Jq as RenderCubeTexture,Xq as RenderTexture,CY as Resize,fY as Ring,bY as RoundedBox,wR as Sampler,wY as ScreenQuad,xM as ScreenSizer,mM as ScreenSpace,k$ as ScreenVideoTexture,iy as Scroll,ty as ScrollControls,Fq as Segment,Lq as SegmentObject,Dq as Segments,dM as Select,_K as Shadow,Aq as ShadowAlpha,_Y as Shape,UK as Sky,tY as SoftShadows,rq as Sparkles,oY as Sphere,jR as Splat,kK as SpotLight,LK as SpotLightShadow,LW as SpriteAnimator,vK as Stage,GK as Stars,hQ as Stats,pQ as StatsGl,LR as Svg,$d as THREE,dY as Tetrahedron,jI as Text,XI as Text3D,iR as Texture,uY as Torus,hY as TorusKnot,nB as TrackballControls,bR as Trail,Dj as TrailTexture,iB as TransformControls,cY as Tube,ZG as VideoTexture,HX as View,F$ as WebcamVideoTexture,gq as Wireframe,Wp as _roots,hK as accumulativeContext,am as act,Bp as addAfterEffect,Rp as addEffect,Pp as addTail,Kp as advance,Xp as applyProps,ap as buildGraph,OK as calcPosFromAngles,EM as calculateScaleFactor,nQ as checkIfFrameIsEmpty,Sp as context,_p as createEvents,IW as createInstances,lm as createPointerEvents,rm as createPortal,Zp as createRoot,J$ as default,op as dispose,lm as events,Hf as extend,Lp as flushGlobalEffects,sm as flushSync,tQ as getFirstFrame,rp as getRootState,Yp as invalidate,$I as isWebGL2Available,Vq as meshBounds,qp as reconciler,em as render,tR as shaderMaterial,nm as unmountComponentAtNode,Sj as useAnimations,gQ as useAspect,_j as useBVH,PY as useBounds,Cj as useBoxProjectedEnv,AQ as useCamera,bj as useContextBridge,XR as useCubeCamera,zP as useCubeTexture,Xm as useCursor,mQ as useDepthBuffer,IQ as useDetectGPU,JY as useEnvironment,WR as useFBO,QP as useFBX,$$ as useFaceControls,W$ as useFaceLandmarker,KI as useFont,Gp as useFrame,UR as useGLTF,hP as useGizmoContext,Qp as useGraph,iQ as useHelper,Up as useInstanceHandle,wj as useIntersect,jP as useKTX2,Mx as useKeyboardControls,jp as useLoader,tX as useMask,iq as useMatcapTexture,sP as useMotion,aq as useNormalTexture,qq as usePerformanceMonitor,ng as useProgress,ey as useScroll,fM as useSelect,PW as useSpriteAnimator,rQ as useSpriteLoader,Np as useStore,SR as useSurfaceSampler,rR as useTexture,zp as useThree,xR as useTrail,Pj as useTrailTexture,JG as useVideoTexture};
